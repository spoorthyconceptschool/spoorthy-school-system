module.exports=[4668,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(69387);var e=a.i(60574),f=a.i(20237),g=a.i(40064),h=a.i(62244),i=a.i(9450),j=a.i(69012),k=a.i(87532),l=a.i(40737),m=a.i(81402),n=a.i(81560),o=a.i(96221),p=a.i(46842),q=a.i(24987),r=a.i(63519),s=a.i(53722),t=a.i(66718),u=a.i(14574),v=a.i(99570),w=a.i(73320);let x=(0,a.i(70106).default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var y=a.i(84505),z=a.i(16201),A=a.i(75750),B=a.i(91410);function C({onSuccess:a}){let[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),{classes:n}=(0,B.useMasterData)(),p=async()=>{if(h.length){k(!0),m(null);try{let b=await fetch("/api/admin/students/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({students:h})}),c=await b.json();if(!b.ok)throw Error(c.error||"Upload failed");m(c),c.success>0&&a()}catch(a){console.error(a),alert("Upload Error: "+a.message)}finally{k(!1)}}};return(0,b.jsxs)(u.Dialog,{open:d,onOpenChange:a=>{e(a),a||(g(null),i([]),m(null))},children:[(0,b.jsx)(u.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(v.Button,{variant:"outline",className:"gap-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20",children:[(0,b.jsx)(x,{className:"w-4 h-4"})," Bulk Import"]})}),(0,b.jsxs)(u.DialogContent,{className:"bg-black/95 border-white/10 text-white max-w-2xl",children:[(0,b.jsx)(u.DialogHeader,{children:(0,b.jsx)(u.DialogTitle,{children:"Import Students via Excel/CSV"})}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"bg-white/5 p-4 rounded-lg flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,b.jsx)("p",{className:"font-bold text-white mb-1",children:"Step 1: Download Template"}),(0,b.jsx)("p",{children:"Use our template ensuring columns match exactly."})]}),(0,b.jsx)(v.Button,{variant:"ghost",size:"sm",asChild:!0,className:"text-blue-400 hover:bg-blue-400/10 cursor-pointer",children:(0,b.jsxs)("a",{href:"/templates/student_import.xlsx",download:"StudentImportTemplate.xlsx",children:[(0,b.jsx)(y.Download,{className:"w-4 h-4 mr-2"})," Template.xlsx"]})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"font-bold text-sm text-gray-400",children:"Step 2: Upload File"}),(0,b.jsxs)("div",{className:"border-2 border-dashed border-white/10 rounded-lg p-6 text-center hover:bg-white/5 transition-colors relative",children:[(0,b.jsx)("input",{type:"file",accept:".xlsx, .xls, .csv",onChange:a=>{let b=a.target.files?.[0];if(!b)return;g(b);let c=new FileReader;c.onload=a=>{let b=a.target?.result,c=A.read(b,{type:"binary"}),d=c.SheetNames[0],e=c.Sheets[d];i(A.utils.sheet_to_json(e)),m(null)},c.readAsBinaryString(b)},className:"absolute inset-0 opacity-0 cursor-pointer"}),(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-400",children:[(0,b.jsx)(w.Upload,{className:"w-8 h-8 opacity-50"}),(0,b.jsx)("p",{children:f?f.name:"Click to browse or drag file here"})]})]})]}),h.length>0&&!l&&(0,b.jsxs)("div",{className:"space-y-4 animate-in fade-in",children:[(0,b.jsxs)("div",{className:"bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 p-3 rounded text-sm flex items-center gap-2",children:[(0,b.jsx)(z.CheckCircle,{className:"w-4 h-4"}),"Ready to import ",h.length," students."]}),(0,b.jsx)(v.Button,{onClick:p,disabled:j,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold",children:j?(0,b.jsx)(o.Loader2,{className:"animate-spin mr-2"}):"Start Import"})]}),l&&(0,b.jsxs)("div",{className:"bg-black/30 p-4 rounded-lg border border-white/10 space-y-2 animate-in fade-in",children:[(0,b.jsx)("h4",{className:"font-bold mb-2",children:"Import Results"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,b.jsxs)("div",{className:"bg-emerald-500/10 p-2 rounded border border-emerald-500/20 text-emerald-400",children:[(0,b.jsx)("div",{className:"text-xl font-bold",children:l.success}),(0,b.jsx)("div",{className:"text-xs uppercase",children:"Success"})]}),(0,b.jsxs)("div",{className:"bg-red-500/10 p-2 rounded border border-red-500/20 text-red-400",children:[(0,b.jsx)("div",{className:"text-xl font-bold",children:l.failed}),(0,b.jsx)("div",{className:"text-xs uppercase",children:"Failed"})]})]}),l.errors.length>0&&(0,b.jsx)("div",{className:"mt-4 max-h-32 overflow-y-auto text-xs text-red-300 space-y-1 bg-black/20 p-2 rounded",children:l.errors.map((a,c)=>(0,b.jsxs)("div",{children:["â€¢ ",a]},c))}),(0,b.jsx)(v.Button,{variant:"outline",onClick:()=>{g(null),i([]),m(null),e(!1)},className:"w-full mt-4",children:"Done"})]})]})]})]})}var D=a.i(89402),E=a.i(70430),F=a.i(4720),G=a.i(71931),H=a.i(68114);function I({students:a}){let{classes:d,villages:e,branding:f}=(0,B.useMasterData)(),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)([]),[p,r]=(0,c.useState)("none"),s=Object.values(d||{}).map(a=>({id:a.id,name:a.name,order:a.order||99})).sort((a,b)=>a.order-b.order),t=Object.values(e||{}).map(a=>({id:a.id,name:a.name})).sort((a,b)=>a.name.localeCompare(b.name)),w=()=>a.filter(a=>{let b=0===k.length||k.includes(a.classId)||k.includes(a.className),c=0===m.length||m.includes(a.villageId)||m.includes(a.villageName);return b&&c}),x=async()=>{j(!0);try{let a=A.utils.book_new(),b=w();if(0===b.length){alert("No students found for the selected filters."),j(!1);return}let c=b.map(a=>({ID:a.schoolId,"Student Name":a.studentName,"Parent Name":a.parentName,Class:a.className,Section:a.sectionName||"N/A","Parent Mobile":a.parentMobile,Village:a.villageName,Status:a.status,"Login Password":a.recoveryPassword||"N/A"})),d=A.utils.json_to_sheet(c,{header:["ID","Student Name","Parent Name","Class","Section","Parent Mobile","Village","Status","Login Password"]});A.utils.book_append_sheet(a,d,"Students");let e=A.write(a,{bookType:"xlsx",type:"array"}),f=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=window.URL.createObjectURL(f),i=document.createElement("a");i.href=g,i.download=`Student_Reports_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(g),document.body.removeChild(i),h(!1)}catch(a){console.error(a),alert("Export Failed: "+a.message)}finally{j(!1)}};return(0,b.jsxs)(u.Dialog,{open:g,onOpenChange:h,children:[(0,b.jsx)(u.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(v.Button,{variant:"outline",className:"h-9 md:h-12 gap-2 border-white/10 bg-white/5 text-white/70 hover:bg-white/10 rounded-xl px-4 md:px-6 transition-all",children:[(0,b.jsx)(F.FileText,{className:"w-4 h-4"})," ",(0,b.jsx)("span",{className:"hidden sm:inline",children:"Reports & Export"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Reports"})]})}),(0,b.jsxs)(u.DialogContent,{className:"bg-[#0A192F] border-white/10 text-white max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl shadow-2xl backdrop-blur-3xl",children:[(0,b.jsx)(u.DialogHeader,{children:(0,b.jsx)(u.DialogTitle,{className:"text-2xl font-display font-bold italic bg-gradient-to-r from-blue-400 to-indigo-400 bg-clip-text text-transparent",children:"Student Reporting Center"})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"p-5 bg-blue-500/5 border border-blue-500/10 rounded-2xl space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-blue-400 text-xs font-bold uppercase tracking-tighter",children:[(0,b.jsx)(G.Printer,{size:16})," Student List Printing"]}),(0,b.jsx)("p",{className:"text-[11px] text-blue-300 opacity-70 leading-relaxed italic",children:"Generate high-quality physical student directories. Use the filters on the right to target specific groups."}),(0,b.jsxs)("div",{className:"space-y-2 pt-1 border-t border-white/5 mt-2",children:[(0,b.jsx)(E.Label,{className:"text-[10px] font-black text-white/40 uppercase tracking-widest",children:"Grouping Strategy"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{id:"none",label:"None"},{id:"class",label:"By Class"},{id:"village",label:"By Village"}].map(a=>(0,b.jsx)("button",{onClick:()=>r(a.id),className:(0,H.cn)("py-2 px-2 rounded-xl text-[11px] font-bold border transition-all",p===a.id?"bg-blue-600 border-blue-500 text-white shadow-lg shadow-blue-500/20":"bg-white/5 border-white/10 text-white/40 hover:bg-white/10"),children:a.label},a.id))})]}),(0,b.jsxs)(v.Button,{onClick:()=>{let a=w();if(0===a.length)return void alert("No students selected");a.sort((a,b)=>(a.studentName||"").localeCompare(b.studentName||""));let b=window.open("","_blank");if(!b)return;let c=new Date().toLocaleString(),d={};"none"===p?d["Student Directory Report"]=a:a.forEach(a=>{let b="class"===p?a.className||"Other Class":a.villageName||"Other Village";d[b]||(d[b]=[]),d[b].push(a)});let e=Object.keys(d),g=`
            <html>
            <head>
                <title>Student List report</title>
                <style>
                    @media print {
                        .page-break { page-break-after: always; }
                    }
                    body { font-family: sans-serif; padding: 20px; color: #333; }
                    .group-container { margin-bottom: 40px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 11px; }
                    th { background-color: #f2f2f2; }
                    h1 { text-align: center; color: #333; margin-bottom: 5px; }
                    .header-meta { text-align: center; font-size: 12px; color: #666; margin-bottom: 20px; }
                    .branding { display: flex; align-items: center; justify-content: center; gap: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                    .school-info h1 { margin: 0; font-size: 24px; text-align: left; }
                    .school-info p { margin: 2px 0; font-size: 12px; color: #666; }
                    .group-header { font-size: 16px; font-bold; margin-top: 20px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
                </style>
            </head>
            <body>
                ${e.map((a,b)=>`
                    <div class="group-container ${"none"!==p?"page-break":""}">
                        <div class="branding">
                            ${f?.schoolLogo?`<img src="${f.schoolLogo}" style="height: 60px;" />`:""}
                            <div class="school-info">
                                <h1>${f?.schoolName}</h1>
                                <p>${f?.address||""}</p>
                                <p><strong>${"none"!==p?`${p.toUpperCase()} List: ${a}`:a}</strong> | ${c}</p>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 40px;">S.No</th>
                                    <th style="width: 80px;">ID</th>
                                    <th>Student Name</th>
                                    <th>Parent Name</th>
                                    <th>Mobile</th>
                                    <th>Class</th>
                                    <th>Village</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${d[a].map((a,b)=>`
                                    <tr>
                                        <td>${b+1}</td>
                                        <td>${a.schoolId}</td>
                                        <td>${a.studentName}</td>
                                        <td>${a.parentName}</td>
                                        <td>${a.parentMobile}</td>
                                        <td>${a.className}</td>
                                        <td>${a.villageName}</td>
                                    </tr>
                                `).join("")}
                            </tbody>
                        </table>
                        <p style="font-size: 10px; margin-top: 10px;">Total Students in this group: ${d[a].length}</p>
                    </div>
                `).join("")}
                <script>
                    window.onload = () => { window.print(); window.close(); };
                </script>
            </body>
            </html>
        `;b.document.write(g),b.document.close()},variant:"outline",className:"w-full mt-2 h-12 gap-2 border-blue-500/40 bg-blue-500/10 text-blue-400 hover:bg-blue-600 hover:text-white rounded-2xl transition-all font-black uppercase tracking-tighter",children:[(0,b.jsx)(G.Printer,{size:16})," Print Selected Students"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-white/5 border border-white/10 rounded-2xl space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-emerald-400 text-xs font-bold",children:[(0,b.jsx)(y.Download,{size:14})," Quick Export"]}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground italic",children:"Download student data in Excel format for offline management."})]})]}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)(E.Label,{className:"text-muted-foreground uppercase text-[10px] font-black tracking-widest flex items-center gap-2",children:[(0,b.jsx)(q.MapPin,{size:12})," Filter Hierarchy"]}),(0,b.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,b.jsx)("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-widest",children:"Target Classes"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>l(s.map(a=>a.id)),className:"text-[9px] font-black text-emerald-400 hover:underline uppercase",children:"All"}),(0,b.jsx)("button",{onClick:()=>l([]),className:"text-[9px] font-black text-red-400 hover:underline uppercase",children:"Clear"})]})]}),(0,b.jsx)("div",{className:"h-[120px] overflow-y-auto pr-2 custom-scrollbar space-y-1",children:s.map(a=>(0,b.jsxs)("div",{onClick:()=>{var b;return b=a.id,void l(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:(0,H.cn)("flex items-center gap-2 p-1.5 rounded-lg cursor-pointer text-[11px] transition-colors",k.includes(a.id)?"bg-blue-500/20 text-blue-400":"text-white/40 hover:bg-white/5"),children:[(0,b.jsx)("div",{className:(0,H.cn)("w-3 h-3 rounded-sm border",k.includes(a.id)?"bg-blue-500 border-blue-500":"border-white/20")}),a.name]},a.id))})]}),(0,b.jsxs)("div",{className:"border-t border-white/5 pt-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,b.jsx)("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-widest",children:"Target Villages"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>n(t.map(a=>a.id)),className:"text-[9px] font-black text-cyan-400 hover:underline uppercase",children:"All"}),(0,b.jsx)("button",{onClick:()=>n([]),className:"text-[9px] font-black text-red-500 hover:underline uppercase",children:"Clear"})]})]}),(0,b.jsx)("div",{className:"h-[120px] overflow-y-auto pr-2 custom-scrollbar space-y-1",children:t.map(a=>(0,b.jsxs)("div",{onClick:()=>{var b;return b=a.id,void n(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:(0,H.cn)("flex items-center gap-2 p-1.5 rounded-lg cursor-pointer text-[11px] transition-colors",m.includes(a.id)?"bg-cyan-500/20 text-cyan-400":"text-white/40 hover:bg-white/5"),children:[(0,b.jsx)("div",{className:(0,H.cn)("w-3 h-3 rounded-sm border",m.includes(a.id)?"bg-cyan-500 border-cyan-500":"border-white/20")}),a.name]},a.id))})]})]})})]}),(0,b.jsx)(u.DialogFooter,{className:"pt-4 border-t border-white/5",children:(0,b.jsx)(v.Button,{onClick:x,disabled:i,className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white font-black h-12 rounded-2xl shadow-xl shadow-emerald-500/20 transition-all uppercase tracking-tighter",children:i?(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Loader2,{className:"animate-spin w-4 h-4"})," Generating Package..."]}):"Export Student Dataset"})})]})]})}var J=a.i(80701),K=a.i(35732),L=a.i(86304),M=a.i(56025);function N(){let a=(0,d.useRouter)(),{user:u}=(0,M.useAuth)(),{villages:w,classes:x,selectedYear:y}=(0,B.useMasterData)(),[z,A]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!u)return;let a=(0,e.onSnapshot)((0,e.doc)(f.db,"users",u.uid),a=>{a.exists()&&A(a.data().role)});return()=>a()},[u]);let[E,F]=(0,c.useState)([]),[G,N]=(0,c.useState)([]),[O,P]=(0,c.useState)(!0),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)("all"),[U,V]=(0,c.useState)("all"),[W,X]=(0,c.useState)("all"),Y=Object.values(w||{}).map(a=>({id:a.id,name:a.name})).sort((a,b)=>a.name.localeCompare(b.name)),Z=Object.values(x||{}).map(a=>({id:a.id,name:a.name,order:a.order||99})).sort((a,b)=>a.order-b.order),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(null),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{let a=!0,b=ag?(0,e.query)((0,e.collection)(f.db,"students"),(0,e.limit)(1e3)):(0,e.query)((0,e.collection)(f.db,"students"),(0,e.orderBy)("createdAt","desc"),(0,e.limit)(1e3)),c=(0,e.onSnapshot)(b,b=>{if(!a)return;let c=b.docs.map(a=>({id:a.id,studentDocId:a.id,...a.data()}));ag&&(c=c.sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0))),F(c),P(!1)},b=>{a&&(b.message.includes("index")&&!ag?ah(!0):(console.error("Student list error:",b),P(!1)))});return()=>{a=!1,c()}},[ag]),(0,c.useEffect)(()=>{let a=E;if(y&&(a=a.filter(a=>(a.academicYear||"2025-2026")===y)),"all"!==S&&(a=a.filter(a=>a.status===S)),"all"!==W&&(a=a.filter(a=>a.classId===W||a.className===W)),"all"!==U&&(a=a.filter(a=>a.villageId===U||a.villageName===U)),Q.trim()){let b=Q.toLowerCase().trim();a=a.filter(a=>a.studentName?.toLowerCase().includes(b)||a.schoolId?.toLowerCase().includes(b)||a.parentName?.toLowerCase().includes(b)||a.parentMobile?.includes(b))}N(a)},[Q,S,U,W,E,y]),(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6 animate-in fade-in duration-500 max-w-7xl mx-auto p-1 md:p-6 pb-20",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between pt-2 md:pt-4 gap-4 md:gap-6 px-1 md:px-0",children:[(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,b.jsx)("h1",{className:"text-2xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic leading-tight",children:"Student Directory"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-[10px] md:text-lg tracking-tight uppercase font-black opacity-50",children:["Managing ",(0,b.jsxs)("span",{className:"text-white",children:[E.length," enrolled students"]})," across all grades"]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 md:gap-2",children:[(0,b.jsx)(I,{students:G}),"MANAGER"!==z&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C,{onSuccess:()=>{window.location.reload()}}),(0,b.jsx)(g.AddStudentModal,{})]})]})]}),(0,b.jsxs)("div",{className:"bg-black/20 p-3 md:p-5 rounded-xl md:rounded-2xl border border-white/10 backdrop-blur-md space-y-3 md:space-y-4 shadow-2xl mx-0",children:[(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsx)(k.Search,{className:"absolute left-3 md:left-4 top-1/2 -translate-y-1/2 w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"}),(0,b.jsx)(t.Input,{placeholder:"Search name, ID, or mobile...",className:"pl-9 md:pl-11 h-10 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl focus:ring-accent/30 text-xs md:text-sm",value:Q,onChange:a=>R(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:flex lg:flex-wrap gap-1.5 md:gap-2",children:[(0,b.jsxs)(J.Select,{value:S,onValueChange:T,children:[(0,b.jsx)(J.SelectTrigger,{className:"w-full lg:w-[160px] h-9 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl text-xs md:text-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Filter,{size:12,className:"text-white/40"}),(0,b.jsx)(J.SelectValue,{placeholder:"Status"})]})}),(0,b.jsxs)(J.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,b.jsx)(J.SelectItem,{value:"all",children:"All Status"}),(0,b.jsx)(J.SelectItem,{value:"ACTIVE",children:"Active"}),(0,b.jsx)(J.SelectItem,{value:"INACTIVE",children:"Inactive"})]})]}),(0,b.jsxs)(J.Select,{value:W,onValueChange:X,children:[(0,b.jsx)(J.SelectTrigger,{className:"w-full lg:w-[160px] h-9 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl text-xs md:text-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(s.BookOpen,{size:12,className:"text-white/40"}),(0,b.jsx)(J.SelectValue,{placeholder:"Class"})]})}),(0,b.jsxs)(J.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,b.jsx)(J.SelectItem,{value:"all",children:"All Classes"}),Z.map(a=>(0,b.jsx)(J.SelectItem,{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)(J.Select,{value:U,onValueChange:V,children:[(0,b.jsx)(J.SelectTrigger,{className:"w-full lg:w-[180px] h-9 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl text-xs md:text-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.MapPin,{size:12,className:"text-white/40"}),(0,b.jsx)(J.SelectValue,{placeholder:"Village"})]})}),(0,b.jsxs)(J.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,b.jsx)(J.SelectItem,{value:"all",children:"All Villages"}),Y.map(a=>(0,b.jsx)(J.SelectItem,{value:a.id,children:a.name},a.id))]})]}),(Q||"all"!==S||"all"!==W||"all"!==U)&&(0,b.jsx)(v.Button,{variant:"ghost",size:"sm",onClick:()=>{R(""),T("all"),X("all"),V("all")},className:"h-9 md:h-12 px-3 md:px-6 text-[8px] md:text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-white rounded-lg md:rounded-xl border border-dashed border-white/10 transition-all col-span-2 md:col-span-1",children:"Clear Filters"})]})]}),O?(0,b.jsx)("div",{className:"flex justify-center p-20 animate-pulse",children:(0,b.jsx)(o.Loader2,{className:"w-12 h-12 animate-spin text-accent"})}):(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsx)(D.DataTable,{data:G,isLoading:O,onRowClick:b=>a.push(`/admin/students/${b.schoolId}`),columns:[{key:"studentInfo",header:"Student Info",render:a=>(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-9 h-9 rounded-xl bg-white/5 flex items-center justify-center border border-white/5 group-hover:border-accent/30 transition-colors",children:(0,b.jsx)(p.User,{size:16,className:"text-white/40 group-hover:text-accent transition-colors"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-bold text-sm text-white group-hover:text-accent transition-colors leading-tight",children:a.studentName}),(0,b.jsxs)("span",{className:"text-[10px] font-mono text-white/40 tracking-tighter uppercase",children:["ID: ",a.schoolId]})]})]})},{key:"classPlacement",header:"Class & Placement",render:a=>(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-[10px] uppercase font-black text-white/60 tracking-tighter bg-white/5 px-2 py-0.5 rounded border border-white/5 w-fit",children:a.className}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-white/30",children:[(0,b.jsx)(q.MapPin,{size:10,className:"opacity-40"}),(0,b.jsx)("span",{className:"truncate max-w-[120px]",children:a.villageName})]})]})},{key:"parentDetails",header:"Parent Details",render:a=>(0,b.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,b.jsx)("span",{className:"text-xs font-bold text-white/80",children:a.parentName}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-white/40",children:[(0,b.jsx)(r.Phone,{size:10,className:"opacity-40"}),(0,b.jsx)("span",{className:"font-mono",children:a.parentMobile})]})]})},{key:"credentials",header:"Login Credentials",render:a=>(0,b.jsx)("div",{className:"flex flex-col gap-0.5",children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-amber-400 font-bold",children:[(0,b.jsx)(m.Key,{size:10,className:"opacity-60"}),(0,b.jsxs)("span",{className:"uppercase tracking-tighter",children:["Pass: ",a.recoveryPassword||a.parentMobile]})]})})},{key:"status",header:"Status",cellClassName:"text-center",render:a=>(0,b.jsx)(L.Badge,{className:(0,H.cn)("text-[9px] font-black uppercase tracking-tighter py-0 h-5 border-none transition-all","ACTIVE"===a.status?"bg-emerald-500/10 text-emerald-400":"bg-red-500/10 text-red-400"),children:a.status})},{key:"management",header:"Management",cellClassName:"text-right",render:a=>(0,b.jsx)("div",{className:"flex items-center justify-end gap-1",onClick:a=>a.stopPropagation(),children:("ADMIN"===z||"MANAGER"===z)&&(0,b.jsxs)(K.DropdownMenu,{children:[(0,b.jsx)(K.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(v.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-lg hover:bg-white/10",children:(0,b.jsx)(l.MoreHorizontal,{size:14})})}),(0,b.jsxs)(K.DropdownMenuContent,{align:"end",className:"bg-zinc-900 border-white/10 text-white min-w-[160px] p-1.5 rounded-xl shadow-2xl",children:[(0,b.jsxs)(K.DropdownMenuItem,{onClick:()=>{a.uid?(ad({uid:a.uid,schoolId:a.schoolId,name:a.studentName,role:"STUDENT"}),af(!0)):alert("UID Missing")},className:"rounded-lg gap-2 text-xs font-bold text-amber-500 hover:text-amber-400 transition-colors",children:[(0,b.jsx)(m.Key,{size:14})," Reset Password"]}),"ADMIN"===z&&(0,b.jsxs)(K.DropdownMenuItem,{onClick:()=>{_(a),ab(!0)},className:"rounded-lg gap-2 text-xs font-bold text-red-500 hover:text-red-400 transition-colors",children:[(0,b.jsx)(n.Trash2,{size:14})," Delete Student"]})]})]})})}]})}),(0,b.jsx)(i.AdminChangePasswordModal,{isOpen:ae,onClose:()=>af(!1),user:ac,onSuccess:()=>{window.location.reload()}}),$&&(0,b.jsx)(h.DeleteUserModal,{isOpen:aa,onClose:()=>{ab(!1),_(null)},user:{id:$.schoolId,schoolId:$.schoolId,name:$.studentName,role:"student"},checkEligibility:async()=>{let a=(0,e.query)((0,e.collection)(f.db,"payments"),(0,e.where)("studentId","==",$.schoolId),(0,e.limit)(1));return(await (0,e.getDocs)(a)).empty?{canDelete:!0}:{canDelete:!1,reason:"Payments exist."}},onDeactivate:async a=>{$&&await (0,e.updateDoc)((0,e.doc)(f.db,"students",$.studentDocId||$.schoolId),{status:"INACTIVE",deactivationReason:a,updatedAt:new Date().toISOString()})},onDelete:async a=>{if(!$)return;if(!u)return void alert("You are not authenticated");let b=await u.getIdToken(),c=await fetch("/api/admin/users/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({targetUid:$.uid,schoolId:$.schoolId,role:"STUDENT",collectionName:"students"})}),d=await c.json();if(!d.success)throw Error(d.error||"Delete failed")}})]})}a.s(["default",()=>N],4668)}];

//# sourceMappingURL=src_app_admin_students_page_tsx_f3529840._.js.map