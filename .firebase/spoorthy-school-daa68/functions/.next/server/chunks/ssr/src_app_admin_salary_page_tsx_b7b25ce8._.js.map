{"version":3,"sources":["../../../../src/app/admin/salary/page.tsx","../../../../src/components/admin/pay-salary-modal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { collection, getDocs, query, where, documentId } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { Loader2, Download, Search, CheckCircle2 } from \"lucide-react\";\r\nimport { PaySalaryModal } from \"@/components/admin/pay-salary-modal\";\r\nimport { DataTable } from \"@/components/ui/data-table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { useMasterData } from \"@/context/MasterDataContext\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport default function SalaryPage() {\r\n    const { branding } = useMasterData();\r\n    const [loading, setLoading] = useState(true);\r\n    const [employees, setEmployees] = useState<any[]>([]);\r\n    const [payments, setPayments] = useState<any[]>([]);\r\n    const [leavesMap, setLeavesMap] = useState<Record<string, number>>({});\r\n\r\n    // Filters\r\n    const [month, setMonth] = useState(new Date().toLocaleString('default', { month: 'long' }));\r\n    const [year, setYear] = useState(new Date().getFullYear().toString());\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n    const [filterRole, setFilterRole] = useState(\"ALL\"); // ALL, TEACHER, STAFF\r\n    const [filterStatus, setFilterStatus] = useState(\"ALL\"); // ALL, PAID, UNPAID\r\n\r\n    // Modal State\r\n    const [selectedEmployee, setSelectedEmployee] = useState<any>(null);\r\n    const [selectedPayment, setSelectedPayment] = useState<any>(null);\r\n    const [selectedPaidAmount, setSelectedPaidAmount] = useState(0);\r\n    const [isPayModalOpen, setIsPayModalOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [month, year]);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // 1. Fetch Teachers\r\n            const tSnap = await getDocs(query(collection(db, \"teachers\"), where(\"status\", \"==\", \"ACTIVE\")));\r\n            const teachers = tSnap.docs.map(doc => {\r\n                const data = doc.data();\r\n                return {\r\n                    id: doc.id,\r\n                    ...data,\r\n                    personType: \"TEACHER\",\r\n                    roleDisplay: \"Teacher\",\r\n                    baseSalary: data.baseSalary || data.salary\r\n                };\r\n            });\r\n\r\n            // 2. Fetch Staff\r\n            const sSnap = await getDocs(collection(db, \"staff\"));\r\n            const staff = sSnap.docs.map(doc => {\r\n                const data = doc.data();\r\n                return {\r\n                    id: doc.id,\r\n                    ...data,\r\n                    personType: \"STAFF\",\r\n                    roleDisplay: data.roleName || \"Staff\",\r\n                    baseSalary: data.baseSalary || data.salary\r\n                };\r\n            });\r\n\r\n            const allEmployees = [...teachers, ...staff].sort((a: any, b: any) => a.name.localeCompare(b.name));\r\n            setEmployees(allEmployees);\r\n\r\n            // 3. Fetch Payments\r\n            const pQuery = query(\r\n                collection(db, \"salary_payments\"),\r\n                where(\"month\", \"==\", month),\r\n                where(\"year\", \"==\", year)\r\n            );\r\n            const pSnap = await getDocs(pQuery);\r\n            const paymentData = pSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setPayments(paymentData);\r\n\r\n            // 4. Fetch Teacher Attendance for Leaves\r\n            const monthIndex = new Date(`${month} 1, 2000`).getMonth() + 1;\r\n            const monthStr = String(monthIndex).padStart(2, '0');\r\n            const startDate = `${year}-${monthStr}-01`;\r\n            const endDate = `${year}-${monthStr}-31`;\r\n\r\n            const attQuery = query(\r\n                collection(db, \"attendance\"),\r\n                where(documentId(), \">=\", `TEACHERS_${startDate}`),\r\n                where(documentId(), \"<=\", `TEACHERS_${endDate}`)\r\n            );\r\n            const attSnap = await getDocs(attQuery);\r\n            const counts: Record<string, number> = {};\r\n\r\n            attSnap.forEach(doc => {\r\n                const data = doc.data();\r\n                if (data.records) {\r\n                    Object.entries(data.records).forEach(([schoolId, status]) => {\r\n                        if (status === 'A') {\r\n                            counts[schoolId] = (counts[schoolId] || 0) + 1;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            // 5. Fetch Staff Attendance for Leaves\r\n            const staffAttQuery = query(\r\n                collection(db, \"attendance\"),\r\n                where(documentId(), \">=\", `STAFF_${startDate}`),\r\n                where(documentId(), \"<=\", `STAFF_${endDate}`)\r\n            );\r\n            const staffAttSnap = await getDocs(staffAttQuery);\r\n            staffAttSnap.forEach(doc => {\r\n                const data = doc.data();\r\n                if (data.records) {\r\n                    Object.entries(data.records).forEach(([schoolId, status]) => {\r\n                        if (status === 'A') {\r\n                            counts[schoolId] = (counts[schoolId] || 0) + 1;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            setLeavesMap(counts);\r\n\r\n        } catch (error) {\r\n            console.error(\"Error fetching payroll data:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const getEmployeePayments = (empId: string) => {\r\n        return payments.filter(p => p.personId === empId);\r\n    };\r\n\r\n    const handlePayClick = (emp: any, payment?: any, paidSoFar: number = 0) => {\r\n        setSelectedEmployee(emp);\r\n        setSelectedPayment(payment || null);\r\n        setSelectedPaidAmount(paidSoFar);\r\n        setIsPayModalOpen(true);\r\n    };\r\n\r\n    // Filter Logic\r\n    const filteredEmployees = employees.filter(emp => {\r\n        const matchesSearch = emp.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            (emp.schoolId && emp.schoolId.toLowerCase().includes(searchTerm.toLowerCase()));\r\n\r\n        const matchesRole = filterRole === \"ALL\" || emp.personType === filterRole;\r\n\r\n        const empPayments = getEmployeePayments(emp.id);\r\n        const totalPaid = empPayments.reduce((s, p) => s + (Number(p.amount) || 0), 0);\r\n        const totalDeductions = empPayments.reduce((s, p) => s + (Number(p.deductions) || 0), 0);\r\n        const isFullyPaid = (emp.baseSalary || 0) > 0 && (totalPaid + totalDeductions) >= (emp.baseSalary || 0);\r\n\r\n        const matchesStatus = filterStatus === \"ALL\" ||\r\n            (filterStatus === \"PAID\" && isFullyPaid) ||\r\n            (filterStatus === \"UNPAID\" && !isFullyPaid);\r\n\r\n        return matchesSearch && matchesRole && matchesStatus;\r\n    });\r\n\r\n    const totalPayroll = payments.reduce((sum, p) => sum + (Number(p.amount) || 0), 0);\r\n\r\n    let paidCount = 0;\r\n    employees.forEach(emp => {\r\n        const empPayments = getEmployeePayments(emp.id);\r\n        const totalPaid = empPayments.reduce((s, p) => s + (Number(p.amount) || 0), 0);\r\n        const totalDeductions = empPayments.reduce((s, p) => s + (Number(p.deductions) || 0), 0);\r\n        if ((emp.baseSalary || 0) > 0 && (totalPaid + totalDeductions) >= (emp.baseSalary || 0)) paidCount++;\r\n    });\r\n\r\n    const unpaidCount = employees.length - paidCount;\r\n\r\n    const handlePrint = () => {\r\n        const printContent = `\r\n            <html>\r\n                <head>\r\n                    <title>Payroll Report - ${month} ${year}</title>\r\n                    <style>\r\n                        body { font-family: sans-serif; padding: 20px; }\r\n                        table { width: 100%; border-collapse: collapse; }\r\n                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }\r\n                        th { background-color: #f2f2f2; font-weight: bold; }\r\n                        .status-paid { color: green; font-weight: bold; }\r\n                        .status-unpaid { color: orange; font-weight: bold; }\r\n                        .header-row { border: none !important; background: white !important; }\r\n                        .header-cell { border: none !important; padding: 20px 0; text-align: center; }\r\n                        .print-header { display: flex; align-items: center; justify-content: center; gap: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 10px; }\r\n                        .school-logo { height: 80px; width: auto; object-fit: contain; }\r\n                        .school-details { text-align: left; }\r\n                        @media print {\r\n                            thead { display: table-header-group; }\r\n                            tr { page-break-inside: avoid; }\r\n                        }\r\n                    </style>\r\n                </head>\r\n                <body>\r\n                    <table>\r\n                        <thead>\r\n                            <tr class=\"header-row\">\r\n                                <th colspan=\"9\" class=\"header-cell\">\r\n                                    <div class=\"print-header\">\r\n                                        ${branding?.schoolLogo ? `<img src=\"${branding.schoolLogo}\" class=\"school-logo\" onload=\"window.print();\" onerror=\"window.print();\" />` : ''}\r\n                                        <div class=\"school-details\">\r\n                                            <h1 style=\"margin: 0; font-size: 24px; text-transform: uppercase;\">${branding?.schoolName || 'Payroll Report'}</h1>\r\n                                            ${branding?.address ? `<div style=\"font-size: 14px; color: #666; margin-top: 5px;\">${branding.address}</div>` : ''}\r\n                                            <h2 style=\"margin: 10px 0 0 0; font-size: 18px; color: #444;\">Monthly Payroll - ${month} ${year}</h2>\r\n                                        </div>\r\n                                    </div>\r\n                                </th>\r\n                            </tr>\r\n                            <tr>\r\n                                <th>Name</th>\r\n                                <th>ID</th>\r\n                                <th>Role</th>\r\n                                <th>Leaves</th>\r\n                                <th>Base Salary</th>\r\n                                <th>Deductions</th>\r\n                                <th>Bonuses</th>\r\n                                <th>Paid Amount (Net)</th>\r\n                                <th>Status</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            ${filteredEmployees.map(emp => {\r\n            const empPayments = getEmployeePayments(emp.id);\r\n            const totalPaid = empPayments.reduce((s, p) => s + (Number(p.amount) || 0), 0);\r\n            const totalDeductions = empPayments.reduce((s, p) => s + (Number(p.deductions) || 0), 0);\r\n            const isFullyPaid = (emp.baseSalary || 0) > 0 && (totalPaid + totalDeductions) >= (emp.baseSalary || 0);\r\n            const leaves = leavesMap[emp.schoolId] || 0;\r\n            return `\r\n                                    <tr>\r\n                                        <td>${emp.name}</td>\r\n                                        <td>${emp.schoolId}</td>\r\n                                        <td>${emp.roleDisplay}</td>\r\n                                        <td>${leaves}</td>\r\n                                        <td>${emp.baseSalary || '-'}</td>\r\n                                        <td>${empPayments.reduce((s, p) => s + (p.deductions || 0), 0) || '-'}</td>\r\n                                        <td>${empPayments.reduce((s, p) => s + (p.bonuses || 0), 0) || '-'}</td>\r\n                                        <td style=\"font-weight: bold;\">${totalPaid ? '₹' + Number(totalPaid).toLocaleString() : '-'}</td>\r\n                                        <td class=\"${isFullyPaid ? 'status-paid' : 'status-unpaid'}\">${isFullyPaid ? 'PAID' : 'PENDING'}</td>\r\n                                    </tr>\r\n                                `;\r\n        }).join('')}\r\n                        </tbody>\r\n                    </table>\r\n                    <script>\r\n                        // Fallback in case image onload doesn't fire or no image\r\n                        if (!document.querySelector('img')) {\r\n                            window.print();\r\n                        } else {\r\n                            setTimeout(() => {\r\n                                // If print hasn't happened yet (e.g. image stuck)\r\n                                // We can't easily detect if print dialog opened, but this is a safety net\r\n                                // Actually, simpler to just rely on onload/onerror for image\r\n                            }, 2000);\r\n                        }\r\n                    </script>\r\n                </body>\r\n            </html>\r\n        `;\r\n        const win = window.open('', '', 'width=900,height=700');\r\n        if (win) {\r\n            win.document.write(printContent);\r\n            win.document.close();\r\n            // Note: window.print() is called by the image onload/onerror handlers or the script\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4 md:space-y-6 animate-in fade-in duration-500 max-w-none p-0 pb-20\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between pt-2 md:pt-4 gap-4 md:gap-6 px-1 md:px-0\">\r\n                <div>\r\n                    <h1 className=\"text-2xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic leading-tight\">\r\n                        Payroll Center\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground text-sm md:text-lg tracking-tight\">Managing staff disbursements for <span className=\"text-white font-bold\">{month} {year}</span></p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap items-center gap-2 md:gap-3\">\r\n                    <Select value={month} onValueChange={setMonth}>\r\n                        <SelectTrigger className=\"w-[120px] md:w-[140px] bg-black/40 border-white/10 rounded-xl h-9 md:h-11 text-xs md:text-sm\">\r\n                            <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-zinc-900 border-white/10 text-white\">\r\n                            {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map(m => (\r\n                                <SelectItem key={m} value={m}>{m}</SelectItem>\r\n                            ))}\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Input\r\n                        value={year}\r\n                        onChange={e => setYear(e.target.value)}\r\n                        className=\"w-[80px] md:w-[100px] bg-black/40 border-white/10 text-center rounded-xl h-9 md:h-11 font-mono font-bold text-xs md:text-sm\"\r\n                    />\r\n\r\n                    <Button variant=\"outline\" className=\"h-9 md:h-11 gap-2 border-white/10 bg-white/5 rounded-xl hover:bg-white/10 px-3 md:px-4 text-xs md:text-sm\" onClick={handlePrint}>\r\n                        <Download size={14} className=\"md:w-4 md:h-4\" /> <span className=\"hidden sm:inline\">Print Report</span><span className=\"sm:hidden\">Print</span>\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Overview */}\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 px-2 md:px-0\">\r\n                <div className=\"bg-emerald-500/5 border border-emerald-500/10 p-4 md:p-5 rounded-2xl backdrop-blur-sm shadow-xl flex sm:flex-col justify-between items-center sm:items-start\">\r\n                    <p className=\"text-xs md:text-[10px] font-black uppercase tracking-widest text-emerald-400 italic\">Total Disbursed</p>\r\n                    <div className=\"text-2xl md:text-3xl font-mono font-black text-white\">₹{totalPayroll.toLocaleString()}</div>\r\n                </div>\r\n                <div className=\"bg-blue-500/5 border border-blue-500/10 p-4 md:p-5 rounded-2xl backdrop-blur-sm shadow-xl flex sm:flex-col justify-between items-center sm:items-start\">\r\n                    <p className=\"text-xs md:text-[10px] font-black uppercase tracking-widest text-blue-400 italic\">Accounts Paid</p>\r\n                    <div className=\"text-2xl md:text-3xl font-mono font-black text-white\">{paidCount} <span className=\"text-xs md:text-xs text-blue-400/50\">Staff</span></div>\r\n                </div>\r\n                <div className=\"bg-orange-500/5 border border-orange-500/10 p-4 md:p-5 rounded-2xl backdrop-blur-sm shadow-xl flex sm:flex-col justify-between items-center sm:items-start\">\r\n                    <p className=\"text-xs md:text-[10px] font-black uppercase tracking-widest text-orange-400 italic\">Outstanding</p>\r\n                    <div className=\"text-2xl md:text-3xl font-mono font-black text-white\">{unpaidCount} <span className=\"text-xs md:text-xs text-orange-400/50\">Pending</span></div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filter Section */}\r\n            <div className=\"bg-black/20 p-3 md:p-5 rounded-2xl border border-white/10 backdrop-blur-md space-y-3 md:space-y-4 shadow-2xl mx-2 md:mx-0\">\r\n                <div className=\"flex flex-col md:flex-row gap-2 md:gap-4\">\r\n                    <div className=\"relative flex-1\">\r\n                        <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground\" />\r\n                        <Input\r\n                            value={searchTerm}\r\n                            onChange={e => setSearchTerm(e.target.value)}\r\n                            placeholder=\"Find by name or staff ID...\"\r\n                            className=\"pl-10 md:pl-11 h-10 md:h-12 bg-white/5 border-white/10 rounded-xl focus:ring-accent/30 text-xs md:text-sm\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 lg:flex gap-2\">\r\n                        <Select value={filterRole} onValueChange={setFilterRole}>\r\n                            <SelectTrigger className=\"w-full md:w-[150px] h-10 md:h-12 bg-white/5 border-white/10 rounded-xl text-xs md:text-sm\">\r\n                                <SelectValue placeholder=\"All Roles\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"bg-zinc-900 border-white/10 text-white\">\r\n                                <SelectItem value=\"ALL\">All Roles</SelectItem>\r\n                                <SelectItem value=\"TEACHER\">Teachers</SelectItem>\r\n                                <SelectItem value=\"STAFF\">Helpers</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n\r\n                        <Select value={filterStatus} onValueChange={setFilterStatus}>\r\n                            <SelectTrigger className=\"w-full md:w-[150px] h-10 md:h-12 bg-white/5 border-white/10 rounded-xl text-xs md:text-sm\">\r\n                                <SelectValue placeholder=\"All Status\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"bg-zinc-900 border-white/10 text-white\">\r\n                                <SelectItem value=\"ALL\">All Status</SelectItem>\r\n                                <SelectItem value=\"PAID\">Disbursed</SelectItem>\r\n                                <SelectItem value=\"UNPAID\">Pending</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"flex justify-center p-20 animate-pulse\"><Loader2 className=\"w-12 h-12 animate-spin text-accent\" /></div>\r\n            ) : (\r\n                <div className=\"space-y-4\">\r\n                    <DataTable\r\n                        data={filteredEmployees}\r\n                        isLoading={loading}\r\n                        columns={[\r\n                            {\r\n                                key: \"employeeInfo\",\r\n                                header: \"Employee Info\",\r\n                                render: (emp) => (\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"font-bold text-[13px] md:text-sm text-white group-hover:text-accent transition-colors leading-tight\">{emp.name}</span>\r\n                                        <span className=\"text-[9px] md:text-[10px] font-mono text-white/60 tracking-tighter uppercase\">{emp.schoolId}</span>\r\n                                        <span className=\"text-[7px] md:text-[8px] text-white/50 mt-0.5 md:mt-1 uppercase font-black\">Base: ₹{Number(emp.baseSalary || 0).toLocaleString()}</span>\r\n                                    </div>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"role\",\r\n                                header: \"Role\",\r\n                                render: (emp) => (\r\n                                    <span className=\"text-[9px] md:text-[10px] uppercase font-black text-muted-foreground tracking-tighter bg-white/5 px-2 py-0.5 rounded border border-white/5\">{emp.roleDisplay}</span>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"absents\",\r\n                                header: \"Absents\",\r\n                                cellClassName: \"text-center\",\r\n                                render: (emp) => {\r\n                                    const leaves = leavesMap[emp.schoolId] || 0;\r\n                                    return (\r\n                                        <span className={cn(\r\n                                            \"font-black text-xs md:text-sm\",\r\n                                            leaves > 0 ? \"text-orange-400\" : \"text-emerald-400/30\"\r\n                                        )}>\r\n                                            {leaves}\r\n                                        </span>\r\n                                    );\r\n                                }\r\n                            },\r\n                            {\r\n                                key: \"payments\",\r\n                                header: \"Month Payments\",\r\n                                render: (emp) => {\r\n                                    const empPayments = getEmployeePayments(emp.id);\r\n                                    const totalPaid = empPayments.reduce((s: number, p: any) => s + (Number(p.amount) || 0), 0);\r\n                                    const totalDeductions = empPayments.reduce((s: number, p: any) => s + (Number(p.deductions) || 0), 0);\r\n                                    const isFullyPaid = (emp.baseSalary || 0) > 0 && (totalPaid + totalDeductions) >= (emp.baseSalary || 0);\r\n\r\n                                    return (\r\n                                        <div className=\"flex flex-wrap gap-1 md:gap-1.5 min-w-[120px] md:min-w-[140px]\">\r\n                                            {empPayments.map(p => (\r\n                                                <Badge\r\n                                                    key={p.id}\r\n                                                    variant=\"outline\"\r\n                                                    className=\"cursor-pointer hover:bg-white/10 transition-colors gap-1 px-1.5 md:px-2 border-white/10 bg-white/5 py-0 md:py-0.5\"\r\n                                                    onClick={() => handlePayClick(emp, p)}\r\n                                                >\r\n                                                    <span className=\"text-[8px] md:text-[9px] font-bold text-emerald-400\">₹{p.amount}</span>\r\n                                                    <span className=\"text-[6px] md:text-[7px] opacity-40 uppercase font-black\">{p.type || 'S'}</span>\r\n                                                </Badge>\r\n                                            ))}\r\n                                            {!isFullyPaid && (\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    variant=\"ghost\"\r\n                                                    className=\"h-5 md:h-6 px-2 md:px-3 text-[8px] md:text-[9px] rounded-lg bg-[#64FFDA]/10 text-[#64FFDA] hover:bg-[#64FFDA] hover:text-[#0A192F] font-black uppercase tracking-tighter transition-all\"\r\n                                                    onClick={() => handlePayClick(emp, undefined, totalPaid)}\r\n                                                >\r\n                                                    Pay Now\r\n                                                </Button>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                }\r\n                            },\r\n                            {\r\n                                key: \"disbursement\",\r\n                                header: \"Net Disbursement\",\r\n                                cellClassName: \"text-right\",\r\n                                render: (emp) => {\r\n                                    const empPayments = getEmployeePayments(emp.id);\r\n                                    const totalPaid = empPayments.reduce((s: number, p: any) => s + (Number(p.amount) || 0), 0);\r\n                                    const totalDeductions = empPayments.reduce((s: number, p: any) => s + (Number(p.deductions) || 0), 0);\r\n                                    const isFullyPaid = (emp.baseSalary || 0) > 0 && (totalPaid + totalDeductions) >= (emp.baseSalary || 0);\r\n\r\n                                    return (\r\n                                        <div className=\"flex flex-col items-end\">\r\n                                            <div className=\"flex items-center gap-1.5 md:gap-2\">\r\n                                                <span className={cn(\r\n                                                    \"font-mono font-black text-base md:text-lg transition-colors\",\r\n                                                    isFullyPaid ? \"text-emerald-400\" : (totalPaid > 0 ? \"text-blue-400 font-bold\" : \"text-white/20\")\r\n                                                )}>\r\n                                                    ₹{Number(totalPaid).toLocaleString()}\r\n                                                </span>\r\n                                                {isFullyPaid && <CheckCircle2 className=\"w-3 md:w-3.5 h-3 md:h-3.5 text-emerald-500\" strokeWidth={3} />}\r\n                                            </div>\r\n                                            {!isFullyPaid && emp.baseSalary && (totalPaid > 0 || totalDeductions > 0) && (\r\n                                                <span className=\"text-[8px] md:text-[9px] font-black text-orange-500 uppercase italic\">Due: ₹{Number(Math.max(0, emp.baseSalary - totalPaid - totalDeductions)).toLocaleString()}</span>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                }\r\n                            }\r\n                        ]}\r\n                    />\r\n                </div>\r\n            )}\r\n\r\n            <PaySalaryModal\r\n                isOpen={isPayModalOpen}\r\n                onClose={() => setIsPayModalOpen(false)}\r\n                employee={selectedEmployee}\r\n                payment={selectedPayment}\r\n                paidAmount={selectedPaidAmount}\r\n                leavesCount={selectedEmployee ? (leavesMap[selectedEmployee.schoolId] || 0) : 0}\r\n                defaultMonth={month}\r\n                defaultYear={year}\r\n                onSuccess={() => fetchData()}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Loader2, DollarSign } from \"lucide-react\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\n\r\ninterface PaySalaryModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    employee: {\r\n        id: string;\r\n        name: string;\r\n        personType: \"TEACHER\" | \"STAFF\";\r\n        baseSalary?: number;\r\n        schoolId?: string;\r\n    } | null;\r\n    payment?: any; // Existing payment record for editing\r\n    paidAmount?: number; // Total amount already paid for this month\r\n    leavesCount?: number;\r\n    defaultMonth?: string;\r\n    defaultYear?: string;\r\n    onSuccess: () => void;\r\n}\r\n\r\nexport function PaySalaryModal({\r\n    isOpen,\r\n    onClose,\r\n    employee,\r\n    payment,\r\n    paidAmount = 0,\r\n    leavesCount = 0,\r\n    defaultMonth,\r\n    defaultYear,\r\n    onSuccess\r\n}: PaySalaryModalProps) {\r\n    const { user } = useAuth();\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const [payForm, setPayForm] = useState({\r\n        month: new Date().toLocaleString('default', { month: 'long' }),\r\n        year: new Date().getFullYear().toString(),\r\n        amount: \"\",\r\n        deductions: \"\",\r\n        bonuses: \"\",\r\n        method: \"CASH\",\r\n        notes: \"\",\r\n        type: \"SALARY\"\r\n    });\r\n    const [deleting, setDeleting] = useState(false);\r\n\r\n    // Reset or update form when employee or payment changes\r\n    useEffect(() => {\r\n        if (employee && isOpen) {\r\n            if (payment) {\r\n                setPayForm({\r\n                    month: payment.month,\r\n                    year: payment.year,\r\n                    amount: payment.baseAmount?.toString() || payment.amount?.toString() || \"\",\r\n                    deductions: payment.deductions?.toString() || \"0\",\r\n                    bonuses: payment.bonuses?.toString() || \"0\",\r\n                    method: payment.method || \"CASH\",\r\n                    notes: payment.notes || \"\",\r\n                    type: payment.type || \"SALARY\"\r\n                });\r\n            } else {\r\n                // For new payment, default to remaining balance\r\n                const balance = Math.max(0, (employee.baseSalary || 0) - paidAmount);\r\n                setPayForm({\r\n                    month: defaultMonth || new Date().toLocaleString('default', { month: 'long' }),\r\n                    year: defaultYear || new Date().getFullYear().toString(),\r\n                    amount: balance > 0 ? balance.toString() : \"\",\r\n                    deductions: \"\",\r\n                    bonuses: \"\",\r\n                    method: \"CASH\",\r\n                    notes: \"\",\r\n                    type: \"SALARY\"\r\n                });\r\n            }\r\n        }\r\n    }, [employee, payment, paidAmount, isOpen, defaultMonth, defaultYear]);\r\n\r\n    const handleOpenChange = (open: boolean) => {\r\n        if (!open) {\r\n            onClose();\r\n        }\r\n    };\r\n\r\n    const handlePaySalary = async () => {\r\n        if (!employee) return;\r\n        setLoading(true);\r\n        try {\r\n            const baseAmount = Number(payForm.amount);\r\n            if (!baseAmount && baseAmount !== 0) throw new Error(\"Base Amount is required\");\r\n\r\n            const token = await user?.getIdToken();\r\n            const res = await fetch(\"/api/admin/payroll/process\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"Authorization\": `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    paymentId: payment?.id,\r\n                    personId: employee.id,\r\n                    personType: employee.personType,\r\n                    ...payForm,\r\n                    amount: baseAmount,\r\n                    deductions: Number(payForm.deductions) || 0,\r\n                    bonuses: Number(payForm.bonuses) || 0,\r\n                    leavesCount\r\n                })\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.error || \"Failed to process payment\");\r\n\r\n            alert(payment ? \"Payment Updated Successfully!\" : \"Payment Recorded Successfully!\");\r\n            onSuccess();\r\n            onClose();\r\n        } catch (error: any) {\r\n            console.error(error);\r\n            alert(error.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!payment?.id || !confirm(\"Are you sure you want to delete this payment record?\")) return;\r\n        setDeleting(true);\r\n        try {\r\n            const token = await user?.getIdToken();\r\n            const res = await fetch(\"/api/admin/payroll/delete\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"Authorization\": `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({ paymentId: payment.id })\r\n            });\r\n\r\n            if (!res.ok) throw new Error(\"Failed to delete payment\");\r\n\r\n            alert(\"Payment Record Deleted\");\r\n            onSuccess();\r\n            onClose();\r\n        } catch (error: any) {\r\n            alert(error.message);\r\n        } finally {\r\n            setDeleting(false);\r\n        }\r\n    };\r\n\r\n    if (!employee) return null;\r\n\r\n    const baseAmount = Number(payForm.amount) || 0;\r\n    const deductions = Number(payForm.deductions) || 0;\r\n    const bonuses = Number(payForm.bonuses) || 0;\r\n    const netPay = baseAmount - deductions + bonuses;\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={handleOpenChange}>\r\n            <DialogContent className=\"bg-black/95 border-white/10 text-white sm:max-w-[500px]\">\r\n                <DialogHeader className=\"pb-2 border-b border-white/5\">\r\n                    <DialogTitle className=\"flex items-center gap-2\">\r\n                        <div className=\"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center\">\r\n                            <DollarSign className=\"w-4 h-4 text-emerald-500\" />\r\n                        </div>\r\n                        <div>\r\n                            <div>{payment ? \"Edit Payment\" : \"Add Payment\"}</div>\r\n                            <div className=\"text-xs text-muted-foreground font-normal\">{employee.name}</div>\r\n                        </div>\r\n                    </DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"max-h-[70vh] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-white/10\">\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"flex bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-1\">\r\n                            {[\"SALARY\", \"BONUS\", \"ADVANCE\", \"ADJUSTMENT\"].map((t) => (\r\n                                <Button\r\n                                    key={t}\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={() => setPayForm({ ...payForm, type: t })}\r\n                                    className={`flex-1 text-[10px] h-7 px-1 ${payForm.type === t ? \"bg-emerald-500/20 text-emerald-400\" : \"text-muted-foreground hover:bg-white/5\"}`}\r\n                                >\r\n                                    {t}\r\n                                </Button>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {!payment && (\r\n                            <div className=\"bg-gradient-to-br from-emerald-500/10 to-blue-500/10 p-4 rounded-xl border border-white/10 shadow-inner\">\r\n                                <div className=\"grid grid-cols-2 gap-y-2 text-xs\">\r\n                                    <span className=\"text-muted-foreground\">Base Salary</span>\r\n                                    <span className=\"text-right font-mono\">₹{Number(employee.baseSalary || 0).toLocaleString()}</span>\r\n\r\n                                    <span className=\"text-muted-foreground\">Already Paid</span>\r\n                                    <span className=\"text-right font-mono text-emerald-400\">- ₹{paidAmount.toLocaleString()}</span>\r\n\r\n                                    <div className=\"col-span-2 pt-2 mt-1 border-t border-white/10 flex justify-between items-end\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] text-muted-foreground uppercase tracking-wider\">Remaining</span>\r\n                                            <span className=\"text-lg font-bold text-orange-400 leading-tight\">₹{Math.max(0, (employee.baseSalary || 0) - paidAmount).toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"text-right flex flex-col items-end\">\r\n                                            <span className=\"text-[10px] text-muted-foreground uppercase tracking-wider\">Leaves ({payForm.month})</span>\r\n                                            <span className={`text-sm font-bold ${leavesCount > 0 ? \"text-red-400\" : \"text-emerald-400\"}`}>{leavesCount} Days</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Month</Label>\r\n                                <Select\r\n                                    value={payForm.month}\r\n                                    onValueChange={(v) => setPayForm({ ...payForm, month: v })}\r\n                                >\r\n                                    <SelectTrigger className=\"bg-white/5 border-white/10\">\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map(m => (\r\n                                            <SelectItem key={m} value={m}>{m}</SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Year</Label>\r\n                                <Input\r\n                                    value={payForm.year}\r\n                                    onChange={(e) => setPayForm({ ...payForm, year: e.target.value })}\r\n                                    className=\"bg-white/5 border-white/10\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Base Salary Amount (₹)</Label>\r\n                            <div className=\"relative\">\r\n                                <DollarSign className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    type=\"number\"\r\n                                    value={payForm.amount}\r\n                                    onChange={(e) => setPayForm({ ...payForm, amount: e.target.value })}\r\n                                    className=\"pl-9 bg-white/5 border-white/10\"\r\n                                    placeholder={employee.baseSalary ? employee.baseSalary.toString() : \"0\"}\r\n                                />\r\n                            </div>\r\n                            {employee.baseSalary ? (\r\n                                <p className=\"text-xs text-muted-foreground\">Default Base: ₹{employee.baseSalary.toLocaleString()}</p>\r\n                            ) : null}\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"text-red-400\">Deductions (₹)</Label>\r\n                                <Input\r\n                                    type=\"number\"\r\n                                    value={payForm.deductions}\r\n                                    onChange={(e) => setPayForm({ ...payForm, deductions: e.target.value })}\r\n                                    className=\"bg-white/5 border-white/10 text-red-400\"\r\n                                    placeholder=\"0\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"text-emerald-400\">Bonuses / Adds (₹)</Label>\r\n                                <Input\r\n                                    type=\"number\"\r\n                                    value={payForm.bonuses}\r\n                                    onChange={(e) => setPayForm({ ...payForm, bonuses: e.target.value })}\r\n                                    className=\"bg-white/5 border-white/10 text-emerald-400\"\r\n                                    placeholder=\"0\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2 bg-slate-900 border border-slate-800 p-3 rounded\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <span className=\"text-xs uppercase text-slate-400\">Net Pay</span>\r\n                                <span className=\"text-xl font-bold font-mono\">₹{netPay.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Payment Mode</Label>\r\n                            <Select\r\n                                value={payForm.method}\r\n                                onValueChange={(v) => setPayForm({ ...payForm, method: v })}\r\n                            >\r\n                                <SelectTrigger className=\"bg-white/5 border-white/10\"><SelectValue /></SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"CASH\">Cash</SelectItem>\r\n                                    <SelectItem value=\"UPI\">UPI / Online</SelectItem>\r\n                                    <SelectItem value=\"CHEQUE\">Cheque</SelectItem>\r\n                                    <SelectItem value=\"BANK_TRANSFER\">Bank Transfer</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-xs text-muted-foreground\">Notes (Reason for adjustments)</Label>\r\n                            <Textarea\r\n                                value={payForm.notes}\r\n                                onChange={(e) => setPayForm({ ...payForm, notes: e.target.value })}\r\n                                className=\"bg-white/5 border-white/10 h-16 text-sm\"\r\n                                placeholder=\"e.g. Overtime adjustment, Leave deduction...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter className=\"pt-4 border-t border-white/5 flex flex-row items-center justify-between gap-2\">\r\n                    {payment ? (\r\n                        <Button\r\n                            variant=\"destructive\"\r\n                            size=\"sm\"\r\n                            onClick={handleDelete}\r\n                            disabled={deleting || loading}\r\n                            className=\"bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white border-red-500/20\"\r\n                        >\r\n                            {deleting && <Loader2 className=\"w-3 h-3 mr-2 animate-spin\" />}\r\n                            Delete\r\n                        </Button>\r\n                    ) : <div />}\r\n\r\n                    <div className=\"flex gap-2\">\r\n                        <Button onClick={onClose} variant=\"ghost\" className=\"text-muted-foreground hover:text-white\">\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handlePaySalary}\r\n                            disabled={loading || deleting}\r\n                            className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                        >\r\n                            {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n                            {payment ? \"Update Payment\" : \"Confirm Payment\"}\r\n                        </Button>\r\n                    </div>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}