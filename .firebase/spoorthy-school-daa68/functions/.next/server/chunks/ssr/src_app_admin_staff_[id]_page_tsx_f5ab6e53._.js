module.exports=[22679,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(69387);var e=a.i(60574),f=a.i(20237),g=a.i(99570),h=a.i(91119),i=a.i(86304),j=a.i(96221),k=a.i(210),l=a.i(63519),m=a.i(24987),n=a.i(90166),o=a.i(56738),p=a.i(24569),q=a.i(14574),r=a.i(70430),s=a.i(66718),t=a.i(80701),u=a.i(29246),v=a.i(56025),w=a.i(43945),x=a.i(88110);function y({isOpen:a,onClose:d,staff:h,onSuccess:i}){let[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)({roleId:"",name:"",mobile:"",address:""}),[u,v]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&h&&(p({roleId:h.roleId||"",name:h.name||"",mobile:h.mobile||"",address:h.address||""}),w())},[a,h]);let w=async()=>{n(!0);try{let a=(0,e.query)((0,e.collection)(f.db,"master_staff_roles"),(0,e.where)("hasLogin","==",!1)),b=await (0,e.getDocs)(a);l(b.docs.map(a=>({id:a.id,...a.data()})))}catch(a){console.error(a)}finally{n(!1)}},y=async a=>{if(a.preventDefault(),h?.id){v(!0);try{let a=k.find(a=>a.id===o.roleId)||k.find(a=>a.code===h.roleCode),b=(0,e.doc)(f.db,"staff",h.id);await (0,e.updateDoc)(b,{name:o.name,mobile:o.mobile,address:o.address,roleId:o.roleId,roleName:a?.name||h.roleName,roleCode:a?.code||h.roleCode,updatedAt:new Date().toISOString()}),(0,x.toast)({title:"Staff Updated",description:`Successfully updated record for ${o.name}`,type:"success"}),i(),d()}catch(a){(0,x.toast)({title:"Update Failed",description:a.message||"Could not update staff record.",type:"error"})}finally{v(!1)}}};return(0,b.jsx)(q.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(q.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[425px]",children:[(0,b.jsx)(q.DialogHeader,{children:(0,b.jsx)(q.DialogTitle,{children:"Edit Staff Member"})}),(0,b.jsxs)("form",{onSubmit:y,className:"space-y-4 py-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Job Role"}),(0,b.jsxs)(t.Select,{value:o.roleId,onValueChange:a=>p({...o,roleId:a}),disabled:m,children:[(0,b.jsx)(t.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(t.SelectValue,{placeholder:m?"Loading roles...":"Select Role"})}),(0,b.jsx)(t.SelectContent,{className:"bg-black border-white/10 text-white",children:k.map(a=>(0,b.jsxs)(t.SelectItem,{value:a.id,children:[a.name," (",a.code,")"]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Full Name"}),(0,b.jsx)(s.Input,{required:!0,value:o.name,onChange:a=>p({...o,name:a.target.value}),className:"bg-white/5 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Mobile Number"}),(0,b.jsx)(s.Input,{required:!0,type:"tel",pattern:"[0-9]{10}",value:o.mobile,onChange:a=>p({...o,mobile:a.target.value}),className:"bg-white/5 border-white/10 font-mono",maxLength:10})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Address"}),(0,b.jsx)(s.Input,{required:!0,value:o.address,onChange:a=>p({...o,address:a.target.value}),className:"bg-white/5 border-white/10"})]}),(0,b.jsxs)(q.DialogFooter,{className:"mt-4",children:[(0,b.jsx)(g.Button,{type:"button",variant:"ghost",onClick:d,disabled:u,children:"Cancel"}),(0,b.jsxs)(g.Button,{type:"submit",disabled:u||!o.roleId,className:"bg-white text-black hover:bg-zinc-200",children:[u?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Save Changes"]})]})]})]})})}var z=a.i(9450),A=a.i(37047),B=a.i(21161);function C(){let{user:a}=(0,v.useAuth)(),{id:x}=(0,d.useParams)(),C=(0,d.useRouter)(),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(!0),[H,I]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!a)return;let b=(0,e.onSnapshot)((0,e.doc)(f.db,"users",a.uid),a=>{a.exists()&&I(a.data().role)});return()=>b()},[a]);let[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)({month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear().toString(),amount:"",method:"CASH",notes:""}),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(!1);(0,c.useEffect)(()=>{x&&(X(),Y())},[x]);let X=async()=>{try{let a=(0,e.doc)(f.db,"staff",x),b=await (0,e.getDoc)(a);b.exists()?E(b.data()):(alert("Staff not found"),C.back())}catch(a){console.error(a)}finally{G(!1)}},Y=async()=>{try{(0,e.query)((0,e.collection)(f.db,"salary_payments"),(0,e.where)("personId","==",x),(0,e.orderBy)("createdAt","desc"));let a=(0,e.query)((0,e.collection)(f.db,"salary_payments"),(0,e.where)("personId","==",x)),b=(await (0,e.getDocs)(a)).docs.map(a=>({id:a.id,...a.data()}));b.sort((a,b)=>b.createdAt?.seconds-a.createdAt?.seconds),K(b)}catch(a){console.error(a)}},Z=async()=>{Q(!0);try{if(!N.amount)throw Error("Amount required");let b=await a?.getIdToken(),c=await fetch("/api/admin/payroll/process",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({personId:x,personType:"STAFF",...N,amount:Number(N.amount)})}),d=await c.json();if(!c.ok)throw Error(d.error);alert("Salary Payment Recorded!"),M(!1),Y()}catch(a){alert(a.message)}finally{Q(!1)}};return F?(0,b.jsx)("div",{className:"p-10 flex justify-center",children:(0,b.jsx)(j.Loader2,{className:"animate-spin"})}):D?(0,b.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500",children:[(0,b.jsxs)("div",{className:"flex flex-col xl:flex-row xl:items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 w-full xl:w-auto",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>C.back(),children:(0,b.jsx)(k.ArrowLeft,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-display font-bold",children:D.name}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-muted-foreground mt-1",children:[(0,b.jsx)(i.Badge,{variant:"outline",className:"border-yellow-500/50 text-yellow-400 font-mono",children:D.schoolId}),(0,b.jsx)("span",{children:"•"}),(0,b.jsx)(i.Badge,{variant:"secondary",children:D.roleName})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 w-full xl:w-auto xl:ml-auto",children:[(0,b.jsxs)(g.Button,{onClick:()=>W(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,b.jsx)(A.KeyRound,{className:"w-4 h-4 mr-2"})," Reset Password"]}),(0,b.jsxs)(g.Button,{onClick:()=>U(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,b.jsx)(p.Edit,{className:"w-4 h-4 mr-2"})," Edit Details"]}),"MANAGER"!==H&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.Button,{onClick:()=>S(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,b.jsx)(B.Settings,{className:"w-4 h-4 mr-2"})," Adjust Salary"]}),(0,b.jsxs)(g.Button,{onClick:()=>M(!0),className:"bg-green-600 hover:bg-green-700 text-white flex-1 md:flex-none",children:[(0,b.jsx)(o.Wallet,{className:"w-4 h-4 mr-2"})," Pay Salary"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)(h.Card,{className:"md:col-span-2 bg-black/40 border-white/10",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-lg",children:"Staff Details"})}),(0,b.jsx)(h.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(r.Label,{className:"text-muted-foreground",children:"Mobile"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(l.Phone,{className:"w-4 h-4 text-blue-400"}),(0,b.jsx)("span",{className:"font-mono",children:D.mobile})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(r.Label,{className:"text-muted-foreground",children:"Role Code"}),(0,b.jsx)("div",{className:"mt-1 font-mono",children:D.roleCode})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(r.Label,{className:"text-muted-foreground",children:"Address"}),(0,b.jsxs)("div",{className:"flex items-start gap-2 mt-1",children:[(0,b.jsx)(m.MapPin,{className:"w-4 h-4 text-red-400 mt-1"}),(0,b.jsx)("span",{children:D.address})]})]})]})})]}),"MANAGER"!==H&&(0,b.jsxs)(h.Card,{className:"bg-black/40 border-white/10",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-lg",children:"Payroll"})}),(0,b.jsxs)(h.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 text-center",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm uppercase tracking-wider mb-1",children:"Base Salary"}),(0,b.jsxs)("div",{className:"text-3xl font-display font-bold",children:["₹",D.baseSalary?.toLocaleString()]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-3",children:"Recent Payments"}),(0,b.jsxs)("div",{className:"space-y-2",children:[J.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white/5 rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-bold",children:[a.month," ",a.year]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.method})]}),(0,b.jsxs)("div",{className:"font-mono text-green-400 font-bold",children:["+₹",a.amount.toLocaleString()]})]},a.id)),0===J.length&&(0,b.jsx)("div",{className:"text-center text-muted-foreground text-sm",children:"No payment history"})]})]})]})]})]}),(0,b.jsx)(q.Dialog,{open:L,onOpenChange:M,children:(0,b.jsxs)(q.DialogContent,{className:"bg-black/95 border-white/10 text-white",children:[(0,b.jsx)(q.DialogHeader,{children:(0,b.jsxs)(q.DialogTitle,{children:["Pay Salary to ",D.name]})}),(0,b.jsxs)("div",{className:"space-y-4 py-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Month"}),(0,b.jsxs)(t.Select,{value:N.month,onValueChange:a=>O({...N,month:a}),children:[(0,b.jsx)(t.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsx)(t.SelectContent,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(a=>(0,b.jsx)(t.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Year"}),(0,b.jsx)(s.Input,{value:N.year,onChange:a=>O({...N,year:a.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Amount (₹)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(s.Input,{type:"number",value:N.amount,onChange:a=>O({...N,amount:a.target.value}),className:"pl-9 bg-white/5 border-white/10",placeholder:D.baseSalary?.toString()})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Standard Base: ₹",D.baseSalary?.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Payment Mode"}),(0,b.jsxs)(t.Select,{value:N.method,onValueChange:a=>O({...N,method:a}),children:[(0,b.jsx)(t.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"CASH",children:"Cash"}),(0,b.jsx)(t.SelectItem,{value:"UPI",children:"UPI / Online"}),(0,b.jsx)(t.SelectItem,{value:"CHEQUE",children:"Cheque"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Label,{children:"Notes (Optional)"}),(0,b.jsx)(u.Textarea,{value:N.notes,onChange:a=>O({...N,notes:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"e.g. Overtime"})]})]}),(0,b.jsx)(q.DialogFooter,{children:(0,b.jsx)(g.Button,{onClick:Z,disabled:P,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:P?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Payment"})})]})}),(0,b.jsx)(w.AdjustSalaryModal,{isOpen:R,onClose:()=>S(!1),person:D?{id:x,name:D.name,schoolId:D.schoolId,role:"STAFF",currentSalary:D.baseSalary||0,roleCode:D.roleCode}:null,onSuccess:()=>X()}),(0,b.jsx)(y,{isOpen:T,onClose:()=>U(!1),staff:D?{id:x,...D}:null,onSuccess:()=>X()}),(0,b.jsx)(z.AdminChangePasswordModal,{isOpen:V,onClose:()=>W(!1),user:D?{uid:D.uid,schoolId:D.schoolId,name:D.name,role:"STAFF"}:null})]}):null}a.s(["default",()=>C],22679)}];

//# sourceMappingURL=src_app_admin_staff_%5Bid%5D_page_tsx_f5ab6e53._.js.map