{"version":3,"sources":["../../../../src/app/admin/students/%5Bid%5D/page.tsx","../../../../src/components/admin/adjust-fees-modal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { doc, getDoc, collection, query, where, getDocs, deleteDoc, updateDoc, addDoc, Timestamp, orderBy, setDoc, onSnapshot } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { ArrowLeft, Edit, Trash2, Save, X, Loader2, CreditCard, ShieldAlert, History, Settings2, Lock, RefreshCw, Download, Printer } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { DeleteUserModal } from \"@/components/admin/delete-user-modal\";\r\nimport { AdjustFeesModal } from \"@/components/admin/adjust-fees-modal\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { AdminChangePasswordModal } from \"@/components/admin/admin-change-password-modal\";\r\nimport { exportSingleStudentFee, printStudentFeeStructure, printPaymentReceipt, printPendingFeeReport } from \"@/lib/export-utils\";\r\nimport { useMasterData } from \"@/context/MasterDataContext\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { notifyManagerAction } from \"@/lib/notifications\";\r\n\r\ninterface Student {\r\n    id: string; // Document ID (usually same as schoolId)\r\n    uid?: string; // Auth UID\r\n    schoolId: string;\r\n    studentName: string;\r\n    parentName: string;\r\n    parentMobile: string; // Used as password\r\n    className: string;\r\n    sectionName: string;\r\n    villageName: string;\r\n    villageId: string;\r\n    classId: string;\r\n    sectionId: string;\r\n    status: string;\r\n    createdAt: any;\r\n}\r\n\r\ninterface Payment {\r\n    id: string;\r\n    amount: number;\r\n    date: any;\r\n    status: string;\r\n    method: string;\r\n    remarks?: string;\r\n    termId?: string;\r\n}\r\n\r\ninterface FeeLedgerItem {\r\n    id: string;\r\n    name: string;\r\n    type: \"TERM\" | \"CUSTOM\";\r\n    amount: number;\r\n    paidAmount: number;\r\n    dueDate: string;\r\n    status: \"PENDING\" | \"PAID\" | \"PARTIAL\";\r\n}\r\n\r\ninterface FeeLedger {\r\n    totalFee: number;\r\n    totalPaid: number; // Note: This might lag behind actual payments collection if not synced, usually we verify against 'payments' collection for truth.\r\n    items: FeeLedgerItem[];\r\n}\r\n\r\nexport default function StudentDetailsPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const studentId = params.id as string;\r\n\r\n    // Core Data\r\n    const [student, setStudent] = useState<Student | null>(null);\r\n    const [payments, setPayments] = useState<Payment[]>([]);\r\n    const [ledger, setLedger] = useState<FeeLedger | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [role, setRole] = useState<string>(\"\");\r\n    const { user } = useAuth();\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n        const unsub = onSnapshot(doc(db, \"users\", user.uid), (d) => {\r\n            if (d.exists()) setRole(d.data().role);\r\n        });\r\n        return () => unsub();\r\n    }, [user]);\r\n\r\n    // UI State\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [editForm, setEditForm] = useState<Partial<Student>>({});\r\n    const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\r\n\r\n    const { villages: villagesData, classes: classesData, sections: sectionsData, classSections, branding, selectedYear } = useMasterData();\r\n\r\n    // Derived Master Data\r\n    const villages = Object.values(villagesData || {}).map((v: any) => ({ id: v.id, name: v.name })).sort((a, b) => a.name.localeCompare(b.name));\r\n    const classes = Object.values(classesData || {}).map((c: any) => ({ id: c.id, name: c.name, order: c.order || 99 })).sort((a: any, b: any) => a.order - b.order);\r\n    const sections = Object.values(sectionsData || {}).map((s: any) => ({ id: s.id, name: s.name })).sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n    // Fee Collection State\r\n    const [isFeeModalOpen, setIsFeeModalOpen] = useState(false);\r\n    const [isAdjustModalOpen, setIsAdjustModalOpen] = useState(false);\r\n\r\n    const [feeForm, setFeeForm] = useState({\r\n        amount: \"\",\r\n        method: \"cash\",\r\n        date: new Date().toISOString().split('T')[0],\r\n        remarks: \"\"\r\n    });\r\n    const [collectingFee, setCollectingFee] = useState(false);\r\n\r\n    // Initial Fetch\r\n    useEffect(() => {\r\n        const fetchAll = async () => {\r\n            if (!studentId) return;\r\n            setLoading(true);\r\n\r\n            try {\r\n                // 1. Fetch Student Profile\r\n                const studentRef = doc(db, \"students\", studentId);\r\n                const studentSnap = await getDoc(studentRef);\r\n\r\n                if (!studentSnap.exists()) {\r\n                    alert(\"Student Not Found\");\r\n                    router.push(\"/admin/students\");\r\n                    return;\r\n                }\r\n\r\n                const sData = { id: studentSnap.id, ...studentSnap.data() } as Student;\r\n\r\n                // 1.1 Fetch Linked UID (Critical for Password Reset)\r\n                if (!sData.uid) {\r\n                    try {\r\n                        const mappingRef = doc(db, \"usersBySchoolId\", sData.schoolId);\r\n                        const mappingSnap = await getDoc(mappingRef);\r\n                        if (mappingSnap.exists()) {\r\n                            sData.uid = mappingSnap.data().uid;\r\n                        }\r\n                    } catch (e) {\r\n                        console.warn(\"UID Lookup Failed\", e);\r\n                    }\r\n                }\r\n\r\n                setStudent(sData);\r\n                setEditForm(sData);\r\n\r\n                // 2. Fetch Payments\r\n                const pQ = query(collection(db, \"payments\"), where(\"studentId\", \"==\", sData.schoolId));\r\n                const pSnap = await getDocs(pQ);\r\n                const loadedPayments = pSnap.docs.map(d => ({ id: d.id, ...d.data() } as Payment));\r\n                // Client-side sort\r\n                setPayments(loadedPayments.sort((a, b) => {\r\n                    const dateA = a.date?.toDate ? a.date.toDate() : new Date(a.date);\r\n                    const dateB = b.date?.toDate ? b.date.toDate() : new Date(b.date);\r\n                    return dateB - dateA;\r\n                }));\r\n\r\n                // 3. Fetch Fee Ledger (New)\r\n                // Assuming current academic year is hardcoded \"2025-2026\" for MVP or fetched from config.\r\n                // We use the ID convention: {schoolId}_2025-2026\r\n                const currentYearId = selectedYear || \"2025-2026\";\r\n                const ledgerRef = doc(db, \"student_fee_ledgers\", `${sData.schoolId}_${currentYearId}`);\r\n                const ledgerSnap = await getDoc(ledgerRef);\r\n\r\n                if (ledgerSnap.exists()) {\r\n                    setLedger(ledgerSnap.data() as FeeLedger);\r\n                } else {\r\n                    // Fallback: If no ledger exists (old student), we might need to rely on the old calculation or show empty.\r\n                    // For now, let's treat as empty to encourage \"Recalculate\" or \"Generate\" if we were to add that button.\r\n                    setLedger(null);\r\n                }\r\n\r\n                // Master data now handled by context\r\n\r\n            } catch (err) {\r\n                console.error(\"Fetch Error:\", err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchAll();\r\n    }, [studentId, router, selectedYear]);\r\n\r\n    // Update Profile\r\n    const handleUpdate = async () => {\r\n        if (!student) return;\r\n        try {\r\n            // resolve names based on IDs\r\n            const vName = villages.find(v => v.id === editForm.villageId)?.name || editForm.villageName;\r\n            const cName = classes.find(c => c.id === editForm.classId)?.name || editForm.className;\r\n            const sName = sections.find(s => s.id === editForm.sectionId)?.name || editForm.sectionName;\r\n\r\n            const updates: any = {\r\n                ...editForm,\r\n                villageName: vName || null,\r\n                className: cName || null,\r\n                sectionName: sName || null\r\n            };\r\n\r\n            // Remove undefined fields to prevent Firestore crash\r\n            Object.keys(updates).forEach(key => updates[key] === undefined && delete updates[key]);\r\n\r\n            await updateDoc(doc(db, \"students\", student.id), updates);\r\n            setStudent({ ...student, ...updates } as Student);\r\n            setIsEditing(false);\r\n\r\n            // Log Update\r\n            await addDoc(collection(db, \"audit_logs\"), {\r\n                action: \"UPDATE_STUDENT_PROFILE\",\r\n                targetId: student.id,\r\n                details: updates,\r\n                timestamp: Timestamp.now()\r\n            });\r\n\r\n            // Notification for Manager Action\r\n            if (role === \"MANAGER\") {\r\n                await notifyManagerAction({\r\n                    userId: student.uid || student.id,\r\n                    title: \"Profile Updated\",\r\n                    message: `Student profile ${student.studentName} has been updated by Manager ${user?.displayName || 'System'}.`,\r\n                    type: \"INFO\",\r\n                    actionBy: user?.uid,\r\n                    actionByName: user?.displayName || \"Manager\"\r\n                });\r\n            }\r\n\r\n            alert(\"Profile Updated Successfully\");\r\n        } catch (e: any) {\r\n            console.error(e);\r\n            alert(\"Update Failed: \" + e.message);\r\n        }\r\n    };\r\n\r\n    // Collect Fee\r\n    const handleCollectFee = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!student) return;\r\n        setCollectingFee(true);\r\n\r\n        try {\r\n            const amount = Number(feeForm.amount);\r\n            if (amount <= 0) throw new Error(\"Invalid Amount\");\r\n\r\n            const now = new Date();\r\n            const timestampStr = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;\r\n            const managerRemark = role === \"MANAGER\" ? ` | Collected by manager: ${user?.displayName || \"Manager\"} at ${timestampStr}` : \"\";\r\n\r\n            const newPayment = {\r\n                studentId: student.schoolId,\r\n                studentName: student.studentName,\r\n                amount,\r\n                method: feeForm.method,\r\n                date: Timestamp.fromDate(new Date(feeForm.date)),\r\n                status: \"success\",\r\n                remarks: (feeForm.remarks || \"\") + managerRemark,\r\n                createdAt: Timestamp.now(),\r\n                verifiedBy: role === \"MANAGER\" ? `manager:${user?.displayName || 'Manager'}` : \"admin\"\r\n            };\r\n\r\n            const ref = await addDoc(collection(db, \"payments\"), newPayment);\r\n\r\n            // === Critical Update: Update Student Ledger ===\r\n            const newTotalPaid = totalPaid + amount;\r\n            const currentYearId = selectedYear || \"2025-2026\";\r\n            const ledgerRef = doc(db, \"student_fee_ledgers\", `${student.schoolId}_${currentYearId}`);\r\n\r\n            await updateDoc(ledgerRef, {\r\n                totalPaid: newTotalPaid,\r\n                status: newTotalPaid >= totalFee ? \"PAID\" : \"PENDING\",\r\n                updatedAt: new Date().toISOString()\r\n            });\r\n\r\n            setPayments([{ id: ref.id, ...newPayment } as unknown as Payment, ...payments]);\r\n            setLedger(prev => prev ? { ...prev, totalPaid: newTotalPaid, status: newTotalPaid >= totalFee ? \"PAID\" : \"PENDING\" } : null);\r\n\r\n            // === Notifications ===\r\n            // 2. Notify Admins & Effective User (if Manager)\r\n            if (role === \"MANAGER\") {\r\n                await notifyManagerAction({\r\n                    userId: student.uid || student.id,\r\n                    title: \"Fee Payment Received\",\r\n                    message: `Payment of ₹${amount.toLocaleString()} received via ${feeForm.method}. ${feeForm.remarks ? `(${feeForm.remarks})` : ''}`,\r\n                    type: \"FEE\",\r\n                    actionBy: user?.uid,\r\n                    actionByName: user?.displayName || \"Manager\"\r\n                });\r\n            } else {\r\n                // Regular Admin notification (already partly handled in original code, but let's unify)\r\n                try {\r\n                    await addDoc(collection(db, \"notifications\"), {\r\n                        target: \"ALL_ADMINS\",\r\n                        title: \"Fee Collected\",\r\n                        message: `Collected ₹${amount.toLocaleString()} from ${student.studentName} (${student.schoolId}) via ${feeForm.method}.`,\r\n                        type: \"FEE\",\r\n                        status: \"UNREAD\",\r\n                        createdAt: Timestamp.now()\r\n                    });\r\n\r\n                    if (student.uid) {\r\n                        await addDoc(collection(db, \"notifications\"), {\r\n                            userId: student.uid,\r\n                            title: \"Fee Payment Received\",\r\n                            message: `Payment of ₹${amount.toLocaleString()} received via ${feeForm.method}.`,\r\n                            type: \"FEE\",\r\n                            status: \"UNREAD\",\r\n                            createdAt: Timestamp.now()\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Failed to notify admins\", e);\r\n                }\r\n            }\r\n\r\n            setIsFeeModalOpen(false);\r\n            setFeeForm({ amount: \"\", method: \"cash\", date: new Date().toISOString().split('T')[0], remarks: \"\" });\r\n            alert(\"Payment Recorded & Ledger Updated\");\r\n\r\n        } catch (e: any) {\r\n            alert(e.message);\r\n        } finally {\r\n            setCollectingFee(false);\r\n        }\r\n    };\r\n\r\n    // Calculations\r\n    const totalPaid = payments.reduce((sum, p) => sum + (Number(p.amount) || 0), 0);\r\n    const totalFee = ledger ? ledger.items.reduce((sum, i) => sum + i.amount, 0) : 0;\r\n    const dueAmount = totalFee - totalPaid;\r\n    const paymentProgress = totalFee > 0 ? Math.min((totalPaid / totalFee) * 100, 100) : 0;\r\n\r\n    // Financial Breakdown logic for Fee Table and Overview\r\n    const getBreakdown = () => {\r\n        if (!ledger) return { items: [], termsPaid: 0, termsTotal: 0, customPaid: 0, customTotal: 0, pending: [], termsPending: 0, customPending: 0 };\r\n\r\n        // Use FIFO distribution for display: payments cover oldest items first\r\n        const sortedItems = [...ledger.items].sort((a, b) => {\r\n            return new Date(a.dueDate).getTime() - new Date(b.dueDate).getTime();\r\n        });\r\n\r\n        let remainingToDistribute = totalPaid;\r\n        const processed = sortedItems.map(item => {\r\n            const paid = Math.min(remainingToDistribute, item.amount);\r\n            remainingToDistribute -= paid;\r\n            const due = item.amount - paid;\r\n            let status: \"PAID\" | \"PENDING\" | \"PARTIAL\" = \"PENDING\";\r\n            if (paid >= item.amount) status = \"PAID\";\r\n            else if (paid > 0) status = \"PARTIAL\";\r\n\r\n            return {\r\n                ...item,\r\n                distributedPaid: paid,\r\n                distributedDue: due,\r\n                distributedStatus: status\r\n            };\r\n        });\r\n\r\n        return {\r\n            items: processed,\r\n            termsPaid: processed.filter(i => i.type === \"TERM\").reduce((s, i) => s + i.distributedPaid, 0),\r\n            termsTotal: processed.filter(i => i.type === \"TERM\").reduce((s, i) => s + i.amount, 0),\r\n            customPaid: processed.filter(i => i.type !== \"TERM\").reduce((s, i) => s + i.distributedPaid, 0),\r\n            customTotal: processed.filter(i => i.type !== \"TERM\").reduce((s, i) => s + i.amount, 0),\r\n            termsPending: processed.filter(i => i.type === \"TERM\").reduce((s, i) => s + i.distributedDue, 0),\r\n            customPending: processed.filter(i => i.type !== \"TERM\").reduce((s, i) => s + i.distributedDue, 0),\r\n            pending: processed.filter(i => i.distributedDue > 0).map(i => ({\r\n                name: i.name,\r\n                due: i.distributedDue\r\n            }))\r\n        };\r\n    };\r\n\r\n    const breakdown = getBreakdown();\r\n\r\n    const refreshData = () => {\r\n        // Cheap refresh: strict reload or just re-fetch function? \r\n        // For now, full reload is safer for sync issues. \r\n        window.location.reload();\r\n    };\r\n\r\n    // Reset Password State\r\n    const [isResetModalOpen, setIsResetModalOpen] = useState(false);\r\n\r\n    // Recalculate Fees (Sync with Global)\r\n    const [recalculating, setRecalculating] = useState(false);\r\n    const handleRecalculateFees = async () => {\r\n        if (!student) return;\r\n        setRecalculating(true);\r\n        try {\r\n            // 1. Fetch Global Fee Config\r\n            const feeConfigSnap = await getDoc(doc(db, \"config\", \"fees\"));\r\n            const feeConfig = feeConfigSnap.data();\r\n            const feeTerms = (feeConfig?.terms || []).filter((t: any) => t.isActive);\r\n\r\n            // 1.5 Fetch Custom Fees (Targeted)\r\n            const customFeesQ = query(collection(db, \"custom_fees\"), where(\"status\", \"==\", \"ACTIVE\"));\r\n            const customFeesSnap = await getDocs(customFeesQ);\r\n\r\n            // 2. Identify Target Class\r\n            const targetClassId = student.classId; // Ideally we use ID\r\n            const targetClassName = student.className || \"Class 1\";\r\n            // Note: Custom Fees page uses IDs for targetIds? Let's check. \r\n            // Yes, Custom Fees page uses `formData.targetIds.includes(c.id)` where c.id is firestore doc id of master_class.\r\n            // Student has `classId` (hopefully matching master_class ID).\r\n\r\n            // 3. Build Expected Items\r\n            const newItems: FeeLedgerItem[] = [];\r\n\r\n            // A. Add Standard Term Flags\r\n            feeTerms.forEach((term: any) => {\r\n                const amount = term.amounts?.[targetClassName] || 0; // Config uses Name\r\n                if (amount > 0) {\r\n                    newItems.push({\r\n                        id: `TERM_${term.id}`,\r\n                        type: \"TERM\",\r\n                        name: term.name,\r\n                        dueDate: term.dueDate,\r\n                        amount: Number(amount),\r\n                        paidAmount: 0,\r\n                        status: \"PENDING\"\r\n                    });\r\n                }\r\n            });\r\n\r\n            // B. Add Custom Fees\r\n            customFeesSnap.docs.forEach(doc => {\r\n                const cf = doc.data();\r\n                let isApplicable = false;\r\n\r\n                if (cf.targetType === \"CLASS\" && cf.targetIds?.includes(targetClassId)) {\r\n                    isApplicable = true;\r\n                }\r\n                // Optional: Village check if we had student.villageId\r\n                // if (cf.targetType === \"VILLAGE\" && cf.targetIds?.includes(student.villageId)) isApplicable = true;\r\n\r\n                if (isApplicable) {\r\n                    newItems.push({\r\n                        id: `CUSTOM_${doc.id}`,\r\n                        type: \"CUSTOM\",\r\n                        name: cf.name,\r\n                        dueDate: cf.dueDate,\r\n                        amount: Number(cf.amount),\r\n                        paidAmount: 0,\r\n                        status: \"PENDING\"\r\n                    });\r\n                }\r\n            });\r\n\r\n            // 4. Fetch Existing Ledger\r\n            const currentYearId = selectedYear || \"2025-2026\";\r\n            const ledgerRef = doc(db, \"student_fee_ledgers\", `${student.schoolId}_${currentYearId}`);\r\n            const ledgerSnap = await getDoc(ledgerRef);\r\n\r\n            let existingItems: FeeLedgerItem[] = [];\r\n            if (ledgerSnap.exists()) {\r\n                existingItems = (ledgerSnap.data().items as FeeLedgerItem[]) || [];\r\n            }\r\n\r\n            // 5. Merge Strategy:\r\n            // - Keep existing items (preserve payments)\r\n            // - Add new items if ID missing\r\n            // - OPTIONAL: Update amount of existing items? \r\n            //   For \"New Fee Type\", strictly adding is safer. \r\n            //   If user updated Amount of existing term, we MIGHT want to update it if paid=0.\r\n            //   Let's do a smart merge: Update amount ONLY if paidAmount is 0.\r\n\r\n            const mergedItems = [...existingItems];\r\n\r\n            newItems.forEach(newItem => {\r\n                const existingIndex = mergedItems.findIndex(i => i.id === newItem.id);\r\n                if (existingIndex === -1) {\r\n                    // Start fresh\r\n                    mergedItems.push(newItem);\r\n                } else {\r\n                    // Update metadata (due date, name) always\r\n                    // Update amount ONLY if no payment made yet (to avoid messing up partials)\r\n                    const ex = mergedItems[existingIndex];\r\n                    if (ex.paidAmount === 0) {\r\n                        mergedItems[existingIndex] = { ...ex, amount: newItem.amount, dueDate: newItem.dueDate, name: newItem.name };\r\n                    } else {\r\n                        // Just update metadata, keep old amount? Or force new amount?\r\n                        // If paid partial, total fee might increase.\r\n                        // Let's safe update:\r\n                        mergedItems[existingIndex] = { ...ex, dueDate: newItem.dueDate, name: newItem.name };\r\n                    }\r\n                }\r\n            });\r\n\r\n            // 6. Recalculate Totals\r\n            const totalFee = mergedItems.reduce((sum, i) => sum + i.amount, 0);\r\n\r\n            // 7. Save\r\n            const newLedgerData = {\r\n                studentId: student.schoolId,\r\n                academicYearId: currentYearId,\r\n                classId: student.classId,\r\n                className: student.className,\r\n                totalFee,\r\n                totalPaid: ledger?.totalPaid || 0, // Persist or re-sum?\r\n                // Better re-sum from payments? No, payments collection is truth.\r\n                // Assuming ledger.totalPaid is synced.\r\n                status: (ledger?.totalPaid || 0) >= totalFee ? \"PAID\" : \"PENDING\",\r\n                items: mergedItems,\r\n                updatedAt: new Date().toISOString() // serverTimestamp ideally\r\n            };\r\n\r\n            await setDoc(ledgerRef, newLedgerData, { merge: true });\r\n\r\n            // 8. Update Local State\r\n            setLedger({ ...newLedgerData, items: mergedItems } as FeeLedger);\r\n\r\n            // 9. Notification for Manager Action\r\n            if (role === \"MANAGER\") {\r\n                await notifyManagerAction({\r\n                    userId: student.uid || student.schoolId,\r\n                    title: \"Fee Structure Synced\",\r\n                    message: `Fee structure for ${student.studentName} has been recalculated & synced with global config by Manager ${user?.displayName || 'Manager'}.`,\r\n                    type: \"INFO\",\r\n                    actionBy: user?.uid,\r\n                    actionByName: user?.displayName || \"Manager\"\r\n                });\r\n            }\r\n\r\n            alert(\"Fees Recalculated Successfully\");\r\n\r\n        } catch (e: any) {\r\n            console.error(e);\r\n            alert(\"Recalculate Failed: \" + e.message);\r\n        } finally {\r\n            setRecalculating(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex flex-col items-center justify-center min-h-[50vh] space-y-4\">\r\n            <Loader2 className=\"w-10 h-10 animate-spin text-accent\" />\r\n            <p className=\"text-muted-foreground\">Loading Profile...</p>\r\n        </div>\r\n    );\r\n\r\n    if (!student) return null;\r\n\r\n    return (\r\n        <div className=\"space-y-3 md:space-y-6 max-w-7xl mx-auto pb-20 animate-in fade-in duration-500 p-1 md:p-0\">\r\n            {/* Password Reset Modal */}\r\n            <AdminChangePasswordModal\r\n                isOpen={isResetModalOpen}\r\n                onClose={() => setIsResetModalOpen(false)}\r\n                user={{\r\n                    uid: student.uid || \"\",\r\n                    schoolId: student.schoolId,\r\n                    name: student.studentName,\r\n                    role: \"STUDENT\"\r\n                }}\r\n            />\r\n\r\n            {/* Header */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-3 pt-2 md:pt-4\">\r\n                <div className=\"flex items-center gap-2 md:gap-4\">\r\n                    <Link href=\"/admin/students\">\r\n                        <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8 md:h-9 md:w-9 border-white/10 hover:bg-white/10\">\r\n                            <ArrowLeft className=\"w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground\" />\r\n                        </Button>\r\n                    </Link>\r\n                    <div>\r\n                        <div className=\"flex items-center gap-1.5 md:gap-2\">\r\n                            <h1 className=\"text-lg md:text-3xl font-display font-bold text-white leading-tight\">{student.studentName}</h1>\r\n                            <Badge variant={student.status === 'ACTIVE' ? 'default' : 'destructive'} className=\"uppercase text-[7px] md:text-[10px] h-4 md:h-5 px-1 py-0\">\r\n                                {student.status}\r\n                            </Badge>\r\n                        </div>\r\n                        <p className=\"text-[9px] md:text-sm text-muted-foreground font-mono flex items-center gap-1.5 md:gap-2\">\r\n                            <span className=\"text-accent font-bold\">{student.schoolId}</span>\r\n                            <span>•</span>\r\n                            <span className=\"truncate max-w-[100px] md:max-w-none\">\r\n                                {classesData[student.classId]?.name || student.className || \"Class\"}\r\n                            </span>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap items-center gap-1.5 md:gap-2\">\r\n                    {(role === \"ADMIN\" || role === \"MANAGER\") && (\r\n                        <Dialog open={isFeeModalOpen} onOpenChange={setIsFeeModalOpen}>\r\n                            <DialogTrigger asChild>\r\n                                <Button size=\"sm\" className=\"h-8 md:h-11 bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg text-[10px] md:text-sm font-bold flex-1 md:flex-none\">\r\n                                    <CreditCard className=\"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2\" /> Collect Fee\r\n                                </Button>\r\n                            </DialogTrigger>\r\n                            <DialogContent className=\"bg-black/95 border-white/10 text-white sm:max-w-md\">\r\n                                <DialogHeader><DialogTitle>Collect Payment</DialogTitle></DialogHeader>\r\n                                <form onSubmit={handleCollectFee} className=\"space-y-4 py-4\">\r\n                                    <div className=\"p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-400 text-sm flex justify-between\">\r\n                                        <span>Current Due:</span>\r\n                                        <span className=\"font-bold font-mono\">₹{dueAmount.toLocaleString()}</span>\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Amount Received (₹) <span className=\"text-red-500\">*</span></Label>\r\n                                        <Input\r\n                                            required\r\n                                            type=\"number\"\r\n                                            min=\"1\"\r\n                                            placeholder=\"Enter amount...\"\r\n                                            className=\"bg-white/5 border-white/10 font-mono text-lg\"\r\n                                            value={feeForm.amount}\r\n                                            onChange={e => setFeeForm({ ...feeForm, amount: e.target.value })}\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label>Mode</Label>\r\n                                            <Select value={feeForm.method} onValueChange={v => setFeeForm({ ...feeForm, method: v })}>\r\n                                                <SelectTrigger className=\"bg-white/5 border-white/10 h-10\"><SelectValue /></SelectTrigger>\r\n                                                <SelectContent className=\"bg-[#0A192F] border-white/10 text-white\">\r\n                                                    <SelectItem value=\"cash\">Cash</SelectItem>\r\n                                                    <SelectItem value=\"upi\">UPI / GPay</SelectItem>\r\n                                                    <SelectItem value=\"cheque\">Cheque</SelectItem>\r\n                                                    <SelectItem value=\"bank_transfer\">Transfer</SelectItem>\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label>Date</Label>\r\n                                            <Input type=\"date\" required className=\"bg-white/5 border-white/10 h-10\" value={feeForm.date} onChange={e => setFeeForm({ ...feeForm, date: e.target.value })} />\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Remarks</Label>\r\n                                        <Input placeholder=\"Note...\" className=\"bg-white/5 border-white/10 h-10\" value={feeForm.remarks} onChange={e => setFeeForm({ ...feeForm, remarks: e.target.value })} />\r\n                                    </div>\r\n                                    <DialogFooter>\r\n                                        <Button type=\"submit\" disabled={collectingFee} className=\"w-full bg-emerald-600 hover:bg-emerald-700\">\r\n                                            {collectingFee ? <Loader2 className=\"animate-spin\" /> : \"Confirm Payment\"}\r\n                                        </Button>\r\n                                    </DialogFooter>\r\n                                </form>\r\n                            </DialogContent>\r\n                        </Dialog>\r\n                    )}\r\n\r\n                    {isEditing ? (\r\n                        <div className=\"flex items-center gap-1.5 md:gap-2\">\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => setIsEditing(false)} className=\"h-8 text-[10px] md:text-xs\">Cancel</Button>\r\n                            <Button size=\"sm\" onClick={handleUpdate} className=\"h-8 bg-blue-600 hover:bg-blue-700 text-white text-[10px] md:text-xs px-3\">Save</Button>\r\n                        </div>\r\n                    ) : (\r\n                        (role === \"ADMIN\" || role === \"MANAGER\") && (\r\n                            <div className=\"flex items-center gap-1.5 md:gap-2\">\r\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => setIsResetModalOpen(true)} className=\"h-8 md:h-9 border-white/10 bg-white/5 text-[9px] md:text-sm px-1.5 md:px-4\">\r\n                                    <Lock className=\"w-3 h-3 md:w-3.5 md:h-3.5 mr-1\" /> <span className=\"hidden sm:inline\">Reset</span>\r\n                                </Button>\r\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => setIsEditing(true)} className=\"h-8 md:h-9 border-white/10 bg-white/5 text-[9px] md:text-sm px-1.5 md:px-4\">\r\n                                    <Edit className=\"w-3 h-3 md:w-3.5 md:h-3.5 mr-1\" /> Edit\r\n                                </Button>\r\n                                {role === \"ADMIN\" && (\r\n                                    <Button variant=\"destructive\" size=\"sm\" onClick={() => setIsDeleteModalOpen(true)} className=\"h-8 md:h-9 bg-red-500/10 border-red-500/20 text-red-500 hover:bg-red-500/20 px-1.5 md:px-3\">\r\n                                        <ShieldAlert className=\"w-3 h-3 md:w-3.5 md:h-3.5\" />\r\n                                    </Button>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-4\">\r\n                {/* Left Column */}\r\n                <div className=\"lg:col-span-2 space-y-3 md:space-y-4\">\r\n                    <Card className=\"bg-black/20 border-white/10 backdrop-blur-sm\">\r\n                        <CardHeader className=\"py-2 md:py-3 px-1.5 md:px-6\">\r\n                            <CardTitle className=\"text-xs md:text-xl font-bold text-accent italic\">Personal Information</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"grid grid-cols-2 gap-x-2 md:gap-x-3 gap-y-2 md:gap-y-3 px-1.5 md:px-6 pb-3 md:pb-6\">\r\n                            <div className=\"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Student Name</Label>\r\n                                <Input disabled={!isEditing} className=\"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm font-bold disabled:opacity-100\" value={editForm.studentName} onChange={e => setEditForm({ ...editForm, studentName: e.target.value })} />\r\n                            </div>\r\n                            <div className=\"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Parent Name</Label>\r\n                                <Input disabled={!isEditing} className=\"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm disabled:opacity-100\" value={editForm.parentName} onChange={e => setEditForm({ ...editForm, parentName: e.target.value })} />\r\n                            </div>\r\n                            <div className=\"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Mobile / Password</Label>\r\n                                <Input disabled={!isEditing} className=\"bg-white/5 border-white/10 font-mono h-8 md:h-10 text-[12px] md:text-sm disabled:opacity-100\" value={editForm.parentMobile} onChange={e => setEditForm({ ...editForm, parentMobile: e.target.value })} />\r\n                            </div>\r\n                            <div className=\"space-y-0.5 md:space-y-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Village</Label>\r\n                                <Select disabled={!isEditing} value={editForm.villageId} onValueChange={v => setEditForm({ ...editForm, villageId: v })}>\r\n                                    <SelectTrigger className=\"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100\"><SelectValue placeholder=\"Village\" /></SelectTrigger>\r\n                                    <SelectContent className=\"bg-[#0A192F] border-white/10\">{villages.map(v => <SelectItem key={v.id} value={v.id}>{v.name}</SelectItem>)}</SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-0.5 md:space-y-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Class</Label>\r\n                                <Select disabled={!isEditing} value={editForm.classId} onValueChange={v => setEditForm({ ...editForm, classId: v })}>\r\n                                    <SelectTrigger className=\"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100\"><SelectValue placeholder=\"Class\" /></SelectTrigger>\r\n                                    <SelectContent className=\"bg-[#0A192F] border-white/10\">{classes.map(c => <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>)}</SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-0.5 md:space-y-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Section</Label>\r\n                                <Select disabled={!isEditing} value={editForm.sectionId} onValueChange={v => setEditForm({ ...editForm, sectionId: v })}>\r\n                                    <SelectTrigger className=\"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100\"><SelectValue placeholder=\"Section\" /></SelectTrigger>\r\n                                    <SelectContent className=\"bg-[#0A192F] border-white/10\">{sections.map(s => <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>)}</SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-0.5 md:space-y-1\">\r\n                                <Label className=\"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter\">Status</Label>\r\n                                <Select disabled={!isEditing} value={editForm.status} onValueChange={v => setEditForm({ ...editForm, status: v })}>\r\n                                    <SelectTrigger className=\"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100\"><SelectValue /></SelectTrigger>\r\n                                    <SelectContent className=\"bg-[#0A192F] border-white/10\">\r\n                                        <SelectItem value=\"ACTIVE\">Active</SelectItem>\r\n                                        <SelectItem value=\"PROMOTED\">Promoted</SelectItem>\r\n                                        <SelectItem value=\"DETAINED\">Detained</SelectItem>\r\n                                        <SelectItem value=\"INACTIVE\">Inactive</SelectItem>\r\n                                        <SelectItem value=\"ALUMNI\">Alumni</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"bg-black/20 border-white/10\">\r\n                        <CardHeader className=\"flex flex-row items-center justify-between py-2 md:py-3 px-1.5 md:px-6\">\r\n                            <CardTitle className=\"text-xs md:text-xl font-bold text-accent italic\">Fee Structure</CardTitle>\r\n                            <div className=\"flex gap-1\">\r\n                                {(role === \"ADMIN\" || role === \"MANAGER\") && (\r\n                                    <Button variant=\"outline\" size=\"sm\" onClick={handleRecalculateFees} disabled={recalculating} className=\"h-6 px-1.5 md:h-7 md:px-2 border-white/10 bg-white/5 text-[8px] md:text-[9px] font-bold\">\r\n                                        <RefreshCw className={`w-2.5 h-2.5 md:w-3 md:h-3 mr-1 ${recalculating ? \"animate-spin\" : \"\"}`} /> Sync\r\n                                    </Button>\r\n                                )}\r\n                                <Button variant=\"outline\" size=\"sm\" className=\"h-6 px-1.5 md:h-7 md:px-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 text-[8px] md:text-[9px] font-bold\" onClick={() => ledger && printStudentFeeStructure({ studentName: student.studentName, schoolId: student.schoolId, className: student.className, items: ledger.items || [], totalPaid: ledger.totalPaid || 0, schoolLogo: branding?.schoolLogo, schoolName: branding?.schoolName })}>\r\n                                    <Printer className=\"w-2.5 h-2.5 md:w-3 md:h-3 mr-1\" />\r\n                                </Button>\r\n                                {(role === \"ADMIN\" || role === \"MANAGER\") && (\r\n                                    <Button variant=\"outline\" size=\"sm\" className=\"h-6 px-1.5 md:h-7 md:px-2 border-white/10 bg-white/5 text-[8px] md:text-[9px] font-bold\" onClick={() => setIsAdjustModalOpen(true)}>\r\n                                        <Settings2 className=\"w-2.5 h-2.5 md:w-3 md:h-3 mr-1\" /> Adjust\r\n                                    </Button>\r\n                                )}\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"px-1.5 md:px-6 pb-3\">\r\n                            {!ledger || !ledger.items || ledger.items.length === 0 ? (\r\n                                <div className=\"text-center py-6 text-muted-foreground border border-dashed border-white/10 rounded-lg text-xs bg-white/5\">\r\n                                    No fee structure assigned. Update details or click Sync.\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"w-full overflow-x-auto custom-scrollbar\">\r\n                                    <table className=\"w-full border-collapse min-w-[600px]\">\r\n                                        <thead>\r\n                                            <tr className=\"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black border-b border-white/10 italic\">\r\n                                                <th className=\"px-1 md:px-3 py-2 text-left\">Fee Item</th>\r\n                                                <th className=\"px-1 md:px-2 py-2 text-right\">Total</th>\r\n                                                <th className=\"px-1 md:px-2 py-2 text-right\">Paid</th>\r\n                                                <th className=\"px-1 md:px-2 py-2 text-right\">Due</th>\r\n                                                <th className=\"px-1 md:px-3 py-2 text-right\">Status</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody>\r\n                                            {breakdown.items.map((item) => (\r\n                                                <tr key={item.id} className=\"border-b border-white/5 hover:bg-white/5 transition-colors group\">\r\n                                                    <td className=\"px-1 md:px-3 py-2\">\r\n                                                        <div className=\"flex flex-col\">\r\n                                                            <span className=\"text-[11px] md:text-sm font-bold text-white group-hover:text-accent transition-colors leading-tight\">{item.name}</span>\r\n                                                            <span className=\"text-[7px] md:text-[9px] text-white/30 uppercase font-black tracking-tighter\">{item.type}</span>\r\n                                                        </div>\r\n                                                    </td>\r\n                                                    <td className=\"px-1 md:px-2 py-2 text-right font-mono text-[9px] md:text-xs text-white/70\">₹{item.amount.toLocaleString()}</td>\r\n                                                    <td className=\"px-1 md:px-2 py-2 text-right font-mono text-[9px] md:text-xs text-emerald-400\">₹{item.distributedPaid.toLocaleString()}</td>\r\n                                                    <td className=\"px-1 md:px-2 py-2 text-right font-mono text-[10px] md:text-xs text-red-400 font-bold\">₹{item.distributedDue.toLocaleString()}</td>\r\n                                                    <td className=\"px-1 md:px-3 py-2 text-right\">\r\n                                                        <span className={cn(\r\n                                                            \"inline-flex px-1 py-0.5 md:px-1.5 rounded-[4px] text-[7px] md:text-[9px] font-black uppercase tracking-tighter\",\r\n                                                            item.distributedStatus === \"PAID\" ? \"bg-emerald-500/10 text-emerald-400\" :\r\n                                                                item.distributedStatus === \"PARTIAL\" ? \"bg-amber-500/10 text-amber-500\" :\r\n                                                                    \"bg-red-500/10 text-red-500\"\r\n                                                        )}>\r\n                                                            {item.distributedStatus}\r\n                                                        </span>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"bg-black/20 border-white/10\">\r\n                        <CardHeader className=\"flex flex-row items-center justify-between py-2 md:py-3 px-1.5 md:px-6\">\r\n                            <CardTitle className=\"text-xs md:text-xl font-bold text-accent italic\">History</CardTitle>\r\n                            <History className=\"w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground\" />\r\n                        </CardHeader>\r\n                        <CardContent className=\"px-1.5 md:px-6 pb-3\">\r\n                            {payments.length === 0 ? (\r\n                                <div className=\"text-center py-4 text-muted-foreground border border-dashed border-white/10 rounded-lg text-[10px]\">No payments.</div>\r\n                            ) : (\r\n                                <div className=\"space-y-1\">\r\n                                    {payments.slice(0, 5).map(p => (\r\n                                        <div key={p.id} className=\"flex justify-between items-center px-2 md:px-3 py-1 md:py-1.5 rounded-lg bg-white/10 border border-white/10 group\">\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-[10px] md:text-xs font-bold flex items-center gap-1 md:gap-1.5\">\r\n                                                    <span className=\"uppercase text-[6px] md:text-[8px] font-black text-white/50 bg-black/40 px-1 py-0.5 rounded tracking-tighter\">{p.method}</span>\r\n                                                    {p.remarks || \"Fee Payment\"}\r\n                                                </span>\r\n                                                <span className=\"text-[8px] md:text-[10px] text-muted-foreground\">{p.date?.toDate ? p.date.toDate().toLocaleDateString() : p.date}</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-1 md:gap-2\">\r\n                                                <span className=\"font-mono font-black text-emerald-400 text-[10px] md:text-xs\">+₹{p.amount.toLocaleString()}</span>\r\n                                                <Button size=\"icon\" variant=\"ghost\" className=\"h-6 w-6\" onClick={() => printPaymentReceipt({ payment: p, student, ledger, schoolLogo: branding?.schoolLogo, schoolName: branding?.schoolName })}>\r\n                                                    <Printer className=\"w-3 h-3\" />\r\n                                                </Button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n\r\n                {/* Right Column */}\r\n                <div className=\"space-y-3 md:space-y-4\">\r\n                    <Card className=\"bg-gradient-to-br from-black/40 to-black/20 border-white/10 sticky top-6\">\r\n                        <CardHeader className=\"py-2 md:py-3 px-1.5 md:px-6\"><CardTitle className=\"text-[11px] md:text-base font-bold text-accent italic\">Overview</CardTitle></CardHeader>\r\n                        <CardContent className=\"space-y-3 md:space-y-4 px-1.5 md:px-6 pb-4 md:pb-6\">\r\n                            <div className=\"relative h-1.5 md:h-2 w-full bg-white/5 rounded-full overflow-hidden\">\r\n                                <div className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-emerald-600 to-emerald-400\" style={{ width: `${paymentProgress}%` }} />\r\n                            </div>\r\n                            <div className=\"space-y-3 md:space-y-4 pt-1 md:pt-2\">\r\n                                {/* Category Breakdown */}\r\n                                <div className=\"grid grid-cols-2 lg:grid-cols-1 gap-2 md:gap-3\">\r\n                                    <div className=\"bg-white/5 p-2 md:p-3 rounded-xl border border-white/5 space-y-1\">\r\n                                        <div className=\"flex justify-between items-center\">\r\n                                            <span className=\"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black tracking-tighter\">Term</span>\r\n                                            <span className=\"text-[10px] md:text-xs font-bold text-white\">₹{breakdown.termsTotal.toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between items-center border-t border-white/5 pt-1\">\r\n                                            <span className=\"text-[7px] md:text-[9px] text-white/30 uppercase font-black\">Due</span>\r\n                                            <span className=\"text-[9px] md:text-[10px] font-bold text-amber-500\">₹{breakdown.termsPending.toLocaleString()}</span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-white/5 p-2 md:p-3 rounded-xl border border-white/5 space-y-1\">\r\n                                        <div className=\"flex justify-between items-center\">\r\n                                            <span className=\"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black tracking-tighter\">Custom</span>\r\n                                            <span className=\"text-[10px] md:text-xs font-bold text-white\">₹{breakdown.customTotal.toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between items-center border-t border-white/5 pt-1\">\r\n                                            <span className=\"text-[7px] md:text-[9px] text-white/30 uppercase font-black\">Due</span>\r\n                                            <span className=\"text-[9px] md:text-[10px] font-bold text-amber-500\">₹{breakdown.customPending.toLocaleString()}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"p-2 md:p-4 bg-red-500/10 border border-red-500/20 rounded-xl space-y-2\">\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"font-black text-[8px] md:text-[10px] uppercase text-red-400 italic leading-none mb-1\">Total Due</span>\r\n                                        <span className={`font-mono font-black text-xl md:text-3xl ${dueAmount > 0 ? \"text-white\" : \"text-emerald-400\"}`}>\r\n                                            ₹{dueAmount.toLocaleString()}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    {dueAmount > 0 && (\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            onClick={() => student && printPendingFeeReport({\r\n                                                studentName: student.studentName,\r\n                                                schoolId: student.schoolId,\r\n                                                className: student.className,\r\n                                                items: breakdown.pending.map(p => ({\r\n                                                    name: p.name,\r\n                                                    amount: p.due,\r\n                                                    type: \"CUSTOM\" // Default for statement\r\n                                                })),\r\n                                                totalPaid: ledger?.totalPaid || 0,\r\n                                                schoolLogo: branding?.schoolLogo,\r\n                                                schoolName: branding?.schoolName\r\n                                            })}\r\n                                            className=\"w-full bg-white text-black hover:bg-zinc-200 font-bold h-8 md:h-10 rounded-lg shadow-lg text-[9px] md:text-sm\"\r\n                                        >\r\n                                            <Printer className=\"w-3 h-3 md:w-4 md:h-4 mr-2\" /> Statement\r\n                                        </Button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"bg-red-500/5 border-red-500/10\">\r\n                        <CardHeader className=\"py-2 px-3 md:px-4\"><CardTitle className=\"text-red-400 text-[8px] md:text-[10px] uppercase font-black tracking-widest italic\">Danger</CardTitle></CardHeader>\r\n                        <CardContent className=\"px-3 md:px-4 pb-3 md:pb-4\">\r\n                            <Button variant=\"destructive\" size=\"sm\" className=\"w-full bg-red-500/10 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/20 font-bold h-8 md:h-9 text-[9px] md:text-sm\" onClick={() => setIsDeleteModalOpen(true)}>\r\n                                <Trash2 className=\"w-3 h-3 md:w-3.5 md:h-3.5 mr-2\" /> Delete\r\n                            </Button>\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n\r\n                {/* Modals */}\r\n                {student && (\r\n                    <DeleteUserModal\r\n                        isOpen={isDeleteModalOpen}\r\n                        onClose={() => setIsDeleteModalOpen(false)}\r\n                        user={{ id: student.id, schoolId: student.schoolId, name: student.studentName, role: \"student\" }}\r\n                        checkEligibility={async () => {\r\n                            if (payments.length > 0) return { canDelete: false, reason: `Recorded ${payments.length} payments. Deactivate instead.` };\r\n                            return { canDelete: true };\r\n                        }}\r\n                        onDeactivate={async () => {\r\n                            await updateDoc(doc(db, \"students\", student!.id), { status: \"INACTIVE\" });\r\n                            setStudent(prev => prev ? { ...prev, status: \"INACTIVE\" } : null);\r\n                            alert(\"Student Deactivated\");\r\n                        }}\r\n                        onDelete={async (reason) => {\r\n                            await deleteDoc(doc(db, \"students\", student!.id));\r\n                            await addDoc(collection(db, \"audit_logs\"), { action: \"DELETE_USER_HARD\", targetId: student!.id, targetType: \"student\", reason, timestamp: Timestamp.now() });\r\n                            router.push(\"/admin/students\");\r\n                        }}\r\n                    />\r\n                )}\r\n\r\n                {ledger && student && (\r\n                    <AdjustFeesModal\r\n                        isOpen={isAdjustModalOpen}\r\n                        onClose={() => setIsAdjustModalOpen(false)}\r\n                        studentId={student.schoolId}\r\n                        ledgerItems={ledger.items}\r\n                        onSuccess={() => refreshData()}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Loader2, AlertTriangle } from \"lucide-react\";\r\nimport { toast } from \"@/lib/toast-store\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\n\r\ninterface AdjustFeesModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    studentId: string;\r\n    ledgerItems: any[];\r\n    onSuccess: () => void;\r\n}\r\n\r\nexport function AdjustFeesModal({ isOpen, onClose, studentId, ledgerItems, onSuccess }: AdjustFeesModalProps) {\r\n    const [selectedItemId, setSelectedItemId] = useState<string>(\"\");\r\n    const [adjType, setAdjType] = useState<\"DISCOUNT\" | \"OVERRIDE\">(\"DISCOUNT\");\r\n    const [value, setValue] = useState(\"\");\r\n    const [reason, setReason] = useState(\"\");\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    // Calculate current preview\r\n    const selectedItem = ledgerItems.find(i => i.id === selectedItemId);\r\n    const resultPreview = selectedItem && value ? (\r\n        adjType === \"DISCOUNT\"\r\n            ? Math.max(0, selectedItem.amount - Number(value))\r\n            : Number(value)\r\n    ) : null;\r\n\r\n\r\n\r\n    const { user } = useAuth();\r\n\r\n    const handleSubmit = async () => {\r\n        if (!selectedItemId || !value || !reason || !user) return;\r\n        setSubmitting(true);\r\n\r\n        try {\r\n            const token = await user.getIdToken();\r\n            const res = await fetch(\"/api/admin/fees/adjust\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"Authorization\": `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    studentId,\r\n                    adjustments: [{\r\n                        id: selectedItemId,\r\n                        type: adjType,\r\n                        value: Number(value)\r\n                    }],\r\n                    reason\r\n                })\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.error);\r\n\r\n            toast({\r\n                title: \"Fees Adjusted\",\r\n                description: \"Student fees have been updated.\",\r\n                type: \"success\"\r\n            });\r\n\r\n            onSuccess();\r\n            onClose();\r\n        } catch (e: any) {\r\n            toast({\r\n                title: \"Adjustment Failed\",\r\n                description: e.message || \"Could not update fees.\",\r\n                type: \"error\"\r\n            });\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"bg-black/95 border-white/10 text-white sm:max-w-[500px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Adjust Student Fees</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4 py-2\">\r\n                    <div className=\"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md flex items-start gap-2 text-xs text-yellow-500\">\r\n                        <AlertTriangle className=\"w-4 h-4 shrink-0\" />\r\n                        <p>Adjustments are permanently recorded in the audit log. Ensure you have authorization to offer discounts or overrides.</p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Select Fee Term</Label>\r\n                        <Select value={selectedItemId} onValueChange={setSelectedItemId}>\r\n                            <SelectTrigger className=\"bg-white/5 border-white/10\"><SelectValue placeholder=\"Choose term...\" /></SelectTrigger>\r\n                            <SelectContent>\r\n                                {ledgerItems.filter(i => i.status !== \"PAID\").map(item => (\r\n                                    <SelectItem key={item.id} value={item.id}>\r\n                                        {item.name} (Current: ₹{item.amount})\r\n                                    </SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Adjustment Type</Label>\r\n                            <Select value={adjType} onValueChange={(v: any) => setAdjType(v)}>\r\n                                <SelectTrigger className=\"bg-white/5 border-white/10\"><SelectValue /></SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"DISCOUNT\">Discount (Reduce by)</SelectItem>\r\n                                    <SelectItem value=\"OVERRIDE\">Override (Set to)</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Value (₹)</Label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                value={value}\r\n                                onChange={e => setValue(e.target.value)}\r\n                                className=\"bg-white/5 border-white/10\"\r\n                                placeholder=\"e.g. 5000\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {selectedItem && (\r\n                        <div className=\"flex justify-between items-center text-sm p-2 bg-white/5 rounded px-3\">\r\n                            <span className=\"text-muted-foreground\">New Amount:</span>\r\n                            <span className=\"font-mono font-bold text-emerald-400\">\r\n                                {resultPreview !== null ? `₹${resultPreview.toLocaleString()}` : \"-\"}\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Reason (Mandatory)</Label>\r\n                        <Input\r\n                            value={reason}\r\n                            onChange={e => setReason(e.target.value)}\r\n                            className=\"bg-white/5 border-white/10\"\r\n                            placeholder=\"e.g. Merit Scholarship, Sibling Discount\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={onClose}>Cancel</Button>\r\n                    <Button onClick={handleSubmit} disabled={submitting || !selectedItemId || !value || !reason} className=\"bg-emerald-600 hover:bg-emerald-700 text-white\">\r\n                        {submitting ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"Confirm Adjustment\"}\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}