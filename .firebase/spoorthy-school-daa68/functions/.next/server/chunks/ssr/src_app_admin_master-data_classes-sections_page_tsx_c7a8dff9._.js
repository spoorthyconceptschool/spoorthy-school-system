module.exports=[7774,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(99570),e=a.i(66718),f=a.i(14574),g=a.i(75083),h=a.i(91119),i=a.i(91410),j=a.i(20237);a.i(72029);var k=a.i(50455),l=a.i(81560),m=a.i(15618),n=a.i(53722),o=a.i(67453),p=a.i(69769),q=a.i(60246),r=a.i(84505),s=a.i(71931),t=a.i(33441);a.i(69387);var u=a.i(60574),v=a.i(64550),w=a.i(68114);function x(){let{classes:a,sections:x,classSections:y,subjects:z,classSubjects:A,subjectTeachers:B,branding:C,loading:D}=(0,i.useMasterData)(),[E,F]=(0,c.useState)("classes"),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)([]);(0,c.useEffect)(()=>{(async()=>{try{let a=(0,u.query)((0,u.collection)(j.db,"teachers"),(0,u.orderBy)("name")),b=await (0,u.getDocs)(a);N(b.docs.map(a=>({id:a.id,...a.data()})))}catch(a){console.error("Failed to fetch teachers",a)}})()},[]);let O=async()=>{if(!G)return;L(!0);let a=(0,k.push)((0,k.ref)(j.rtdb,"master/classes"));await (0,k.set)(a,{id:a.key,name:G,order:I}),H(""),L(!1)},P=async a=>{confirm("Delete this Class?")&&await (0,k.remove)((0,k.ref)(j.rtdb,`master/classes/${a}`))},Q=async()=>{if(!G)return;L(!0);let a=(0,k.push)((0,k.ref)(j.rtdb,"master/sections"));await (0,k.set)(a,{id:a.key,name:G}),H(""),L(!1)},R=async a=>{confirm("Delete this Section?")&&await (0,k.remove)((0,k.ref)(j.rtdb,`master/sections/${a}`))},S=async(a,b,c)=>{let d=`${a}_${b}`,e=(0,k.ref)(j.rtdb,`master/classSections/${d}`);c?await (0,k.remove)(e):await (0,k.set)(e,{id:d,classId:a,sectionId:b,active:!0})},T=async(a,b)=>{if(!a)return;let c=(0,k.ref)(j.rtdb,`master/classSections/${a}/classTeacherId`);await (0,k.set)(c,b)},U=(a,b)=>!!y[`${a}_${b}`],V=()=>Object.values(y).filter(a=>a.active),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)(!1),$=b=>Object.values(y).filter(a=>a.active&&b.includes(a.id)).map(b=>{let c=Object.keys(A[b.classId]||{}).filter(a=>"id"!==a&&A[b.classId][a]&&z[a]).map(a=>({name:z[a].name,teacher:M.find(c=>c.id===B[`${b.classId}_${b.sectionId}`]?.[a])?.name||"Not Assigned"}));return{className:a[b.classId]?.name||"N/A",sectionName:x[b.sectionId]?.name||"N/A",classTeacher:M.find(a=>a.id===b.classTeacherId)?.name||"N/A",subjects:c}}).sort((a,b)=>a.className.localeCompare(b.className)||a.sectionName.localeCompare(b.sectionName));return D?(0,b.jsx)("div",{className:"p-10 text-center animate-pulse",children:"Loading Academy Data..."}):(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6 max-w-none p-0 animate-in fade-in",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 md:gap-0 px-1",children:[(0,b.jsx)("h1",{className:"text-xl md:text-3xl font-display font-bold",children:"Academic Structure"}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(f.Dialog,{open:Y,onOpenChange:Z,children:[(0,b.jsx)(f.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"outline",size:"sm",className:"w-full md:w-auto gap-2 bg-emerald-500/10 border-emerald-500/20 text-emerald-400 hover:bg-emerald-500/20",children:[(0,b.jsx)(r.Download,{size:14})," Export / Print Reports"]})}),(0,b.jsxs)(f.DialogContent,{className:"bg-black/95 border-white/10 text-white max-w-xl",children:[(0,b.jsx)(f.DialogHeader,{children:(0,b.jsx)(f.DialogTitle,{children:"Select Classes for Report"})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-4 max-h-[400px] overflow-y-auto pr-2",children:[(0,b.jsxs)("div",{className:"col-span-2 flex justify-between items-center px-2 py-1",children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("button",{className:"text-[10px] uppercase tracking-widest text-accent hover:underline font-bold",onClick:()=>{X(V().map(a=>a.id))},children:"Select All"}),(0,b.jsx)("button",{className:"text-[10px] uppercase tracking-widest text-white/40 hover:text-white",onClick:()=>X([]),children:"Clear All"})]}),(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[W.length," Selected"]})]}),V().sort((b,c)=>{let d=a[b.classId]?.order||0,e=a[c.classId]?.order||0;return d!==e?d-e:(x[b.sectionId]?.name||"").localeCompare(x[c.sectionId]?.name||"")}).map(c=>{let d=W.includes(c.id);return(0,b.jsxs)("div",{onClick:()=>{X(a=>d?a.filter(a=>a!==c.id):[...a,c.id])},className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${d?"bg-white/10 border-white/40":"bg-white/5 border-white/5 opacity-60 hover:opacity-100"}`,children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-bold text-sm",children:a[c.classId]?.name}),(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:["Section ",x[c.sectionId]?.name]})]}),d&&(0,b.jsx)(t.Check,{size:14,className:"text-emerald-400"})]},c.id)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[(0,b.jsxs)(d.Button,{disabled:0===W.length,onClick:()=>{let a;return a=$(W),void((0,v.exportAcademicLoad)(a),Z(!1))},className:"bg-emerald-500 text-white hover:bg-emerald-600 gap-2",children:[(0,b.jsx)(r.Download,{size:16})," Excel Export ",`(${W.length})`]}),(0,b.jsxs)(d.Button,{disabled:0===W.length,onClick:()=>(a=>{let b=$(a),c=window.open("","_blank");if(!c)return;let d=`
            <html>
                <head>
                    <title>Academic Assignments Report</title>
                    <style>
                        body { font-family: sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background-color: #f4f4f4; }
                        .header { display: flex; align-items: center; justify-content: center; gap: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                        .logo { height: 80px; width: auto; object-fit: contain; }
                        .header-text { text-align: left; }
                        h1 { margin: 0; font-size: 28px; }
                        .section-title { font-size: 20px; font-weight: bold; margin-top: 10px; border-bottom: 2px solid #333; padding-bottom: 5px; }
                        .page-container { page-break-after: always; padding-bottom: 40px; }
                        /* Don't add a page break after the last item */
                        .page-container:last-child { page-break-after: auto; }
                    </style>
                </head>
                <body>
                    ${b.map(a=>`
                        <div class="page-container">
                            <div class="header">
                                ${C?.schoolLogo?`<img src="${C.schoolLogo}" class="logo" />`:""}
                                <div class="header-text">
                                    <h1>${C?.schoolName||"Spoorthy Concept School"}</h1>
                                    <h3 style="margin: 5px 0 0 0; color: #666;">Academic Assignments: ${a.className} - ${a.sectionName}</h3>
                                </div>
                            </div>
                            <p style="text-align: right; font-size: 10px;">Generated: ${new Date().toLocaleString()}</p>
                            
                            <p><strong>Primary Class Teacher:</strong> ${a.classTeacher}</p>
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 50%">Subject</th>
                                        <th>Assigned Teacher</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${a.subjects.length>0?a.subjects.map(a=>`<tr><td>${a.name}</td><td>${a.teacher}</td></tr>`).join(""):'<tr><td colspan="2" style="text-align:center;">No Subjects Assigned</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    `).join("")}
                    <script>window.onload = () => { window.print(); window.close(); };</script>
                </body>
            </html>
        `;c.document.write(d),c.document.close(),Z(!1)})(W),className:"bg-zinc-100 text-black hover:bg-zinc-200 gap-2",children:[(0,b.jsx)(s.Printer,{size:16})," Print View ",`(${W.length})`]})]})]})]})})]}),(0,b.jsxs)(g.Tabs,{value:E,onValueChange:F,children:[(0,b.jsxs)(g.TabsList,{className:"bg-white/5 border border-white/10 w-full justify-start overflow-x-auto no-scrollbar",children:[(0,b.jsx)(g.TabsTrigger,{value:"classes",className:"flex-1 md:flex-none",children:"Classes"}),(0,b.jsx)(g.TabsTrigger,{value:"sections",children:"Sections"}),(0,b.jsx)(g.TabsTrigger,{value:"combinations",children:"Combinations"})]}),(0,b.jsxs)(g.TabsContent,{value:"classes",className:"space-y-4 mt-4",children:[(0,b.jsx)(h.Card,{className:"bg-black/20 border-white/10 p-4",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Input,{placeholder:"Class Name (e.g. Grade 1)",value:G,onChange:a=>H(a.target.value)}),(0,b.jsx)(e.Input,{type:"number",placeholder:"Order",className:"w-24",value:I,onChange:a=>J(Number(a.target.value))}),(0,b.jsxs)(d.Button,{onClick:O,disabled:K,className:"bg-white text-black hover:bg-zinc-200",children:[(0,b.jsx)(m.Plus,{size:16,className:"mr-2"})," Add"]})]})}),(0,b.jsx)("div",{className:"grid gap-2",children:Object.values(a).sort((a,b)=>a.order-b.order).map(a=>(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-3 md:gap-0 p-4 bg-white/5 border border-white/10 rounded-xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between w-full md:w-auto md:gap-4",children:[(0,b.jsx)("span",{className:"font-bold text-lg",children:a.name}),(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground bg-white/5 px-2 py-0.5 rounded border border-white/10 uppercase tracking-widest",children:["Order: ",a.order]})]}),(0,b.jsxs)("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[(0,b.jsxs)(f.Dialog,{children:[(0,b.jsx)(f.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"outline",size:"sm",className:"gap-2 border-indigo-500/20 bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20",children:[(0,b.jsx)(n.BookOpen,{size:14})," Subjects"]})}),(0,b.jsxs)(f.DialogContent,{className:"bg-black/95 border-white/10 text-white max-w-md",children:[(0,b.jsx)(f.DialogHeader,{children:(0,b.jsxs)(f.DialogTitle,{children:["Subjects: ",a.name]})}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-2 mt-4 max-h-[400px] overflow-y-auto pr-2",children:Object.values(z||{}).map(c=>{let d=A[a.id]?.[c.id];return(0,b.jsxs)("div",{onClick:async()=>await (0,k.set)((0,k.ref)(j.rtdb,`master/classSubjects/${a.id}/${c.id}`),!d),className:`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all ${d?"bg-indigo-500/20 border-indigo-500/50":"bg-white/5 border-white/10 opacity-50 hover:opacity-100"}`,children:[(0,b.jsx)("span",{className:"font-medium",children:c.name}),d&&(0,b.jsx)(o.CheckCircle2,{size:16,className:"text-indigo-400"})]},c.id)})})]})]}),(0,b.jsxs)(f.Dialog,{children:[(0,b.jsx)(f.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"outline",size:"sm",className:"gap-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20",children:[(0,b.jsx)(p.GraduationCap,{size:14})," Staffing"]})}),(0,b.jsxs)(f.DialogContent,{className:"bg-black/95 border-white/10 text-white max-w-2xl",children:[(0,b.jsx)(f.DialogHeader,{children:(0,b.jsxs)(f.DialogTitle,{children:["Academic Assignments: ",a.name]})}),(0,b.jsx)("div",{className:"space-y-6 mt-4 max-h-[70vh] overflow-y-auto pr-2",children:Object.values(y).filter(b=>b.classId===a.id).map(c=>{let d=Object.keys(A[a.id]||{}).filter(b=>A[a.id][b]&&z[b]);return(0,b.jsxs)("div",{className:"p-4 bg-white/5 border border-white/10 rounded-xl space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between border-b border-white/10 pb-2",children:(0,b.jsxs)("span",{className:"font-bold text-emerald-400 flex items-center gap-2",children:[(0,b.jsx)(q.Users,{size:16})," Section ",x[c.sectionId]?.name]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 py-2 border-b border-white/5",children:[(0,b.jsx)("span",{className:"text-sm font-bold text-white",children:"Class Teacher"}),(0,b.jsxs)("select",{className:"bg-black border border-white/10 rounded px-2 py-1 text-xs w-[200px]",value:c.classTeacherId||"",onChange:a=>T(c.id,a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- No Class Teacher --"}),M.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wider font-bold",children:"Subject Teachers"}),d.map(d=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4 pl-2",children:[(0,b.jsx)("span",{className:"text-sm text-zinc-400",children:z[d]?.name}),(0,b.jsxs)("select",{className:"bg-black/40 border border-white/10 rounded px-2 py-1 text-xs w-[200px]",value:B[`${a.id}_${c.sectionId}`]?.[d]||"",onChange:async b=>await (0,k.set)((0,k.ref)(j.rtdb,`master/subjectTeachers/${a.id}_${c.sectionId}/${d}`),b.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- No Teacher --"}),M.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]},d))]})]},c.id)})})]})]}),(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>P(a.id),className:"text-red-500 hover:bg-red-500/10",children:(0,b.jsx)(l.Trash2,{size:14})})]})]},a.id))})]}),(0,b.jsxs)(g.TabsContent,{value:"sections",className:"space-y-4 mt-4",children:[(0,b.jsx)(h.Card,{className:"bg-black/20 border-white/10 p-4",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Input,{placeholder:"Section Name (e.g. A, B, Alpha)",value:G,onChange:a=>H(a.target.value)}),(0,b.jsxs)(d.Button,{onClick:Q,disabled:K,className:"bg-white text-black hover:bg-zinc-200",children:[(0,b.jsx)(m.Plus,{size:16,className:"mr-2"})," Add"]})]})}),(0,b.jsx)("div",{className:"grid gap-2",children:Object.values(x).map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center p-4 bg-white/5 border border-white/10 rounded-xl",children:[(0,b.jsx)("span",{className:"font-bold text-lg",children:a.name}),(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>R(a.id),className:"text-red-500 hover:bg-red-500/10",children:(0,b.jsx)(l.Trash2,{size:14})})]},a.id))})]}),(0,b.jsx)(g.TabsContent,{value:"combinations",className:"mt-4 space-y-4",children:(0,b.jsxs)(h.Card,{className:"bg-black/20 border-white/10 p-4 md:p-6 overflow-hidden",children:[(0,b.jsx)("div",{className:"grid grid-cols-1 gap-3 md:hidden",children:Object.values(a).sort((a,b)=>a.order-b.order).map(a=>(0,b.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-white/10",children:[(0,b.jsx)(p.GraduationCap,{size:16,className:"text-accent"}),(0,b.jsx)("span",{className:"font-bold text-white uppercase tracking-tighter",children:a.name})]}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.values(x).map(c=>{let d=U(a.id,c.id);return(0,b.jsxs)("div",{onClick:()=>S(a.id,c.id,d),className:(0,w.cn)("flex flex-col items-center justify-center p-2 rounded-xl border transition-all cursor-pointer",d?"bg-accent/20 border-accent/40 text-accent font-black":"bg-white/5 border-white/5 text-white/20"),children:[(0,b.jsx)("span",{className:"text-[10px] uppercase font-bold",children:c.name}),(0,b.jsx)("div",{className:(0,w.cn)("w-1.5 h-1.5 rounded-full mt-1.5",d?"bg-accent shadow-[0_0_8px_rgba(100,255,218,0.8)]":"bg-white/10")})]},c.id)})})]},a.id))}),(0,b.jsx)("div",{className:"hidden md:block overflow-x-auto custom-scrollbar",children:(0,b.jsxs)("table",{className:"w-full border-collapse min-w-[700px]",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-white/5 italic",children:[(0,b.jsx)("th",{className:"p-3 border border-white/10 text-left text-[10px] font-black uppercase tracking-widest text-muted-foreground w-40",children:"Class \\ Section"}),Object.values(x).map(a=>(0,b.jsx)("th",{className:"p-3 border border-white/10 text-center text-[10px] font-black uppercase tracking-widest text-muted-foreground",children:a.name},a.id))]})}),(0,b.jsx)("tbody",{children:Object.values(a).sort((a,b)=>a.order-b.order).map(a=>(0,b.jsxs)("tr",{className:"hover:bg-white/5 transition-colors",children:[(0,b.jsx)("td",{className:"p-3 border border-white/10 font-bold bg-white/5 text-white",children:a.name}),Object.values(x).map(c=>{let d=U(a.id,c.id);return(0,b.jsx)("td",{className:"p-3 border border-white/10 text-center",children:(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)("input",{type:"checkbox",checked:d,onChange:()=>S(a.id,c.id,d),className:"w-5 h-5 cursor-pointer accent-accent"})})},c.id)})]},a.id))})]})})]})})]})]})}a.s(["default",()=>x])}];

//# sourceMappingURL=src_app_admin_master-data_classes-sections_page_tsx_c7a8dff9._.js.map