module.exports=[91311,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(20237),f=a.i(99570),g=a.i(80701),h=a.i(91119),i=a.i(75083),j=a.i(66718),k=a.i(96221),l=a.i(14548),m=a.i(15618),n=a.i(81560),o=a.i(41675);let p=(0,a.i(70106).default)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);var q=a.i(71931),r=a.i(91410),s=a.i(56025),t=a.i(14574),u=a.i(70430),v=a.i(29246),w=a.i(56711),x=a.i(67937),x=x,y=a.i(88110);function z(){let{user:a}=(0,s.useAuth)(),[g,h]=(0,c.useState)(!1),[i,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(new Date),[q,r]=(0,c.useState)(""),z=async b=>{if(b.preventDefault(),m&&o){l(!0);try{let b=new Date(o);b.setHours(0,0,0,0);let c=new Date(o);c.setHours(23,59,59,999),await (0,d.addDoc)((0,d.collection)(e.db,"notices"),{title:`Holiday: ${m}`,content:q||"No classes due to holiday.",type:"HOLIDAY",target:"ALL",date:d.Timestamp.fromDate(b),createdAt:d.Timestamp.now(),expiresAt:d.Timestamp.fromDate(c),senderId:a?.uid,senderName:a?.displayName||"Admin",senderRole:"ADMIN",status:"ACTIVE"}),(0,y.toast)({title:"Holiday Declared",description:`Holiday '${m}' on ${(0,w.format)(o,"PPP")} added.`,type:"success"}),h(!1),n(""),r("")}catch(a){console.error(a),(0,y.toast)({title:"Error",description:a.message,type:"error"})}finally{l(!1)}}};return(0,b.jsxs)(t.Dialog,{open:g,onOpenChange:h,children:[(0,b.jsx)(t.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"destructive",className:"ml-2 gap-2",children:[(0,b.jsx)(x.default,{className:"w-4 h-4"}),"Declare Holiday"]})}),(0,b.jsxs)(t.DialogContent,{className:"sm:max-w-[425px] bg-black/90 border-white/10 text-white",children:[(0,b.jsxs)(t.DialogHeader,{children:[(0,b.jsx)(t.DialogTitle,{children:"Declare Holiday"}),(0,b.jsx)(t.DialogDescription,{children:"Adding a holiday will block the timetable for the chosen date and notify all users."})]}),(0,b.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Holiday Name"}),(0,b.jsx)(j.Input,{value:m,onChange:a=>n(a.target.value),placeholder:"e.g. Festival, Weather Alert",className:"bg-white/5 border-white/10",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Date"}),(0,b.jsx)(j.Input,{type:"date",value:o?(0,w.format)(o,"yyyy-MM-dd"):"",onChange:a=>p(a.target.value?new Date(a.target.value):void 0),className:"bg-white/5 border-white/10",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Description / Note"}),(0,b.jsx)(v.Textarea,{value:q,onChange:a=>r(a.target.value),placeholder:"Optional details...",className:"bg-white/5 border-white/10"})]}),(0,b.jsx)(f.Button,{type:"submit",disabled:i,className:"w-full bg-red-600 hover:bg-red-700 text-white",children:i?(0,b.jsx)(k.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):"Declare Holiday"})]})]})]})}var A=a.i(33441),B=a.i(68114);function C(){let{classes:a,sections:g,classSections:h,subjects:i,branding:j}=(0,r.useMasterData)(),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)([]),[p,s]=(0,c.useState)(!1),u=Object.values(a).sort((a,b)=>(a.order||0)-(b.order||0)),v=Object.values(g),w=Object.values(i),x=async()=>{if(0!==n.length){s(!0);try{let b=[],c=await (0,d.getDoc)((0,d.doc)(e.db,"timetable_settings","global_settings")),f=c.exists()&&c.data().dayTemplates?.MONDAY?c.data().dayTemplates.MONDAY.slots:[];if(0===f.length){alert("Day structure template not found. Please configure the global structure first."),s(!1);return}let h=(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,"teachers"),(0,d.where)("status","==","ACTIVE")))).docs.map(a=>({id:a.id,...a.data()}));for(let c of n){let[h,i]=c.split("_"),j=(0,d.doc)(e.db,"timetables",`2025-2026_${h}_${i}`),k=await (0,d.getDoc)(j);if(k.exists()){let c=a[h],d=g[i];b.push({className:c?.name||"Unknown Class",sectionName:d?.name||"Unknown Section",schedule:k.data().schedule||{},dayTemplate:f})}}if(0===b.length){alert("No published timetables found for selected classes."),s(!1);return}y(b,h)}catch(a){console.error(a),alert("Failed to prepare print job.")}finally{s(!1),m(!1)}}},y=(a,b)=>{let c=window.open("","_blank");if(!c)return;let d=`
            <html>
                <head>
                    <title>Bulk Timetable Print</title>
                    <style>
                        body { font-family: sans-serif; color: #333; margin: 0; padding: 0; }
                        .page { padding: 40px; page-break-after: always; min-height: 100vh; display: flex; flex-direction: column; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .header img { height: 60px; margin-bottom: 10px; }
                        .header h1 { margin: 0; color: #1a365d; font-size: 24px; text-transform: uppercase; }
                        .header p { margin: 5px 0; color: #718096; font-size: 14px; text-transform: uppercase; font-weight: bold; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; table-layout: fixed; }
                        th, td { border: 1px solid #e2e8f0; padding: 8px; text-align: center; font-size: 10px; height: 50px; word-wrap: break-word; }
                        th { background-color: #f8fafc; color: #4a5568; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; font-size: 9px; height: auto; }
                        .day-col { background-color: #f8fafc; font-weight: bold; width: 60px; text-transform: uppercase; }
                        .period-info { font-size: 8px; color: #a0aec0; margin-bottom: 2px; }
                        .subject { font-weight: bold; color: #2d3748; display: block; margin-bottom: 1px; }
                        .teacher { font-size: 8px; color: #718096; line-height: 1.1; }
                        .break { background-color: #f1f5f9; color: #94a3b8; font-weight: bold; font-style: italic; letter-spacing: 0.2em; }
                        .leisure { color: #cbd5e0; font-style: italic; }
                        @media print {
                            .page { padding: 0; }
                            @page { margin: 1cm; orientation: landscape; }
                        }
                    </style>
                </head>
                <body>
                    ${a.map(a=>`
                        <div class="page">
                            <div class="header">
                                ${j.schoolLogo?`<img src="${j.schoolLogo}" />`:""}
                                <h1>${j.schoolName||"SPOORTHY CONCEPT SCHOOL"}</h1>
                                <p>Academic Timetable: ${a.className} - ${a.sectionName}</p>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th class="day-col">Day</th>
                                        ${a.dayTemplate.map(a=>`
                                            <th>
                                                <div class="period-info">${a.startTime} - ${a.endTime}</div>
                                                <div>${a.name}</div>
                                            </th>
                                        `).join("")}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"].map(c=>`
                                        <tr>
                                            <td class="day-col">${c.substring(0,3)}</td>
                                            ${a.dayTemplate.map(d=>{if("BREAK"===d.type)return'<td class="break">BREAK</td>';let e=a.schedule[c]?.[d.id]||{};if(!e.subjectId)return"<td>-</td>";if("leisure"===e.subjectId)return'<td class="leisure">Leisure</td>';let f=w.find(a=>a.id===e.subjectId),g=b.find(a=>(a.schoolId||a.id)===e.teacherId);return`
                                                    <td>
                                                        <span class="subject">${f?.name||"Subject"}</span>
                                                        <span class="teacher">${g?.name||""}</span>
                                                    </td>
                                                `}).join("")}
                                        </tr>
                                    `).join("")}
                                </tbody>
                            </table>
                        </div>
                    `).join("")}
                    <script>window.onload = () => { window.print(); window.close(); };</script>
                </body>
            </html>
        `;c.document.write(d),c.document.close()};return(0,b.jsxs)(t.Dialog,{open:l,onOpenChange:m,children:[(0,b.jsx)(t.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",className:"gap-2 border-white/10 bg-white/5 text-white hover:bg-white/10 rounded-xl font-black uppercase tracking-widest text-[10px]",children:[(0,b.jsx)(q.Printer,{className:"w-4 h-4"})," Bulk Print"]})}),(0,b.jsxs)(t.DialogContent,{className:"max-w-2xl bg-[#0A192F] border-white/10 text-white max-h-[80vh] flex flex-col",children:[(0,b.jsxs)(t.DialogHeader,{children:[(0,b.jsxs)(t.DialogTitle,{className:"text-xl font-bold flex items-center gap-2",children:[(0,b.jsx)(q.Printer,{className:"text-accent"})," Bulk Print Timetables"]}),(0,b.jsx)(t.DialogDescription,{className:"text-muted-foreground uppercase text-[10px] font-bold tracking-widest",children:"Select multiple class-sections to generate a combined print report."})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto px-1 py-4 space-y-4 custom-scrollbar",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-3 rounded-xl border border-white/10",children:[(0,b.jsx)("span",{className:"text-xs font-bold uppercase tracking-widest opacity-60",children:"Selection Actions"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{let a=Object.keys(h);o(n.length===a.length?[]:a)},className:"text-[10px] uppercase font-black text-accent hover:bg-accent/10",children:n.length===Object.keys(h).length?"Deselect All":"Select All Available"})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.map(a=>{let c=Object.values(h).filter(b=>b.classId===a.id);return 0===c.length?null:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-[10px] font-black uppercase tracking-tighter text-muted-foreground ml-1",children:a.name}),(0,b.jsx)("div",{className:"space-y-1",children:c.map(a=>{let c=v.find(b=>b.id===a.sectionId),d=n.includes(a.id);return(0,b.jsx)("div",{onClick:()=>{var b;return b=a.id,void o(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:(0,B.cn)("flex items-center justify-between p-3 rounded-xl border transition-all cursor-pointer group",d?"bg-accent/10 border-accent/40 text-accent shadow-[0_0_15px_rgba(100,255,218,0.1)]":"bg-white/5 border-white/5 text-white/60 hover:border-white/20 hover:text-white"),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:(0,B.cn)("w-4 h-4 rounded border flex items-center justify-center transition-all",d?"bg-accent border-accent":"border-white/20 group-hover:border-white/40"),children:d&&(0,b.jsx)(A.Check,{className:"w-3 h-3 text-black stroke-[4]"})}),(0,b.jsxs)("span",{className:"text-xs font-bold uppercase tracking-widest",children:["Section ",c?.name||"?"]})]})},a.id)})})]},a.id)})})]}),(0,b.jsxs)(t.DialogFooter,{className:"border-t border-white/5 pt-4 bg-white/5 p-6 -mx-6 rounded-b-2xl",children:[(0,b.jsx)(f.Button,{variant:"ghost",onClick:()=>m(!1),disabled:p,className:"uppercase text-[10px] font-black tracking-widest",children:"Cancel"}),(0,b.jsxs)(f.Button,{onClick:x,disabled:p||0===n.length,className:"bg-accent text-black hover:bg-accent/80 uppercase text-[10px] font-black tracking-widest gap-2 shadow-lg shadow-accent/20",children:[p?(0,b.jsx)(k.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(q.Printer,{className:"w-4 h-4"}),"Print ",n.length," Timetables"]})]})]})]})}var D=a.i(38246);function E(){let{user:a}=(0,s.useAuth)(),{classes:t,sections:u,subjects:v,classSubjects:w,subjectTeachers:x,branding:y}=(0,r.useMasterData)(),[A,B]=(0,c.useState)("settings"),[E,F]=(0,c.useState)(!0),G=Object.values(t).map(a=>({id:a.id,name:a.name,order:a.order||99})).sort((a,b)=>a.order-b.order),H=Object.values(u||{}).map(a=>({id:a.id,name:a.name})),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)({}),[Q,R]=(0,c.useState)([]),[S,T]=(0,c.useState)([]);(0,c.useEffect)(()=>{W(),X()},[]);let[U,V]=(0,c.useState)([]);(0,c.useEffect)(()=>{if(!K)return void R([]);let a=w[K]||{};R(Object.values(v||{}).filter(b=>!1!==b.isActive&&a[b.id]).sort((a,b)=>a.name.localeCompare(b.name)))},[K,v,w]),(0,c.useEffect)(()=>{(async()=>{let a=(0,d.query)((0,d.collection)(e.db,"notices"),(0,d.where)("type","==","HOLIDAY"));V((await (0,d.getDocs)(a)).docs.map(a=>({id:a.id,...a.data()})))})()},[]),(0,c.useEffect)(()=>{K&&M&&Y(K,M)},[K,M]);let W=async()=>{try{let a=await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,"teachers"),(0,d.where)("status","==","ACTIVE")));T(a.docs.map(a=>({id:a.id,...a.data()})))}catch(a){console.error(a)}},X=async()=>{try{let a=await (0,d.getDoc)((0,d.doc)(e.db,"timetable_settings","global_settings"));a.exists()&&a.data().dayTemplates?.MONDAY?J(a.data().dayTemplates.MONDAY.slots):J([{id:1,name:"Period 1",type:"CLASS",startTime:"09:00",endTime:"09:45",isLeisureAllowed:!0},{id:2,name:"Period 2",type:"CLASS",startTime:"09:45",endTime:"10:30",isLeisureAllowed:!0},{id:3,name:"Short Break",type:"BREAK",startTime:"10:30",endTime:"10:45",isLeisureAllowed:!1},{id:4,name:"Period 3",type:"CLASS",startTime:"10:45",endTime:"11:30",isLeisureAllowed:!0}])}catch(a){console.error(a)}finally{F(!1)}},Y=async(a,b)=>{F(!0);try{let c=(0,d.doc)(e.db,"class_timetables",`2025-2026_${a}_${b}`),f=await (0,d.getDoc)(c);f.exists()?P(f.data().schedule||{}):P({})}catch(a){console.error(a)}finally{F(!1)}},Z=async()=>{F(!0);try{await (0,d.setDoc)((0,d.doc)(e.db,"timetable_settings","global_settings"),{dayTemplates:{MONDAY:{slots:I},TUESDAY:{slots:I},WEDNESDAY:{slots:I},THURSDAY:{slots:I},FRIDAY:{slots:I},SATURDAY:{slots:I}},updatedAt:new Date},{merge:!0}),alert("Global Timetable Structure Saved")}catch(a){alert("Error saving settings")}finally{F(!1)}},$=(a,b,c)=>{let d=[...I];d[a]={...d[a],[b]:c},J(d)},_=async()=>{if(K&&M&&a){F(!0);try{let b=await a.getIdToken();await fetch("/api/admin/timetable/publish",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({yearId:"2025-2026",classId:`${K}_${M}`,schedule:O})}),alert("Timetable Published Successfully!")}catch(a){alert("Publish failed")}finally{F(!1)}}};return(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6 max-w-none p-0 animate-in fade-in pb-24",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 px-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h1",{className:"text-2xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic leading-tight",children:"Timetable Manager"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-[10px] md:text-sm tracking-tight uppercase font-black opacity-50",children:["Design and publish ",(0,b.jsx)("span",{className:"text-accent",children:"academic schedules"})]})]}),(0,b.jsxs)("div",{className:"flex shrink-0 gap-2",children:[(0,b.jsx)(C,{}),(0,b.jsx)(z,{})]})]}),(0,b.jsxs)(i.Tabs,{value:A,onValueChange:B,className:"space-y-6",children:[(0,b.jsx)("div",{className:"px-2",children:(0,b.jsxs)(i.TabsList,{className:"bg-white/5 border border-white/10 w-full grid grid-cols-2 p-1 h-auto md:h-12 overflow-hidden",children:[(0,b.jsxs)(i.TabsTrigger,{value:"settings",className:"flex flex-col md:flex-row py-2.5 px-1 gap-1 md:gap-2 text-[7px] md:text-xs font-black uppercase tracking-tighter md:tracking-widest data-[state=active]:bg-accent data-[state=active]:text-black transition-all h-full text-center",children:[(0,b.jsx)(p,{className:"w-3.5 h-3.5 md:w-4 md:h-4 shrink-0"}),(0,b.jsx)("span",{children:"Structure"})]}),(0,b.jsxs)(i.TabsTrigger,{value:"builder",className:"flex flex-col md:flex-row py-2.5 px-1 gap-1 md:gap-2 text-[7px] md:text-xs font-black uppercase tracking-tighter md:tracking-widest data-[state=active]:bg-accent data-[state=active]:text-black transition-all h-full text-center",children:[(0,b.jsx)(o.Calendar,{className:"w-3.5 h-3.5 md:w-4 md:h-4 shrink-0"}),(0,b.jsx)("span",{children:"Builder"})]})]})}),(0,b.jsx)(i.TabsContent,{value:"settings",className:"space-y-6 px-2",children:(0,b.jsxs)(h.Card,{className:"bg-black/20 border-white/10 backdrop-blur-md overflow-hidden rounded-2xl",children:[(0,b.jsxs)(h.CardHeader,{className:"border-b border-white/5 bg-white/5 py-4 px-6",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm md:text-xl font-bold italic text-white",children:"Daily Structure Template"}),(0,b.jsx)(h.CardDescription,{className:"text-[10px] md:text-xs text-muted-foreground uppercase tracking-widest font-bold opacity-60",children:"Define periods and breaks for a standard day."})]}),(0,b.jsx)(h.CardContent,{className:"p-4 md:p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[I.map((a,c)=>(0,b.jsx)("div",{className:"relative group bg-white/5 border border-white/10 p-4 rounded-xl transition-all hover:bg-white/10",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center",children:[(0,b.jsxs)("div",{className:"md:col-span-4 flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 shrink-0 rounded-full bg-accent/20 border border-accent/30 flex items-center justify-center font-black text-[10px] text-accent",children:c+1}),(0,b.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,b.jsx)("label",{className:"text-[8px] font-black text-muted-foreground uppercase tracking-widest",children:"Description"}),(0,b.jsx)(j.Input,{value:a.name,onChange:a=>$(c,"name",a.target.value),className:"h-9 md:h-10 bg-black/40 border-white/10 text-xs md:text-sm font-bold",placeholder:"Name"})]})]}),(0,b.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-[8px] font-black text-muted-foreground uppercase tracking-widest",children:"Type"}),(0,b.jsxs)(g.Select,{value:a.type,onValueChange:a=>$(c,"type",a),children:[(0,b.jsx)(g.SelectTrigger,{className:"h-9 md:h-10 bg-black/40 border-white/10 text-xs md:text-sm",children:(0,b.jsx)(g.SelectValue,{})}),(0,b.jsxs)(g.SelectContent,{className:"bg-[#0A192F] border-white/10",children:[(0,b.jsx)(g.SelectItem,{value:"CLASS",children:"Class"}),(0,b.jsx)(g.SelectItem,{value:"BREAK",children:"Break"})]})]})]}),(0,b.jsxs)("div",{className:"md:col-span-4 grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-[8px] font-black text-muted-foreground uppercase tracking-widest",children:"Start"}),(0,b.jsx)(j.Input,{type:"time",value:a.startTime,onChange:a=>$(c,"startTime",a.target.value),className:"h-9 md:h-10 bg-black/40 border-white/10 text-xs font-mono"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-[8px] font-black text-muted-foreground uppercase tracking-widest",children:"End"}),(0,b.jsx)(j.Input,{type:"time",value:a.endTime,onChange:a=>$(c,"endTime",a.target.value),className:"h-9 md:h-10 bg-black/40 border-white/10 text-xs font-mono"})]})]}),(0,b.jsx)("div",{className:"md:col-span-2 flex justify-end md:pt-4",children:(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{J(I.filter((a,b)=>b!==c))},className:"w-full md:w-auto text-red-400 hover:text-white hover:bg-red-500/20 gap-2 font-bold uppercase tracking-tighter text-[10px]",children:[(0,b.jsx)(n.Trash2,{className:"w-3 h-3 md:w-4 md:h-4"})," Remove"]})})]})},c)),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-white/5",children:[(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>{let a=I.length+1;J([...I,{id:a,name:`Period ${a}`,type:"CLASS",startTime:"",endTime:"",isLeisureAllowed:!0}])},className:"h-10 md:h-12 border-dashed border-white/20 hover:bg-white/5 rounded-xl font-black uppercase tracking-widest text-[10px] md:text-xs",children:[(0,b.jsx)(m.Plus,{className:"w-4 h-4 mr-2"})," Add Period / Break"]}),(0,b.jsxs)(f.Button,{onClick:Z,className:"h-10 md:h-12 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-black uppercase tracking-widest text-[10px] md:text-xs shadow-lg shadow-emerald-900/20",children:[(0,b.jsx)(l.Save,{className:"w-4 h-4 mr-2"})," Save Global Configuration"]})]})]})})]})}),(0,b.jsxs)(i.TabsContent,{value:"builder",className:"space-y-6 px-2",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 bg-black/40 p-4 rounded-2xl border border-white/10 backdrop-blur-md",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-[8px] font-black text-muted-foreground uppercase tracking-widest ml-1",children:"Class"}),(0,b.jsxs)(g.Select,{value:K,onValueChange:L,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-full md:w-[180px] h-10 bg-white/5 border-white/10 rounded-xl text-xs",children:(0,b.jsx)(g.SelectValue,{placeholder:"Choose Class"})}),(0,b.jsx)(g.SelectContent,{className:"bg-[#0A192F] border-white/10",children:G.map(a=>(0,b.jsx)(g.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-[8px] font-black text-muted-foreground uppercase tracking-widest ml-1",children:"Section"}),(0,b.jsxs)(g.Select,{value:M,onValueChange:N,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-full md:w-[150px] h-10 bg-white/5 border-white/10 rounded-xl text-xs",children:(0,b.jsx)(g.SelectValue,{placeholder:"Section"})}),(0,b.jsx)(g.SelectContent,{className:"bg-[#0A192F] border-white/10",children:H.map(a=>(0,b.jsx)(g.SelectItem,{value:a.id,children:a.name},a.id))})]})]})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-wrap items-end justify-end gap-2 px-2 md:px-0",children:[(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>{if(!K||!M)return;let a=G.find(a=>a.id===K),b=H.find(a=>a.id===M),c=window.open("","_blank");if(!c)return;let d=`
            <html>
                <head>
                    <title>Timetable - ${a?.name} ${b?.name}</title>
                    <style>
                        body { font-family: sans-serif; padding: 20px; color: #333; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .header h1 { margin: 0; color: #1a365d; font-size: 24px; text-transform: uppercase; }
                        .header p { margin: 5px 0; color: #718096; font-size: 14px; text-transform: uppercase; font-weight: bold; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; table-layout: fixed; }
                        th, td { border: 1px solid #e2e8f0; padding: 12px 8px; text-align: center; font-size: 12px; height: 60px; word-wrap: break-word; }
                        th { background-color: #f8fafc; color: #4a5568; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; font-size: 10px; height: auto; }
                        .day-col { background-color: #f8fafc; font-weight: bold; width: 80px; text-transform: uppercase; }
                        .period-info { font-size: 10px; color: #a0aec0; margin-bottom: 4px; }
                        .subject { font-weight: bold; color: #2d3748; display: block; margin-bottom: 2px; }
                        .teacher { font-size: 10px; color: #718096; line-height: 1.2; }
                        .break { background-color: #f1f5f9; color: #94a3b8; font-weight: bold; font-style: italic; letter-spacing: 0.2em; }
                        .leisure { color: #cbd5e0; font-style: italic; }
                        @media print {
                            body { padding: 0; }
                            @page { margin: 1cm; orientation: landscape; }
                            table { page-break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        ${y.schoolLogo?`<img src="${y.schoolLogo}" style="height: 60px; margin-bottom: 10px;" />`:""}
                        <h1>${y.schoolName||"SPOORTHY CONCEPT SCHOOL"}</h1>
                        <p>Academic Timetable: ${a?.name} - ${b?.name}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th class="day-col">Day</th>
                                ${I.map(a=>`
                                    <th>
                                        <div class="period-info">${a.startTime} - ${a.endTime}</div>
                                        <div>${a.name}</div>
                                    </th>
                                `).join("")}
                            </tr>
                        </thead>
                        <tbody>
                            ${["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"].map(a=>`
                                <tr>
                                    <td class="day-col">${a.substring(0,3)}</td>
                                    ${I.map(b=>{if("BREAK"===b.type)return'<td class="break">BREAK</td>';let c=O[a]?.[b.id]||{};if(!c.subjectId)return"<td>-</td>";if("leisure"===c.subjectId)return'<td class="leisure">Leisure</td>';let d=Q.find(a=>a.id===c.subjectId),e=S.find(a=>(a.schoolId||a.id)===c.teacherId);return`
                                            <td>
                                                <span class="subject">${d?.name||"Unknown"}</span>
                                                <span class="teacher">${e?.name||"Unassigned"}</span>
                                            </td>
                                        `}).join("")}
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                    <script>window.onload = () => { window.print(); window.close(); };</script>
                </body>
            </html>
        `;c.document.write(d),c.document.close()},disabled:!K||!M,className:"h-10 border-white/10 bg-white/5 text-white hover:bg-white/10 rounded-xl font-black uppercase tracking-widest text-[10px]",children:[(0,b.jsx)(q.Printer,{className:"mr-2 h-3 w-3"})," Print Timetable"]}),(0,b.jsxs)(f.Button,{onClick:_,disabled:!K||!M||E,className:"w-full md:w-auto h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-black uppercase tracking-widest text-[10px] shadow-lg shadow-blue-900/40",children:[E?(0,b.jsx)(k.Loader2,{className:"animate-spin mr-2 w-3 h-3"}):(0,b.jsx)(l.Save,{className:"mr-2 h-3 w-3"}),"Publish Final Schedule"]})]})]}),K&&M?(0,b.jsx)("div",{className:"rounded-2xl border border-white/10 bg-black/20 backdrop-blur-md overflow-hidden custom-scrollbar",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full border-collapse min-w-[480px] md:min-w-[1000px]",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-white/5 italic",children:[(0,b.jsx)("th",{className:"p-2 md:p-4 text-left border-b border-white/10 text-[7px] md:text-[10px] font-black uppercase tracking-widest text-muted-foreground w-14 md:w-28",children:"Academic Day"}),I.map(a=>(0,b.jsxs)("th",{className:"p-2 md:p-4 text-left border-b border-white/10 min-w-[80px] md:min-w-[150px]",children:[(0,b.jsxs)("div",{className:"text-[6px] md:text-[8px] font-black text-muted-foreground/50 uppercase tracking-widest mb-0.5 md:mb-1",children:[a.startTime," - ",a.endTime]}),(0,b.jsx)("div",{className:"text-[8px] md:text-xs font-black text-accent uppercase tracking-tighter truncate",children:a.name})]},a.id))]})}),(0,b.jsx)("tbody",{children:["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"].map((a,c)=>{let d=new Date,e=d.getDay(),f=new Date(d);f.setDate(d.getDate()+(c+1-e));let h=U.some(a=>{let b=a.createdAt?.seconds?new Date(1e3*a.createdAt.seconds):new Date,c=a.expiresAt?.seconds?new Date(1e3*a.expiresAt.seconds):new Date;return b.setHours(0,0,0,0),c.setHours(23,59,59,999),f>=b&&f<=c});return(0,b.jsxs)("tr",{className:"border-b border-white/5 hover:bg-[#64FFDA]/5 group transition-colors",children:[(0,b.jsxs)("td",{className:"p-2 md:p-4 bg-white/5",children:[(0,b.jsx)("div",{className:"text-[10px] md:text-xs font-black text-white italic",children:a.substring(0,3)}),(0,b.jsx)("div",{className:"text-[7px] md:text-[9px] text-muted-foreground font-mono opacity-50",children:f.toLocaleDateString(void 0,{day:"2-digit",month:"short"})})]}),h?(0,b.jsx)("td",{colSpan:I.length,className:"p-2 md:p-4 bg-red-500/5 text-center border-l border-red-500/10",children:(0,b.jsx)("div",{className:"flex flex-col items-center justify-center text-red-400 gap-1",children:(0,b.jsx)("span",{className:"font-black text-[8px] md:text-sm tracking-[0.1em] md:tracking-[0.3em] uppercase italic opacity-60",children:"Observance: Holiday"})})}):I.map(c=>{let d=O[a]?.[c.id]||{};if("BREAK"===c.type)return(0,b.jsx)("td",{className:"p-2 md:p-4 bg-white/5 text-center text-[6px] md:text-[8px] font-black text-muted-foreground/20 tracking-[0.2em] md:tracking-[0.5em] diagonal-stripe italic",children:"RECESS"},c.id);let e=S.find(a=>(a.schoolId||a.id)===d.teacherId),f="UNASSIGNED"===d.teacherId||d.subjectId&&"leisure"!==d.subjectId&&!d.teacherId;return(0,b.jsx)("td",{className:"p-1.5 md:p-3 border-l border-white/5 min-w-[80px] md:min-w-[150px]",children:(0,b.jsxs)("div",{className:"space-y-1 md:space-y-2 p-1 md:p-2 bg-white/5 rounded-lg md:rounded-xl border border-white/5 group-hover:bg-white/10 transition-all",children:[(0,b.jsxs)(g.Select,{value:d.subjectId,onValueChange:b=>{var d,e;return d=c.id,e="subjectId",void P(c=>{let f=c[a]||{},g={...f[d]||{},[e]:b};if(K&&M)if("leisure"===b)g.teacherId="";else{let a=`${K}_${M}`,c=x[a]?.[b];c?g.teacherId=c:g.teacherId="UNASSIGNED"}return{...c,[a]:{...f,[d]:g}}})},children:[(0,b.jsx)(g.SelectTrigger,{className:"h-6 md:h-8 text-[8px] md:text-[10px] bg-black/40 border-white/5 rounded-md md:rounded-lg focus:ring-accent/30",children:(0,b.jsx)(g.SelectValue,{placeholder:"Sub"})}),(0,b.jsxs)(g.SelectContent,{className:"bg-[#0A192F] border-white/10",children:[(0,b.jsx)(g.SelectItem,{value:"leisure",className:"text-[9px] md:text-[10px] uppercase font-bold",children:"Leisure"}),Q.map(a=>(0,b.jsx)(g.SelectItem,{value:a.id,className:"text-[9px] md:text-[10px] font-bold",children:a.name},a.id))]})]}),d.subjectId&&"leisure"!==d.subjectId&&(0,b.jsx)("div",{className:"px-0.5 md:px-1",children:f?(0,b.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,b.jsx)("span",{className:"text-[6px] md:text-[8px] text-red-400 font-black uppercase tracking-tighter animate-pulse",children:"Staff Needed"}),(0,b.jsx)(D.default,{href:"/admin/master-data/classes-sections",className:"text-[6px] md:text-[7px] text-blue-400 underline decoration-blue-400/30 hover:text-blue-300 uppercase font-black",children:"Assign"})]}):(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,b.jsx)("span",{className:"text-[6px] md:text-[7px] text-muted-foreground font-black uppercase tracking-widest opacity-40 leading-none mb-0.5",children:"Teacher"}),(0,b.jsx)("span",{className:"text-[8px] md:text-[10px] text-emerald-400/90 font-bold truncate max-w-[60px] md:max-w-[100px]",children:e?.name})]}),(0,b.jsx)("div",{className:"w-1.5 h-1.5 md:w-2 md:h-2 rounded-full bg-emerald-500/50 shadow-[0_0_8px_rgba(16,185,129,0.3)] shrink-0"})]})})]})},c.id)})]},a)})})]})})}):(0,b.jsx)("div",{className:"text-center py-20 bg-black/20 border border-dashed border-white/10 rounded-2xl",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4 opacity-40",children:[(0,b.jsx)(o.Calendar,{size:40,strokeWidth:1}),(0,b.jsx)("p",{className:"text-xs md:text-sm font-bold uppercase tracking-widest italic",children:"Please select a class and section to design the schedule."})]})})]})]})]})}a.s(["default",()=>E],91311)}];

//# sourceMappingURL=src_app_admin_timetable_manage_page_tsx_23414a3f._.js.map