module.exports=[52178,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(69387);var e=a.i(60574),f=a.i(20237),g=a.i(99570),h=a.i(91119),i=a.i(86304),j=a.i(96221),k=a.i(210),l=a.i(63519),m=a.i(24987),n=a.i(53722),o=a.i(69769),p=a.i(90166),q=a.i(56738),r=a.i(24569),s=a.i(16201),t=a.i(14574),u=a.i(70430),v=a.i(66718),w=a.i(80701),x=a.i(29246),y=a.i(56025),z=a.i(43945),A=a.i(91410),B=a.i(88110),C=a.i(48711);function D({isOpen:a,onClose:d,teacher:h,onSuccess:i}){let{subjects:k}=(0,A.useMasterData)(),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)({name:"",mobile:"",age:"",address:"",qualifications:"",primarySubject:"",secondarySubject:"",classTeacherClass:"",classTeacherSection:""}),[p,q]=(0,c.useState)(!1),{user:r}=(0,y.useAuth)(),[s,x]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!r)return;let a=(0,e.onSnapshot)((0,e.doc)(f.db,"users",r.uid),a=>{a.exists()&&x(a.data().role)});return()=>a()},[r]),(0,c.useEffect)(()=>{a&&h&&(o({name:h.name||"",mobile:h.mobile||"",age:h.age?.toString()||"",address:h.address||"",qualifications:h.qualifications||"",primarySubject:h.subjects?.[0]||"",secondarySubject:h.subjects?.[1]||"NONE",classTeacherClass:h.classTeacherOf?.classId||"NONE",classTeacherSection:h.classTeacherOf?.sectionId||"A"}),m(Object.values(k||{}).filter(a=>!1!==a.isActive).sort((a,b)=>a.name.localeCompare(b.name))))},[a,h,k]);let z=async a=>{if(a.preventDefault(),h?.id){q(!0);try{let a=[];n.primarySubject&&"NONE"!==n.primarySubject&&a.push(n.primarySubject),n.secondarySubject&&"NONE"!==n.secondarySubject&&n.secondarySubject!==n.primarySubject&&a.push(n.secondarySubject);let b=(0,e.doc)(f.db,"teachers",h.id);await (0,e.updateDoc)(b,{name:n.name,mobile:n.mobile,age:Number(n.age),address:n.address,qualifications:n.qualifications,subjects:a,classTeacherOf:n.classTeacherClass&&"NONE"!==n.classTeacherClass?{classId:n.classTeacherClass,sectionId:n.classTeacherSection||"A"}:null,updatedAt:new Date().toISOString()}),"MANAGER"===s&&await (0,C.notifyManagerAction)({userId:h.uid||h.id,title:"Profile Updated",message:`Teacher profile ${n.name} has been updated by Manager ${r?.displayName||"System"}.`,type:"INFO",actionBy:r?.uid,actionByName:r?.displayName||"Manager"}),(0,B.toast)({title:"Teacher Updated",description:`Successfully updated details for ${n.name}`,type:"success"}),i(),d()}catch(a){(0,B.toast)({title:"Update Failed",description:a.message||"Could not update teacher details.",type:"error"})}finally{q(!1)}}};return(0,b.jsx)(t.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(t.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[600px]",children:[(0,b.jsx)(t.DialogHeader,{children:(0,b.jsx)(t.DialogTitle,{children:"Edit Teacher Details"})}),(0,b.jsxs)("form",{onSubmit:z,className:"grid grid-cols-2 gap-4 py-2",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Full Name"}),(0,b.jsx)(v.Input,{required:!0,value:n.name,onChange:a=>o({...n,name:a.target.value}),className:"bg-white/5 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Mobile Number"}),(0,b.jsx)(v.Input,{required:!0,type:"tel",maxLength:10,value:n.mobile,onChange:a=>o({...n,mobile:a.target.value}),className:"bg-white/5 border-white/10 font-mono"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Age"}),(0,b.jsx)(v.Input,{required:!0,type:"number",min:"18",value:n.age,onChange:a=>o({...n,age:a.target.value}),className:"bg-white/5 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Address"}),(0,b.jsx)(v.Input,{required:!0,value:n.address,onChange:a=>o({...n,address:a.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Primary Subject"}),(0,b.jsxs)(w.Select,{value:n.primarySubject,onValueChange:a=>o({...n,primarySubject:a}),children:[(0,b.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(w.SelectValue,{placeholder:"Select"})}),(0,b.jsx)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:l.map(a=>(0,b.jsx)(w.SelectItem,{value:a.name||"Unknown",children:a.name||"Unknown"},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Secondary Subject (Optional)"}),(0,b.jsxs)(w.Select,{value:n.secondarySubject,onValueChange:a=>o({...n,secondarySubject:a}),children:[(0,b.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(w.SelectValue,{placeholder:"None"})}),(0,b.jsxs)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:[(0,b.jsx)(w.SelectItem,{value:"NONE",children:"None"}),l.filter(a=>a.name!==n.primarySubject).map(a=>(0,b.jsx)(w.SelectItem,{value:a.name||"Unknown",children:a.name||"Unknown"},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Qualifications"}),(0,b.jsx)(v.Input,{required:!0,value:n.qualifications,onChange:a=>o({...n,qualifications:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"e.g. B.Ed, M.Sc"})]}),(0,b.jsxs)("div",{className:"pt-4 border-t border-white/10",children:[(0,b.jsx)(u.Label,{className:"text-xs text-muted-foreground uppercase mb-2 block",children:"Class Teacher Assignment"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(w.Select,{value:n.classTeacherClass,onValueChange:a=>o({...n,classTeacherClass:a}),children:[(0,b.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10 text-xs",children:(0,b.jsx)(w.SelectValue,{placeholder:"Class"})}),(0,b.jsxs)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:[(0,b.jsx)(w.SelectItem,{value:"NONE",children:"None"}),Object.values((0,A.useMasterData)().classes).sort((a,b)=>a.order-b.order).map(a=>(0,b.jsx)(w.SelectItem,{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)(w.Select,{value:n.classTeacherSection,onValueChange:a=>o({...n,classTeacherSection:a}),children:[(0,b.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10 text-xs",children:(0,b.jsx)(w.SelectValue,{placeholder:"Section"})}),(0,b.jsx)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:Object.values((0,A.useMasterData)().sections).map(a=>(0,b.jsx)(w.SelectItem,{value:a.id,children:a.name},a.id))})]})]})]})]}),(0,b.jsxs)(t.DialogFooter,{className:"col-span-2 mt-4",children:[(0,b.jsx)(g.Button,{type:"button",variant:"ghost",onClick:d,disabled:p,children:"Cancel"}),(0,b.jsxs)(g.Button,{type:"submit",disabled:p,className:"bg-white text-black hover:bg-zinc-200",children:[p?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Save Changes"]})]})]})]})})}var E=a.i(9450),F=a.i(37047),G=a.i(21161);function H(){let{user:a}=(0,y.useAuth)(),{id:A}=(0,d.useParams)(),B=(0,d.useRouter)(),[C,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)("");(0,c.useEffect)(()=>{if(!a)return;let b=(0,e.onSnapshot)((0,e.doc)(f.db,"users",a.uid),a=>{a.exists()&&L(a.data().role)});return()=>b()},[a]);let[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)({month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear().toString(),amount:"",method:"CASH",notes:""}),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(!1);(0,c.useEffect)(()=>{A&&($(),_())},[A]);let $=async()=>{try{let a=(0,e.doc)(f.db,"teachers",A),b=await (0,e.getDoc)(a);b.exists()?H(b.data()):(alert("Teacher not found"),B.back())}catch(a){console.error(a)}finally{J(!1)}},_=async()=>{try{(0,e.query)((0,e.collection)(f.db,"salary_payments"),(0,e.where)("personId","==",A),(0,e.orderBy)("createdAt","desc"));let a=(0,e.query)((0,e.collection)(f.db,"salary_payments"),(0,e.where)("personId","==",A)),b=(await (0,e.getDocs)(a)).docs.map(a=>({id:a.id,...a.data()}));b.sort((a,b)=>b.createdAt?.seconds-a.createdAt?.seconds),N(b)}catch(a){console.error(a)}},aa=async()=>{T(!0);try{if(!Q.amount)throw Error("Amount required");let b=await a?.getIdToken(),c=await fetch("/api/admin/payroll/process",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({personId:A,personType:"TEACHER",...Q,amount:Number(Q.amount)})}),d=await c.json();if(!c.ok)throw Error(d.error);alert("Salary Payment Recorded!"),P(!1),_()}catch(a){alert(a.message)}finally{T(!1)}};return I?(0,b.jsx)("div",{className:"p-10 flex justify-center",children:(0,b.jsx)(j.Loader2,{className:"animate-spin"})}):C?(0,b.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500",children:[(0,b.jsxs)("div",{className:"flex flex-col xl:flex-row xl:items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 w-full xl:w-auto",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>B.back(),children:(0,b.jsx)(k.ArrowLeft,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-display font-bold",children:C.name}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-muted-foreground mt-1",children:[(0,b.jsx)(i.Badge,{variant:"outline",className:"border-blue-500/50 text-blue-400 font-mono",children:C.schoolId}),(0,b.jsx)("span",{children:"•"}),(0,b.jsx)("span",{children:C.status})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 w-full xl:w-auto xl:ml-auto",children:[(0,b.jsxs)(g.Button,{onClick:()=>Z(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,b.jsx)(F.KeyRound,{className:"w-4 h-4 mr-2"})," Reset Password"]}),(0,b.jsxs)(g.Button,{onClick:()=>X(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,b.jsx)(r.Edit,{className:"w-4 h-4 mr-2"})," Edit Profile"]}),"MANAGER"!==K&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.Button,{onClick:()=>V(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,b.jsx)(G.Settings,{className:"w-4 h-4 mr-2"})," Adjust Salary"]}),(0,b.jsxs)(g.Button,{onClick:()=>P(!0),className:"bg-green-600 hover:bg-green-700 text-white flex-1 md:flex-none",children:[(0,b.jsx)(q.Wallet,{className:"w-4 h-4 mr-2"})," Pay Salary"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)(h.Card,{className:"md:col-span-2 bg-black/40 border-white/10",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-lg",children:"Personal Details"})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(u.Label,{className:"text-muted-foreground",children:"Mobile"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(l.Phone,{className:"w-4 h-4 text-blue-400"}),(0,b.jsx)("span",{className:"font-mono",children:C.mobile})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(u.Label,{className:"text-muted-foreground",children:"Age"}),(0,b.jsxs)("div",{className:"mt-1",children:[C.age," years"]})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(u.Label,{className:"text-muted-foreground",children:"Address"}),(0,b.jsxs)("div",{className:"flex items-start gap-2 mt-1",children:[(0,b.jsx)(m.MapPin,{className:"w-4 h-4 text-red-400 mt-1"}),(0,b.jsx)("span",{children:C.address})]})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(u.Label,{className:"text-muted-foreground",children:"Qualifications"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(o.GraduationCap,{className:"w-4 h-4 text-yellow-400"}),(0,b.jsx)("span",{children:C.qualifications})]})]}),C.classTeacherOf&&(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(u.Label,{className:"text-muted-foreground",children:"Class In-charge"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-emerald-400 font-bold",children:[(0,b.jsx)(s.CheckCircle,{className:"w-4 h-4"}),(0,b.jsxs)("span",{children:["Class Teacher of ",C.classTeacherOf.classId.toUpperCase()," - ",C.classTeacherOf.sectionId]})]})]})]}),(0,b.jsxs)("div",{className:"pt-4 border-t border-white/10",children:[(0,b.jsx)(u.Label,{className:"text-muted-foreground block mb-2",children:"Teaching Subjects"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[C.subjects?.map(a=>(0,b.jsxs)(i.Badge,{className:"bg-purple-500/10 text-purple-400 border border-purple-500/20 px-3 py-1",children:[(0,b.jsx)(n.BookOpen,{className:"w-3 h-3 mr-2"})," ",a]},a)),(!C.subjects||0===C.subjects.length)&&(0,b.jsx)("span",{className:"text-muted-foreground italic",children:"No subjects assigned"})]})]})]})]}),"MANAGER"!==K&&(0,b.jsxs)(h.Card,{className:"bg-black/40 border-white/10",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-lg",children:"Compensations"})}),(0,b.jsxs)(h.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 text-center",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm uppercase tracking-wider mb-1",children:"Current Salary"}),(0,b.jsxs)("div",{className:"text-3xl font-display font-bold",children:["₹",C.salary?.toLocaleString()]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-3",children:"Recent Payments"}),(0,b.jsxs)("div",{className:"space-y-2",children:[M.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white/5 rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-bold",children:[a.month," ",a.year]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.method})]}),(0,b.jsxs)("div",{className:"font-mono text-green-400 font-bold",children:["+₹",a.amount.toLocaleString()]})]},a.id)),0===M.length&&(0,b.jsx)("div",{className:"text-center text-muted-foreground text-sm",children:"No payment history"})]})]})]})]})]}),(0,b.jsx)(t.Dialog,{open:O,onOpenChange:P,children:(0,b.jsxs)(t.DialogContent,{className:"bg-black/95 border-white/10 text-white",children:[(0,b.jsx)(t.DialogHeader,{children:(0,b.jsxs)(t.DialogTitle,{children:["Pay Salary to ",C.name]})}),(0,b.jsxs)("div",{className:"space-y-4 py-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Month"}),(0,b.jsxs)(w.Select,{value:Q.month,onValueChange:a=>R({...Q,month:a}),children:[(0,b.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(w.SelectValue,{})}),(0,b.jsx)(w.SelectContent,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(a=>(0,b.jsx)(w.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Year"}),(0,b.jsx)(v.Input,{value:Q.year,onChange:a=>R({...Q,year:a.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Amount (₹)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(p.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(v.Input,{type:"number",value:Q.amount,onChange:a=>R({...Q,amount:a.target.value}),className:"pl-9 bg-white/5 border-white/10",placeholder:C.salary?.toString()})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Base Salary: ₹",C.salary?.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Payment Mode"}),(0,b.jsxs)(w.Select,{value:Q.method,onValueChange:a=>R({...Q,method:a}),children:[(0,b.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(w.SelectValue,{})}),(0,b.jsxs)(w.SelectContent,{children:[(0,b.jsx)(w.SelectItem,{value:"CASH",children:"Cash"}),(0,b.jsx)(w.SelectItem,{value:"UPI",children:"UPI / Online"}),(0,b.jsx)(w.SelectItem,{value:"CHEQUE",children:"Cheque"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(u.Label,{children:"Notes (Optional)"}),(0,b.jsx)(x.Textarea,{value:Q.notes,onChange:a=>R({...Q,notes:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"e.g. Bonus included"})]})]}),(0,b.jsx)(t.DialogFooter,{children:(0,b.jsx)(g.Button,{onClick:aa,disabled:S,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:S?(0,b.jsx)(j.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Payment"})})]})}),(0,b.jsx)(z.AdjustSalaryModal,{isOpen:U,onClose:()=>V(!1),person:C?{id:A,name:C.name,schoolId:C.schoolId,role:"TEACHER",currentSalary:C.salary||0}:null,onSuccess:()=>$()}),(0,b.jsx)(D,{isOpen:W,onClose:()=>X(!1),teacher:C?{id:A,...C}:null,onSuccess:()=>$()}),(0,b.jsx)(E.AdminChangePasswordModal,{isOpen:Y,onClose:()=>Z(!1),user:C?{uid:C.uid,schoolId:C.schoolId,name:C.name,role:"TEACHER"}:null})]}):null}a.s(["default",()=>H],52178)}];

//# sourceMappingURL=src_app_admin_teachers_%5Bid%5D_page_tsx_dd735a37._.js.map