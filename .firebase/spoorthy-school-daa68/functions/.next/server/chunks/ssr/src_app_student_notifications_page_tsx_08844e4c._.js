module.exports=[48947,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(56025);a.i(69387);var e=a.i(60574),f=a.i(20237),g=a.i(96221),h=a.i(23312),i=a.i(16201),j=a.i(68114);function k(){let{user:a}=(0,d.useAuth)(),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0);(0,c.useEffect)(()=>{if(!a)return;let b=!0,c=[],d=(a,c)=>{b&&l(b=>{let c=new Set(a.map(a=>a.id));return[...b.filter(a=>!c.has(a.id)),...a].sort((a,b)=>{let c=a.createdAt?.seconds||0;return(b.createdAt?.seconds||0)-c}).slice(0,50)})};return(async()=>{if(!a?.uid)return;let g=(0,e.query)((0,e.collection)(f.db,"notifications"),(0,e.where)("userId","==",a.uid),(0,e.limit)(50)),h=(0,e.onSnapshot)(g,a=>{b&&d(a.docs.map(a=>({id:a.id,...a.data()})),"personal")});c.push(h);try{let g=(0,e.query)((0,e.collection)(f.db,"students"),(0,e.where)("uid","==",a.uid),(0,e.limit)(1)),h=await (0,e.getDocs)(g);if(!b)return;if(!h.empty){let a=h.docs[0].data().classId;if(a){let g=(0,e.query)((0,e.collection)(f.db,"notifications"),(0,e.where)("target","==",`class_${a}`),(0,e.limit)(50)),h=(0,e.onSnapshot)(g,a=>{if(!b)return;let c=a.docs.map(a=>({id:a.id,...a.data()}));d(c,"class")});c.push(h)}}}catch(a){console.error("Error setting up class listeners:",a)}n(!1)})(),()=>{b=!1,c.forEach(a=>a())}},[a]);let o=async(a,b)=>{if("READ"!==b)try{console.log("Marking as read:",a),await (0,e.updateDoc)((0,e.doc)(f.db,"notifications",a),{status:"READ"})}catch(a){console.error("Error marking read:",a)}};return m?(0,b.jsx)("div",{className:"flex justify-center p-10",children:(0,b.jsx)(g.Loader2,{className:"animate-spin text-[#64FFDA]"})}):(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in pb-10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-6 border-b border-[#64FFDA]/10 pb-4",children:[(0,b.jsx)("div",{className:"p-2 bg-[#64FFDA]/10 rounded-lg text-[#64FFDA]",children:(0,b.jsx)(h.Bell,{size:24})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-display font-bold text-white",children:"Notifications"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Updates on attendance, assignments, and system alerts."})]})]}),(0,b.jsx)("div",{className:"space-y-4",children:0===k.length?(0,b.jsxs)("div",{className:"text-center py-20 bg-white/5 rounded-xl border border-white/10",children:[(0,b.jsx)(h.Bell,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No notifications yet."})]}):k.map(a=>(0,b.jsx)("div",{onClick:()=>o(a.id,a.status),className:(0,j.cn)("bg-black/20 border border-white/10 rounded-lg transition-all hover:bg-white/5 cursor-pointer group relative overflow-hidden","UNREAD"===a.status?"border-l-4 border-l-[#3B82F6] bg-[#3B82F6]/5":"opacity-80"),children:(0,b.jsxs)("div",{className:"p-5 flex gap-4",children:[(0,b.jsx)("div",{className:(0,j.cn)("mt-1 w-2 h-2 rounded-full flex-shrink-0","UNREAD"===a.status?"bg-[#3B82F6]":"bg-transparent")}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsx)("h3",{className:(0,j.cn)("font-bold text-lg","UNREAD"===a.status?"text-white":"text-muted-foreground"),children:a.title}),(0,b.jsx)("span",{suppressHydrationWarning:!0,className:"text-xs text-muted-foreground whitespace-nowrap font-mono",children:(a=>{if(!a)return"";try{return(a.toDate?a.toDate():new Date(1e3*a.seconds)).toLocaleString()}catch(a){return""}})(a.createdAt)})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:a.message}),"READ"===a.status&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-green-500/50 mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(i.CheckCircle,{size:10})," Read"]})]})]})},a.id))})]})}a.s(["default",()=>k])}];

//# sourceMappingURL=src_app_student_notifications_page_tsx_08844e4c._.js.map