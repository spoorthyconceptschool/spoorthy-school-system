module.exports=[5887,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(20237),f=a.i(56025),g=a.i(16201),h=a.i(41710),i=a.i(99570),j=a.i(15055),k=a.i(11156),l=a.i(56738),m=a.i(41675),n=a.i(97063),o=a.i(53722),p=a.i(27960);function q(){let a,{user:q}=(0,f.useAuth)(),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)("pending"),[B,C]=(0,c.useState)(new Set),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)([]),J=q?.email?.split("@")[0].toUpperCase();(0,c.useEffect)(()=>{let a=document.createElement("script");return a.src="https://checkout.razorpay.com/v1/checkout.js",a.async=!0,document.body.appendChild(a),(async()=>{if(J)try{let[a,b,c]=await Promise.all([(0,d.getDoc)((0,d.doc)(e.db,"config","razorpay")),(0,d.getDoc)((0,d.doc)(e.db,"students",J)),(0,d.getDoc)((0,d.doc)(e.db,"student_fee_ledgers",`${J}_2025-2026`))]);if(a.exists()&&y(a.data()),b.exists()&&u(b.data()),c.exists()){let a=c.data();w(a),A("PAID"===a.status?"paid":"pending");let b=new Set,d={},e=a.items||[],f=e.filter(a=>a.amount<0).reduce((a,b)=>a+Math.abs(b.amount-(b.paidAmount||0)),0);e.filter(a=>a.amount>0).forEach(a=>{let c=a.amount-(a.paidAmount||0),e=Math.min(c,f),g=c-e;f-=e,g>0&&(b.add(a.id),d[a.id]=g.toString())}),C(b),E(d)}}catch(a){console.error("Dashboard Fetch Error",a)}finally{s(!1)}})(),()=>{a&&document.body.contains(a)&&document.body.removeChild(a)}},[J]),(0,c.useEffect)(()=>{if(!t?.classId)return;let a=!0;console.log("[Dashboard] Listening for homework targeting:",{classId:t.classId,sectionId:t.sectionId});let b=F?(0,d.query)((0,d.collection)(e.db,"homework"),(0,d.where)("classId","==",t.classId),(0,d.limit)(10)):(0,d.query)((0,d.collection)(e.db,"homework"),(0,d.where)("classId","==",t.classId),(0,d.orderBy)("createdAt","desc"),(0,d.limit)(10)),c=(0,d.onSnapshot)(b,b=>{if(!a)return;let c=b.docs.map(a=>({id:a.id,...a.data()})),d=t.sectionId?c.filter(a=>!a.sectionId||a.sectionId===t.sectionId||"ALL"===a.sectionId||"GENERAL"===a.sectionId):c;F&&(d=[...d].sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0))),console.log("[Dashboard] Homework received/filtered:",d.length),I(d.slice(0,3))},b=>{a&&(b.message.includes("index")&&!F?(console.warn("[Dashboard] Index missing, switching to fallback query."),G(!0)):b.message.includes("index")||console.error("[Dashboard] Homework Sync Error:",b))});return()=>{a=!1,c()}},[t?.classId,t?.sectionId,F]);let K=(a,b)=>{if(b<0)return;let c=new Set(B);if(c.has(a)){c.delete(a);let b={...D};delete b[a],E(b)}else c.add(a),E({...D,[a]:b.toString()});C(c)},L=(a,b,c)=>{let d=b.replace(/[^0-9.-]/g,"");if(c<0){if(Number(d)<c||Number(d)>0)return}else if(Number(d)>c||0>Number(d))return;E({...D,[a]:d})},M=Array.from(B).reduce((a,b)=>{let c=v?.items?.find(a=>a.id===b),d=Number(D[b])||0;return a+(c&&c.amount>0?d:0)},0),N=v?.items?.reduce((a,b)=>a+(b.amount>0?b.amount:0),0)||0,O=v?.items?.reduce((a,b)=>a+(b.amount<0?Math.abs(b.amount):0),0)||0,P=Math.max(0,N-(v?.totalPaid||0)-O),Q=v?.items?.filter(a=>"TERM"===a.type&&a.amount-(a.paidAmount||0)>=0)||[],R=v?.items?.filter(a=>"CUSTOM"===a.type&&a.amount-(a.paidAmount||0)>=0)||[],S=v?.items?.filter(a=>a.amount-(a.paidAmount||0)<0)||[];return(0,b.jsxs)("div",{className:"space-y-6 md:space-y-8 pb-12",children:[(0,b.jsx)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 px-2 md:px-0",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"font-display text-3xl md:text-5xl font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic",children:"My Dashboard"}),(0,b.jsxs)("p",{className:"text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(m.Calendar,{className:"w-4 h-4 text-accent"}),"Academic Year ",v?.academicYearId||"2025-2026"]})]})}),r?(0,b.jsx)(p.Skeleton,{className:"h-32 w-full rounded-3xl"}):H.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-in slide-in-from-top duration-700",children:(0,b.jsxs)("div",{className:"md:col-span-3 glass-panel p-6 rounded-3xl border-accent/20 bg-accent/5 flex flex-col md:flex-row items-center justify-between gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-accent/10 flex items-center justify-center border border-accent/20",children:(0,b.jsx)(o.BookOpen,{className:"w-6 h-6 text-accent"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-lg italic",children:"New Assignments Received"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground font-medium uppercase tracking-widest",children:[H.length," items requiring your attention"]})]})]}),(0,b.jsx)("div",{className:"flex -space-x-4 overflow-hidden",children:H.map((a,c)=>(0,b.jsx)("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-black bg-neutral-800 flex items-center justify-center text-[10px] font-black uppercase",title:a.title,children:a.subjectId?.substring(0,1)},a.id))}),(0,b.jsx)(i.Button,{variant:"outline",className:"rounded-xl border-accent/20 text-accent hover:bg-accent hover:text-accent-foreground font-bold italic h-12 px-8",onClick:()=>window.location.href="/student/homework",children:"View Homework Feed"})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[r?(0,b.jsx)(p.Skeleton,{className:"h-64 w-full rounded-3xl"}):(0,b.jsxs)("div",{className:"glass-panel p-8 rounded-3xl relative overflow-hidden group",children:[(0,b.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-accent/5 rounded-full -mr-16 -mt-16 blur-3xl group-hover:bg-accent/10 transition-colors"}),(0,b.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-3",children:[(0,b.jsx)(n.Info,{className:"w-5 h-5 text-accent"}),"Student Profile"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-muted-foreground uppercase text-[10px] tracking-widest font-bold",children:"Full Name"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-accent",children:t?.studentName||"..."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-muted-foreground uppercase text-[10px] tracking-widest font-bold",children:"School ID"}),(0,b.jsx)("p",{className:"text-lg font-mono font-bold",children:J})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-muted-foreground uppercase text-[10px] tracking-widest font-bold",children:"Grade / Class"}),(0,b.jsxs)("p",{className:"text-lg font-semibold",children:[t?.className||"..."," ",t?.sectionName?`(${t.sectionName})`:""]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("span",{className:"text-muted-foreground uppercase text-[10px] tracking-widest font-bold",children:"Parent Contact"}),(0,b.jsxs)("p",{className:"text-lg font-semibold",children:[t?.parentName||"..."," - ",t?.parentMobile||"..."]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-3 italic",children:[(0,b.jsx)(l.Wallet,{className:"w-6 h-6 text-accent"}),"Fee Breakdown & Selection"]}),S.length>0&&(0,b.jsx)("div",{className:"glass-panel rounded-3xl overflow-hidden border-green-500/20 bg-green-500/5",children:(0,b.jsxs)("div",{className:"px-6 py-4 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"bg-green-500/20 p-2 rounded-xl",children:(0,b.jsx)(g.CheckCircle,{className:"w-5 h-5 text-green-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-green-400 text-sm italic uppercase tracking-widest",children:"Active Scholarships & Credits"}),(0,b.jsx)("p",{className:"text-[10px] text-green-400/60 font-bold uppercase",children:"These benefits are automatically deducted from your term fees below."})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-[10px] text-green-500/50 uppercase font-black",children:"Total Benefit Value"}),(0,b.jsxs)("p",{className:"text-2xl font-black text-green-400",children:["- â‚¹",O.toLocaleString()]})]})]})}),r?(0,b.jsx)(p.Skeleton,{className:"h-96 w-full rounded-3xl"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"glass-panel rounded-3xl overflow-hidden border-white/5 shadow-2xl",children:[(0,b.jsxs)("div",{className:"bg-white/5 px-6 py-4 flex justify-between items-center border-b border-white/10",children:[(0,b.jsx)("h3",{className:"font-bold text-accent tracking-wide uppercase text-xs",children:"Term Fees"}),(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground bg-white/5 px-2 py-1 rounded",children:"MANDATORY"})]}),(0,b.jsx)("div",{className:"p-2",children:(a=O,Q.length>0?Q.map(c=>{let d=c.amount-(c.paidAmount||0),e=Math.min(d,a),f=d-e;a-=e;let i=B.has(c.id);return(0,b.jsxs)("div",{className:`flex flex-col md:flex-row md:items-center justify-between p-4 rounded-2xl mb-2 transition-all ${i?"bg-accent/10 border border-accent/20":"hover:bg-white/5 border border-transparent"} ${0===f?"opacity-60 grayscale-[0.5]":""}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[0===f?(0,b.jsx)("div",{className:"w-5 h-5 flex items-center justify-center bg-green-500 rounded-md",children:(0,b.jsx)(g.CheckCircle,{className:"w-4 h-4 text-white"})}):(0,b.jsx)(j.Checkbox,{checked:i,onCheckedChange:()=>K(c.id,f)}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-bold flex items-center gap-2",children:[c.name,e>0&&(0,b.jsxs)("span",{className:"text-[9px] bg-green-500/20 text-green-400 px-1.5 py-0.5 rounded-full font-black uppercase tracking-tighter",children:["â‚¹",e.toLocaleString()," DEDUCTED"]})]}),(0,b.jsxs)("p",{className:"text-[10px] text-muted-foreground flex items-center gap-1 uppercase tracking-tighter",children:[(0,b.jsx)(h.Clock,{className:"w-3 h-3"})," Originally â‚¹",c.amount.toLocaleString()," â€¢ Due: ",c.dueDate]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6 mt-4 md:mt-0",children:[(0,b.jsxs)("div",{className:"text-right hidden md:block",children:[(0,b.jsx)("p",{className:`text-[10px] uppercase tracking-widest font-bold ${0===f?"text-green-500":"text-muted-foreground"}`,children:0===f?"PAID / COVERED":"Net Balance"}),(0,b.jsxs)("p",{className:`font-bold text-lg ${0===f?"text-green-400":"text-white"}`,children:["â‚¹",f.toLocaleString()]})]}),(0,b.jsxs)("div",{className:`w-32 bg-black/40 rounded-xl border border-white/10 p-1 flex items-center px-3 gap-1 ${0===f?"opacity-20 cursor-not-allowed":""}`,children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"â‚¹"}),(0,b.jsx)("input",{type:"text",value:D[c.id]||"",onChange:a=>L(c.id,a.target.value,f),className:"bg-transparent border-none outline-none text-sm font-bold w-full text-white",placeholder:"0",disabled:!i||0===f})]})]})]},c.id)}):(0,b.jsx)("p",{className:"p-8 text-center text-muted-foreground text-sm",children:"No term fees assigned or all paid."}))})]}),R.length>0&&(0,b.jsxs)("div",{className:"glass-panel rounded-3xl overflow-hidden border-white/5 shadow-2xl",children:[(0,b.jsx)("div",{className:"bg-white/5 px-6 py-4 flex justify-between items-center border-b border-white/10",children:(0,b.jsx)("h3",{className:"font-bold text-amber-500 tracking-wide uppercase text-xs",children:"Special & Custom Fees"})}),(0,b.jsx)("div",{className:"p-2",children:R.map(a=>{let c=a.amount-(a.paidAmount||0),d=B.has(a.id);return(0,b.jsxs)("div",{className:`flex flex-col md:flex-row md:items-center justify-between p-4 rounded-2xl mb-2 transition-all ${d?"bg-amber-500/10 border border-amber-500/20":"hover:bg-white/5 border border-transparent"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(j.Checkbox,{checked:d,onCheckedChange:()=>K(a.id,c),disabled:0===c,className:"data-[state=checked]:bg-amber-500 data-[state=checked]:border-amber-500"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-bold",children:a.name}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-tighter",children:"Event / Special Fee"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6 mt-4 md:mt-0",children:[(0,b.jsxs)("div",{className:"text-right hidden md:block",children:[(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest",children:"Balance"}),(0,b.jsxs)("p",{className:"font-bold text-lg",children:["â‚¹",c.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"w-32 bg-black/40 rounded-xl border border-white/10 p-1 flex items-center px-3 gap-1",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"â‚¹"}),(0,b.jsx)("input",{type:"text",value:D[a.id]||"",onChange:b=>L(a.id,b.target.value,c),className:"bg-transparent border-none outline-none text-sm font-bold w-full text-white",placeholder:"0",disabled:!d})]})]})]},a.id)})})]})]})]})]}),(0,b.jsx)("div",{className:"lg:col-span-1",children:r?(0,b.jsx)(p.Skeleton,{className:"h-96 w-full rounded-3xl"}):(0,b.jsxs)("div",{className:"sticky top-8 space-y-6",children:[(0,b.jsxs)("div",{className:"glass-panel p-8 rounded-3xl border-accent/20 shadow-[0_20px_50px_rgba(212,175,55,0.1)] relative overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute -top-10 -left-10 w-40 h-40 bg-accent/10 rounded-full blur-3xl"}),(0,b.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[(0,b.jsx)(k.CreditCard,{className:"w-5 h-5 text-accent"}),"Payment Summary"]}),(0,b.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,b.jsxs)("div",{className:"space-y-2 p-4 bg-white/5 rounded-2xl border border-white/10",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center text-[10px] text-muted-foreground uppercase tracking-widest font-bold",children:[(0,b.jsx)("span",{children:"Full Year Tuition"}),(0,b.jsxs)("span",{children:["â‚¹",N.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-[10px] text-green-400 uppercase tracking-widest font-bold",children:[(0,b.jsx)("span",{children:"Scholarship Applied"}),(0,b.jsxs)("span",{children:["- â‚¹",O.toLocaleString()]})]}),(0,b.jsx)("div",{className:"h-px bg-white/10 my-1"}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-xs font-bold text-accent",children:[(0,b.jsx)("span",{children:"TOTAL PENDING FEE"}),(0,b.jsxs)("span",{className:"text-sm",children:["â‚¹",P.toLocaleString()]})]})]}),(0,b.jsx)("div",{className:"h-px bg-white/5 w-full"}),(0,b.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-[0.2em] font-bold",children:M>0?"Amount to Pay Now":"Select items to pay"}),(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{className:"text-xl font-medium text-accent",children:"â‚¹"}),(0,b.jsx)("p",{className:"text-5xl font-bold font-display drop-shadow-2xl text-white",children:Math.max(0,M).toLocaleString()})]})]})]}),(0,b.jsx)(i.Button,{onClick:()=>{let a=Array.from(B).some(a=>{let b=v?.items?.find(b=>b.id===a);return b&&b.amount>0&&(Number(D[a])||0)>0});if(M<=0&&a)return void alert("This selection is fully covered by your scholarship/benefits. No payment is required.");if(M<=0)return void alert("Please select at least one item and enter a valid amount.");if(!x?.keyId)return void alert("Payment gateway not configured. Please contact admin.");let b={key:x.keyId,amount:Math.round(100*M),currency:"INR",name:"Spoorthy Concept School",description:`Fee Payment - ${t?.studentName}`,handler:function(a){console.log(a),alert(`Payment Successful! (Demo Mode)
Payment ID: ${a.razorpay_payment_id}
Amount: â‚¹${M}`)},prefill:{name:t?.studentName,email:q?.email,contact:t?.parentMobile},theme:{color:"#d4af37"}};new window.Razorpay(b).open()},className:"w-full h-16 bg-accent text-accent-foreground hover:bg-accent/90 rounded-2xl font-black text-xl shadow-[0_10px_30px_rgba(212,175,55,0.3)] group transition-all transform hover:-translate-y-1",disabled:0===M||r,children:r?(0,b.jsx)("span",{className:"animate-pulse",children:"PROCESSING..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.CreditCard,{className:"mr-2 group-hover:scale-125 transition-transform"}),"PROCEED TO PAY"]})}),(0,b.jsx)("p",{className:"text-[9px] text-center text-muted-foreground mt-4 font-bold tracking-widest uppercase opacity-50",children:"ðŸ”’ Secure Payment powered by Razorpay"})]}),(0,b.jsxs)("div",{className:"glass-panel p-6 rounded-3xl border-white/5 space-y-4",children:[(0,b.jsx)("h3",{className:"text-xs font-bold text-muted-foreground uppercase tracking-widest",children:"Ledger Status"}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Overall Status"}),"paid"===z?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-500 font-bold bg-green-500/10 px-4 py-2 rounded-xl text-xs",children:[(0,b.jsx)(g.CheckCircle,{className:"w-4 h-4"})," CLEAR"]}):(0,b.jsxs)("div",{className:"flex items-center gap-2 text-yellow-500 font-bold bg-yellow-500/10 px-4 py-2 rounded-xl text-xs",children:[(0,b.jsx)(h.Clock,{className:"w-4 h-4"})," PENDING"]})]})]})]})})]})]})}a.s(["default",()=>q])}];

//# sourceMappingURL=src_app_student_page_tsx_06201262._.js.map