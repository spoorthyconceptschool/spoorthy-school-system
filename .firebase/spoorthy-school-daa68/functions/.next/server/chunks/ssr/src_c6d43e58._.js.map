{"version":3,"sources":["../../../../src/components/ui/card.tsx","../../../../src/app/student/notices/page.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Card = React.forwardRef<\r\n    HTMLDivElement,\r\n    React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n    <div\r\n        ref={ref}\r\n        className={cn(\r\n            \"rounded-2xl border border-[#64FFDA]/10 bg-[#112240]/40 backdrop-blur-lg text-white shadow-xl transition-all duration-300 hover:bg-[#112240]/60 hover:border-[#64FFDA]/30 hover:shadow-[0_0_20px_-5px_rgba(100,255,218,0.1)] group\",\r\n            className\r\n        )}\r\n        {...props}\r\n    />\r\n))\r\nCard.displayName = \"Card\"\r\n\r\nconst CardHeader = React.forwardRef<\r\n    HTMLDivElement,\r\n    React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n    <div\r\n        ref={ref}\r\n        className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\r\n        {...props}\r\n    />\r\n))\r\nCardHeader.displayName = \"CardHeader\"\r\n\r\nconst CardTitle = React.forwardRef<\r\n    HTMLParagraphElement,\r\n    React.HTMLAttributes<HTMLHeadingElement>\r\n>(({ className, ...props }, ref) => (\r\n    <h3\r\n        ref={ref}\r\n        className={cn(\"font-bold text-xl tracking-tight text-white group-hover:text-accent transition-colors\", className)} // Highlight title on hover\r\n        {...props}\r\n    />\r\n))\r\nCardTitle.displayName = \"CardTitle\"\r\n\r\nconst CardDescription = React.forwardRef<\r\n    HTMLParagraphElement,\r\n    React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => (\r\n    <p\r\n        ref={ref}\r\n        className={cn(\"text-sm text-white/60 font-medium\", className)}\r\n        {...props}\r\n    />\r\n))\r\nCardDescription.displayName = \"CardDescription\"\r\n\r\nconst CardContent = React.forwardRef<\r\n    HTMLDivElement,\r\n    React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n    <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\r\n))\r\nCardContent.displayName = \"CardContent\"\r\n\r\nconst CardFooter = React.forwardRef<\r\n    HTMLDivElement,\r\n    React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => (\r\n    <div\r\n        ref={ref}\r\n        className={cn(\"flex items-center p-6 pt-0\", className)}\r\n        {...props}\r\n    />\r\n))\r\nCardFooter.displayName = \"CardFooter\"\r\n\r\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\r\n","\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { collection, query, where, getDocs, orderBy, onSnapshot } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebase\";\r\n\r\nexport default function StudentNoticesPage() {\r\n    const { user } = useAuth();\r\n    const [notices, setNotices] = useState<any[]>([]);\r\n    const [classId, setClassId] = useState<string | null>(null);\r\n    const [useFallback, setUseFallback] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!user?.uid) return;\r\n\r\n        const fetchProfile = async () => {\r\n            try {\r\n                const sRef = collection(db, \"students\");\r\n                const qProfile = query(sRef, where(\"uid\", \"==\", user.uid));\r\n                const pSnap = await getDocs(qProfile);\r\n                if (!pSnap.empty) {\r\n                    setClassId(pSnap.docs[0].data().classId || \"NONE\");\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error fetching student profile:\", e);\r\n            }\r\n        };\r\n\r\n        fetchProfile();\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (!user?.uid || classId === null) return;\r\n\r\n        let isMounted = true;\r\n\r\n        const q = useFallback\r\n            ? query(\r\n                collection(db, \"notices\"),\r\n                where(\"target\", \"in\", [\"ALL\", \"STUDENTS\", classId])\r\n            )\r\n            : query(\r\n                collection(db, \"notices\"),\r\n                where(\"target\", \"in\", [\"ALL\", \"STUDENTS\", classId]),\r\n                orderBy(\"createdAt\", \"desc\")\r\n            );\r\n\r\n        const unsubscribe = onSnapshot(q, (snap) => {\r\n            if (!isMounted) return;\r\n            const now = Date.now();\r\n            let list = snap.docs.map(d => ({ id: d.id, ...d.data() }))\r\n                .filter((n: any) => {\r\n                    if (n.expiresAt) return n.expiresAt.seconds * 1000 > now;\r\n                    return true;\r\n                });\r\n\r\n            if (useFallback) {\r\n                list = list.sort((a: any, b: any) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));\r\n            }\r\n            setNotices(list);\r\n        }, (err) => {\r\n            if (!isMounted) return;\r\n            if (err.message.includes(\"index\") && !useFallback) {\r\n                console.warn(\"[Notices] Index missing, switching to fallback query.\");\r\n                setUseFallback(true);\r\n            } else if (!err.message.includes(\"index\")) {\r\n                console.error(\"Notice listener error:\", err);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            isMounted = false;\r\n            unsubscribe();\r\n        };\r\n    }, [user, classId, useFallback]);\r\n\r\n    const formatTimestamp = (timestamp: any) => {\r\n        if (!timestamp) return '';\r\n        const date = new Date(timestamp.seconds * 1000);\r\n        const now = Date.now();\r\n        const diff = now - date.getTime();\r\n\r\n        if (diff < 60 * 1000) return 'Just now';\r\n        if (diff < 60 * 60 * 1000) {\r\n            const minutes = Math.floor(diff / (60 * 1000));\r\n            return `${minutes} min ago`;\r\n        }\r\n        if (diff < 24 * 60 * 60 * 1000) {\r\n            const hours = Math.floor(diff / (60 * 60 * 1000));\r\n            return `${hours} hour${hours > 1 ? 's' : ''} ago`;\r\n        }\r\n        return date.toLocaleDateString();\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-4xl mx-auto space-y-6 animate-in fade-in\">\r\n            <h1 className=\"text-3xl font-display font-bold\">Inbox</h1>\r\n\r\n            <div className=\"space-y-4\">\r\n                {notices.length === 0 ? <p className=\"text-muted-foreground\">No active notices.</p> : notices.map(n => (\r\n                    <Card key={n.id} className=\"bg-black/20 border-white/10\">\r\n                        <CardContent className=\"p-5\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <h3 className=\"font-bold text-lg\">{n.title}</h3>\r\n                                        {n.type === \"HOLIDAY\" && <span className=\"text-[10px] bg-yellow-500/20 text-yellow-500 px-2 py-0.5 rounded-full font-bold\">HOLIDAY</span>}\r\n                                    </div>\r\n                                </div>\r\n                                <span className=\"text-xs text-muted-foreground whitespace-nowrap\">{formatTimestamp(n.createdAt)}</span>\r\n                            </div>\r\n                            <p className=\"text-sm leading-relaxed\">{n.content}</p>\r\n                            <div className=\"mt-3 text-xs text-muted-foreground\">From: {n.senderName} ({n.senderRole})</div>\r\n                        </CardContent>\r\n                    </Card>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}