module.exports=[84550,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91410),e=a.i(81269),f=a.i(56025),g=a.i(20237);a.i(69387);var h=a.i(60574),i=a.i(91119),j=a.i(99570),k=a.i(86304),l=a.i(96221),m=a.i(33441),n=a.i(33508),o=a.i(14548);let p=(0,a.i(70106).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var q=a.i(87532),r=a.i(71931),s=a.i(88110),t=a.i(66718),u=a.i(80701),v=a.i(89402),w=a.i(68114);function x({defaultDate:a}){let{user:e}=(0,f.useAuth)(),{branding:x}=(0,d.useMasterData)(),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)({}),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(new Set),[M,N]=(0,c.useState)({}),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)([]),[U,V]=(0,c.useState)("ALL"),W=a||new Date().toISOString().split("T")[0];(0,c.useEffect)(()=>{Q?X():Y()},[W,Q,U]);let X=async()=>{D(!0);try{let a,b,c=(0,h.query)((0,h.collection)(g.db,"teachers"),(0,h.where)("status","==","ACTIVE")),d=(await (0,h.getDocs)(c)).docs.map(a=>({id:a.id,schoolId:a.data().schoolId||a.id,name:a.data().name})).sort((a,b)=>a.name.localeCompare(b.name)),e=new Date().getFullYear();"ALL"===U?(a=`TEACHERS_${e}-01-01`,b=`TEACHERS_${e}-12-31`):(a=`TEACHERS_${e}-${U}-01`,b=`TEACHERS_${e}-${U}-31`);let f=(0,h.query)((0,h.collection)(g.db,"attendance"),(0,h.where)((0,h.documentId)(),">=",a),(0,h.where)((0,h.documentId)(),"<=",b)),i=await (0,h.getDocs)(f),j={};i.docs.forEach(a=>{let b=a.data();b.records&&Object.entries(b.records).forEach(([a,b])=>{j[a]||(j[a]={total:0,present:0}),("P"===b||"A"===b)&&(j[a].total++,"P"===b&&j[a].present++)})});let k=d.map(a=>{let b=j[a.schoolId]||{total:0,present:0};return{...a,totalDays:b.total,presentDays:b.present,percentage:b.total>0?(b.present/b.total*100).toFixed(1):"0.0"}});T(k),z(d)}catch(a){console.error("Stats error",a),(0,s.toast)({title:"Error",description:"Failed to load stats",type:"error"})}finally{D(!1)}},Y=async()=>{D(!0);try{let a=(0,h.query)((0,h.collection)(g.db,"teachers"),(0,h.where)("status","==","ACTIVE")),b=(await (0,h.getDocs)(a)).docs.map(a=>{let b=a.data();return{id:a.id,schoolId:b.schoolId||a.id,name:b.name,uid:b.uid}}).sort((a,b)=>a.name.localeCompare(b.name));z(b);let c=(0,h.query)((0,h.collection)(g.db,"leave_requests"),(0,h.where)("status","==","APPROVED")),d=await (0,h.getDocs)(c),e={},f={};b.forEach(a=>{a.uid&&(f[a.uid]=a.schoolId)}),d.forEach(a=>{let b=a.data();if(b.fromDate<=W&&b.toDate>=W){let a=f[b.teacherId];a&&(e[a]=!0)}}),N(e);let i=`TEACHERS_${W}`,j=await (0,h.getDoc)((0,h.doc)(g.db,"attendance",i));if(j.exists())H(!0),B(j.data().records||{});else{H(!1);let a={};b.forEach(b=>{let c=e[b.schoolId];a[b.schoolId]=c?"A":"P"}),B(a)}}catch(a){console.error(a),(0,s.toast)({title:"Error",description:"Failed to fetch data.",type:"error"})}finally{D(!1)}},Z=async()=>{F(!0);try{let a=await fetch("/api/admin/attendance/teachers/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:W,records:A,markedBy:e?.uid,markedByName:e?.displayName||"Admin",isModification:G,touchedIds:Array.from(K)})}),b=await a.json();if(!b.success)throw Error(b.error);(0,s.toast)({title:G?"Attendance Updated":"Attendance Submitted",description:`Updated ${b.changesCount||0} records.`,type:"success"}),H(!0),J(!1),L(new Set)}catch(a){console.error(a),(0,s.toast)({title:"Failed",description:a.message,type:"error"})}finally{F(!1)}},$=y.filter(a=>a.name.toLowerCase().includes(O.toLowerCase())||a.schoolId.toLowerCase().includes(O.toLowerCase()));if(C)return(0,b.jsx)("div",{className:"p-10 flex justify-center",children:(0,b.jsx)(l.Loader2,{className:"animate-spin"})});let _={total:y.length,present:Object.values(A).filter(a=>"P"===a).length,absent:Object.values(A).filter(a=>"A"===a).length};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Total Teachers"}),(0,b.jsx)("div",{className:"text-2xl font-bold",children:_.total})]}),(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500",children:(0,b.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-emerald-500",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Present"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-emerald-500",children:_.present})]}),(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500",children:(0,b.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-red-500",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Absent"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-red-500",children:_.absent})]}),(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500",children:(0,b.jsx)(n.X,{className:"w-5 h-5"})})]})})]}),(0,b.jsxs)(i.Card,{className:"bg-black/20 border-white/10",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center",children:[(0,b.jsxs)("div",{className:"flex flex-wrap bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2",children:[(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>R(!1),className:Q?"text-muted-foreground hover:text-white":"bg-emerald-500/20 text-emerald-500",children:"Daily View"}),(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>R(!0),className:Q?"bg-blue-500/20 text-blue-500":"text-muted-foreground hover:text-white",children:"Overall Stats"}),Q&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(u.Select,{value:U,onValueChange:V,children:[(0,b.jsx)(u.SelectTrigger,{className:"w-[140px] h-8 bg-transparent border-white/10 text-xs",children:(0,b.jsx)(u.SelectValue,{placeholder:"Period"})}),(0,b.jsxs)(u.SelectContent,{className:"bg-slate-900 border-white/10",children:[(0,b.jsxs)(u.SelectItem,{value:"ALL",children:["Full Year ",new Date().getFullYear()]}),(0,b.jsx)(u.SelectItem,{value:"01",children:"January"}),(0,b.jsx)(u.SelectItem,{value:"02",children:"February"}),(0,b.jsx)(u.SelectItem,{value:"03",children:"March"}),(0,b.jsx)(u.SelectItem,{value:"04",children:"April"}),(0,b.jsx)(u.SelectItem,{value:"05",children:"May"}),(0,b.jsx)(u.SelectItem,{value:"06",children:"June"}),(0,b.jsx)(u.SelectItem,{value:"07",children:"July"}),(0,b.jsx)(u.SelectItem,{value:"08",children:"August"}),(0,b.jsx)(u.SelectItem,{value:"09",children:"September"}),(0,b.jsx)(u.SelectItem,{value:"10",children:"October"}),(0,b.jsx)(u.SelectItem,{value:"11",children:"November"}),(0,b.jsx)(u.SelectItem,{value:"12",children:"December"})]})]}),(0,b.jsxs)(j.Button,{size:"sm",variant:"outline",className:"h-8 border-white/10 hover:bg-white/5 gap-2 px-3",onClick:()=>{let a="ALL"===U?`Annual Report ${new Date().getFullYear()}`:`Monthly Report - ${new Date(2e3,Number(U)-1).toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,b=`
            <html>
            <head>
                <title>Teacher Attendance Report - ${a}</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }
                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                    .logo { height: 80px; width: auto; object-fit: contain; }
                    .header-text { text-align: left; }
                    h1 { margin: 0; font-size: 28px; }
                    .period { font-size: 14px; color: #666; margin-top: 2px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }
                    .text-center { text-align: center; }
                    .font-bold { font-weight: bold; }
                    .percentage { font-weight: bold; }
                    .low { color: #dc3545; }
                    .good { color: #28a745; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    ${x?.schoolLogo?`<img src="${x.schoolLogo}" class="logo" />`:""}
                    <div class="header-text">
                        <h1 style="margin: 0;">${x?.schoolName||"Attendance Report"}</h1>
                        <div class="period">Teacher Attendance - ${a}</div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Teacher Name</th>
                            <th class="text-center">ID</th>
                            <th class="text-center">Total Days</th>
                            <th class="text-center">Present</th>
                            <th class="text-center">Absents</th>
                            <th class="text-center">Attendance %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${S.map((a,b)=>`
                            <tr>
                                <td>${b+1}</td>
                                <td class="font-bold">${a.name}</td>
                                <td class="text-center">${a.schoolId}</td>
                                <td class="text-center">${a.totalDays}</td>
                                <td class="text-center" style="color: #28a745; font-weight: bold;">${a.presentDays}</td>
                                <td class="text-center">${a.totalDays-a.presentDays}</td>
                                <td class="text-center percentage ${80>Number(a.percentage)?"low":"good"}">${a.percentage}%</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <div class="footer">
                    <div>Generated on: ${new Date().toLocaleString()}</div>
                    <div>School Management System</div>
                </div>
                <script>
                    window.onload = () => {
                        window.print();
                        window.onafterprint = () => window.close();
                    };
                </script>
            </body>
            </html>
        `,c=window.open("","_blank");c?.document.write(b),c?.document.close()},children:[(0,b.jsx)(r.Printer,{className:"w-3 h-3"})," Print Report"]})]})]}),!Q&&(0,b.jsxs)("div",{className:"relative flex-1 w-full md:max-w-xs",children:[(0,b.jsx)(q.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(t.Input,{placeholder:"Search teachers...",value:O,onChange:a=>P(a.target.value),className:"pl-8 bg-black/40 border-white/10 w-full"})]})]}),(0,b.jsx)(i.CardContent,{className:"p-0",children:(0,b.jsx)(v.DataTable,{data:Q?S:$,isLoading:C,columns:Q?[{key:"index",header:"#",render:(a,c)=>(0,b.jsx)("span",{className:"font-mono text-sm",children:(c??0)+1})},{key:"name",header:"Teacher Name",render:a=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-white",children:a.name}),(0,b.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:a.schoolId})]})},{key:"totalDays",header:"Total",cellClassName:"text-center",render:a=>(0,b.jsx)("span",{className:"font-mono",children:a.totalDays})},{key:"presentDays",header:"Present",cellClassName:"text-center",render:a=>(0,b.jsx)("span",{className:"font-bold text-emerald-400",children:a.presentDays})},{key:"percentage",header:"Attendance %",cellClassName:"text-center",render:a=>(0,b.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,b.jsxs)("span",{className:`font-bold ${80>Number(a.percentage)?"text-red-400":"text-emerald-400"}`,children:[a.percentage,"%"]}),(0,b.jsx)("div",{className:"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]",children:(0,b.jsx)("div",{className:`h-full ${80>Number(a.percentage)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${a.percentage}%`}})})]})},{key:"leaves",header:"Leaves",cellClassName:"text-right",render:a=>(0,b.jsx)("span",{className:"text-white/40",children:a.totalDays-a.presentDays})}]:[{key:"index",header:"#",render:(a,c)=>(0,b.jsx)("span",{className:"font-mono text-sm",children:(c??0)+1})},{key:"name",header:"Teacher Name",render:a=>{let c=M[a.schoolId];return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium flex items-center gap-2 text-white",children:[a.name,c&&(0,b.jsxs)(k.Badge,{variant:"outline",className:"text-[8px] md:text-[10px] border-yellow-500/50 text-yellow-500 bg-yellow-500/10 gap-1 px-1 py-0 uppercase font-black",children:[(0,b.jsx)(p,{className:"w-3 h-3"})," Leave"]})]}),(0,b.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:a.schoolId})]})}},{key:"attendanceStatus",header:"Status",cellClassName:"text-center",render:a=>{let c=A[a.schoolId];return(0,b.jsx)(k.Badge,{className:(0,w.cn)("font-black uppercase tracking-tighter text-[9px]","P"===c?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"),children:"P"===c?"Present":"Absent"})}},{key:"action",header:"Action",cellClassName:"text-right",render:a=>{let c=A[a.schoolId];return(0,b.jsx)(j.Button,{size:"sm",variant:"ghost",className:(0,w.cn)("h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg","P"===c?"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white":"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white"),onClick:()=>{var b;return b=a.schoolId,void(B(a=>({...a,[b]:"P"===a[b]?"A":"P"})),L(a=>{let c=new Set(a);return c.add(b),c}),J(!0))},children:"P"===c?"Mark Absent":"Mark Present"})}}]})})]}),!Q&&(0,b.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:G?I?"You have unsaved changes.":`Attendance already marked by ${e?.uid==="admin"?"Admin":"System"}`:"Ready to submit."}),(0,b.jsxs)(j.Button,{size:"lg",onClick:Z,disabled:E||G&&!I,className:"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]",children:[E?(0,b.jsx)(l.Loader2,{className:"w-5 h-5 animate-spin mr-2"}):(0,b.jsx)(o.Save,{className:"w-5 h-5 mr-2"}),G?"Update Attendance":"Submit Attendance"]})]})]})}function y({defaultDate:a}){let{user:e}=(0,f.useAuth)(),{branding:p}=(0,d.useMasterData)(),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)({}),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(new Set),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)("ALL"),T=a||new Date().toISOString().split("T")[0];(0,c.useEffect)(()=>{N?U():V()},[T,N,R]);let U=async()=>{C(!0);try{let a,b,c=(await (0,h.getDocs)((0,h.collection)(g.db,"staff"))).docs.map(a=>{let b=a.data();return{id:a.id,schoolId:a.id,name:b.name,role:b.roleName||"Staff"}}).sort((a,b)=>a.name.localeCompare(b.name)),d=new Date().getFullYear();"ALL"===R?(a=`STAFF_${d}-01-01`,b=`STAFF_${d}-12-31`):(a=`STAFF_${d}-${R}-01`,b=`STAFF_${d}-${R}-31`);let e=(0,h.query)((0,h.collection)(g.db,"attendance"),(0,h.where)((0,h.documentId)(),">=",a),(0,h.where)((0,h.documentId)(),"<=",b)),f=await (0,h.getDocs)(e),i={};f.docs.forEach(a=>{let b=a.data();b.records&&Object.entries(b.records).forEach(([a,b])=>{i[a]||(i[a]={total:0,present:0}),("P"===b||"A"===b)&&(i[a].total++,"P"===b&&i[a].present++)})});let j=c.map(a=>{let b=i[a.schoolId]||{total:0,present:0};return{...a,totalDays:b.total,presentDays:b.present,percentage:b.total>0?(b.present/b.total*100).toFixed(1):"0.0"}});Q(j),y(c)}catch(a){console.error("Stats error",a),(0,s.toast)({title:"Error",description:"Failed to load stats",type:"error"})}finally{C(!1)}},V=async()=>{C(!0);try{let a=(await (0,h.getDocs)((0,h.collection)(g.db,"staff"))).docs.map(a=>{let b=a.data();return{id:a.id,schoolId:a.id,name:b.name,role:b.roleName||"Staff"}}).sort((a,b)=>a.name.localeCompare(b.name));y(a);let b=`STAFF_${T}`,c=await (0,h.getDoc)((0,h.doc)(g.db,"attendance",b));if(c.exists())G(!0),A(c.data().records||{});else{G(!1);let b={};a.forEach(a=>{b[a.schoolId]="P"}),A(b)}}catch(a){console.error(a),(0,s.toast)({title:"Error",description:"Failed to fetch data.",type:"error"})}finally{C(!1)}},W=async()=>{E(!0);try{let a=await fetch("/api/admin/attendance/staff/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:T,records:z,markedBy:e?.uid,markedByName:e?.displayName||"Admin",isModification:F,touchedIds:Array.from(J)})}),b=await a.json();if(!b.success)throw Error(b.error);(0,s.toast)({title:F?"Attendance Updated":"Attendance Submitted",description:`Updated ${b.changesCount||0} records.`,type:"success"}),G(!0),I(!1),K(new Set)}catch(a){console.error(a),(0,s.toast)({title:"Failed",description:a.message,type:"error"})}finally{E(!1)}},X=x.filter(a=>a.name.toLowerCase().includes(L.toLowerCase())||a.role.toLowerCase().includes(L.toLowerCase()));if(B)return(0,b.jsx)("div",{className:"p-10 flex justify-center",children:(0,b.jsx)(l.Loader2,{className:"animate-spin"})});let Y={total:x.length,present:Object.values(z).filter(a=>"P"===a).length,absent:Object.values(z).filter(a=>"A"===a).length};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Total Staff"}),(0,b.jsx)("div",{className:"text-2xl font-bold",children:Y.total})]}),(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500",children:(0,b.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-emerald-500",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Present"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-emerald-500",children:Y.present})]}),(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500",children:(0,b.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-red-500",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Absent"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-red-500",children:Y.absent})]}),(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500",children:(0,b.jsx)(n.X,{className:"w-5 h-5"})})]})})]}),(0,b.jsxs)(i.Card,{className:"bg-black/20 border-white/10",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center",children:[(0,b.jsxs)("div",{className:"flex flex-wrap bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2",children:[(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>O(!1),className:N?"text-muted-foreground hover:text-white":"bg-emerald-500/20 text-emerald-500",children:"Daily View"}),(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>O(!0),className:N?"bg-blue-500/20 text-blue-500":"text-muted-foreground hover:text-white",children:"Overall Stats"}),N&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(u.Select,{value:R,onValueChange:S,children:[(0,b.jsx)(u.SelectTrigger,{className:"w-[140px] h-8 bg-transparent border-white/10 text-xs",children:(0,b.jsx)(u.SelectValue,{placeholder:"Period"})}),(0,b.jsxs)(u.SelectContent,{className:"bg-slate-900 border-white/10",children:[(0,b.jsxs)(u.SelectItem,{value:"ALL",children:["Full Year ",new Date().getFullYear()]}),(0,b.jsx)(u.SelectItem,{value:"01",children:"January"}),(0,b.jsx)(u.SelectItem,{value:"02",children:"February"}),(0,b.jsx)(u.SelectItem,{value:"03",children:"March"}),(0,b.jsx)(u.SelectItem,{value:"04",children:"April"}),(0,b.jsx)(u.SelectItem,{value:"05",children:"May"}),(0,b.jsx)(u.SelectItem,{value:"06",children:"June"}),(0,b.jsx)(u.SelectItem,{value:"07",children:"July"}),(0,b.jsx)(u.SelectItem,{value:"08",children:"August"}),(0,b.jsx)(u.SelectItem,{value:"09",children:"September"}),(0,b.jsx)(u.SelectItem,{value:"10",children:"October"}),(0,b.jsx)(u.SelectItem,{value:"11",children:"November"}),(0,b.jsx)(u.SelectItem,{value:"12",children:"December"})]})]}),(0,b.jsxs)(j.Button,{size:"sm",variant:"outline",className:"h-8 border-white/10 hover:bg-white/5 gap-2 px-3",onClick:()=>{let a="ALL"===R?`Annual Report ${new Date().getFullYear()}`:`Monthly Report - ${new Date(2e3,Number(R)-1).toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,b=`
            <html>
            <head>
                <title>Staff Attendance Report - ${a}</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }
                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                    .logo { height: 80px; width: auto; object-fit: contain; }
                    .header-text { text-align: left; }
                    h1 { margin: 0; font-size: 28px; }
                    .period { font-size: 14px; color: #666; margin-top: 2px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }
                    .text-center { text-align: center; }
                    .font-bold { font-weight: bold; }
                    .percentage { font-weight: bold; }
                    .low { color: #dc3545; }
                    .good { color: #28a745; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    ${p?.schoolLogo?`<img src="${p.schoolLogo}" class="logo" />`:""}
                    <div class="header-text">
                        <h1 style="margin: 0;">${p?.schoolName||"Attendance Report"}</h1>
                        <div class="period">Staff Attendance - ${a}</div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Staff Name</th>
                            <th>Role</th>
                            <th class="text-center">Total Days</th>
                            <th class="text-center">Present</th>
                            <th class="text-center">Absents</th>
                            <th class="text-center">Attendance %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${P.map((a,b)=>`
                            <tr>
                                <td>${b+1}</td>
                                <td class="font-bold">${a.name}</td>
                                <td>${a.role}</td>
                                <td class="text-center">${a.totalDays}</td>
                                <td class="text-center" style="color: #28a745; font-weight: bold;">${a.presentDays}</td>
                                <td class="text-center">${a.totalDays-a.presentDays}</td>
                                <td class="text-center percentage ${80>Number(a.percentage)?"low":"good"}">${a.percentage}%</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <div class="footer">
                    <div>Generated on: ${new Date().toLocaleString()}</div>
                    <div>School Management System</div>
                </div>
                <script>
                    window.onload = () => {
                        window.print();
                        window.onafterprint = () => window.close();
                    };
                </script>
            </body>
            </html>
        `,c=window.open("","_blank");c?.document.write(b),c?.document.close()},children:[(0,b.jsx)(r.Printer,{className:"w-3 h-3"})," Print Report"]})]})]}),!N&&(0,b.jsxs)("div",{className:"relative flex-1 w-full md:max-w-xs",children:[(0,b.jsx)(q.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(t.Input,{placeholder:"Search staff...",value:L,onChange:a=>M(a.target.value),className:"pl-8 bg-black/40 border-white/10 w-full"})]})]}),(0,b.jsx)(i.CardContent,{className:"p-0",children:(0,b.jsx)(v.DataTable,{data:N?P:X,isLoading:B,columns:N?[{key:"index",header:"#",render:(a,c)=>(0,b.jsx)("span",{className:"font-mono text-sm",children:(c??0)+1})},{key:"name",header:"Staff Name",render:a=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-white",children:a.name}),(0,b.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:a.role})]})},{key:"totalDays",header:"Total",cellClassName:"text-center",render:a=>(0,b.jsx)("span",{className:"font-mono",children:a.totalDays})},{key:"presentDays",header:"Present",cellClassName:"text-center",render:a=>(0,b.jsx)("span",{className:"font-bold text-emerald-400",children:a.presentDays})},{key:"percentage",header:"Attendance %",cellClassName:"text-center",render:a=>(0,b.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,b.jsxs)("span",{className:`font-bold ${80>Number(a.percentage)?"text-red-400":"text-emerald-400"}`,children:[a.percentage,"%"]}),(0,b.jsx)("div",{className:"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]",children:(0,b.jsx)("div",{className:`h-full ${80>Number(a.percentage)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${a.percentage}%`}})})]})},{key:"absents",header:"Absents",cellClassName:"text-right",render:a=>(0,b.jsx)("span",{className:"text-white/40",children:a.totalDays-a.presentDays})}]:[{key:"index",header:"#",render:(a,c)=>(0,b.jsx)("span",{className:"font-mono text-sm",children:(c??0)+1})},{key:"name",header:"Staff Name",render:a=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-white",children:a.name}),(0,b.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:a.role})]})},{key:"attendanceStatus",header:"Status",cellClassName:"text-center",render:a=>{let c=z[a.schoolId];return(0,b.jsx)(k.Badge,{className:(0,w.cn)("font-black uppercase tracking-tighter text-[9px]","P"===c?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"),children:"P"===c?"Present":"Absent"})}},{key:"action",header:"Action",cellClassName:"text-right",render:a=>{let c=z[a.schoolId];return(0,b.jsx)(j.Button,{size:"sm",variant:"ghost",className:(0,w.cn)("h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg","P"===c?"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white":"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white"),onClick:()=>{var b;return b=a.schoolId,void(A(a=>({...a,[b]:"P"===a[b]?"A":"P"})),K(a=>{let c=new Set(a);return c.add(b),c}),I(!0))},children:"P"===c?"Mark Absent":"Mark Present"})}}]})})]}),!N&&(0,b.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:F?H?"You have unsaved changes.":`Attendance already marked by ${e?.uid==="admin"?"Admin":"System"}`:"Ready to submit."}),(0,b.jsxs)(j.Button,{size:"lg",onClick:W,disabled:D||F&&!H,className:"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]",children:[D?(0,b.jsx)(l.Loader2,{className:"w-5 h-5 animate-spin mr-2"}):(0,b.jsx)(o.Save,{className:"w-5 h-5 mr-2"}),F?"Update Attendance":"Submit Attendance"]})]})]})}var z=a.i(75083);function A(){let{classes:a,classSections:f,sections:g}=(0,d.useMasterData)(),[h,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(new Date().toISOString().split("T")[0]),o=h?Object.values(f||{}).filter(a=>a.classId===h).map(a=>g[a.sectionId]).filter(Boolean):[];return(0,b.jsxs)("div",{className:"max-w-none p-0 space-y-6 animate-in fade-in",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 border-b border-white/10 pb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-display font-bold",children:"Attendance Management"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Mark or modify attendance for students and teachers."})]}),(0,b.jsxs)("div",{className:"w-full md:w-48 space-y-2",children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground uppercase font-medium",children:"Select Date"}),(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("input",{type:"date",value:m,onChange:a=>n(a.target.value),className:"bg-white/5 border border-white/10 rounded-md py-2 px-3 w-full text-white focus:outline-none focus:ring-1 focus:ring-emerald-500/50"})})]})]}),(0,b.jsxs)(z.Tabs,{defaultValue:"student",className:"w-full",children:[(0,b.jsxs)(z.TabsList,{className:"flex flex-wrap h-auto w-full md:grid md:grid-cols-3 md:w-full max-w-[600px] mb-6 bg-black/40 border border-white/10 gap-2 p-1",children:[(0,b.jsx)(z.TabsTrigger,{value:"student",className:"flex-1 min-w-[140px]",children:"Student Attendance"}),(0,b.jsx)(z.TabsTrigger,{value:"teacher",className:"flex-1 min-w-[140px]",children:"Teacher Attendance"}),(0,b.jsx)(z.TabsTrigger,{value:"staff",className:"flex-1 min-w-[140px]",children:"Staff Attendance"})]}),(0,b.jsxs)(z.TabsContent,{value:"student",className:"space-y-6",children:[(0,b.jsx)(i.Card,{className:"bg-black/20 border-white/10 p-4",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[(0,b.jsxs)("div",{className:"space-y-2 w-full md:w-48",children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground uppercase",children:"Class"}),(0,b.jsxs)(u.Select,{value:h,onValueChange:a=>{j(a),l("")},children:[(0,b.jsx)(u.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(u.SelectValue,{placeholder:"Select Class"})}),(0,b.jsx)(u.SelectContent,{children:Object.values(a).map(a=>(0,b.jsx)(u.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2 w-full md:w-32",children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground uppercase",children:"Section"}),(0,b.jsxs)(u.Select,{value:k,onValueChange:l,disabled:!h,children:[(0,b.jsx)(u.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(u.SelectValue,{placeholder:"Sec"})}),(0,b.jsx)(u.SelectContent,{children:o.map(a=>(0,b.jsx)(u.SelectItem,{value:a.id,children:a.name},a.id))})]}),h&&0===o.length&&(0,b.jsx)("p",{className:"text-[10px] text-red-400",children:"No sections linked."})]})]})}),h&&k?(0,b.jsx)("div",{children:(0,b.jsx)(e.default,{classId:h,sectionId:k,defaultDate:m})},`${h}-${k}-${m}`):(0,b.jsx)("div",{className:"flex flex-col items-center justify-center p-20 border border-dashed border-white/10 rounded-xl bg-white/5",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Please select Class and Section to view student attendance."})})]}),(0,b.jsx)(z.TabsContent,{value:"teacher",children:(0,b.jsx)(x,{defaultDate:m})}),(0,b.jsx)(z.TabsContent,{value:"staff",children:(0,b.jsx)(y,{defaultDate:m})})]})]})}a.s(["default",()=>A],84550)}];

//# sourceMappingURL=src_app_admin_attendance_page_tsx_8f9811e3._.js.map