module.exports=[19787,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(69387);var e=a.i(60574),f=a.i(20237),g=a.i(99570),h=a.i(66718),i=a.i(70430),j=a.i(14574),k=a.i(210),l=a.i(24569),m=a.i(81560),n=a.i(96221),o=a.i(11156),p=a.i(66384),q=a.i(91965),r=a.i(65385),s=a.i(43108),t=a.i(69520),u=a.i(71931),v=a.i(38246),w=a.i(91119),x=a.i(68114),y=a.i(80701),z=a.i(62244),A=a.i(73570),B=a.i(88110),C=a.i(56025);function D({isOpen:a,onClose:d,studentId:e,ledgerItems:f,onSuccess:k}){let[l,m]=(0,c.useState)(""),[o,p]=(0,c.useState)("DISCOUNT"),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!1),w=f.find(a=>a.id===l),x=w&&q?"DISCOUNT"===o?Math.max(0,w.amount-Number(q)):Number(q):null,{user:z}=(0,C.useAuth)(),D=async()=>{if(l&&q&&s&&z){v(!0);try{let a=await z.getIdToken(),b=await fetch("/api/admin/fees/adjust",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({studentId:e,adjustments:[{id:l,type:o,value:Number(q)}],reason:s})}),c=await b.json();if(!b.ok)throw Error(c.error);(0,B.toast)({title:"Fees Adjusted",description:"Student fees have been updated.",type:"success"}),k(),d()}catch(a){(0,B.toast)({title:"Adjustment Failed",description:a.message||"Could not update fees.",type:"error"})}finally{v(!1)}}};return(0,b.jsx)(j.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(j.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[500px]",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Adjust Student Fees"})}),(0,b.jsxs)("div",{className:"space-y-4 py-2",children:[(0,b.jsxs)("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md flex items-start gap-2 text-xs text-yellow-500",children:[(0,b.jsx)(A.AlertTriangle,{className:"w-4 h-4 shrink-0"}),(0,b.jsx)("p",{children:"Adjustments are permanently recorded in the audit log. Ensure you have authorization to offer discounts or overrides."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Select Fee Term"}),(0,b.jsxs)(y.Select,{value:l,onValueChange:m,children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(y.SelectValue,{placeholder:"Choose term..."})}),(0,b.jsx)(y.SelectContent,{children:f.filter(a=>"PAID"!==a.status).map(a=>(0,b.jsxs)(y.SelectItem,{value:a.id,children:[a.name," (Current: ₹",a.amount,")"]},a.id))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Adjustment Type"}),(0,b.jsxs)(y.Select,{value:o,onValueChange:a=>p(a),children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,b.jsx)(y.SelectValue,{})}),(0,b.jsxs)(y.SelectContent,{children:[(0,b.jsx)(y.SelectItem,{value:"DISCOUNT",children:"Discount (Reduce by)"}),(0,b.jsx)(y.SelectItem,{value:"OVERRIDE",children:"Override (Set to)"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Value (₹)"}),(0,b.jsx)(h.Input,{type:"number",value:q,onChange:a=>r(a.target.value),className:"bg-white/5 border-white/10",placeholder:"e.g. 5000"})]})]}),w&&(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white/5 rounded px-3",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"New Amount:"}),(0,b.jsx)("span",{className:"font-mono font-bold text-emerald-400",children:null!==x?`₹${x.toLocaleString()}`:"-"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Reason (Mandatory)"}),(0,b.jsx)(h.Input,{value:s,onChange:a=>t(a.target.value),className:"bg-white/5 border-white/10",placeholder:"e.g. Merit Scholarship, Sibling Discount"})]})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"ghost",onClick:d,children:"Cancel"}),(0,b.jsx)(g.Button,{onClick:D,disabled:u||!l||!q||!s,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:u?(0,b.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Adjustment"})]})]})})}var E=a.i(86304),F=a.i(9450),G=a.i(64550),H=a.i(91410),I=a.i(48711);function J(){let a=(0,d.useParams)(),A=(0,d.useRouter)(),B=a.id,[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(!0),[R,S]=(0,c.useState)(""),{user:T}=(0,C.useAuth)();(0,c.useEffect)(()=>{if(!T)return;let a=(0,e.onSnapshot)((0,e.doc)(f.db,"users",T.uid),a=>{a.exists()&&S(a.data().role)});return()=>a()},[T]);let[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)({}),[Y,Z]=(0,c.useState)(!1),{villages:$,classes:_,sections:aa,classSections:ab,branding:ac,selectedYear:ad}=(0,H.useMasterData)(),ae=Object.values($||{}).map(a=>({id:a.id,name:a.name})).sort((a,b)=>a.name.localeCompare(b.name)),af=Object.values(_||{}).map(a=>({id:a.id,name:a.name,order:a.order||99})).sort((a,b)=>a.order-b.order),ag=Object.values(aa||{}).map(a=>({id:a.id,name:a.name})).sort((a,b)=>a.name.localeCompare(b.name)),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)({amount:"",method:"cash",date:new Date().toISOString().split("T")[0],remarks:""}),[an,ao]=(0,c.useState)(!1);(0,c.useEffect)(()=>{(async()=>{if(B){Q(!0);try{let a=(0,e.doc)(f.db,"students",B),b=await (0,e.getDoc)(a);if(!b.exists()){alert("Student Not Found"),A.push("/admin/students");return}let c={id:b.id,...b.data()};if(!c.uid)try{let a=(0,e.doc)(f.db,"usersBySchoolId",c.schoolId),b=await (0,e.getDoc)(a);b.exists()&&(c.uid=b.data().uid)}catch(a){console.warn("UID Lookup Failed",a)}K(c),X(c);let d=(0,e.query)((0,e.collection)(f.db,"payments"),(0,e.where)("studentId","==",c.schoolId)),g=(await (0,e.getDocs)(d)).docs.map(a=>({id:a.id,...a.data()}));M(g.sort((a,b)=>{let c=a.date?.toDate?a.date.toDate():new Date(a.date);return(b.date?.toDate?b.date.toDate():new Date(b.date))-c}));let h=(0,e.doc)(f.db,"student_fee_ledgers",`${c.schoolId}_${ad||"2025-2026"}`),i=await (0,e.getDoc)(h);i.exists()?O(i.data()):O(null)}catch(a){console.error("Fetch Error:",a)}finally{Q(!1)}}})()},[B,A,ad]);let ap=async()=>{if(J)try{let a=ae.find(a=>a.id===W.villageId)?.name||W.villageName,b=af.find(a=>a.id===W.classId)?.name||W.className,c=ag.find(a=>a.id===W.sectionId)?.name||W.sectionName,d={...W,villageName:a||null,className:b||null,sectionName:c||null};Object.keys(d).forEach(a=>void 0===d[a]&&delete d[a]),await (0,e.updateDoc)((0,e.doc)(f.db,"students",J.id),d),K({...J,...d}),V(!1),await (0,e.addDoc)((0,e.collection)(f.db,"audit_logs"),{action:"UPDATE_STUDENT_PROFILE",targetId:J.id,details:d,timestamp:e.Timestamp.now()}),"MANAGER"===R&&await (0,I.notifyManagerAction)({userId:J.uid||J.id,title:"Profile Updated",message:`Student profile ${J.studentName} has been updated by Manager ${T?.displayName||"System"}.`,type:"INFO",actionBy:T?.uid,actionByName:T?.displayName||"Manager"}),alert("Profile Updated Successfully")}catch(a){console.error(a),alert("Update Failed: "+a.message)}},aq=async a=>{if(a.preventDefault(),J){ao(!0);try{let a=Number(al.amount);if(a<=0)throw Error("Invalid Amount");let b=new Date,c=`${b.toLocaleDateString()} ${b.toLocaleTimeString()}`,d="MANAGER"===R?` | Collected by manager: ${T?.displayName||"Manager"} at ${c}`:"",g={studentId:J.schoolId,studentName:J.studentName,amount:a,method:al.method,date:e.Timestamp.fromDate(new Date(al.date)),status:"success",remarks:(al.remarks||"")+d,createdAt:e.Timestamp.now(),verifiedBy:"MANAGER"===R?`manager:${T?.displayName||"Manager"}`:"admin"},h=await (0,e.addDoc)((0,e.collection)(f.db,"payments"),g),i=ar+a,j=(0,e.doc)(f.db,"student_fee_ledgers",`${J.schoolId}_${ad||"2025-2026"}`);if(await (0,e.updateDoc)(j,{totalPaid:i,status:i>=as?"PAID":"PENDING",updatedAt:new Date().toISOString()}),M([{id:h.id,...g},...L]),O(a=>a?{...a,totalPaid:i,status:i>=as?"PAID":"PENDING"}:null),"MANAGER"===R)await (0,I.notifyManagerAction)({userId:J.uid||J.id,title:"Fee Payment Received",message:`Payment of ₹${a.toLocaleString()} received via ${al.method}. ${al.remarks?`(${al.remarks})`:""}`,type:"FEE",actionBy:T?.uid,actionByName:T?.displayName||"Manager"});else try{await (0,e.addDoc)((0,e.collection)(f.db,"notifications"),{target:"ALL_ADMINS",title:"Fee Collected",message:`Collected ₹${a.toLocaleString()} from ${J.studentName} (${J.schoolId}) via ${al.method}.`,type:"FEE",status:"UNREAD",createdAt:e.Timestamp.now()}),J.uid&&await (0,e.addDoc)((0,e.collection)(f.db,"notifications"),{userId:J.uid,title:"Fee Payment Received",message:`Payment of ₹${a.toLocaleString()} received via ${al.method}.`,type:"FEE",status:"UNREAD",createdAt:e.Timestamp.now()})}catch(a){console.error("Failed to notify admins",a)}ai(!1),am({amount:"",method:"cash",date:new Date().toISOString().split("T")[0],remarks:""}),alert("Payment Recorded & Ledger Updated")}catch(a){alert(a.message)}finally{ao(!1)}}},ar=L.reduce((a,b)=>a+(Number(b.amount)||0),0),as=N?N.items.reduce((a,b)=>a+b.amount,0):0,at=as-ar,au=as>0?Math.min(ar/as*100,100):0,av=(()=>{if(!N)return{items:[],termsPaid:0,termsTotal:0,customPaid:0,customTotal:0,pending:[],termsPending:0,customPending:0};let a=[...N.items].sort((a,b)=>new Date(a.dueDate).getTime()-new Date(b.dueDate).getTime()),b=ar,c=a.map(a=>{let c=Math.min(b,a.amount);b-=c;let d=a.amount-c,e="PENDING";return c>=a.amount?e="PAID":c>0&&(e="PARTIAL"),{...a,distributedPaid:c,distributedDue:d,distributedStatus:e}});return{items:c,termsPaid:c.filter(a=>"TERM"===a.type).reduce((a,b)=>a+b.distributedPaid,0),termsTotal:c.filter(a=>"TERM"===a.type).reduce((a,b)=>a+b.amount,0),customPaid:c.filter(a=>"TERM"!==a.type).reduce((a,b)=>a+b.distributedPaid,0),customTotal:c.filter(a=>"TERM"!==a.type).reduce((a,b)=>a+b.amount,0),termsPending:c.filter(a=>"TERM"===a.type).reduce((a,b)=>a+b.distributedDue,0),customPending:c.filter(a=>"TERM"!==a.type).reduce((a,b)=>a+b.distributedDue,0),pending:c.filter(a=>a.distributedDue>0).map(a=>({name:a.name,due:a.distributedDue}))}})(),[aw,ax]=(0,c.useState)(!1),[ay,az]=(0,c.useState)(!1),aA=async()=>{if(J){az(!0);try{let a=(await (0,e.getDoc)((0,e.doc)(f.db,"config","fees"))).data(),b=(a?.terms||[]).filter(a=>a.isActive),c=(0,e.query)((0,e.collection)(f.db,"custom_fees"),(0,e.where)("status","==","ACTIVE")),d=await (0,e.getDocs)(c),g=J.classId,h=J.className||"Class 1",i=[];b.forEach(a=>{let b=a.amounts?.[h]||0;b>0&&i.push({id:`TERM_${a.id}`,type:"TERM",name:a.name,dueDate:a.dueDate,amount:Number(b),paidAmount:0,status:"PENDING"})}),d.docs.forEach(a=>{let b=a.data(),c=!1;"CLASS"===b.targetType&&b.targetIds?.includes(g)&&(c=!0),c&&i.push({id:`CUSTOM_${a.id}`,type:"CUSTOM",name:b.name,dueDate:b.dueDate,amount:Number(b.amount),paidAmount:0,status:"PENDING"})});let j=ad||"2025-2026",k=(0,e.doc)(f.db,"student_fee_ledgers",`${J.schoolId}_${j}`),l=await (0,e.getDoc)(k),m=[];l.exists()&&(m=l.data().items||[]);let n=[...m];i.forEach(a=>{let b=n.findIndex(b=>b.id===a.id);if(-1===b)n.push(a);else{let c=n[b];0===c.paidAmount?n[b]={...c,amount:a.amount,dueDate:a.dueDate,name:a.name}:n[b]={...c,dueDate:a.dueDate,name:a.name}}});let o=n.reduce((a,b)=>a+b.amount,0),p={studentId:J.schoolId,academicYearId:j,classId:J.classId,className:J.className,totalFee:o,totalPaid:N?.totalPaid||0,status:(N?.totalPaid||0)>=o?"PAID":"PENDING",items:n,updatedAt:new Date().toISOString()};await (0,e.setDoc)(k,p,{merge:!0}),O({...p,items:n}),"MANAGER"===R&&await (0,I.notifyManagerAction)({userId:J.uid||J.schoolId,title:"Fee Structure Synced",message:`Fee structure for ${J.studentName} has been recalculated & synced with global config by Manager ${T?.displayName||"Manager"}.`,type:"INFO",actionBy:T?.uid,actionByName:T?.displayName||"Manager"}),alert("Fees Recalculated Successfully")}catch(a){console.error(a),alert("Recalculate Failed: "+a.message)}finally{az(!1)}}};return P?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] space-y-4",children:[(0,b.jsx)(n.Loader2,{className:"w-10 h-10 animate-spin text-accent"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading Profile..."})]}):J?(0,b.jsxs)("div",{className:"space-y-3 md:space-y-6 max-w-7xl mx-auto pb-20 animate-in fade-in duration-500 p-1 md:p-0",children:[(0,b.jsx)(F.AdminChangePasswordModal,{isOpen:aw,onClose:()=>ax(!1),user:{uid:J.uid||"",schoolId:J.schoolId,name:J.studentName,role:"STUDENT"}}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 pt-2 md:pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,b.jsx)(v.default,{href:"/admin/students",children:(0,b.jsx)(g.Button,{variant:"outline",size:"icon",className:"h-8 w-8 md:h-9 md:w-9 border-white/10 hover:bg-white/10",children:(0,b.jsx)(k.ArrowLeft,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,b.jsx)("h1",{className:"text-lg md:text-3xl font-display font-bold text-white leading-tight",children:J.studentName}),(0,b.jsx)(E.Badge,{variant:"ACTIVE"===J.status?"default":"destructive",className:"uppercase text-[7px] md:text-[10px] h-4 md:h-5 px-1 py-0",children:J.status})]}),(0,b.jsxs)("p",{className:"text-[9px] md:text-sm text-muted-foreground font-mono flex items-center gap-1.5 md:gap-2",children:[(0,b.jsx)("span",{className:"text-accent font-bold",children:J.schoolId}),(0,b.jsx)("span",{children:"•"}),(0,b.jsx)("span",{className:"truncate max-w-[100px] md:max-w-none",children:_[J.classId]?.name||J.className||"Class"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 md:gap-2",children:[("ADMIN"===R||"MANAGER"===R)&&(0,b.jsxs)(j.Dialog,{open:ah,onOpenChange:ai,children:[(0,b.jsx)(j.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{size:"sm",className:"h-8 md:h-11 bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg text-[10px] md:text-sm font-bold flex-1 md:flex-none",children:[(0,b.jsx)(o.CreditCard,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"})," Collect Fee"]})}),(0,b.jsxs)(j.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-md",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Collect Payment"})}),(0,b.jsxs)("form",{onSubmit:aq,className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-400 text-sm flex justify-between",children:[(0,b.jsx)("span",{children:"Current Due:"}),(0,b.jsxs)("span",{className:"font-bold font-mono",children:["₹",at.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(i.Label,{children:["Amount Received (₹) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(h.Input,{required:!0,type:"number",min:"1",placeholder:"Enter amount...",className:"bg-white/5 border-white/10 font-mono text-lg",value:al.amount,onChange:a=>am({...al,amount:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Mode"}),(0,b.jsxs)(y.Select,{value:al.method,onValueChange:a=>am({...al,method:a}),children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10 h-10",children:(0,b.jsx)(y.SelectValue,{})}),(0,b.jsxs)(y.SelectContent,{className:"bg-[#0A192F] border-white/10 text-white",children:[(0,b.jsx)(y.SelectItem,{value:"cash",children:"Cash"}),(0,b.jsx)(y.SelectItem,{value:"upi",children:"UPI / GPay"}),(0,b.jsx)(y.SelectItem,{value:"cheque",children:"Cheque"}),(0,b.jsx)(y.SelectItem,{value:"bank_transfer",children:"Transfer"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Date"}),(0,b.jsx)(h.Input,{type:"date",required:!0,className:"bg-white/5 border-white/10 h-10",value:al.date,onChange:a=>am({...al,date:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Remarks"}),(0,b.jsx)(h.Input,{placeholder:"Note...",className:"bg-white/5 border-white/10 h-10",value:al.remarks,onChange:a=>am({...al,remarks:a.target.value})})]}),(0,b.jsx)(j.DialogFooter,{children:(0,b.jsx)(g.Button,{type:"submit",disabled:an,className:"w-full bg-emerald-600 hover:bg-emerald-700",children:an?(0,b.jsx)(n.Loader2,{className:"animate-spin"}):"Confirm Payment"})})]})]})]}),U?(0,b.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>V(!1),className:"h-8 text-[10px] md:text-xs",children:"Cancel"}),(0,b.jsx)(g.Button,{size:"sm",onClick:ap,className:"h-8 bg-blue-600 hover:bg-blue-700 text-white text-[10px] md:text-xs px-3",children:"Save"})]}):("ADMIN"===R||"MANAGER"===R)&&(0,b.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>ax(!0),className:"h-8 md:h-9 border-white/10 bg-white/5 text-[9px] md:text-sm px-1.5 md:px-4",children:[(0,b.jsx)(s.Lock,{className:"w-3 h-3 md:w-3.5 md:h-3.5 mr-1"})," ",(0,b.jsx)("span",{className:"hidden sm:inline",children:"Reset"})]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>V(!0),className:"h-8 md:h-9 border-white/10 bg-white/5 text-[9px] md:text-sm px-1.5 md:px-4",children:[(0,b.jsx)(l.Edit,{className:"w-3 h-3 md:w-3.5 md:h-3.5 mr-1"})," Edit"]}),"ADMIN"===R&&(0,b.jsx)(g.Button,{variant:"destructive",size:"sm",onClick:()=>Z(!0),className:"h-8 md:h-9 bg-red-500/10 border-red-500/20 text-red-500 hover:bg-red-500/20 px-1.5 md:px-3",children:(0,b.jsx)(p.ShieldAlert,{className:"w-3 h-3 md:w-3.5 md:h-3.5"})})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-4",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-3 md:space-y-4",children:[(0,b.jsxs)(w.Card,{className:"bg-black/20 border-white/10 backdrop-blur-sm",children:[(0,b.jsx)(w.CardHeader,{className:"py-2 md:py-3 px-1.5 md:px-6",children:(0,b.jsx)(w.CardTitle,{className:"text-xs md:text-xl font-bold text-accent italic",children:"Personal Information"})}),(0,b.jsxs)(w.CardContent,{className:"grid grid-cols-2 gap-x-2 md:gap-x-3 gap-y-2 md:gap-y-3 px-1.5 md:px-6 pb-3 md:pb-6",children:[(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Student Name"}),(0,b.jsx)(h.Input,{disabled:!U,className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm font-bold disabled:opacity-100",value:W.studentName,onChange:a=>X({...W,studentName:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Parent Name"}),(0,b.jsx)(h.Input,{disabled:!U,className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm disabled:opacity-100",value:W.parentName,onChange:a=>X({...W,parentName:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Mobile / Password"}),(0,b.jsx)(h.Input,{disabled:!U,className:"bg-white/5 border-white/10 font-mono h-8 md:h-10 text-[12px] md:text-sm disabled:opacity-100",value:W.parentMobile,onChange:a=>X({...W,parentMobile:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Village"}),(0,b.jsxs)(y.Select,{disabled:!U,value:W.villageId,onValueChange:a=>X({...W,villageId:a}),children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,b.jsx)(y.SelectValue,{placeholder:"Village"})}),(0,b.jsx)(y.SelectContent,{className:"bg-[#0A192F] border-white/10",children:ae.map(a=>(0,b.jsx)(y.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Class"}),(0,b.jsxs)(y.Select,{disabled:!U,value:W.classId,onValueChange:a=>X({...W,classId:a}),children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,b.jsx)(y.SelectValue,{placeholder:"Class"})}),(0,b.jsx)(y.SelectContent,{className:"bg-[#0A192F] border-white/10",children:af.map(a=>(0,b.jsx)(y.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Section"}),(0,b.jsxs)(y.Select,{disabled:!U,value:W.sectionId,onValueChange:a=>X({...W,sectionId:a}),children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,b.jsx)(y.SelectValue,{placeholder:"Section"})}),(0,b.jsx)(y.SelectContent,{className:"bg-[#0A192F] border-white/10",children:ag.map(a=>(0,b.jsx)(y.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,b.jsx)(i.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Status"}),(0,b.jsxs)(y.Select,{disabled:!U,value:W.status,onValueChange:a=>X({...W,status:a}),children:[(0,b.jsx)(y.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,b.jsx)(y.SelectValue,{})}),(0,b.jsxs)(y.SelectContent,{className:"bg-[#0A192F] border-white/10",children:[(0,b.jsx)(y.SelectItem,{value:"ACTIVE",children:"Active"}),(0,b.jsx)(y.SelectItem,{value:"PROMOTED",children:"Promoted"}),(0,b.jsx)(y.SelectItem,{value:"DETAINED",children:"Detained"}),(0,b.jsx)(y.SelectItem,{value:"INACTIVE",children:"Inactive"}),(0,b.jsx)(y.SelectItem,{value:"ALUMNI",children:"Alumni"})]})]})]})]})]}),(0,b.jsxs)(w.Card,{className:"bg-black/20 border-white/10",children:[(0,b.jsxs)(w.CardHeader,{className:"flex flex-row items-center justify-between py-2 md:py-3 px-1.5 md:px-6",children:[(0,b.jsx)(w.CardTitle,{className:"text-xs md:text-xl font-bold text-accent italic",children:"Fee Structure"}),(0,b.jsxs)("div",{className:"flex gap-1",children:[("ADMIN"===R||"MANAGER"===R)&&(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:aA,disabled:ay,className:"h-6 px-1.5 md:h-7 md:px-2 border-white/10 bg-white/5 text-[8px] md:text-[9px] font-bold",children:[(0,b.jsx)(t.RefreshCw,{className:`w-2.5 h-2.5 md:w-3 md:h-3 mr-1 ${ay?"animate-spin":""}`})," Sync"]}),(0,b.jsx)(g.Button,{variant:"outline",size:"sm",className:"h-6 px-1.5 md:h-7 md:px-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 text-[8px] md:text-[9px] font-bold",onClick:()=>N&&(0,G.printStudentFeeStructure)({studentName:J.studentName,schoolId:J.schoolId,className:J.className,items:N.items||[],totalPaid:N.totalPaid||0,schoolLogo:ac?.schoolLogo,schoolName:ac?.schoolName}),children:(0,b.jsx)(u.Printer,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-1"})}),("ADMIN"===R||"MANAGER"===R)&&(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"h-6 px-1.5 md:h-7 md:px-2 border-white/10 bg-white/5 text-[8px] md:text-[9px] font-bold",onClick:()=>ak(!0),children:[(0,b.jsx)(r.Settings2,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-1"})," Adjust"]})]})]}),(0,b.jsx)(w.CardContent,{className:"px-1.5 md:px-6 pb-3",children:N&&N.items&&0!==N.items.length?(0,b.jsx)("div",{className:"w-full overflow-x-auto custom-scrollbar",children:(0,b.jsxs)("table",{className:"w-full border-collapse min-w-[600px]",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black border-b border-white/10 italic",children:[(0,b.jsx)("th",{className:"px-1 md:px-3 py-2 text-left",children:"Fee Item"}),(0,b.jsx)("th",{className:"px-1 md:px-2 py-2 text-right",children:"Total"}),(0,b.jsx)("th",{className:"px-1 md:px-2 py-2 text-right",children:"Paid"}),(0,b.jsx)("th",{className:"px-1 md:px-2 py-2 text-right",children:"Due"}),(0,b.jsx)("th",{className:"px-1 md:px-3 py-2 text-right",children:"Status"})]})}),(0,b.jsx)("tbody",{children:av.items.map(a=>(0,b.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors group",children:[(0,b.jsx)("td",{className:"px-1 md:px-3 py-2",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-[11px] md:text-sm font-bold text-white group-hover:text-accent transition-colors leading-tight",children:a.name}),(0,b.jsx)("span",{className:"text-[7px] md:text-[9px] text-white/30 uppercase font-black tracking-tighter",children:a.type})]})}),(0,b.jsxs)("td",{className:"px-1 md:px-2 py-2 text-right font-mono text-[9px] md:text-xs text-white/70",children:["₹",a.amount.toLocaleString()]}),(0,b.jsxs)("td",{className:"px-1 md:px-2 py-2 text-right font-mono text-[9px] md:text-xs text-emerald-400",children:["₹",a.distributedPaid.toLocaleString()]}),(0,b.jsxs)("td",{className:"px-1 md:px-2 py-2 text-right font-mono text-[10px] md:text-xs text-red-400 font-bold",children:["₹",a.distributedDue.toLocaleString()]}),(0,b.jsx)("td",{className:"px-1 md:px-3 py-2 text-right",children:(0,b.jsx)("span",{className:(0,x.cn)("inline-flex px-1 py-0.5 md:px-1.5 rounded-[4px] text-[7px] md:text-[9px] font-black uppercase tracking-tighter","PAID"===a.distributedStatus?"bg-emerald-500/10 text-emerald-400":"PARTIAL"===a.distributedStatus?"bg-amber-500/10 text-amber-500":"bg-red-500/10 text-red-500"),children:a.distributedStatus})})]},a.id))})]})}):(0,b.jsx)("div",{className:"text-center py-6 text-muted-foreground border border-dashed border-white/10 rounded-lg text-xs bg-white/5",children:"No fee structure assigned. Update details or click Sync."})})]}),(0,b.jsxs)(w.Card,{className:"bg-black/20 border-white/10",children:[(0,b.jsxs)(w.CardHeader,{className:"flex flex-row items-center justify-between py-2 md:py-3 px-1.5 md:px-6",children:[(0,b.jsx)(w.CardTitle,{className:"text-xs md:text-xl font-bold text-accent italic",children:"History"}),(0,b.jsx)(q.History,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"})]}),(0,b.jsx)(w.CardContent,{className:"px-1.5 md:px-6 pb-3",children:0===L.length?(0,b.jsx)("div",{className:"text-center py-4 text-muted-foreground border border-dashed border-white/10 rounded-lg text-[10px]",children:"No payments."}):(0,b.jsx)("div",{className:"space-y-1",children:L.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center px-2 md:px-3 py-1 md:py-1.5 rounded-lg bg-white/10 border border-white/10 group",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("span",{className:"text-[10px] md:text-xs font-bold flex items-center gap-1 md:gap-1.5",children:[(0,b.jsx)("span",{className:"uppercase text-[6px] md:text-[8px] font-black text-white/50 bg-black/40 px-1 py-0.5 rounded tracking-tighter",children:a.method}),a.remarks||"Fee Payment"]}),(0,b.jsx)("span",{className:"text-[8px] md:text-[10px] text-muted-foreground",children:a.date?.toDate?a.date.toDate().toLocaleDateString():a.date})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 md:gap-2",children:[(0,b.jsxs)("span",{className:"font-mono font-black text-emerald-400 text-[10px] md:text-xs",children:["+₹",a.amount.toLocaleString()]}),(0,b.jsx)(g.Button,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>(0,G.printPaymentReceipt)({payment:a,student:J,ledger:N,schoolLogo:ac?.schoolLogo,schoolName:ac?.schoolName}),children:(0,b.jsx)(u.Printer,{className:"w-3 h-3"})})]})]},a.id))})})]})]}),(0,b.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,b.jsxs)(w.Card,{className:"bg-gradient-to-br from-black/40 to-black/20 border-white/10 sticky top-6",children:[(0,b.jsx)(w.CardHeader,{className:"py-2 md:py-3 px-1.5 md:px-6",children:(0,b.jsx)(w.CardTitle,{className:"text-[11px] md:text-base font-bold text-accent italic",children:"Overview"})}),(0,b.jsxs)(w.CardContent,{className:"space-y-3 md:space-y-4 px-1.5 md:px-6 pb-4 md:pb-6",children:[(0,b.jsx)("div",{className:"relative h-1.5 md:h-2 w-full bg-white/5 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-emerald-600 to-emerald-400",style:{width:`${au}%`}})}),(0,b.jsxs)("div",{className:"space-y-3 md:space-y-4 pt-1 md:pt-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-1 gap-2 md:gap-3",children:[(0,b.jsxs)("div",{className:"bg-white/5 p-2 md:p-3 rounded-xl border border-white/5 space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black tracking-tighter",children:"Term"}),(0,b.jsxs)("span",{className:"text-[10px] md:text-xs font-bold text-white",children:["₹",av.termsTotal.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center border-t border-white/5 pt-1",children:[(0,b.jsx)("span",{className:"text-[7px] md:text-[9px] text-white/30 uppercase font-black",children:"Due"}),(0,b.jsxs)("span",{className:"text-[9px] md:text-[10px] font-bold text-amber-500",children:["₹",av.termsPending.toLocaleString()]})]})]}),(0,b.jsxs)("div",{className:"bg-white/5 p-2 md:p-3 rounded-xl border border-white/5 space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black tracking-tighter",children:"Custom"}),(0,b.jsxs)("span",{className:"text-[10px] md:text-xs font-bold text-white",children:["₹",av.customTotal.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center border-t border-white/5 pt-1",children:[(0,b.jsx)("span",{className:"text-[7px] md:text-[9px] text-white/30 uppercase font-black",children:"Due"}),(0,b.jsxs)("span",{className:"text-[9px] md:text-[10px] font-bold text-amber-500",children:["₹",av.customPending.toLocaleString()]})]})]})]}),(0,b.jsxs)("div",{className:"p-2 md:p-4 bg-red-500/10 border border-red-500/20 rounded-xl space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-black text-[8px] md:text-[10px] uppercase text-red-400 italic leading-none mb-1",children:"Total Due"}),(0,b.jsxs)("span",{className:`font-mono font-black text-xl md:text-3xl ${at>0?"text-white":"text-emerald-400"}`,children:["₹",at.toLocaleString()]})]}),at>0&&(0,b.jsxs)(g.Button,{size:"sm",onClick:()=>J&&(0,G.printPendingFeeReport)({studentName:J.studentName,schoolId:J.schoolId,className:J.className,items:av.pending.map(a=>({name:a.name,amount:a.due,type:"CUSTOM"})),totalPaid:N?.totalPaid||0,schoolLogo:ac?.schoolLogo,schoolName:ac?.schoolName}),className:"w-full bg-white text-black hover:bg-zinc-200 font-bold h-8 md:h-10 rounded-lg shadow-lg text-[9px] md:text-sm",children:[(0,b.jsx)(u.Printer,{className:"w-3 h-3 md:w-4 md:h-4 mr-2"})," Statement"]})]})]})]})]}),(0,b.jsxs)(w.Card,{className:"bg-red-500/5 border-red-500/10",children:[(0,b.jsx)(w.CardHeader,{className:"py-2 px-3 md:px-4",children:(0,b.jsx)(w.CardTitle,{className:"text-red-400 text-[8px] md:text-[10px] uppercase font-black tracking-widest italic",children:"Danger"})}),(0,b.jsx)(w.CardContent,{className:"px-3 md:px-4 pb-3 md:pb-4",children:(0,b.jsxs)(g.Button,{variant:"destructive",size:"sm",className:"w-full bg-red-500/10 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/20 font-bold h-8 md:h-9 text-[9px] md:text-sm",onClick:()=>Z(!0),children:[(0,b.jsx)(m.Trash2,{className:"w-3 h-3 md:w-3.5 md:h-3.5 mr-2"})," Delete"]})})]})]}),J&&(0,b.jsx)(z.DeleteUserModal,{isOpen:Y,onClose:()=>Z(!1),user:{id:J.id,schoolId:J.schoolId,name:J.studentName,role:"student"},checkEligibility:async()=>L.length>0?{canDelete:!1,reason:`Recorded ${L.length} payments. Deactivate instead.`}:{canDelete:!0},onDeactivate:async()=>{await (0,e.updateDoc)((0,e.doc)(f.db,"students",J.id),{status:"INACTIVE"}),K(a=>a?{...a,status:"INACTIVE"}:null),alert("Student Deactivated")},onDelete:async a=>{await (0,e.deleteDoc)((0,e.doc)(f.db,"students",J.id)),await (0,e.addDoc)((0,e.collection)(f.db,"audit_logs"),{action:"DELETE_USER_HARD",targetId:J.id,targetType:"student",reason:a,timestamp:e.Timestamp.now()}),A.push("/admin/students")}}),N&&J&&(0,b.jsx)(D,{isOpen:aj,onClose:()=>ak(!1),studentId:J.schoolId,ledgerItems:N.items,onSuccess:()=>void window.location.reload()})]})]}):null}a.s(["default",()=>J],19787)}];

//# sourceMappingURL=src_app_admin_students_%5Bid%5D_page_tsx_1e614ad3._.js.map