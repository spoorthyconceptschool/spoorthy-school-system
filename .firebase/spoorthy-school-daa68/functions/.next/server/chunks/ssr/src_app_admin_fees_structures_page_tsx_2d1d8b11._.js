module.exports=[82067,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(20237),f=a.i(84505),g=a.i(71931),h=a.i(87532),i=a.i(46842),j=a.i(24987),k=a.i(99570),l=a.i(66718),m=a.i(86304),n=a.i(91410),o=a.i(80701),p=a.i(89402),q=a.i(14574),r=a.i(15055),s=a.i(70430),t=a.i(68114),u=a.i(50944);function v(){let[a,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("all"),[C,D]=(0,c.useState)("all"),E=(0,u.useRouter)(),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)("csv"),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)([]),{classes:N,villages:O,branding:P}=(0,n.useMasterData)(),Q=Object.values(N||{}).map(a=>({id:a.id,name:a.name,order:a.order||99})).sort((a,b)=>a.order-b.order),R=Object.values(O||{}).map(a=>({id:a.id,name:a.name})).sort((a,b)=>a.name.localeCompare(b.name)),S=async()=>{try{let a=(0,d.query)((0,d.collection)(e.db,"student_fee_ledgers"),(0,d.orderBy)("className","asc")),b=await (0,d.getDocs)(a);v(b.docs.map(a=>({id:a.id,...a.data()})))}catch(a){console.error(a)}finally{x(!1)}};(0,c.useEffect)(()=>{S()},[]);let T=a.filter(a=>{let b=!y||a.studentId?.toLowerCase().includes(y.toLowerCase())||a.studentName?.toLowerCase().includes(y.toLowerCase())||a.parentName?.toLowerCase().includes(y.toLowerCase())||a.parentMobile?.toLowerCase().includes(y.toLowerCase())||a.villageName?.toLowerCase().includes(y.toLowerCase())||a.className?.toLowerCase().includes(y.toLowerCase()),c="all"===A||a.classId===A||a.className===A,d="all"===C||a.villageId===C||a.villageName===C;return b&&c&&d}),U=T.reduce((a,b)=>a+(b.totalFee||0),0),V=T.reduce((a,b)=>a+(b.totalPaid||0),0),W=U-V;return(0,b.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500 max-w-none p-0 pb-20",children:[(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between pt-4 gap-6 px-2 md:px-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic leading-tight",children:"Fee Structures"}),(0,b.jsxs)("p",{className:"text-muted-foreground text-sm md:text-lg tracking-tight",children:["Master record of all ",(0,b.jsx)("span",{className:"text-white font-bold",children:"student fee allocations"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:()=>{I("print"),G(!0)},className:"h-11 gap-2 border-white/10 bg-white/5 backdrop-blur-sm rounded-xl hover:bg-white/10",children:[(0,b.jsx)(g.Printer,{size:16})," ",(0,b.jsx)("span",{className:"hidden sm:inline",children:"Print Report"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Print"})]}),(0,b.jsxs)(k.Button,{variant:"outline",onClick:()=>{I("csv"),G(!0)},className:"h-11 gap-2 border-white/10 bg-white/5 backdrop-blur-sm rounded-xl hover:bg-white/10",children:[(0,b.jsx)(f.Download,{size:16})," ",(0,b.jsx)("span",{className:"hidden sm:inline",children:"Export CSV"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Export"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 px-2 md:px-0",children:[(0,b.jsxs)("div",{className:"bg-emerald-500/5 border border-emerald-500/10 p-5 rounded-2xl backdrop-blur-sm shadow-xl",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-emerald-400 mb-2 italic",children:"Total Allocation"}),(0,b.jsxs)("div",{className:"text-3xl font-mono font-black text-white",children:["₹",U.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"bg-blue-500/5 border border-blue-500/10 p-5 rounded-2xl backdrop-blur-sm shadow-xl",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-blue-400 mb-2 italic",children:"Collected Fees"}),(0,b.jsxs)("div",{className:"text-3xl font-mono font-black text-white",children:["₹",V.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"bg-orange-500/5 border border-orange-500/10 p-5 rounded-2xl backdrop-blur-sm shadow-xl",children:[(0,b.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-orange-400 mb-2 italic",children:"Pending Dues"}),(0,b.jsxs)("div",{className:"text-3xl font-mono font-black text-white",children:["₹",W.toLocaleString()]})]})]}),(0,b.jsxs)("div",{className:"bg-black/20 p-4 md:p-5 rounded-2xl border border-white/10 backdrop-blur-md space-y-4 shadow-2xl mx-2 md:mx-0",children:[(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsx)(h.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(l.Input,{placeholder:"Search by student name, ID, or parent...",className:"pl-11 h-12 bg-white/5 border-white/10 rounded-xl focus:ring-accent/30",value:y,onChange:a=>z(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:flex lg:flex-wrap gap-2",children:[(0,b.jsxs)(o.Select,{value:A,onValueChange:B,children:[(0,b.jsx)(o.SelectTrigger,{className:"w-full lg:w-[180px] h-12 bg-white/5 border-white/10 rounded-xl",children:(0,b.jsx)(o.SelectValue,{placeholder:"All Classes"})}),(0,b.jsxs)(o.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"All Classes"}),Q.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)(o.Select,{value:C,onValueChange:D,children:[(0,b.jsx)(o.SelectTrigger,{className:"w-full lg:w-[180px] h-12 bg-white/5 border-white/10 rounded-xl",children:(0,b.jsx)(o.SelectValue,{placeholder:"All Villages"})}),(0,b.jsxs)(o.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"All Villages"}),R.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:a.name},a.id))]})]}),("all"!==A||"all"!==C||y)&&(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>{z(""),B("all"),D("all")},className:"h-12 px-6 text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-white rounded-xl border border-dashed border-white/10 transition-all",children:"Clear Filters"})]})]}),(0,b.jsx)(p.DataTable,{data:T,isLoading:w,onRowClick:a=>E.push(`/admin/students/${a.studentDocId||a.id}`),columns:[{key:"studentName",header:"Student Info",render:a=>(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center border border-white/5",children:(0,b.jsx)(i.User,{size:14,className:"text-white/40"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-bold text-sm text-white leading-tight",children:a.studentName}),(0,b.jsx)("span",{className:"text-[10px] font-mono text-white/40 tracking-tighter uppercase",children:a.studentId})]})]})},{key:"className",header:"Class & Village",render:a=>(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-[10px] uppercase font-black text-muted-foreground tracking-tighter bg-white/5 px-2 py-0.5 rounded border border-white/5 w-fit",children:a.className}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-white/30",children:[(0,b.jsx)(j.MapPin,{size:10}),(0,b.jsx)("span",{className:"truncate max-w-[120px]",children:a.villageName})]})]})},{key:"termFee",header:"Term Fee",headerClassName:"text-right",cellClassName:"text-right",render:a=>{let c=a.items?.filter(a=>"TERM"===a.type).reduce((a,b)=>a+b.amount,0)||0;return(0,b.jsxs)("span",{className:"font-mono font-bold text-sm text-white/80",children:["₹",c.toLocaleString()]})}},{key:"transport",header:"Transport",headerClassName:"text-right",cellClassName:"text-right",render:a=>{let c=a.items?.find(a=>a.name?.toLowerCase().includes("bus")||a.name?.toLowerCase().includes("transport")),d=c?c.amount:0;return(0,b.jsxs)("span",{className:(0,t.cn)("font-mono font-bold text-sm",d>0?"text-cyan-400":"text-white/10"),children:["₹",d.toLocaleString()]})}},{key:"totalFee",header:"Total Fee",headerClassName:"text-right",cellClassName:"text-right",render:a=>(0,b.jsxs)("span",{className:"font-mono font-black text-sm text-white",children:["₹",a.totalFee?.toLocaleString()]})},{key:"totalPaid",header:"Total Paid",headerClassName:"text-right",cellClassName:"text-right",render:a=>(0,b.jsxs)("span",{className:"font-mono font-black text-sm text-emerald-400",children:["₹",a.totalPaid?.toLocaleString()]})},{key:"status",header:"Status",headerClassName:"text-center",cellClassName:"text-center",render:a=>(0,b.jsx)(m.Badge,{variant:"PAID"===a.status?"default":"destructive",className:(0,t.cn)("text-[9px] font-black uppercase tracking-tighter py-0 h-5 border-none","PAID"===a.status?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":"bg-red-500/20 text-red-400 hover:bg-red-500/30"),children:a.status})}],actions:a=>(0,b.jsx)("div",{className:"flex flex-col gap-1",children:(0,b.jsx)(k.Button,{variant:"ghost",onClick:()=>E.push(`/admin/students/${a.studentDocId||a.id}`),className:"w-full justify-start gap-2 h-9 text-xs font-bold uppercase tracking-tighter",children:"Full Student Profile"})})}),(0,b.jsx)(q.Dialog,{open:F,onOpenChange:G,children:(0,b.jsxs)(q.DialogContent,{className:"max-w-2xl bg-[#0A192F] border-white/10 text-white shadow-2xl backdrop-blur-3xl rounded-3xl",children:[(0,b.jsx)(q.DialogHeader,{children:(0,b.jsx)(q.DialogTitle,{className:"text-2xl font-display font-bold italic bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent",children:"Report Configuration"})}),(0,b.jsx)("div",{className:"space-y-6 py-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"space-y-3 p-4 bg-white/5 rounded-2xl border border-white/5",children:[(0,b.jsx)(s.Label,{className:"text-[10px] font-black uppercase tracking-widest text-emerald-400",children:"Filter by Classes"}),(0,b.jsxs)("div",{className:"max-h-[300px] overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 pb-2 border-b border-white/5",children:[(0,b.jsx)(r.Checkbox,{id:"all-classes",className:"border-white/20 data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500",checked:0===J.length,onCheckedChange:a=>a?K([]):null}),(0,b.jsx)(s.Label,{htmlFor:"all-classes",className:"text-sm font-bold opacity-80 cursor-pointer",children:"All Classes"})]}),Q.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[(0,b.jsx)(r.Checkbox,{id:`class-${a.id}`,className:"border-white/10 data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500",checked:J.includes(a.id),onCheckedChange:b=>{b?K([...J,a.id]):K(J.filter(b=>b!==a.id))}}),(0,b.jsx)(s.Label,{htmlFor:`class-${a.id}`,className:"text-xs font-medium opacity-60 cursor-pointer hover:opacity-100 transition-opacity",children:a.name})]},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-3 p-4 bg-white/5 rounded-2xl border border-white/5",children:[(0,b.jsx)(s.Label,{className:"text-[10px] font-black uppercase tracking-widest text-cyan-400",children:"Filter by Villages"}),(0,b.jsxs)("div",{className:"max-h-[300px] overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 pb-2 border-b border-white/5",children:[(0,b.jsx)(r.Checkbox,{id:"all-villages",className:"border-white/20 data-[state=checked]:bg-cyan-500 data-[state=checked]:border-cyan-500",checked:0===L.length,onCheckedChange:a=>a?M([]):null}),(0,b.jsx)(s.Label,{htmlFor:"all-villages",className:"text-sm font-bold opacity-80 cursor-pointer",children:"All Villages"})]}),R.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[(0,b.jsx)(r.Checkbox,{id:`village-${a.id}`,className:"border-white/10 data-[state=checked]:bg-cyan-500 data-[state=checked]:border-cyan-500",checked:L.includes(a.id),onCheckedChange:b=>{b?M([...L,a.id]):M(L.filter(b=>b!==a.id))}}),(0,b.jsx)(s.Label,{htmlFor:`village-${a.id}`,className:"text-xs font-medium opacity-60 cursor-pointer hover:opacity-100 transition-opacity",children:a.name})]},a.id))]})]})]})}),(0,b.jsxs)(q.DialogFooter,{className:"gap-2",children:[(0,b.jsx)(k.Button,{variant:"ghost",onClick:()=>G(!1),className:"rounded-xl hover:bg-white/5",children:"Cancel"}),(0,b.jsxs)(k.Button,{className:"bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-500 hover:to-cyan-500 text-white font-black uppercase tracking-tighter gap-2 rounded-xl border-none shadow-lg shadow-emerald-500/20",onClick:()=>{let b=a.filter(a=>{let b=0===J.length||J.includes(a.classId)||J.includes(a.className),c=0===L.length||L.includes(a.villageId)||L.includes(a.villageName);return b&&c});if("csv"===H){let a,c,d;a=new Blob([[["School ID","Student Name","Parent Name","Mobile","Village","Class","Term Fee","Transport Fee","Total Fee","Total Paid","Status"],...b.map(a=>{let b=a.items?.filter(a=>"TERM"===a.type).reduce((a,b)=>a+b.amount,0)||0,c=a.items?.find(a=>a.name?.toLowerCase().includes("bus")||a.name?.toLowerCase().includes("transport")),d=c?c.amount:0;return[a.studentId,a.studentName,a.parentName,a.parentMobile||"",a.villageName,a.className,b,d,a.totalFee,a.totalPaid,a.status]})].map(a=>a.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),d=URL.createObjectURL(a),c.setAttribute("href",d),c.setAttribute("download",`fee_structures_${new Date().toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),G(!1)}else(a=>{let b=window.open("","_blank");if(!b)return;let c=`
            <html>
                <head>
                    <title>Fee Structures Report</title>
                    <style>
                        body { font-family: sans-serif; padding: 20px; }
                        .header { display: flex; align-items: center; justify-content: center; gap: 30px; border-bottom: 2px solid #ddd; padding-bottom: 20px; margin-bottom: 20px; }
                        .logo { height: 80px; width: auto; object-fit: contain; }
                        .header-text { text-align: left; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                        th { background-color: #f2f2f2; }
                        h1 { margin: 0; font-size: 24px; }
                        .header-info { margin-top: 5px; color: #666; font-size: 14px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        ${P?.schoolLogo?`<img src="${P.schoolLogo}" class="logo" />`:""}
                        <div class="header-text">
                            <h1>${P?.schoolName||"Spoorthy Concept School"} - Fee Structures</h1>
                            <div class="header-info">
                                Selected Dataset Report | Generated on: ${new Date().toLocaleString()}
                            </div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>School ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Term Fee</th>
                                <th>Transport</th>
                                <th>Total Fee</th>
                                <th>Paid</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${a.map(a=>{let b=a.items?.filter(a=>"TERM"===a.type).reduce((a,b)=>a+b.amount,0)||0,c=a.items?.find(a=>a.name?.toLowerCase().includes("bus")||a.name?.toLowerCase().includes("transport")),d=c?c.amount:0;return`
                                    <tr>
                                        <td>${a.studentId}</td>
                                        <td>${a.studentName}</td>
                                        <td>${a.className}</td>
                                        <td>₹${b.toLocaleString()}</td>
                                        <td>₹${d.toLocaleString()}</td>
                                        <td>₹${(a.totalFee||0).toLocaleString()}</td>
                                        <td>₹${(a.totalPaid||0).toLocaleString()}</td>
                                        <td>${a.status}</td>
                                    </tr>
                                `}).join("")}
                        </tbody>
                    </table>
                </body>
            </html>
        `;b.document.write(c),b.document.close(),b.print(),G(!1)})(b)},children:["csv"===H?(0,b.jsx)(f.Download,{size:16}):(0,b.jsx)(g.Printer,{size:16}),"csv"===H?"Export CSV":"Print Report"]})]})]})})]})}a.s(["default",()=>v])}];

//# sourceMappingURL=src_app_admin_fees_structures_page_tsx_2d1d8b11._.js.map