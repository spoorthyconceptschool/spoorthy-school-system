module.exports=[74898,(a,b,c)=>{var d=a.r(874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},66181,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(f,d),f.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},f.prototype.resume=function(){this._paused=!1,this.emit("drain");var a=this._driver.messages;a._paused=!1,a.emit("drain")},f.prototype.write=function(a){return!!this.writable&&(this._driver.parse(a),!this._paused)},f.prototype.end=function(a){if(this.writable){void 0!==a&&this.write(a),this.writable=!1;var b=this._driver.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))}},f.prototype.destroy=function(){this.end()};var g=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(g,d),g.prototype.pause=function(){this._driver.io._paused=!0},g.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},g.prototype.write=function(a){return!!this.writable&&("string"==typeof a?this._driver.text(a):this._driver.binary(a),!this._paused)},g.prototype.end=function(a){void 0!==a&&this.write(a)},g.prototype.destroy=function(){},c.IO=f,c.Messages=g},86562,(a,b,c)=>{"use strict";var d=function(){this.clear()};d.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],d.prototype.clear=function(){this._sent={},this._lines=[]},d.prototype.set=function(a,b){if(void 0!==b){a=this._strip(a),b=this._strip(b);var c=a.toLowerCase();(!this._sent.hasOwnProperty(c)||this.ALLOWED_DUPLICATES.indexOf(c)>=0)&&(this._sent[c]=!0,this._lines.push(a+": "+b+"\r\n"))}},d.prototype.toString=function(){return this._lines.join("")},d.prototype._strip=function(a){return a.toString().replace(/^ */,"").replace(/ *$/,"")},b.exports=d},94255,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this._queue=[],this._queueSize=0,this._offset=0};e.prototype.put=function(a){a&&0!==a.length&&(d.isBuffer(a)||(a=d.from(a)),this._queue.push(a),this._queueSize+=a.length)},e.prototype.read=function(a){if(a>this._queueSize)return null;if(0===a)return d.alloc(0);this._queueSize-=a;var b,c,e=this._queue,f=a,g=e[0];if(g.length>=a)if(g.length===a)return e.shift();else return c=g.slice(0,a),e[0]=g.slice(a),c;for(var h=0,i=e.length;h<i&&!(f<e[h].length);h++)f-=e[h].length;return b=e.splice(0,h),f>0&&e.length>0&&(b.push(e[0].slice(0,f)),e[0]=e[0].slice(f)),d.concat(b,a)},e.prototype.eachByte=function(a,b){for(var c,d,e;this._queue.length>0;){for(d=(c=this._queue[0]).length;this._offset<d;)e=this._offset,this._offset+=1,a.call(b,c[e]);this._offset=0,this._queue.shift()}},b.exports=e},30145,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(27699).EventEmitter,f=a.r(24361),g=a.r(66181),h=a.r(86562),i=a.r(94255),j=function(a,b,c){e.call(this),j.validateOptions(c||{},["maxLength","masking","requireMasking","protocols"]),this._request=a,this._reader=new i,this._options=c||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new h,this.__queue=[],this.readyState=0,this.url=b,this.io=new g.IO(this),this.messages=new g.Messages(this),this._bindEventListeners()};f.inherits(j,e),j.isWebSocket=function(a){var b=a.headers.connection||"",c=a.headers.upgrade||"";return"GET"===a.method&&b.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===c.toLowerCase()},j.validateOptions=function(a,b){for(var c in a)if(0>b.indexOf(c))throw Error("Unrecognized option: "+c)};var k={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var a=this;this.messages.on("error",function(){}),this.on("message",function(b){var c=a.messages;c.readable&&c.emit("data",b.data)}),this.on("error",function(b){var c=a.messages;c.readable&&c.emit("error",b)}),this.on("close",function(){var b=a.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(a){return!1},setHeader:function(a,b){return!(this.readyState>0)&&(this._headers.set(a,b),!0)},start:function(){var a;if(0!==this.readyState)return!1;if(!j.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{a=this._handshakeResponse()}catch(a){return this._failHandshake(a)}return this._write(a),-1!==this._stage&&this._open(),!0},_failHandshake:function(a){var b=new h;return b.set("Content-Type","text/plain"),b.set("Content-Length",d.byteLength(a.message,"utf8")),b=["HTTP/1.1 400 Bad Request",b.toString(),a.message],this._write(d.from(b.join("\r\n"),"utf8")),this._fail("protocol_error",a.message),!1},text:function(a){return this.frame(a)},binary:function(a){return!1},ping:function(){return!1},pong:function(){return!1},close:function(a,b){return 1===this.readyState&&(this.readyState=3,this.emit("close",new j.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(a){this.frame.apply(this,a)},this),this.__queue=[],this.emit("open",new j.OpenEvent)},_queue:function(a){return this.__queue.push(a),!0},_write:function(a){var b=this.io;b.readable&&b.emit("data",a)},_fail:function(a,b){this.readyState=2,this.emit("error",Error(b)),this.close()}};for(var l in k)j.prototype[l]=k[l];j.ConnectEvent=function(){},j.OpenEvent=function(){},j.CloseEvent=function(a,b){this.code=a,this.reason=b},j.MessageEvent=function(a){this.data=a},j.PingEvent=function(a){this.data=a},j.PongEvent=function(a){this.data=a},b.exports=j},58726,(a,b,c)=>{function d(a){if(void 0!==a&&a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===a||this.initialize(a),this.maxHeaderSize=d.maxHeaderSize}c.HTTPParser=d,d.prototype.initialize=function(a,b){if(a!==d.REQUEST&&a!==d.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=a,this.state=a+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},d.encoding="ascii",d.maxHeaderSize=81920,d.REQUEST="REQUEST",d.RESPONSE="RESPONSE";var e=d.kOnHeaders=1,f=d.kOnHeadersComplete=2,g=d.kOnBody=3,h=d.kOnMessageComplete=4;d.prototype[e]=d.prototype[f]=d.prototype[g]=d.prototype[h]=function(){};var i=!0;Object.defineProperty(d,"kOnExecute",{get:function(){return i=!1,99}});var j=c.methods=d.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],k=j.indexOf("CONNECT");d.prototype.reinitialize=d,d.prototype.close=d.prototype.pause=d.prototype.resume=d.prototype.remove=d.prototype.free=function(){},d.prototype._compatMode0_11=!1,d.prototype.getAsyncId=function(){return 0};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};d.prototype.execute=function(a,b,c){if(!(this instanceof d))throw TypeError("not a HTTPParser");b=b||0,c="number"==typeof c?c:a.length,this.chunk=a,this.offset=b;var e=this.end=b+c;try{for(;this.offset<e&&!this[this.state](););}catch(a){if(this.isUserCall)throw a;return this.hadError=!0,a}return(this.chunk=null,c=this.offset-b,l[this.state]&&(this.headerSize+=c,this.headerSize>(this.maxHeaderSize||d.maxHeaderSize)))?Error("max header size exceeded"):c};var m={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};d.prototype.finish=function(){if(!this.hadError){if(!m[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[h]())}},d.prototype.consume=d.prototype.unconsume=d.prototype.getCurrentBuffer=function(){},d.prototype.userCall=function(){this.isUserCall=!0;var a=this;return function(b){return a.isUserCall=!1,b}},d.prototype.nextRequest=function(){this.userCall()(this[h]()),this.reinitialize(this.type)},d.prototype.consumeLine=function(){for(var a=this.end,b=this.chunk,c=this.offset;c<a;c++)if(10===b[c]){var e=this.line+b.toString(d.encoding,this.offset,c);return"\r"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),this.line="",this.offset=c+1,e}this.line+=b.toString(d.encoding,this.offset,this.end),this.offset=this.end};var n=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,o=/^[ \t]+(.*[^ \t])/;d.prototype.parseHeader=function(a,b){if(-1!==a.indexOf("\r"))throw r("HPE_LF_EXPECTED");var c=n.exec(a),d=c&&c[1];if(d)b.push(d),b.push(c[2]);else{var e=o.exec(a);e&&b.length&&(b[b.length-1]&&(b[b.length-1]+=" "),b[b.length-1]+=e[1])}};var p=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;d.prototype.REQUEST_LINE=function(){var a=this.consumeLine();if(a){var b=p.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?b[1]:j.indexOf(b[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=b[2],this.info.versionMajor=+b[3],this.info.versionMinor=+b[4],this.body_bytes=0,this.state="HEADER"}};var q=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function r(a){var b=Error("Parse Error");return b.code=a,b}d.prototype.RESPONSE_LINE=function(){var a=this.consumeLine();if(a){var b=q.exec(a);if(null===b)throw r("HPE_INVALID_CONSTANT");this.info.versionMajor=+b[1],this.info.versionMinor=+b[2];var c=this.info.statusCode=+b[3];this.info.statusMessage=b[4],((c/100|0)==1||204===c||304===c)&&(this.body_bytes=0),this.state="HEADER"}},d.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},d.prototype.HEADER=function(){var a=this.consumeLine();if(void 0!==a){var b=this.info;if(a)this.parseHeader(a,b.headers);else{for(var c,e,g=b.headers,h=!1,j=!1,l=0;l<g.length;l+=2)switch(g[l].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===g[l+1].toLowerCase();break;case"content-length":if(c=+g[l+1],h){if(c!==this.body_bytes)throw r("HPE_UNEXPECTED_CONTENT_LENGTH")}else h=!0,this.body_bytes=c;break;case"connection":this.connection+=g[l+1].toLowerCase();break;case"upgrade":j=!0}if(this.isChunked&&h&&(h=!1,this.body_bytes=null),j&&-1!=this.connection.indexOf("upgrade")?b.upgrade=this.type===d.REQUEST||101===b.statusCode:b.upgrade=b.method===k,this.isChunked&&b.upgrade&&(this.isChunked=!1),b.shouldKeepAlive=this.shouldKeepAlive(),2===(e=i?this.userCall()(this[f](b)):this.userCall()(this[f](b.versionMajor,b.versionMinor,b.headers,b.method,b.url,b.statusCode,b.statusMessage,b.upgrade,b.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!e)this.state="BODY_CHUNKHEAD";else{if(e||0===this.body_bytes)return this.nextRequest(),b.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},d.prototype.BODY_CHUNKHEAD=function(){var a=this.consumeLine();void 0!==a&&(this.body_bytes=parseInt(a,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},d.prototype.BODY_CHUNK=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},d.prototype.BODY_CHUNKEMPTYLINE=function(){var a=this.consumeLine();if(void 0!==a){if(""!==a)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},d.prototype.BODY_CHUNKTRAILERS=function(){var a=this.consumeLine();void 0!==a&&(a?this.parseHeader(a,this.trailers):(this.trailers.length&&this.userCall()(this[e](this.trailers,"")),this.nextRequest()))},d.prototype.BODY_RAW=function(){this.userCall()(this[g](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},d.prototype.BODY_SIZED=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[g](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(a){var b=d["kOn"+a];Object.defineProperty(d.prototype,"on"+a,{get:function(){return this[b]},set:function(a){return this._compatMode0_11=!0,k="CONNECT",this[b]=a}})})},34867,(a,b,c)=>{"use strict";var d=a.r(58726).HTTPParser,e=a.r(74898).Buffer,f={request:d.REQUEST||"request",response:d.RESPONSE||"response"},g=function(a){this._type=a,this._parser=new d(f[a]),this._complete=!1,this.headers={};var b=null,c=this;this._parser.onHeaderField=function(a,c,d){b=a.toString("utf8",c,c+d).toLowerCase()},this._parser.onHeaderValue=function(a,d,e){var f=a.toString("utf8",d,d+e);c.headers.hasOwnProperty(b)?c.headers[b]+=", "+f:c.headers[b]=f},this._parser.onHeadersComplete=this._parser[d.kOnHeadersComplete]=function(a,b,d,e,f,h){var i=arguments[0];if("object"==typeof i&&(e=i.method,f=i.url,h=i.statusCode,d=i.headers),c.method="number"==typeof e?g.METHODS[e]:e,c.statusCode=h,c.url=f,d){for(var j,k,l=0,m=d.length;l<m;l+=2)j=d[l].toLowerCase(),k=d[l+1],c.headers.hasOwnProperty(j)?c.headers[j]+=", "+k:c.headers[j]=k;c._complete=!0}}};g.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var h=process.version?process.version.match(/[0-9]+/g).map(function(a){return parseInt(a,10)}):[];0===h[0]&&12===h[1]&&(g.METHODS[16]="REPORT",g.METHODS[17]="MKACTIVITY",g.METHODS[18]="CHECKOUT",g.METHODS[19]="MERGE",g.METHODS[20]="M-SEARCH",g.METHODS[21]="NOTIFY",g.METHODS[22]="SUBSCRIBE",g.METHODS[23]="UNSUBSCRIBE",g.METHODS[24]="PATCH",g.METHODS[25]="PURGE"),g.prototype.isComplete=function(){return this._complete},g.prototype.parse=function(a){var b=this._parser.execute(a,0,a.length);if("number"!=typeof b){this.error=b,this._complete=!0;return}this._complete&&(this.body=b<a.length?a.slice(b):e.alloc(0))},b.exports=g},6073,(a,b,c)=>{"use strict";var d=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,e=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,f=RegExp(d.source+"(?:=(?:"+d.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),g=RegExp(d.source+"(?: *; *"+f.source+")*","g"),h=RegExp("^"+g.source+"(?: *, *"+g.source+")*$"),i=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,j=Object.prototype.hasOwnProperty,k=function(){this._byName={},this._inOrder=[]};k.prototype.push=function(a,b){j.call(this._byName,a)||(this._byName[a]=[]),this._byName[a].push(b),this._inOrder.push({name:a,params:b})},k.prototype.eachOffer=function(a,b){for(var c=this._inOrder,d=0,e=c.length;d<e;d++)a.call(b,c[d].name,c[d].params)},k.prototype.byName=function(a){return this._byName[a]||[]},k.prototype.toArray=function(){return this._inOrder.slice()},b.exports={parseHeader:function(a){var b=new k;if(""===a||void 0===a)return b;if(!h.test(a))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+a);return a.match(g).forEach(function(a){var c=a.match(RegExp(f.source,"g")),d=c.shift(),e={};c.forEach(function(a){var b,c=a.match(f),d=c[1];b=void 0!==c[2]?c[2]:void 0===c[3]||c[3].replace(/\\/g,""),i.test(b)&&(b=parseFloat(b)),j.call(e,d)?(e[d]=[].concat(e[d]),e[d].push(b)):e[d]=b},this),b.push(d,e)},this),b},serializeParams:function(a,b){var c=[],d=function(a,b){b instanceof Array?b.forEach(function(b){d(a,b)}):!0===b?c.push(a):"number"==typeof b?c.push(a+"="+b):e.test(b)?c.push(a+'="'+b.replace(/"/g,'\\"')+'"'):c.push(a+"="+b)};for(var f in b)d(f,b[f]);return[a].concat(c).join("; ")}}},21777,(a,b,c)=>{"use strict";var d=function(a){this._bufferSize=a,this.clear()};d.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},d.prototype.push=function(a){var b=!1,c=!1;this._ringSize<this._bufferSize?b=0===this._tail:this._ringOffset===this._ringSize&&(b=!0,c=0===this._tail),b&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,c&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=a,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},d.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},d.prototype.shift=function(){if(0!==this.length){var a=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,a}},b.exports=d},76503,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(a,b){this._session=a,this._method=b,this._queue=new d(e.QUEUE_SIZE),this._stopped=!1,this.pending=0};e.QUEUE_SIZE=8,e.prototype.call=function(a,b,c,d){if(!this._stopped){var e={error:a,message:b,callback:c,context:d,done:!1},f=!1,g=this;if(this._queue.push(e),e.error)return e.done=!0,this._stop(),this._flushQueue();var h=function(a,b){f^(f=!0)&&(a?(g._stop(),e.error=a,e.message=null):e.message=b,e.done=!0,g._flushQueue())};try{this._session[this._method](b,h)}catch(a){h(a)}}},e.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},e.prototype._flushQueue=function(){for(var a,b=this._queue;b.length>0&&b.peek().done;)(a=b.shift()).error?(this.pending=0,b.clear()):this.pending-=1,a.callback.call(a.context,a.error,a.message)},b.exports=e},52681,(a,b,c)=>{"use strict";var d=a.r(21777),e=function(){this._complete=!1,this._callbacks=new d(e.QUEUE_SIZE)};e.QUEUE_SIZE=4,e.all=function(a){var b=new e,c=a.length,d=c;for(0===c&&b.done();d--;)a[d].then(function(){0==(c-=1)&&b.done()});return b},e.prototype.then=function(a){this._complete?a():this._callbacks.push(a)},e.prototype.done=function(){this._complete=!0;for(var a,b=this._callbacks;a=b.shift();)a()},b.exports=e},4698,(a,b,c)=>{"use strict";var d=a.r(76503),e=a.r(52681),f=function(a){this._ext=a[0],this._session=a[1],this._functors={incoming:new d(this._session,"processIncomingMessage"),outgoing:new d(this._session,"processOutgoingMessage")}};f.prototype.pending=function(a){var b=this._functors[a];b._stopped||(b.pending+=1)},f.prototype.incoming=function(a,b,c,d){this._exec("incoming",a,b,c,d)},f.prototype.outgoing=function(a,b,c,d){this._exec("outgoing",a,b,c,d)},f.prototype.close=function(){return this._closed=this._closed||new e,this._doClose(),this._closed},f.prototype._exec=function(a,b,c,d,e){this._functors[a].call(b,c,function(a,b){a&&(a.message=this._ext.name+": "+a.message),d.call(e,a,b),this._doClose()},this)},f.prototype._doClose=function(){var a=this._functors.incoming,b=this._functors.outgoing;this._closed&&a.pending+b.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},b.exports=f},89499,(a,b,c)=>{"use strict";var d=a.r(4698),e=a.r(52681),f=function(a){this._cells=a.map(function(a){return new d(a)}),this._stopped={incoming:!1,outgoing:!1}};f.prototype.processIncomingMessage=function(a,b,c){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,a,b,c)},f.prototype.processOutgoingMessage=function(a,b,c){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,a,b,c)},f.prototype.close=function(a,b){this._stopped={incoming:!0,outgoing:!0};var c=this._cells.map(function(a){return a.close()});a&&e.all(c).then(function(){a.call(b)})},f.prototype._loop=function(a,b,c,d,e,f,g){for(var h=this._cells,i=h.length,j=this;i--;)h[i].pending(a);var k=function(b,e,i){if(b===c)return f.call(g,e,i);h[b][a](e,i,function(c,e){c&&(j._stopped[a]=!0),k(b+d,c,e)})};k(b,null,e)},b.exports=f},64081,(a,b,c)=>{"use strict";var d=a.r(6073),e=a.r(89499),f=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};f.MESSAGE_OPCODES=[1,2];var g={add:function(a){if("string"!=typeof a.name)throw TypeError("extension.name must be a string");if("permessage"!==a.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof a.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof a.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof a.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(a.name))throw TypeError('An extension with name "'+a.name+'" is already registered');this._byName[a.name]=a,this._inOrder.push(a)},generateOffer:function(){var a=[],b=[],c={};return this._inOrder.forEach(function(e){var f=e.createClientSession();if(f){var g=[e,f];a.push(g),c[e.name]=g;var h=f.generateOffer();(h=h?[].concat(h):[]).forEach(function(a){b.push(d.serializeParams(e.name,a))},this)}},this),this._sessions=a,this._index=c,b.length>0?b.join(", "):null},activate:function(a){var b=d.parseHeader(a),c=[];b.eachOffer(function(a,b){var e=this._index[a];if(!e)throw Error('Server sent an extension response for unknown extension "'+a+'"');var f=e[0],g=e[1],h=this._reserved(f);if(h)throw Error("Server sent two extension responses that use the RSV"+h[0]+' bit: "'+h[1]+'" and "'+f.name+'"');if(!0!==g.activate(b))throw Error("Server sent unacceptable extension parameters: "+d.serializeParams(a,b));this._reserve(f),c.push(e)},this),this._sessions=c,this._pipeline=new e(c)},generateResponse:function(a){var b=[],c=[],f=d.parseHeader(a);return this._inOrder.forEach(function(a){var e=f.byName(a.name);if(!(0===e.length||this._reserved(a))){var g=a.createServerSession(e);g&&(this._reserve(a),b.push([a,g]),c.push(d.serializeParams(a.name,g.generateResponse())))}},this),this._sessions=b,this._pipeline=new e(b),c.length>0?c.join(", "):null},validFrameRsv:function(a){var b,c={rsv1:!1,rsv2:!1,rsv3:!1};if(f.MESSAGE_OPCODES.indexOf(a.opcode)>=0)for(var d=0,e=this._sessions.length;d<e;d++)b=this._sessions[d][0],c.rsv1=c.rsv1||b.rsv1,c.rsv2=c.rsv2||b.rsv2,c.rsv3=c.rsv3||b.rsv3;return(c.rsv1||!a.rsv1)&&(c.rsv2||!a.rsv2)&&(c.rsv3||!a.rsv3)},processIncomingMessage:function(a,b,c){this._pipeline.processIncomingMessage(a,b,c)},processOutgoingMessage:function(a,b,c){this._pipeline.processOutgoingMessage(a,b,c)},close:function(a,b){if(!this._pipeline)return a.call(b);this._pipeline.close(a,b)},_reserve:function(a){this._rsv1=this._rsv1||a.rsv1&&a.name,this._rsv2=this._rsv2||a.rsv2&&a.name,this._rsv3=this._rsv3||a.rsv3&&a.name},_reserved:function(a){return this._rsv1&&a.rsv1?[1,this._rsv1]:this._rsv2&&a.rsv2?[2,this._rsv2]:!!this._rsv3&&!!a.rsv3&&[3,this._rsv3]}};for(var h in g)f.prototype[h]=g[h];b.exports=f},46256,(a,b,c)=>{"use strict";var d=function(){},e={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var f in e)d.prototype[f]=e[f];b.exports=d},55887,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},f={read:function(){return this.data=this.data||d.concat(this._chunks,this.length)},pushFrame:function(a){this.rsv1=this.rsv1||a.rsv1,this.rsv2=this.rsv2||a.rsv2,this.rsv3=this.rsv3||a.rsv3,null===this.opcode&&(this.opcode=a.opcode),this._chunks.push(a.payload),this.length+=a.length}};for(var g in f)e.prototype[g]=f[g];b.exports=e},46987,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(24361),g=a.r(64081),h=a.r(30145),i=a.r(46256),j=a.r(55887),k=function(a,b,c){if(h.apply(this,arguments),this._extensions=new g,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var d=this._request.headers["sec-websocket-protocol"],e=this._protocols;void 0!==d&&("string"==typeof d&&(d=d.split(/ *, */)),this.protocol=d.filter(function(a){return e.indexOf(a)>=0})[0]),this.version="hybi-"+k.VERSION}};f.inherits(k,h),k.VERSION="13",k.mask=function(a,b,c){if(!b||0===b.length)return a;c=c||0;for(var d=0,e=a.length-c;d<e;d++)a[c+d]=a[c+d]^b[d%4];return a},k.generateAccept=function(a){var b=e.createHash("sha1");return b.update(a+k.GUID),b.digest("base64")},k.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var l={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(a){return this._extensions.add(a),!0},parse:function(a){this._reader.put(a);for(var b=!0;b;)switch(this._stage){case 0:(b=this._reader.read(1))&&this._parseOpcode(b[0]);break;case 1:(b=this._reader.read(1))&&this._parseLength(b[0]);break;case 2:(b=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(b);break;case 3:(b=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=b);break;case 4:(b=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(b));break;default:b=null}},text:function(a){return!(this.readyState>1)&&this.frame(a,"text")},binary:function(a){return!(this.readyState>1)&&this.frame(a,"binary")},ping:function(a,b){return!(this.readyState>1)&&(a=a||"",b&&(this._pingCallbacks[a]=b),this.frame(a,"ping"))},pong:function(a){return!(this.readyState>1)&&(a=a||"",this.frame(a,"pong"))},close:function(a,b){return(a=a||"",b=b||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new h.CloseEvent(b,a)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(a,"close",b)},this),!0)},frame:function(a,b,c){if(this.readyState<=0)return this._queue([a,b,c]);if(this.readyState>2)return!1;a instanceof Array&&(a=d.from(a)),"number"==typeof a&&(a=a.toString());var f,g,h=new j,k="string"==typeof a;h.rsv1=h.rsv2=h.rsv3=!1,h.opcode=this.OPCODES[b||(k?"text":"binary")],f=k?d.from(a,"utf8"):a,c&&(g=f,(f=d.allocUnsafe(2+g.length)).writeUInt16BE(c,0),g.copy(f,2)),h.data=f;var l=function(a){var b=new i;b.final=!0,b.rsv1=a.rsv1,b.rsv2=a.rsv2,b.rsv3=a.rsv3,b.opcode=a.opcode,b.masked=!!this._masking,b.length=a.data.length,b.payload=a.data,b.masked&&(b.maskingKey=e.randomBytes(4)),this._sendFrame(b)};return this.MESSAGE_OPCODES.indexOf(h.opcode)>=0?this._extensions.processOutgoingMessage(h,function(a,b){if(a)return this._fail("extension_error",a.message);l.call(this,b)},this):l.call(this,h),!0},_sendFrame:function(a){var b=a.length,c=b<=125?2:b<=65535?4:10,e=c+4*!!a.masked,f=d.allocUnsafe(e+b),g=a.masked?this.MASK:0;f[0]=(a.final?this.FIN:0)|(a.rsv1?this.RSV1:0)|(a.rsv2?this.RSV2:0)|(a.rsv3?this.RSV3:0)|a.opcode,b<=125?f[1]=g|b:b<=65535?(f[1]=126|g,f.writeUInt16BE(b,2)):(f[1]=127|g,f.writeUInt32BE(Math.floor(b/0x100000000),2),f.writeUInt32BE(b%0x100000000,6)),a.payload.copy(f,e),a.masked&&(a.maskingKey.copy(f,c),k.mask(f,a.maskingKey,e)),this._write(f)},_handshakeResponse:function(){var a=this._request.headers["sec-websocket-key"],b=this._request.headers["sec-websocket-version"];if(b!==k.VERSION)throw Error("Unsupported WebSocket version: "+b);if("string"!=typeof a)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",k.generateAccept(a)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var c=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);c&&this._headers.set("Sec-WebSocket-Extensions",c);var e=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return d.from(e.join("\r\n"),"utf8")},_shutdown:function(a,b,c){delete this._frame,delete this._message,this._stage=5;var d=1===this.readyState;this.readyState=2,this._extensions.close(function(){d&&this.frame(b,"close",a),this.readyState=3,c&&this.emit("error",Error(b)),this.emit("close",new h.CloseEvent(a,b))},this)},_fail:function(a,b){this.readyState>1||this._shutdown(this.ERRORS[a],b,!0)},_parseOpcode:function(a){var b=[this.RSV1,this.RSV2,this.RSV3].map(function(b){return(a&b)===b}),c=this._frame=new i;return(c.final=(a&this.FIN)===this.FIN,c.rsv1=b[0],c.rsv2=b[1],c.rsv3=b[2],c.opcode=a&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(c))?0>this.OPCODE_CODES.indexOf(c.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+c.opcode):0>this.MESSAGE_OPCODES.indexOf(c.opcode)&&!c.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+c.opcode):this._message&&this.OPENING_OPCODES.indexOf(c.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!c.rsv1+", reserved2 = "+ +!!c.rsv2+", reserved3 = "+ +!!c.rsv3)},_parseLength:function(a){var b=this._frame;if(b.masked=(a&this.MASK)===this.MASK,b.length=a&this.LENGTH,b.length>=0&&b.length<=125){if(this._stage=b.masked?3:4,!this._checkFrameLength())return}else this._stage=2,b.lengthBytes=126===b.length?2:8;if(this._requireMasking&&!b.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(a){var b=this._frame;if(b.length=this._readUInt(a),this._stage=b.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(b.opcode)&&b.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+b.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(a){var b,c,d,e,f,g=this._frame,i=g.payload=k.mask(a,g.maskingKey),l=g.opcode;if(delete this._frame,l===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(g)}if((l===this.OPCODES.text||l===this.OPCODES.binary)&&(this._message=new j,this._message.pushFrame(g)),g.final&&this.MESSAGE_OPCODES.indexOf(l)>=0)return this._emitMessage(this._message);l===this.OPCODES.close&&(c=i.length>=2?i.readUInt16BE(0):null,d=i.length>2?this._encode(i.slice(2)):null,0!==i.length&&!(null!==c&&c>=this.MIN_RESERVED_ERROR&&c<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(c)&&(c=this.ERRORS.protocol_error),(i.length>125||i.length>2&&!d)&&(c=this.ERRORS.protocol_error),this._shutdown(c||this.DEFAULT_ERROR_CODE,d||"")),l===this.OPCODES.ping&&(this.frame(i,"pong"),this.emit("ping",new h.PingEvent(i.toString()))),l===this.OPCODES.pong&&(f=(e=this._pingCallbacks)[b=this._encode(i)],delete e[b],f&&f(),this.emit("pong",new h.PongEvent(i.toString())))},_emitMessage:function(a){var a=this._message;a.read(),delete this._message,this._extensions.processIncomingMessage(a,function(a,b){if(a)return this._fail("extension_error",a.message);var c=b.data;if(b.opcode===this.OPCODES.text&&(c=this._encode(c)),null===c)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new h.MessageEvent(c))},this)},_encode:function(a){try{var b=a.toString("binary",0,a.length);if(!this.UTF8_MATCH.test(b))return null}catch(a){}return a.toString("utf8",0,a.length)},_readUInt:function(a){return 2===a.length?a.readUInt16BE(0):0x100000000*a.readUInt32BE(0)+a.readUInt32BE(4)}};for(var m in l)k.prototype[m]=l[m];b.exports=k},27520,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(88947).Stream,f=a.r(92509),g=a.r(24361),h=a.r(30145),i=a.r(86562),j=a.r(34867),k={"ws:":80,"wss:":443},l=function(a,b,c){this._client=a,this._http=new j("response"),this._origin="object"==typeof a.url?a.url:f.parse(a.url),this._url="object"==typeof b?b:f.parse(b),this._options=c||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new i,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var e=this._url.auth&&d.from(this._url.auth,"utf8").toString("base64");e&&this._headers.set("Proxy-Authorization","Basic "+e)};g.inherits(l,e);var m={setHeader:function(a,b){return 0===this._state&&(this._headers.set(a,b),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var a=this._origin,b=a.port||k[a.protocol],c=["CONNECT "+a.hostname+":"+b+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",d.from(c.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(a){if(!this.writable)return!1;if(this._http.parse(a),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new h.ConnectEvent);else{var b="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(b))}return this.end(),!this._paused},end:function(a){this.writable&&(void 0!==a&&this.write(a),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var n in m)l.prototype[n]=m[n];b.exports=l},17737,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(54799),f=a.r(92509),g=a.r(24361),h=a.r(34867),i=a.r(30145),j=a.r(46987),k=a.r(27520),l=function(a,b){this.version="hybi-"+j.VERSION,j.call(this,null,a,b),this.readyState=-1,this._key=l.generateKey(),this._accept=j.generateAccept(this._key),this._http=new h("response");var c=f.parse(this.url),e=c.auth&&d.from(c.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(c.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(c.pathname||"/")+(c.search||""),this._headers.set("Host",c.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",j.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),e&&this._headers.set("Authorization","Basic "+e)};g.inherits(l,j),l.generateKey=function(){return e.randomBytes(16).toString("base64")};var m={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(a,b){return new k(this,a,b)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(a){return 3===this.readyState?void 0:this.readyState>0?j.prototype.parse.call(this,a):(this._http.parse(a),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var a=this._extensions.generateOffer();a&&this._headers.set("Sec-WebSocket-Extensions",a);var b=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return d.from(b.join("\r\n"),"utf8")},_failHandshake:function(a){a="Error during WebSocket handshake: "+a,this.readyState=3,this.emit("error",Error(a)),this.emit("close",new i.CloseEvent(this.ERRORS.protocol_error,a))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var a=this._http.headers,b=a.upgrade||"",c=a.connection||"",d=a["sec-websocket-accept"]||"",e=a["sec-websocket-protocol"]||"";if(""===b)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==b.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===c)return this._failHandshake("'Connection' header is missing");if("upgrade"!==c.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(d!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==e)if(0>this._protocols.indexOf(e))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=e;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(a){return this._failHandshake(a.message)}}};for(var n in m)l.prototype[n]=m[n];b.exports=l},10950,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(24361),g=function(a,b,c){e.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};f.inherits(g,e);var h={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},parse:function(a){this.readyState>1||(this._reader.put(a),this._reader.eachByte(function(a){var b;switch(this._stage){case -1:this._body.push(a),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(a);break;case 1:if(this._length=(127&a)+128*this._length,this._closing&&0===this._length)return this.close();(128&a)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===a)this._stage=0,b=d.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new e.MessageEvent(b));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(a),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(a){if(0===this.readyState)return this._queue([a]);if(this.readyState>1)return!1;"string"!=typeof a&&(a=a.toString());var b=d.byteLength(a),c=d.allocUnsafe(b+2);return c[0]=0,c.write(a,1),c[c.length-1]=255,this._write(c),!0},_handshakeResponse:function(){var a=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"utf8")},_parseLeadingByte:function(a){(128&a)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var i in h)g.prototype[i]=h[i];b.exports=g},61123,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(30145),f=a.r(10950),g=a.r(54799),h=a.r(24361),i=function(a){return parseInt((a.match(/[0-9]/g)||[]).join(""),10)},j=function(a){return(a.match(/ /g)||[]).length},k=function(a,b,c){f.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};h.inherits(k,f);var l={BODY_SIZE:8,start:function(){return!!f.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(d.from([255,0])),this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,b=a["sec-websocket-key1"],c=a["sec-websocket-key2"];if(!b)throw Error("Missing required header: Sec-WebSocket-Key1");if(!c)throw Error("Missing required header: Sec-WebSocket-Key2");var e=i(b),f=j(b),g=i(c),h=j(c);if(e%f!=0||g%h!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[e/f,g/h];var a=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var a=g.createHash("md5"),b=d.allocUnsafe(8+this.BODY_SIZE);return b.writeUInt32BE(this._keyValues[0],0),b.writeUInt32BE(this._keyValues[1],4),d.from(this._body).copy(b,8,0,this.BODY_SIZE),a.update(b),d.from(a.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var a=this._handshakeSignature();a&&(this._write(a),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(a){if(255!==a)return f.prototype._parseLeadingByte.call(this,a);this._closing=!0,this._length=0,this._stage=1}};for(var m in l)k.prototype[m]=l[m];b.exports=k},89048,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(34867),f=a.r(30145),g=a.r(10950),h=a.r(61123),i=a.r(46987),j=function(a){f.call(this,null,null,a),this._http=new e("request")};d.inherits(j,f);var k={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(a){if(this._delegate)return this._delegate.parse(a);if(this._http.parse(a),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var b=this;this._delegate=j.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(a){this._delegate.on(a,function(c){b.emit(a,c)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new f.ConnectEvent)}},_open:function(){this.__queue.forEach(function(a){this._delegate[a[0]].apply(this._delegate,a[1])},this),this.__queue=[]}};for(var l in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(a){k[a]=function(){return this._delegate?this._delegate[a].apply(this._delegate,arguments):(this.__queue.push([a,arguments]),!0)}}),k)j.prototype[l]=k[l];j.isSecureRequest=function(a){if(a.connection&&void 0!==a.connection.authorized||a.socket&&a.socket.secure)return!0;var b=a.headers;return!!b&&("on"===b.https||"on"===b["x-forwarded-ssl"]||"https"===b["x-forwarded-scheme"]||"https"===b["x-forwarded-proto"])},j.determineUrl=function(a){return(this.isSecureRequest(a)?"wss:":"ws:")+"//"+a.headers.host+a.url},j.http=function(a,b){void 0===(b=b||{}).requireMasking&&(b.requireMasking=!0);var c=a.headers,d=c["sec-websocket-version"],e=c["sec-websocket-key"],f=c["sec-websocket-key1"],j=c["sec-websocket-key2"],k=this.determineUrl(a);return d||e?new i(a,k,b):f||j?new h(a,k,b):new g(a,k,b)},b.exports=j},38398,(a,b,c)=>{"use strict";var d=a.r(30145),e=a.r(17737),f=a.r(89048);b.exports={client:function(a,b){return void 0===(b=b||{}).masking&&(b.masking=!0),new e(a,b)},server:function(a){return void 0===(a=a||{}).requireMasking&&(a.requireMasking=!0),new f(a)},http:function(){return f.http.apply(f,arguments)},isSecureRequest:function(a){return f.isSecureRequest(a)},isWebSocket:function(a){return d.isWebSocket(a)},validateOptions:function(a,b){d.validateOptions(a,b)}}},59808,(a,b,c)=>{"use strict";var d=function(a,b){for(var c in this.type=a,b)this[c]=b[c]};d.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},d.prototype.stopPropagation=function(){},d.prototype.preventDefault=function(){},d.CAPTURING_PHASE=1,d.AT_TARGET=2,d.BUBBLING_PHASE=3,b.exports=d},1738,(a,b,c)=>{"use strict";var d=a.r(59808);b.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(a,b,c){this.on(a,b)},removeEventListener:function(a,b,c){this.removeListener(a,b)},dispatchEvent:function(a){a.target=a.currentTarget=this,a.eventPhase=d.AT_TARGET,this["on"+a.type]&&this["on"+a.type](a),this.emit(a.type,a)}}},79136,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(1738),h=a.r(59808),i=function(a){a=a||{},f.validateOptions(a,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var b=a.headers;if(b)for(var c in b)this._driver.setHeader(c,b[c]);var d=a.extensions;d&&[].concat(d).forEach(this._driver.addExtension,this._driver),this._ping=a.ping,this._pingId=0,this.readyState=i.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var e=this;this._driver.on("open",function(a){e._open()}),this._driver.on("message",function(a){e._receiveMessage(a.data)}),this._driver.on("close",function(a){e._beginClose(a.reason,a.code)}),this._driver.on("error",function(a){e._emitError(a.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){e.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){e._pingId+=1,e.ping(e._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};e.inherits(i,d),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_TIMEOUT=3e4;var j={write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.send(a),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(a){return!(this.readyState>i.OPEN)&&(a instanceof Buffer||(a=String(a)),this._driver.messages.write(a))},ping:function(a,b){return!(this.readyState>i.OPEN)&&this._driver.ping(a,b)},close:function(a,b){if(void 0===a&&(a=1e3),void 0===b&&(b=""),1e3!==a&&(a<3e3||a>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+a+" is neither.");if(this.readyState<i.CLOSING){var c=this;this._closeTimer=setTimeout(function(){c._beginClose("",1006)},i.CLOSE_TIMEOUT)}this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING),this._driver.close(b,a)},_configureStream:function(){var a=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(b){this._stream.on(b,function(){a._finalizeClose()})},this),this._stream.on("error",function(b){a._emitError("Network error: "+a.url+": "+b.message),a._finalizeClose()})},_open:function(){if(this.readyState===i.CONNECTING){this.readyState=i.OPEN,this.protocol=this._driver.protocol||"";var a=new h("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},_receiveMessage:function(a){if(this.readyState>i.OPEN)return!1;this.readable&&this.emit("data",a);var b=new h("message",{data:a});b.initEvent("message",!1,!1),this.dispatchEvent(b)},_emitError:function(a){if(!(this.readyState>=i.CLOSING)){var b=new h("error",{message:a});b.initEvent("error",!1,!1),this.dispatchEvent(b)}},_beginClose:function(a,b){this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING,this._closeParams=[a,b],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==i.CLOSED){this.readyState=i.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var a=this._closeParams?this._closeParams[0]:"",b=new h("close",{code:this._closeParams?this._closeParams[1]:1006,reason:a});b.initEvent("close",!1,!1),this.dispatchEvent(b)}}};for(var k in j)i.prototype[k]=j[k];for(var l in g)i.prototype[l]=g[l];b.exports=i},85053,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(4446),f=a.r(55004),g=a.r(92509),h=a.r(38398),i=a.r(79136);a.r(59808);var j={"http:":80,"https:":443,"ws:":80,"wss:":443},k=["https:","wss:"],l=function(a,b,c){c=c||{},this.url=a,this._driver=h.client(this.url,{maxLength:c.maxLength,protocols:b}),["open","error"].forEach(function(a){this._driver.on(a,function(){s.headers=s._driver.headers,s.statusCode=s._driver.statusCode})},this);var d=c.proxy||{},l=g.parse(d.origin||this.url),m=l.port||j[l.protocol],n=k.indexOf(l.protocol)>=0,o=function(){s._onConnect()},p=c.net||{},q=c.tls||{},r=d.origin?d.tls||{}:q,s=this;p.host=r.host=l.hostname,p.port=r.port=m,q.ca=q.ca||c.ca,r.servername=r.servername||l.hostname,this._stream=n?f.connect(r,o):e.connect(p,o),d.origin&&this._configureProxy(d,q),i.call(this,c)};d.inherits(l,i),l.prototype._onConnect=function(){(this._proxy||this._driver).start()},l.prototype._configureProxy=function(a,b){var c,d=g.parse(this.url),e=k.indexOf(d.protocol)>=0,h=this;if(this._proxy=this._driver.proxy(a.origin),a.headers)for(c in a.headers)this._proxy.setHeader(c,a.headers[c]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(e){var a={socket:h._stream,servername:d.hostname};for(c in b)a[c]=b[c];h._stream=f.connect(a),h._configureStream()}h._driver.io.pipe(h._stream),h._stream.pipe(h._driver.io),h._driver.start()}),this._proxy.on("error",function(a){h._driver.emit("error",a)})},b.exports=l},92173,(a,b,c)=>{"use strict";var d=a.r(88947).Stream,e=a.r(24361),f=a.r(38398),g=a.r(86562),h=a.r(79136),i=a.r(1738),j=a.r(59808),k=function(a,b,c){this.writable=!0,c=c||{},this._stream=b.socket,this._ping=c.ping||this.DEFAULT_PING,this._retry=c.retry||this.DEFAULT_RETRY;var d=f.isSecureRequest(a)?"https:":"http:";this.url=d+"//"+a.headers.host+a.url,this.lastEventId=a.headers["last-event-id"]||"",this.readyState=h.CONNECTING;var e=new g,i=this;if(c.headers)for(var j in c.headers)e.set(j,c.headers[j]);if(this._stream&&this._stream.writable){process.nextTick(function(){i._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var k="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+e.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(k),this._stream.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i.ping()},1e3*this._ping)),["error","end"].forEach(function(a){i._stream.on(a,function(){i.close()})})}};e.inherits(k,d),k.isEventSource=function(a){return"GET"===a.method&&(a.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var l={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(a){if(!this.writable)return!1;try{return this._stream.write(a,"utf8")}catch(a){return!1}},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN;var a=new j("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.write(a),this.close()},send:function(a,b){if(this.readyState>h.OPEN)return!1;a=String(a).replace(/(\r\n|\r|\n)/g,"$1data: ");var c="";return(b=b||{}).event&&(c+="event: "+b.event+"\r\n"),b.id&&(c+="id: "+b.id+"\r\n"),c+="data: "+a+"\r\n\r\n",this._write(c)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>h.OPEN)return!1;this.readyState=h.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var a=new j("close");return a.initEvent("close",!1,!1),this.dispatchEvent(a),!0}};for(var m in l)k.prototype[m]=l[m];for(var n in i)k.prototype[n]=i[n];b.exports=k},47760,(a,b,c)=>{"use strict";var d=a.r(24361),e=a.r(38398),f=a.r(79136),g=function(a,b,c,d,g){g=g||{},this._stream=b,this._driver=e.http(a,{maxLength:g.maxLength,protocols:d});var h=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var i=function(){h._stream.removeListener("data",i)};this._stream.on("data",i),f.call(this,g),process.nextTick(function(){h._driver.start(),h._driver.io.write(c)})}};d.inherits(g,f),g.isWebSocket=function(a){return e.isWebSocket(a)},g.validateOptions=function(a,b){e.validateOptions(a,b)},g.WebSocket=g,g.Client=a.r(85053),g.EventSource=a.r(92173),b.exports=g},72029,50455,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n;var o,p,q=a.i(47760),r=a.i(69304),s=a.i(14834),t=a.i(88156),u=a.i(57179);let v=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,w="websocket",x="long_polling";class y{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b}get(a){return(0,r.contains)(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}let z=function(a){return new y},A=z("localStorage"),B=z("sessionStorage"),C=new s.Logger("@firebase/database"),D=(l=1,function(){return l++}),E=function(a){let b=(0,r.stringToByteArray)(a),c=new r.Sha1;c.update(b);let d=c.digest();return r.base64.encodeByteArray(d)},F=function(...a){let b="";for(let c=0;c<a.length;c++){let d=a[c];Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length?b+=F.apply(null,d):"object"==typeof d?b+=(0,r.stringify)(d):b+=d,b+=" "}return b},G=null,H=!0,I=function(a,b){(0,r.assert)(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(C.logLevel=s.LogLevel.VERBOSE,G=C.log.bind(C),b&&B.set("logging_enabled",!0)):"function"==typeof a?G=a:(G=null,B.remove("logging_enabled"))},J=function(...a){if(!0===H&&(H=!1,null===G&&!0===B.get("logging_enabled")&&I(!0)),G){let b=F.apply(null,a);G(b)}},K=function(a){return function(...b){J(a,...b)}},L=function(...a){let b="FIREBASE INTERNAL ERROR: "+F(...a);C.error(b)},M=function(...a){let b=`FIREBASE FATAL ERROR: ${F(...a)}`;throw C.error(b),Error(b)},N=function(...a){let b="FIREBASE WARNING: "+F(...a);C.warn(b)},O=function(){},P=function(a){return"number"==typeof a&&(a!=a||a===1/0||a===-1/0)},Q=function(a){if((0,r.isNodeSdk)()||"complete"===document.readyState)a();else{let b=!1,c=function(){document.body?b||(b=!0,a()):setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},R="[MIN_NAME]",S="[MAX_NAME]",T=function(a,b){if(a===b)return 0;{if(a===R||b===S)return -1;if(b===R||a===S)return 1;let c=_(a),d=_(b);if(null!==c)if(null!==d)return c-d==0?a.length-b.length:c-d;else return -1;return null!==d?1:a<b?-1:1}},U=function(a,b){return a===b?0:a<b?-1:1},V=function(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+(0,r.stringify)(b))},W=function(a){if("object"!=typeof a||null===a)return(0,r.stringify)(a);let b=[];for(let c in a)b.push(c);b.sort();let c="{";for(let d=0;d<b.length;d++)0!==d&&(c+=","),c+=(0,r.stringify)(b[d]),c+=":",c+=W(a[b[d]]);return c+"}"},X=function(a,b){let c=a.length;if(c<=b)return[a];let d=[];for(let e=0;e<c;e+=b)e+b>c?d.push(a.substring(e,c)):d.push(a.substring(e,e+b));return d};function Y(a,b){for(let c in a)a.hasOwnProperty(c)&&b(c,a[c])}let Z=function(a){let b,c,d,e,f;(0,r.assert)(!P(a),"Invalid JSON number");0===a?(c=0,d=0,b=+(1/a==-1/0)):(b=a<0,(a=Math.abs(a))>=22250738585072014e-324?(c=(e=Math.min(Math.floor(Math.log(a)/Math.LN2),1023))+1023,d=Math.round(a*Math.pow(2,52-e)-0x10000000000000)):(c=0,d=Math.round(a/5e-324)));let g=[];for(f=52;f;f-=1)g.push(d%2?1:0),d=Math.floor(d/2);for(f=11;f;f-=1)g.push(c%2?1:0),c=Math.floor(c/2);g.push(+!!b),g.reverse();let h=g.join(""),i="";for(f=0;f<64;f+=8){let a=parseInt(h.substr(f,8),2).toString(16);1===a.length&&(a="0"+a),i+=a}return i.toLowerCase()},$=RegExp("^-?(0*)\\d{1,10}$"),_=function(a){if($.test(a)){let b=Number(a);if(b>=-0x80000000&&b<=0x7fffffff)return b}return null},aa=function(a){try{a()}catch(a){setTimeout(()=>{throw N("Exception was thrown by user callback.",a.stack||""),a},Math.floor(0))}},ab=function(a,b){let c=setTimeout(a,b);return"number"==typeof c&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(c):"object"==typeof c&&c.unref&&c.unref(),c};class ac{constructor(a,b,c,d,e=!1,f="",g=!1,h=!1,i=null){this.secure=b,this.namespace=c,this.webSocketOnly=d,this.nodeAdmin=e,this.persistenceKey=f,this.includeNamespaceInQueryParams=g,this.isUsingEmulator=h,this.emulatorOptions=i,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=A.get("host:"+a)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&A.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){let a=this.secure?"https://":"http://",b=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${b}`}}function ad(a,b,c){let d;if((0,r.assert)("string"==typeof b,"typeof type must == string"),(0,r.assert)("object"==typeof c,"typeof params must == object"),b===w)d=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(b===x)d=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw Error("Unknown connection type: "+b);(a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams)&&(c.ns=a.namespace);let e=[];return Y(c,(a,b)=>{e.push(a+"="+b)}),d+e.join("&")}class ae{constructor(){this.counters_={}}incrementCounter(a,b=1){(0,r.contains)(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b}get(){return(0,r.deepCopy)(this.counters_)}}let af={},ag={};function ah(a){let b=a.toString();return af[b]||(af[b]=new ae),af[b]}let ai="";function aj(a){ai=a}let ak=null;"u">typeof MozWebSocket?ak=MozWebSocket:"u">typeof WebSocket&&(ak=WebSocket);class al{constructor(a,b,c,d,e,f,g){this.connId=a,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=K(this.connId),this.stats_=ah(b),this.connURL=al.connectionURL_(b,f,g,d,c),this.nodeAdmin=b.nodeAdmin}static connectionURL_(a,b,c,d,e){let f={};return f.v="5",!(0,r.isNodeSdk)()&&"u">typeof location&&location.hostname&&v.test(location.hostname)&&(f.r="f"),b&&(f.s=b),c&&(f.ls=c),d&&(f.ac=d),e&&(f.p=e),ad(a,w,f)}open(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,A.set("previous_websocket_failure",!0);try{let a;if((0,r.isNodeSdk)()){let b=this.nodeAdmin?"AdminNode":"Node";a={headers:{"User-Agent":`Firebase/5/${ai}/${process.platform}/${b}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);let c=process.env,d=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;d&&(a.proxy={origin:d})}this.mySock=new ak(this.connURL,[],a)}catch(b){this.log_("Error instantiating WebSocket.");let a=b.message||b.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");let b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){al.forceDisallow_=!0}static isAvailable(){let a=!1;if("u">typeof navigator&&navigator.userAgent){let b=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);b&&b.length>1&&4.4>parseFloat(b[1])&&(a=!0)}return!a&&null!==ak&&!al.forceDisallow_}static previouslyFailed(){return A.isInMemoryStorage||!0===A.get("previous_websocket_failure")}markConnectionHealthy(){A.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){let a=this.frames.join("");this.frames=null;let b=(0,r.jsonEval)(a);this.onMessage(b)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if((0,r.assert)(null===this.frames,"We already have a frame buffer"),a.length<=6){let b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(null===this.mySock)return;let b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{let a=this.extractFrameCount_(b);null!==a&&this.appendFrame_(a)}}send(a){this.resetKeepAlive();let b=(0,r.stringify)(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=X(b,16384);c.length>1&&this.sendString_(String(c.length));for(let a=0;a<c.length;a++)this.sendString_(c[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(a){try{this.mySock.send(a)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}al.responsesRequiredToBeHealthy=2,al.healthyTimeout=3e4;let am="@firebase/database",an="1.1.0";class ao{constructor(a,b){this.appCheckProvider=b,this.appName=a.name,(0,t._isFirebaseServerApp)(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=b?.getImmediate({optional:!0}),this.appCheck||b?.get().then(a=>this.appCheck=a)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((b,c)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.appCheckProvider?.get().then(b=>b.addTokenListener(a))}notifyForInvalidToken(){N(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class ap{constructor(a,b,c){this.appName_=a,this.firebaseOptions_=b,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(a=>this.auth_=a)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(a=>a&&"auth/token-not-initialized"===a.code?(J("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((b,c)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(b=>b.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(b=>b.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',N(a)}}class aq{constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}aq.OWNER="owner";class ar{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){let a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&aa(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let as="start";class at{constructor(a,b,c,d,e,f,g){this.connId=a,this.repoInfo=b,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.transportSessionId=f,this.lastSessionId=g,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=K(a),this.stats_=ah(b),this.urlFn=a=>(this.appCheckToken&&(a.ac=this.appCheckToken),ad(b,x,a))}open(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new ar(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),Q(()=>{if(this.isClosed_)return;this.scriptTagHolder=new au((...a)=>{let[b,c,d,e,f]=a;if(this.incrementIncomingBytes_(a),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===as)this.id=c,this.password=d;else if("close"===b)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+b)},(...a)=>{let[b,c]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(b,c)},()=>{this.onClosed_()},this.urlFn);let a={};a[as]="t",a.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(a.cb=this.scriptTagHolder.uniqueCallbackIdentifier),a.v="5",this.transportSessionId&&(a.s=this.transportSessionId),this.lastSessionId&&(a.ls=this.lastSessionId),this.applicationId&&(a.p=this.applicationId),this.appCheckToken&&(a.ac=this.appCheckToken),"u">typeof location&&location.hostname&&v.test(location.hostname)&&(a.r="f");let b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){at.forceAllow_=!0}static forceDisallow(){at.forceDisallow_=!0}static isAvailable(){return!(0,r.isNodeSdk)()&&(!!at.forceAllow_||!at.forceDisallow_&&"u">typeof document&&null!=document.createElement&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){let b=(0,r.stringify)(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=X((0,r.base64Encode)(b),1840);for(let a=0;a<c.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[a]),this.curSegmentNum++}addDisconnectPingFrame(a,b){if((0,r.isNodeSdk)())return;this.myDisconnFrame=document.createElement("iframe");let c={};c.dframe="t",c.id=a,c.pw=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){let b=(0,r.stringify)(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)}}class au{constructor(a,b,c,d){if(this.onDisconnect=c,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,r.isNodeSdk)())this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=D(),window["pLPCommand"+this.uniqueCallbackIdentifier]=a,window["pRTLPCB"+this.uniqueCallbackIdentifier]=b,this.myIFrame=au.createIFrame_();let c="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(c='<script>document.domain="'+document.domain+'";</script>');const d="<html><body>"+c+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(a){J("frame writing exception"),a.stack&&J(a.stack),J(a)}}}static createIFrame_(){let a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||J("No IE domain setting required")}catch(b){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let a={};a.id=this.myID,a.pw=this.myPW,a.ser=this.currentSerial;let b=this.urlFn(a),c="",d=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+c.length<=1870){let a=this.pendingSegs.shift();c=c+"&seg"+d+"="+a.seg+"&ts"+d+"="+a.ts+"&d"+d+"="+a.d,d++}else break;return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}}enqueueSegment(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(a,b){this.outstandingRequests.add(b);let c=()=>{this.outstandingRequests.delete(b),this.newRequest_()},d=setTimeout(c,Math.floor(25e3));this.addTag(a,()=>{clearTimeout(d),c()})}addTag(a,b){(0,r.isNodeSdk)()?this.doNodeLongPoll(a,b):setTimeout(()=>{try{if(!this.sendNewPolls)return;let c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.onload=c.onreadystatechange=function(){let a=c.readyState;a&&"loaded"!==a&&"complete"!==a||(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),b())},c.onerror=()=>{J("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch(a){}},Math.floor(1))}}class av{static get ALL_TRANSPORTS(){return[at,al]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){let b=al&&al.isAvailable(),c=b&&!al.previouslyFailed();if(a.webSocketOnly&&(b||N("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[al];else{let a=this.transports_=[];for(let b of av.ALL_TRANSPORTS)b&&b.isAvailable()&&a.push(b);av.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}av.globalTransportInitialized_=!1;class aw{constructor(a,b,c,d,e,f,g,h,i,j){this.id=a,this.repoInfo_=b,this.applicationId_=c,this.appCheckToken_=d,this.authToken_=e,this.onMessage_=f,this.onReady_=g,this.onDisconnect_=h,this.onKill_=i,this.lastSessionId=j,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=K("c:"+this.id+":"),this.transportManager_=new av(b),this.log_("Connection created"),this.start_()}start_(){let a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(b,c)},Math.floor(0));let d=a.healthyTimeout||0;d>0&&(this.healthyTimeout_=ab(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return b=>{a===this.conn_?this.onConnectionLost_(b):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return b=>{2!==this.state_&&(a===this.rx_?this.onPrimaryMessageReceived_(b):a===this.secondaryConn_?this.onSecondaryMessageReceived_(b):this.log_("message on old connection"))}}sendRequest(a){this.sendData_({t:"d",d:a})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if("t"in a){let b=a.t;"a"===b?this.upgradeIfSecondaryHealthy_():"r"===b?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===b&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){let b=V("t",a),c=V("d",a);if("c"===b)this.onSecondaryControl_(c);else if("d"===b)this.pendingDataMessages.push(c);else throw Error("Unknown protocol layer: "+b)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){let b=V("t",a),c=V("d",a);"c"===b?this.onControl_(c):"d"===b&&this.onDataMessage_(c)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){let b=V("t",a);if("d"in a){let c=a.d;if("h"===b){let a={...c};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if("n"===b){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===b?this.onConnectionShutdown_(c):"r"===b?this.onReset_(c):"e"===b?L("Server Error: "+c):"o"===b?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):L("Unknown control packet command: "+b)}}onHandshake_(a){let b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.host=d,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),"5"!==c&&N("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c),ab(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(b,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ab(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,a||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(A.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(a)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ax{put(a,b,c,d){}merge(a,b,c,d){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,b,c){}onDisconnectMerge(a,b,c){}onDisconnectCancel(a,b){}reportStats(a){}}class ay{constructor(a){this.allowedEvents_=a,this.listeners_={},(0,r.assert)(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...b){if(Array.isArray(this.listeners_[a])){let c=[...this.listeners_[a]];for(let a=0;a<c.length;a++)c[a].callback.apply(c[a].context,b)}}on(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});let d=this.getInitialEvent(a);d&&b.apply(c,d)}off(a,b,c){this.validateEventType_(a);let d=this.listeners_[a]||[];for(let a=0;a<d.length;a++)if(d[a].callback===b&&(!c||c===d[a].context))return void d.splice(a,1)}validateEventType_(a){(0,r.assert)(this.allowedEvents_.find(b=>b===a),"Unknown event: "+a)}}class az extends ay{static getInstance(){return new az}constructor(){super(["online"]),this.online_=!0}getInitialEvent(a){return(0,r.assert)("online"===a,"Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}class aA{constructor(a,b){if(void 0===b){this.pieces_=a.split("/");let b=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[b]=this.pieces_[a],b++);this.pieces_.length=b,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b}toString(){let a="";for(let b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"}}function aB(){return new aA("")}function aC(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function aD(a){return a.pieces_.length-a.pieceNum_}function aE(a){let b=a.pieceNum_;return b<a.pieces_.length&&b++,new aA(a.pieces_,b)}function aF(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function aG(a,b=0){return a.pieces_.slice(a.pieceNum_+b)}function aH(a){if(a.pieceNum_>=a.pieces_.length)return null;let b=[];for(let c=a.pieceNum_;c<a.pieces_.length-1;c++)b.push(a.pieces_[c]);return new aA(b,0)}function aI(a,b){let c=[];for(let b=a.pieceNum_;b<a.pieces_.length;b++)c.push(a.pieces_[b]);if(b instanceof aA)for(let a=b.pieceNum_;a<b.pieces_.length;a++)c.push(b.pieces_[a]);else{let a=b.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&c.push(a[b])}return new aA(c,0)}function aJ(a){return a.pieceNum_>=a.pieces_.length}function aK(a,b){let c=aC(a),d=aC(b);if(null===c)return b;if(c===d)return aK(aE(a),aE(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function aL(a,b){let c=aG(a,0),d=aG(b,0);for(let a=0;a<c.length&&a<d.length;a++){let b=T(c[a],d[a]);if(0!==b)return b}return c.length===d.length?0:c.length<d.length?-1:1}function aM(a,b){if(aD(a)!==aD(b))return!1;for(let c=a.pieceNum_,d=b.pieceNum_;c<=a.pieces_.length;c++,d++)if(a.pieces_[c]!==b.pieces_[d])return!1;return!0}function aN(a,b){let c=a.pieceNum_,d=b.pieceNum_;if(aD(a)>aD(b))return!1;for(;c<a.pieces_.length;){if(a.pieces_[c]!==b.pieces_[d])return!1;++c,++d}return!0}class aO{constructor(a,b){this.errorPrefix_=b,this.parts_=aG(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=(0,r.stringLength)(this.parts_[a]);aP(this)}}function aP(a){if(a.byteLength_>768)throw Error(a.errorPrefix_+"has a key path longer than 768 bytes ("+a.byteLength_+").");if(a.parts_.length>32)throw Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+aQ(a))}function aQ(a){return 0===a.parts_.length?"":"in property '"+a.parts_.join(".")+"'"}class aR extends ay{static getInstance(){return new aR}constructor(){let a,b;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(b="visibilitychange",a="hidden"):void 0!==document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):void 0!==document.msHidden?(b="msvisibilitychange",a="msHidden"):void 0!==document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b&&document.addEventListener(b,()=>{let b=!document[a];b!==this.visible_&&(this.visible_=b,this.trigger("visible",b))},!1)}getInitialEvent(a){return(0,r.assert)("visible"===a,"Unknown event type: "+a),[this.visible_]}}class aS extends ax{constructor(a,b,c,d,e,f,g,h){if(super(),this.repoInfo_=a,this.applicationId_=b,this.onDataUpdate_=c,this.onConnectStatus_=d,this.onServerInfoUpdate_=e,this.authTokenProvider_=f,this.appCheckTokenProvider_=g,this.authOverride_=h,this.id=aS.nextPersistentConnectionId_++,this.log_=K("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!(0,r.isNodeSdk)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");aR.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&az.getInstance().on("online",this.onOnline_,this)}sendRequest(a,b,c){let d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_((0,r.stringify)(e)),(0,r.assert)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)}get(a){this.initConnection_();let b=new r.Deferred,c={p:a._path.toString(),q:a._queryObject};this.outstandingGets_.push({action:"g",request:c,onComplete:a=>{let c=a.d;"ok"===a.s?b.resolve(c):b.reject(c)}}),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),b.promise}listen(a,b,c,d){this.initConnection_();let e=a._queryIdentifier,f=a._path.toString();this.log_("Listen called for "+f+" "+e),this.listens.has(f)||this.listens.set(f,new Map),(0,r.assert)(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,r.assert)(!this.listens.get(f).has(e),"listen() called twice for same path/queryId.");let g={onComplete:d,hashFn:b,query:a,tag:c};this.listens.get(f).set(e,g),this.connected_&&this.sendListen_(g)}sendGet_(a){let b=this.outstandingGets_[a];this.sendRequest("g",b.request,c=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),b.onComplete&&b.onComplete(c)})}sendListen_(a){let b=a.query,c=b._path.toString(),d=b._queryIdentifier;this.log_("Listen on "+c+" for "+d);let e={p:c};a.tag&&(e.q=b._queryObject,e.t=a.tag),e.h=a.hashFn(),this.sendRequest("q",e,e=>{let f=e.d,g=e.s;aS.warnOnListenWarnings_(f,b),(this.listens.get(c)&&this.listens.get(c).get(d))===a&&(this.log_("listen response",e),"ok"!==g&&this.removeListen_(c,d),a.onComplete&&a.onComplete(g,f))})}static warnOnListenWarnings_(a,b){if(a&&"object"==typeof a&&(0,r.contains)(a,"w")){let c=(0,r.safeGet)(a,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){let a='".indexOn": "'+b._queryParams.getIndex().toString()+'"',c=b._path.toString();N(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&40===a.length||(0,r.isAdmin)(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let a=this.authToken_,b=(0,r.isValidFormat)(a)?"auth":"gauth",c={cred:a};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(b,c,b=>{let c=b.s,d=b.d||"error";this.authToken_===a&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{let b=a.s,c=a.d||"error";"ok"===b?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(b,c)})}unlisten(a,b){let c=a._path.toString(),d=a._queryIdentifier;this.log_("Unlisten called for "+c+" "+d),(0,r.assert)(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,d)&&this.connected_&&this.sendUnlisten_(c,d,a._queryObject,b)}sendUnlisten_(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);let e={p:a};d&&(e.q=c,e.t=d),this.sendRequest("n",e)}onDisconnectPut(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})}onDisconnectMerge(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})}onDisconnectCancel(a,b){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})}sendOnDisconnect_(a,b,c,d){let e={p:b,d:c};this.log_("onDisconnect "+a,e),this.sendRequest(a,e,a=>{d&&setTimeout(()=>{d(a.s,a.d)},Math.floor(0))})}put(a,b,c,d){this.putInternal("p",a,b,c,d)}merge(a,b,c,d){this.putInternal("m",a,b,c,d)}putInternal(a,b,c,d,e){this.initConnection_();let f={p:b,d:c};void 0!==e&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;let g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)}sendPut_(a){let b=this.outstandingPuts_[a].action,c=this.outstandingPuts_[a].request,d=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(b,c,c=>{this.log_(b+" response",c),delete this.outstandingPuts_[a],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),d&&d(c.s,c.d)})}reportStats(a){if(this.connected_){let b={c:a};this.log_("reportStats",b),this.sendRequest("s",b,a=>{if("ok"!==a.s){let b=a.d;this.log_("reportStats","Error sending stats: "+b)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+(0,r.stringify)(a));let b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else if("error"in a)throw"A server-side error has occurred: "+a.error;else"a"in a&&this.onDataPush_(a.a,a.b)}onDataPush_(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"apc"===a?this.onAppCheckRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):L("Unrecognized action received from server: "+(0,r.stringify)(a)+"\nAre you using the latest client?")}onReady_(a,b){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=b,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){(0,r.assert)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),b=Math.max(0,this.reconnectDelay_-a);b=Math.random()*b,this.log_("Trying to reconnect in "+b+"ms"),this.scheduleConnect_(b),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let a=this.onDataMessage_.bind(this),b=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+aS.nextConnectionId_++,e=this.lastSessionId,f=!1,g=null,h=function(){g?g.close():(f=!0,c())};this.realtime_={close:h,sendRequest:function(a){(0,r.assert)(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(a)}};let i=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,j]=await Promise.all([this.authTokenProvider_.getToken(i),this.appCheckTokenProvider_.getToken(i)]);f?J("getToken() completed but was canceled"):(J("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=j&&j.token,g=new aw(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,b,c,a=>{N(a+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},e))}catch(a){this.log_("Failed to get token: "+a),f||(this.repoInfo_.nodeAdmin&&N(a),h())}}}interrupt(a){J("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){J("Resuming connection for reason: "+a),delete this.interruptReasons_[a],(0,r.isEmpty)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){let b=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:b})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){let b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(a,b){let c;c=b?b.map(a=>W(a)).join("$"):"default";let d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(a,b){let c,d=new aA(a).toString();if(this.listens.has(d)){let a=this.listens.get(d);c=a.get(b),a.delete(b),0===a.size&&this.listens.delete(d)}else c=void 0;return c}onAuthRevoked_(a,b){J("Auth token revoked: "+a+"/"+b),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===a||"permission_denied"===a)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,b){J("App check token revoked: "+a+"/"+b),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===a||"permission_denied"===a)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let a of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let b of a.values())this.sendListen_(b);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){let a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){let a={},b="js";(0,r.isNodeSdk)()&&(b=this.repoInfo_.nodeAdmin?"admin_node":"node"),a["sdk."+b+"."+ai.replace(/\./g,"-")]=1,(0,r.isMobileCordova)()?a["framework.cordova"]=1:(0,r.isReactNative)()&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){let a=az.getInstance().currentlyOnline();return(0,r.isEmpty)(this.interruptReasons_)&&a}}aS.nextPersistentConnectionId_=0,aS.nextConnectionId_=0;class aT{constructor(a,b){this.name=a,this.node=b}static Wrap(a,b){return new aT(a,b)}}class aU{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,b){let c=new aT(R,a),d=new aT(R,b);return 0!==this.compare(c,d)}minPost(){return aT.MIN}}class aV extends aU{static get __EMPTY_NODE(){return b}static set __EMPTY_NODE(a){b=a}compare(a,b){return T(a.name,b.name)}isDefinedOn(a){throw(0,r.assertionError)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,b){return!1}minPost(){return aT.MIN}maxPost(){return new aT(S,b)}makePost(a,c){return(0,r.assert)("string"==typeof a,"KeyIndex indexValue must always be a string."),new aT(a,b)}toString(){return".key"}}let aW=new aV;class aX{constructor(a,b,c,d,e=null){this.isReverse_=d,this.resultGenerator_=e,this.nodeStack_=[];let f=1;for(;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),f<0)a=this.isReverse_?a.left:a.right;else if(0===f){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}getNext(){let a;if(0===this.nodeStack_.length)return null;let b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class aY{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:aY.RED,this.left=null!=d?d:aZ.EMPTY_NODE,this.right=null!=e?e:aZ.EMPTY_NODE}copy(a,b,c,d,e){return new aY(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp_()}removeMin_(){if(this.left.isEmpty())return aZ.EMPTY_NODE;let a=this;return a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),(a=a.copy(null,null,null,a.left.removeMin_(),null)).fixUp_()}remove(a,b){let c,d;if(c=this,0>b(a,c.key))c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key))if(c.right.isEmpty())return aZ.EMPTY_NODE;else d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_());c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight_())).rotateLeft_()).colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=(a=a.rotateRight_()).colorFlip_()),a}rotateLeft_(){let a=this.copy(null,null,aY.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){let a=this.copy(null,null,aY.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let a=this.left.check_();if(a===this.right.check_())return a+ +!this.isRed_();throw Error("Black depths differ")}}aY.RED=!0,aY.BLACK=!1;class aZ{constructor(a,b=aZ.EMPTY_NODE){this.comparator_=a,this.root_=b}insert(a,b){return new aZ(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,aY.BLACK,null,null))}remove(a){return new aZ(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,aY.BLACK,null,null))}get(a){let b,c=this.root_;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))return c.value;b<0?c=c.left:b>0&&(c=c.right)}return null}getPredecessorKey(a){let b,c=this.root_,d=null;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))if(c.left.isEmpty())if(d)return d.key;else return null;else{for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}b<0?c=c.left:b>0&&(d=c,c=c.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new aX(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,b){return new aX(this.root_,a,this.comparator_,!1,b)}getReverseIteratorFrom(a,b){return new aX(this.root_,a,this.comparator_,!0,b)}getReverseIterator(a){return new aX(this.root_,null,this.comparator_,!0,a)}}function a$(a,b){return T(a.name,b.name)}function a_(a,b){return T(a,b)}aZ.EMPTY_NODE=new class{copy(a,b,c,d,e){return this}insert(a,b,c){return new aY(a,b,null)}remove(a,b){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let a0=function(a){return"number"==typeof a?"number:"+Z(a):"string:"+a},a1=function(a){if(a.isLeafNode()){let b=a.val();(0,r.assert)("string"==typeof b||"number"==typeof b||"object"==typeof b&&(0,r.contains)(b,".sv"),"Priority must be a string or number.")}else(0,r.assert)(a===c||a.isEmpty(),"priority of unexpected type.");(0,r.assert)(a===c||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class a2{static set __childrenNodeConstructor(a){d=a}static get __childrenNodeConstructor(){return d}constructor(a,b=a2.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=b,this.lazyHash_=null,(0,r.assert)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),a1(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new a2(this.value_,a)}getImmediateChild(a){return".priority"===a?this.priorityNode_:a2.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return aJ(a)?this:".priority"===aC(a)?this.priorityNode_:a2.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,b){return null}updateImmediateChild(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:a2.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)}updateChild(a,b){let c=aC(a);return null===c?b:b.isEmpty()&&".priority"!==c?this:((0,r.assert)(".priority"!==c||1===aD(a),".priority must be the last token in a path"),this.updateImmediateChild(c,a2.__childrenNodeConstructor.EMPTY_NODE.updateChild(aE(a),b)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,b){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+a0(this.priorityNode_.val())+":");let b=typeof this.value_;a+=b+":","number"===b?a+=Z(this.value_):a+=this.value_,this.lazyHash_=E(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===a2.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof a2.__childrenNodeConstructor?-1:((0,r.assert)(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){let b=typeof a.value_,c=typeof this.value_,d=a2.VALUE_TYPE_ORDER.indexOf(b),e=a2.VALUE_TYPE_ORDER.indexOf(c);return((0,r.assert)(d>=0,"Unknown leaf type: "+b),(0,r.assert)(e>=0,"Unknown leaf type: "+c),d!==e)?e-d:"object"===c?0:this.value_<a.value_?-1:1*(this.value_!==a.value_)}withIndex(){return this}isIndexed(){return!0}equals(a){return a===this||!!a.isLeafNode()&&this.value_===a.value_&&this.priorityNode_.equals(a.priorityNode_)}}a2.VALUE_TYPE_ORDER=["object","boolean","number","string"];let a3=new class extends aU{compare(a,b){let c=a.node.getPriority(),d=b.node.getPriority(),e=c.compareTo(d);return 0===e?T(a.name,b.name):e}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,b){return!a.getPriority().equals(b.getPriority())}minPost(){return aT.MIN}maxPost(){return new aT(S,new a2("[PRIORITY-POST]",f))}makePost(a,b){return new aT(b,new a2("[PRIORITY-POST]",e(a)))}toString(){return".priority"}},a4=Math.log(2);class a5{constructor(a){this.count=parseInt(Math.log(a+1)/a4,10),this.current_=this.count-1;const b=parseInt(Array(this.count+1).join("1"),2);this.bits_=a+1&b}nextBitIsOne(){let a=!(this.bits_&1<<this.current_);return this.current_--,a}}let a6=function(a,b,c,d){a.sort(b);let e=function(b,d){let f,g=d-b;if(0===g)return null;if(1===g)return f=a[b],new aY(c?c(f):f,f.node,aY.BLACK,null,null);{let h=parseInt(g/2,10)+b,i=e(b,h),j=e(h+1,d);return f=a[h],new aY(c?c(f):f,f.node,aY.BLACK,i,j)}};return new aZ(d||b,function(b){let d=null,f=null,g=a.length,h=function(b,d){let f=g-b,h=g;g-=b;let j=e(f+1,h),k=a[f];i(new aY(c?c(k):k,k.node,d,null,j))},i=function(a){d?d.left=a:f=a,d=a};for(let a=0;a<b.count;++a){let c=b.nextBitIsOne(),d=Math.pow(2,b.count-(a+1));c?h(d,aY.BLACK):(h(d,aY.BLACK),h(d,aY.RED))}return f}(new a5(a.length)))},a7={};class a8{static get Default(){return(0,r.assert)(a7&&a3,"ChildrenNode.ts has not been loaded"),g=g||new a8({".priority":a7},{".priority":a3})}constructor(a,b){this.indexes_=a,this.indexSet_=b}get(a){let b=(0,r.safeGet)(this.indexes_,a);if(!b)throw Error("No index defined for "+a);return b instanceof aZ?b:null}hasIndex(a){return(0,r.contains)(this.indexSet_,a.toString())}addIndex(a,b){let c;(0,r.assert)(a!==aW,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let d=[],e=!1,f=b.getIterator(aT.Wrap),g=f.getNext();for(;g;)e=e||a.isDefinedOn(g.node),d.push(g),g=f.getNext();c=e?a6(d,a.getCompare()):a7;let h=a.toString(),i={...this.indexSet_};i[h]=a;let j={...this.indexes_};return j[h]=c,new a8(j,i)}addToIndexes(a,b){return new a8((0,r.map)(this.indexes_,(c,d)=>{let e=(0,r.safeGet)(this.indexSet_,d);if((0,r.assert)(e,"Missing index implementation for "+d),c===a7)if(!e.isDefinedOn(a.node))return a7;else{let c=[],d=b.getIterator(aT.Wrap),f=d.getNext();for(;f;)f.name!==a.name&&c.push(f),f=d.getNext();return c.push(a),a6(c,e.getCompare())}{let d=b.get(a.name),e=c;return d&&(e=e.remove(new aT(a.name,d))),e.insert(a,a.node)}}),this.indexSet_)}removeFromIndexes(a,b){return new a8((0,r.map)(this.indexes_,c=>{if(c===a7)return c;{let d=b.get(a.name);return d?c.remove(new aT(a.name,d)):c}}),this.indexSet_)}}class a9{static get EMPTY_NODE(){return h||(h=new a9(new aZ(a_),null,a8.Default))}constructor(a,b,c){this.children_=a,this.priorityNode_=b,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&a1(this.priorityNode_),this.children_.isEmpty()&&(0,r.assert)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(a){return this.children_.isEmpty()?this:new a9(this.children_,a,this.indexMap_)}getImmediateChild(a){if(".priority"===a)return this.getPriority();{let b=this.children_.get(a);return null===b?h:b}}getChild(a){let b=aC(a);return null===b?this:this.getImmediateChild(b).getChild(aE(a))}hasChild(a){return null!==this.children_.get(a)}updateImmediateChild(a,b){if((0,r.assert)(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);{let c,d,e=new aT(a,b);b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_));let f=c.isEmpty()?h:this.priorityNode_;return new a9(c,f,d)}}updateChild(a,b){let c=aC(a);if(null===c)return b;{(0,r.assert)(".priority"!==aC(a)||1===aD(a),".priority must be the last token in a path");let d=this.getImmediateChild(c).updateChild(aE(a),b);return this.updateImmediateChild(c,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;let b={},c=0,d=0,e=!0;if(this.forEachChild(a3,(f,g)=>{b[f]=g.val(a),c++,e&&a9.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),a||!e||!(d<2*c))return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b;{let a=[];for(let c in b)a[c]=b[c];return a}}hash(){if(null===this.lazyHash_){let a="";this.getPriority().isEmpty()||(a+="priority:"+a0(this.getPriority().val())+":"),this.forEachChild(a3,(b,c)=>{let d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":E(a)}return this.lazyHash_}getPredecessorChildName(a,b,c){let d=this.resolveIndex_(c);if(!d)return this.children_.getPredecessorKey(a);{let c=d.getPredecessorKey(new aT(a,b));return c?c.name:null}}getFirstChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.minKey();{let a=b.minKey();return a&&a.name}}getFirstChild(a){let b=this.getFirstChildName(a);return b?new aT(b,this.children_.get(b)):null}getLastChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.maxKey();{let a=b.maxKey();return a&&a.name}}getLastChild(a){let b=this.getLastChildName(a);return b?new aT(b,this.children_.get(b)):null}forEachChild(a,b){let c=this.resolveIndex_(a);return c?c.inorderTraversal(a=>b(a.name,a.node)):this.children_.inorderTraversal(b)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,a=>a);{let c=this.children_.getIteratorFrom(a.name,aT.Wrap),d=c.peek();for(;null!=d&&0>b.compare(d,a);)c.getNext(),d=c.peek();return c}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,a=>a);{let c=this.children_.getReverseIteratorFrom(a.name,aT.Wrap),d=c.peek();for(;null!=d&&b.compare(d,a)>0;)c.getNext(),d=c.peek();return c}}compareTo(a){if(this.isEmpty())if(a.isEmpty())return 0;else return -1;return a.isLeafNode()||a.isEmpty()?1:a===ba?-1:0}withIndex(a){if(a===aW||this.indexMap_.hasIndex(a))return this;{let b=this.indexMap_.addIndex(a,this.children_);return new a9(this.children_,this.priorityNode_,b)}}isIndexed(a){return a===aW||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;if(a.isLeafNode()||!this.getPriority().equals(a.getPriority()))return!1;if(this.children_.count()!==a.children_.count())return!1;{let b=this.getIterator(a3),c=a.getIterator(a3),d=b.getNext(),e=c.getNext();for(;d&&e;){if(d.name!==e.name||!d.node.equals(e.node))return!1;d=b.getNext(),e=c.getNext()}return null===d&&null===e}}resolveIndex_(a){return a===aW?null:this.indexMap_.get(a.toString())}}a9.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let ba=new class extends a9{constructor(){super(new aZ(a_),a9.EMPTY_NODE,a8.Default)}compareTo(a){return+(a!==this)}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return a9.EMPTY_NODE}isEmpty(){return!1}};function bb(a,b=null){if(null===a)return a9.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(b=a[".priority"]),(0,r.assert)(null===b||"string"==typeof b||"number"==typeof b||"object"==typeof b&&".sv"in b,"Invalid priority type found: "+typeof b),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new a2(a,bb(b));if(a instanceof Array){let c=a9.EMPTY_NODE;return Y(a,(b,d)=>{if((0,r.contains)(a,b)&&"."!==b.substring(0,1)){let a=bb(d);(a.isLeafNode()||!a.isEmpty())&&(c=c.updateImmediateChild(b,a))}}),c.updatePriority(bb(b))}{let c=[],d=!1;if(Y(a,(a,b)=>{if("."!==a.substring(0,1)){let e=bb(b);e.isEmpty()||(d=d||!e.getPriority().isEmpty(),c.push(new aT(a,e)))}}),0===c.length)return a9.EMPTY_NODE;let e=a6(c,a$,a=>a.name,a_);if(!d)return new a9(e,bb(b),a8.Default);{let a=a6(c,a3.getCompare());return new a9(e,bb(b),new a8({".priority":a},{".priority":a3}))}}}Object.defineProperties(aT,{MIN:{value:new aT(R,a9.EMPTY_NODE)},MAX:{value:new aT(S,ba)}}),aV.__EMPTY_NODE=a9.EMPTY_NODE,a2.__childrenNodeConstructor=a9,c=ba,f=ba,e=bb;class bc extends aU{constructor(a){super(),this.indexPath_=a,(0,r.assert)(!aJ(a)&&".priority"!==aC(a),"Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,b){let c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?T(a.name,b.name):e}makePost(a,b){let c=bb(a);return new aT(b,a9.EMPTY_NODE.updateChild(this.indexPath_,c))}maxPost(){return new aT(S,a9.EMPTY_NODE.updateChild(this.indexPath_,ba))}toString(){return aG(this.indexPath_,0).join("/")}}let bd=new class extends aU{compare(a,b){let c=a.node.compareTo(b.node);return 0===c?T(a.name,b.name):c}isDefinedOn(a){return!0}indexedValueChanged(a,b){return!a.equals(b)}minPost(){return aT.MIN}maxPost(){return aT.MAX}makePost(a,b){return new aT(b,bb(a))}toString(){return".value"}};function be(a){return{type:"value",snapshotNode:a}}function bf(a,b){return{type:"child_added",snapshotNode:b,childName:a}}function bg(a,b){return{type:"child_removed",snapshotNode:b,childName:a}}function bh(a,b,c){return{type:"child_changed",snapshotNode:b,childName:a,oldSnap:c}}class bi{constructor(a){this.index_=a}updateChild(a,b,c,d,e,f){(0,r.assert)(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");let g=a.getImmediateChild(b);return g.getChild(d).equals(c.getChild(d))&&g.isEmpty()===c.isEmpty()||(null!=f&&(c.isEmpty()?a.hasChild(b)?f.trackChildChange(bg(b,g)):(0,r.assert)(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):g.isEmpty()?f.trackChildChange(bf(b,c)):f.trackChildChange(bh(b,c,g))),a.isLeafNode()&&c.isEmpty())?a:a.updateImmediateChild(b,c).withIndex(this.index_)}updateFullNode(a,b,c){return null!=c&&(a.isLeafNode()||a.forEachChild(a3,(a,d)=>{b.hasChild(a)||c.trackChildChange(bg(a,d))}),b.isLeafNode()||b.forEachChild(a3,(b,d)=>{if(a.hasChild(b)){let e=a.getImmediateChild(b);e.equals(d)||c.trackChildChange(bh(b,d,e))}else c.trackChildChange(bf(b,d))})),b.withIndex(this.index_)}updatePriority(a,b){return a.isEmpty()?a9.EMPTY_NODE:a.updatePriority(b)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class bj{constructor(a){this.indexedFilter_=new bi(a.getIndex()),this.index_=a.getIndex(),this.startPost_=bj.getStartPost_(a),this.endPost_=bj.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){let b=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),a):0>this.index_.compare(this.getStartPost(),a),c=this.endIsInclusive_?0>=this.index_.compare(a,this.getEndPost()):0>this.index_.compare(a,this.getEndPost());return b&&c}updateChild(a,b,c,d,e,f){return this.matches(new aT(b,c))||(c=a9.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e,f)}updateFullNode(a,b,c){b.isLeafNode()&&(b=a9.EMPTY_NODE);let d=b.withIndex(this.index_);d=d.updatePriority(a9.EMPTY_NODE);let e=this;return b.forEachChild(a3,(a,b)=>{e.matches(new aT(a,b))||(d=d.updateImmediateChild(a,a9.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(!a.hasStart())return a.getIndex().minPost();{let b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}}static getEndPost_(a){if(!a.hasEnd())return a.getIndex().maxPost();{let b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}}}class bk{constructor(a){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{let b=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?b<=0:b<0},this.withinEndPost=a=>{let b=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?b<=0:b<0},this.rangedFilter_=new bj(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,b,c,d,e,f){return(this.rangedFilter_.matches(new aT(b,c))||(c=a9.EMPTY_NODE),a.getImmediateChild(b).equals(c))?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e,f):this.fullLimitUpdateChild_(a,b,c,e,f)}updateFullNode(a,b,c){let d;if(b.isLeafNode()||b.isEmpty())d=a9.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){let a;d=a9.EMPTY_NODE.withIndex(this.index_),a=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;a.hasNext()&&c<this.limit_;){let b=a.getNext();if(this.withinDirectionalStart(b))if(this.withinDirectionalEnd(b))d=d.updateImmediateChild(b.name,b.node),c++;else break}}else{let a;d=(d=b.withIndex(this.index_)).updatePriority(a9.EMPTY_NODE),a=this.reverse_?d.getReverseIterator(this.index_):d.getIterator(this.index_);let c=0;for(;a.hasNext();){let b=a.getNext();c<this.limit_&&this.withinDirectionalStart(b)&&this.withinDirectionalEnd(b)?c++:d=d.updateImmediateChild(b.name,a9.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,b,c,d,e){let f;if(this.reverse_){let a=this.index_.getCompare();f=(b,c)=>a(c,b)}else f=this.index_.getCompare();(0,r.assert)(a.numChildren()===this.limit_,"");let g=new aT(b,c),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),i=this.rangedFilter_.matches(g);if(a.hasChild(b)){let j=a.getImmediateChild(b),k=d.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=k&&(k.name===b||a.hasChild(k.name));)k=d.getChildAfterChild(this.index_,k,this.reverse_);let l=null==k?1:f(k,g);if(i&&!c.isEmpty()&&l>=0)return null!=e&&e.trackChildChange(bh(b,c,j)),a.updateImmediateChild(b,c);{null!=e&&e.trackChildChange(bg(b,j));let c=a.updateImmediateChild(b,a9.EMPTY_NODE);return null!=k&&this.rangedFilter_.matches(k)?(null!=e&&e.trackChildChange(bf(k.name,k.node)),c.updateImmediateChild(k.name,k.node)):c}}return c.isEmpty()?a:i?f(h,g)>=0?(null!=e&&(e.trackChildChange(bg(h.name,h.node)),e.trackChildChange(bf(b,c))),a.updateImmediateChild(b,c).updateImmediateChild(h.name,a9.EMPTY_NODE)):a:a}}class bl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=a3}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,r.assert)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,r.assert)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:R}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,r.assert)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,r.assert)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:S}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,r.assert)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===a3}copy(){let a=new bl;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function bm(a,b,c){let d=a.copy();return d.startSet_=!0,void 0===b&&(b=null),d.indexStartValue_=b,null!=c?(d.startNameSet_=!0,d.indexStartName_=c):(d.startNameSet_=!1,d.indexStartName_=""),d}function bn(a,b,c){let d=a.copy();return d.endSet_=!0,void 0===b&&(b=null),d.indexEndValue_=b,void 0!==c?(d.endNameSet_=!0,d.indexEndName_=c):(d.endNameSet_=!1,d.indexEndName_=""),d}function bo(a,b){let c=a.copy();return c.index_=b,c}function bp(a){let b,c={};if(a.isDefault())return c;if(a.index_===a3?b="$priority":a.index_===bd?b="$value":a.index_===aW?b="$key":((0,r.assert)(a.index_ instanceof bc,"Unrecognized index type!"),b=a.index_.toString()),c.orderBy=(0,r.stringify)(b),a.startSet_){let b=a.startAfterSet_?"startAfter":"startAt";c[b]=(0,r.stringify)(a.indexStartValue_),a.startNameSet_&&(c[b]+=","+(0,r.stringify)(a.indexStartName_))}if(a.endSet_){let b=a.endBeforeSet_?"endBefore":"endAt";c[b]=(0,r.stringify)(a.indexEndValue_),a.endNameSet_&&(c[b]+=","+(0,r.stringify)(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?c.limitToFirst=a.limit_:c.limitToLast=a.limit_),c}function bq(a){let b={};if(a.startSet_&&(b.sp=a.indexStartValue_,a.startNameSet_&&(b.sn=a.indexStartName_),b.sin=!a.startAfterSet_),a.endSet_&&(b.ep=a.indexEndValue_,a.endNameSet_&&(b.en=a.indexEndName_),b.ein=!a.endBeforeSet_),a.limitSet_){b.l=a.limit_;let c=a.viewFrom_;""===c&&(c=a.isViewFromLeft()?"l":"r"),b.vf=c}return a.index_!==a3&&(b.i=a.index_.toString()),b}class br extends ax{reportStats(a){throw Error("Method not implemented.")}static getListenId_(a,b){return void 0!==b?"tag$"+b:((0,r.assert)(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,b,c,d){super(),this.repoInfo_=a,this.onDataUpdate_=b,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.log_=K("p:rest:"),this.listens_={}}listen(a,b,c,d){let e=a._path.toString();this.log_("Listen called for "+e+" "+a._queryIdentifier);let f=br.getListenId_(a,c),g={};this.listens_[f]=g;let h=bp(a._queryParams);this.restRequest_(e+".json",h,(a,b)=>{let h=b;(404===a&&(h=null,a=null),null===a&&this.onDataUpdate_(e,h,!1,c),(0,r.safeGet)(this.listens_,f)===g)&&d(a?401===a?"permission_denied":"rest_error:"+a:"ok",null)})}unlisten(a,b){let c=br.getListenId_(a,b);delete this.listens_[c]}get(a){let b=bp(a._queryParams),c=a._path.toString(),d=new r.Deferred;return this.restRequest_(c+".json",b,(a,b)=>{let e=b;404===a&&(e=null,a=null),null===a?(this.onDataUpdate_(c,e,!1,null),d.resolve(e)):d.reject(Error(e))}),d.promise}refreshAuthToken(a){}restRequest_(a,b={},c){return b.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,e])=>{d&&d.accessToken&&(b.auth=d.accessToken),e&&e.token&&(b.ac=e.token);let f=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+(0,r.querystring)(b);this.log_("Sending REST request for "+f);let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(c&&4===g.readyState){this.log_("REST Response for "+f+" received. status:",g.status,"response:",g.responseText);let a=null;if(g.status>=200&&g.status<300){try{a=(0,r.jsonEval)(g.responseText)}catch(a){N("Failed to parse JSON response for "+f+": "+g.responseText)}c(null,a)}else 401!==g.status&&404!==g.status&&N("Got unsuccessful REST response for "+f+" Status: "+g.status),c(g.status);c=null}},g.open("GET",f,!0),g.send()})}}class bs{constructor(){this.rootNode_=a9.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)}}function bt(){return{value:null,children:new Map}}function bu(a,b,c){if(aJ(b))a.value=c,a.children.clear();else if(null!==a.value)a.value=a.value.updateChild(b,c);else{let d=aC(b);a.children.has(d)||a.children.set(d,bt()),bu(a.children.get(d),b=aE(b),c)}}function bv(a,b,c){var d,e;null!==a.value?c(b,a.value):(d=a,e=(a,d)=>{bv(d,new aA(b.toString()+"/"+a),c)},d.children.forEach((a,b)=>{e(b,a)}))}class bw{constructor(a){this.collection_=a,this.last_=null}get(){let a=this.collection_.get(),b={...a};return this.last_&&Y(this.last_,(a,c)=>{b[a]=b[a]-c}),this.last_=a,b}}class bx{constructor(a,b){this.server_=b,this.statsToReport_={},this.statsListener_=new bw(a);const c=1e4+2e4*Math.random();ab(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){let a=this.statsListener_.get(),b={},c=!1;Y(a,(a,d)=>{d>0&&(0,r.contains)(this.statsToReport_,a)&&(b[a]=d,c=!0)}),c&&this.server_.reportStats(b),ab(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function by(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function bz(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function bA(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}(o=p||(p={}))[o.OVERWRITE=0]="OVERWRITE",o[o.MERGE=1]="MERGE",o[o.ACK_USER_WRITE=2]="ACK_USER_WRITE",o[o.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class bB{constructor(a,b,c){this.path=a,this.affectedTree=b,this.revert=c,this.type=p.ACK_USER_WRITE,this.source=by()}operationForChild(a){if(!aJ(this.path))return(0,r.assert)(aC(this.path)===a,"operationForChild called for unrelated child."),new bB(aE(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,r.assert)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let b=this.affectedTree.subtree(new aA(a));return new bB(aB(),b,this.revert)}}}class bC{constructor(a,b){this.source=a,this.path=b,this.type=p.LISTEN_COMPLETE}operationForChild(a){return aJ(this.path)?new bC(this.source,aB()):new bC(this.source,aE(this.path))}}class bD{constructor(a,b,c){this.source=a,this.path=b,this.snap=c,this.type=p.OVERWRITE}operationForChild(a){return aJ(this.path)?new bD(this.source,aB(),this.snap.getImmediateChild(a)):new bD(this.source,aE(this.path),this.snap)}}class bE{constructor(a,b,c){this.source=a,this.path=b,this.children=c,this.type=p.MERGE}operationForChild(a){if(!aJ(this.path))return(0,r.assert)(aC(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new bE(this.source,aE(this.path),this.children);{let b=this.children.subtree(new aA(a));return b.isEmpty()?null:b.value?new bD(this.source,aB(),b.value):new bE(this.source,aB(),b)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class bF{constructor(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(aJ(a))return this.isFullyInitialized()&&!this.filtered_;let b=aC(a);return this.isCompleteForChild(b)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}class bG{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function bH(a,b,c,d,e,f){let g=d.filter(a=>a.type===c);g.sort((b,c)=>(function(a,b,c){if(null==b.childName||null==c.childName)throw(0,r.assertionError)("Should only compare child_ events.");let d=new aT(b.childName,b.snapshotNode),e=new aT(c.childName,c.snapshotNode);return a.index_.compare(d,e)})(a,b,c)),g.forEach(c=>{var d,g,h;let i=(d=a,g=c,h=f,"value"===g.type||"child_removed"===g.type||(g.prevName=h.getPredecessorChildName(g.childName,g.snapshotNode,d.index_)),g);e.forEach(d=>{d.respondsTo(c.type)&&b.push(d.createEvent(i,a.query_))})})}function bI(a,b){return{eventCache:a,serverCache:b}}function bJ(a,b,c,d){return bI(new bF(b,c,d),a.serverCache)}function bK(a,b,c,d){return bI(a.eventCache,new bF(b,c,d))}function bL(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function bM(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}class bN{static fromObject(a){let b=new bN(null);return Y(a,(a,c)=>{b=b.set(new aA(a),c)}),b}constructor(a,b=(!i&&(i=new aZ(U)),i)){this.value=a,this.children=b}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,b){if(null!=this.value&&b(this.value))return{path:aB(),value:this.value};{if(aJ(a))return null;let c=aC(a),d=this.children.get(c);if(null===d)return null;{let e=d.findRootMostMatchingPathAndValue(aE(a),b);return null!=e?{path:aI(new aA(c),e.path),value:e.value}:null}}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(aJ(a))return this;{let b=aC(a),c=this.children.get(b);return null!==c?c.subtree(aE(a)):new bN(null)}}set(a,b){if(aJ(a))return new bN(b,this.children);{let c=aC(a),d=(this.children.get(c)||new bN(null)).set(aE(a),b),e=this.children.insert(c,d);return new bN(this.value,e)}}remove(a){if(aJ(a))if(this.children.isEmpty())return new bN(null);else return new bN(null,this.children);{let b=aC(a),c=this.children.get(b);if(!c)return this;{let d,e=c.remove(aE(a));return(d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty())?new bN(null):new bN(this.value,d)}}}get(a){if(aJ(a))return this.value;{let b=aC(a),c=this.children.get(b);return c?c.get(aE(a)):null}}setTree(a,b){if(aJ(a))return b;{let c,d=aC(a),e=(this.children.get(d)||new bN(null)).setTree(aE(a),b);return c=e.isEmpty()?this.children.remove(d):this.children.insert(d,e),new bN(this.value,c)}}fold(a){return this.fold_(aB(),a)}fold_(a,b){let c={};return this.children.inorderTraversal((d,e)=>{c[d]=e.fold_(aI(a,d),b)}),b(a,this.value,c)}findOnPath(a,b){return this.findOnPath_(a,aB(),b)}findOnPath_(a,b,c){let d=!!this.value&&c(b,this.value);if(d)return d;{if(aJ(a))return null;let d=aC(a),e=this.children.get(d);return e?e.findOnPath_(aE(a),aI(b,d),c):null}}foreachOnPath(a,b){return this.foreachOnPath_(a,aB(),b)}foreachOnPath_(a,b,c){if(aJ(a))return this;{this.value&&c(b,this.value);let d=aC(a),e=this.children.get(d);return e?e.foreachOnPath_(aE(a),aI(b,d),c):new bN(null)}}foreach(a){this.foreach_(aB(),a)}foreach_(a,b){this.children.inorderTraversal((c,d)=>{d.foreach_(aI(a,c),b)}),this.value&&b(a,this.value)}foreachChild(a){this.children.inorderTraversal((b,c)=>{c.value&&a(b,c.value)})}}class bO{constructor(a){this.writeTree_=a}static empty(){return new bO(new bN(null))}}function bP(a,b,c){if(aJ(b))return new bO(new bN(c));{let d=a.writeTree_.findRootMostValueAndPath(b);if(null!=d){let e=d.path,f=d.value,g=aK(e,b);return f=f.updateChild(g,c),new bO(a.writeTree_.set(e,f))}{let d=new bN(c);return new bO(a.writeTree_.setTree(b,d))}}}function bQ(a,b,c){let d=a;return Y(c,(a,c)=>{d=bP(d,aI(b,a),c)}),d}function bR(a,b){return aJ(b)?bO.empty():new bO(a.writeTree_.setTree(b,new bN(null)))}function bS(a,b){return null!=bT(a,b)}function bT(a,b){let c=a.writeTree_.findRootMostValueAndPath(b);return null!=c?a.writeTree_.get(c.path).getChild(aK(c.path,b)):null}function bU(a){let b=[],c=a.writeTree_.value;return null!=c?c.isLeafNode()||c.forEachChild(a3,(a,c)=>{b.push(new aT(a,c))}):a.writeTree_.children.inorderTraversal((a,c)=>{null!=c.value&&b.push(new aT(a,c.value))}),b}function bV(a,b){if(aJ(b))return a;{let c=bT(a,b);return new bO(null!=c?new bN(c):a.writeTree_.subtree(b))}}function bW(a){return a.writeTree_.isEmpty()}function bX(a,b){return function a(b,c,d){if(null!=c.value)return d.updateChild(b,c.value);{let e=null;return c.children.inorderTraversal((c,f)=>{".priority"===c?((0,r.assert)(null!==f.value,"Priority writes must always be leaf nodes"),e=f.value):d=a(aI(b,c),f,d)}),d.getChild(b).isEmpty()||null===e||(d=d.updateChild(aI(b,".priority"),e)),d}}(aB(),a.writeTree_,b)}function bY(a){return a.visible}function bZ(a,b,c){let d=bO.empty();for(let e=0;e<a.length;++e){let f=a[e];if(b(f)){let a,b=f.path;if(f.snap)aN(c,b)?d=bP(d,a=aK(c,b),f.snap):aN(b,c)&&(a=aK(b,c),d=bP(d,aB(),f.snap.getChild(a)));else if(f.children){if(aN(c,b))d=bQ(d,a=aK(c,b),f.children);else if(aN(b,c))if(aJ(a=aK(b,c)))d=bQ(d,aB(),f.children);else{let b=(0,r.safeGet)(f.children,aC(a));if(b){let c=b.getChild(aE(a));d=bP(d,aB(),c)}}}else throw(0,r.assertionError)("WriteRecord should have .snap or .children")}}return d}function b$(a,b,c,d,e){if(d||e){let f=bV(a.visibleWrites,b);return!e&&bW(f)?c:e||null!=c||bS(f,aB())?bX(bZ(a.allWrites,function(a){return(a.visible||e)&&(!d||!~d.indexOf(a.writeId))&&(aN(a.path,b)||aN(b,a.path))},b),c||a9.EMPTY_NODE):null}{let d=bT(a.visibleWrites,b);if(null!=d)return d;{let d=bV(a.visibleWrites,b);return bW(d)?c:null!=c||bS(d,aB())?bX(d,c||a9.EMPTY_NODE):null}}}function b_(a,b,c,d){return b$(a.writeTree,a.treePath,b,c,d)}function b0(a,b){return function(a,b,c){let d=a9.EMPTY_NODE,e=bT(a.visibleWrites,b);if(e)return e.isLeafNode()||e.forEachChild(a3,(a,b)=>{d=d.updateImmediateChild(a,b)}),d;if(!c)return bU(bV(a.visibleWrites,b)).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d;{let e=bV(a.visibleWrites,b);return c.forEachChild(a3,(a,b)=>{let c=bX(bV(e,new aA(a)),b);d=d.updateImmediateChild(a,c)}),bU(e).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d}}(a.writeTree,a.treePath,b)}function b1(a,b,c,d){return function(a,b,c,d,e){(0,r.assert)(d||e,"Either existingEventSnap or existingServerSnap must exist");let f=aI(b,c);if(bS(a.visibleWrites,f))return null;{let b=bV(a.visibleWrites,f);return bW(b)?e.getChild(c):bX(b,e.getChild(c))}}(a.writeTree,a.treePath,b,c,d)}function b2(a,b){var c,d;return c=a.writeTree,d=aI(a.treePath,b),bT(c.visibleWrites,d)}function b3(a,b,c){var d,e;let f,g;return d=a.writeTree,e=a.treePath,f=aI(e,b),null!=(g=bT(d.visibleWrites,f))?g:c.isCompleteForChild(b)?bX(bV(d.visibleWrites,f),c.getNode().getImmediateChild(b)):null}function b4(a,b){return b5(aI(a.treePath,b),a.writeTree)}function b5(a,b){return{treePath:a,writeTree:b}}class b6{constructor(){this.changeMap=new Map}trackChildChange(a){let b=a.type,c=a.childName;(0,r.assert)("child_added"===b||"child_changed"===b||"child_removed"===b,"Only child changes supported for tracking"),(0,r.assert)(".priority"!==c,"Only non-priority child changes can be tracked.");let d=this.changeMap.get(c);if(d){let e=d.type;if("child_added"===b&&"child_removed"===e)this.changeMap.set(c,bh(c,a.snapshotNode,d.snapshotNode));else if("child_removed"===b&&"child_added"===e)this.changeMap.delete(c);else if("child_removed"===b&&"child_changed"===e)this.changeMap.set(c,bg(c,d.oldSnap));else if("child_changed"===b&&"child_added"===e)this.changeMap.set(c,bf(c,a.snapshotNode));else if("child_changed"===b&&"child_changed"===e)this.changeMap.set(c,bh(c,a.snapshotNode,d.oldSnap));else throw(0,r.assertionError)("Illegal combination of changes: "+a+" occurred after "+d)}else this.changeMap.set(c,a)}getChanges(){return Array.from(this.changeMap.values())}}let b7=new class{getCompleteChild(a){return null}getChildAfterChild(a,b,c){return null}};class b8{constructor(a,b,c=null){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c}getCompleteChild(a){let b=this.viewCache_.eventCache;if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);{let b=null!=this.optCompleteServerCache_?new bF(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return b3(this.writes_,a,b)}}getChildAfterChild(a,b,c){var d;let e=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:bM(this.viewCache_),f=(d=this.writes_,function(a,b,c,d,e,f,g){let h,i=bV(a.visibleWrites,b),j=bT(i,aB());if(null!=j)h=j;else{if(null==c)return[];h=bX(i,c)}if((h=h.withIndex(g)).isEmpty()||h.isLeafNode())return[];{let a=[],b=g.getCompare(),c=f?h.getReverseIteratorFrom(d,g):h.getIteratorFrom(d,g),e=c.getNext();for(;e&&a.length<1;)0!==b(e,d)&&a.push(e),e=c.getNext();return a}}(d.writeTree,d.treePath,e,b,1,c,a));return 0===f.length?null:f[0]}}function b9(a,b,c,d,e,f){let g=b.eventCache;if(null!=b2(d,c))return b;{let h,i;if(aJ(c))if((0,r.assert)(b.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),b.serverCache.isFiltered()){let c=bM(b),e=b0(d,c instanceof a9?c:a9.EMPTY_NODE);h=a.filter.updateFullNode(b.eventCache.getNode(),e,f)}else{let c=b_(d,bM(b));h=a.filter.updateFullNode(b.eventCache.getNode(),c,f)}else{let j=aC(c);if(".priority"===j){(0,r.assert)(1===aD(c),"Can't have a priority with additional path components");let e=g.getNode(),f=b1(d,c,e,i=b.serverCache.getNode());h=null!=f?a.filter.updatePriority(e,f):g.getNode()}else{let k,l=aE(c);if(g.isCompleteForChild(j)){i=b.serverCache.getNode();let a=b1(d,c,g.getNode(),i);k=null!=a?g.getNode().getImmediateChild(j).updateChild(l,a):g.getNode().getImmediateChild(j)}else k=b3(d,j,b.serverCache);h=null!=k?a.filter.updateChild(g.getNode(),j,k,l,e,f):g.getNode()}}return bJ(b,h,g.isFullyInitialized()||aJ(c),a.filter.filtersNodes())}}function ca(a,b,c,d,e,f,g,h){let i,j=b.serverCache,k=g?a.filter:a.filter.getIndexedFilter();if(aJ(c))i=k.updateFullNode(j.getNode(),d,null);else if(k.filtersNodes()&&!j.isFiltered()){let a=j.getNode().updateChild(c,d);i=k.updateFullNode(j.getNode(),a,null)}else{let a=aC(c);if(!j.isCompleteForPath(c)&&aD(c)>1)return b;let e=aE(c),f=j.getNode().getImmediateChild(a).updateChild(e,d);i=".priority"===a?k.updatePriority(j.getNode(),f):k.updateChild(j.getNode(),a,f,e,b7,null)}let l=bK(b,i,j.isFullyInitialized()||aJ(c),k.filtersNodes()),m=new b8(e,l,f);return b9(a,l,c,e,m,h)}function cb(a,b,c,d,e,f,g){let h,i,j=b.eventCache,k=new b8(e,b,f);if(aJ(c))i=a.filter.updateFullNode(b.eventCache.getNode(),d,g),h=bJ(b,i,!0,a.filter.filtersNodes());else{let e=aC(c);if(".priority"===e)i=a.filter.updatePriority(b.eventCache.getNode(),d),h=bJ(b,i,j.isFullyInitialized(),j.isFiltered());else{let f,i=aE(c),l=j.getNode().getImmediateChild(e);if(aJ(i))f=d;else{let a=k.getCompleteChild(e);f=null!=a?".priority"===aF(i)&&a.getChild(aH(i)).isEmpty()?a:a.updateChild(i,d):a9.EMPTY_NODE}h=l.equals(f)?b:bJ(b,a.filter.updateChild(j.getNode(),e,f,i,k,g),j.isFullyInitialized(),a.filter.filtersNodes())}}return h}function cc(a,b){return a.eventCache.isCompleteForChild(b)}function cd(a,b,c){return c.foreach((a,c)=>{b=b.updateChild(a,c)}),b}function ce(a,b,c,d,e,f,g,h){let i;if(b.serverCache.getNode().isEmpty()&&!b.serverCache.isFullyInitialized())return b;let j=b;i=aJ(c)?d:new bN(null).setTree(c,d);let k=b.serverCache.getNode();return i.children.inorderTraversal((c,d)=>{if(k.hasChild(c)){let i=cd(a,b.serverCache.getNode().getImmediateChild(c),d);j=ca(a,j,new aA(c),i,e,f,g,h)}}),i.children.inorderTraversal((c,d)=>{let i=!b.serverCache.isCompleteForChild(c)&&null===d.value;if(!k.hasChild(c)&&!i){let i=cd(a,b.serverCache.getNode().getImmediateChild(c),d);j=ca(a,j,new aA(c),i,e,f,g,h)}}),j}class cf{constructor(a,b){this.query_=a,this.eventRegistrations_=[];const c=this.query_._queryParams,d=new bi(c.getIndex()),e=function(a){return a.loadsAllData()?new bi(a.getIndex()):a.hasLimit()?new bk(a):new bj(a)}(c);this.processor_={filter:e};const f=b.serverCache,g=b.eventCache,h=d.updateFullNode(a9.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(a9.EMPTY_NODE,g.getNode(),null),j=new bF(h,f.isFullyInitialized(),d.filtersNodes()),k=new bF(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=bI(k,j),this.eventGenerator_=new bG(this.query_)}get query(){return this.query_}}function cg(a){return 0===a.eventRegistrations_.length}function ch(a,b,c){let d=[];if(c){(0,r.assert)(null==b,"A cancel should cancel all event registrations.");let e=a.query._path;a.eventRegistrations_.forEach(a=>{let b=a.createCancelEvent(c,e);b&&d.push(b)})}if(b){let c=[];for(let d=0;d<a.eventRegistrations_.length;++d){let e=a.eventRegistrations_[d];if(e.matches(b)){if(b.hasAnyCallback()){c=c.concat(a.eventRegistrations_.slice(d+1));break}}else c.push(e)}a.eventRegistrations_=c}else a.eventRegistrations_=[];return d}function ci(a,b,c,d){var e,f;b.type===p.MERGE&&null!==b.source.queryId&&((0,r.assert)(bM(a.viewCache_),"We should always have a full cache before handling merges"),(0,r.assert)(bL(a.viewCache_),"Missing event cache, even though we have a server cache"));let g=a.viewCache_,h=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,q,s;let t,u,v=new b6;if(c.type===p.OVERWRITE)c.source.fromUser?t=cb(a,b,c.path,c.snap,d,e,v):((0,r.assert)(c.source.fromServer,"Unknown source."),u=c.source.tagged||b.serverCache.isFiltered()&&!aJ(c.path),t=ca(a,b,c.path,c.snap,d,e,u,v));else if(c.type===p.MERGE){let m;c.source.fromUser?(f=a,g=b,h=c.path,i=c.children,j=d,k=e,l=v,m=g,i.foreach((a,b)=>{let c=aI(h,a);cc(g,aC(c))&&(m=cb(f,m,c,b,j,k,l))}),i.foreach((a,b)=>{let c=aI(h,a);cc(g,aC(c))||(m=cb(f,m,c,b,j,k,l))}),t=m):((0,r.assert)(c.source.fromServer,"Unknown source."),u=c.source.tagged||b.serverCache.isFiltered(),t=ce(a,b,c.path,c.children,d,e,u,v))}else if(c.type===p.ACK_USER_WRITE)t=c.revert?function(a,b,c,d,e,f){let g;if(null!=b2(d,c))return b;{let h,i=new b8(d,b,e),j=b.eventCache.getNode();if(aJ(c)||".priority"===aC(c)){let c;if(b.serverCache.isFullyInitialized())c=b_(d,bM(b));else{let a=b.serverCache.getNode();(0,r.assert)(a instanceof a9,"serverChildren would be complete if leaf node"),c=b0(d,a)}h=a.filter.updateFullNode(j,c,f)}else{let e=aC(c),k=b3(d,e,b.serverCache);null==k&&b.serverCache.isCompleteForChild(e)&&(k=j.getImmediateChild(e)),(h=null!=k?a.filter.updateChild(j,e,k,aE(c),i,f):b.eventCache.getNode().hasChild(e)?a.filter.updateChild(j,e,a9.EMPTY_NODE,aE(c),i,f):j).isEmpty()&&b.serverCache.isFullyInitialized()&&(g=b_(d,bM(b))).isLeafNode()&&(h=a.filter.updateFullNode(h,g,f))}return g=b.serverCache.isFullyInitialized()||null!=b2(d,aB()),bJ(b,h,g,a.filter.filtersNodes())}}(a,b,c.path,d,e,v):function(a,b,c,d,e,f,g){if(null!=b2(e,c))return b;let h=b.serverCache.isFiltered(),i=b.serverCache;if(null!=d.value)if(aJ(c)&&i.isFullyInitialized()||i.isCompleteForPath(c))return ca(a,b,c,i.getNode().getChild(c),e,f,h,g);else{if(!aJ(c))return b;let d=new bN(null);return i.getNode().forEachChild(aW,(a,b)=>{d=d.set(new aA(a),b)}),ce(a,b,c,d,e,f,h,g)}{let j=new bN(null);return d.foreach((a,b)=>{let d=aI(c,a);i.isCompleteForPath(d)&&(j=j.set(a,i.getNode().getChild(d)))}),ce(a,b,c,j,e,f,h,g)}}(a,b,c.path,c.affectedTree,d,e,v);else if(c.type===p.LISTEN_COMPLETE){let e;m=a,n=b,o=c.path,q=d,s=v,e=n.serverCache,t=b9(m,bK(n,e.getNode(),e.isFullyInitialized()||aJ(o),e.isFiltered()),o,q,b7,s)}else throw(0,r.assertionError)("Unknown operation type: "+c.type);let w=v.getChanges();return function(a,b,c){let d=b.eventCache;if(d.isFullyInitialized()){let e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=bL(a);!(c.length>0)&&a.eventCache.isFullyInitialized()&&(!e||d.getNode().equals(f))&&d.getNode().getPriority().equals(f.getPriority())||c.push(be(bL(b)))}}(b,t,w),{viewCache:t,changes:w}}(a.processor_,g,b,c,d);return e=a.processor_,f=h.viewCache,(0,r.assert)(f.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),(0,r.assert)(f.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed"),(0,r.assert)(h.viewCache.serverCache.isFullyInitialized()||!g.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=h.viewCache,cj(a,h.changes,h.viewCache.eventCache.getNode(),null)}function cj(a,b,c,d){var e;let f,g,h=d?[d]:a.eventRegistrations_;return e=a.eventGenerator_,f=[],g=[],b.forEach(a=>{var b;"child_changed"===a.type&&e.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&g.push((b=a.childName,{type:"child_moved",snapshotNode:a.snapshotNode,childName:b}))}),bH(e,f,"child_removed",b,h,c),bH(e,f,"child_added",b,h,c),bH(e,f,"child_moved",g,h,c),bH(e,f,"child_changed",b,h,c),bH(e,f,"value",b,h,c),f}class ck{constructor(){this.views=new Map}}function cl(a,b,c,d){let e=b.source.queryId;if(null!==e){let f=a.views.get(e);return(0,r.assert)(null!=f,"SyncTree gave us an op for an invalid query."),ci(f,b,c,d)}{let e=[];for(let f of a.views.values())e=e.concat(ci(f,b,c,d));return e}}function cm(a,b,c,d,e){let f=b._queryIdentifier,g=a.views.get(f);if(!g){let a=b_(c,e?d:null),f=!1;return a?f=!0:(a=d instanceof a9?b0(c,d):a9.EMPTY_NODE,f=!1),new cf(b,bI(new bF(a,f,!1),new bF(d,e,!1)))}return g}function cn(a){let b=[];for(let c of a.views.values())c.query._queryParams.loadsAllData()||b.push(c);return b}function co(a,b){let c=null;for(let d of a.views.values())c=c||function(a,b){let c=bM(a.viewCache_);return c&&(a.query._queryParams.loadsAllData()||!aJ(b)&&!c.getImmediateChild(aC(b)).isEmpty())?c.getChild(b):null}(d,b);return c}function cp(a,b){if(b._queryParams.loadsAllData())return cr(a);{let c=b._queryIdentifier;return a.views.get(c)}}function cq(a){return null!=cr(a)}function cr(a){for(let b of a.views.values())if(b.query._queryParams.loadsAllData())return b;return null}let cs=1;class ct{constructor(a){this.listenProvider_=a,this.syncPointTree_=new bN(null),this.pendingWriteTree_={visibleWrites:bO.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cu(a,b,c,d,e){var f,g;return(f=a.pendingWriteTree_,g=e,(0,r.assert)(d>f.lastWriteId,"Stacking an older write on top of newer ones"),void 0===g&&(g=!0),f.allWrites.push({path:b,snap:c,writeId:d,visible:g}),g&&(f.visibleWrites=bP(f.visibleWrites,b,c)),f.lastWriteId=d,e)?cB(a,new bD(by(),b,c)):[]}function cv(a,b,c=!1){let d=function(a,b){for(let c=0;c<a.allWrites.length;c++){let d=a.allWrites[c];if(d.writeId===b)return d}return null}(a.pendingWriteTree_,b);if(!function(a,b){var c;let d=a.allWrites.findIndex(a=>a.writeId===b);(0,r.assert)(d>=0,"removeWrite called with nonexistent writeId.");let e=a.allWrites[d];a.allWrites.splice(d,1);let f=e.visible,g=!1,h=a.allWrites.length-1;for(;f&&h>=0;){let b=a.allWrites[h];b.visible&&(h>=d&&function(a,b){if(a.snap)return aN(a.path,b);for(let c in a.children)if(a.children.hasOwnProperty(c)&&aN(aI(a.path,c),b))return!0;return!1}(b,e.path)?f=!1:aN(e.path,b.path)&&(g=!0)),h--}return!!f&&(g?((c=a).visibleWrites=bZ(c.allWrites,bY,aB()),c.allWrites.length>0?c.lastWriteId=c.allWrites[c.allWrites.length-1].writeId:c.lastWriteId=-1):e.snap?a.visibleWrites=bR(a.visibleWrites,e.path):Y(e.children,b=>{a.visibleWrites=bR(a.visibleWrites,aI(e.path,b))}),!0)}(a.pendingWriteTree_,b))return[];{let b=new bN(null);return null!=d.snap?b=b.set(aB(),!0):Y(d.children,a=>{b=b.set(new aA(a),!0)}),cB(a,new bB(d.path,b,c))}}function cw(a,b,c){return cB(a,new bD(bz(),b,c))}function cx(a,b,c,d,e=!1){let f=b._path,g=a.syncPointTree_.get(f),h=[];if(g&&("default"===b._queryIdentifier||null!=cp(g,b))){let l=function(a,b,c,d){let e=b._queryIdentifier,f=[],g=[],h=cq(a);if("default"===e)for(let[b,e]of a.views.entries())g=g.concat(ch(e,c,d)),cg(e)&&(a.views.delete(b),e.query._queryParams.loadsAllData()||f.push(e.query));else{let b=a.views.get(e);b&&(g=g.concat(ch(b,c,d)),cg(b)&&(a.views.delete(e),b.query._queryParams.loadsAllData()||f.push(b.query)))}return h&&!cq(a)&&f.push(new((0,r.assert)(j,"Reference.ts has not been loaded"),j)(b._repo,b._path)),{removed:f,events:g}}(g,b,c,d);0===g.views.size&&(a.syncPointTree_=a.syncPointTree_.remove(f));let m=l.removed;if(h=l.events,!e){let c=-1!==m.findIndex(a=>a._queryParams.loadsAllData()),e=a.syncPointTree_.findOnPath(f,(a,b)=>cq(b));if(c&&!e){let b=a.syncPointTree_.subtree(f);if(!b.isEmpty()){let c=b.fold((a,b,c)=>{if(b&&cq(b))return[cr(b)];{let a=[];return b&&(a=cn(b)),Y(c,(b,c)=>{a=a.concat(c)}),a}});for(let b=0;b<c.length;++b){let d=c[b],e=d.query,f=cC(a,d);a.listenProvider_.startListening(cI(e),cD(a,e),f.hashFn,f.onComplete)}}}e||!(m.length>0)||d||(c?a.listenProvider_.stopListening(cI(b),null):m.forEach(b=>{let c=a.queryToTagMap.get(cE(b));a.listenProvider_.stopListening(cI(b),c)}))}var i=a,k=m;for(let a=0;a<k.length;++a){let b=k[a];if(!b._queryParams.loadsAllData()){let a=cE(b),c=i.queryToTagMap.get(a);i.queryToTagMap.delete(a),i.tagToQueryMap.delete(c)}}}return h}function cy(a,b,c,d){let e=cF(a,d);if(null==e)return[];{let d=cG(e),f=d.path,g=d.queryId,h=aK(f,b);return cH(a,f,new bD(bA(g),h,c))}}function cz(a,b,c,d=!1){var e;let f,g,h,i,j=b._path,k=null,l=!1;a.syncPointTree_.foreachOnPath(j,(a,b)=>{let c=aK(a,j);k=k||co(b,c),l=l||cq(b)});let m=a.syncPointTree_.get(j);m?(l=l||cq(m),k=k||co(m,aB())):(m=new ck,a.syncPointTree_=a.syncPointTree_.set(j,m)),null!=k?f=!0:(f=!1,k=a9.EMPTY_NODE,a.syncPointTree_.subtree(j).foreachChild((a,b)=>{let c=co(b,aB());c&&(k=k.updateImmediateChild(a,c))}));let n=null!=cp(m,b);if(!n&&!b._queryParams.loadsAllData()){let c=cE(b);(0,r.assert)(!a.queryToTagMap.has(c),"View does not exist, but we have a tag");let d=cs++;a.queryToTagMap.set(c,d),a.tagToQueryMap.set(d,c)}let o=b5(j,a.pendingWriteTree_),p=(g=cm(e=m,b,o,k,f),e.views.has(b._queryIdentifier)||e.views.set(b._queryIdentifier,g),g.eventRegistrations_.push(c),h=g.viewCache_.eventCache,i=[],h.getNode().isLeafNode()||h.getNode().forEachChild(a3,(a,b)=>{i.push(bf(a,b))}),h.isFullyInitialized()&&i.push(be(h.getNode())),cj(g,i,h.getNode(),c));if(!n&&!l&&!d){let c=cp(m,b);p=p.concat(function(a,b,c){let d=b._path,e=cD(a,b),f=cC(a,c),g=a.listenProvider_.startListening(cI(b),e,f.hashFn,f.onComplete),h=a.syncPointTree_.subtree(d);if(e)(0,r.assert)(!cq(h.value),"If we're adding a query, it shouldn't be shadowed");else{let b=h.fold((a,b,c)=>{if(!aJ(a)&&b&&cq(b))return[cr(b).query];{let a=[];return b&&(a=a.concat(cn(b).map(a=>a.query))),Y(c,(b,c)=>{a=a.concat(c)}),a}});for(let c=0;c<b.length;++c){let d=b[c];a.listenProvider_.stopListening(cI(d),cD(a,d))}}return g}(a,b,c))}return p}function cA(a,b,c){let d=a.pendingWriteTree_,e=a.syncPointTree_.findOnPath(b,(a,c)=>{let d=co(c,aK(a,b));if(d)return d});return b$(d,b,e,c,!0)}function cB(a,b){var c;return function a(b,c,d,e){if(aJ(b.path))return function a(b,c,d,e){let f=c.get(aB());null==d&&null!=f&&(d=co(f,aB()));let g=[];return c.children.inorderTraversal((c,f)=>{let h=d?d.getImmediateChild(c):null,i=b4(e,c),j=b.operationForChild(c);j&&(g=g.concat(a(j,f,h,i)))}),f&&(g=g.concat(cl(f,b,e,d))),g}(b,c,d,e);{let f=c.get(aB());null==d&&null!=f&&(d=co(f,aB()));let g=[],h=aC(b.path),i=b.operationForChild(h),j=c.children.get(h);if(j&&i){let b=d?d.getImmediateChild(h):null,c=b4(e,h);g=g.concat(a(i,j,b,c))}return f&&(g=g.concat(cl(f,b,e,d))),g}}(b,a.syncPointTree_,null,(c=a.pendingWriteTree_,b5(aB(),c)))}function cC(a,b){let c=b.query,d=cD(a,c);return{hashFn:()=>(b.viewCache_.serverCache.getNode()||a9.EMPTY_NODE).hash(),onComplete:b=>{var e;if("ok"===b)if(d)return function(a,b,c){let d=cF(a,c);if(!d)return[];{let c=cG(d),e=c.path,f=c.queryId,g=aK(e,b);return cH(a,e,new bC(bA(f),g))}}(a,c._path,d);else return e=c._path,cB(a,new bC(bz(),e));{let d,e,f=(d="Unknown Error","too_big"===b?d="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===b?d="Client doesn't have permission to access the desired data.":"unavailable"===b&&(d="The service is unavailable"),(e=Error(b+" at "+c._path.toString()+": "+d)).code=b.toUpperCase(),e);return cx(a,c,null,f)}}}}function cD(a,b){let c=cE(b);return a.queryToTagMap.get(c)}function cE(a){return a._path.toString()+"$"+a._queryIdentifier}function cF(a,b){return a.tagToQueryMap.get(b)}function cG(a){let b=a.indexOf("$");return(0,r.assert)(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new aA(a.substr(0,b))}}function cH(a,b,c){let d=a.syncPointTree_.get(b);return(0,r.assert)(d,"Missing sync point for query tag that we're tracking"),cl(d,c,b5(b,a.pendingWriteTree_),null)}function cI(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new((0,r.assert)(k,"Reference.ts has not been loaded"),k)(a._repo,a._path):a}class cJ{constructor(a){this.node_=a}getImmediateChild(a){return new cJ(this.node_.getImmediateChild(a))}node(){return this.node_}}class cK{constructor(a,b){this.syncTree_=a,this.path_=b}getImmediateChild(a){let b=aI(this.path_,a);return new cK(this.syncTree_,b)}node(){return cA(this.syncTree_,this.path_)}}let cL=function(a,b,c){return a&&"object"==typeof a?((0,r.assert)(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"])?cM(a[".sv"],b,c):"object"==typeof a[".sv"]?cN(a[".sv"],b):void(0,r.assert)(!1,"Unexpected server value: "+JSON.stringify(a,null,2)):a},cM=function(a,b,c){if("timestamp"===a)return c.timestamp;(0,r.assert)(!1,"Unexpected server value: "+a)},cN=function(a,b,c){a.hasOwnProperty("increment")||(0,r.assert)(!1,"Unexpected server value: "+JSON.stringify(a,null,2));let d=a.increment;"number"!=typeof d&&(0,r.assert)(!1,"Unexpected increment value: "+d);let e=b.node();if((0,r.assert)(null!=e,"Expected ChildrenNode.EMPTY_NODE for nulls"),!e.isLeafNode())return d;let f=e.getValue();return"number"!=typeof f?d:f+d},cO=function(a,b,c,d){return cQ(b,new cK(c,a),d)},cP=function(a,b,c){return cQ(a,new cJ(b),c)};function cQ(a,b,c){let d,e=cL(a.getPriority().val(),b.getImmediateChild(".priority"),c);if(!a.isLeafNode())return d=a,e!==a.getPriority().val()&&(d=d.updatePriority(new a2(e))),a.forEachChild(a3,(a,e)=>{let f=cQ(e,b.getImmediateChild(a),c);f!==e&&(d=d.updateImmediateChild(a,f))}),d;{let d=cL(a.getValue(),b,c);return d!==a.getValue()||e!==a.getPriority().val()?new a2(d,bb(e)):a}}class cR{constructor(a="",b=null,c={children:{},childCount:0}){this.name=a,this.parent=b,this.node=c}}function cS(a,b){let c=b instanceof aA?b:new aA(b),d=a,e=aC(c);for(;null!==e;){let a=(0,r.safeGet)(d.node.children,e)||{children:{},childCount:0};d=new cR(e,d,a),e=aC(c=aE(c))}return d}function cT(a){return a.node.value}function cU(a,b){a.node.value=b,function a(b){null!==b.parent&&function(b,c,d){let e=void 0===cT(d)&&!cV(d),f=(0,r.contains)(b.node.children,c);e&&f?(delete b.node.children[c],b.node.childCount--,a(b)):e||f||(b.node.children[c]=d.node,b.node.childCount++,a(b))}(b.parent,b.name,b)}(a)}function cV(a){return a.node.childCount>0}function cW(a,b){Y(a.node.children,(c,d)=>{b(new cR(c,a,d))})}function cX(a){return new aA(null===a.parent?a.name:cX(a.parent)+"/"+a.name)}let cY=/[\[\].#$\/\u0000-\u001F\u007F]/,cZ=/[\[\].#$\u0000-\u001F\u007F]/,c$=function(a){return"string"==typeof a&&0!==a.length&&!cY.test(a)},c_=function(a){return"string"==typeof a&&0!==a.length&&!cZ.test(a)},c0=function(a){return null===a||"string"==typeof a||"number"==typeof a&&!P(a)||a&&"object"==typeof a&&(0,r.contains)(a,".sv")},c1=function(a,b,c,d){d&&void 0===b||c2((0,r.errorPrefix)(a,"value"),b,c)},c2=function(a,b,c){let d=c instanceof aA?new aO(c,a):c;if(void 0===b)throw Error(a+"contains undefined "+aQ(d));if("function"==typeof b)throw Error(a+"contains a function "+aQ(d)+" with contents = "+b.toString());if(P(b))throw Error(a+"contains "+b.toString()+" "+aQ(d));if("string"==typeof b&&b.length>3495253.3333333335&&(0,r.stringLength)(b)>0xa00000)throw Error(a+"contains a string greater than 10485760 utf8 bytes "+aQ(d)+" ('"+b.substring(0,50)+"...')");if(b&&"object"==typeof b){let c=!1,e=!1;if(Y(b,(b,f)=>{let g;if(".value"===b)c=!0;else if(".priority"!==b&&".sv"!==b&&(e=!0,!c$(b)))throw Error(a+" contains an invalid key ("+b+") "+aQ(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');d.parts_.length>0&&(d.byteLength_+=1),d.parts_.push(b),d.byteLength_+=(0,r.stringLength)(b),aP(d),c2(a,f,d),g=d.parts_.pop(),d.byteLength_-=(0,r.stringLength)(g),d.parts_.length>0&&(d.byteLength_-=1)}),c&&e)throw Error(a+' contains ".value" child '+aQ(d)+" in addition to actual children.")}},c3=function(a,b){let c,d;for(c=0;c<b.length;c++){let e=aG(d=b[c]);for(let b=0;b<e.length;b++)if(".priority"===e[b]&&b===e.length-1);else if(!c$(e[b]))throw Error(a+"contains an invalid key ("+e[b]+") in path "+d.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}b.sort(aL);let e=null;for(c=0;c<b.length;c++){if(d=b[c],null!==e&&aN(e,d))throw Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+d.toString());e=d}},c4=function(a,b,c,d){if(d&&void 0===b)return;let e=(0,r.errorPrefix)(a,"values");if(!(b&&"object"==typeof b)||Array.isArray(b))throw Error(e+" must be an object containing the children to replace.");let f=[];Y(b,(a,b)=>{let d=new aA(a);if(c2(e,b,aI(c,d)),".priority"===aF(d)&&!c0(b))throw Error(e+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");f.push(d)}),c3(e,f)},c5=function(a,b,c){if(!c||void 0!==b){if(P(b))throw Error((0,r.errorPrefix)(a,"priority")+"is "+b.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!c0(b))throw Error((0,r.errorPrefix)(a,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},c6=function(a,b,c,d){if((!d||void 0!==c)&&!c$(c))throw Error((0,r.errorPrefix)(a,b)+'was an invalid key = "'+c+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},c7=function(a,b,c,d){if((!d||void 0!==c)&&!c_(c))throw Error((0,r.errorPrefix)(a,b)+'was an invalid path = "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},c8=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),c7(a,b,c,d)},c9=function(a,b){if(".info"===aC(b))throw Error(a+" failed = Can't modify data under /.info/")},da=function(a,b){var c;let d=b.path.toString();if("string"!=typeof b.repoInfo.host||0===b.repoInfo.host.length||!c$(b.repoInfo.namespace)&&"localhost"!==b.repoInfo.host.split(":")[0]||0!==d.length&&((c=d)&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),!c_(c)))throw Error((0,r.errorPrefix)(a,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class db{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function dc(a,b){let c=null;for(let d=0;d<b.length;d++){let e=b[d],f=e.getPath();null===c||aM(f,c.path)||(a.eventLists_.push(c),c=null),null===c&&(c={events:[],path:f}),c.events.push(e)}c&&a.eventLists_.push(c)}function dd(a,b,c){dc(a,c),df(a,a=>aM(a,b))}function de(a,b,c){dc(a,c),df(a,a=>aN(a,b)||aN(b,a))}function df(a,b){a.recursionDepth_++;let c=!0;for(let d=0;d<a.eventLists_.length;d++){let e=a.eventLists_[d];e&&(b(e.path)?(function(a){for(let b=0;b<a.events.length;b++){let c=a.events[b];if(null!==c){a.events[b]=null;let d=c.getEventRunner();G&&J("event: "+c.toString()),aa(d)}}}(a.eventLists_[d]),a.eventLists_[d]=null):c=!1)}c&&(a.eventLists_=[]),a.recursionDepth_--}let dg="repo_interrupt";class dh{constructor(a,b,c,d){this.repoInfo_=a,this.forceRestClient_=b,this.authTokenProvider_=c,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new db,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=bt(),this.transactionQueueTree_=new cR,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function di(a){let b=a.infoData_.getNode(new aA(".info/serverTimeOffset")).val()||0;return new Date().getTime()+b}function dj(a){var b;return(b=b={timestamp:di(a)}).timestamp=b.timestamp||new Date().getTime(),b}function dk(a,b,c,d,e){a.dataUpdateCount++;let f=new aA(b);c=a.interceptServerDataCallback_?a.interceptServerDataCallback_(b,c):c;let g=[];if(e)if(d){let b=(0,r.map)(c,a=>bb(a));g=function(a,b,c,d){let e=cF(a,d);if(!e)return[];{let d=cG(e),f=d.path,g=d.queryId,h=aK(f,b),i=bN.fromObject(c);return cH(a,f,new bE(bA(g),h,i))}}(a.serverSyncTree_,f,b,e)}else{let b=bb(c);g=cy(a.serverSyncTree_,f,b,e)}else if(d){var h;let b,d=(0,r.map)(c,a=>bb(a));h=a.serverSyncTree_,b=bN.fromObject(d),g=cB(h,new bE(bz(),f,b))}else{let b=bb(c);g=cw(a.serverSyncTree_,f,b)}let i=f;g.length>0&&(i=dx(a,f)),de(a.eventQueue_,i,g)}function dl(a,b){var c;let d,e,f;dm(a,"connected",b),!1===b&&(dt(c=a,"onDisconnectEvents"),d=dj(c),e=bt(),bv(c.onDisconnect_,aB(),(a,b)=>{let f=cO(a,b,c.serverSyncTree_,d);bu(e,a,f)}),f=[],bv(e,aB(),(a,b)=>{f=f.concat(cw(c.serverSyncTree_,a,b));let d=dB(c,a);dx(c,d)}),c.onDisconnect_=bt(),de(c.eventQueue_,aB(),f))}function dm(a,b,c){let d=new aA("/.info/"+b),e=bb(c);a.infoData_.updateSnapshot(d,e);let f=cw(a.infoSyncTree_,d,e);de(a.eventQueue_,d,f)}function dn(a){return a.nextWriteId_++}function dp(a,b,c,d,e){dt(a,"set",{path:b.toString(),value:c,priority:d});let f=dj(a),g=bb(c,d),h=cP(g,cA(a.serverSyncTree_,b),f),i=dn(a),j=cu(a.serverSyncTree_,b,h,i,!0);dc(a.eventQueue_,j),a.server_.put(b.toString(),g.val(!0),(c,d)=>{let f="ok"===c;f||N("set at "+b+" failed: "+c);let g=cv(a.serverSyncTree_,i,!f);de(a.eventQueue_,b,g),du(a,e,c,d)});let k=dB(a,b);dx(a,k),de(a.eventQueue_,k,[])}function dq(a,b,c,d){let e=bb(c);a.server_.onDisconnectPut(b.toString(),e.val(!0),(c,f)=>{"ok"===c&&bu(a.onDisconnect_,b,e),du(a,d,c,f)})}function dr(a,b,c){let d;d=".info"===aC(b._path)?cx(a.infoSyncTree_,b,c):cx(a.serverSyncTree_,b,c),dd(a.eventQueue_,b._path,d)}function ds(a){a.persistentConnection_&&a.persistentConnection_.interrupt(dg)}function dt(a,...b){let c="";a.persistentConnection_&&(c=a.persistentConnection_.id+":"),J(c,...b)}function du(a,b,c,d){b&&aa(()=>{if("ok"===c)b(null);else{let a=(c||"error").toUpperCase(),e=a;d&&(e+=": "+d);let f=Error(e);f.code=a,b(f)}})}function dv(a,b,c){return cA(a.serverSyncTree_,b,c)||a9.EMPTY_NODE}function dw(a,b=a.transactionQueueTree_){if(b||dA(a,b),cT(b)){let c=dz(a,b);(0,r.assert)(c.length>0,"Sending zero length transaction queue"),c.every(a=>0===a.status)&&function(a,b,c){let d=dv(a,b,c.map(a=>a.currentWriteId)),e=d,f=d.hash();for(let a=0;a<c.length;a++){let d=c[a];(0,r.assert)(0===d.status,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=aK(b,d.path);e=e.updateChild(f,d.currentOutputSnapshotRaw)}let g=e.val(!0);a.server_.put(b.toString(),g,d=>{dt(a,"transaction put response",{path:b.toString(),status:d});let e=[];if("ok"===d){let d=[];for(let b=0;b<c.length;b++)c[b].status=2,e=e.concat(cv(a.serverSyncTree_,c[b].currentWriteId)),c[b].onComplete&&d.push(()=>c[b].onComplete(null,!0,c[b].currentOutputSnapshotResolved)),c[b].unwatcher();dA(a,cS(a.transactionQueueTree_,b)),dw(a,a.transactionQueueTree_),de(a.eventQueue_,b,e);for(let a=0;a<d.length;a++)aa(d[a])}else{if("datastale"===d)for(let a=0;a<c.length;a++)3===c[a].status?c[a].status=4:c[a].status=0;else{N("transaction at "+b.toString()+" failed: "+d);for(let a=0;a<c.length;a++)c[a].status=4,c[a].abortReason=d}dx(a,b)}},f)}(a,cX(b),c)}else cV(b)&&cW(b,b=>{dw(a,b)})}function dx(a,b){let c=dy(a,b),d=cX(c),e=dz(a,c);return function(a,b,c){if(0===b.length)return;let d=[],e=[],f=b.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let g=0;g<b.length;g++){let h=b[g],i=aK(c,h.path),j=!1,k;if((0,r.assert)(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)j=!0,k=h.abortReason,e=e.concat(cv(a.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=25)j=!0,k="maxretry",e=e.concat(cv(a.serverSyncTree_,h.currentWriteId,!0));else{let c=dv(a,h.path,f);h.currentInputSnapshot=c;let d=b[g].update(c.val());if(void 0!==d){c2("transaction failed: Data returned ",d,h.path);let b=bb(d);"object"==typeof d&&null!=d&&(0,r.contains)(d,".priority")||(b=b.updatePriority(c.getPriority()));let g=h.currentWriteId,i=cP(b,c,dj(a));h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=i,h.currentWriteId=dn(a),f.splice(f.indexOf(g),1),e=(e=e.concat(cu(a.serverSyncTree_,h.path,i,h.currentWriteId,h.applyLocally))).concat(cv(a.serverSyncTree_,g,!0))}else j=!0,k="nodata",e=e.concat(cv(a.serverSyncTree_,h.currentWriteId,!0))}de(a.eventQueue_,c,e),e=[],j&&(b[g].status=2,setTimeout(b[g].unwatcher,Math.floor(0)),b[g].onComplete&&("nodata"===k?d.push(()=>b[g].onComplete(null,!1,b[g].currentInputSnapshot)):d.push(()=>b[g].onComplete(Error(k),!1,null))))}dA(a,a.transactionQueueTree_);for(let a=0;a<d.length;a++)aa(d[a]);dw(a,a.transactionQueueTree_)}(a,e,d),d}function dy(a,b){let c,d=a.transactionQueueTree_;for(c=aC(b);null!==c&&void 0===cT(d);)d=cS(d,c),c=aC(b=aE(b));return d}function dz(a,b){let c=[];return function a(b,c,d){let e=cT(c);if(e)for(let a=0;a<e.length;a++)d.push(e[a]);cW(c,c=>{a(b,c,d)})}(a,b,c),c.sort((a,b)=>a.order-b.order),c}function dA(a,b){let c=cT(b);if(c){let a=0;for(let b=0;b<c.length;b++)2!==c[b].status&&(c[a]=c[b],a++);c.length=a,cU(b,c.length>0?c:void 0)}cW(b,b=>{dA(a,b)})}function dB(a,b){let c=cX(dy(a,b)),d=cS(a.transactionQueueTree_,b);return!function(a,b,c){let d=a.parent;for(;null!==d;){if(b(d))return!0;d=d.parent}}(d,b=>{dC(a,b)}),dC(a,d),!function a(b,c,d,e){d&&!e&&c(b),cW(b,b=>{a(b,c,!0,e)}),d&&e&&c(b)}(d,b=>{dC(a,b)}),c}function dC(a,b){let c=cT(b);if(c){let d=[],e=[],f=-1;for(let b=0;b<c.length;b++)3===c[b].status||(1===c[b].status?((0,r.assert)(f===b-1,"All SENT items should be at beginning of queue."),f=b,c[b].status=3,c[b].abortReason="set"):((0,r.assert)(0===c[b].status,"Unexpected transaction status in abort"),c[b].unwatcher(),e=e.concat(cv(a.serverSyncTree_,c[b].currentWriteId,!0)),c[b].onComplete&&d.push(c[b].onComplete.bind(null,Error("set"),!1,null))));-1===f?cU(b,void 0):c.length=f+1,de(a.eventQueue_,cX(b),e);for(let a=0;a<d.length;a++)aa(d[a])}}let dD=function(a,b){let c=dE(a),d=c.namespace;"firebase.com"===c.domain&&M(c.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),d&&"undefined"!==d||"localhost"===c.domain||M("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),c.secure||O();let e="ws"===c.scheme||"wss"===c.scheme;return{repoInfo:new ac(c.host,c.secure,d,e,b,"",d!==c.subdomain),path:new aA(c.pathString)}},dE=function(a){let b="",c="",d="",e="",f="",g=!0,h="https",i=443;if("string"==typeof a){let j=a.indexOf("//");j>=0&&(h=a.substring(0,j-1),a=a.substring(j+2));let k=a.indexOf("/");-1===k&&(k=a.length);let l=a.indexOf("?");-1===l&&(l=a.length),b=a.substring(0,Math.min(k,l)),k<l&&(e=function(a){let b="",c=a.split("/");for(let a=0;a<c.length;a++)if(c[a].length>0){let d=c[a];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch(a){}b+="/"+d}return b}(a.substring(k,l)));let m=function(a){let b={};for(let c of("?"===a.charAt(0)&&(a=a.substring(1)),a.split("&"))){if(0===c.length)continue;let d=c.split("=");2===d.length?b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):N(`Invalid query segment '${c}' in query '${a}'`)}return b}(a.substring(Math.min(a.length,l)));(j=b.indexOf(":"))>=0?(g="https"===h||"wss"===h,i=parseInt(b.substring(j+1),10)):j=b.length;let n=b.slice(0,j);if("localhost"===n.toLowerCase())c="localhost";else if(n.split(".").length<=2)c=n;else{let a=b.indexOf(".");d=b.substring(0,a).toLowerCase(),c=b.substring(a+1),f=d}"ns"in m&&(f=m.ns)}return{host:b,port:i,domain:c,subdomain:d,secure:g,scheme:h,pathString:e,namespace:f}},dF="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",dG=(m=0,n=[],function(a){let b,c=a===m;m=a;let d=Array(8);for(b=7;b>=0;b--)d[b]=dF.charAt(a%64),a=Math.floor(a/64);(0,r.assert)(0===a,"Cannot push at time == 0");let e=d.join("");if(c){for(b=11;b>=0&&63===n[b];b--)n[b]=0;n[b]++}else for(b=0;b<12;b++)n[b]=Math.floor(64*Math.random());for(b=0;b<12;b++)e+=dF.charAt(n[b]);return(0,r.assert)(20===e.length,"nextPushId: Length should be 20."),e});class dH{constructor(a,b,c,d){this.eventType=a,this.eventRegistration=b,this.snapshot=c,this.prevName=d}getPath(){let a=this.snapshot.ref;return"value"===this.eventType?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,r.stringify)(this.snapshot.exportVal())}}class dI{constructor(a,b,c){this.eventRegistration=a,this.error=b,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class dJ{constructor(a,b){this.snapshotCallback=a,this.cancelCallback=b}onValue(a,b){this.snapshotCallback.call(null,a,b)}onCancel(a){return(0,r.assert)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}class dK{constructor(a,b){this._repo=a,this._path=b}cancel(){var a,b,c;let d=new r.Deferred;return a=this._repo,b=this._path,c=d.wrapCallback(()=>{}),a.server_.onDisconnectCancel(b.toString(),(d,e)=>{"ok"===d&&function a(b,c){if(aJ(c))return b.value=null,b.children.clear(),!0;if(null!==b.value)if(b.value.isLeafNode())return!1;else{let d=b.value;return b.value=null,d.forEachChild(a3,(a,c)=>{bu(b,new aA(a),c)}),a(b,c)}if(!(b.children.size>0))return!0;{let d=aC(c);return c=aE(c),b.children.has(d)&&a(b.children.get(d),c)&&b.children.delete(d),0===b.children.size}}(a.onDisconnect_,b),du(a,c,d,e)}),d.promise}remove(){c9("OnDisconnect.remove",this._path);let a=new r.Deferred;return dq(this._repo,this._path,null,a.wrapCallback(()=>{})),a.promise}set(a){c9("OnDisconnect.set",this._path),c1("OnDisconnect.set",a,this._path,!1);let b=new r.Deferred;return dq(this._repo,this._path,a,b.wrapCallback(()=>{})),b.promise}setWithPriority(a,b){var c,d,e;let f;c9("OnDisconnect.setWithPriority",this._path),c1("OnDisconnect.setWithPriority",a,this._path,!1),c5("OnDisconnect.setWithPriority",b,!1);let g=new r.Deferred;return c=this._repo,d=this._path,e=g.wrapCallback(()=>{}),f=bb(a,b),c.server_.onDisconnectPut(d.toString(),f.val(!0),(a,b)=>{"ok"===a&&bu(c.onDisconnect_,d,f),du(c,e,a,b)}),g.promise}update(a){c9("OnDisconnect.update",this._path),c4("OnDisconnect.update",a,this._path,!1);let b=new r.Deferred;return!function(a,b,c,d){if((0,r.isEmpty)(c)){J("onDisconnect().update() called with empty data.  Don't do anything."),du(a,d,"ok",void 0);return}a.server_.onDisconnectMerge(b.toString(),c,(e,f)=>{"ok"===e&&Y(c,(c,d)=>{let e=bb(d);bu(a.onDisconnect_,aI(b,c),e)}),du(a,d,e,f)})}(this._repo,this._path,a,b.wrapCallback(()=>{})),b.promise}}class dL{constructor(a,b,c,d){this._repo=a,this._path=b,this._queryParams=c,this._orderByCalled=d}get key(){return aJ(this._path)?null:aF(this._path)}get ref(){return new dP(this._repo,this._path)}get _queryIdentifier(){let a=W(bq(this._queryParams));return"{}"===a?"default":a}get _queryObject(){return bq(this._queryParams)}isEqual(a){if(!((a=(0,r.getModularInstance)(a))instanceof dL))return!1;let b=this._repo===a._repo,c=aM(this._path,a._path),d=this._queryIdentifier===a._queryIdentifier;return b&&c&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(a){let b="";for(let c=a.pieceNum_;c<a.pieces_.length;c++)""!==a.pieces_[c]&&(b+="/"+encodeURIComponent(String(a.pieces_[c])));return b||"/"}(this._path)}}function dM(a,b){if(!0===a._orderByCalled)throw Error(b+": You can't combine multiple orderBy calls.")}function dN(a){let b=null,c=null;if(a.hasStart()&&(b=a.getIndexStartValue()),a.hasEnd()&&(c=a.getIndexEndValue()),a.getIndex()===aW){let d="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",e="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(a.hasStart()){if(a.getIndexStartName()!==R)throw Error(d);if("string"!=typeof b)throw Error(e)}if(a.hasEnd()){if(a.getIndexEndName()!==S)throw Error(d);if("string"!=typeof c)throw Error(e)}}else if(a.getIndex()===a3){if(null!=b&&!c0(b)||null!=c&&!c0(c))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,r.assert)(a.getIndex()instanceof bc||a.getIndex()===bd,"unknown index type."),null!=b&&"object"==typeof b||null!=c&&"object"==typeof c)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function dO(a){if(a.hasStart()&&a.hasEnd()&&a.hasLimit()&&!a.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class dP extends dL{constructor(a,b){super(a,b,new bl,!1)}get parent(){let a=aH(this._path);return null===a?null:new dP(this._repo,a)}get root(){let a=this;for(;null!==a.parent;)a=a.parent;return a}}class dQ{constructor(a,b,c){this._node=a,this.ref=b,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){let b=new aA(a),c=dT(this.ref,a);return new dQ(this._node.getChild(b),c,a3)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(b,c)=>a(new dQ(c,dT(this.ref,b),a3)))}hasChild(a){let b=new aA(a);return!this._node.getChild(b).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function dR(a,b){return(a=(0,r.getModularInstance)(a))._checkNotDeleted("ref"),void 0!==b?dT(a._root,b):a._root}function dS(a,b){(a=(0,r.getModularInstance)(a))._checkNotDeleted("refFromURL");let c=dD(b,a._repo.repoInfo_.nodeAdmin);da("refFromURL",c);let d=c.repoInfo;return a._repo.repoInfo_.isCustomHost()||d.host===a._repo.repoInfo_.host||M("refFromURL: Host name does not match the current database: (found "+d.host+" but expected "+a._repo.repoInfo_.host+")"),dR(a,c.path.toString())}function dT(a,b){return null===aC((a=(0,r.getModularInstance)(a))._path)?c8("child","path",b,!1):c7("child","path",b,!1),new dP(a._repo,aI(a._path,b))}function dU(a){return new dK((a=(0,r.getModularInstance)(a))._repo,a._path)}function dV(a,b){let c;c9("push",(a=(0,r.getModularInstance)(a))._path),c1("push",b,a._path,!0);let d=dG(di(a._repo)),e=dT(a,d),f=dT(a,d);return e.then=(c=null!=b?dX(f,b).then(()=>f):Promise.resolve(f)).then.bind(c),e.catch=c.then.bind(c,void 0),e}function dW(a){return c9("remove",a._path),dX(a,null)}function dX(a,b){c9("set",(a=(0,r.getModularInstance)(a))._path),c1("set",b,a._path,!1);let c=new r.Deferred;return dp(a._repo,a._path,b,null,c.wrapCallback(()=>{})),c.promise}function dY(a,b){c9("setPriority",(a=(0,r.getModularInstance)(a))._path),c5("setPriority",b,!1);let c=new r.Deferred;return dp(a._repo,aI(a._path,".priority"),b,null,c.wrapCallback(()=>{})),c.promise}function dZ(a,b,c){if(c9("setWithPriority",a._path),c1("setWithPriority",b,a._path,!1),c5("setWithPriority",c,!1),".length"===a.key||".keys"===a.key)throw"setWithPriority failed: "+a.key+" is a read-only object.";let d=new r.Deferred;return dp(a._repo,a._path,b,c,d.wrapCallback(()=>{})),d.promise}function d$(a,b){c4("update",b,a._path,!1);let c=new r.Deferred;return!function(a,b,c,d){dt(a,"update",{path:b.toString(),value:c});let e=!0,f=dj(a),g={};if(Y(c,(c,d)=>{e=!1,g[c]=cO(aI(b,c),bb(d),a.serverSyncTree_,f)}),e)J("update() called with empty data.  Don't do anything."),du(a,d,"ok",void 0);else{var h,i;let e,f=dn(a),j=(h=a.serverSyncTree_,i=h.pendingWriteTree_,(0,r.assert)(f>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:b,children:g,writeId:f,visible:!0}),i.visibleWrites=bQ(i.visibleWrites,b,g),i.lastWriteId=f,e=bN.fromObject(g),cB(h,new bE(by(),b,e)));dc(a.eventQueue_,j),a.server_.merge(b.toString(),c,(c,e)=>{let g="ok"===c;g||N("update at "+b+" failed: "+c);let h=cv(a.serverSyncTree_,f,!g),i=h.length>0?dx(a,b):b;de(a.eventQueue_,i,h),du(a,d,c,e)}),Y(c,c=>{let d=dB(a,aI(b,c));dx(a,d)}),de(a.eventQueue_,b,[])}}(a._repo,a._path,b,c.wrapCallback(()=>{})),c.promise}function d_(a){var b,c,d,e,f;let g,h,i,j,k,l,m;a=(0,r.getModularInstance)(a);let n=new d0(new dJ(()=>{}));return(b=a._repo,c=a,d=b.serverSyncTree_,h=(e=c)._path,i=null,d.syncPointTree_.foreachOnPath(h,(a,b)=>{let c=aK(a,h);i=i||co(b,c)}),(j=d.syncPointTree_.get(h))?i=i||co(j,aB()):(j=new ck,d.syncPointTree_=d.syncPointTree_.set(h,j)),l=(k=null!=i)?new bF(i,!0,!1):null,m=(f=d.pendingWriteTree_,b5(e._path,f)),null!=(g=bL(cm(j,e,m,k?l.getNode():a9.EMPTY_NODE,k).viewCache_))?Promise.resolve(g):b.server_.get(c).then(a=>{let d,e=bb(a).withIndex(c._queryParams.getIndex());if(cz(b.serverSyncTree_,c,n,!0),c._queryParams.loadsAllData())d=cw(b.serverSyncTree_,c._path,e);else{let a=cD(b.serverSyncTree_,c);d=cy(b.serverSyncTree_,c._path,e,a)}return de(b.eventQueue_,c._path,d),cx(b.serverSyncTree_,c,n,null,!0),e},a=>(dt(b,"get for query "+(0,r.stringify)(c)+" failed: "+a),Promise.reject(Error(a))))).then(b=>new dQ(b,new dP(a._repo,a._path),a._queryParams.getIndex()))}class d0{constructor(a){this.callbackContext=a}respondsTo(a){return"value"===a}createEvent(a,b){let c=b._queryParams.getIndex();return new dH("value",this,new dQ(a.snapshotNode,new dP(b._repo,b._path),c))}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new dI(this,a,b):null}matches(a){return a instanceof d0&&(!a.callbackContext||!this.callbackContext||a.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class d1{constructor(a,b){this.eventType=a,this.callbackContext=b}respondsTo(a){let b="children_added"===a?"child_added":a;return b="children_removed"===b?"child_removed":b,this.eventType===b}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new dI(this,a,b):null}createEvent(a,b){(0,r.assert)(null!=a.childName,"Child events should have a childName.");let c=dT(new dP(b._repo,b._path),a.childName),d=b._queryParams.getIndex();return new dH(a.type,this,new dQ(a.snapshotNode,c,d),a.prevName)}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,a.prevName)}matches(a){return a instanceof d1&&this.eventType===a.eventType&&(!this.callbackContext||!a.callbackContext||this.callbackContext.matches(a.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function d2(a,b,c,d,e){var f;let g,h;if("object"==typeof d&&(g=void 0,e=d),"function"==typeof d&&(g=d),e&&e.onlyOnce){let b=c,d=(c,d)=>{dr(a._repo,a,j),b(c,d)};d.userCallback=c.userCallback,d.context=c.context,c=d}let i=new dJ(c,g||void 0),j="value"===b?new d0(i):new d1(b,i);return f=a._repo,h=".info"===aC(a._path)?cz(f.infoSyncTree_,a,j):cz(f.serverSyncTree_,a,j),dd(f.eventQueue_,a._path,h),()=>dr(a._repo,a,j)}function d3(a,b,c,d){return d2(a,"value",b,c,d)}function d4(a,b,c,d){return d2(a,"child_added",b,c,d)}function d5(a,b,c,d){return d2(a,"child_changed",b,c,d)}function d6(a,b,c,d){return d2(a,"child_moved",b,c,d)}function d7(a,b,c,d){return d2(a,"child_removed",b,c,d)}function d8(a,b,c){let d=null,e=c?new dJ(c):null;"value"===b?d=new d0(e):b&&(d=new d1(b,e)),dr(a._repo,a,d)}class d9{}class ea extends d9{constructor(a,b){super(),this._value=a,this._key=b,this.type="endAt"}_apply(a){c1("endAt",this._value,a._path,!0);let b=bn(a._queryParams,this._value,this._key);if(dO(b),dN(b),a._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new dL(a._repo,a._path,b,a._orderByCalled)}}function eb(a,b){return c6("endAt","key",b,!0),new ea(a,b)}class ec extends d9{constructor(a,b){super(),this._value=a,this._key=b,this.type="endBefore"}_apply(a){var b,c,d;let e;c1("endBefore",this._value,a._path,!1);let f=(b=a._queryParams,c=this._value,d=this._key,(e=b.index_===aW||d?bn(b,c,d):bn(b,c,R)).endBeforeSet_=!0,e);if(dO(f),dN(f),a._queryParams.hasEnd())throw Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new dL(a._repo,a._path,f,a._orderByCalled)}}function ed(a,b){return c6("endBefore","key",b,!0),new ec(a,b)}class ee extends d9{constructor(a,b){super(),this._value=a,this._key=b,this.type="startAt"}_apply(a){c1("startAt",this._value,a._path,!0);let b=bm(a._queryParams,this._value,this._key);if(dO(b),dN(b),a._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new dL(a._repo,a._path,b,a._orderByCalled)}}function ef(a=null,b){return c6("startAt","key",b,!0),new ee(a,b)}class eg extends d9{constructor(a,b){super(),this._value=a,this._key=b,this.type="startAfter"}_apply(a){var b,c,d;let e;c1("startAfter",this._value,a._path,!1);let f=(b=a._queryParams,c=this._value,d=this._key,(e=b.index_===aW||d?bm(b,c,d):bm(b,c,S)).startAfterSet_=!0,e);if(dO(f),dN(f),a._queryParams.hasStart())throw Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new dL(a._repo,a._path,f,a._orderByCalled)}}function eh(a,b){return c6("startAfter","key",b,!0),new eg(a,b)}class ei extends d9{constructor(a){super(),this._limit=a,this.type="limitToFirst"}_apply(a){var b,c;let d;if(a._queryParams.hasLimit())throw Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new dL(a._repo,a._path,(b=a._queryParams,c=this._limit,(d=b.copy()).limitSet_=!0,d.limit_=c,d.viewFrom_="l",d),a._orderByCalled)}}function ej(a){if("number"!=typeof a||Math.floor(a)!==a||a<=0)throw Error("limitToFirst: First argument must be a positive integer.");return new ei(a)}class ek extends d9{constructor(a){super(),this._limit=a,this.type="limitToLast"}_apply(a){var b,c;let d;if(a._queryParams.hasLimit())throw Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new dL(a._repo,a._path,(b=a._queryParams,c=this._limit,(d=b.copy()).limitSet_=!0,d.limit_=c,d.viewFrom_="r",d),a._orderByCalled)}}function el(a){if("number"!=typeof a||Math.floor(a)!==a||a<=0)throw Error("limitToLast: First argument must be a positive integer.");return new ek(a)}class em extends d9{constructor(a){super(),this._path=a,this.type="orderByChild"}_apply(a){dM(a,"orderByChild");let b=new aA(this._path);if(aJ(b))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let c=new bc(b),d=bo(a._queryParams,c);return dN(d),new dL(a._repo,a._path,d,!0)}}function en(a){if("$key"===a)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===a)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===a)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return c7("orderByChild","path",a,!1),new em(a)}class eo extends d9{constructor(){super(...arguments),this.type="orderByKey"}_apply(a){dM(a,"orderByKey");let b=bo(a._queryParams,aW);return dN(b),new dL(a._repo,a._path,b,!0)}}function ep(){return new eo}class eq extends d9{constructor(){super(...arguments),this.type="orderByPriority"}_apply(a){dM(a,"orderByPriority");let b=bo(a._queryParams,a3);return dN(b),new dL(a._repo,a._path,b,!0)}}function er(){return new eq}class es extends d9{constructor(){super(...arguments),this.type="orderByValue"}_apply(a){dM(a,"orderByValue");let b=bo(a._queryParams,bd);return dN(b),new dL(a._repo,a._path,b,!0)}}function et(){return new es}class eu extends d9{constructor(a,b){super(),this._value=a,this._key=b,this.type="equalTo"}_apply(a){if(c1("equalTo",this._value,a._path,!1),a._queryParams.hasStart())throw Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(a._queryParams.hasEnd())throw Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new ea(this._value,this._key)._apply(new ee(this._value,this._key)._apply(a))}}function ev(a,b){return c6("equalTo","key",b,!0),new eu(a,b)}function ew(a,...b){let c=(0,r.getModularInstance)(a);for(let a of b)c=a._apply(c);return c}(0,r.assert)(!j,"__referenceConstructor has already been defined"),j=dP,(0,r.assert)(!k,"__referenceConstructor has already been defined"),k=dP;let ex={},ey=!1;function ez(a,b,c,d,e){var f,g,h,i;let j,k,l,m,n=d||a.options.databaseURL;void 0===n&&(a.options.projectId||M("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),J("Using default host for project ",a.options.projectId),n=`${a.options.projectId}-default-rtdb.firebaseio.com`);let o=dD(n,e),p=o.repoInfo;"u">typeof process&&process.env&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?(m=!0,p=(o=dD(n=`http://${l}?ns=${p.namespace}`,e)).repoInfo):m=!o.repoInfo.secure;let q=e&&m?new aq(aq.OWNER):new ap(a.name,a.options,b);return da("Invalid Firebase Database URL",o),aJ(o.path)||M("Database URL must point to the root of a Firebase Database (not including a child path)."),new eA((f=p,g=a,h=q,i=new ao(a,c),(j=ex[g.name])||(j={},ex[g.name]=j),(k=j[f.toURLString()])&&M("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),k=new dh(f,ey,h,i),j[f.toURLString()]=k,k),a)}class eA{constructor(a,b){this._repoInternal=a,this.app=b,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(a,b,c){var d;let e;if(a.stats_=ah(a.repoInfo_),a.forceRestClient_||"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)a.server_=new br(a.repoInfo_,(b,c,d,e)=>{dk(a,b,c,d,e)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>dl(a,!0),0);else{if(null!=c){if("object"!=typeof c)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,r.stringify)(c)}catch(a){throw Error("Invalid authOverride provided: "+a)}}a.persistentConnection_=new aS(a.repoInfo_,b,(b,c,d,e)=>{dk(a,b,c,d,e)},b=>{dl(a,b)},b=>{var c;c=a,Y(b,(a,b)=>{dm(c,a,b)})},a.authTokenProvider_,a.appCheckProvider_,c),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(b=>{a.server_.refreshAuthToken(b)}),a.appCheckProvider_.addTokenChangeListener(b=>{a.server_.refreshAppCheckToken(b.token)}),d=a.repoInfo_,ag[e=d.toString()]||(ag[e]=(()=>new bx(a.stats_,a.server_))()),a.statsReporter_=ag[e],a.infoData_=new bs,a.infoSyncTree_=new ct({startListening:(b,c,d,e)=>{let f=[],g=a.infoData_.getNode(b._path);return g.isEmpty()||(f=cw(a.infoSyncTree_,b._path,g),setTimeout(()=>{e("ok")},0)),f},stopListening:()=>{}}),dm(a,"connected",!1),a.serverSyncTree_=new ct({startListening:(b,c,d,e)=>(a.server_.listen(b,d,c,(c,d)=>{let f=e(c,d);de(a.eventQueue_,b._path,f)}),[]),stopListening:(b,c)=>{a.server_.unlisten(b,c)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new dP(this._repo,aB())),this._rootInternal}_delete(){if(null!==this._rootInternal){var a,b;let c;a=this._repo,(c=ex[b=this.app.name])&&c[a.key]===a||M(`Database ${b}(${a.repoInfo_}) has already been deleted.`),ds(a),delete c[a.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(a){null===this._rootInternal&&M("Cannot call "+a+" on a deleted database.")}}function eB(){av.IS_TRANSPORT_INITIALIZED&&N("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function eC(){eB(),at.forceDisallow()}function eD(){eB(),al.forceDisallow(),at.forceAllow()}function eE(a=(0,t.getApp)(),b){let c=(0,t._getProvider)(a,"database").getImmediate({identifier:b});if(!c._instanceStarted){let a=(0,r.getDefaultEmulatorHostnameAndPort)("database");a&&eF(c,...a)}return c}function eF(a,b,c,d={}){var e;let f,g,h;(a=(0,r.getModularInstance)(a))._checkNotDeleted("useEmulator");let i=`${b}:${c}`,j=a._repoInternal;if(a._instanceStarted){if(i===a._repoInternal.repoInfo_.host&&(0,r.deepEqual)(d,j.repoInfo_.emulatorOptions))return;M("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}j.repoInfo_.nodeAdmin?(d.mockUserToken&&M('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),f=new aq(aq.OWNER)):d.mockUserToken&&(f=new aq("string"==typeof d.mockUserToken?d.mockUserToken:(0,r.createMockUserToken)(d.mockUserToken,a.app.options.projectId))),(0,r.isCloudWorkstation)(b)&&((0,r.pingServer)(b),(0,r.updateEmulatorBanner)("Database",!0)),e=f,g=i.lastIndexOf(":"),h=i.substring(0,g),j.repoInfo_=new ac(i,(0,r.isCloudWorkstation)(h),j.repoInfo_.namespace,j.repoInfo_.webSocketOnly,j.repoInfo_.nodeAdmin,j.repoInfo_.persistenceKey,j.repoInfo_.includeNamespaceInQueryParams,!0,d),e&&(j.authTokenProvider_=e)}function eG(a){(a=(0,r.getModularInstance)(a))._checkNotDeleted("goOffline"),ds(a._repo)}function eH(a){var b;(a=(0,r.getModularInstance)(a))._checkNotDeleted("goOnline"),(b=a._repo).persistentConnection_&&b.persistentConnection_.resume(dg)}function eI(a,b){I(a,b)}let eJ={".sv":"timestamp"};function eK(){return eJ}function eL(a){return{".sv":{increment:a}}}class eM{constructor(a,b){this.committed=a,this.snapshot=b}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function eN(a,b,c){if(c9("Reference.transaction",(a=(0,r.getModularInstance)(a))._path),".length"===a.key||".keys"===a.key)throw"Reference.transaction failed: "+a.key+" is a read-only object.";let d=c?.applyLocally??!0,e=new r.Deferred,f=d3(a,()=>{});return!function(a,b,c,d,e,f){dt(a,"transaction on "+b);let g={path:b,update:c,onComplete:d,status:null,order:D(),applyLocally:f,retryCount:0,unwatcher:e,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=dv(a,b,void 0);g.currentInputSnapshot=h;let i=g.update(h.val());if(void 0===i)g.unwatcher(),g.currentOutputSnapshotRaw=null,g.currentOutputSnapshotResolved=null,g.onComplete&&g.onComplete(null,!1,g.currentInputSnapshot);else{let c;c2("transaction failed: Data returned ",i,g.path),g.status=0;let d=cS(a.transactionQueueTree_,b),e=cT(d)||[];e.push(g),cU(d,e),"object"==typeof i&&null!==i&&(0,r.contains)(i,".priority")?(c=(0,r.safeGet)(i,".priority"),(0,r.assert)(c0(c),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):c=(cA(a.serverSyncTree_,b)||a9.EMPTY_NODE).getPriority().val();let f=dj(a),j=bb(i,c),k=cP(j,h,f);g.currentOutputSnapshotRaw=j,g.currentOutputSnapshotResolved=k,g.currentWriteId=dn(a);let l=cu(a.serverSyncTree_,b,k,g.currentWriteId,g.applyLocally);de(a.eventQueue_,b,l),dw(a,a.transactionQueueTree_)}}(a._repo,a._path,b,(b,c,d)=>{let f=null;b?e.reject(b):(f=new dQ(d,new dP(a._repo,a._path),a3),e.resolve(new eM(c,f)))},f,d),e.promise}aS.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},aS.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)};let eO=function(a){let b=aS.prototype.put;return aS.prototype.put=function(c,d,e,f){void 0!==f&&(f=a()),b.call(this,c,d,e,f)},function(){aS.prototype.put=b}},eP=function(a){ey=a};function eQ({app:a,url:b,version:c,customAuthImpl:d,customAppCheckImpl:e,nodeAdmin:f=!1}){let g;ai=c;let h=new u.ComponentContainer("database-standalone"),i=new u.Provider("auth-internal",h);return e&&(g=new u.Provider("app-check-internal",h)).setComponent(new u.Component("app-check-internal",()=>e,"PRIVATE")),i.setComponent(new u.Component("auth-internal",()=>d,"PRIVATE")),ez(a,i,g,b,f)}ak=q.default.Client;ai=t.SDK_VERSION,(0,t._registerComponent)(new u.Component("database",(a,{instanceIdentifier:b})=>ez(a.getProvider("app").getImmediate(),a.getProvider("auth-internal"),a.getProvider("app-check-internal"),b),"PUBLIC").setMultipleInstances(!0)),(0,t.registerVersion)(am,an,"node"),(0,t.registerVersion)(am,an,"esm2020"),a.s(["DataSnapshot",()=>dQ,"Database",()=>eA,"OnDisconnect",()=>dK,"QueryConstraint",()=>d9,"TransactionResult",()=>eM,"_QueryImpl",()=>dL,"_QueryParams",()=>bl,"_ReferenceImpl",()=>dP,"_TEST_ACCESS_forceRestClient",()=>eP,"_TEST_ACCESS_hijackHash",()=>eO,"_initStandalone",()=>eQ,"_repoManagerDatabaseFromApp",()=>ez,"_setSDKVersion",()=>aj,"_validatePathString",()=>c7,"_validateWritablePath",()=>c9,"child",()=>dT,"connectDatabaseEmulator",()=>eF,"enableLogging",()=>eI,"endAt",()=>eb,"endBefore",()=>ed,"equalTo",()=>ev,"forceLongPolling",()=>eD,"forceWebSockets",()=>eC,"get",()=>d_,"getDatabase",()=>eE,"goOffline",()=>eG,"goOnline",()=>eH,"increment",()=>eL,"limitToFirst",()=>ej,"limitToLast",()=>el,"off",()=>d8,"onChildAdded",()=>d4,"onChildChanged",()=>d5,"onChildMoved",()=>d6,"onChildRemoved",()=>d7,"onDisconnect",()=>dU,"onValue",()=>d3,"orderByChild",()=>en,"orderByKey",()=>ep,"orderByPriority",()=>er,"orderByValue",()=>et,"push",()=>dV,"query",()=>ew,"ref",()=>dR,"refFromURL",()=>dS,"remove",()=>dW,"runTransaction",()=>eN,"serverTimestamp",()=>eK,"set",()=>dX,"setPriority",()=>dY,"setWithPriority",()=>dZ,"startAfter",()=>eh,"startAt",()=>ef,"update",()=>d$],50455),a.s([],72029)}];

//# sourceMappingURL=node_modules_4bc61c1e._.js.map