module.exports=[57982,(a,b,c)=>{"use strict";var d,e,f;Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=c.Propagate=c.LogVerbosity=c.Status=void 0,function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(d||(c.Status=d={})),function(a){a[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.ERROR=2]="ERROR",a[a.NONE=3]="NONE"}(e||(c.LogVerbosity=e={})),function(a){a[a.DEADLINE=1]="DEADLINE",a[a.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",a[a.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",a[a.CANCELLATION=8]="CANCELLATION",a[a.DEFAULTS=65535]="DEFAULTS"}(f||(c.Propagate=f={})),c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},11717,(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c.isTracerEnabled=c.trace=c.log=c.setLoggerVerbosity=c.setLogger=c.getLogger=void 0;let h=a.r(57982),i=a.r(5365),j=a.r(17887).version,k={error:(a,...b)=>{console.error("E "+a,...b)},info:(a,...b)=>{console.error("I "+a,...b)},debug:(a,...b)=>{console.error("D "+a,...b)}},l=h.LogVerbosity.ERROR;switch((null!=(e=null!=(d=process.env.GRPC_NODE_VERBOSITY)?d:process.env.GRPC_VERBOSITY)?e:"").toUpperCase()){case"DEBUG":l=h.LogVerbosity.DEBUG;break;case"INFO":l=h.LogVerbosity.INFO;break;case"ERROR":l=h.LogVerbosity.ERROR;break;case"NONE":l=h.LogVerbosity.NONE}c.getLogger=()=>k,c.setLogger=a=>{k=a},c.setLoggerVerbosity=a=>{l=a},c.log=(a,...b)=>{let c;if(a>=l){switch(a){case h.LogVerbosity.DEBUG:c=k.debug;break;case h.LogVerbosity.INFO:c=k.info;break;case h.LogVerbosity.ERROR:c=k.error}c||(c=k.error),c&&c.bind(k)(...b)}};let m=null!=(g=null!=(f=process.env.GRPC_NODE_TRACE)?f:process.env.GRPC_TRACE)?g:"",n=new Set,o=new Set;for(let a of m.split(","))a.startsWith("-")?o.add(a.substring(1)):n.add(a);let p=n.has("all");function q(a,b,d){r(b)&&(0,c.log)(a,new Date().toISOString()+" | v"+j+" "+i.pid+" | "+b+" | "+d)}function r(a){return!o.has(a)&&(p||n.has(a))}c.trace=q,c.isTracerEnabled=r},21015,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getErrorCode=c.getErrorMessage=void 0,c.getErrorMessage=function(a){return a instanceof Error?a.message:String(a)},c.getErrorCode=function(a){return"object"==typeof a&&null!==a&&"code"in a&&"number"==typeof a.code?a.code:null}},57904,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;let d=a.r(11717),e=a.r(57982),f=a.r(21015),g=/^[0-9a-z_.-]+$/,h=/^[ -~]*$/;function i(a){return g.test(a)}function j(a){return h.test(a)}function k(a){return a.endsWith("-bin")}function l(a){return!a.startsWith("grpc-")}function m(a){return a.toLowerCase()}function n(a,b){if(!i(a))throw Error('Metadata key "'+a+'" contains illegal characters');if(null!=b)if(k(a)){if(!Buffer.isBuffer(b))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(b))throw Error("keys that don't end with '-bin' must have String values");if(!j(b))throw Error('Metadata string value "'+b+'" contains illegal characters')}}class o{constructor(a={}){this.internalRepr=new Map,this.options=a}set(a,b){n(a=m(a),b),this.internalRepr.set(a,[b])}add(a,b){n(a=m(a),b);let c=this.internalRepr.get(a);void 0===c?this.internalRepr.set(a,[b]):c.push(b)}remove(a){a=m(a),this.internalRepr.delete(a)}get(a){return a=m(a),this.internalRepr.get(a)||[]}getMap(){let a={};for(let[b,c]of this.internalRepr)if(c.length>0){let d=c[0];a[b]=Buffer.isBuffer(d)?Buffer.from(d):d}return a}clone(){let a=new o(this.options),b=a.internalRepr;for(let[a,c]of this.internalRepr){let d=c.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);b.set(a,d)}return a}merge(a){for(let[b,c]of a.internalRepr){let a=(this.internalRepr.get(b)||[]).concat(c);this.internalRepr.set(b,a)}}setOptions(a){this.options=a}getOptions(){return this.options}toHttp2Headers(){let a={};for(let[b,c]of this.internalRepr)a[b]=c.map(p);return a}toJSON(){let a={};for(let[b,c]of this.internalRepr)a[b]=c;return a}static fromHttp2Headers(a){let b=new o;for(let c of Object.keys(a)){if(":"===c.charAt(0))continue;let g=a[c];try{k(c)?Array.isArray(g)?g.forEach(a=>{b.add(c,Buffer.from(a,"base64"))}):void 0!==g&&(l(c)?g.split(",").forEach(a=>{b.add(c,Buffer.from(a.trim(),"base64"))}):b.add(c,Buffer.from(g,"base64"))):Array.isArray(g)?g.forEach(a=>{b.add(c,a)}):void 0!==g&&b.add(c,g)}catch(b){let a=`Failed to add metadata entry ${c}: ${g}. ${(0,f.getErrorMessage)(b)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,d.log)(e.LogVerbosity.ERROR,a)}}return b}}c.Metadata=o;let p=a=>Buffer.isBuffer(a)?a.toString("base64"):a},20574,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CallCredentials=void 0;let d=a.r(57904);function e(a){return"getRequestHeaders"in a&&"function"==typeof a.getRequestHeaders}class f{static createFromMetadataGenerator(a){return new h(a)}static createFromGoogleCredential(a){return f.createFromMetadataGenerator((b,c)=>{let f;(f=e(a)?a.getRequestHeaders(b.service_url):new Promise((c,d)=>{a.getRequestMetadata(b.service_url,(a,b)=>{a?d(a):b?c(b):d(Error("Headers not set by metadata plugin"))})})).then(a=>{let b=new d.Metadata;for(let c of Object.keys(a))b.add(c,a[c]);c(null,b)},a=>{c(a)})})}static createEmpty(){return new i}}c.CallCredentials=f;class g extends f{constructor(a){super(),this.creds=a}async generateMetadata(a){let b=new d.Metadata;for(let c of(await Promise.all(this.creds.map(b=>b.generateMetadata(a)))))b.merge(c);return b}compose(a){return new g(this.creds.concat([a]))}_equals(a){return this===a||a instanceof g&&this.creds.every((b,c)=>b._equals(a.creds[c]))}}class h extends f{constructor(a){super(),this.metadataGenerator=a}generateMetadata(a){return new Promise((b,c)=>{this.metadataGenerator(a,(a,d)=>{void 0!==d?b(d):c(a)})})}compose(a){return new g([this,a])}_equals(a){return this===a||a instanceof h&&this.metadataGenerator===a.metadataGenerator}}class i extends f{generateMetadata(a){return Promise.resolve(new d.Metadata)}compose(a){return a}_equals(a){return a instanceof i}}},49229,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getDefaultRootsData=c.CIPHER_SUITES=void 0;let d=a.r(22734);c.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let e=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,f=null;c.getDefaultRootsData=function(){return e?(null===f&&(f=d.readFileSync(e)),f):null}},61591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelCredentials=void 0;let d=a.r(55004),e=a.r(20574),f=a.r(49229);function g(a,b){if(a&&!(a instanceof Buffer))throw TypeError(`${b}, if provided, must be a Buffer.`)}class h{constructor(a){this.callCredentials=a||e.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(a,b,c,e){var h;if(g(a,"Root certificate"),g(b,"Private key"),g(c,"Certificate chain"),b&&!c)throw Error("Private key must be given with accompanying certificate chain");if(!b&&c)throw Error("Certificate chain must be given with accompanying private key");return new j((0,d.createSecureContext)({ca:null!=(h=null!=a?a:(0,f.getDefaultRootsData)())?h:void 0,key:null!=b?b:void 0,cert:null!=c?c:void 0,ciphers:f.CIPHER_SUITES}),null!=e?e:{})}static createFromSecureContext(a,b){return new j(a,null!=b?b:{})}static createInsecure(){return new i}}c.ChannelCredentials=h;class i extends h{constructor(a){super(a)}compose(a){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(a){return a instanceof i}}class j extends h{constructor(a,b){super(),this.secureContext=a,this.verifyOptions=b,this.connectionOptions={secureContext:a},(null==b?void 0:b.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=b.checkServerIdentity)}compose(a){return new k(this,this.callCredentials.compose(a))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(a){return this===a||a instanceof j&&this.secureContext===a.secureContext&&this.verifyOptions.checkServerIdentity===a.verifyOptions.checkServerIdentity}}class k extends h{constructor(a,b){super(b),this.channelCredentials=a}compose(a){let b=this.callCredentials.compose(a);return new k(this.channelCredentials,b)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(a){return this===a||a instanceof k&&this.channelCredentials._equals(a.channelCredentials)&&this.callCredentials._equals(a.callCredentials)}}},39071,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.isLoadBalancerNameRegistered=c.createLoadBalancer=c.registerDefaultLoadBalancerType=c.registerLoadBalancerType=c.createChildChannelControlHelper=void 0,c.createChildChannelControlHelper=function(a,b){var c,d,e,f,g,h,i,j,k,l;return{createSubchannel:null!=(d=null==(c=b.createSubchannel)?void 0:c.bind(b))?d:a.createSubchannel.bind(a),updateState:null!=(f=null==(e=b.updateState)?void 0:e.bind(b))?f:a.updateState.bind(a),requestReresolution:null!=(h=null==(g=b.requestReresolution)?void 0:g.bind(b))?h:a.requestReresolution.bind(a),addChannelzChild:null!=(j=null==(i=b.addChannelzChild)?void 0:i.bind(b))?j:a.addChannelzChild.bind(a),removeChannelzChild:null!=(l=null==(k=b.removeChannelzChild)?void 0:k.bind(b))?l:a.removeChannelzChild.bind(a)}};let d={},e=null;c.registerLoadBalancerType=function(a,b,c){d[a]={LoadBalancer:b,LoadBalancingConfig:c}},c.registerDefaultLoadBalancerType=function(a){e=a},c.createLoadBalancer=function(a,b){let c=a.getLoadBalancerName();return c in d?new d[c].LoadBalancer(b):null},c.isLoadBalancerNameRegistered=function(a){return a in d},c.getFirstUsableConfig=function(a,b=!1){for(let b of a)if(b.getLoadBalancerName()in d)return b;return b&&e?new d[e].LoadBalancingConfig:null},c.validateLoadBalancingConfig=function(a){if(null===a||"object"!=typeof a)throw Error("Load balancing config must be an object");let b=Object.keys(a);if(1!==b.length)throw Error("Provided load balancing config has multiple conflicting entries");let c=b[0];if(c in d)return d[c].LoadBalancingConfig.createFromJson(a[c]);throw Error(`Unrecognized load balancing config name ${c}`)}},83931,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.extractAndSelectServiceConfig=c.validateServiceConfig=c.validateRetryThrottling=void 0;let d=a.r(46786),e=a.r(57982),f=a.r(39071),g=/^\d+(\.\d{1,9})?s$/,h="node";function i(a){if("service"in a&&""!==a.service){if("string"!=typeof a.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof a.service}`);if(!("method"in a)||""===a.method)return{service:a.service};if("string"!=typeof a.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof a.service}`);return{service:a.service,method:a.method}}if("method"in a&&void 0!==a.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function j(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in a)||"string"!=typeof a.initialBackoff||!g.test(a.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in a)||"string"!=typeof a.maxBackoff||!g.test(a.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in a)||"number"!=typeof a.backoffMultiplier||a.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in a&&Array.isArray(a.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===a.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let b of a.retryableStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:a.maxAttempts,initialBackoff:a.initialBackoff,maxBackoff:a.maxBackoff,backoffMultiplier:a.backoffMultiplier,retryableStatusCodes:a.retryableStatusCodes}}function k(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in a&&("string"!=typeof a.hedgingDelay||!g.test(a.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in a&&Array.isArray(a.nonFatalStatusCodes))for(let b of a.nonFatalStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let b={maxAttempts:a.maxAttempts};return a.hedgingDelay&&(b.hedgingDelay=a.hedgingDelay),a.nonFatalStatusCodes&&(b.nonFatalStatusCodes=a.nonFatalStatusCodes),b}function l(a){var b;let c={name:[]};if(!("name"in a)||!Array.isArray(a.name))throw Error("Invalid method config: invalid name array");for(let b of a.name)c.name.push(i(b));if("waitForReady"in a){if("boolean"!=typeof a.waitForReady)throw Error("Invalid method config: invalid waitForReady");c.waitForReady=a.waitForReady}if("timeout"in a)if("object"==typeof a.timeout){if(!("seconds"in a.timeout)||"number"!=typeof a.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in a.timeout)||"number"!=typeof a.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");c.timeout=a.timeout}else if("string"==typeof a.timeout&&g.test(a.timeout)){let d=a.timeout.substring(0,a.timeout.length-1).split(".");c.timeout={seconds:0|d[0],nanos:(null!=(b=d[1])?b:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in a){if("number"!=typeof a.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxRequestBytes=a.maxRequestBytes}if("maxResponseBytes"in a){if("number"!=typeof a.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxResponseBytes=a.maxResponseBytes}if("retryPolicy"in a)if("hedgingPolicy"in a)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else c.retryPolicy=j(a.retryPolicy);else"hedgingPolicy"in a&&(c.hedgingPolicy=k(a.hedgingPolicy));return c}function m(a){if(!("maxTokens"in a)||"number"!=typeof a.maxTokens||a.maxTokens<=0||a.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in a)||"number"!=typeof a.tokenRatio||a.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+a.maxTokens.toFixed(3),tokenRatio:+a.tokenRatio.toFixed(3)}}function n(a){let b={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in a)if("string"==typeof a.loadBalancingPolicy)b.loadBalancingPolicy=a.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in a)if(Array.isArray(a.loadBalancingConfig))for(let c of a.loadBalancingConfig)b.loadBalancingConfig.push((0,f.validateLoadBalancingConfig)(c));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in a&&Array.isArray(a.methodConfig))for(let c of a.methodConfig)b.methodConfig.push(l(c));"retryThrottling"in a&&(b.retryThrottling=m(a.retryThrottling));let c=[];for(let a of b.methodConfig)for(let b of a.name){for(let a of c)if(b.service===a.service&&b.method===a.method)throw Error(`Invalid service config: duplicate name ${b.service}/${b.method}`);c.push(b)}return b}function o(a){if(!("serviceConfig"in a))throw Error("Invalid service config choice: missing service config");let b={serviceConfig:n(a.serviceConfig)};if("clientLanguage"in a)if(Array.isArray(a.clientLanguage))for(let c of(b.clientLanguage=[],a.clientLanguage))if("string"==typeof c)b.clientLanguage.push(c);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in a)if(Array.isArray(a.clientHostname))for(let c of(b.clientHostname=[],a.clientHostname))if("string"==typeof c)b.clientHostname.push(c);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in a)if("number"==typeof a.percentage&&0<=a.percentage&&a.percentage<=100)b.percentage=a.percentage;else throw Error("Invalid service config choice: invalid percentage");let c=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let b in a)if(!c.includes(b))throw Error(`Invalid service config choice: unexpected field ${b}`);return b}function p(a,b){if(!Array.isArray(a))throw Error("Invalid service config list");for(let c of a){let a=o(c);if("number"!=typeof a.percentage||!(b>a.percentage)){if(Array.isArray(a.clientHostname)){let b=!1;for(let c of a.clientHostname)c===d.hostname()&&(b=!0);if(!b)continue}if(Array.isArray(a.clientLanguage)){let b=!1;for(let c of a.clientLanguage)c===h&&(b=!0);if(!b)continue}return a.serviceConfig}}throw Error("No matching service config found")}c.validateRetryThrottling=m,c.validateServiceConfig=n,c.extractAndSelectServiceConfig=function(a,b){for(let c of a)if(c.length>0&&c[0].startsWith("grpc_config="))return p(JSON.parse(c.join("").substring(12)),b);return null}},56537,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.ConnectivityState=void 0,function(a){a[a.IDLE=0]="IDLE",a[a.CONNECTING=1]="CONNECTING",a[a.READY=2]="READY",a[a.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",a[a.SHUTDOWN=4]="SHUTDOWN"}(d||(c.ConnectivityState=d={}))},55647,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.uriToString=c.splitHostPort=c.parseUri=void 0;let d=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;c.parseUri=function(a){let b=d.exec(a);return null===b?null:{scheme:b[1],authority:b[2],path:b[3]}};let e=/^\d+$/;c.splitHostPort=function(a){if(a.startsWith("[")){let b=a.indexOf("]");if(-1===b)return null;let c=a.substring(1,b);if(-1===c.indexOf(":"))return null;if(!(a.length>b+1))return{host:c};if(":"!==a[b+1])return null;{let d=a.substring(b+2);return e.test(d)?{host:c,port:+d}:null}}{let b=a.split(":");return 2!==b.length?{host:a}:e.test(b[1])?{host:b[0],port:+b[1]}:null}},c.uriToString=function(a){let b="";return void 0!==a.scheme&&(b+=a.scheme+":"),void 0!==a.authority&&(b+="//"+a.authority+"/"),b+=a.path}},49845,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.mapUriDefaultScheme=c.getDefaultAuthority=c.createResolver=c.registerDefaultScheme=c.registerResolver=void 0;let d=a.r(55647),e={},f=null;c.registerResolver=function(a,b){e[a]=b},c.registerDefaultScheme=function(a){f=a},c.createResolver=function(a,b,c){if(void 0!==a.scheme&&a.scheme in e)return new e[a.scheme](a,b,c);throw Error(`No resolver could be created for target ${(0,d.uriToString)(a)}`)},c.getDefaultAuthority=function(a){if(void 0!==a.scheme&&a.scheme in e)return e[a.scheme].getDefaultAuthority(a);throw Error(`Invalid target ${(0,d.uriToString)(a)}`)},c.mapUriDefaultScheme=function(a){if(void 0===a.scheme||!(a.scheme in e))if(null!==f)return{scheme:f,authority:void 0,path:(0,d.uriToString)(a)};else return null;return a}},3681,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.QueuePicker=c.UnavailablePicker=c.PickResultType=void 0;let e=a.r(57904),f=a.r(57982);!function(a){a[a.COMPLETE=0]="COMPLETE",a[a.QUEUE=1]="QUEUE",a[a.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",a[a.DROP=3]="DROP"}(d||(c.PickResultType=d={}));class g{constructor(a){this.status=Object.assign({code:f.Status.UNAVAILABLE,details:"No connection established",metadata:new e.Metadata},a)}pick(a){return{pickResultType:d.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}c.UnavailablePicker=g;class h{constructor(a){this.loadBalancer=a,this.calledExitIdle=!1}pick(a){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:d.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}c.QueuePicker=h},57451,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BackoffTimeout=void 0;let d=1e3,e=1.6,f=12e4,g=.2;function h(a,b){return Math.random()*(b-a)+a}class i{constructor(a,b){this.callback=a,this.initialDelay=d,this.multiplier=e,this.maxDelay=f,this.jitter=g,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,b&&(b.initialDelay&&(this.initialDelay=b.initialDelay),b.multiplier&&(this.multiplier=b.multiplier),b.jitter&&(this.jitter=b.jitter),b.maxDelay&&(this.maxDelay=b.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(a){var b,c;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},a),this.hasRef||null==(c=(b=this.timerId).unref)||c.call(b)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let a=Math.min(this.nextDelay*this.multiplier,this.maxDelay),b=a*this.jitter;this.nextDelay=a+h(-b,b)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let a=new Date,b=this.startTime;b.setMilliseconds(b.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),a<b?this.runTimer(b.getTime()-a.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var a,b;this.hasRef=!0,null==(b=(a=this.timerId).ref)||b.call(a)}unref(){var a,b;this.hasRef=!1,null==(b=(a=this.timerId).unref)||b.call(a)}getEndTime(){return this.endTime}}c.BackoffTimeout=i},33140,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChildLoadBalancerHandler=void 0;let d=a.r(39071),e=a.r(56537),f="child_load_balancer_helper";class g{constructor(a){this.channelControlHelper=a,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(a){this.parent=a,this.child=null}createSubchannel(a,b){return this.parent.channelControlHelper.createSubchannel(a,b)}updateState(a,b){var c;if(this.calledByPendingChild()){if(a===e.ConnectivityState.CONNECTING)return;null==(c=this.parent.currentChild)||c.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(a,b)}requestReresolution(){var a;let b=null!=(a=this.parent.pendingChild)?a:this.parent.currentChild;this.child===b&&this.parent.channelControlHelper.requestReresolution()}setChild(a){this.child=a}addChannelzChild(a){this.parent.channelControlHelper.addChannelzChild(a)}removeChannelzChild(a){this.parent.channelControlHelper.removeChannelzChild(a)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(a,b){return a.getLoadBalancerName()!==b.getLoadBalancerName()}updateAddressList(a,b,c){let e;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,b)){let a=new this.ChildPolicyHelper(this),c=(0,d.createLoadBalancer)(b,a);a.setChild(c),null===this.currentChild?(this.currentChild=c,e=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=c,e=this.pendingChild)}else e=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=b,e.updateAddressList(a,b,c)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return f}}c.ChildLoadBalancerHandler=g},74765,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingLoadBalancer=void 0;let d=a.r(39071),e=a.r(83931),f=a.r(56537),g=a.r(49845),h=a.r(3681),i=a.r(57451),j=a.r(57982),k=a.r(57904),l=a.r(11717),m=a.r(57982),n=a.r(55647),o=a.r(33140),p="resolving_load_balancer";function q(a){l.trace(m.LogVerbosity.DEBUG,p,a)}let r=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function s(a,b,c,d){for(let e of c.name)switch(d){case"EMPTY":if(!e.service&&!e.method)return!0;break;case"SERVICE":if(e.service===a&&!e.method)return!0;break;case"SERVICE_AND_METHOD":if(e.service===a&&e.method===b)return!0}return!1}function t(a,b,c,d){for(let e of c)if(s(a,b,e,d))return e;return null}function u(a){return function(b,c){var d,e;let f=b.split("/").filter(a=>a.length>0),g=null!=(d=f[0])?d:"",h=null!=(e=f[1])?e:"";if(a&&a.methodConfig)for(let b of r){let c=t(g,h,a.methodConfig,b);if(c)return{methodConfig:c,pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}}class v{constructor(a,b,c,l,m){this.target=a,this.channelControlHelper=b,this.onSuccessfulResolution=l,this.onFailedResolution=m,this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,c["grpc.service_config"]?this.defaultServiceConfig=(0,e.validateServiceConfig)(JSON.parse(c["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(f.ConnectivityState.IDLE,new h.QueuePicker(this)),this.childLoadBalancer=new o.ChildLoadBalancerHandler({createSubchannel:b.createSubchannel.bind(b),requestReresolution:()=>{this.backoffTimeout.isRunning()?(q("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,b)=>{this.latestChildState=a,this.latestChildPicker=b,this.updateState(a,b)},addChannelzChild:b.addChannelzChild.bind(b),removeChannelzChild:b.removeChannelzChild.bind(b)}),this.innerResolver=(0,g.createResolver)(a,{onSuccessfulResolution:(a,b,c,e,f)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let h=null;null===b?null===c?(this.previousServiceConfig=null,h=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(c):h=this.previousServiceConfig:(h=b,this.previousServiceConfig=b);let i=null!=(g=null==h?void 0:h.loadBalancingConfig)?g:[],l=(0,d.getFirstUsableConfig)(i,!0);if(null===l)return void this.handleResolutionFailure({code:j.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new k.Metadata});this.childLoadBalancer.updateAddressList(a,l,f);let m=null!=h?h:this.defaultServiceConfig;this.onSuccessfulResolution(m,null!=e?e:u(m))},onError:a=>{this.handleResolutionFailure(a)}},c);const n={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},n),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===f.ConnectivityState.IDLE&&this.updateState(f.ConnectivityState.CONNECTING,new h.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(a,b){q((0,n.uriToString)(this.target)+" "+f.ConnectivityState[this.currentState]+" -> "+f.ConnectivityState[a]),a===f.ConnectivityState.IDLE&&(b=new h.QueuePicker(this)),this.currentState=a,this.channelControlHelper.updateState(a,b)}handleResolutionFailure(a){this.latestChildState===f.ConnectivityState.IDLE&&(this.updateState(f.ConnectivityState.TRANSIENT_FAILURE,new h.UnavailablePicker(a)),this.onFailedResolution(a))}exitIdle(){(this.currentState===f.ConnectivityState.IDLE||this.currentState===f.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(a,b){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}c.ResolvingLoadBalancer=v},69359,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.channelOptionsEqual=c.recognizedOptions=void 0,c.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},c.channelOptionsEqual=function(a,b){let c=Object.keys(a).sort(),d=Object.keys(b).sort();if(c.length!==d.length)return!1;for(let e=0;e<c.length;e+=1)if(c[e]!==d[e]||a[c[e]]!==b[d[e]])return!1;return!0}},91177,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.stringToSubchannelAddress=c.subchannelAddressToString=c.subchannelAddressEqual=c.isTcpSubchannelAddress=void 0;let d=a.r(4446);function e(a){return"port"in a}c.isTcpSubchannelAddress=e,c.subchannelAddressEqual=function(a,b){return!a&&!b||!!a&&!!b&&(e(a)?e(b)&&a.host===b.host&&a.port===b.port:!e(b)&&a.path===b.path)},c.subchannelAddressToString=function(a){return e(a)?a.host+":"+a.port:a.path};let f=443;c.stringToSubchannelAddress=function(a,b){return(0,d.isIP)(a)?{host:a,port:null!=b?b:f}:{path:a}}},31509,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addAdminServicesToServer=c.registerAdminService=void 0;let d=[];c.registerAdminService=function(a,b){d.push({getServiceDefinition:a,getHandlers:b})},c.addAdminServicesToServer=function(a){for(let{getServiceDefinition:b,getHandlers:c}of d)a.addService(b(),c())}},51985,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ClientDuplexStreamImpl=c.ClientWritableStreamImpl=c.ClientReadableStreamImpl=c.ClientUnaryCallImpl=c.callErrorFromStatus=void 0;let d=a.r(27699),e=a.r(88947),f=a.r(57982);c.callErrorFromStatus=function(a,b){let c=`${a.code} ${f.Status[a.code]}: ${a.details}`,d=Error(c),e=`${d.stack}
for call at
${b}`;return Object.assign(Error(c),a,{stack:e})};class g extends d.EventEmitter{constructor(){super()}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}}c.ClientUnaryCallImpl=g;class h extends e.Readable{constructor(a){super({objectMode:!0}),this.deserialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}}c.ClientReadableStreamImpl=h;class i extends e.Writable{constructor(a){super({objectMode:!0}),this.serialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientWritableStreamImpl=i;class j extends e.Duplex{constructor(a,b){super({objectMode:!0}),this.serialize=a,this.deserialize=b}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientDuplexStreamImpl=j},5628,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InterceptingListenerImpl=c.isInterceptingListener=void 0,c.isInterceptingListener=function(a){return void 0!==a.onReceiveMetadata&&1===a.onReceiveMetadata.length};class d{constructor(a,b){this.listener=a,this.nextListener=b,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(a){this.processingMetadata=!0,this.listener.onReceiveMetadata(a,a=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(a),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(a){this.processingMessage=!0,this.listener.onReceiveMessage(a,a=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=a,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(a),this.processPendingStatus())})}onReceiveStatus(a){this.listener.onReceiveStatus(a,a=>{this.processingMetadata||this.processingMessage?this.pendingStatus=a:this.nextListener.onReceiveStatus(a)})}}c.InterceptingListenerImpl=d},83278,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getInterceptingCall=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.InterceptorConfigurationError=void 0;let d=a.r(57904),e=a.r(5628),f=a.r(57982),g=a.r(21015);class h extends Error{constructor(a){super(a),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,h)}}c.InterceptorConfigurationError=h;class i{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(a){return this.metadata=a,this}withOnReceiveMessage(a){return this.message=a,this}withOnReceiveStatus(a){return this.status=a,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}c.ListenerBuilder=i;class j{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(a){return this.start=a,this}withSendMessage(a){return this.message=a,this}withHalfClose(a){return this.halfClose=a,this}withCancel(a){return this.cancel=a,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}c.RequesterBuilder=j;let k=(a,b)=>{b(a)},l=(a,b)=>{b(a)},m=(a,b)=>{b(a)},n={start:(a,b,c)=>{c(a,b)},sendMessage:(a,b)=>{b(a)},halfClose:a=>{a()},cancel:a=>{a()}};class o{constructor(a,b){var c,d,e,f;this.nextCall=a,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,b?this.requester={start:null!=(c=b.start)?c:n.start,sendMessage:null!=(d=b.sendMessage)?d:n.sendMessage,halfClose:null!=(e=b.halfClose)?e:n.halfClose,cancel:null!=(f=b.cancel)?f:n.cancel}:this.requester=n}cancelWithStatus(a,b){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(a,b)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(a,b){var c,d,f,g,h,i;let j={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:null!=(g=null==(f=null==b?void 0:b.onReceiveMessage)?void 0:f.bind(b))?g:a=>{},onReceiveStatus:null!=(i=null==(h=null==b?void 0:b.onReceiveStatus)?void 0:h.bind(b))?i:a=>{}};this.processingMetadata=!0,this.requester.start(a,j,(a,b)=>{var c,d,f;let g;if(this.processingMetadata=!1,(0,e.isInterceptingListener)(b))g=b;else{let a={onReceiveMetadata:null!=(c=b.onReceiveMetadata)?c:k,onReceiveMessage:null!=(d=b.onReceiveMessage)?d:l,onReceiveStatus:null!=(f=b.onReceiveStatus)?f:m};g=new e.InterceptingListenerImpl(a,j)}this.nextCall.start(a,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(a,b){this.processingMessage=!0,this.requester.sendMessage(b,c=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=a,this.pendingMessage=b):(this.nextCall.sendMessageWithContext(a,c),this.processPendingHalfClose())})}sendMessage(a){this.sendMessageWithContext({},a)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(a,b,c){var d,e;let f=null!=(d=c.deadline)?d:1/0,g=c.host,h=null!=(e=c.parent)?e:null,i=c.propagate_flags,j=c.credentials,k=a.createCall(b,f,g,h,i);return j&&k.setCredentials(j),k}c.InterceptingCall=o;class q{constructor(a,b){this.call=a,this.methodDefinition=b}cancelWithStatus(a,b){this.call.cancelWithStatus(a,b)}getPeer(){return this.call.getPeer()}sendMessageWithContext(a,b){let c;try{c=this.methodDefinition.requestSerialize(b)}catch(a){this.call.cancelWithStatus(f.Status.INTERNAL,`Request message serialization failure: ${(0,g.getErrorMessage)(a)}`);return}this.call.sendMessageWithContext(a,c)}sendMessage(a){this.sendMessageWithContext({},a)}start(a,b){let c=null;this.call.start(a,{onReceiveMetadata:a=>{var c;null==(c=null==b?void 0:b.onReceiveMetadata)||c.call(b,a)},onReceiveMessage:a=>{var e;let h;try{h=this.methodDefinition.responseDeserialize(a)}catch(a){c={code:f.Status.INTERNAL,details:`Response message parsing error: ${(0,g.getErrorMessage)(a)}`,metadata:new d.Metadata},this.call.cancelWithStatus(c.code,c.details);return}null==(e=null==b?void 0:b.onReceiveMessage)||e.call(b,h)},onReceiveStatus:a=>{var d,e;c?null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,c):null==(e=null==b?void 0:b.onReceiveStatus)||e.call(b,a)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class r extends q{constructor(a,b){super(a,b)}start(a,b){var c,d;let e=!1,f={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:a=>{var c;e=!0,null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,a)},onReceiveStatus:a=>{var c,d;e||null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,null),null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,a)}};super.start(a,f),this.call.startRead()}}class s extends q{}function t(a,b,c){let d=p(a,c.path,b);return c.responseStream?new s(d,c):new r(d,c)}c.getInterceptingCall=function(a,b,c,d){if(a.clientInterceptors.length>0&&a.clientInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(a.callInterceptors.length>0&&a.callInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let e=[];e=a.callInterceptors.length>0||a.callInterceptorProviders.length>0?[].concat(a.callInterceptors,a.callInterceptorProviders.map(a=>a(b))).filter(a=>a):[].concat(a.clientInterceptors,a.clientInterceptorProviders.map(a=>a(b))).filter(a=>a);let f=Object.assign({},c,{method_definition:b});return e.reduceRight((a,b)=>c=>b(c,a),a=>t(d,a,b))(f)}},19856,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Client=void 0;let d=a.r(51985),e=a.r(61655),f=a.r(56537),g=a.r(57982),h=a.r(57904),i=a.r(83278),j=Symbol(),k=Symbol(),l=Symbol(),m=Symbol();function n(a){return"function"==typeof a}function o(a){return a.stack.split("\n").slice(1).join("\n")}class p{constructor(a,b,c={}){var d,f;if(c=Object.assign({},c),this[k]=null!=(d=c.interceptors)?d:[],delete c.interceptors,this[l]=null!=(f=c.interceptor_providers)?f:[],delete c.interceptor_providers,this[k].length>0&&this[l].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[m]=c.callInvocationTransformer,delete c.callInvocationTransformer,c.channelOverride)this[j]=c.channelOverride;else if(c.channelFactoryOverride){const d=c.channelFactoryOverride;delete c.channelFactoryOverride,this[j]=d(a,b,c)}else this[j]=new e.ChannelImplementation(a,b,c)}close(){this[j].close()}getChannel(){return this[j]}waitForReady(a,b){let c=d=>{let e;if(d)return void b(Error("Failed to connect before the deadline"));try{e=this[j].getConnectivityState(!0)}catch(a){b(Error("The channel has been closed"));return}if(e===f.ConnectivityState.READY)b();else try{this[j].watchConnectivityState(e,a,c)}catch(a){b(Error("The channel has been closed"))}};setImmediate(c)}checkOptionalUnaryResponseArguments(a,b,c){if(n(a))return{metadata:new h.Metadata,options:{},callback:a};if(n(b))if(a instanceof h.Metadata)return{metadata:a,options:{},callback:b};else return{metadata:new h.Metadata,options:a,callback:b};if(!(a instanceof h.Metadata&&b instanceof Object&&n(c)))throw Error("Incorrect arguments passed");return{metadata:a,options:b,callback:c}}makeUnaryRequest(a,b,c,e,f,h,n){var p,q;let r=this.checkOptionalUnaryResponseArguments(f,h,n),s={path:a,requestStream:!1,responseStream:!1,requestSerialize:b,responseDeserialize:c},t={argument:e,metadata:r.metadata,call:new d.ClientUnaryCallImpl,channel:this[j],methodDefinition:s,callOptions:r.options,callback:r.callback};this[m]&&(t=this[m](t));let u=t.call,v={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(p=t.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(q=t.callOptions.interceptor_providers)?q:[]},w=(0,i.getInterceptingCall)(v,t.methodDefinition,t.callOptions,t.channel);u.call=w;let x=null,y=!1,z=Error();return w.start(t.metadata,{onReceiveMetadata:a=>{u.emit("metadata",a)},onReceiveMessage(a){null!==x&&w.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),x=a},onReceiveStatus(a){if(!y){if(y=!0,a.code===g.Status.OK)if(null===x){let b=o(z);t.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else t.callback(null,x);else{let b=o(z);t.callback((0,d.callErrorFromStatus)(a,b))}z=null,u.emit("status",a)}}}),w.sendMessage(e),w.halfClose(),u}makeClientStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkOptionalUnaryResponseArguments(e,f,h),r={path:a,requestStream:!0,responseStream:!1,requestSerialize:b,responseDeserialize:c},s={metadata:q.metadata,call:new d.ClientWritableStreamImpl(b),channel:this[j],methodDefinition:r,callOptions:q.options,callback:q.callback};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=null,x=!1,y=Error();return v.start(s.metadata,{onReceiveMetadata:a=>{t.emit("metadata",a)},onReceiveMessage(a){null!==w&&v.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),w=a},onReceiveStatus(a){if(!x){if(x=!0,a.code===g.Status.OK)if(null===w){let b=o(y);s.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else s.callback(null,w);else{let b=o(y);s.callback((0,d.callErrorFromStatus)(a,b))}y=null,t.emit("status",a)}}}),t}checkMetadataAndOptions(a,b){let c,d;return a instanceof h.Metadata?(c=a,d=b||{}):(d=a||{},c=new h.Metadata),{metadata:c,options:d}}makeServerStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkMetadataAndOptions(f,h),r={path:a,requestStream:!1,responseStream:!0,requestSerialize:b,responseDeserialize:c},s={argument:e,metadata:q.metadata,call:new d.ClientReadableStreamImpl(c),channel:this[j],methodDefinition:r,callOptions:q.options};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=!1,x=Error();return v.start(s.metadata,{onReceiveMetadata(a){t.emit("metadata",a)},onReceiveMessage(a){t.push(a)},onReceiveStatus(a){if(!w){if(w=!0,t.push(null),a.code!==g.Status.OK){let b=o(x);t.emit("error",(0,d.callErrorFromStatus)(a,b))}x=null,t.emit("status",a)}}}),v.sendMessage(e),v.halfClose(),t}makeBidiStreamRequest(a,b,c,e,f){var h,n;let p=this.checkMetadataAndOptions(e,f),q={path:a,requestStream:!0,responseStream:!0,requestSerialize:b,responseDeserialize:c},r={metadata:p.metadata,call:new d.ClientDuplexStreamImpl(b,c),channel:this[j],methodDefinition:q,callOptions:p.options};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(h=r.callOptions.interceptors)?h:[],callInterceptorProviders:null!=(n=r.callOptions.interceptor_providers)?n:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=!1,w=Error();return u.start(r.metadata,{onReceiveMetadata(a){s.emit("metadata",a)},onReceiveMessage(a){s.push(a)},onReceiveStatus(a){if(!v){if(v=!0,s.push(null),a.code!==g.Status.OK){let b=o(w);s.emit("error",(0,d.callErrorFromStatus)(a,b))}w=null,s.emit("status",a)}}}),s}}c.Client=p},80721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.loadPackageDefinition=c.makeClientConstructor=void 0;let d=a.r(19856),e={unary:d.Client.prototype.makeUnaryRequest,server_stream:d.Client.prototype.makeServerStreamRequest,client_stream:d.Client.prototype.makeClientStreamRequest,bidi:d.Client.prototype.makeBidiStreamRequest};function f(a){return["__proto__","prototype","constructor"].includes(a)}function g(a,b,c){c||(c={});class g extends d.Client{}return Object.keys(a).forEach(b=>{let c;if(f(b))return;let d=a[b];if("string"==typeof b&&"$"===b.charAt(0))throw Error("Method names cannot start with $");c=d.requestStream?d.responseStream?"bidi":"client_stream":d.responseStream?"server_stream":"unary";let i=d.requestSerialize,j=d.responseDeserialize,k=h(e[c],d.path,i,j);g.prototype[b]=k,Object.assign(g.prototype[b],d),d.originalName&&!f(d.originalName)&&(g.prototype[d.originalName]=g.prototype[b])}),g.service=a,g.serviceName=b,g}function h(a,b,c,d){return function(...e){return a.call(this,b,c,d,...e)}}function i(a){return"format"in a}c.makeClientConstructor=g,c.loadPackageDefinition=function(a){let b={};for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],e=c.split(".");if(e.some(a=>f(a)))continue;let h=e[e.length-1],j=b;for(let a of e.slice(0,-1))j[a]||(j[a]={}),j=j[a];i(d)?j[h]=d:j[h]=g(d,h,{})}return b}},77802,(a,b,c)=>{var d=1/0,e="[object Symbol]",f=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,h="\\ud800-\\udfff",i="\\u0300-\\u036f\\ufe20-\\ufe23",j="\\u20d0-\\u20f0",k="\\u2700-\\u27bf",l="a-z\\xdf-\\xf6\\xf8-\\xff",m="A-Z\\xc0-\\xd6\\xd8-\\xde",n="\\ufe0e\\ufe0f",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="['â€™]",q="["+h+"]",r="["+o+"]",s="["+i+j+"]",t="\\d+",u="["+k+"]",v="["+l+"]",w="[^"+h+o+t+k+l+m+"]",x="\\ud83c[\\udffb-\\udfff]",y="[^"+h+"]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",A="[\\ud800-\\udbff][\\udc00-\\udfff]",B="["+m+"]",C="\\u200d",D="(?:"+v+"|"+w+")",E="(?:"+B+"|"+w+")",F="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",G="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",H="(?:"+s+"|"+x+")?",I="["+n+"]?",J="(?:"+C+"(?:"+[y,z,A].join("|")+")"+I+H+")*",K=I+H+J,L="(?:"+[u,z,A].join("|")+")"+K,M="(?:"+[y+s+"?",s,z,A,q].join("|")+")",N=RegExp(p,"g"),O=RegExp(s,"g"),P=RegExp(x+"(?="+x+")|"+M+K,"g"),Q=RegExp([B+"?"+v+"+"+F+"(?="+[r,B,"$"].join("|")+")",E+"+"+G+"(?="+[r,B+D,"$"].join("|")+")",B+"?"+D+"+"+F,B+"+"+G,t,L].join("|"),"g"),R=RegExp("["+C+h+i+j+n+"]"),S=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,T={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"ss"},U=a.g&&a.g.Object===Object&&a.g,V="object"==typeof self&&self&&self.Object===Object&&self,W=U||V||Function("return this")();function X(a,b,c,d){var e=-1,f=a?a.length:0;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function Y(a){return a.split("")}function Z(a){return a.match(f)||[]}var $=function(a){return function(b){return null==a?void 0:a[b]}}(T);function _(a){return R.test(a)}function aa(a){return S.test(a)}function ab(a){return _(a)?ac(a):Y(a)}function ac(a){return a.match(P)||[]}function ad(a){return a.match(Q)||[]}var ae=Object.prototype.toString,af=W.Symbol,ag=af?af.prototype:void 0,ah=ag?ag.toString:void 0;function ai(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function aj(a){if("string"==typeof a)return a;if(an(a))return ah?ah.call(a):"";var b=a+"";return"0"==b&&1/a==-d?"-0":b}function ak(a,b,c){var d=a.length;return c=void 0===c?d:c,!b&&c>=d?a:ai(a,b,c)}function al(a){return function(b){var c=_(b=ao(b))?ab(b):void 0,d=c?c[0]:b.charAt(0),e=c?ak(c,1).join(""):b.slice(1);return d[a]()+e}}function am(a){return!!a&&"object"==typeof a}function an(a){return"symbol"==typeof a||am(a)&&ae.call(a)==e}function ao(a){return null==a?"":aj(a)}var ap=function(a){return function(b){return X(at(ar(b).replace(N,"")),a,"")}}(function(a,b,c){return b=b.toLowerCase(),a+(c?aq(b):b)});function aq(a){return as(ao(a).toLowerCase())}function ar(a){return(a=ao(a))&&a.replace(g,$).replace(O,"")}var as=al("toUpperCase");function at(a,b,c){return(a=ao(a),void 0===(b=c?void 0:b))?aa(a)?ad(a):Z(a):a.match(b)||[]}b.exports=ap},96146,(a,b,c)=>{"use strict";b.exports=function a(a,b){for(var c=Array(arguments.length-1),d=0,e=2,f=!0;e<arguments.length;)c[d++]=arguments[e++];return new Promise(function(e,g){c[d]=function(a){if(f)if(f=!1,a)g(a);else{for(var b=Array(arguments.length-1),c=0;c<b.length;)b[c++]=arguments[c];e.apply(null,b)}};try{a.apply(b||null,c)}catch(a){f&&(f=!1,g(a))}})}},28344,(a,b,c)=>{"use strict";var d=c;d.length=function(a){var b=a.length;if(!b)return 0;for(var c=0;--b%4>1&&"="===a.charAt(b);)++c;return Math.ceil(3*a.length)/4-c};for(var e=Array(64),f=Array(123),g=0;g<64;)f[e[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;d.encode=function(a,b,c){for(var d,f=null,g=[],h=0,i=0;b<c;){var j=a[b++];switch(i){case 0:g[h++]=e[j>>2],d=(3&j)<<4,i=1;break;case 1:g[h++]=e[d|j>>4],d=(15&j)<<2,i=2;break;case 2:g[h++]=e[d|j>>6],g[h++]=e[63&j],i=0}h>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),h=0)}return(i&&(g[h++]=e[d],g[h++]=61,1===i&&(g[h++]=61)),f)?(h&&f.push(String.fromCharCode.apply(String,g.slice(0,h))),f.join("")):String.fromCharCode.apply(String,g.slice(0,h))};var h="invalid encoding";d.decode=function(a,b,c){for(var d,e=c,g=0,i=0;i<a.length;){var j=a.charCodeAt(i++);if(61===j&&g>1)break;if(void 0===(j=f[j]))throw Error(h);switch(g){case 0:d=j,g=1;break;case 1:b[c++]=d<<2|(48&j)>>4,d=j,g=2;break;case 2:b[c++]=(15&d)<<4|(60&j)>>2,d=j,g=3;break;case 3:b[c++]=(3&d)<<6|j,g=0}}if(1===g)throw Error(h);return c-e},d.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},38588,(a,b,c)=>{"use strict";function d(){this._listeners={}}b.exports=d,d.prototype.on=function(a,b,c){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:b,ctx:c||this}),this},d.prototype.off=function(a,b){if(void 0===a)this._listeners={};else if(void 0===b)this._listeners[a]=[];else for(var c=this._listeners[a],d=0;d<c.length;)c[d].fn===b?c.splice(d,1):++d;return this},d.prototype.emit=function(a){var b=this._listeners[a];if(b){for(var c=[],d=1;d<arguments.length;)c.push(arguments[d++]);for(d=0;d<b.length;)b[d].fn.apply(b[d++].ctx,c)}return this}},40830,(a,b,c)=>{"use strict";function d(a){return"u">typeof Float32Array?!function(){var b=new Float32Array([-0]),c=new Uint8Array(b.buffer),d=128===c[3];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3]}function f(a,d,e){b[0]=a,d[e]=c[3],d[e+1]=c[2],d[e+2]=c[1],d[e+3]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],b[0]}function h(a,d){return c[3]=a[d],c[2]=a[d+1],c[1]=a[d+2],c[0]=a[d+3],b[0]}a.writeFloatLE=d?e:f,a.writeFloatBE=d?f:e,a.readFloatLE=d?g:h,a.readFloatBE=d?h:g}():!function(){function b(a,b,c,d){var e=+(b<0);if(e&&(b=-b),0===b)a(1/b>0?0:0x80000000,c,d);else if(isNaN(b))a(0x7fc00000,c,d);else if(b>34028234663852886e22)a((e<<31|0x7f800000)>>>0,c,d);else if(b<11754943508222875e-54)a((e<<31|Math.round(b/1401298464324817e-60))>>>0,c,d);else{var f=Math.floor(Math.log(b)/Math.LN2),g=8388607&Math.round(b*Math.pow(2,-f)*8388608);a((e<<31|f+127<<23|g)>>>0,c,d)}}function c(a,b,c){var d=a(b,c),e=(d>>31)*2+1,f=d>>>23&255,g=8388607&d;return 255===f?g?NaN:1/0*e:0===f?1401298464324817e-60*e*g:e*Math.pow(2,f-150)*(g+8388608)}a.writeFloatLE=b.bind(null,e),a.writeFloatBE=b.bind(null,f),a.readFloatLE=c.bind(null,g),a.readFloatBE=c.bind(null,h)}(),"u">typeof Float64Array?!function(){var b=new Float64Array([-0]),c=new Uint8Array(b.buffer),d=128===c[7];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3],d[e+4]=c[4],d[e+5]=c[5],d[e+6]=c[6],d[e+7]=c[7]}function f(a,d,e){b[0]=a,d[e]=c[7],d[e+1]=c[6],d[e+2]=c[5],d[e+3]=c[4],d[e+4]=c[3],d[e+5]=c[2],d[e+6]=c[1],d[e+7]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],c[4]=a[d+4],c[5]=a[d+5],c[6]=a[d+6],c[7]=a[d+7],b[0]}function h(a,d){return c[7]=a[d],c[6]=a[d+1],c[5]=a[d+2],c[4]=a[d+3],c[3]=a[d+4],c[2]=a[d+5],c[1]=a[d+6],c[0]=a[d+7],b[0]}a.writeDoubleLE=d?e:f,a.writeDoubleBE=d?f:e,a.readDoubleLE=d?g:h,a.readDoubleBE=d?h:g}():!function(){function b(a,b,c,d,e,f){var g,h=+(d<0);if(h&&(d=-d),0===d)a(0,e,f+b),a(1/d>0?0:0x80000000,e,f+c);else if(isNaN(d))a(0,e,f+b),a(0x7ff80000,e,f+c);else if(d>17976931348623157e292)a(0,e,f+b),a((h<<31|0x7ff00000)>>>0,e,f+c);else if(d<22250738585072014e-324)a((g=d/5e-324)>>>0,e,f+b),a((h<<31|g/0x100000000)>>>0,e,f+c);else{var i=Math.floor(Math.log(d)/Math.LN2);1024===i&&(i=1023),a(0x10000000000000*(g=d*Math.pow(2,-i))>>>0,e,f+b),a((h<<31|i+1023<<20|1048576*g&1048575)>>>0,e,f+c)}}function c(a,b,c,d,e){var f=a(d,e+b),g=a(d,e+c),h=(g>>31)*2+1,i=g>>>20&2047,j=0x100000000*(1048575&g)+f;return 2047===i?j?NaN:1/0*h:0===i?5e-324*h*j:h*Math.pow(2,i-1075)*(j+0x10000000000000)}a.writeDoubleLE=b.bind(null,e,0,4),a.writeDoubleBE=b.bind(null,f,4,0),a.readDoubleLE=c.bind(null,g,0,4),a.readDoubleBE=c.bind(null,h,4,0)}(),a}function e(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}function f(a,b,c){b[c]=a>>>24,b[c+1]=a>>>16&255,b[c+2]=a>>>8&255,b[c+3]=255&a}function g(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0}function h(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}b.exports=d(d)},68754,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},66298,(a,b,c)=>{"use strict";var d=c;d.length=function(a){for(var b=0,c=0,d=0;d<a.length;++d)(c=a.charCodeAt(d))<128?b+=1:c<2048?b+=2:(64512&c)==55296&&(64512&a.charCodeAt(d+1))==56320?(++d,b+=4):b+=3;return b},d.read=function(a,b,c){if(c-b<1)return"";for(var d,e=null,f=[],g=0;b<c;)(d=a[b++])<128?f[g++]=d:d>191&&d<224?f[g++]=(31&d)<<6|63&a[b++]:d>239&&d<365?(d=((7&d)<<18|(63&a[b++])<<12|(63&a[b++])<<6|63&a[b++])-65536,f[g++]=55296+(d>>10),f[g++]=56320+(1023&d)):f[g++]=(15&d)<<12|(63&a[b++])<<6|63&a[b++],g>8191&&((e||(e=[])).push(String.fromCharCode.apply(String,f)),g=0);return e?(g&&e.push(String.fromCharCode.apply(String,f.slice(0,g))),e.join("")):String.fromCharCode.apply(String,f.slice(0,g))},d.write=function(a,b,c){for(var d,e,f=c,g=0;g<a.length;++g)(d=a.charCodeAt(g))<128?b[c++]=d:(d<2048?b[c++]=d>>6|192:((64512&d)==55296&&(64512&(e=a.charCodeAt(g+1)))==56320?(d=65536+((1023&d)<<10)+(1023&e),++g,b[c++]=d>>18|240,b[c++]=d>>12&63|128):b[c++]=d>>12|224,b[c++]=d>>6&63|128),b[c++]=63&d|128);return c-f}},82820,(a,b,c)=>{"use strict";b.exports=function a(a,b,c){var d=c||8192,e=d>>>1,f=null,g=d;return function(c){if(c<1||c>e)return a(c);g+c>d&&(f=a(d),g=0);var h=b.call(f,g,g+=c);return 7&g&&(g=(7|g)+1),h}}},87419,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(56678);function e(a,b){this.lo=a>>>0,this.hi=b>>>0}var f=e.zero=new e(0,0);f.toNumber=function(){return 0},f.zzEncode=f.zzDecode=function(){return this},f.length=function(){return 1};var g=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(a){if(0===a)return f;var b=a<0;b&&(a=-a);var c=a>>>0,d=(a-c)/0x100000000>>>0;return b&&(d=~d>>>0,c=~c>>>0,++c>0xffffffff&&(c=0,++d>0xffffffff&&(d=0))),new e(c,d)},e.from=function(a){if("number"==typeof a)return e.fromNumber(a);if(d.isString(a))if(!d.Long)return e.fromNumber(parseInt(a,10));else a=d.Long.fromString(a);return a.low||a.high?new e(a.low>>>0,a.high>>>0):f},e.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var b=~this.lo+1>>>0,c=~this.hi>>>0;return b||(c=c+1>>>0),-(b+0x100000000*c)}return this.lo+0x100000000*this.hi},e.prototype.toLong=function(a){return d.Long?new d.Long(0|this.lo,0|this.hi,!!a):{low:0|this.lo,high:0|this.hi,unsigned:!!a}};var h=String.prototype.charCodeAt;e.fromHash=function(a){return a===g?f:new e((h.call(a,0)|h.call(a,1)<<8|h.call(a,2)<<16|h.call(a,3)<<24)>>>0,(h.call(a,4)|h.call(a,5)<<8|h.call(a,6)<<16|h.call(a,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},e.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},e.prototype.length=function(){var a=this.lo,b=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return 0===c?0===b?a<16384?a<128?1:2:a<2097152?3:4:b<16384?b<128?5:6:b<2097152?7:8:c<128?9:10}},56678,(a,b,c)=>{"use strict";var d=c;function e(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;++e)void 0!==a[d[e]]&&c||(a[d[e]]=b[d[e]]);return a}function f(a){function b(a,c){if(!(this instanceof b))return new b(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:Error().stack||""}),c&&e(this,c)}return b.prototype=Object.create(Error.prototype,{constructor:{value:b,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),b}d.asPromise=a.r(96146),d.base64=a.r(28344),d.EventEmitter=a.r(38588),d.float=a.r(40830),d.inquire=a.r(68754),d.utf8=a.r(66298),d.pool=a.r(82820),d.LongBits=a.r(87419),d.isNode=!!(a.g&&a.g.process&&a.g.process.versions&&a.g.process.versions.node),d.global=d.isNode&&a.g||"u">typeof self&&self||a.e,d.emptyArray=Object.freeze?Object.freeze([]):[],d.emptyObject=Object.freeze?Object.freeze({}):{},d.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},d.isString=function(a){return"string"==typeof a||a instanceof String},d.isObject=function(a){return a&&"object"==typeof a},d.isset=d.isSet=function(a,b){var c=a[b];return!!(null!=c&&a.hasOwnProperty(b))&&("object"!=typeof c||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},d.Buffer=function(){try{var a=d.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch(a){return null}}(),d._Buffer_from=null,d._Buffer_allocUnsafe=null,d.newBuffer=function(a){return"number"==typeof a?d.Buffer?d._Buffer_allocUnsafe(a):new d.Array(a):d.Buffer?d._Buffer_from(a):"u"<typeof Uint8Array?a:new Uint8Array(a)},d.Array="u">typeof Uint8Array?Uint8Array:Array,d.Long=d.global.dcodeIO&&d.global.dcodeIO.Long||d.global.Long||d.inquire("long"),d.key2Re=/^true|false|0|1$/,d.key32Re=/^-?(?:0|[1-9][0-9]*)$/,d.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,d.longToHash=function(a){return a?d.LongBits.from(a).toHash():d.LongBits.zeroHash},d.longFromHash=function(a,b){var c=d.LongBits.fromHash(a);return d.Long?d.Long.fromBits(c.lo,c.hi,b):c.toNumber(!!b)},d.merge=e,d.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},d.newError=f,d.ProtocolError=f("ProtocolError"),d.oneOfGetter=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=1;return function(){for(var a=Object.keys(this),c=a.length-1;c>-1;--c)if(1===b[a[c]]&&void 0!==this[a[c]]&&null!==this[a[c]])return a[c]}},d.oneOfSetter=function(a){return function(b){for(var c=0;c<a.length;++c)a[c]!==b&&delete this[a[c]]}},d.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},d._configure=function(){var a=d.Buffer;if(!a){d._Buffer_from=d._Buffer_allocUnsafe=null;return}d._Buffer_from=a.from!==Uint8Array.from&&a.from||function(b,c){return new a(b,c)},d._Buffer_allocUnsafe=a.allocUnsafe||function(b){return new a(b)}}},57270,(a,b,c)=>{"use strict";b.exports={}},98873,(a,b,c)=>{"use strict";function d(a,b){"string"==typeof a&&(b=a,a=void 0);var c=[];function e(a){if("string"!=typeof a){var b=f();if(d.verbose&&console.log("codegen: "+b),b="return "+b,a){for(var g=Object.keys(a),h=Array(g.length+1),i=Array(g.length),j=0;j<g.length;)h[j]=g[j],i[j]=a[g[j++]];return h[j]=b,Function.apply(null,h).apply(null,i)}return Function(b)()}for(var k=Array(arguments.length-1),l=0;l<k.length;)k[l]=arguments[++l];if(l=0,a=a.replace(/%([%dfijs])/g,function(a,b){var c=k[l++];switch(b){case"d":case"f":return String(Number(c));case"i":return String(Math.floor(c));case"j":return JSON.stringify(c);case"s":return String(c)}return"%"}),l!==k.length)throw Error("parameter count mismatch");return c.push(a),e}function f(d){return"function "+(d||b||"")+"("+(a&&a.join(",")||"")+"){\n  "+c.join("\n  ")+"\n}"}return e.toString=f,e}b.exports=d,d.verbose=!1},6566,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(96146),e=a.r(68754)("fs");function f(a,b,c){return("function"==typeof b?(c=b,b={}):b||(b={}),c)?!b.xhr&&e&&e.readFile?e.readFile(a,function(d,e){return d&&"u">typeof XMLHttpRequest?f.xhr(a,b,c):d?c(d):c(null,b.binary?e:e.toString("utf8"))}):f.xhr(a,b,c):d(f,this,a,b)}f.xhr=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(0!==d.status&&200!==d.status)return c(Error("status "+d.status));if(b.binary){var a=d.response;if(!a){a=[];for(var e=0;e<d.responseText.length;++e)a.push(255&d.responseText.charCodeAt(e))}return c(null,"u">typeof Uint8Array?new Uint8Array(a):a)}return c(null,d.responseText)}},b.binary&&("overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),d.responseType="arraybuffer"),d.open("GET",a),d.send()}},7176,(a,b,c)=>{"use strict";var d=c,e=d.isAbsolute=function(a){return/^(?:\/|\w+:)/.test(a)},f=d.normalize=function(a){var b=(a=a.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),c=e(a),d="";c&&(d=b.shift()+"/");for(var f=0;f<b.length;)".."===b[f]?f>0&&".."!==b[f-1]?b.splice(--f,2):c?b.splice(f,1):++f:"."===b[f]?b.splice(f,1):++f;return d+b.join("/")};d.resolve=function(a,b,c){return(c||(b=f(b)),e(b))?b:(c||(a=f(a)),(a=a.replace(/(?:\/|^)[^/]+$/,"")).length?f(a+"/"+b):b)}},63421,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(70530);((l.prototype=Object.create(g.prototype)).constructor=l).className="Namespace";var h=a.r(66882),i=a.r(43806),j=a.r(55845);function k(a,b){if(a&&a.length){for(var c={},d=0;d<a.length;++d)c[a[d].name]=a[d].toJSON(b);return c}}function l(a,b){g.call(this,a,b),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function m(a){a._nestedArray=null,a._lookupCache={};for(var b=a;b=b.parent;)b._lookupCache={};return a}l.fromJSON=function(a,b){return new l(a,b.options).addJSON(b.nested)},l.arrayToJSON=k,l.isReservedId=function(a,b){if(a){for(var c=0;c<a.length;++c)if("string"!=typeof a[c]&&a[c][0]<=b&&a[c][1]>b)return!0}return!1},l.isReservedName=function(a,b){if(a){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=i.toArray(this.nested))}}),l.prototype.toJSON=function(a){return i.toObject(["options",this.options,"nested",k(this.nestedArray,a)])},l.prototype.addJSON=function(a){var b=this;if(a)for(var c,g=Object.keys(a),i=0;i<g.length;++i)c=a[g[i]],b.add((void 0!==c.fields?d.fromJSON:void 0!==c.values?f.fromJSON:void 0!==c.methods?e.fromJSON:void 0!==c.id?h.fromJSON:l.fromJSON)(g[i],c));return this},l.prototype.get=function(a){return this.nested&&this.nested[a]||null},l.prototype.getEnum=function(a){if(this.nested&&this.nested[a]instanceof f)return this.nested[a].values;throw Error("no such enum: "+a)},l.prototype.add=function(a){if(!(a instanceof h&&void 0!==a.extend||a instanceof d||a instanceof j||a instanceof f||a instanceof e||a instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var b=this.get(a.name);if(b)if(b instanceof l&&a instanceof l&&!(b instanceof d||b instanceof e)){for(var c=b.nestedArray,g=0;g<c.length;++g)a.add(c[g]);this.remove(b),this.nested||(this.nested={}),a.setOptions(b.options,!0)}else throw Error("duplicate name '"+a.name+"' in "+this)}else this.nested={};this.nested[a.name]=a,this instanceof d||this instanceof e||this instanceof f||this instanceof h||a._edition||(a._edition=a._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var i=this;i=i.parent;)i._needsRecursiveFeatureResolution=!0,i._needsRecursiveResolve=!0;return a.onAdd(this),m(this)},l.prototype.remove=function(a){if(!(a instanceof g))throw TypeError("object must be a ReflectionObject");if(a.parent!==this)throw Error(a+" is not a member of "+this);return delete this.nested[a.name],Object.keys(this.nested).length||(this.nested=void 0),a.onRemove(this),m(this)},l.prototype.define=function(a,b){if(i.isString(a))a=a.split(".");else if(!Array.isArray(a))throw TypeError("illegal path");if(a&&a.length&&""===a[0])throw Error("path must be relative");for(var c=this;a.length>0;){var d=a.shift();if(c.nested&&c.nested[d]){if(!((c=c.nested[d])instanceof l))throw Error("path conflicts with non-namespace objects")}else c.add(c=new l(d))}return b&&c.addJSON(b),c},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var a=this.nestedArray,b=0;for(this.resolve();b<a.length;)a[b]instanceof l?a[b++].resolveAll():a[b++].resolve();return this._needsRecursiveResolve=!1,this},l.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,a=this._edition||a,g.prototype._resolveFeaturesRecursive.call(this,a),this.nestedArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},l.prototype.lookup=function(a,b,c){if("boolean"==typeof b?(c=b,b=void 0):b&&!Array.isArray(b)&&(b=[b]),i.isString(a)&&a.length){if("."===a)return this.root;a=a.split(".")}else if(!a.length)return this;var d=a.join(".");if(""===a[0])return this.root.lookup(a.slice(1),b);var e=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+d];if(e&&(!b||b.indexOf(e.constructor)>-1)||(e=this._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;if(c)return null;for(var f=this;f.parent;){if((e=f.parent._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;f=f.parent}return null},l.prototype._lookupImpl=function(a,b){if(Object.prototype.hasOwnProperty.call(this._lookupCache,b))return this._lookupCache[b];var c=this.get(a[0]),d=null;if(c)1===a.length?d=c:c instanceof l&&(a=a.slice(1),d=c._lookupImpl(a,a.join(".")));else for(var e=0;e<this.nestedArray.length;++e)this._nestedArray[e]instanceof l&&(c=this._nestedArray[e]._lookupImpl(a,b))&&(d=c);return this._lookupCache[b]=d,d},l.prototype.lookupType=function(a){var b=this.lookup(a,[d]);if(!b)throw Error("no such type: "+a);return b},l.prototype.lookupEnum=function(a){var b=this.lookup(a,[f]);if(!b)throw Error("no such Enum '"+a+"' in "+this);return b},l.prototype.lookupTypeOrEnum=function(a){var b=this.lookup(a,[d,f]);if(!b)throw Error("no such Type or Enum '"+a+"' in "+this);return b},l.prototype.lookupService=function(a){var b=this.lookup(a,[e]);if(!b)throw Error("no such Service '"+a+"' in "+this);return b},l._configure=function(a,b,c){d=a,e=b,f=c}},38140,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(66882);((g.prototype=Object.create(d.prototype)).constructor=g).className="MapField";var e=a.r(62003),f=a.r(43806);function g(a,b,c,e,g,h){if(d.call(this,a,b,e,void 0,void 0,g,h),!f.isString(c))throw TypeError("keyType must be a string");this.keyType=c,this.resolvedKeyType=null,this.map=!0}g.fromJSON=function(a,b){return new g(a,b.id,b.keyType,b.type,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},g.prototype.resolve=function(){if(this.resolved)return this;if(void 0===e.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return d.prototype.resolve.call(this)},g.d=function(a,b,c){return"function"==typeof c?c=f.decorateType(c).name:c&&"object"==typeof c&&(c=f.decorateEnum(c).name),function(d,e){f.decorateType(d.constructor).add(new g(e,a,b,c))}}},70362,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(70530);((f.prototype=Object.create(d.prototype)).constructor=f).className="Method";var e=a.r(43806);function f(a,b,c,f,g,h,i,j,k){if(e.isObject(g)?(i=g,g=h=void 0):e.isObject(h)&&(i=h,h=void 0),!(void 0===b||e.isString(b)))throw TypeError("type must be a string");if(!e.isString(c))throw TypeError("requestType must be a string");if(!e.isString(f))throw TypeError("responseType must be a string");d.call(this,a,i),this.type=b||"rpc",this.requestType=c,this.requestStream=!!g||void 0,this.responseType=f,this.responseStream=!!h||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=j,this.parsedOptions=k}f.fromJSON=function(a,b){return new f(a,b.type,b.requestType,b.responseType,b.requestStream,b.responseStream,b.options,b.comment,b.parsedOptions)},f.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return e.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",b?this.comment:void 0,"parsedOptions",this.parsedOptions])},f.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),d.prototype.resolve.call(this))}},624,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(56678);function e(a,b,c){if("function"!=typeof a)throw TypeError("rpcImpl must be a function");d.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!b,this.responseDelimited=!!c}(e.prototype=Object.create(d.EventEmitter.prototype)).constructor=e,e.prototype.rpcCall=function a(b,c,e,f,g){if(!f)throw TypeError("request must be specified");var h=this;if(!g)return d.asPromise(a,h,b,c,e,f);if(!h.rpcImpl)return void setTimeout(function(){g(Error("already ended"))},0);try{return h.rpcImpl(b,c[h.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(a,c){if(a)return h.emit("error",a,b),g(a);if(null===c)return void h.end(!0);if(!(c instanceof e))try{c=e[h.responseDelimited?"decodeDelimited":"decode"](c)}catch(a){return h.emit("error",a,b),g(a)}return h.emit("data",c,b),g(null,c)})}catch(a){h.emit("error",a,b),setTimeout(function(){g(a)},0);return}},e.prototype.end=function(a){return this.rpcImpl&&(a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},87873,(a,b,c)=>{"use strict";c.Service=a.r(624)},87052,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(63421);((h.prototype=Object.create(d.prototype)).constructor=h).className="Service";var e=a.r(70362),f=a.r(43806),g=a.r(87873);function h(a,b){d.call(this,a,b),this.methods={},this._methodsArray=null}function i(a){return a._methodsArray=null,a}h.fromJSON=function(a,b){var c=new h(a,b.options);if(b.methods)for(var d=Object.keys(b.methods),f=0;f<d.length;++f)c.add(e.fromJSON(d[f],b.methods[d[f]]));return b.nested&&c.addJSON(b.nested),b.edition&&(c._edition=b.edition),c.comment=b.comment,c._defaultEdition="proto3",c},h.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"methods",d.arrayToJSON(this.methodsArray,a)||{},"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},Object.defineProperty(h.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=f.toArray(this.methods))}}),h.prototype.get=function(a){return this.methods[a]||d.prototype.get.call(this,a)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolve.call(this);for(var a=this.methodsArray,b=0;b<a.length;++b)a[b].resolve();return this},h.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.methodsArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},h.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);return a instanceof e?(this.methods[a.name]=a,a.parent=this,i(this)):d.prototype.add.call(this,a)},h.prototype.remove=function(a){if(a instanceof e){if(this.methods[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.methods[a.name],a.parent=null,i(this)}return d.prototype.remove.call(this,a)},h.prototype.create=function(a,b,c){for(var d,e=new g.Service(a,b,c),h=0;h<this.methodsArray.length;++h){var i=f.lcFirst((d=this._methodsArray[h]).resolve().name).replace(/[^$\w_]/g,"");e[i]=f.codegen(["r","c"],f.isReserved(i)?i+"_":i)("return this.rpcCall(m,q,s,r,c)")({m:d,q:d.resolvedRequestType.ctor,s:d.resolvedResponseType.ctor})}return e}},5995,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(56678);function e(a){if(a)for(var b=Object.keys(a),c=0;c<b.length;++c)this[b[c]]=a[b[c]]}e.create=function(a){return this.$type.create(a)},e.encode=function(a,b){return this.$type.encode(a,b)},e.encodeDelimited=function(a,b){return this.$type.encodeDelimited(a,b)},e.decode=function(a){return this.$type.decode(a)},e.decodeDelimited=function(a){return this.$type.decodeDelimited(a)},e.verify=function(a){return this.$type.verify(a)},e.fromObject=function(a){return this.$type.fromObject(a)},e.toObject=function(a,b){return this.$type.toObject(a,b)},e.prototype.toJSON=function(){return this.$type.toObject(this,d.toJSONOptions)}},24091,(a,b,c)=>{"use strict";b.exports=i;var d,e=a.r(56678),f=e.LongBits,g=e.utf8;function h(a,b){return RangeError("index out of range: "+a.pos+" + "+(b||1)+" > "+a.len)}function i(a){this.buf=a,this.pos=0,this.len=a.length}var j="u">typeof Uint8Array?function(a){if(a instanceof Uint8Array||Array.isArray(a))return new i(a);throw Error("illegal buffer")}:function(a){if(Array.isArray(a))return new i(a);throw Error("illegal buffer")},k=function(){return e.Buffer?function(a){return(i.create=function(a){return e.Buffer.isBuffer(a)?new d(a):j(a)})(a)}:j};function l(){var a=new f(0,0),b=0;if(this.len-this.pos>4){for(;b<4;++b)if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(127&this.buf[this.pos])<<28)>>>0,a.hi=(a.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return a;b=0}else{for(;b<3;++b){if(this.pos>=this.len)throw h(this);if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(127&this.buf[this.pos++])<<7*b)>>>0,a}if(this.len-this.pos>4){for(;b<5;++b)if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}else for(;b<5;++b){if(this.pos>=this.len)throw h(this);if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}function m(a,b){return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0}function n(){if(this.pos+8>this.len)throw h(this,8);return new f(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}i.create=k(),i.prototype._slice=e.Array.prototype.subarray||e.Array.prototype.slice,i.prototype.uint32=function(){var a=0xffffffff;return function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return a;if((this.pos+=5)>this.len)throw this.pos=this.len,h(this,10);return a}}(),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var a=this.uint32();return a>>>1^-(1&a)},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw h(this,4);return m(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw h(this,4);return 0|m(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw h(this,4);var a=e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,a},i.prototype.double=function(){if(this.pos+8>this.len)throw h(this,4);var a=e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,a},i.prototype.bytes=function(){var a=this.uint32(),b=this.pos,c=this.pos+a;if(c>this.len)throw h(this,a);if(this.pos+=a,Array.isArray(this.buf))return this.buf.slice(b,c);if(b===c){var d=e.Buffer;return d?d.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,b,c)},i.prototype.string=function(){var a=this.bytes();return g.read(a,0,a.length)},i.prototype.skip=function(a){if("number"==typeof a){if(this.pos+a>this.len)throw h(this,a);this.pos+=a}else do if(this.pos>=this.len)throw h(this);while(128&this.buf[this.pos++])return this},i.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(a=7&this.uint32());)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this},i._configure=function(a){d=a,i.create=k(),d._configure();var b=e.Long?"toLong":"toNumber";e.merge(i.prototype,{int64:function(){return l.call(this)[b](!1)},uint64:function(){return l.call(this)[b](!0)},sint64:function(){return l.call(this).zzDecode()[b](!1)},fixed64:function(){return n.call(this)[b](!0)},sfixed64:function(){return n.call(this)[b](!1)}})}},76326,(a,b,c)=>{"use strict";b.exports=l;var d,e=a.r(56678),f=e.LongBits,g=e.base64,h=e.utf8;function i(a,b,c){this.fn=a,this.len=b,this.next=void 0,this.val=c}function j(){}function k(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function l(){this.len=0,this.head=new i(j,0,0),this.tail=this.head,this.states=null}var m=function(){return e.Buffer?function(){return(l.create=function(){return new d})()}:function(){return new l}};function n(a,b,c){b[c]=255&a}function o(a,b,c){for(;a>127;)b[c++]=127&a|128,a>>>=7;b[c]=a}function p(a,b){this.len=a,this.next=void 0,this.val=b}function q(a,b,c){for(;a.hi;)b[c++]=127&a.lo|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)b[c++]=127&a.lo|128,a.lo=a.lo>>>7;b[c++]=a.lo}function r(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}l.create=m(),l.alloc=function(a){return new e.Array(a)},e.Array!==Array&&(l.alloc=e.pool(l.alloc,e.Array.prototype.subarray)),l.prototype._push=function(a,b,c){return this.tail=this.tail.next=new i(a,b,c),this.len+=b,this},p.prototype=Object.create(i.prototype),p.prototype.fn=o,l.prototype.uint32=function(a){return this.len+=(this.tail=this.tail.next=new p((a>>>=0)<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:5,a)).len,this},l.prototype.int32=function(a){return a<0?this._push(q,10,f.fromNumber(a)):this.uint32(a)},l.prototype.sint32=function(a){return this.uint32((a<<1^a>>31)>>>0)},l.prototype.uint64=function(a){var b=f.from(a);return this._push(q,b.length(),b)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(a){var b=f.from(a).zzEncode();return this._push(q,b.length(),b)},l.prototype.bool=function(a){return this._push(n,1,+!!a)},l.prototype.fixed32=function(a){return this._push(r,4,a>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(a){var b=f.from(a);return this._push(r,4,b.lo)._push(r,4,b.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(a){return this._push(e.float.writeFloatLE,4,a)},l.prototype.double=function(a){return this._push(e.float.writeDoubleLE,8,a)};var s=e.Array.prototype.set?function(a,b,c){b.set(a,c)}:function(a,b,c){for(var d=0;d<a.length;++d)b[c+d]=a[d]};l.prototype.bytes=function(a){var b=a.length>>>0;if(!b)return this._push(n,1,0);if(e.isString(a)){var c=l.alloc(b=g.length(a));g.decode(a,c,0),a=c}return this.uint32(b)._push(s,b,a)},l.prototype.string=function(a){var b=h.length(a);return b?this.uint32(b)._push(h.write,b,a):this._push(n,1,0)},l.prototype.fork=function(){return this.states=new k(this),this.head=this.tail=new i(j,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(j,0,0),this.len=0),this},l.prototype.ldelim=function(){var a=this.head,b=this.tail,c=this.len;return this.reset().uint32(c),c&&(this.tail.next=a.next,this.tail=b,this.len+=c),this},l.prototype.finish=function(){for(var a=this.head.next,b=this.constructor.alloc(this.len),c=0;a;)a.fn(a.val,b,c),c+=a.len,a=a.next;return b},l._configure=function(a){d=a,l.create=m(),d._configure()}},51874,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(77676),e=a.r(62003),f=a.r(43806);function g(a){return"missing required '"+a.name+"'"}function h(a){for(var b=f.codegen(["r","l","e"],a.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(a.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),c=0;c<a.fieldsArray.length;++c){var h=a._fieldsArray[c].resolve(),i=h.resolvedType instanceof d?"int32":h.type,j="m"+f.safeProp(h.name);b("case %i: {",h.id),h.map?(b("if(%s===util.emptyObject)",j)("%s={}",j)("var c2 = r.uint32()+r.pos"),void 0!==e.defaults[h.keyType]?b("k=%j",e.defaults[h.keyType]):b("k=null"),void 0!==e.defaults[i]?b("value=%j",e.defaults[i]):b("value=null"),b("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",h.keyType)("case 2:"),void 0===e.basic[i]?b("value=types[%i].decode(r,r.uint32())",c):b("value=r.%s()",i),b("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==e.long[h.keyType]?b('%s[typeof k==="object"?util.longToHash(k):k]=value',j):b("%s[k]=value",j)):h.repeated?(b("if(!(%s&&%s.length))",j,j)("%s=[]",j),void 0!==e.packed[i]&&b("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",j,i)("}else"),void 0===e.basic[i]?b(h.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",j,c):b("%s.push(r.%s())",j,i)):void 0===e.basic[i]?b(h.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",j,c):b("%s=r.%s()",j,i),b("break")("}")}for(b("default:")("r.skipType(t&7)")("break")("}")("}"),c=0;c<a._fieldsArray.length;++c){var k=a._fieldsArray[c];k.required&&b("if(!m.hasOwnProperty(%j))",k.name)("throw util.ProtocolError(%j,{instance:m})",g(k))}return b("return m")}},62606,(a,b,c)=>{"use strict";b.exports=i;var d=a.r(77676),e=a.r(43806);function f(a,b){return a.name+": "+b+(a.repeated&&"array"!==b?"[]":a.map&&"object"!==b?"{k:"+a.keyType+"}":"")+" expected"}function g(a,b,c,e){if(b.resolvedType)if(b.resolvedType instanceof d){a("switch(%s){",e)("default:")("return%j",f(b,"enum value"));for(var g=Object.keys(b.resolvedType.values),h=0;h<g.length;++h)a("case %i:",b.resolvedType.values[g[h]]);a("break")("}")}else a("{")("var e=types[%i].verify(%s);",c,e)("if(e)")("return%j+e",b.name+".")("}");else switch(b.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.isInteger(%s))",e)("return%j",f(b,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",e,e,e,e)("return%j",f(b,"integer|Long"));break;case"float":case"double":a('if(typeof %s!=="number")',e)("return%j",f(b,"number"));break;case"bool":a('if(typeof %s!=="boolean")',e)("return%j",f(b,"boolean"));break;case"string":a("if(!util.isString(%s))",e)("return%j",f(b,"string"));break;case"bytes":a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',e,e,e)("return%j",f(b,"buffer"))}return a}function h(a,b,c){switch(b.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.key32Re.test(%s))",c)("return%j",f(b,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.key64Re.test(%s))",c)("return%j",f(b,"integer|Long key"));break;case"bool":a("if(!util.key2Re.test(%s))",c)("return%j",f(b,"boolean key"))}return a}function i(a){var b=e.codegen(["m"],a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),c=a.oneofsArray,d={};c.length&&b("var p={}");for(var i=0;i<a.fieldsArray.length;++i){var j=a._fieldsArray[i].resolve(),k="m"+e.safeProp(j.name);if(j.optional&&b("if(%s!=null&&m.hasOwnProperty(%j)){",k,j.name),j.map)b("if(!util.isObject(%s))",k)("return%j",f(j,"object"))("var k=Object.keys(%s)",k)("for(var i=0;i<k.length;++i){"),h(b,j,"k[i]"),g(b,j,i,k+"[k[i]]")("}");else if(j.repeated)b("if(!Array.isArray(%s))",k)("return%j",f(j,"array"))("for(var i=0;i<%s.length;++i){",k),g(b,j,i,k+"[i]")("}");else{if(j.partOf){var l=e.safeProp(j.partOf.name);1===d[j.partOf.name]&&b("if(p%s===1)",l)("return%j",j.partOf.name+": multiple values"),d[j.partOf.name]=1,b("p%s=1",l)}g(b,j,i,k)}j.optional&&b("}")}return b("return null")}},54298,(a,b,c)=>{"use strict";var d=c,e=a.r(77676),f=a.r(43806);function g(a,b,c,d){var f=!1;if(b.resolvedType)if(b.resolvedType instanceof e){a("switch(d%s){",d);for(var g=b.resolvedType.values,h=Object.keys(g),i=0;i<h.length;++i)g[h[i]]!==b.typeDefault||f||(a("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',d,d,d),b.repeated||a("break"),f=!0),a("case%j:",h[i])("case %i:",g[h[i]])("m%s=%j",d,g[h[i]])("break");a("}")}else a('if(typeof d%s!=="object")',d)("throw TypeError(%j)",b.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",d,c,d);else{var j=!1;switch(b.type){case"double":case"float":a("m%s=Number(d%s)",d,d);break;case"uint32":case"fixed32":a("m%s=d%s>>>0",d,d);break;case"int32":case"sint32":case"sfixed32":a("m%s=d%s|0",d,d);break;case"uint64":j=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",d,d,j)('else if(typeof d%s==="string")',d)("m%s=parseInt(d%s,10)",d,d)('else if(typeof d%s==="number")',d)("m%s=d%s",d,d)('else if(typeof d%s==="object")',d)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",d,d,d,j?"true":"");break;case"bytes":a('if(typeof d%s==="string")',d)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",d,d,d)("else if(d%s.length >= 0)",d)("m%s=d%s",d,d);break;case"string":a("m%s=String(d%s)",d,d);break;case"bool":a("m%s=Boolean(d%s)",d,d)}}return a}function h(a,b,c,d){if(b.resolvedType)b.resolvedType instanceof e?a("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",d,c,d,d,c,d,d):a("d%s=types[%i].toObject(m%s,o)",d,c,d);else{var f=!1;switch(b.type){case"double":case"float":a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",d,d,d,d);break;case"uint64":f=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a('if(typeof m%s==="number")',d)("d%s=o.longs===String?String(m%s):m%s",d,d,d)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",d,d,d,d,f?"true":"",d);break;case"bytes":a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",d,d,d,d,d);break;default:a("d%s=m%s",d,d)}}return a}d.fromObject=function(a){var b=a.fieldsArray,c=f.codegen(["d"],a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!b.length)return c("return new this.ctor");c("var m=new this.ctor");for(var d=0;d<b.length;++d){var h=b[d].resolve(),i=f.safeProp(h.name);h.map?(c("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",h.fullName+": object expected")("m%s={}",i)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),g(c,h,d,i+"[ks[i]]")("}")("}")):h.repeated?(c("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",h.fullName+": array expected")("m%s=[]",i)("for(var i=0;i<d%s.length;++i){",i),g(c,h,d,i+"[i]")("}")("}")):(h.resolvedType instanceof e||c("if(d%s!=null){",i),g(c,h,d,i),h.resolvedType instanceof e||c("}"))}return c("return m")},d.toObject=function(a){var b=a.fieldsArray.slice().sort(f.compareFieldsById);if(!b.length)return f.codegen()("return {}");for(var c=f.codegen(["m","o"],a.name+"$toObject")("if(!o)")("o={}")("var d={}"),d=[],g=[],i=[],j=0;j<b.length;++j)b[j].partOf||(b[j].resolve().repeated?d:b[j].map?g:i).push(b[j]);if(d.length){for(c("if(o.arrays||o.defaults){"),j=0;j<d.length;++j)c("d%s=[]",f.safeProp(d[j].name));c("}")}if(g.length){for(c("if(o.objects||o.defaults){"),j=0;j<g.length;++j)c("d%s={}",f.safeProp(g[j].name));c("}")}if(i.length){for(c("if(o.defaults){"),j=0;j<i.length;++j){var k=i[j],l=f.safeProp(k.name);if(k.resolvedType instanceof e)c("d%s=o.enums===String?%j:%j",l,k.resolvedType.valuesById[k.typeDefault],k.typeDefault);else if(k.long)c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",k.typeDefault.low,k.typeDefault.high,k.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,k.typeDefault.toString(),k.typeDefault.toNumber());else if(k.bytes){var m="["+Array.prototype.slice.call(k.typeDefault).join(",")+"]";c("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,k.typeDefault))("else{")("d%s=%s",l,m)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else c("d%s=%j",l,k.typeDefault)}c("}")}var n=!1;for(j=0;j<b.length;++j){var k=b[j],o=a._fieldsArray.indexOf(k),l=f.safeProp(k.name);k.map?(n||(n=!0,c("var ks2")),c("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),h(c,k,o,l+"[ks2[j]]")("}")):k.repeated?(c("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),h(c,k,o,l+"[j]")("}")):(c("if(m%s!=null&&m.hasOwnProperty(%j)){",l,k.name),h(c,k,o,l),k.partOf&&c("if(o.oneofs)")("d%s=%j",f.safeProp(k.partOf.name),k.name)),c("}")}return c("return d")}},20525,(a,b,c)=>{"use strict";var d=c,e=a.r(5995);d[".google.protobuf.Any"]={fromObject:function(a){if(a&&a["@type"]){var b=a["@type"].substring(a["@type"].lastIndexOf("/")+1),c=this.lookup(b);if(c){var d="."===a["@type"].charAt(0)?a["@type"].slice(1):a["@type"];return -1===d.indexOf("/")&&(d="/"+d),this.create({type_url:d,value:c.encode(c.fromObject(a)).finish()})}}return this.fromObject(a)},toObject:function(a,b){var c="type.googleapis.com/",d="",f="";if(b&&b.json&&a.type_url&&a.value){f=a.type_url.substring(a.type_url.lastIndexOf("/")+1),d=a.type_url.substring(0,a.type_url.lastIndexOf("/")+1);var g=this.lookup(f);g&&(a=g.decode(a.value))}if(!(a instanceof this.ctor)&&a instanceof e){var h=a.$type.toObject(a,b),i="."===a.$type.fullName[0]?a.$type.fullName.slice(1):a.$type.fullName;return""===d&&(d=c),f=d+i,h["@type"]=f,h}return this.toObject(a,b)}}},71886,(a,b,c)=>{"use strict";b.exports=s;var d=a.r(63421);((s.prototype=Object.create(d.prototype)).constructor=s).className="Type";var e=a.r(77676),f=a.r(55845),g=a.r(66882),h=a.r(38140),i=a.r(87052),j=a.r(5995),k=a.r(24091),l=a.r(76326),m=a.r(43806),n=a.r(61614),o=a.r(51874),p=a.r(62606),q=a.r(54298),r=a.r(20525);function s(a,b){d.call(this,a,b),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function t(a){return a._fieldsById=a._fieldsArray=a._oneofsArray=null,delete a.encode,delete a.decode,delete a.verify,a}Object.defineProperties(s.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var a=Object.keys(this.fields),b=0;b<a.length;++b){var c=this.fields[a[b]],d=c.id;if(this._fieldsById[d])throw Error("duplicate id "+d+" in "+this);this._fieldsById[d]=c}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=m.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=m.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=s.generateConstructor(this)())},set:function(a){var b=a.prototype;b instanceof j||((a.prototype=new j).constructor=a,m.merge(a.prototype,b)),a.$type=a.prototype.$type=this,m.merge(a,j,!0),this._ctor=a;for(var c=0;c<this.fieldsArray.length;++c)this._fieldsArray[c].resolve();var d={};for(c=0;c<this.oneofsArray.length;++c)d[this._oneofsArray[c].resolve().name]={get:m.oneOfGetter(this._oneofsArray[c].oneof),set:m.oneOfSetter(this._oneofsArray[c].oneof)};c&&Object.defineProperties(a.prototype,d)}}}),s.generateConstructor=function(a){for(var b,c=m.codegen(["p"],a.name),d=0;d<a.fieldsArray.length;++d)(b=a._fieldsArray[d]).map?c("this%s={}",m.safeProp(b.name)):b.repeated&&c("this%s=[]",m.safeProp(b.name));return c("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},s.fromJSON=function(a,b){var c=new s(a,b.options);c.extensions=b.extensions,c.reserved=b.reserved;for(var j=Object.keys(b.fields),k=0;k<j.length;++k)c.add((void 0!==b.fields[j[k]].keyType?h.fromJSON:g.fromJSON)(j[k],b.fields[j[k]]));if(b.oneofs)for(j=Object.keys(b.oneofs),k=0;k<j.length;++k)c.add(f.fromJSON(j[k],b.oneofs[j[k]]));if(b.nested)for(j=Object.keys(b.nested),k=0;k<j.length;++k){var l=b.nested[j[k]];c.add((void 0!==l.id?g.fromJSON:void 0!==l.fields?s.fromJSON:void 0!==l.values?e.fromJSON:void 0!==l.methods?i.fromJSON:d.fromJSON)(j[k],l))}return b.extensions&&b.extensions.length&&(c.extensions=b.extensions),b.reserved&&b.reserved.length&&(c.reserved=b.reserved),b.group&&(c.group=!0),b.comment&&(c.comment=b.comment),b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},s.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return m.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"oneofs",d.arrayToJSON(this.oneofsArray,a),"fields",d.arrayToJSON(this.fieldsArray.filter(function(a){return!a.declaringField}),a)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},s.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolveAll.call(this);var a=this.oneofsArray;for(c=0;c<a.length;)a[c++].resolve();for(var b=this.fieldsArray,c=0;c<b.length;)b[c++].resolve();return this},s.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.oneofsArray.forEach(b=>{b._resolveFeatures(a)}),this.fieldsArray.forEach(b=>{b._resolveFeatures(a)})),this},s.prototype.get=function(a){return this.fields[a]||this.oneofs&&this.oneofs[a]||this.nested&&this.nested[a]||null},s.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);if(a instanceof g&&void 0===a.extend){if(this._fieldsById?this._fieldsById[a.id]:this.fieldsById[a.id])throw Error("duplicate id "+a.id+" in "+this);if(this.isReservedId(a.id))throw Error("id "+a.id+" is reserved in "+this);if(this.isReservedName(a.name))throw Error("name '"+a.name+"' is reserved in "+this);return a.parent&&a.parent.remove(a),this.fields[a.name]=a,a.message=this,a.onAdd(this),t(this)}return a instanceof f?(this.oneofs||(this.oneofs={}),this.oneofs[a.name]=a,a.onAdd(this),t(this)):d.prototype.add.call(this,a)},s.prototype.remove=function(a){if(a instanceof g&&void 0===a.extend){if(!this.fields||this.fields[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.fields[a.name],a.parent=null,a.onRemove(this),t(this)}if(a instanceof f){if(!this.oneofs||this.oneofs[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.oneofs[a.name],a.parent=null,a.onRemove(this),t(this)}return d.prototype.remove.call(this,a)},s.prototype.isReservedId=function(a){return d.isReservedId(this.reserved,a)},s.prototype.isReservedName=function(a){return d.isReservedName(this.reserved,a)},s.prototype.create=function(a){return new this.ctor(a)},s.prototype.setup=function(){for(var a=this.fullName,b=[],c=0;c<this.fieldsArray.length;++c)b.push(this._fieldsArray[c].resolve().resolvedType);this.encode=n(this)({Writer:l,types:b,util:m}),this.decode=o(this)({Reader:k,types:b,util:m}),this.verify=p(this)({types:b,util:m}),this.fromObject=q.fromObject(this)({types:b,util:m}),this.toObject=q.toObject(this)({types:b,util:m});var d=r[a];if(d){var e=Object.create(this);e.fromObject=this.fromObject,this.fromObject=d.fromObject.bind(e),e.toObject=this.toObject,this.toObject=d.toObject.bind(e)}return this},s.prototype.encode=function(a,b){return this.setup().encode(a,b)},s.prototype.encodeDelimited=function(a,b){return this.encode(a,b&&b.len?b.fork():b).ldelim()},s.prototype.decode=function(a,b){return this.setup().decode(a,b)},s.prototype.decodeDelimited=function(a){return a instanceof k||(a=k.create(a)),this.decode(a,a.uint32())},s.prototype.verify=function(a){return this.setup().verify(a)},s.prototype.fromObject=function(a){return this.setup().fromObject(a)},s.prototype.toObject=function(a,b){return this.setup().toObject(a,b)},s.d=function(a){return function(b){m.decorateType(b,a)}}},66514,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(63421);((l.prototype=Object.create(g.prototype)).constructor=l).className="Root";var h=a.r(66882),i=a.r(77676),j=a.r(55845),k=a.r(43806);function l(a){g.call(this,"",a),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function m(){}l.fromJSON=function(a,b){return b||(b=new l),a.options&&b.setOptions(a.options),b.addJSON(a.nested).resolveAll()},l.prototype.resolvePath=k.path.resolve,l.prototype.fetch=k.fetch,l.prototype.load=function a(b,c,d){"function"==typeof c&&(d=c,c=void 0);var g=this;if(!d)return k.asPromise(a,g,b,c);var h=d===m;function i(a,b){if(d){if(h)throw a;b&&b.resolveAll();var c=d;d=null,c(a,b)}}function j(a){var b=a.lastIndexOf("google/protobuf/");if(b>-1){var c=a.substring(b);if(c in f)return c}return null}function l(a,b){try{if(k.isString(b)&&"{"===b.charAt(0)&&(b=JSON.parse(b)),k.isString(b)){e.filename=a;var d,f=e(b,g,c),l=0;if(f.imports)for(;l<f.imports.length;++l)(d=j(f.imports[l])||g.resolvePath(a,f.imports[l]))&&n(d);if(f.weakImports)for(l=0;l<f.weakImports.length;++l)(d=j(f.weakImports[l])||g.resolvePath(a,f.weakImports[l]))&&n(d,!0)}else g.setOptions(b.options).addJSON(b.nested)}catch(a){i(a)}h||o||i(null,g)}function n(a,b){if(a=j(a)||a,!(g.files.indexOf(a)>-1)){if(g.files.push(a),a in f)return void(h?l(a,f[a]):(++o,setTimeout(function(){--o,l(a,f[a])})));if(h){var c;try{c=k.fs.readFileSync(a).toString("utf8")}catch(a){b||i(a);return}l(a,c)}else++o,g.fetch(a,function(c,e){if(--o,d){if(c)return void(b?o||i(null,g):i(c));l(a,e)}})}}var o=0;k.isString(b)&&(b=[b]);for(var p,q=0;q<b.length;++q)(p=g.resolvePath("",b[q]))&&n(p);return h?g.resolveAll():o||i(null,g),g},l.prototype.loadSync=function(a,b){if(!k.isNode)throw Error("not supported");return this.load(a,b,m)},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(a){return"'extend "+a.extend+"' in "+a.parent.fullName}).join(", "));return g.prototype.resolveAll.call(this)};var n=/^[A-Z]/;function o(a,b){var c=b.parent.lookup(b.extend);if(c){var d=new h(b.fullName,b.id,b.type,b.rule,void 0,b.options);return!!c.get(d.name)||(d.declaringField=b,b.extensionField=d,c.add(d),!0)}return!1}l.prototype._handleAdd=function(a){if(a instanceof h)void 0===a.extend||a.extensionField||o(this,a)||this.deferred.push(a);else if(a instanceof i)n.test(a.name)&&(a.parent[a.name]=a.values);else if(!(a instanceof j)){if(a instanceof d)for(var b=0;b<this.deferred.length;)o(this,this.deferred[b])?this.deferred.splice(b,1):++b;for(var c=0;c<a.nestedArray.length;++c)this._handleAdd(a._nestedArray[c]);n.test(a.name)&&(a.parent[a.name]=a)}(a instanceof d||a instanceof i||a instanceof h)&&(this._fullyQualifiedObjects[a.fullName]=a)},l.prototype._handleRemove=function(a){if(a instanceof h){if(void 0!==a.extend)if(a.extensionField)a.extensionField.parent.remove(a.extensionField),a.extensionField=null;else{var b=this.deferred.indexOf(a);b>-1&&this.deferred.splice(b,1)}}else if(a instanceof i)n.test(a.name)&&delete a.parent[a.name];else if(a instanceof g){for(var c=0;c<a.nestedArray.length;++c)this._handleRemove(a._nestedArray[c]);n.test(a.name)&&delete a.parent[a.name]}delete this._fullyQualifiedObjects[a.fullName]},l._configure=function(a,b,c){d=a,e=b,f=c}},43806,(a,b,c)=>{"use strict";var d,e,f=b.exports=a.r(56678),g=a.r(57270);f.codegen=a.r(98873),f.fetch=a.r(6566),f.path=a.r(7176),f.fs=f.inquire("fs"),f.toArray=function(a){if(a){for(var b=Object.keys(a),c=Array(b.length),d=0;d<b.length;)c[d]=a[b[d++]];return c}return[]},f.toObject=function(a){for(var b={},c=0;c<a.length;){var d=a[c++],e=a[c++];void 0!==e&&(b[d]=e)}return b};var h=/\\/g,i=/"/g;f.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},f.safeProp=function(a){return!/^[$\w_]+$/.test(a)||f.isReserved(a)?'["'+a.replace(h,"\\\\").replace(i,'\\"')+'"]':"."+a},f.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var j=/_([a-z])/g;f.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(j,function(a,b){return b.toUpperCase()})},f.compareFieldsById=function(a,b){return a.id-b.id},f.decorateType=function(b,c){if(b.$type)return c&&b.$type.name!==c&&(f.decorateRoot.remove(b.$type),b.$type.name=c,f.decorateRoot.add(b.$type)),b.$type;d||(d=a.r(71886));var e=new d(c||b.name);return f.decorateRoot.add(e),e.ctor=b,Object.defineProperty(b,"$type",{value:e,enumerable:!1}),Object.defineProperty(b.prototype,"$type",{value:e,enumerable:!1}),e};var k=0;f.decorateEnum=function(b){if(b.$type)return b.$type;e||(e=a.r(77676));var c=new e("Enum"+k++,b);return f.decorateRoot.add(c),Object.defineProperty(b,"$type",{value:c,enumerable:!1}),c},f.setProperty=function(a,b,c,d){function e(a,b,c){var f=b.shift();if("__proto__"===f||"prototype"===f)return a;if(b.length>0)a[f]=e(a[f]||{},b,c);else{var g=a[f];if(g&&d)return a;g&&(c=[].concat(g).concat(c)),a[f]=c}return a}if("object"!=typeof a)throw TypeError("dst must be an object");if(!b)throw TypeError("path must be specified");return e(a,b=b.split("."),c)},Object.defineProperty(f,"decorateRoot",{get:function(){return g.decorated||(g.decorated=new(a.r(66514)))}})},62003,(a,b,c)=>{"use strict";var d=c,e=a.r(43806),f=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function g(a,b){var c=0,d={};for(b|=0;c<a.length;)d[f[c+b]]=a[c++];return d}d.basic=g([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),d.defaults=g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),d.long=g([0,0,0,1,1],7),d.mapKey=g([0,0,0,5,5,0,0,0,1,1,0,2],2),d.packed=g([1,5,0,0,0,5,5,0,0,0,1,1,0])},66882,(a,b,c)=>{"use strict";b.exports=j;var d,e=a.r(70530);((j.prototype=Object.create(e.prototype)).constructor=j).className="Field";var f=a.r(77676),g=a.r(62003),h=a.r(43806),i=/^required|optional|repeated$/;function j(a,b,c,d,f,j,k){if(h.isObject(d)?(k=f,j=d,d=f=void 0):h.isObject(f)&&(k=j,j=f,f=void 0),e.call(this,a,j),!h.isInteger(b)||b<0)throw TypeError("id must be a non-negative integer");if(!h.isString(c))throw TypeError("type must be a string");if(void 0!==d&&!i.test(d=d.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==f&&!h.isString(f))throw TypeError("extend must be a string");"proto3_optional"===d&&(d="optional"),this.rule=d&&"optional"!==d?d:void 0,this.type=c,this.id=b,this.extend=f||void 0,this.repeated="repeated"===d,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!h.Long&&void 0!==g.long[c],this.bytes="bytes"===c,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=k}j.fromJSON=function(a,b){var c=new j(a,b.id,b.type,b.rule,b.extend,b.options,b.comment);return b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},Object.defineProperty(j.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(j.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(j.prototype,"delimited",{get:function(){return this.resolvedType instanceof d&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(j.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(j.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),j.prototype.setOption=function(a,b,c){return e.prototype.setOption.call(this,a,b,c)},j.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return h.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},j.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=g.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof f&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof f||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=h.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var a;h.base64.test(this.typeDefault)?h.base64.decode(this.typeDefault,a=h.newBuffer(h.base64.length(this.typeDefault)),0):h.utf8.write(this.typeDefault,a=h.newBuffer(h.utf8.length(this.typeDefault)),0),this.typeDefault=a}return this.map?this.defaultValue=h.emptyObject:this.repeated?this.defaultValue=h.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},j.prototype._inferLegacyProtoFeatures=function(a){if("proto2"!==a&&"proto3"!==a)return{};var b={};if("required"===this.rule&&(b.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===g.defaults[this.type]){var c=this.parent.get(this.type.split(".").pop());c&&c instanceof d&&c.group&&(b.message_encoding="DELIMITED")}return!0===this.getOption("packed")?b.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(b.repeated_field_encoding="EXPANDED"),b},j.prototype._resolveFeatures=function(a){return e.prototype._resolveFeatures.call(this,this._edition||a)},j.d=function(a,b,c,d){return"function"==typeof b?b=h.decorateType(b).name:b&&"object"==typeof b&&(b=h.decorateEnum(b).name),function(e,f){h.decorateType(e.constructor).add(new j(f,a,b,c,{default:d}))}},j._configure=function(a){d=a}},55845,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(70530);((g.prototype=Object.create(d.prototype)).constructor=g).className="OneOf";var e=a.r(66882),f=a.r(43806);function g(a,b,c,e){if(Array.isArray(b)||(c=b,b=void 0),d.call(this,a,c),!(void 0===b||Array.isArray(b)))throw TypeError("fieldNames must be an Array");this.oneof=b||[],this.fieldsArray=[],this.comment=e}function h(a){if(a.parent)for(var b=0;b<a.fieldsArray.length;++b)a.fieldsArray[b].parent||a.parent.add(a.fieldsArray[b])}g.fromJSON=function(a,b){return new g(a,b.oneof,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["options",this.options,"oneof",this.oneof,"comment",b?this.comment:void 0])},g.prototype.add=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");return a.parent&&a.parent!==this.parent&&a.parent.remove(a),this.oneof.push(a.name),this.fieldsArray.push(a),a.partOf=this,h(this),this},g.prototype.remove=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");var b=this.fieldsArray.indexOf(a);if(b<0)throw Error(a+" is not a member of "+this);return this.fieldsArray.splice(b,1),(b=this.oneof.indexOf(a.name))>-1&&this.oneof.splice(b,1),a.partOf=null,this},g.prototype.onAdd=function(a){d.prototype.onAdd.call(this,a);for(var b=this,c=0;c<this.oneof.length;++c){var e=a.get(this.oneof[c]);e&&!e.partOf&&(e.partOf=b,b.fieldsArray.push(e))}h(this)},g.prototype.onRemove=function(a){for(var b,c=0;c<this.fieldsArray.length;++c)(b=this.fieldsArray[c]).parent&&b.parent.remove(b);d.prototype.onRemove.call(this,a)},Object.defineProperty(g.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var a=this.fieldsArray[0];return null!=a.options&&!0===a.options.proto3_optional}}),g.d=function(){for(var a=Array(arguments.length),b=0;b<arguments.length;)a[b]=arguments[b++];return function(b,c){f.decorateType(b.constructor).add(new g(c,a)),Object.defineProperty(b,c,{get:f.oneOfGetter(a),set:f.oneOfSetter(a)})}}},70530,(a,b,c)=>{"use strict";b.exports=j,j.className="ReflectionObject";let d=a.r(55845);var e,f=a.r(43806),g={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},h={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},i={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function j(a,b){if(!f.isString(a))throw TypeError("name must be a string");if(b&&!f.isObject(b))throw TypeError("options must be an object");this.options=b,this.parsedOptions=null,this.name=a,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(j.prototype,{root:{get:function(){for(var a=this;null!==a.parent;)a=a.parent;return a}},fullName:{get:function(){for(var a=[this.name],b=this.parent;b;)a.unshift(b.name),b=b.parent;return a.join(".")}}}),j.prototype.toJSON=function(){throw Error()},j.prototype.onAdd=function(a){this.parent&&this.parent!==a&&this.parent.remove(this),this.parent=a,this.resolved=!1;var b=a.root;b instanceof e&&b._handleAdd(this)},j.prototype.onRemove=function(a){var b=a.root;b instanceof e&&b._handleRemove(this),this.parent=null,this.resolved=!1},j.prototype.resolve=function(){return this.resolved||this.root instanceof e&&(this.resolved=!0),this},j.prototype._resolveFeaturesRecursive=function(a){return this._resolveFeatures(this._edition||a)},j.prototype._resolveFeatures=function(a){if(!this._featuresResolved){var b={};if(!a)throw Error("Unknown edition for "+this.fullName);var c=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(a));if(this._edition){if("proto2"===a)b=Object.assign({},h);else if("proto3"===a)b=Object.assign({},i);else if("2023"===a)b=Object.assign({},g);else throw Error("Unknown edition: "+a);this._features=Object.assign(b,c||{}),this._featuresResolved=!0;return}if(this.partOf instanceof d){var e=Object.assign({},this.partOf._features);this._features=Object.assign(e,c||{})}else if(this.declaringField);else if(this.parent){var f=Object.assign({},this.parent._features);this._features=Object.assign(f,c||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},j.prototype._inferLegacyProtoFeatures=function(){return{}},j.prototype.getOption=function(a){if(this.options)return this.options[a]},j.prototype.setOption=function(a,b,c){return this.options||(this.options={}),/^features\./.test(a)?f.setProperty(this.options,a,b,c):c&&void 0!==this.options[a]||(this.getOption(a)!==b&&(this.resolved=!1),this.options[a]=b),this},j.prototype.setParsedOption=function(a,b,c){this.parsedOptions||(this.parsedOptions=[]);var d=this.parsedOptions;if(c){var e=d.find(function(b){return Object.prototype.hasOwnProperty.call(b,a)});if(e){var g=e[a];f.setProperty(g,c,b)}else(e={})[a]=f.setProperty({},c,b),d.push(e)}else{var h={};h[a]=b,d.push(h)}return this},j.prototype.setOptions=function(a,b){if(a)for(var c=Object.keys(a),d=0;d<c.length;++d)this.setOption(c[d],a[c[d]],b);return this},j.prototype.toString=function(){var a=this.constructor.className,b=this.fullName;return b.length?a+" "+b:a},j.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},j._configure=function(a){e=a}},77676,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(70530);((g.prototype=Object.create(d.prototype)).constructor=g).className="Enum";var e=a.r(63421),f=a.r(43806);function g(a,b,c,e,f,g){if(d.call(this,a,c),b&&"object"!=typeof b)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=e,this.comments=f||{},this.valuesOptions=g,this._valuesFeatures={},this.reserved=void 0,b)for(var h=Object.keys(b),i=0;i<h.length;++i)"number"==typeof b[h[i]]&&(this.valuesById[this.values[h[i]]=b[h[i]]]=h[i])}g.prototype._resolveFeatures=function(a){return a=this._edition||a,d.prototype._resolveFeatures.call(this,a),Object.keys(this.values).forEach(a=>{var b=Object.assign({},this._features);this._valuesFeatures[a]=Object.assign(b,this.valuesOptions&&this.valuesOptions[a]&&this.valuesOptions[a].features)}),this},g.fromJSON=function(a,b){var c=new g(a,b.values,b.options,b.comment,b.comments);return c.reserved=b.reserved,b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",b?this.comment:void 0,"comments",b?this.comments:void 0])},g.prototype.add=function(a,b,c,d){if(!f.isString(a))throw TypeError("name must be a string");if(!f.isInteger(b))throw TypeError("id must be an integer");if(void 0!==this.values[a])throw Error("duplicate name '"+a+"' in "+this);if(this.isReservedId(b))throw Error("id "+b+" is reserved in "+this);if(this.isReservedName(a))throw Error("name '"+a+"' is reserved in "+this);if(void 0!==this.valuesById[b]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+b+" in "+this);this.values[a]=b}else this.valuesById[this.values[a]=b]=a;return d&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[a]=d||null),this.comments[a]=c||null,this},g.prototype.remove=function(a){if(!f.isString(a))throw TypeError("name must be a string");var b=this.values[a];if(null==b)throw Error("name '"+a+"' does not exist in "+this);return delete this.valuesById[b],delete this.values[a],delete this.comments[a],this.valuesOptions&&delete this.valuesOptions[a],this},g.prototype.isReservedId=function(a){return e.isReservedId(this.reserved,a)},g.prototype.isReservedName=function(a){return e.isReservedName(this.reserved,a)}},61614,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(77676),e=a.r(62003),f=a.r(43806);function g(a,b,c,d){return b.delimited?a("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",c,d,(b.id<<3|3)>>>0,(b.id<<3|4)>>>0):a("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",c,d,(b.id<<3|2)>>>0)}function h(a){for(var b,c,h=f.codegen(["m","w"],a.name+"$encode")("if(!w)")("w=Writer.create()"),i=a.fieldsArray.slice().sort(f.compareFieldsById),b=0;b<i.length;++b){var j=i[b].resolve(),k=a._fieldsArray.indexOf(j),l=j.resolvedType instanceof d?"int32":j.type,m=e.basic[l];c="m"+f.safeProp(j.name),j.map?(h("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",c,j.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",c)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(j.id<<3|2)>>>0,8|e.mapKey[j.keyType],j.keyType),void 0===m?h("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",k,c):h(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|m,l,c),h("}")("}")):j.repeated?(h("if(%s!=null&&%s.length){",c,c),j.packed&&void 0!==e.packed[l]?h("w.uint32(%i).fork()",(j.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",c)("w.%s(%s[i])",l,c)("w.ldelim()"):(h("for(var i=0;i<%s.length;++i)",c),void 0===m?g(h,j,k,c+"[i]"):h("w.uint32(%i).%s(%s[i])",(j.id<<3|m)>>>0,l,c)),h("}")):(j.optional&&h("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",c,j.name),void 0===m?g(h,j,k,c):h("w.uint32(%i).%s(%s)",(j.id<<3|m)>>>0,l,c))}return h("return w")}},54522,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(76326);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(56678);function f(){d.call(this)}function g(a,b,c){a.length<40?e.utf8.write(a,b,c):b.utf8Write?b.utf8Write(a,c):b.write(a,c)}f._configure=function(){f.alloc=e._Buffer_allocUnsafe,f.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&"set"===e.Buffer.prototype.set.name?function(a,b,c){b.set(a,c)}:function(a,b,c){if(a.copy)a.copy(b,c,0,a.length);else for(var d=0;d<a.length;)b[c++]=a[d++]}},f.prototype.bytes=function(a){e.isString(a)&&(a=e._Buffer_from(a,"base64"));var b=a.length>>>0;return this.uint32(b),b&&this._push(f.writeBytesBuffer,b,a),this},f.prototype.string=function(a){var b=e.Buffer.byteLength(a);return this.uint32(b),b&&this._push(g,b,a),this},f._configure()},54247,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(24091);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(56678);function f(a){d.call(this,a)}f._configure=function(){e.Buffer&&(f.prototype._slice=e.Buffer.prototype.slice)},f.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+a,this.len))},f._configure()},49157,(a,b,c)=>{"use strict";var d=c;function e(){d.util._configure(),d.Writer._configure(d.BufferWriter),d.Reader._configure(d.BufferReader)}d.build="minimal",d.Writer=a.r(76326),d.BufferWriter=a.r(54522),d.Reader=a.r(24091),d.BufferReader=a.r(54247),d.util=a.r(56678),d.rpc=a.r(87873),d.roots=a.r(57270),d.configure=e,e()},9742,(a,b,c)=>{"use strict";var d=b.exports=a.r(49157);function e(a,b,c){return"function"==typeof b?(c=b,b=new d.Root):b||(b=new d.Root),b.load(a,c)}function f(a,b){return b||(b=new d.Root),b.loadSync(a)}d.build="light",d.load=e,d.loadSync=f,d.encoder=a.r(61614),d.decoder=a.r(51874),d.verifier=a.r(62606),d.converter=a.r(54298),d.ReflectionObject=a.r(70530),d.Namespace=a.r(63421),d.Root=a.r(66514),d.Enum=a.r(77676),d.Type=a.r(71886),d.Field=a.r(66882),d.OneOf=a.r(55845),d.MapField=a.r(38140),d.Service=a.r(87052),d.Method=a.r(70362),d.Message=a.r(5995),d.wrappers=a.r(20525),d.types=a.r(62003),d.util=a.r(43806),d.ReflectionObject._configure(d.Root),d.Namespace._configure(d.Type,d.Service,d.Enum),d.Root._configure(d.Type),d.Field._configure(d.Type)},324,(a,b,c)=>{"use strict";b.exports=n;var d=/[\s{}=;:[\],'"()<>]/g,e=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,g=/^ *[*/]+ */,h=/^\s*\*?\/*/,i=/\n/g,j=/\s/,k=/\\(.?)/g,l={0:"\0",r:"\r",n:"\n",t:"	"};function m(a){return a.replace(k,function(a,b){switch(b){case"\\":case"":return b;default:return l[b]||""}})}function n(a,b){a=a.toString();var c=0,k=a.length,l=1,n=0,o={},p=[],q=null;function r(a){return Error("illegal "+a+" (line "+l+")")}function s(){var b="'"===q?f:e;b.lastIndex=c-1;var d=b.exec(a);if(!d)throw r("string");return c=b.lastIndex,y(q),q=null,m(d[1])}function t(b){return a.charAt(b)}function u(c,d,e){var f,j={type:a.charAt(c++),lineEmpty:!1,leading:e},k=c-(b?2:3);do if(--k<0||"\n"===(f=a.charAt(k))){j.lineEmpty=!0;break}while(" "===f||"	"===f)for(var m=a.substring(c,d).split(i),p=0;p<m.length;++p)m[p]=m[p].replace(b?h:g,"").trim();j.text=m.join("\n").trim(),o[l]=j,n=l}function v(b){var c=w(b),d=a.substring(b,c);return/^\s*\/\//.test(d)}function w(a){for(var b=a;b<k&&"\n"!==t(b);)b++;return b}function x(){if(p.length>0)return p.shift();if(q)return s();var e,f,g,h,i,m=0===c;do{if(c===k)return null;for(e=!1;j.test(g=t(c));)if("\n"===g&&(m=!0,++l),++c===k)return null;if("/"===t(c)){if(++c===k)throw r("comment");if("/"===t(c))if(b){if(h=c,i=!1,v(c-1)){i=!0;do if((c=w(c))===k||(c++,!m))break;while(v(c))}else c=Math.min(k,w(c)+1);i&&(u(h,c,m),m=!0),l++,e=!0}else{for(i="/"===t(h=c+1);"\n"!==t(++c);)if(c===k)return null;++c,i&&(u(h,c-1,m),m=!0),++l,e=!0}else{if("*"!==(g=t(c)))return"/";h=c+1,i=b||"*"===t(h);do{if("\n"===g&&++l,++c===k)throw r("comment");f=g,g=t(c)}while("*"!==f||"/"!==g)++c,i&&(u(h,c-2,m),m=!0),e=!0}}}while(e)var n=c;if(d.lastIndex=0,!d.test(t(n++)))for(;n<k&&!d.test(t(n));)++n;var o=a.substring(c,c=n);return('"'===o||"'"===o)&&(q=o),o}function y(a){p.push(a)}function z(){if(!p.length){var a=x();if(null===a)return null;y(a)}return p[0]}function A(a,b){var c=z();if(c===a)return x(),!0;if(!b)throw r("token '"+c+"', '"+a+"' expected");return!1}function B(a){var c,d=null;return void 0===a?(c=o[l-1],delete o[l-1],c&&(b||"*"===c.type||c.lineEmpty)&&(d=c.leading?c.text:null)):(n<a&&z(),c=o[a],delete o[a],c&&!c.lineEmpty&&(b||"/"===c.type)&&(d=c.leading?null:c.text)),d}return Object.defineProperty({next:x,peek:z,push:y,skip:A,cmnt:B},"line",{get:function(){return l}})}n.unescape=m},69429,(a,b,c)=>{"use strict";b.exports=y,y.filename=null,y.defaults={keepCase:!1};var d=a.r(324),e=a.r(66514),f=a.r(71886),g=a.r(66882),h=a.r(38140),i=a.r(55845),j=a.r(77676),k=a.r(87052),l=a.r(70362),m=a.r(70530),n=a.r(62003),o=a.r(43806),p=/^[1-9][0-9]*$/,q=/^-?[1-9][0-9]*$/,r=/^0[x][0-9a-fA-F]+$/,s=/^-?0[x][0-9a-fA-F]+$/,t=/^0[0-7]+$/,u=/^-?0[0-7]+$/,v=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,w=/^[a-zA-Z_][a-zA-Z_0-9]*$/,x=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function y(a,b,c){b instanceof e||(c=b,b=new e),c||(c=y.defaults);var z,A,B,C,D=c.preferTrailingComment||!1,E=d(a,c.alternateCommentMode||!1),F=E.next,G=E.push,H=E.peek,I=E.skip,J=E.cmnt,K=!0,L="proto2",M=b,N=[],O={},P=c.keepCase?function(a){return a}:o.camelCase;function Q(){N.forEach(a=>{a._edition=L,Object.keys(O).forEach(b=>{void 0===a.getOption(b)&&a.setOption(b,O[b],!0)})})}function R(a,b,c){var d=y.filename;return c||(y.filename=null),Error("illegal "+(b||"token")+" '"+a+"' ("+(d?d+", ":"")+"line "+E.line+")")}function S(){var a,b=[];do{if('"'!==(a=F())&&"'"!==a)throw R(a);b.push(F()),I(a),a=H()}while('"'===a||"'"===a)return b.join("")}function T(a){var b=F();switch(b){case"'":case'"':return G(b),S();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return V(b,!0)}catch(c){if(a&&x.test(b))return b;throw R(b,"value")}}function U(a,b){do if(b&&('"'===(c=H())||"'"===c)){var c,d,e=S();if(a.push(e),L>=2023)throw R(e,"id")}else try{a.push([d=W(F()),I("to",!0)?W(F()):d])}catch(d){if(b&&x.test(c)&&L>=2023)a.push(c);else throw d}while(I(",",!0))var f={options:void 0};f.setOption=function(a,b){void 0===this.options&&(this.options={}),this.options[a]=b},aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)})}function V(a,b){var c=1;switch("-"===a.charAt(0)&&(c=-1,a=a.substring(1)),a){case"inf":case"INF":case"Inf":return 1/0*c;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(a))return c*parseInt(a,10);if(r.test(a))return c*parseInt(a,16);if(t.test(a))return c*parseInt(a,8);if(v.test(a))return c*parseFloat(a);throw R(a,"number",b)}function W(a,b){switch(a){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!b&&"-"===a.charAt(0))throw R(a,"id");if(q.test(a))return parseInt(a,10);if(s.test(a))return parseInt(a,16);if(u.test(a))return parseInt(a,8);throw R(a,"id")}function X(){if(void 0!==A)throw R("package");if(A=F(),!x.test(A))throw R(A,"name");M=M.define(A),I(";")}function Y(){var a,b=H();switch(b){case"weak":a=C||(C=[]),F();break;case"public":F();default:a=B||(B=[])}b=S(),I(";"),a.push(b)}function Z(){if(I("="),(L=S())<2023)throw R(L,"syntax");I(";")}function $(){if(I("="),!["2023"].includes(L=S()))throw R(L,"edition");I(";")}function _(a,b){switch(b){case"option":return ai(a,b),I(";"),!0;case"message":return ab(a,b),!0;case"enum":return ag(a,b),!0;case"service":return an(a,b),!0;case"extend":return ap(a,b),!0}return!1}function aa(a,b,c){var d,e=E.line;if(a&&("string"!=typeof a.comment&&(a.comment=J()),a.filename=y.filename),I("{",!0)){for(;"}"!==(d=F());)b(d);I(";",!0)}else c&&c(),I(";"),a&&("string"!=typeof a.comment||D)&&(a.comment=J(e)||a.comment)}function ab(a,b){if(!w.test(b=F()))throw R(b,"type name");var c=new f(b);aa(c,function(a){if(!_(c,a))switch(a){case"map":ae(c,a);break;case"required":if("proto2"!==L)throw R(a);case"repeated":ac(c,a);break;case"optional":if("proto3"===L)ac(c,"proto3_optional");else if("proto2"!==L)throw R(a);else ac(c,"optional");break;case"oneof":af(c,a);break;case"extensions":U(c.extensions||(c.extensions=[]));break;case"reserved":U(c.reserved||(c.reserved=[]),!0);break;default:if("proto2"===L||!x.test(a))throw R(a);G(a),ac(c,"optional")}}),a.add(c),a===M&&N.push(c)}function ac(a,b,c){var d=F();if("group"===d)return void ad(a,b);for(;d.endsWith(".")||H().startsWith(".");)d+=F();if(!x.test(d))throw R(d,"type");var e=F();if(!w.test(e))throw R(e,"name");e=P(e),I("=");var f=new g(e,W(F()),d,b,c);if(aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)}),"proto3_optional"===b){var h=new i("_"+e);f.setOption("proto3_optional",!0),h.add(f),a.add(h)}else a.add(f);a===M&&N.push(f)}function ad(a,b){if(L>=2023)throw R("group");var c=F();if(!w.test(c))throw R(c,"name");var d=o.lcFirst(c);c===d&&(c=o.ucFirst(c)),I("=");var e=W(F()),h=new f(c);h.group=!0;var i=new g(d,e,c,b);i.filename=y.filename,aa(h,function(a){switch(a){case"option":ai(h,a),I(";");break;case"required":case"repeated":ac(h,a);break;case"optional":"proto3"===L?ac(h,"proto3_optional"):ac(h,"optional");break;case"message":ab(h,a);break;case"enum":ag(h,a);break;case"reserved":U(h.reserved||(h.reserved=[]),!0);break;default:throw R(a)}}),a.add(h).add(i)}function ae(a){I("<");var b=F();if(void 0===n.mapKey[b])throw R(b,"type");I(",");var c=F();if(!x.test(c))throw R(c,"type");I(">");var d=F();if(!w.test(d))throw R(d,"name");I("=");var e=new h(P(d),W(F()),b,c);aa(e,function(a){if("option"===a)ai(e,a),I(";");else throw R(a)},function(){am(e)}),a.add(e)}function af(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new i(P(b));aa(c,function(a){"option"===a?(ai(c,a),I(";")):(G(a),ac(c,"optional"))}),a.add(c)}function ag(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new j(b);aa(c,function(a){switch(a){case"option":ai(c,a),I(";");break;case"reserved":U(c.reserved||(c.reserved=[]),!0),void 0===c.reserved&&(c.reserved=[]);break;default:ah(c,a)}}),a.add(c),a===M&&N.push(c)}function ah(a,b){if(!w.test(b))throw R(b,"name");I("=");var c=W(F(),!0),d={options:void 0};d.getOption=function(a){return this.options[a]},d.setOption=function(a,b){m.prototype.setOption.call(d,a,b)},d.setParsedOption=function(){},aa(d,function(a){if("option"===a)ai(d,a),I(";");else throw R(a)},function(){am(d)}),a.add(b,c,d.comment,d.parsedOptions||d.options)}function ai(a,b){var c,d,e=!0;for("option"===b&&(b=F());"="!==b;){if("("===b){var f=F();I(")"),b="("+f+")"}if(e){if(e=!1,b.includes(".")&&!b.includes("(")){var g=b.split(".");c=g[0]+".",b=g[1];continue}c=b}else d=d?d+=b:b;b=F()}var h=aj(a,d?c.concat(d):c);d=d&&"."===d[0]?d.slice(1):d,al(a,c=c&&"."===c[c.length-1]?c.slice(0,-1):c,h,d)}function aj(a,b){if(I("{",!0)){for(var c={};!I("}",!0);){if(!w.test(z=F()))throw R(z,"name");if(null===z)throw R(z,"end of input");var d,e,f=z;if(I(":",!0),"{"===H())d=aj(a,b+"."+z);else if("["===H()){if(d=[],I("[",!0)){do e=T(!0),d.push(e);while(I(",",!0))I("]"),void 0!==e&&ak(a,b+"."+z,e)}}else d=T(!0),ak(a,b+"."+z,d);var g=c[f];g&&(d=[].concat(g).concat(d)),c[f]=d,I(",",!0),I(";",!0)}return c}var h=T(!0);return ak(a,b,h),h}function ak(a,b,c){if(M===a&&/^features\./.test(b)){O[b]=c;return}a.setOption&&a.setOption(b,c)}function al(a,b,c,d){a.setParsedOption&&a.setParsedOption(b,c,d)}function am(a){if(I("[",!0)){do ai(a,"option");while(I(",",!0))I("]")}return a}function an(a,b){if(!w.test(b=F()))throw R(b,"service name");var c=new k(b);aa(c,function(a){if(!_(c,a))if("rpc"===a)ao(c,a);else throw R(a)}),a.add(c),a===M&&N.push(c)}function ao(a,b){var c=J(),d=b;if(!w.test(b=F()))throw R(b,"name");var e,f,g,h,i=b;if(I("("),I("stream",!0)&&(f=!0),!x.test(b=F())||(e=b,I(")"),I("returns"),I("("),I("stream",!0)&&(h=!0),!x.test(b=F())))throw R(b);g=b,I(")");var j=new l(i,d,e,g,f,h);j.comment=c,aa(j,function(a){if("option"===a)ai(j,a),I(";");else throw R(a)}),a.add(j)}function ap(a,b){if(!x.test(b=F()))throw R(b,"reference");var c=b;aa(null,function(b){switch(b){case"required":case"repeated":ac(a,b,c);break;case"optional":"proto3"===L?ac(a,"proto3_optional",c):ac(a,"optional",c);break;default:if("proto2"===L||!x.test(b))throw R(b);G(b),ac(a,"optional",c)}})}for(;null!==(z=F());)switch(z){case"package":if(!K)throw R(z);X();break;case"import":if(!K)throw R(z);Y();break;case"syntax":if(!K)throw R(z);Z();break;case"edition":if(!K)throw R(z);$();break;case"option":ai(M,z),I(";",!0);break;default:if(_(M,z)){K=!1;continue}throw R(z)}return Q(),y.filename=null,{package:A,imports:B,weakImports:C,root:b}}},33271,(a,b,c)=>{"use strict";b.exports=f;var d,e=/\/|\./;function f(a,b){e.test(a)||(a="google/protobuf/"+a+".proto",b={nested:{google:{nested:{protobuf:{nested:b}}}}}),f[a]=b}f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),f("duration",{Duration:d={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),f("timestamp",{Timestamp:d}),f("empty",{Empty:{fields:{}}}),f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),f.get=function(a){return f[a]||null}},54239,(a,b,c)=>{"use strict";var d=b.exports=a.r(9742);d.build="full",d.tokenize=a.r(324),d.parse=a.r(69429),d.common=a.r(33271),d.Root._configure(d.Type,d.parse,d.common)},84578,(a,b,c)=>{"use strict";b.exports=a.r(54239)},21757,(a,b,c)=>{"use strict";var d=a.r(84578);b.exports=c=d.descriptor=d.Root.fromJSON(a.r(67803)).lookup(".google.protobuf");var e=d.Namespace,f=d.Root,g=d.Enum,h=d.Type,i=d.Field,j=d.MapField,k=d.OneOf,l=d.Service,m=d.Method;function n(a,b,d){var j=c.FileDescriptorProto.create({name:a.filename||(a.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});E(d,j),a instanceof f||(j.package=a.fullName.substring(1));for(var k,m=0;m<a.nestedArray.length;++m)(k=a._nestedArray[m])instanceof h?j.messageType.push(k.toDescriptor(d)):k instanceof g?j.enumType.push(k.toDescriptor()):k instanceof i?j.extension.push(k.toDescriptor(d)):k instanceof l?j.service.push(k.toDescriptor()):k instanceof e&&n(k,b,d);j.options=A(a.options,c.FileOptions),j.messageType.length+j.enumType.length+j.extension.length+j.service.length&&b.push(j)}f.fromDescriptor=function(a){"number"==typeof a.length&&(a=c.FileDescriptorSet.decode(a));var b=new f;if(a.file)for(var d,e,j,k=0;k<a.file.length;++k){e=b,(d=a.file[k]).package&&d.package.length&&(e=b.define(d.package));var m=D(d);if(d.name&&d.name.length&&b.files.push(e.filename=d.name),d.messageType)for(j=0;j<d.messageType.length;++j)e.add(h.fromDescriptor(d.messageType[j],m));if(d.enumType)for(j=0;j<d.enumType.length;++j)e.add(g.fromDescriptor(d.enumType[j],m));if(d.extension)for(j=0;j<d.extension.length;++j)e.add(i.fromDescriptor(d.extension[j],m));if(d.service)for(j=0;j<d.service.length;++j)e.add(l.fromDescriptor(d.service[j],m));var n=y(d.options,c.FileOptions);if(n){var o=Object.keys(n);for(j=0;j<o.length;++j)e.setOption(o[j],n[o[j]])}}return b.resolveAll()},f.prototype.toDescriptor=function(a){var b=c.FileDescriptorSet.create();return n(this,b.file,a),b};var o=0;h.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.DescriptorProto.decode(a));var e,f=new h(a.name.length?a.name:"Type"+o++,y(a.options,c.MessageOptions));if(d||(f._edition=b),a.oneofDecl)for(e=0;e<a.oneofDecl.length;++e)f.add(k.fromDescriptor(a.oneofDecl[e]));if(a.field)for(e=0;e<a.field.length;++e){var j=i.fromDescriptor(a.field[e],b,!0);f.add(j),a.field[e].hasOwnProperty("oneofIndex")&&f.oneofsArray[a.field[e].oneofIndex].add(j)}if(a.extension)for(e=0;e<a.extension.length;++e)f.add(i.fromDescriptor(a.extension[e],b,!0));if(a.nestedType)for(e=0;e<a.nestedType.length;++e)f.add(h.fromDescriptor(a.nestedType[e],b,!0)),a.nestedType[e].options&&a.nestedType[e].options.mapEntry&&f.setOption("map_entry",!0);if(a.enumType)for(e=0;e<a.enumType.length;++e)f.add(g.fromDescriptor(a.enumType[e],b,!0));if(a.extensionRange&&a.extensionRange.length)for(e=0,f.extensions=[];e<a.extensionRange.length;++e)f.extensions.push([a.extensionRange[e].start,a.extensionRange[e].end]);if(a.reservedRange&&a.reservedRange.length||a.reservedName&&a.reservedName.length){if(f.reserved=[],a.reservedRange)for(e=0;e<a.reservedRange.length;++e)f.reserved.push([a.reservedRange[e].start,a.reservedRange[e].end]);if(a.reservedName)for(e=0;e<a.reservedName.length;++e)f.reserved.push(a.reservedName[e])}return f},h.prototype.toDescriptor=function(a){var b,d,e=c.DescriptorProto.create({name:this.name});for(d=0;d<this.fieldsArray.length;++d)if(e.field.push(b=this._fieldsArray[d].toDescriptor(a)),this._fieldsArray[d]instanceof j){var f=w(this._fieldsArray[d].keyType,this._fieldsArray[d].resolvedKeyType,!1),k=w(this._fieldsArray[d].type,this._fieldsArray[d].resolvedType,!1),l=11===k||14===k?this._fieldsArray[d].resolvedType&&B(this.parent,this._fieldsArray[d].resolvedType)||this._fieldsArray[d].type:void 0;e.nestedType.push(c.DescriptorProto.create({name:b.typeName,field:[c.FieldDescriptorProto.create({name:"key",number:1,label:1,type:f}),c.FieldDescriptorProto.create({name:"value",number:2,label:1,type:k,typeName:l})],options:c.MessageOptions.create({mapEntry:!0})}))}for(d=0;d<this.oneofsArray.length;++d)e.oneofDecl.push(this._oneofsArray[d].toDescriptor());for(d=0;d<this.nestedArray.length;++d)this._nestedArray[d]instanceof i?e.field.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof h?e.nestedType.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof g&&e.enumType.push(this._nestedArray[d].toDescriptor());if(this.extensions)for(d=0;d<this.extensions.length;++d)e.extensionRange.push(c.DescriptorProto.ExtensionRange.create({start:this.extensions[d][0],end:this.extensions[d][1]}));if(this.reserved)for(d=0;d<this.reserved.length;++d)"string"==typeof this.reserved[d]?e.reservedName.push(this.reserved[d]):e.reservedRange.push(c.DescriptorProto.ReservedRange.create({start:this.reserved[d][0],end:this.reserved[d][1]}));return e.options=A(this.options,c.MessageOptions),e};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;i.fromDescriptor=function(a,b,d){if("number"==typeof a.length&&(a=c.DescriptorProto.decode(a)),"number"!=typeof a.number)throw Error("missing field id");switch(e=a.typeName&&a.typeName.length?a.typeName:u(a.type),a.label){case 1:f=void 0;break;case 2:f="required";break;case 3:f="repeated";break;default:throw Error("illegal label: "+a.label)}var e,f,g=a.extendee;void 0!==a.extendee&&(g=g.length?g:void 0);var h=new i(a.name.length?a.name:"field"+a.number,a.number,e,f,g);if(d||(h._edition=b),h.options=y(a.options,c.FieldOptions),a.proto3_optional&&(h.options.proto3_optional=!0),a.defaultValue&&a.defaultValue.length){var j=a.defaultValue;switch(j){case"true":case"TRUE":j=!0;break;case"false":case"FALSE":j=!1;break;default:p.exec(j)&&(j=parseInt(j))}h.setOption("default",j)}return v(a.type)&&("proto3"===b?a.options&&!a.options.packed&&h.setOption("packed",!1):(!b||"proto2"===b)&&a.options&&a.options.packed&&h.setOption("packed",!0)),h},i.prototype.toDescriptor=function(a){var b=c.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)b.type=11,b.typeName=d.util.ucFirst(this.name),b.label=3;else{switch(b.type=w(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:b.typeName=this.resolvedType?B(this.parent,this.resolvedType):this.type}"repeated"===this.rule?b.label=3:this.required&&"proto2"===a?b.label=2:b.label=1}if(b.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(b.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(b.options=A(this.options,c.FieldOptions),null!=this.options.default&&(b.defaultValue=String(this.options.default)),this.options.proto3_optional&&(b.proto3_optional=!0)),"proto3"===a?this.packed||((b.options||(b.options=c.FieldOptions.create())).packed=!1):(!a||"proto2"===a)&&this.packed&&((b.options||(b.options=c.FieldOptions.create())).packed=!0),b};var q=0;g.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.EnumDescriptorProto.decode(a));var e={};if(a.value)for(var f=0;f<a.value.length;++f){var h=a.value[f].name,i=a.value[f].number||0;e[h&&h.length?h:"NAME"+i]=i}var j=new g(a.name&&a.name.length?a.name:"Enum"+q++,e,y(a.options,c.EnumOptions));return d||(j._edition=b),j},g.prototype.toDescriptor=function(){for(var a=[],b=0,d=Object.keys(this.values);b<d.length;++b)a.push(c.EnumValueDescriptorProto.create({name:d[b],number:this.values[d[b]]}));return c.EnumDescriptorProto.create({name:this.name,value:a,options:A(this.options,c.EnumOptions)})};var r=0;k.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.OneofDescriptorProto.decode(a)),new k(a.name&&a.name.length?a.name:"oneof"+r++)},k.prototype.toDescriptor=function(){return c.OneofDescriptorProto.create({name:this.name})};var s=0;l.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.ServiceDescriptorProto.decode(a));var e=new l(a.name&&a.name.length?a.name:"Service"+s++,y(a.options,c.ServiceOptions));if(d||(e._edition=b),a.method)for(var f=0;f<a.method.length;++f)e.add(m.fromDescriptor(a.method[f]));return e},l.prototype.toDescriptor=function(){for(var a=[],b=0;b<this.methodsArray.length;++b)a.push(this._methodsArray[b].toDescriptor());return c.ServiceDescriptorProto.create({name:this.name,method:a,options:A(this.options,c.ServiceOptions)})};var t=0;function u(a){switch(a){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+a)}function v(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(a,b,c){switch(a){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(b instanceof g)return 14;if(b instanceof h)return c?10:11;throw Error("illegal type: "+a)}function x(a,b){for(var c,d,e={},f=0;f<b.fieldsArray.length;++f)if("uninterpretedOption"!==(d=(c=b._fieldsArray[f]).name)&&Object.prototype.hasOwnProperty.call(a,d)){var i=C(d);c.resolvedType instanceof h?e[i]=x(a[d],c.resolvedType):c.resolvedType instanceof g?e[i]=c.resolvedType.valuesById[a[d]]:e[i]=a[d]}return e}function y(a,b){if(a)return x(b.toObject(a),b)}function z(a,b){for(var c={},e=Object.keys(a),f=0;f<e.length;++f){var g=e[f],i=d.util.camelCase(g);if(Object.prototype.hasOwnProperty.call(b.fields,i)){var j=b.fields[i];j.resolvedType instanceof h?c[i]=z(a[g],j.resolvedType):c[i]=a[g],j.repeated&&!Array.isArray(c[i])&&(c[i]=[c[i]])}}return c}function A(a,b){if(a)return b.fromObject(z(a,b))}function B(a,b){var c=a.fullName.split("."),d=b.fullName.split("."),g=0,h=0,i=d.length-1;if(!(a instanceof f)&&b instanceof e)for(;g<c.length&&h<i&&c[g]===d[h];){var j=b.lookup(c[g++],!0);if(null!==j&&j!==b)break;++h}else for(;g<c.length&&h<i&&c[g]===d[h];++g,++h);return d.slice(h).join(".")}function C(a){return a.substring(0,1)+a.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(a,b){return"_"+b.toLowerCase()})}function D(a){if("editions"===a.syntax)if(a.edition===c.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+a.edition);return"proto3"===a.syntax?"proto3":"proto2"}function E(a,b){if(a)if("proto2"===a||"proto3"===a)b.syntax=a;else if(b.syntax="editions","2023"===a)b.edition=c.Edition.EDITION_2023;else throw Error("Unsupported edition "+a)}m.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.MethodDescriptorProto.decode(a)),new m(a.name&&a.name.length?a.name:"Method"+t++,"rpc",a.inputType,a.outputType,!!a.clientStreaming,!!a.serverStreaming,y(a.options,c.MethodOptions))},m.prototype.toDescriptor=function(){return c.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:A(this.options,c.MethodOptions)})}},69030,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addCommonProtos=c.loadProtosWithOptionsSync=c.loadProtosWithOptions=void 0;let d=a.r(22734),e=a.r(14747),f=a.r(84578);function g(a,b){let c=a.resolvePath;a.resolvePath=(a,f)=>{if(e.isAbsolute(f))return f;for(let a of b){let b=e.join(a,f);try{return d.accessSync(b,d.constants.R_OK),b}catch(a){continue}}return process.emitWarning(`${f} not found in any of the include paths ${b}`),c(a,f)}}c.loadProtosWithOptions=async function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));g(c,b.includeDirs)}let d=await c.load(a,b);return d.resolveAll(),d},c.loadProtosWithOptionsSync=function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))throw Error("The includeDirs option must be an array");g(c,b.includeDirs)}let d=c.loadSync(a,b);return d.resolveAll(),d},c.addCommonProtos=function(){let b=a.r(99244),c=a.r(67803),d=a.r(93383),e=a.r(79715);f.common("api",b.nested.google.nested.protobuf.nested),f.common("descriptor",c.nested.google.nested.protobuf.nested),f.common("source_context",d.nested.google.nested.protobuf.nested),f.common("type",e.nested.google.nested.protobuf.nested)}},2774,(a,b,c)=>{!function(d,e){function f(a){return a.default||a}if("function"==typeof define&&define.amd){let b;void 0!==(b=function(){var a={};return e(a),f(a)}())&&a.v(b)}else e(c),b.exports=f(c)}("u">typeof globalThis?globalThis:"u">typeof self?self:a.e,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var b=null;try{b=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function c(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function d(a){return!0===(a&&a.__isLong__)}function e(a){var b=Math.clz32(a&-a);return a?31-b:b}c.prototype.__isLong__,Object.defineProperty(c.prototype,"__isLong__",{value:!0}),c.isLong=d;var f={},g={};function h(a,b){var c,d,e;if(b)return(a>>>=0,(e=0<=a&&a<256)&&(d=g[a]))?d:(c=j(a,0,!0),e&&(g[a]=c),c);return(a|=0,(e=-128<=a&&a<128)&&(d=f[a]))?d:(c=j(a,a<0?-1:0,!1),e&&(f[a]=c),c)}function i(a,b){if(isNaN(a))return b?s:r;if(b){if(a<0)return s;if(a>=o)return x}else{if(a<=-p)return y;if(a+1>=p)return w}return a<0?i(-a,b).neg():j(a%n|0,a/n|0,b)}function j(a,b,d){return new c(a,b,d)}c.fromInt=h,c.fromNumber=i,c.fromBits=j;var k=Math.pow;function l(a,b,c){if(0===a.length)throw Error("empty string");if("number"==typeof b?(c=b,b=!1):b=!!b,"NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return b?s:r;if((c=c||10)<2||36<c)throw RangeError("radix");if((d=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===d)return l(a.substring(1),b,c).neg();for(var d,e=i(k(c,8)),f=r,g=0;g<a.length;g+=8){var h=Math.min(8,a.length-g),j=parseInt(a.substring(g,g+h),c);if(h<8){var m=i(k(c,h));f=f.mul(m).add(i(j))}else f=(f=f.mul(e)).add(i(j))}return f.unsigned=b,f}function m(a,b){return"number"==typeof a?i(a,b):"string"==typeof a?l(a,b):j(a.low,a.high,"boolean"==typeof b?b:a.unsigned)}c.fromString=l,c.fromValue=m;var n=0x100000000,o=0xffffffffffffffff,p=0x8000000000000000,q=h(0x1000000),r=h(0);c.ZERO=r;var s=h(0,!0);c.UZERO=s;var t=h(1);c.ONE=t;var u=h(1,!0);c.UONE=u;var v=h(-1);c.NEG_ONE=v;var w=j(-1,0x7fffffff,!1);c.MAX_VALUE=w;var x=j(-1,-1,!0);c.MAX_UNSIGNED_VALUE=x;var y=j(0,-0x80000000,!1);c.MIN_VALUE=y;var z=c.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low},z.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},z.toString=function(a){if((a=a||10)<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(y))return"-"+this.neg().toString(a);else{var b=i(a),c=this.div(b),d=c.mul(b).sub(this);return c.toString(a)+d.toInt().toString(a)}for(var e=i(k(a,6),this.unsigned),f=this,g="";;){var h=f.div(e),j=(f.sub(h.mul(e)).toInt()>>>0).toString(a);if((f=h).isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},z.getHighBits=function(){return this.high},z.getHighBitsUnsigned=function(){return this.high>>>0},z.getLowBits=function(){return this.low},z.getLowBitsUnsigned=function(){return this.low>>>0},z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&(a&1<<b)==0;b--);return 0!=this.high?b+33:b+1},z.isSafeInteger=function(){var a=this.high>>21;return!a||!this.unsigned&&-1===a&&(0!==this.low||-2097152!==this.high)},z.isZero=function(){return 0===this.high&&0===this.low},z.eqz=z.isZero,z.isNegative=function(){return!this.unsigned&&this.high<0},z.isPositive=function(){return this.unsigned||this.high>=0},z.isOdd=function(){return(1&this.low)==1},z.isEven=function(){return(1&this.low)==0},z.equals=function(a){return d(a)||(a=m(a)),(this.unsigned===a.unsigned||this.high>>>31!=1||a.high>>>31!=1)&&this.high===a.high&&this.low===a.low},z.eq=z.equals,z.notEquals=function(a){return!this.eq(a)},z.neq=z.notEquals,z.ne=z.notEquals,z.lessThan=function(a){return 0>this.comp(a)},z.lt=z.lessThan,z.lessThanOrEqual=function(a){return 0>=this.comp(a)},z.lte=z.lessThanOrEqual,z.le=z.lessThanOrEqual,z.greaterThan=function(a){return this.comp(a)>0},z.gt=z.greaterThan,z.greaterThanOrEqual=function(a){return this.comp(a)>=0},z.gte=z.greaterThanOrEqual,z.ge=z.greaterThanOrEqual,z.compare=function(a){if(d(a)||(a=m(a)),this.eq(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},z.comp=z.compare,z.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(t)},z.neg=z.negate,z.add=function(a){d(a)||(a=m(a));var b,c,e=this.high>>>16,f=65535&this.high,g=this.low>>>16,h=65535&this.low,i=a.high>>>16,k=65535&a.high,l=a.low>>>16,n=65535&a.low,o=0,p=0;return b=0+((c=0+(h+n))>>>16),c&=65535,b+=g+l,p+=b>>>16,b&=65535,p+=f+k,o+=p>>>16,p&=65535,o+=e+i,j(b<<16|c,(o&=65535)<<16|p,this.unsigned)},z.subtract=function(a){return d(a)||(a=m(a)),this.add(a.neg())},z.sub=z.subtract,z.multiply=function(a){if(this.isZero())return this;if(d(a)||(a=m(a)),b)return j(b.mul(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned);if(a.isZero())return this.unsigned?s:r;if(this.eq(y))return a.isOdd()?y:r;if(a.eq(y))return this.isOdd()?y:r;if(this.isNegative())if(a.isNegative())return this.neg().mul(a.neg());else return this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(q)&&a.lt(q))return i(this.toNumber()*a.toNumber(),this.unsigned);var c,e,f=this.high>>>16,g=65535&this.high,h=this.low>>>16,k=65535&this.low,l=a.high>>>16,n=65535&a.high,o=a.low>>>16,p=65535&a.low,t=0,u=0;return c=0+((e=0+k*p)>>>16),e&=65535,c+=h*p,u+=c>>>16,c&=65535,c+=k*o,u+=c>>>16,c&=65535,u+=g*p,t+=u>>>16,u&=65535,u+=h*o,t+=u>>>16,u&=65535,u+=k*n,t+=u>>>16,u&=65535,t+=f*p+g*o+h*n+k*l,j(c<<16|e,(t&=65535)<<16|u,this.unsigned)},z.mul=z.multiply,z.divide=function(a){if(d(a)||(a=m(a)),a.isZero())throw Error("division by zero");if(b){var c,e,f;return this.unsigned||-0x80000000!==this.high||-1!==a.low||-1!==a.high?j((this.unsigned?b.div_u:b.div_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?s:r;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return s;if(a.gt(this.shru(1)))return u;f=s}else{if(this.eq(y))if(a.eq(t)||a.eq(v))return y;else return a.eq(y)?t:(c=this.shr(1).div(a).shl(1)).eq(r)?a.isNegative()?t:v:(e=this.sub(a.mul(c)),f=c.add(e.div(a)));if(a.eq(y))return this.unsigned?s:r;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=r}for(e=this;e.gte(a);){for(var g=Math.ceil(Math.log(c=Math.max(1,Math.floor(e.toNumber()/a.toNumber())))/Math.LN2),h=g<=48?1:k(2,g-48),l=i(c),n=l.mul(a);n.isNegative()||n.gt(e);)c-=h,n=(l=i(c,this.unsigned)).mul(a);l.isZero()&&(l=t),f=f.add(l),e=e.sub(n)}return f},z.div=z.divide,z.modulo=function(a){return(d(a)||(a=m(a)),b)?j((this.unsigned?b.rem_u:b.rem_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this.sub(this.div(a).mul(a))},z.mod=z.modulo,z.rem=z.modulo,z.not=function(){return j(~this.low,~this.high,this.unsigned)},z.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},z.clz=z.countLeadingZeros,z.countTrailingZeros=function(){return this.low?e(this.low):e(this.high)+32},z.ctz=z.countTrailingZeros,z.and=function(a){return d(a)||(a=m(a)),j(this.low&a.low,this.high&a.high,this.unsigned)},z.or=function(a){return d(a)||(a=m(a)),j(this.low|a.low,this.high|a.high,this.unsigned)},z.xor=function(a){return d(a)||(a=m(a)),j(this.low^a.low,this.high^a.high,this.unsigned)},z.shiftLeft=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):j(0,this.low<<a-32,this.unsigned)},z.shl=z.shiftLeft,z.shiftRight=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):j(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},z.shr=z.shiftRight,z.shiftRightUnsigned=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>>a,this.unsigned):32===a?j(this.high,0,this.unsigned):j(this.high>>>a-32,0,this.unsigned)},z.shru=z.shiftRightUnsigned,z.shr_u=z.shiftRightUnsigned,z.rotateLeft=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.low<<a|this.high>>>b,this.high<<a|this.low>>>b,this.unsigned)):(a-=32,b=32-a,j(this.high<<a|this.low>>>b,this.low<<a|this.high>>>b,this.unsigned))},z.rotl=z.rotateLeft,z.rotateRight=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.high<<b|this.low>>>a,this.low<<b|this.high>>>a,this.unsigned)):(a-=32,b=32-a,j(this.low<<b|this.high>>>a,this.high<<b|this.low>>>a,this.unsigned))},z.rotr=z.rotateRight,z.toSigned=function(){return this.unsigned?j(this.low,this.high,!1):this},z.toUnsigned=function(){return this.unsigned?this:j(this.low,this.high,!0)},z.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},z.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24,255&a,a>>>8&255,a>>>16&255,a>>>24]},z.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24,a>>>16&255,a>>>8&255,255&a,b>>>24,b>>>16&255,b>>>8&255,255&b]},c.fromBytes=function(a,b,d){return d?c.fromBytesLE(a,b):c.fromBytesBE(a,b)},c.fromBytesLE=function(a,b){return new c(a[0]|a[1]<<8|a[2]<<16|a[3]<<24,a[4]|a[5]<<8|a[6]<<16|a[7]<<24,b)},c.fromBytesBE=function(a,b){return new c(a[4]<<24|a[5]<<16|a[6]<<8|a[7],a[0]<<24|a[1]<<16|a[2]<<8|a[3],b)},"function"==typeof BigInt&&(c.fromBigInt=function(a,b){return j(Number(BigInt.asIntN(32,a)),Number(BigInt.asIntN(32,a>>BigInt(32))),b)},c.fromValue=function(a,b){return"bigint"==typeof a?c.fromBigInt(a,b):m(a,b)},z.toBigInt=function(){var a=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|a}),a.default=c})},67523,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.loadFileDescriptorSetFromObject=c.loadFileDescriptorSetFromBuffer=c.fromJSON=c.loadSync=c.load=c.IdempotencyLevel=c.isAnyExtension=c.Long=void 0;let e=a.r(77802),f=a.r(84578),g=a.r(21757),h=a.r(69030);c.Long=a.r(2774),c.isAnyExtension=function(a){return"@type"in a&&"string"==typeof a["@type"]},function(a){a.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",a.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",a.IDEMPOTENT="IDEMPOTENT"}(d=c.IdempotencyLevel||(c.IdempotencyLevel={}));let i={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function j(a,b){return""===a?b:a+"."+b}function k(a){return a instanceof f.Service||a instanceof f.Type||a instanceof f.Enum}function l(a){return a instanceof f.Namespace||a instanceof f.Root}function m(a,b){let c=j(b,a.name);return k(a)?[[c,a]]:l(a)&&void 0!==a.nested?Object.keys(a.nested).map(b=>m(a.nested[b],c)).reduce((a,b)=>a.concat(b),[]):[]}function n(a,b){return function(c){return a.toObject(a.decode(c),b)}}function o(a){return function(b){if(Array.isArray(b))throw Error(`Failed to serialize message: expected object with ${a.name} structure, got array instead`);let c=a.fromObject(b);return a.encode(c).finish()}}function p(a){return(a||[]).reduce((a,b)=>{for(let[c,d]of Object.entries(b))"uninterpreted_option"===c?a.uninterpreted_option.push(b.uninterpreted_option):a[c]=d;return a},{deprecated:!1,idempotency_level:d.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function q(a,b,c,d){let f=a.resolvedRequestType,g=a.resolvedResponseType;return{path:"/"+b+"/"+a.name,requestStream:!!a.requestStream,responseStream:!!a.responseStream,requestSerialize:o(f),requestDeserialize:n(f,c),responseSerialize:o(g),responseDeserialize:n(g,c),originalName:e(a.name),requestType:s(f,d),responseType:s(g,d),options:p(a.parsedOptions)}}function r(a,b,c,d){let e={};for(let f of a.methodsArray)e[f.name]=q(f,b,c,d);return e}function s(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function t(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function u(a,b,c,d){if(a instanceof f.Service)return r(a,b,c,d);if(a instanceof f.Type)return s(a,d);if(a instanceof f.Enum)return t(a,d);throw Error("Type mismatch in reflection object handling")}function v(a,b){let c={};a.resolveAll();let d=a.toDescriptor("proto3").file.map(a=>Buffer.from(g.FileDescriptorProto.encode(a).finish()));for(let[e,f]of m(a,""))c[e]=u(f,e,b,d);return c}function w(a,b){b=b||{};let c=f.Root.fromDescriptor(a);return c.resolveAll(),v(c,b)}c.load=function(a,b){return(0,h.loadProtosWithOptions)(a,b).then(a=>v(a,b))},c.loadSync=function(a,b){return v((0,h.loadProtosWithOptionsSync)(a,b),b)},c.fromJSON=function(a,b){b=b||{};let c=f.Root.fromJSON(a);return c.resolveAll(),v(c,b)},c.loadFileDescriptorSetFromBuffer=function(a,b){return w(g.FileDescriptorSet.decode(a),b)},c.loadFileDescriptorSetFromObject=function(a,b){return w(g.FileDescriptorSet.fromObject(a),b)},(0,h.addCommonProtos)()},74970,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.getChannelzServiceDefinition=c.getChannelzHandlers=c.unregisterChannelzRef=c.registerChannelzSocket=c.registerChannelzServer=c.registerChannelzSubchannel=c.registerChannelzChannel=c.ChannelzCallTracker=c.ChannelzChildrenTracker=c.ChannelzTrace=void 0;let d=a.r(4446),e=a.r(56537),f=a.r(57982),g=a.r(91177),h=a.r(31509),i=a.r(80721);function j(a){return{channel_id:a.id,name:a.name}}function k(a){return{subchannel_id:a.id,name:a.name}}function l(a){return{server_id:a.id}}function m(a){return{socket_id:a.id,name:a.name}}let n=32;class o{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(a,b,c){let d=new Date;this.events.push({description:b,severity:a,timestamp:d,childChannel:(null==c?void 0:c.kind)==="channel"?c:void 0,childSubchannel:(null==c?void 0:c.kind)==="subchannel"?c:void 0}),this.events.length>=2*n&&(this.events=this.events.slice(n)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:B(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(a=>({description:a.description,severity:a.severity,timestamp:B(a.timestamp),channel_ref:a.childChannel?j(a.childChannel):null,subchannel_ref:a.childSubchannel?k(a.childSubchannel):null}))}}}c.ChannelzTrace=o;class p{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(a){var b,c,d;switch(a.kind){case"channel":{let c=null!=(b=this.channelChildren.get(a.id))?b:{ref:a,count:0};c.count+=1,this.channelChildren.set(a.id,c);break}case"subchannel":{let b=null!=(c=this.subchannelChildren.get(a.id))?c:{ref:a,count:0};b.count+=1,this.subchannelChildren.set(a.id,b);break}case"socket":{let b=null!=(d=this.socketChildren.get(a.id))?d:{ref:a,count:0};b.count+=1,this.socketChildren.set(a.id,b)}}}unrefChild(a){switch(a.kind){case"channel":{let b=this.channelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.channelChildren.delete(a.id):this.channelChildren.set(a.id,b));break}case"subchannel":{let b=this.subchannelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.subchannelChildren.delete(a.id):this.subchannelChildren.set(a.id,b));break}case"socket":{let b=this.socketChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.socketChildren.delete(a.id):this.socketChildren.set(a.id,b))}}}getChildLists(){let a=[];for(let{ref:b}of this.channelChildren.values())a.push(b);let b=[];for(let{ref:a}of this.subchannelChildren.values())b.push(a);let c=[];for(let{ref:a}of this.socketChildren.values())c.push(a);return{channels:a,subchannels:b,sockets:c}}}c.ChannelzChildrenTracker=p;class q{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}c.ChannelzCallTracker=q;let r=1;function s(){return r++}let t=[],u=[],v=[],w=[];function x(a){let b=Number.parseInt(a,16);return[b/256|0,b%256]}function y(a){return""===a?[]:[].concat(...a.split(":").map(a=>x(a)))}function z(a){if((0,d.isIPv4)(a))return Buffer.from(Uint8Array.from(a.split(".").map(a=>Number.parseInt(a))));if(!(0,d.isIPv6)(a))return null;{let b,c,d=a.indexOf("::");-1===d?(b=a,c=""):(b=a.substring(0,d),c=a.substring(d+2));let e=Buffer.from(y(b)),f=Buffer.from(y(c)),g=Buffer.alloc(16-e.length-f.length,0);return Buffer.concat([e,g,f])}}function A(a){switch(a){case e.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case e.ConnectivityState.IDLE:return{state:"IDLE"};case e.ConnectivityState.READY:return{state:"READY"};case e.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case e.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function B(a){if(!a)return null;let b=a.getTime();return{seconds:b/1e3|0,nanos:b%1e3*1e6}}function C(a){let b=a.getInfo();return{ref:j(a.ref),data:{target:b.target,state:A(b.state),calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},channel_ref:b.children.channels.map(a=>j(a)),subchannel_ref:b.children.subchannels.map(a=>k(a))}}function D(a,b){let c=Number.parseInt(a.request.channel_id),d=t[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No channel data found for id "+c}):b(null,{channel:C(d)})}function E(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_channel_id);for(;e<t.length;e++){let a=t[e];if(void 0!==a&&(d.push(C(a)),d.length>=c))break}b(null,{channel:d,end:e>=v.length})}function F(a){let b=a.getInfo();return{ref:l(a.ref),data:{calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},listen_socket:b.listenerChildren.sockets.map(a=>m(a))}}function G(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c}):b(null,{server:F(d)})}function H(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_server_id);for(;e<v.length;e++){let a=v[e];if(void 0!==a&&(d.push(F(a)),d.length>=c))break}b(null,{server:d,end:e>=v.length})}function I(a,b){let c=Number.parseInt(a.request.subchannel_id),d=u[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No subchannel data found for id "+c});let e=d.getInfo();b(null,{subchannel:{ref:k(d.ref),data:{target:e.target,state:A(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:B(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},socket_ref:e.children.sockets.map(a=>m(a))}})}function J(a){var b;return(0,g.isTcpSubchannelAddress)(a)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(b=z(a.host))?b:void 0,port:a.port}}:{address:"uds_address",uds_address:{filename:a.path}}}function K(a,b){var c,d,e,g,h;let i=Number.parseInt(a.request.socket_id),j=w[i];if(void 0===j)return void b({code:f.Status.NOT_FOUND,details:"No socket data found for id "+i});let k=j.getInfo(),l=k.security?{model:"tls",tls:{cipher_suite:k.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(c=k.security.cipherSuiteStandardName)?c:void 0,other_name:null!=(d=k.security.cipherSuiteOtherName)?d:void 0,local_certificate:null!=(e=k.security.localCertificate)?e:void 0,remote_certificate:null!=(g=k.security.remoteCertificate)?g:void 0}}:null;b(null,{socket:{ref:m(j.ref),local:k.localAddress?J(k.localAddress):null,remote:k.remoteAddress?J(k.remoteAddress):null,remote_name:null!=(h=k.remoteName)?h:void 0,security:l,data:{keep_alives_sent:k.keepAlivesSent,streams_started:k.streamsStarted,streams_succeeded:k.streamsSucceeded,streams_failed:k.streamsFailed,last_local_stream_created_timestamp:B(k.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:B(k.lastRemoteStreamCreatedTimestamp),messages_received:k.messagesReceived,messages_sent:k.messagesSent,last_message_received_timestamp:B(k.lastMessageReceivedTimestamp),last_message_sent_timestamp:B(k.lastMessageSentTimestamp),local_flow_control_window:k.localFlowControlWindow?{value:k.localFlowControlWindow}:null,remote_flow_control_window:k.remoteFlowControlWindow?{value:k.remoteFlowControlWindow}:null}}})}function L(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});let e=Number.parseInt(a.request.start_socket_id),g=Number.parseInt(a.request.max_results),h=d.getInfo().sessionChildren.sockets.sort((a,b)=>a.id-b.id),i=[],j=0;for(;j<h.length&&(!(h[j].id>=e)||(i.push(m(h[j])),!(i.length>=g)));j++);b(null,{socket_ref:i,end:j>=h.length})}function M(){return{GetChannel:D,GetTopChannels:E,GetServer:G,GetServers:H,GetSubchannel:I,GetSocket:K,GetServerSockets:L}}c.registerChannelzChannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"channel"};return c&&(t[d]={ref:e,getInfo:b}),e},c.registerChannelzSubchannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"subchannel"};return c&&(u[d]={ref:e,getInfo:b}),e},c.registerChannelzServer=function(a,b){let c=s(),d={id:c,kind:"server"};return b&&(v[c]={ref:d,getInfo:a}),d},c.registerChannelzSocket=function(a,b,c){let d=s(),e={id:d,name:a,kind:"socket"};return c&&(w[d]={ref:e,getInfo:b}),e},c.unregisterChannelzRef=function(a){switch(a.kind){case"channel":delete t[a.id];return;case"subchannel":delete u[a.id];return;case"server":delete v[a.id];return;case"socket":delete w[a.id];return}},c.getChannelzHandlers=M;let N=null;function O(){if(N)return N;let b=(0,a.r(67523).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/node_modules/@grpc/grpc-js/build/src/../../proto"]});return N=(0,i.loadPackageDefinition)(b).grpc.channelz.v1.Channelz.service}c.getChannelzServiceDefinition=O,c.setup=function(){(0,h.registerAdminService)(O,M)}},85115,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Subchannel=void 0;let d=a.r(56537),e=a.r(57451),f=a.r(11717),g=a.r(57982),h=a.r(55647),i=a.r(91177),j=a.r(74970),k="subchannel",l=0x7fffffff;class m{constructor(a,b,c,f,g){var h;this.channelTarget=a,this.subchannelAddress=b,this.options=c,this.credentials=f,this.connector=g,this.connectivityState=d.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new j.ChannelzCallTracker,this.childrenTracker=new j.ChannelzChildrenTracker,this.streamTracker=new j.ChannelzCallTracker;const k={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new e.BackoffTimeout(()=>{this.handleBackoffTimer()},k),this.backoffTimeout.unref(),this.subchannelAddressString=(0,i.subchannelAddressToString)(b),this.keepaliveTime=null!=(h=c["grpc.keepalive_time_ms"])?h:-1,0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new j.ChannelzTrace,this.channelzRef=(0,j.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(c,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(a){f.trace(g.LogVerbosity.DEBUG,k,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}refTrace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING):this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let a=this.options;if(a["grpc.keepalive_time_ms"]){let b=Math.min(this.keepaliveTime,l);a=Object.assign(Object.assign({},a),{"grpc.keepalive_time_ms":b})}this.connector.connect(this.subchannelAddress,this.credentials,a).then(a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.READY)?(this.transport=a,this.channelzEnabled&&this.childrenTracker.refChild(a.getChannelzRef()),a.addDisconnectListener(a=>{this.transitionToState([d.ConnectivityState.READY],d.ConnectivityState.IDLE),a&&this.keepaliveTime>0&&(this.keepaliveTime*=2,f.log(g.LogVerbosity.ERROR,`Connection to ${(0,h.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):a.shutdown()},a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.TRANSIENT_FAILURE,`${a}`)})}transitionToState(a,b,c){var e,f;if(-1===a.indexOf(this.connectivityState))return!1;this.trace(d.ConnectivityState[this.connectivityState]+" -> "+d.ConnectivityState[b]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+d.ConnectivityState[b]);let g=this.connectivityState;switch(this.connectivityState=b,b){case d.ConnectivityState.READY:this.stopBackoff();break;case d.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case d.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(e=this.transport)||e.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case d.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(f=this.transport)||f.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${b}`)}for(let a of this.stateListeners)a(this,g,b,this.keepaliveTime,c);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,j.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([d.ConnectivityState.CONNECTING,d.ConnectivityState.READY],d.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(a,b,c,d){let e;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),e={onCallEnd:a=>{a.code===g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):e={},this.transport.createCall(a,b,c,d,e)}startConnecting(){process.nextTick(()=>{this.transitionToState([d.ConnectivityState.IDLE],d.ConnectivityState.CONNECTING)||this.connectivityState!==d.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(a){this.stateListeners.add(a)}removeConnectivityStateListener(a){this.stateListeners.delete(a)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(a){return a.getRealSubchannel()===this}throttleKeepalive(a){a>this.keepaliveTime&&(this.keepaliveTime=a)}}c.Subchannel=m},87695,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.DEFAULT_PORT=void 0;let d=a.r(49845),e=a.r(79594),f=a.r(24361),g=a.r(83931),h=a.r(57982),i=a.r(57904),j=a.r(11717),k=a.r(57982),l=a.r(55647),m=a.r(4446),n=a.r(57451),o="dns_resolver";function p(a){j.trace(k.LogVerbosity.DEBUG,o,a)}c.DEFAULT_PORT=443;let q=3e4,r=f.promisify(e.resolveTxt),s=f.promisify(e.lookup);function t(...a){let b=[];for(let c=0;c<Math.max.apply(null,a.map(a=>a.length));c++)for(let d of a)c<d.length&&b.push(d[c]);return b}class u{constructor(a,b,d){var e,f,g;this.target=a,this.listener=b,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,p("Resolver constructed for target "+(0,l.uriToString)(a));const j=(0,l.splitHostPort)(a.path);null===j?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m.isIPv4)(j.host)||(0,m.isIPv6)(j.host)?(this.ipResult=[{host:j.host,port:null!=(e=j.port)?e:c.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=j.host,this.port=null!=(f=j.port)?f:c.DEFAULT_PORT),this.percentage=100*Math.random(),1===d["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:h.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata};const k={initialDelay:d["grpc.initial_reconnect_backoff_ms"],maxDelay:d["grpc.max_reconnect_backoff_ms"]};this.backoff=new n.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},k),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(g=d["grpc.dns_min_time_between_resolutions_ms"])?g:q,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(p("Returning IP address for target "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)p("Failed to parse DNS address "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:h.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;p("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let a=this.dnsHostname;this.pendingLookupPromise=s(a,{all:!0}),this.pendingLookupPromise.then(a=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let b=a.filter(a=>4===a.family),c=a.filter(a=>6===a.family);this.latestLookupResult=t(c,b).map(a=>({host:a.address,port:+this.port}));let d="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";(p("Resolved addresses for target "+(0,l.uriToString)(this.target)+": "+d),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},a=>{null!==this.pendingLookupPromise&&(p("Resolution error for target "+(0,l.uriToString)(this.target)+": "+a.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=r(a),this.pendingTxtPromise.then(a=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,g.extractAndSelectServiceConfig)(a,this.percentage)}catch(a){this.latestServiceConfigError={code:h.Status.UNAVAILABLE,details:`Parsing service config failed with error ${a.message}`,metadata:new i.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},a=>{}))}}startNextResolutionTimer(){var a,b;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(b=(a=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:b.call(a),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?p('resolution update delayed by "min time between resolutions" rate limit'):p("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(a){return a.path}}c.setup=function(){(0,d.registerResolver)("dns",u),(0,d.registerDefaultScheme)("dns")}},17048,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getProxiedConnection=c.mapProxyName=void 0;let d=a.r(11717),e=a.r(57982),f=a.r(49845),g=a.r(21517),h=a.r(55004),i=a.r(11717),j=a.r(91177),k=a.r(55647),l=a.r(92509),m=a.r(87695),n="proxy";function o(a){i.trace(e.LogVerbosity.DEBUG,n,a)}function p(){let a,b="",c="";if(process.env.grpc_proxy)c="grpc_proxy",b=process.env.grpc_proxy;else if(process.env.https_proxy)c="https_proxy",b=process.env.https_proxy;else{if(!process.env.http_proxy)return{};c="http_proxy",b=process.env.http_proxy}try{a=new l.URL(b)}catch(a){return(0,d.log)(e.LogVerbosity.ERROR,`cannot parse value of "${c}" env var`),{}}if("http:"!==a.protocol)return(0,d.log)(e.LogVerbosity.ERROR,`"${a.protocol}" scheme not supported in proxy URI`),{};let f=null;a.username&&(a.password?((0,d.log)(e.LogVerbosity.INFO,"userinfo found in proxy URI"),f=`${a.username}:${a.password}`):f=a.username);let g=a.hostname,h=a.port;""===h&&(h="80");let i={address:`${g}:${h}`};return f&&(i.creds=f),o("Proxy server "+i.address+" set by environment variable "+c),i}function q(){let a=process.env.no_grpc_proxy,b="no_grpc_proxy";return(a||(a=process.env.no_proxy,b="no_proxy"),a)?(o("No proxy server list set by environment variable "+b),a.split(",")):[]}c.mapProxyName=function(a,b){var c;let d={target:a,extraOptions:{}};if((null!=(c=b["grpc.enable_http_proxy"])?c:1)===0||"unix"===a.scheme)return d;let e=p();if(!e.address)return d;let f=(0,k.splitHostPort)(a.path);if(!f)return d;let g=f.host;for(let b of q())if(b===g)return o("Not using proxy for target in no_proxy list: "+(0,k.uriToString)(a)),d;let h={"grpc.http_connect_target":(0,k.uriToString)(a)};return e.creds&&(h["grpc.http_connect_creds"]=e.creds),{target:{scheme:"dns",path:e.address},extraOptions:h}},c.getProxiedConnection=function(a,b,c){var i;if(!("grpc.http_connect_target"in b))return Promise.resolve({});let l=b["grpc.http_connect_target"],n=(0,k.parseUri)(l);if(null===n)return Promise.resolve({});let p=(0,k.splitHostPort)(n.path);if(null===p)return Promise.resolve({});let q=`${p.host}:${null!=(i=p.port)?i:m.DEFAULT_PORT}`,r={method:"CONNECT",path:q},s={Host:q};(0,j.isTcpSubchannelAddress)(a)?(r.host=a.host,r.port=a.port):r.socketPath=a.path,"grpc.http_connect_creds"in b&&(s["Proxy-Authorization"]="Basic "+Buffer.from(b["grpc.http_connect_creds"]).toString("base64")),r.headers=s;let t=(0,j.subchannelAddressToString)(a);return o("Using proxy "+t+" to connect to "+r.path),new Promise((a,b)=>{let i=g.request(r);i.once("connect",(g,j,l)=>{var m;if(i.removeAllListeners(),j.removeAllListeners(),200===g.statusCode)if(o("Successfully connected to "+r.path+" through proxy "+t),"secureContext"in c){let d=(0,f.getDefaultAuthority)(n),e=(0,k.splitHostPort)(d),g=null!=(m=null==e?void 0:e.host)?m:d,i=h.connect(Object.assign({host:g,servername:g,socket:j},c),()=>{o("Successfully established a TLS connection to "+r.path+" through proxy "+t),a({socket:i,realTarget:n})});i.on("error",a=>{o("Failed to establish a TLS connection to "+r.path+" through proxy "+t+" with error "+a.message),b()})}else o("Successfully established a plaintext connection to "+r.path+" through proxy "+t),a({socket:j,realTarget:n});else(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to "+r.path+" through proxy "+t+" with status "+g.statusCode),b()}),i.once("error",a=>{i.removeAllListeners(),(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to proxy "+t+" with error "+a.message),b()}),i.end()})}},64241,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.StreamDecoder=void 0,function(a){a[a.NO_DATA=0]="NO_DATA",a[a.READING_SIZE=1]="READING_SIZE",a[a.READING_MESSAGE=2]="READING_MESSAGE"}(d||(d={}));class e{constructor(a){this.maxReadMessageLength=a,this.readState=d.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(a){let b,c=0,e=[];for(;c<a.length;)switch(this.readState){case d.NO_DATA:this.readCompressFlag=a.slice(c,c+1),c+=1,this.readState=d.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case d.READING_SIZE:if(b=Math.min(a.length-c,this.readSizeRemaining),a.copy(this.readPartialSize,4-this.readSizeRemaining,c,c+b),this.readSizeRemaining-=b,c+=b,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=d.READING_MESSAGE;else{let a=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=d.NO_DATA,e.push(a)}}break;case d.READING_MESSAGE:if(b=Math.min(a.length-c,this.readMessageRemaining),this.readPartialMessage.push(a.slice(c,c+b)),this.readMessageRemaining-=b,c+=b,0===this.readMessageRemaining){let a=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),b=Buffer.concat(a,this.readMessageSize+5);this.readState=d.NO_DATA,e.push(b)}break;default:throw Error("Unexpected read state")}return e}}c.StreamDecoder=e},34314,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelCall=void 0;let d=a.r(25328),e=a.r(46786),f=a.r(57982),g=a.r(57904),h=a.r(64241),i=a.r(11717),j=a.r(57982),k="subchannel_call";function l(a){for(let[b,c]of Object.entries(e.constants.errno))if(c===a)return b;return"Unknown system error "+a}class m{constructor(a,b,c,e,i){var j;this.http2Stream=a,this.callEventTracker=b,this.listener=c,this.transport=e,this.callId=i,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=f.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const k=null!=(j=e.getOptions()["grpc.max_receive_message_length"])?j:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new h.StreamDecoder(k),a.on("response",(a,b)=>{let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";switch(this.trace("Received server headers:\n"+c),a[":status"]){case 400:this.mappedStatusCode=f.Status.INTERNAL;break;case 401:this.mappedStatusCode=f.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=f.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=f.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=f.Status.UNAVAILABLE;break;default:this.mappedStatusCode=f.Status.UNKNOWN}if(b&d.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let b;try{b=g.Metadata.fromHttp2Headers(a)}catch(a){this.endCall({code:f.Status.UNKNOWN,details:a.message,metadata:new g.Metadata});return}this.listener.onReceiveMetadata(b)}}),a.on("trailers",a=>{this.handleTrailers(a)}),a.on("data",a=>{let b;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+a.length);try{b=this.decoder.write(a)}catch(a){this.cancelWithStatus(f.Status.RESOURCE_EXHAUSTED,a.message);return}for(let a of b)this.trace("parsed message of length "+a.length),this.callEventTracker.addMessageReceived(),this.tryPush(a)}}),a.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),a.on("close",()=>{process.nextTick(()=>{var b;let c;if(this.trace("HTTP/2 stream closed with code "+a.rstCode),(null==(b=this.finalStatus)?void 0:b.code)===f.Status.OK)return;let e="";switch(a.rstCode){case d.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`;break;case d.constants.NGHTTP2_REFUSED_STREAM:c=f.Status.UNAVAILABLE,e="Stream refused by server";break;case d.constants.NGHTTP2_CANCEL:c=f.Status.CANCELLED,e="Call cancelled";break;case d.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=f.Status.RESOURCE_EXHAUSTED,e="Bandwidth exhausted or memory limit exceeded";break;case d.constants.NGHTTP2_INADEQUATE_SECURITY:c=f.Status.PERMISSION_DENIED,e="Protocol not secure enough";break;case d.constants.NGHTTP2_INTERNAL_ERROR:c=f.Status.INTERNAL,null===this.internalError?e=`Received RST_STREAM with code ${a.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(c=f.Status.UNAVAILABLE,e=this.internalError.message):e=`Received RST_STREAM with code ${a.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`}this.endCall({code:c,details:e,metadata:new g.Metadata,rstCode:a.rstCode})})}),a.on("error",a=>{"ERR_HTTP2_STREAM_ERROR"!==a.code&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+l(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:f.Status.UNAVAILABLE,details:"Connection dropped",metadata:new g.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(a){i.trace(j.LogVerbosity.DEBUG,k,"["+this.callId+"] "+a)}endCall(a){(null===this.finalStatus||this.finalStatus.code===f.Status.OK)&&(this.finalStatus=a,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===f.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(a){this.trace("pushing to reader message of length "+(a instanceof Buffer?a.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(a),this.maybeOutputStatus())})}tryPush(a){this.canPush?(this.http2Stream.pause(),this.push(a)):(this.trace("unpushedReadMessages.push message of length "+a.length),this.unpushedReadMessages.push(a))}handleTrailers(a){let b;this.callEventTracker.onStreamEnd(!0);let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";this.trace("Received server trailers:\n"+c);try{b=g.Metadata.fromHttp2Headers(a)}catch(a){b=new g.Metadata}let d=b.getMap(),e=this.mappedStatusCode;if(e===f.Status.UNKNOWN&&"string"==typeof d["grpc-status"]){let a=Number(d["grpc-status"]);a in f.Status&&(e=a,this.trace("received status code "+a+" from server")),b.remove("grpc-status")}let h="";if("string"==typeof d["grpc-message"]){try{h=decodeURI(d["grpc-message"])}catch(a){h=d["grpc-message"]}b.remove("grpc-message"),this.trace('received status details string "'+h+'" from server')}let i={code:e,details:h,metadata:b};this.endCall(i)}destroyHttp2Stream(){var a;if(!this.http2Stream.destroyed){let b;b=(null==(a=this.finalStatus)?void 0:a.code)===f.Status.OK?d.constants.NGHTTP2_NO_ERROR:d.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+b),this.http2Stream.close(b)}}cancelWithStatus(a,b){this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.endCall({code:a,details:b,metadata:new g.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==f.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let a=this.unpushedReadMessages.shift();this.push(a);return}this.http2Stream.resume()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length);let c=b=>{process.nextTick(()=>{var c;let d=f.Status.UNAVAILABLE;(null==b?void 0:b.code)==="ERR_STREAM_WRITE_AFTER_END"&&(d=f.Status.INTERNAL),b&&this.cancelWithStatus(d,`Write error: ${b.message}`),null==(c=a.callback)||c.call(a)})};this.trace("sending data chunk of length "+b.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(b,c)}catch(a){this.endCall({code:f.Status.UNAVAILABLE,details:`Write failed with error ${a.message}`,metadata:new g.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}c.Http2SubchannelCall=m},72672,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getNextCallNumber=void 0;let d=0;c.getNextCallNumber=function(){return d++}},95320,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelConnector=void 0;let d=a.r(25328),e=a.r(55004),f=a.r(74970),g=a.r(57982),h=a.r(17048),i=a.r(11717),j=a.r(49845),k=a.r(91177),l=a.r(55647),m=a.r(4446),n=a.r(34314),o=a.r(72672),p="transport",q="transport_flowctrl",r=a.r(17887).version,{HTTP2_HEADER_AUTHORITY:s,HTTP2_HEADER_CONTENT_TYPE:t,HTTP2_HEADER_METHOD:u,HTTP2_HEADER_PATH:v,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:x}=d.constants,y=2e4,z=Buffer.from("too_many_pings","ascii");class A{constructor(a,b,c,e){this.session=a,this.options=c,this.remoteName=e,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=y,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,k.subchannelAddressToString)(b),0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,f.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[c["grpc.primary_user_agent"],`grpc-node-js/${r}`,c["grpc.secondary_user_agent"]].filter(a=>a).join(" "),"grpc.keepalive_time_ms"in c&&(this.keepaliveTimeMs=c["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in c&&(this.keepaliveTimeoutMs=c["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in c?this.keepaliveWithoutCalls=1===c["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,a.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),a.once("goaway",(a,b,c)=>{let e=!1;a===d.constants.NGHTTP2_ENHANCE_YOUR_CALM&&c&&c.equals(z)&&(e=!0),this.trace("connection closed by GOAWAY with code "+a+" and data "+(null==c?void 0:c.toString())),this.reportDisconnectToOwner(e)}),a.once("error",a=>{this.trace("connection closed with error "+a.message)}),i.isTracerEnabled(p)&&(a.on("remoteSettings",b=>{this.trace("new settings received"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))}),a.on("localSettings",b=>{this.trace("local settings acknowledged by remote"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var a,b,c;let d,e=this.session.socket,f=e.remoteAddress?(0,k.stringToSubchannelAddress)(e.remoteAddress,e.remotePort):null,g=e.localAddress?(0,k.stringToSubchannelAddress)(e.localAddress,e.localPort):null;if(this.session.encrypted){let b=e,c=b.getCipher(),f=b.getCertificate(),g=b.getPeerCertificate();d={cipherSuiteStandardName:null!=(a=c.standardName)?a:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else d=null;return{remoteAddress:f,localAddress:g,security:d,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(b=this.session.state.localWindowSize)?b:null,remoteFlowControlWindow:null!=(c=this.session.state.remoteWindowSize)?c:null}}trace(a){i.trace(g.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}keepaliveTrace(a){i.trace(g.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}flowControlTrace(a){i.trace(g.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}internalsTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}reportDisconnectToOwner(a){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(b=>b(a)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let a of this.activeCalls)a.onDisconnect()})}addDisconnectListener(a){this.disconnectListeners.push(a)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var a,b;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(b=(a=this.keepaliveTimeoutId).unref)||b.call(a));try{this.session.ping((a,b,c)=>{a&&(this.keepaliveTrace("Ping failed with error "+a.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(a){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var a,b;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(b=(a=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:b.call(a)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(a){this.activeCalls.delete(a),0===this.activeCalls.size&&this.session.unref()}addActiveCall(a){this.activeCalls.add(a),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(a,b,c,d,e){let f,g,h,i=a.toHttp2Headers();i[s]=b,i[x]=this.userAgent,i[t]="application/grpc",i[u]="POST",i[v]=c,i[w]="trailers";try{f=this.session.request(i)}catch(a){throw this.handleDisconnect(),a}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),g={addMessageSent:()=>{var a;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;a?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(b=e.onStreamEnd)||b.call(e,a)}}):g={addMessageSent:()=>{var a;null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;null==(b=e.onStreamEnd)||b.call(e,a)}},h=new n.Http2SubchannelCall(f,g,d,this,(0,o.getNextCallNumber)()),this.addActiveCall(h),h}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,f.unregisterChannelzRef)(this.channelzRef)}}class B{constructor(a){this.channelTarget=a,this.session=null,this.isShutdown=!1}trace(a){i.trace(g.LogVerbosity.DEBUG,p,(0,l.uriToString)(this.channelTarget)+" "+a)}createSession(a,b,c,f){return this.isShutdown?Promise.reject():new Promise((g,h)=>{var i,n,o;let p;f.realTarget?(p=(0,l.uriToString)(f.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,l.uriToString)(f.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,k.subchannelAddressToString)(a)));let q=(0,j.getDefaultAuthority)(null!=(i=f.realTarget)?i:this.channelTarget),r=b._getConnectionOptions()||{};r.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in c?r.maxSessionMemory=c["grpc-node.max_session_memory"]:r.maxSessionMemory=Number.MAX_SAFE_INTEGER;let s="http://";if("secureContext"in r){if(s="https://",c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];r.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),r.servername=a}else{let a=null!=(o=null==(n=(0,l.splitHostPort)(q))?void 0:n.host)?o:"localhost";r.servername=a}f.socket&&(r.createConnection=(a,b)=>f.socket)}else r.createConnection=(b,c)=>f.socket?f.socket:m.connect(a);r=Object.assign(Object.assign(Object.assign({},r),a),{enableTrace:1===c["grpc-node.tls_enable_trace"]});let t=d.connect(s+q,r);this.session=t;let u="Failed to connect";t.unref(),t.once("connect",()=>{t.removeAllListeners(),g(new A(t,a,c,p)),this.session=null}),t.once("close",()=>{this.session=null,setImmediate(()=>{h(`${u} (${new Date().toISOString()})`)})}),t.once("error",a=>{u=a.message,this.trace("connection failed with error "+u)})})}connect(a,b,c){var d,f;if(this.isShutdown)return Promise.reject();let g=b._getConnectionOptions()||{};if("secureContext"in g){if(g.ALPNProtocols=["h2"],c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];g.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),g.servername=a}else if("grpc.http_connect_target"in c){let a=(0,j.getDefaultAuthority)(null!=(d=(0,l.parseUri)(c["grpc.http_connect_target"]))?d:{path:"localhost"}),b=(0,l.splitHostPort)(a);g.servername=null!=(f=null==b?void 0:b.host)?f:a}c["grpc-node.tls_enable_trace"]&&(g.enableTrace=!0)}return(0,h.getProxiedConnection)(a,c,g).then(d=>this.createSession(a,b,c,d))}shutdown(){var a;this.isShutdown=!0,null==(a=this.session)||a.close(),this.session=null}}c.Http2SubchannelConnector=B},72939,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSubchannelPool=c.SubchannelPool=void 0;let d=a.r(69359),e=a.r(85115),f=a.r(91177),g=a.r(55647),h=a.r(95320),i=1e4;class j{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let a=!0;for(let b in this.pool){let c=this.pool[b].filter(a=>!a.subchannel.unrefIfOneRef());c.length>0&&(a=!1),this.pool[b]=c}a&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var a,b;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},i),null==(b=(a=this.cleanupTimer).unref)||b.call(a))}getOrCreateSubchannel(a,b,c,i){this.ensureCleanupTask();let j=(0,g.uriToString)(a);if(j in this.pool){for(let a of this.pool[j])if((0,f.subchannelAddressEqual)(b,a.subchannelAddress)&&(0,d.channelOptionsEqual)(c,a.channelArguments)&&i._equals(a.channelCredentials))return a.subchannel}let k=new e.Subchannel(a,b,c,i,new h.Http2SubchannelConnector(a));return j in this.pool||(this.pool[j]=[]),this.pool[j].push({subchannelAddress:b,channelArguments:c,channelCredentials:i,subchannel:k}),k.ref(),k}}c.SubchannelPool=j;let k=new j;c.getSubchannelPool=function(a){return a?k:new j}},15325,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FilterStackFactory=c.FilterStack=void 0;class d{constructor(a){this.filters=a}sendMetadata(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMetadata(b);return b}receiveMetadata(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMetadata(b);return b}sendMessage(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMessage(b);return b}receiveMessage(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMessage(b);return b}receiveTrailers(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveTrailers(b);return b}push(a){this.filters.unshift(...a)}getFilters(){return this.filters}}c.FilterStack=d;class e{constructor(a){this.factories=a}push(a){this.factories.unshift(...a)}clone(){return new e([...this.factories])}createFilter(){return new d(this.factories.map(a=>a.createFilter()))}}c.FilterStackFactory=e},69425,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionAlgorithms=void 0,function(a){a[a.identity=0]="identity",a[a.deflate=1]="deflate",a[a.gzip=2]="gzip"}(d||(c.CompressionAlgorithms=d={}))},59940,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseFilter=void 0;class d{async sendMetadata(a){return a}receiveMetadata(a){return a}async sendMessage(a){return a}async receiveMessage(a){return a}receiveTrailers(a){return a}}c.BaseFilter=d},13298,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionFilterFactory=c.CompressionFilter=void 0;let d=a.r(6461),e=a.r(69425),f=a.r(57982),g=a.r(59940),h=a.r(11717),i=a=>"number"==typeof a&&"string"==typeof e.CompressionAlgorithms[a];class j{async writeMessage(a,b){let c=a;b&&(c=await this.compressMessage(c));let d=Buffer.allocUnsafe(c.length+5);return d.writeUInt8(+!!b,0),d.writeUInt32BE(c.length,1),c.copy(d,5),d}async readMessage(a){let b=1===a.readUInt8(0),c=a.slice(5);return b&&(c=await this.decompressMessage(c)),c}}class k extends j{async compressMessage(a){return a}async writeMessage(a,b){let c=Buffer.allocUnsafe(a.length+5);return c.writeUInt8(0,0),c.writeUInt32BE(a.length,1),a.copy(c,5),c}decompressMessage(a){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class l extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.deflate(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createInflate();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class m extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.gzip(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createGunzip();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class n extends j{constructor(a){super(),this.compressionName=a}compressMessage(a){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(a){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function o(a,b){switch(a){case"identity":return new k;case"deflate":return new l(b);case"gzip":return new m(b);default:return new n(a)}}class p extends g.BaseFilter{constructor(a,b){var c,d;super(),this.sharedFilterConfig=b,this.sendCompression=new k,this.receiveCompression=new k,this.currentCompressionAlgorithm="identity";const g=a["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(c=a["grpc.max_receive_message_length"])?c:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==g)if(i(g)){const a=e.CompressionAlgorithms[g],c=null==(d=b.serverSupportedEncodingHeader)?void 0:d.split(",");(!c||c.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=o(this.currentCompressionAlgorithm,-1))}else h.log(f.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${g}`)}async sendMetadata(a){let b=await a;return b.set("grpc-accept-encoding","identity,deflate,gzip"),b.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?b.remove("grpc-encoding"):b.set("grpc-encoding",this.currentCompressionAlgorithm),b}receiveMetadata(a){let b=a.get("grpc-encoding");if(b.length>0){let a=b[0];"string"==typeof a&&(this.receiveCompression=o(a,this.maxReceiveMessageLength))}a.remove("grpc-encoding");let c=a.get("grpc-accept-encoding")[0];return c&&(this.sharedFilterConfig.serverSupportedEncodingHeader=c,c.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new k,this.currentCompressionAlgorithm="identity")),a.remove("grpc-accept-encoding"),a}async sendMessage(a){var b;let c,d=await a;return c=!(this.sendCompression instanceof k)&&((null!=(b=d.flags)?b:0)&2)==0,{message:await this.sendCompression.writeMessage(d.message,c),flags:d.flags}}async receiveMessage(a){return this.receiveCompression.readMessage(await a)}}c.CompressionFilter=p;class q{constructor(a,b){this.options=b,this.sharedFilterConfig={}}createFilter(){return new p(this.options,this.sharedFilterConfig)}}c.CompressionFilterFactory=q},1150,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.deadlineToString=c.getRelativeTimeout=c.getDeadlineTimeoutString=c.minDeadline=void 0,c.minDeadline=function(...a){let b=1/0;for(let c of a){let a=c instanceof Date?c.getTime():c;a<b&&(b=a)}return b};let d=[["m",1],["S",1e3],["M",6e4],["H",36e5]];c.getDeadlineTimeoutString=function(a){let b=new Date().getTime();a instanceof Date&&(a=a.getTime());let c=Math.max(a-b,0);for(let[a,b]of d){let d=c/b;if(d<1e8)return String(Math.ceil(d))+a}throw Error("Deadline is too far in the future")};let e=0x7fffffff;c.getRelativeTimeout=function(a){let b=(a instanceof Date?a.getTime():a)-new Date().getTime();return b<0?0:b>e?1/0:b},c.deadlineToString=function(a){if(a instanceof Date)return a.toISOString();{let b=new Date(a);return Number.isNaN(b.getTime())?""+a:b.toISOString()}}},65149,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.restrictControlPlaneStatusCode=void 0;let d=a.r(57982),e=[d.Status.OK,d.Status.INVALID_ARGUMENT,d.Status.NOT_FOUND,d.Status.ALREADY_EXISTS,d.Status.FAILED_PRECONDITION,d.Status.ABORTED,d.Status.OUT_OF_RANGE,d.Status.DATA_LOSS];c.restrictControlPlaneStatusCode=function(a,b){return e.includes(a)?{code:d.Status.INTERNAL,details:`Invalid status from control plane: ${a} ${d.Status[a]} ${b}`}:{code:a,details:b}}},25326,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoadBalancingCall=void 0;let d=a.r(56537),e=a.r(57982),f=a.r(1150),g=a.r(57904),h=a.r(3681),i=a.r(55647),j=a.r(11717),k=a.r(65149),l=a.r(25328),m="load_balancing_call";class n{constructor(a,b,c,d,e,f,g){var h,j;this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const k=this.methodName.split("/");let l="";k.length>=2&&(l=k[1]);const m=null!=(j=null==(h=(0,i.splitHostPort)(this.host))?void 0:h.host)?j:"localhost";this.serviceUrl=`https://${m}/${l}`}trace(a){j.trace(e.LogVerbosity.DEBUG,m,"["+this.callNumber+"] "+a)}outputStatus(a,b){var c,d;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+a.code+' details="'+a.details+'"');let e=Object.assign(Object.assign({},a),{progress:b});null==(c=this.listener)||c.onReceiveStatus(e),null==(d=this.onCallEnded)||d.call(this,e.code)}}doPick(){var a,b;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let c=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=c.subchannel?"("+c.subchannel.getChannelzRef().id+") "+c.subchannel.getAddress():""+c.subchannel;switch(this.trace("Pick result: "+h.PickResultType[c.pickResultType]+" subchannel: "+i+" status: "+(null==(a=c.status)?void 0:a.code)+" "+(null==(b=c.status)?void 0:b.details)),c.pickResultType){case h.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var b,h,j;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let k=this.metadata.clone();if(k.merge(a),k.get("authorization").length>1&&this.outputStatus({code:e.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new g.Metadata},"PROCESSED"),c.subchannel.getConnectivityState()!==d.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+d.ConnectivityState[c.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&k.set("grpc-timeout",(0,f.getDeadlineTimeoutString)(this.deadline));try{this.child=c.subchannel.getRealSubchannel().createCall(k,this.host,this.methodName,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message"),this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status"),a.rstCode===l.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(a,"REFUSED"):this.outputStatus(a,"PROCESSED")}})}catch(a){this.trace("Failed to start call on picked subchannel "+i+" with error "+a.message),this.outputStatus({code:e.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+a.message,metadata:new g.Metadata},"NOT_STARTED");return}null==(h=(b=this.callConfig).onCommitted)||h.call(b),null==(j=c.onCallStarted)||j.call(c),this.onCallEnded=c.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:b,details:c}=(0,k.restrictControlPlaneStatusCode)("number"==typeof a.code?a.code:e.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:b,details:c,metadata:new g.Metadata},"PROCESSED")});break;case h.PickResultType.DROP:let{code:j,details:m}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:j,details:m,metadata:c.status.metadata},"DROP")});break;case h.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:b}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:a,details:b,metadata:c.status.metadata},"PROCESSED")})}break;case h.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new g.Metadata},"PROCESSED")}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.listener=b,this.metadata=a,this.doPick()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.child.sendMessageWithContext(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}c.LoadBalancingCall=n},8122,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingCall=void 0;let d=a.r(57982),e=a.r(1150),f=a.r(57904),g=a.r(11717),h=a.r(65149),i="resolving_call";class j{constructor(a,b,c,f,g,h){this.channel=a,this.method=b,this.filterStackFactory=f,this.credentials=g,this.callNumber=h,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=c.deadline,this.host=c.host,c.parentCall&&(c.flags&d.Propagate.CANCELLATION&&c.parentCall.on("cancelled",()=>{this.cancelWithStatus(d.Status.CANCELLED,"Cancelled by parent call")}),c.flags&d.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+c.parentCall.getDeadline()),this.deadline=(0,e.minDeadline)(this.deadline,c.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(a){g.trace(d.LogVerbosity.DEBUG,i,"["+this.callNumber+"] "+a)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,e.deadlineToString)(this.deadline));let a=(0,e.getRelativeTimeout)(this.deadline);if(a!==1/0){this.trace("Deadline will be reached in "+a+"ms");let b=()=>{this.cancelWithStatus(d.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};a<=0?process.nextTick(b):this.deadlineTimer=setTimeout(b,a)}}outputStatus(a){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let b=this.filterStack.receiveTrailers(a);this.trace("ended with status: code="+b.code+' details="'+b.details+'"'),this.statusWatchers.forEach(a=>a(b)),process.nextTick(()=>{var a;null==(a=this.listener)||a.onReceiveStatus(b)})}}sendMessageOnChild(a,b){if(!this.child)throw Error("sendMessageonChild called with child not populated");let c=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:b,flags:a.flags})).then(b=>{this.writeFilterPending=!1,c.sendMessageWithContext(a,b.message),this.pendingHalfClose&&c.halfClose()},a=>{this.cancelWithStatus(a.code,a.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let a=this.channel.getConfig(this.method,this.metadata);if("NONE"===a.type)return void this.channel.queueCallForConfig(this);if("ERROR"===a.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(a.error));let b=a.config;if(b.status!==d.Status.OK){let{code:a,details:c}=(0,h.restrictControlPlaneStatusCode)(b.status,"Failed to route call to method "+this.method);this.outputStatus({code:a,details:c,metadata:new f.Metadata});return}if(b.methodConfig.timeout){let a=new Date;a.setSeconds(a.getSeconds()+b.methodConfig.timeout.seconds),a.setMilliseconds(a.getMilliseconds()+b.methodConfig.timeout.nanos/1e6),this.deadline=(0,e.minDeadline)(this.deadline,a),this.runDeadlineTimer()}this.filterStackFactory.push(b.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(a=>{this.child=this.channel.createInnerCall(b,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(a,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(a))},onReceiveMessage:a=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(a).then(a=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(a),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},a=>{this.cancelWithStatus(a.code,a.details)})},onReceiveStatus:a=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=a:this.outputStatus(a)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},a=>{this.outputStatus(a)})}reportResolverError(a){var b;(null==(b=this.metadata)?void 0:b.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(a)}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new f.Metadata})}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.metadata=a.clone(),this.listener=b,this.getConfig()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.sendMessageOnChild(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){this.credentials=this.credentials.compose(a)}addStatusWatcher(a){this.statusWatchers.push(a)}getCallNumber(){return this.callNumber}}c.ResolvingCall=j},98364,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.RetryingCall=c.MessageBufferTracker=c.RetryThrottler=void 0;let d=a.r(57982),e=a.r(57904),f=a.r(11717),g="retrying_call";class h{constructor(a,b,c){this.maxTokens=a,this.tokenRatio=b,c?this.tokens=c.tokens*(a/c.maxTokens):this.tokens=a}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}c.RetryThrottler=h;class i{constructor(a,b){this.totalLimit=a,this.limitPerCall=b,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(a,b){var c;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;return!(this.limitPerCall-d<a)&&!(this.totalLimit-this.totalAllocated<a)&&(this.allocatedPerCall.set(b,d+a),this.totalAllocated+=a,!0)}free(a,b){var c;if(this.totalAllocated<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > total allocated ${this.totalAllocated}`);this.totalAllocated-=a;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;if(d<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > allocated for call ${d}`);this.allocatedPerCall.set(b,d-a)}freeAll(a){var b;let c=null!=(b=this.allocatedPerCall.get(a))?b:0;if(this.totalAllocated<c)throw Error(`Invalid buffer allocation state: call ${a} allocated ${c} > total allocated ${this.totalAllocated}`);this.totalAllocated-=c,this.allocatedPerCall.delete(a)}}c.MessageBufferTracker=i;let j="grpc-previous-rpc-attempts";class k{constructor(a,b,c,d,e,f,g,h,i){if(this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.bufferTracker=h,this.retryThrottler=i,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,b.methodConfig.retryPolicy){this.state="RETRY";const a=b.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(a.initialBackoff.substring(0,a.initialBackoff.length-1))}else b.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(a){f.trace(d.LogVerbosity.DEBUG,g,"["+this.callNumber+"] "+a)}reportStatus(a){this.trace("ended with status: code="+a.code+' details="'+a.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var b;null==(b=this.listener)||b.onReceiveStatus({code:a.code,details:a.details,metadata:a.metadata})})}cancelWithStatus(a,b){for(let{call:c}of(this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.reportStatus({code:a,details:b,metadata:new e.Metadata}),this.underlyingCalls))c.cancelWithStatus(a,b)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(a){var b;return null!=(b=this.writeBuffer[a-this.writeBufferOffset])?b:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let a=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let b=this.writeBufferOffset;b<a;b++){let a=this.getBufferEntry(b);a.allocated&&this.bufferTracker.free(a.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(a-this.writeBufferOffset),this.writeBufferOffset=a}commitCall(a){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[a].state){this.trace("Committing call ["+this.underlyingCalls[a].call.getCallNumber()+"] at index "+a),this.state="COMMITTED",this.committedCallIndex=a;for(let b=0;b<this.underlyingCalls.length;b++)b!==a&&"COMPLETED"!==this.underlyingCalls[b].state&&(this.underlyingCalls[b].state="COMPLETED",this.underlyingCalls[b].call.cancelWithStatus(d.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let a=-1,b=-1;for(let[c,d]of this.underlyingCalls.entries())"ACTIVE"===d.state&&d.nextMessageToSend>a&&(a=d.nextMessageToSend,b=c);-1===b?this.state="TRANSPARENT_ONLY":this.commitCall(b)}isStatusCodeInList(a,b){return a.some(a=>a===b||a.toString().toLowerCase()===d.Status[b].toLowerCase())}getNextRetryBackoffMs(){var a;let b=null==(a=this.callConfig)?void 0:a.methodConfig.retryPolicy;if(!b)return 0;let c=Math.random()*this.nextRetryBackoffSec*1e3,d=Number(b.maxBackoff.substring(0,b.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*b.backoffMultiplier,d),c}maybeRetryCall(a,b){let c;if("RETRY"!==this.state)return void b(!1);let d=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return void b(!1);if(null===a)c=this.getNextRetryBackoffMs();else if(a<0){this.state="TRANSPARENT_ONLY",b(!1);return}else c=a,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var a,c;"RETRY"!==this.state?b(!1):(null==(c=null==(a=this.retryThrottler)?void 0:a.canRetryCall())||c)&&(b(!0),this.attempts+=1,this.startNewAttempt())},c)}countActiveCalls(){let a=0;for(let b of this.underlyingCalls)(null==b?void 0:b.state)==="ACTIVE"&&(a+=1);return a}handleProcessedStatus(a,b,c){var d,e,f;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(b),this.reportStatus(a);break;case"HEDGING":if(this.isStatusCodeInList(null!=(d=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?d:[],a.code)){let d;if(null==(e=this.retryThrottler)||e.addCallFailed(),null===c)d=0;else if(c<0){this.state="TRANSPARENT_ONLY",this.commitCall(b),this.reportStatus(a);return}else d=c;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(b),this.reportStatus(a))},d)}else this.commitCall(b),this.reportStatus(a);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,a.code)?(null==(f=this.retryThrottler)||f.addCallFailed(),this.maybeRetryCall(c,c=>{c||(this.commitCall(b),this.reportStatus(a))})):(this.commitCall(b),this.reportStatus(a))}}getPushback(a){let b=a.get("grpc-retry-pushback-ms");if(0===b.length)return null;try{return parseInt(b[0])}catch(a){return -1}}handleChildStatus(a,b){var c;if("COMPLETED"===this.underlyingCalls[b].state)return;if(this.trace("state="+this.state+" handling status with progress "+a.progress+" from child ["+this.underlyingCalls[b].call.getCallNumber()+"] in state "+this.underlyingCalls[b].state),this.underlyingCalls[b].state="COMPLETED",a.code===d.Status.OK){null==(c=this.retryThrottler)||c.addCallSucceeded(),this.commitCall(b),this.reportStatus(a);return}if("COMMITTED"===this.state)return void this.reportStatus(a);let e=this.getPushback(a.metadata);switch(a.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(a,b,e):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(b),this.reportStatus(a);break;case"PROCESSED":this.handleProcessedStatus(a,b,e)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let a=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(a.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var a,b,c;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let d=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return;let e=null!=(a=d.hedgingDelay)?a:"0s",f=Number(e.substring(0,e.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*f),null==(c=(b=this.hedgingTimer).unref)||c.call(b)}startNewAttempt(){let a=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+a.getCallNumber()+"] for attempt "+this.attempts);let b=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:a,nextMessageToSend:0});let c=this.attempts-1,d=this.initialMetadata.clone();c>0&&d.set(j,`${c}`);let e=!1;a.start(d,{onReceiveMetadata:d=>{this.trace("Received metadata from child ["+a.getCallNumber()+"]"),this.commitCall(b),e=!0,c>0&&d.set(j,`${c}`),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMetadata(d)},onReceiveMessage:c=>{this.trace("Received message from child ["+a.getCallNumber()+"]"),this.commitCall(b),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMessage(c)},onReceiveStatus:d=>{this.trace("Received status from child ["+a.getCallNumber()+"]"),!e&&c>0&&d.metadata.set(j,`${c}`),this.handleChildStatus(d,b)}}),this.sendNextChildMessage(b),this.readStarted&&a.startRead()}start(a,b){this.trace("start called"),this.listener=b,this.initialMetadata=a,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(a){var b,c;let d=this.underlyingCalls[a],e=d.nextMessageToSend;null==(c=(b=this.getBufferEntry(e)).callback)||c.call(b),this.clearSentMessages(),d.nextMessageToSend+=1,this.sendNextChildMessage(a)}sendNextChildMessage(a){let b=this.underlyingCalls[a];if("COMPLETED"!==b.state&&this.getBufferEntry(b.nextMessageToSend)){let c=this.getBufferEntry(b.nextMessageToSend);switch(c.entryType){case"MESSAGE":b.call.sendMessageWithContext({callback:b=>{this.handleChildWriteCompleted(a)}},c.message.message);break;case"HALF_CLOSE":b.nextMessageToSend+=1,b.call.halfClose()}}}sendMessageWithContext(a,b){var c;this.trace("write() called with message of length "+b.length);let d={message:b,flags:a.flags},e=this.getNextBufferIndex(),f={entryType:"MESSAGE",message:d,allocated:this.bufferTracker.allocate(b.length,this.callNumber)};if(this.writeBuffer.push(f),f.allocated)for(let[d,f]of(null==(c=a.callback)||c.call(a),this.underlyingCalls.entries()))"ACTIVE"===f.state&&f.nextMessageToSend===e&&f.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(d)}},b);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let c=this.underlyingCalls[this.committedCallIndex];f.callback=a.callback,"ACTIVE"===c.state&&c.nextMessageToSend===e&&c.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(this.committedCallIndex)}},b)}}startRead(){for(let a of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==a?void 0:a.state)==="ACTIVE"&&a.call.startRead()}halfClose(){this.trace("halfClose called");let a=this.getNextBufferIndex();for(let b of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==b?void 0:b.state)==="ACTIVE"&&b.nextMessageToSend===a&&(b.nextMessageToSend+=1,b.call.halfClose())}setCredentials(a){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}c.RetryingCall=k},4706,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseSubchannelWrapper=void 0;class d{constructor(a){this.child=a}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(a){this.child.addConnectivityStateListener(a)}removeConnectivityStateListener(a){this.child.removeConnectivityStateListener(a)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(a){this.child.throttleKeepalive(a)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(a){return this.getRealSubchannel()===a.getRealSubchannel()}}c.BaseSubchannelWrapper=d},75952,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InternalChannel=void 0;let d=a.r(61591),e=a.r(74765),f=a.r(72939),g=a.r(3681),h=a.r(57982),i=a.r(15325),j=a.r(13298),k=a.r(49845),l=a.r(11717),m=a.r(17048),n=a.r(55647),o=a.r(56537),p=a.r(74970),q=a.r(25326),r=a.r(1150),s=a.r(8122),t=a.r(72672),u=a.r(65149),v=a.r(98364),w=a.r(4706),x=0x7fffffff,y=1e3,z=18e5,A=new Map,B=0x1000000,C=1048576;class D extends w.BaseSubchannelWrapper{constructor(a,b){super(a),this.channel=b,this.refCount=0,this.subchannelStateListener=(a,c,d,e)=>{b.throttleKeepalive(e)},a.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class E{constructor(a,b,c){var q,r,s,t,w,E,F,G;if(this.credentials=b,this.options=c,this.connectivityState=o.ConnectivityState.IDLE,this.currentPicker=new g.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new p.ChannelzCallTracker,this.childrenTracker=new p.ChannelzChildrenTracker,"string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.originalTarget=a;const H=(0,n.parseUri)(a);if(null===H)throw Error(`Could not parse target name "${a}"`);const I=(0,k.mapUriDefaultScheme)(H);if(null===I)throw Error(`Could not find a default scheme for target name "${a}"`);this.callRefTimer=setInterval(()=>{},x),null==(r=(q=this.callRefTimer).unref)||r.call(q),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new p.ChannelzTrace,this.channelzRef=(0,p.registerChannelzChannel)(a,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,k.getDefaultAuthority)(I);const J=(0,m.mapProxyName)(I,c);this.target=J.target,this.options=Object.assign({},this.options,J.extraOptions),this.subchannelPool=(0,f.getSubchannelPool)((null!=(s=c["grpc.use_local_subchannel_pool"])?s:0)===0),this.retryBufferTracker=new v.MessageBufferTracker(null!=(t=c["grpc.retry_buffer_size"])?t:B,null!=(w=c["grpc.per_rpc_retry_buffer_size"])?w:C),this.keepaliveTime=null!=(E=c["grpc.keepalive_time_ms"])?E:-1,this.idleTimeoutMs=Math.max(null!=(F=c["grpc.client_idle_timeout_ms"])?F:z,y);const K={createSubchannel:(a,b)=>{let c=this.subchannelPool.getOrCreateSubchannel(this.target,a,Object.assign({},this.options,b),this.credentials);c.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",c.getChannelzRef());let d=new D(c,this);return this.wrappedSubchannels.add(d),d},updateState:(a,b)=>{this.currentPicker=b;let c=this.pickQueue.slice();for(let a of(this.pickQueue=[],c.length>0&&this.callRefTimerUnref(),c))a.doPick();this.updateState(a)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.refChild(a)},removeChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.unrefChild(a)}};this.resolvingLoadBalancer=new e.ResolvingLoadBalancer(this.target,K,c,(a,b)=>{a.retryThrottling?A.set(this.getTarget(),new v.RetryThrottler(a.retryThrottling.maxTokens,a.retryThrottling.tokenRatio,A.get(this.getTarget()))):A.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=b,this.currentResolutionError=null,process.nextTick(()=>{let a=this.configSelectionQueue;for(let b of(this.configSelectionQueue=[],a.length>0&&this.callRefTimerUnref(),a))b.getConfig()})},a=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+a.code+' and details "'+a.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,u.restrictControlPlaneStatusCode)(a.code,a.details)),{metadata:a.metadata}));let b=this.configSelectionQueue;for(let c of(this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref(),b))c.reportResolverError(a)}),this.filterStackFactory=new i.FilterStackFactory([new j.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(c,void 0,2));const L=Error();(0,l.trace)(h.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(G=L.stack)?void 0:G.substring(L.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(a,b){(0,l.trace)(null!=b?b:h.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+a)}callRefTimerRef(){var a,b,c,d;(null==(b=(a=this.callRefTimer).hasRef)?void 0:b.call(a))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(d=(c=this.callRefTimer).ref)||d.call(c))}callRefTimerUnref(){var a,b;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(b=(a=this.callRefTimer).unref)||b.call(a))}removeConnectivityStateWatcher(a){let b=this.connectivityStateWatchers.findIndex(b=>b===a);b>=0&&this.connectivityStateWatchers.splice(b,1)}updateState(a){for(let b of((0,l.trace)(h.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+o.ConnectivityState[this.connectivityState]+" -> "+o.ConnectivityState[a]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+o.ConnectivityState[a]),this.connectivityState=a,this.connectivityStateWatchers.slice()))a!==b.currentState&&(b.timer&&clearTimeout(b.timer),this.removeConnectivityStateWatcher(b),b.callback());a!==o.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(a){if(a>this.keepaliveTime)for(let b of(this.keepaliveTime=a,this.wrappedSubchannels))b.throttleKeepalive(a)}removeWrappedSubchannel(a){this.wrappedSubchannels.delete(a)}doPick(a,b){return this.currentPicker.pick({metadata:a,extraPickInfo:b})}queueCallForPick(a){this.pickQueue.push(a),this.callRefTimerRef()}getConfig(a,b){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(a,b)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(a){this.configSelectionQueue.push(a),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.IDLE),this.currentPicker=new g.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(a){var b,c;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let a=new Date().valueOf()-this.lastActivityTimestamp.valueOf();a>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-a)},a),null==(c=(b=this.idleTimer).unref)||c.call(b)}maybeStartIdleTimer(){this.connectivityState===o.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(a){this.channelzEnabled&&(a.code===h.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+f+'] method="'+b+'"'),new q.LoadBalancingCall(this,a,b,c,d,e,f)}createRetryingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createRetryingCall ["+f+'] method="'+b+'"'),new v.RetryingCall(this,a,b,c,d,e,f,this.retryBufferTracker,A.get(this.getTarget()))}createInnerCall(a,b,c,d,e){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(a,b,c,d,e):this.createRetryingCall(a,b,c,d,e)}createResolvingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();this.trace("createResolvingCall ["+f+'] method="'+a+'", deadline='+(0,r.deadlineToString)(b));let g={deadline:b,flags:null!=e?e:h.Propagate.DEFAULTS,host:null!=c?c:this.defaultAuthority,parentCall:d},i=new s.ResolvingCall(this,a,g,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),f);return this.onCallStart(),i.addStatusWatcher(a=>{this.onCallEnd(a)}),i}close(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,p.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,n.uriToString)(this.target)}getConnectivityState(a){let b=this.connectivityState;return a&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),b}watchConnectivityState(a,b,c){if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let d=null;if(b!==1/0){let a=b instanceof Date?b:new Date(b),f=new Date;if(b===-1/0||a<=f)return void process.nextTick(c,Error("Deadline passed without connectivity state change"));d=setTimeout(()=>{this.removeConnectivityStateWatcher(e),c(Error("Deadline passed without connectivity state change"))},a.getTime()-f.getTime())}let e={currentState:a,callback:c,timer:d};this.connectivityStateWatchers.push(e)}getChannelzRef(){return this.channelzRef}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(a,b,c,d,e)}}c.InternalChannel=E},61655,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelImplementation=void 0;let d=a.r(61591),e=a.r(75952);class f{constructor(a,b,c){if("string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.internalChannel=new e.InternalChannel(a,b,c)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(a){return this.internalChannel.getConnectivityState(a)}watchConnectivityState(a,b,c){this.internalChannel.watchConnectivityState(a,b,c)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(a,b,c,d,e)}}c.ChannelImplementation=f},15365,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2ServerCallStream=c.ServerDuplexStreamImpl=c.ServerWritableStreamImpl=c.ServerReadableStreamImpl=c.ServerUnaryCallImpl=void 0;let d=a.r(27699),e=a.r(25328),f=a.r(88947),g=a.r(6461),h=a.r(57982),i=a.r(57904),j=a.r(64241),k=a.r(11717),l=a.r(21015),m="server_call";function n(a){k.trace(h.LogVerbosity.DEBUG,m,a)}let o="grpc-message",p="grpc-status",q="grpc-timeout",r=/(\d{1,8})\s*([HMSmun])/,s={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},t={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},u={[e.constants.HTTP2_HEADER_STATUS]:e.constants.HTTP_STATUS_OK,[e.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v={waitForTrailers:!0};class w extends d.EventEmitter{constructor(a,b,c){super(),this.call=a,this.metadata=b,this.request=c,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerUnaryCallImpl=w;class x extends f.Readable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.deserialize=c,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,d)}_read(a){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerReadableStreamImpl=x;class y extends f.Writable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.request=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(a,b,c){try{let b=this.call.serializeMessage(a);if(!this.call.write(b))return void this.call.once("drain",c)}catch(a){this.emit("error",{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}c()}_final(a){this.call.sendStatus({code:h.Status.OK,details:"OK",metadata:this.trailingMetadata}),a(null)}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerWritableStreamImpl=y;class z extends f.Duplex{constructor(a,b,c,d,e){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.deserialize=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,e),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerDuplexStreamImpl=z,z.prototype._read=x.prototype._read,z.prototype._write=y.prototype._write,z.prototype._final=y.prototype._final;class A extends d.EventEmitter{constructor(a,b,c){super(),this.stream=a,this.handler=b,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=h.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=h.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",a=>{}),this.stream.once("close",()=>{var a;n("Request to method "+(null==(a=this.handler)?void 0:a.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:h.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in c&&(this.maxSendMessageSize=c["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in c&&(this.maxReceiveMessageSize=c["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(a,b){let c=a.subarray(5);if("identity"===b)return c;if("deflate"!==b&&"gzip"!==b)return Promise.reject({code:h.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${b}"`});{let a;return a="deflate"===b?g.createInflate():g.createGunzip(),new Promise((b,d)=>{let e=0,f=[];a.on("data",b=>{f.push(b),e+=b.byteLength,-1!==this.maxReceiveMessageSize&&e>this.maxReceiveMessageSize&&(a.destroy(),d({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),a.on("end",()=>{b(Buffer.concat(f))}),a.write(c),a.end()})}}sendMetadata(a){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let b=a?a.toHttp2Headers():null,c=Object.assign(Object.assign(Object.assign({},u),t),b);this.stream.respond(c,v)}receiveMetadata(a){let b=i.Metadata.fromHttp2Headers(a);k.isTracerEnabled(m)&&n("Request to "+this.handler.path+" received headers "+JSON.stringify(b.toJSON()));let c=b.get(q);if(c.length>0){let a=c[0].toString().match(r);if(null===a){let a=Error("Invalid deadline");return a.code=h.Status.OUT_OF_RANGE,this.sendError(a),b}let d=a[1]*s[a[2]]|0,e=new Date;this.deadline=e.setMilliseconds(e.getMilliseconds()+d),this.deadlineTimer=setTimeout(B,d,this),b.remove(q)}return b.remove(e.constants.HTTP2_HEADER_ACCEPT_ENCODING),b.remove(e.constants.HTTP2_HEADER_TE),b.remove(e.constants.HTTP2_HEADER_CONTENT_TYPE),b.remove("grpc-accept-encoding"),b}receiveUnaryMessage(a){return new Promise((b,c)=>{let{stream:d}=this,e=0,f=this,g=[],i=this.maxReceiveMessageSize;function j(a){if(e+=a.byteLength,-1!==i&&e>i){d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),c({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${e} vs. ${i})`});return}g.push(a)}function k(i){if(d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),void 0!==i)return void c({code:h.Status.INTERNAL,details:i.message});if(0===e)return void c({code:h.Status.INTERNAL,details:"received empty unary message"});f.emit("receiveMessage");let l=Buffer.concat(g,e),m=1===l.readUInt8(0)?a:"identity",n=f.getDecompressedMessage(l,m);Buffer.isBuffer(n)?b(f.deserializeMessageWithInternalError(n)):n.then(a=>b(f.deserializeMessageWithInternalError(a)),b=>c(b.code?b:{code:h.Status.INTERNAL,details:`Received "grpc-encoding" header "${a}" but ${a} decompression failed`}))}this.stream.on("data",j),this.stream.on("end",k),this.stream.on("error",k)})}async deserializeMessageWithInternalError(a){try{return this.deserializeMessage(a)}catch(a){throw{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL}}}serializeMessage(a){let b=this.handler.serialize(a),c=b.byteLength,d=Buffer.allocUnsafe(c+5);return d.writeUInt8(0,0),d.writeUInt32BE(c,1),b.copy(d,5),d}deserializeMessage(a){return this.handler.deserialize(a)}async sendUnaryMessage(a,b,c,d){if(!this.checkCancelled()){if(void 0===c&&(c=null),a){!Object.prototype.hasOwnProperty.call(a,"metadata")&&c&&(a.metadata=c),this.sendError(a);return}try{let a=this.serializeMessage(b);this.write(a),this.sendStatus({code:h.Status.OK,details:"OK",metadata:c})}catch(a){this.sendError({details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}}}sendStatus(a){var b,c;if(this.emit("callEnd",a.code),this.emit("streamEnd",a.code===h.Status.OK),!this.checkCancelled())if(n("Request to method "+(null==(b=this.handler)?void 0:b.path)+" ended with status code: "+h.Status[a.code]+" details: "+a.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var b;let c=Object.assign({[p]:a.code,[o]:encodeURI(a.details)},null==(b=a.metadata)?void 0:b.toHttp2Headers());this.stream.sendTrailers(c),this.statusSent=!0}),this.stream.end());else{let b=Object.assign(Object.assign({[p]:a.code,[o]:encodeURI(a.details)},u),null==(c=a.metadata)?void 0:c.toHttp2Headers());this.stream.respond(b,{endStream:!0}),this.statusSent=!0}}sendError(a){let b={code:h.Status.UNKNOWN,details:"message"in a?a.message:"Unknown Error",metadata:"metadata"in a&&void 0!==a.metadata?a.metadata:null};"code"in a&&"number"==typeof a.code&&Number.isInteger(a.code)&&(b.code=a.code,"details"in a&&"string"==typeof a.details&&(b.details=a.details)),this.sendStatus(b)}write(a){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&a.length>this.maxSendMessageSize?void this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${a.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(a))}resume(){this.stream.resume()}setupSurfaceCall(a){this.once("cancelled",b=>{a.cancelled=!0,a.emit("cancelled",b)}),this.once("callEnd",b=>a.emit("callEnd",b))}setupReadable(a,b){let c=new j.StreamDecoder(this.maxReceiveMessageSize),d=!1,e=!1,f=!1,g=async()=>{f||!d||e||(f=!0,await this.pushOrBufferMessage(a,null))};this.stream.on("data",async d=>{let f;try{f=c.write(d)}catch(a){this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:a.message});return}for(let c of(e=!0,this.stream.pause(),f)){let d;this.emit("receiveMessage");let e=1===c.readUInt8(0)?b:"identity";try{d=await this.getDecompressedMessage(c,e)}catch(a){this.sendError(a);return}if(!d)return;await this.pushOrBufferMessage(a,d)}e=!1,this.stream.resume(),await g()}),this.stream.once("end",async()=>{d=!0,await g()})}consumeUnpushedMessages(a){for(this.canPush=!0;this.messagesToPush.length>0;){let b=this.messagesToPush.shift(),c=a.push(b);if(null===b||!1===c){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(a,b){this.isPushPending?this.bufferedMessages.push(b):await this.pushMessage(a,b)}async pushMessage(a,b){if(null===b){n("Received end of stream"),this.canPush?a.push(null):this.messagesToPush.push(null);return}n("Received message of length "+b.length),this.isPushPending=!0;try{let c=await this.deserializeMessage(b);this.canPush?a.push(c)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(c)}catch(c){this.bufferedMessages.length=0;let b=(0,l.getErrorCode)(c);(null===b||b<h.Status.OK||b>h.Status.UNAUTHENTICATED)&&(b=h.Status.INTERNAL),a.emit("error",{details:(0,l.getErrorMessage)(c),code:b})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(a,this.bufferedMessages.shift())}getPeer(){var a;let b=null==(a=this.stream.session)?void 0:a.socket;return null!=b&&b.remoteAddress?b.remotePort?`${b.remoteAddress}:${b.remotePort}`:b.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function B(a){let b=Error("Deadline exceeded");b.code=h.Status.DEADLINE_EXCEEDED,a.sendError(b),a.cancelled=!0,a.emit("cancelled","deadline")}c.Http2ServerCallStream=A},4296,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerCredentials=void 0;let d=a.r(49229);class e{static createInsecure(){return new f}static createSsl(a,b,c=!1){if(null!==a&&!Buffer.isBuffer(a))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(b))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof c)throw TypeError("checkClientCertificate must be a boolean");let e=[],f=[];for(let a=0;a<b.length;a++){let c=b[a];if(null===c||"object"!=typeof c)throw TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(c.private_key))throw TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(c.cert_chain))throw TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);e.push(c.cert_chain),f.push(c.private_key)}return new g({ca:a||(0,d.getDefaultRootsData)()||void 0,cert:e,key:f,requestCert:c,ciphers:d.CIPHER_SUITES})}}c.ServerCredentials=e;class f extends e{_isSecure(){return!1}_getSettings(){return null}}class g extends e{constructor(a){super(),this.options=a}_isSecure(){return!0}_getSettings(){return this.options}}},41069,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Server=void 0;let d=a.r(25328),e=a.r(57982),f=a.r(15365),g=a.r(4296),h=a.r(49845),i=a.r(11717),j=a.r(91177),k=a.r(55647),l=a.r(74970),m=0x7fffffff,n=0x7fffffff,o=2e4,{HTTP2_HEADER_PATH:p}=d.constants,q="server";function r(){}function s(a){return{code:e.Status.UNIMPLEMENTED,details:`The server does not implement the method ${a}`}}function t(a,b){let c=s(b);switch(a){case"unary":return(a,b)=>{b(c,null)};case"clientStream":return(a,b)=>{b(c,null)};case"serverStream":return a=>{a.emit("error",c)};case"bidi":return a=>{a.emit("error",c)};default:throw Error(`Invalid handlerType ${a}`)}}class u{constructor(a){var b,c,d,e;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new l.ChannelzTrace,this.callTracker=new l.ChannelzCallTracker,this.listenerChildrenTracker=new l.ChannelzChildrenTracker,this.sessionChildrenTracker=new l.ChannelzChildrenTracker,this.options=null!=a?a:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,l.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(b=this.options["grpc.max_connection_age_ms"])?b:m,this.maxConnectionAgeGraceMs=null!=(c=this.options["grpc.max_connection_age_grace_ms"])?c:m,this.keepaliveTimeMs=null!=(d=this.options["grpc.keepalive_time_ms"])?d:n,this.keepaliveTimeoutMs=null!=(e=this.options["grpc.keepalive_timeout_ms"])?e:o,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(a){return()=>{var b,c,d;let e,f=this.sessions.get(a),g=a.socket,h=g.remoteAddress?(0,j.stringToSubchannelAddress)(g.remoteAddress,g.remotePort):null,i=g.localAddress?(0,j.stringToSubchannelAddress)(g.localAddress,g.localPort):null;if(a.encrypted){let a=g,c=a.getCipher(),d=a.getCertificate(),f=a.getPeerCertificate();e={cipherSuiteStandardName:null!=(b=c.standardName)?b:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else e=null;return{remoteAddress:h,localAddress:i,security:e,remoteName:null,streamsStarted:f.streamTracker.callsStarted,streamsSucceeded:f.streamTracker.callsSucceeded,streamsFailed:f.streamTracker.callsFailed,messagesSent:f.messagesSent,messagesReceived:f.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:f.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:f.lastMessageSentTimestamp,lastMessageReceivedTimestamp:f.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(c=a.state.localWindowSize)?c:null,remoteFlowControlWindow:null!=(d=a.state.remoteWindowSize)?d:null}}}trace(a){i.trace(e.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+a)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(a,b){if(null===a||"object"!=typeof a||null===b||"object"!=typeof b)throw Error("addService() requires two objects as arguments");let c=Object.keys(a);if(0===c.length)throw Error("Cannot add an empty service to a server");c.forEach(c=>{let d,e,f=a[c];d=f.requestStream?f.responseStream?"bidi":"clientStream":f.responseStream?"serverStream":"unary";let g=b[c];if(void 0===g&&"string"==typeof f.originalName&&(g=b[f.originalName]),e=void 0!==g?g.bind(b):t(d,c),!1===this.register(f.path,e,f.responseSerialize,f.requestDeserialize,d))throw Error(`Method handler for ${f.path} already provided.`)})}removeService(a){if(null===a||"object"!=typeof a)throw Error("removeService() requires object as argument");Object.keys(a).forEach(b=>{let c=a[b];this.unregister(c.path)})}bind(a,b){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(a,b,c){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof a)throw TypeError("port must be a string");if(null===b||!(b instanceof g.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof c)throw TypeError("callback must be a function");let f=(0,k.parseUri)(a);if(null===f)throw Error(`Could not parse port "${a}"`);let m=(0,h.mapUriDefaultScheme)(f);if(null===m)throw Error(`Could not get a default scheme for port "${a}"`);let n={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?n.maxSessionMemory=this.options["grpc-node.max_session_memory"]:n.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(n.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(a,b)=>{process.nextTick(()=>c(a,b))},p=()=>{let a;if(b._isSecure()){let c=Object.assign(n,b._getSettings());c.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(a=d.createSecureServer(c)).on("secureConnection",a=>{a.on("error",a=>{this.trace("An incoming TLS connection closed with error: "+a.message)})})}else a=d.createServer(n);return a.setTimeout(0,r),this._setupHandlers(a),a},q=(a,b,c)=>0===a.length?Promise.resolve({port:b,count:c}):Promise.all(a.map(a=>{let c;this.trace("Attempting to bind "+(0,j.subchannelAddressToString)(a)),c=(0,j.isTcpSubchannelAddress)(a)?{host:a.host,port:b}:a;let d=p();return new Promise((e,f)=>{let g=b=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(a)+" with error "+b.message),e(b)};d.once("error",g),d.listen(c,()=>{let a;if(this.shutdown){d.close(),e(Error("bindAsync failed because server is shutdown"));return}let c=d.address();a="string"==typeof c?{path:c}:{host:c.address,port:c.port};let f=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(a),()=>({localAddress:a,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(f),this.http2ServerList.push({server:d,channelzRef:f}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(a)),e("port"in a?a.port:b),d.removeListener("error",g)})})})).then(a=>{let d=0;for(let c of a)if("number"==typeof c&&(d+=1,c!==b))throw Error("Invalid state: multiple port numbers added from single address");return{port:b,count:d+c}}),s=a=>{if(0===a.length)return Promise.resolve({port:0,count:0});let b=a[0],c=p();return new Promise((d,e)=>{let f=c=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(b)+" with error "+c.message),d(s(a.slice(1)))};c.once("error",f),c.listen(b,()=>{if(this.shutdown){c.close(),d({port:0,count:0});return}let b=c.address(),e={host:b.address,port:b.port},g=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:c,channelzRef:g}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(e)),d(q(a.slice(1),b.port,1)),c.removeListener("error",f)})})},t={onSuccessfulResolution:(b,c,d)=>{let f;(t.onSuccessfulResolution=()=>{},this.shutdown&&o(Error("bindAsync failed because server is shutdown"),0),0===b.length)?o(Error(`No addresses resolved for port ${a}`),0):(f=(0,j.isTcpSubchannelAddress)(b[0])?0===b[0].port?s(b):q(b,b[0].port,0):q(b,1,0)).then(a=>{if(0===a.count){let a=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,a),o(Error(a),0)}else a.count<b.length&&i.log(e.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${b.length} resolved`),o(null,a.port)},a=>{let c=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,c),o(Error(c),0)})},onError:a=>{o(Error(a.details),0)}};(0,h.createResolver)(m,t,this.options).updateResolution()}forceShutdown(){for(let{server:a,channelzRef:b}of this.http2ServerList)a.listening&&a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b))});this.started=!1,this.shutdown=!0,this.sessions.forEach((a,b)=>{b.destroy(d.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef)}register(a,b,c,d,e){return!this.handlers.has(a)&&(this.handlers.set(a,{func:b,serialize:c,deserialize:d,type:e,path:a}),!0)}unregister(a){return this.handlers.delete(a)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:a})=>!0!==a.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(a){let b=b=>{this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef),a(b)},c=0;function d(){0==--c&&b()}for(let{server:a,channelzRef:b}of(this.started=!1,this.shutdown=!0,this.http2ServerList))a.listening&&(c++,a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b)),d()}));this.sessions.forEach((a,b)=>{b.closed||(c+=1,b.close(d))}),0===c&&b()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(a,b){let c=b[d.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof c&&!!c.startsWith("application/grpc")||(a.respond({[d.constants.HTTP2_HEADER_STATUS]:d.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(a){this.trace("Received call to method "+a+" at address "+this.serverAddressString);let b=this.handlers.get(a);return void 0===b?(this.trace("No handler registered for method "+a+". Sending UNIMPLEMENTED status."),null):b}_respondWithError(a,b,c=null){let d=new f.Http2ServerCallStream(b,null,this.options);void 0===a.code&&(a.code=e.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed()),d.sendError(a)}_channelzHandler(a,b){let c=this.sessions.get(a.session);if(this.callTracker.addCallStarted(),null==c||c.streamTracker.addCallStarted(),!this._verifyContentType(a,b)){this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed();return}let d=b[p],g=this._retrieveHandler(d);if(!g)return void this._respondWithError(s(d),a,c);let h=new f.Http2ServerCallStream(a,g,this.options);h.once("callEnd",a=>{a===e.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),c&&(h.once("streamEnd",a=>{a?c.streamTracker.addCallSucceeded():c.streamTracker.addCallFailed()}),h.on("sendMessage",()=>{c.messagesSent+=1,c.lastMessageSentTimestamp=new Date}),h.on("receiveMessage",()=>{c.messagesReceived+=1,c.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(h,g,b)||(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed(),h.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${g.type}`}))}_streamHandler(a,b){if(!0!==this._verifyContentType(a,b))return;let c=b[p],d=this._retrieveHandler(c);if(!d)return void this._respondWithError(s(c),a,null);let g=new f.Http2ServerCallStream(a,d,this.options);this._runHandlerForCall(g,d,b)||g.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${d.type}`})}_runHandlerForCall(a,b,c){var d;let e=a.receiveMetadata(c),f=null!=(d=e.get("grpc-encoding")[0])?d:"identity";e.remove("grpc-encoding");let{type:g}=b;if("unary"===g)v(a,b,e,f);else if("clientStream"===g)w(a,b,e,f);else if("serverStream"===g)x(a,b,e,f);else{if("bidi"!==g)return!1;y(a,b,e,f)}return!0}_setupHandlers(a){if(null===a)return;let b=a.address(),c="null";b&&(c="string"==typeof b?b:b.address+":"+b.port),this.serverAddressString=c;let e=this.channelzEnabled?this._channelzHandler:this._streamHandler;a.on("stream",e.bind(this)),a.on("session",a=>{var b,c,e,f,g;if(!this.started)return void a.destroy();let h=(0,l.registerChannelzSocket)(null!=(b=a.socket.remoteAddress)?b:"unknown",this.getChannelzSessionInfoGetter(a),this.channelzEnabled),i={ref:h,streamTracker:new l.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(a,i);let j=a.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+j),this.sessionChildrenTracker.refChild(h));let k=null,n=null,o=!1;if(this.maxConnectionAgeMs!==m){let b=this.maxConnectionAgeMs/10,f=Math.random()*b*2-b;k=null==(e=(c=setTimeout(()=>{var b,c;o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+j);try{a.goaway(d.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(b){a.destroy();return}a.close(),this.maxConnectionAgeGraceMs!==m&&(n=null==(c=(b=setTimeout(()=>{a.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:c.call(b))},this.maxConnectionAgeMs+f)).unref)?void 0:e.call(c)}let p=null==(g=(f=setInterval(()=>{var b,c;let d=null==(c=(b=setTimeout(()=>{o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+j),a.close()},this.keepaliveTimeoutMs)).unref)?void 0:c.call(b);try{a.ping((a,b,c)=>{clearTimeout(d)})}catch(b){a.destroy()}},this.keepaliveTimeMs)).unref)?void 0:g.call(f);a.on("close",()=>{this.channelzEnabled&&(o||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+j),this.sessionChildrenTracker.unrefChild(h),(0,l.unregisterChannelzRef)(h)),k&&clearTimeout(k),n&&clearTimeout(n),p&&clearTimeout(p),this.sessions.delete(a)})})}}async function v(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerUnaryCallImpl(a,c,e);b.func(g,(b,c,d,e)=>{a.sendUnaryMessage(b,c,d,e)})}catch(b){a.sendError(b)}}function w(a,b,c,d){let e=new f.ServerReadableStreamImpl(a,c,b.deserialize,d);function g(b,c,d,f){e.destroy(),a.sendUnaryMessage(b,c,d,f)}a.cancelled||(e.on("error",g),b.func(e,g))}async function x(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerWritableStreamImpl(a,c,b.serialize,e);b.func(g)}catch(b){a.sendError(b)}}function y(a,b,c,d){let e=new f.ServerDuplexStreamImpl(a,c,b.serialize,b.deserialize,d);a.cancelled||b.func(e)}c.Server=u},36272,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StatusBuilder=void 0;class d{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(a){return this.code=a,this}withDetails(a){return this.details=a,this}withMetadata(a){return this.metadata=a,this}build(){let a={};return null!==this.code&&(a.code=this.code),null!==this.details&&(a.details=this.details),null!==this.metadata&&(a.metadata=this.metadata),a}}c.StatusBuilder=d},38999,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.isDuration=c.durationToMs=c.msToDuration=void 0,c.msToDuration=function(a){return{seconds:a/1e3|0,nanos:a%1e3*1e6|0}},c.durationToMs=function(a){return 1e3*a.seconds+a.nanos/1e6|0},c.isDuration=function(a){return"number"==typeof a.seconds&&"number"==typeof a.nanos}},62818,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.OutlierDetectionLoadBalancer=c.OutlierDetectionLoadBalancingConfig=void 0;let e=a.r(56537),f=a.r(57982),g=a.r(38999),h=a.r(94497),i=a.r(39071),j=a.r(33140),k=a.r(3681),l=a.r(91177),m=a.r(4706),n=a.r(11717),o="outlier_detection";function p(a){n.trace(f.LogVerbosity.DEBUG,o,a)}let q="outlier_detection",r=(null!=(d=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?d:"true")==="true",s={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},t={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function u(a,b,c,d){if(b in a&&typeof a[b]!==c){let e=d?`${d}.${b}`:b;throw Error(`outlier detection config ${e} parse error: expected ${c}, got ${typeof a[b]}`)}}function v(a,b,c){let d=c?`${c}.${b}`:b;if(b in a){if(!(0,g.isDuration)(a[b]))throw Error(`outlier detection config ${d} parse error: expected Duration, got ${typeof a[b]}`);if(!(a[b].seconds>=0&&a[b].seconds<=315576e6&&a[b].nanos>=0&&a[b].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${d} parse error: values out of range for non-negative Duaration`)}}function w(a,b,c){let d=c?`${c}.${b}`:b;if(u(a,b,"number",c),b in a&&!(a[b]>=0&&a[b]<=100))throw Error(`outlier detection config ${d} parse error: value out of range for percentage (0-100)`)}class x{constructor(a,b,c,d,e,f,g){if(this.childPolicy=g,g.length>0&&"pick_first"===g[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=a?a:1e4,this.baseEjectionTimeMs=null!=b?b:3e4,this.maxEjectionTimeMs=null!=c?c:3e5,this.maxEjectionPercent=null!=d?d:10,this.successRateEjection=e?Object.assign(Object.assign({},s),e):null,this.failurePercentageEjection=f?Object.assign(Object.assign({},t),f):null}getLoadBalancerName(){return q}toJsonObject(){return{interval:(0,g.msToDuration)(this.intervalMs),base_ejection_time:(0,g.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,g.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(a=>a.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(a){return new x(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,a)}static createFromJson(a){var b;if(v(a,"interval"),v(a,"base_ejection_time"),v(a,"max_ejection_time"),w(a,"max_ejection_percent"),"success_rate_ejection"in a){if("object"!=typeof a.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");u(a.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(a.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),u(a.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),u(a.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in a){if("object"!=typeof a.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(a.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(a.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),u(a.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),u(a.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new x(a.interval?(0,g.durationToMs)(a.interval):null,a.base_ejection_time?(0,g.durationToMs)(a.base_ejection_time):null,a.max_ejection_time?(0,g.durationToMs)(a.max_ejection_time):null,null!=(b=a.max_ejection_percent)?b:null,a.success_rate_ejection,a.failure_percentage_ejection,a.child_policy.map(i.validateLoadBalancingConfig))}}c.OutlierDetectionLoadBalancingConfig=x;class y extends m.BaseSubchannelWrapper{constructor(a,b){super(a),this.mapEntry=b,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=a.getConnectivityState(),a.addConnectivityStateListener((a,b,c,d)=>{if(this.childSubchannelState=c,!this.ejected)for(let a of this.stateListeners)a(this,b,c,d)})}getConnectivityState(){return this.ejected?e.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(a){this.stateListeners.push(a)}removeConnectivityStateListener(a){let b=this.stateListeners.indexOf(a);b>-1&&this.stateListeners.splice(b,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let a=this.mapEntry.subchannelWrappers.indexOf(this);a>=0&&this.mapEntry.subchannelWrappers.splice(a,1)}}eject(){for(let a of(this.ejected=!0,this.stateListeners))a(this,this.childSubchannelState,e.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let a of(this.ejected=!1,this.stateListeners))a(this,e.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function z(){return{success:0,failure:0}}class A{constructor(){this.activeBucket=z(),this.inactiveBucket=z()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=z()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class B{constructor(a,b){this.wrappedPicker=a,this.countCalls=b}pick(a){let b=this.wrappedPicker.pick(a);if(b.pickResultType!==k.PickResultType.COMPLETE)return b;{let a=b.subchannel,c=a.getMapEntry();if(!c)return Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel()});{let d=b.onCallEnded;return this.countCalls&&(d=a=>{var d;a===f.Status.OK?c.counter.addSuccess():c.counter.addFailure(),null==(d=b.onCallEnded)||d.call(b,a)}),Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel(),onCallEnded:d})}}}}class C{constructor(a){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new j.ChildLoadBalancerHandler((0,h.createChildChannelControlHelper)(a,{createSubchannel:(b,c)=>{let d=a.createSubchannel(b,c),e=this.addressMap.get((0,l.subchannelAddressToString)(b)),f=new y(d,e);return(null==e?void 0:e.currentEjectionTimestamp)!==null&&f.eject(),null==e||e.subchannelWrappers.push(f),f},updateState:(b,c)=>{b===e.ConnectivityState.READY?a.updateState(b,new B(c,this.isCountingEnabled())):a.updateState(b,c)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let a=0;for(let b of this.addressMap.values())null!==b.currentEjectionTimestamp&&(a+=1);return 100*a/this.addressMap.size}runSuccessRateCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getSuccessRateEjectionConfig();if(!b)return;p("Running success rate check");let c=b.request_volume,d=0,e=[];for(let[a,b]of this.addressMap){let f=b.counter.getLastSuccesses(),g=b.counter.getLastFailures();p("Stats for "+a+": successes="+f+" failures="+g+" targetRequestVolume="+c),f+g>=c&&(d+=1,e.push(f/(f+g)))}if(p("Found "+d+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+e+"]"),d<b.minimum_hosts)return;let f=e.reduce((a,b)=>a+b)/e.length,g=0;for(let a of e){let b=a-f;g+=b*b}let h=Math.sqrt(g/e.length),i=f-h*(b.stdev_factor/1e3);for(let[d,e]of(p("stdev="+h+" ejectionThreshold="+i),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=e.counter.getLastSuccesses(),g=e.counter.getLastFailures();if(f+g<c)continue;let h=f/(f+g);if(p("Checking candidate "+d+" successRate="+h),h<i){let c=100*Math.random();p("Candidate "+d+" randomNumber="+c+" enforcement_percentage="+b.enforcement_percentage),c<b.enforcement_percentage&&(p("Ejecting candidate "+d),this.eject(e,a))}}}runFailurePercentageCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getFailurePercentageEjectionConfig();if(!b)return;p("Running failure percentage check. threshold="+b.threshold+" request volume threshold="+b.request_volume);let c=0;for(let a of this.addressMap.values())a.counter.getLastSuccesses()+a.counter.getLastFailures()>=b.request_volume&&(c+=1);if(!(c<b.minimum_hosts))for(let[c,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let e=d.counter.getLastSuccesses(),f=d.counter.getLastFailures();if((p("Candidate successes="+e+" failures="+f),!(e+f<b.request_volume))&&100*f/(f+e)>b.threshold){let e=100*Math.random();p("Candidate "+c+" randomNumber="+e+" enforcement_percentage="+b.enforcement_percentage),e<b.enforcement_percentage&&(p("Ejecting candidate "+c),this.eject(d,a))}}}eject(a,b){for(let b of(a.currentEjectionTimestamp=new Date,a.ejectionTimeMultiplier+=1,a.subchannelWrappers))b.eject()}uneject(a){for(let b of(a.currentEjectionTimestamp=null,a.subchannelWrappers))b.uneject()}switchAllBuckets(){for(let a of this.addressMap.values())a.counter.switchBuckets()}startTimer(a){var b,c;this.ejectionTimer=setTimeout(()=>this.runChecks(),a),null==(c=(b=this.ejectionTimer).unref)||c.call(b)}runChecks(){let a=new Date;if(p("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[b,c]of(this.timerStartTime=a,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(a),this.runFailurePercentageCheck(a),this.addressMap.entries()))if(null===c.currentEjectionTimestamp)c.ejectionTimeMultiplier>0&&(c.ejectionTimeMultiplier-=1);else{let a=this.latestConfig.getBaseEjectionTimeMs(),d=this.latestConfig.getMaxEjectionTimeMs(),e=new Date(c.currentEjectionTimestamp.getTime());e.setMilliseconds(e.getMilliseconds()+Math.min(a*c.ejectionTimeMultiplier,Math.max(a,d))),e<new Date&&(p("Unejecting "+b),this.uneject(c))}}updateAddressList(a,b,c){if(!(b instanceof x))return;let d=new Set;for(let b of a)d.add((0,l.subchannelAddressToString)(b));for(let a of d)this.addressMap.has(a)||(p("Adding map entry for "+a),this.addressMap.set(a,{counter:new A,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())d.has(a)||(p("Removing map entry for "+a),this.addressMap.delete(a));let e=(0,i.getFirstUsableConfig)(b.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(a,e,c),b.getSuccessRateEjectionConfig()||b.getFailurePercentageEjectionConfig())if(this.timerStartTime){p("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=b.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else p("Starting new timer"),this.timerStartTime=new Date,this.startTimer(b.getIntervalMs()),this.switchAllBuckets();else for(let a of(p("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(a),a.ejectionTimeMultiplier=0;this.latestConfig=b}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return q}}c.OutlierDetectionLoadBalancer=C,c.setup=function(){r&&(0,h.registerLoadBalancerType)(q,C,x)}},94497,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OutlierDetectionLoadBalancingConfig=c.BaseSubchannelWrapper=c.registerAdminService=c.FilterStackFactory=c.BaseFilter=c.PickResultType=c.QueuePicker=c.UnavailablePicker=c.ChildLoadBalancerHandler=c.subchannelAddressToString=c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.registerLoadBalancerType=c.createChildChannelControlHelper=c.BackoffTimeout=c.durationToMs=c.uriToString=c.createResolver=c.registerResolver=c.log=c.trace=void 0;var d=a.r(11717);Object.defineProperty(c,"trace",{enumerable:!0,get:function(){return d.trace}}),Object.defineProperty(c,"log",{enumerable:!0,get:function(){return d.log}});var e=a.r(49845);Object.defineProperty(c,"registerResolver",{enumerable:!0,get:function(){return e.registerResolver}}),Object.defineProperty(c,"createResolver",{enumerable:!0,get:function(){return e.createResolver}});var f=a.r(55647);Object.defineProperty(c,"uriToString",{enumerable:!0,get:function(){return f.uriToString}});var g=a.r(38999);Object.defineProperty(c,"durationToMs",{enumerable:!0,get:function(){return g.durationToMs}});var h=a.r(57451);Object.defineProperty(c,"BackoffTimeout",{enumerable:!0,get:function(){return h.BackoffTimeout}});var i=a.r(39071);Object.defineProperty(c,"createChildChannelControlHelper",{enumerable:!0,get:function(){return i.createChildChannelControlHelper}}),Object.defineProperty(c,"registerLoadBalancerType",{enumerable:!0,get:function(){return i.registerLoadBalancerType}}),Object.defineProperty(c,"getFirstUsableConfig",{enumerable:!0,get:function(){return i.getFirstUsableConfig}}),Object.defineProperty(c,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return i.validateLoadBalancingConfig}});var j=a.r(91177);Object.defineProperty(c,"subchannelAddressToString",{enumerable:!0,get:function(){return j.subchannelAddressToString}});var k=a.r(33140);Object.defineProperty(c,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return k.ChildLoadBalancerHandler}});var l=a.r(3681);Object.defineProperty(c,"UnavailablePicker",{enumerable:!0,get:function(){return l.UnavailablePicker}}),Object.defineProperty(c,"QueuePicker",{enumerable:!0,get:function(){return l.QueuePicker}}),Object.defineProperty(c,"PickResultType",{enumerable:!0,get:function(){return l.PickResultType}});var m=a.r(59940);Object.defineProperty(c,"BaseFilter",{enumerable:!0,get:function(){return m.BaseFilter}});var n=a.r(15325);Object.defineProperty(c,"FilterStackFactory",{enumerable:!0,get:function(){return n.FilterStackFactory}});var o=a.r(31509);Object.defineProperty(c,"registerAdminService",{enumerable:!0,get:function(){return o.registerAdminService}});var p=a.r(4706);Object.defineProperty(c,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p.BaseSubchannelWrapper}});var q=a.r(62818);Object.defineProperty(c,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return q.OutlierDetectionLoadBalancingConfig}})},5560,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(49845);class e{constructor(a,b,c){let d;this.listener=b,this.addresses=[],this.hasReturnedResult=!1,d=""===a.authority?"/"+a.path:a.path,this.addresses=[{path:d}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(a){return"localhost"}}c.setup=function(){(0,d.registerResolver)("unix",e)}},40926,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(4446),e=a.r(57982),f=a.r(57904),g=a.r(49845),h=a.r(55647),i=a.r(11717),j="ip_resolver";function k(a){i.trace(e.LogVerbosity.DEBUG,j,a)}let l="ipv4",m="ipv6",n=443;class o{constructor(a,b,c){var g;this.listener=b,this.addresses=[],this.error=null,this.hasReturnedResult=!1,k("Resolver constructed for target "+(0,h.uriToString)(a));const i=[];if(a.scheme!==l&&a.scheme!==m){this.error={code:e.Status.UNAVAILABLE,details:`Unrecognized scheme ${a.scheme} in IP resolver`,metadata:new f.Metadata};return}for(const b of a.path.split(",")){const c=(0,h.splitHostPort)(b);if(null===c||a.scheme===l&&!(0,d.isIPv4)(c.host)||a.scheme===m&&!(0,d.isIPv6)(c.host)){this.error={code:e.Status.UNAVAILABLE,details:`Failed to parse ${a.scheme} address ${b}`,metadata:new f.Metadata};return}i.push({host:c.host,port:null!=(g=c.port)?g:n})}this.addresses=i,k("Parsed "+a.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(a){return a.path.split(",")[0]}}c.setup=function(){(0,g.registerResolver)(l,o),(0,g.registerResolver)(m,o)}},24241,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.PickFirstLoadBalancer=c.shuffled=c.PickFirstLoadBalancingConfig=void 0;let d=a.r(39071),e=a.r(56537),f=a.r(3681),g=a.r(11717),h=a.r(57982),i="pick_first";function j(a){g.trace(h.LogVerbosity.DEBUG,i,a)}let k="pick_first",l=250;class m{constructor(a){this.shuffleAddressList=a}getLoadBalancerName(){return k}toJsonObject(){return{[k]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(a){if("shuffleAddressList"in a&&"boolean"!=typeof a.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new m(!0===a.shuffleAddressList)}}c.PickFirstLoadBalancingConfig=m;class n{constructor(a){this.subchannel=a}pick(a){return{pickResultType:f.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function o(a){let b=a.slice();for(let a=b.length-1;a>1;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}c.shuffled=o;class p{constructor(a){this.channelControlHelper=a,this.children=[],this.currentState=e.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(a,b,c,d,e)=>{this.onSubchannelStateUpdate(a,b,c,e)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(a=>a.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(e.ConnectivityState.READY,new n(this.currentPick)):0===this.children.length?this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:a}of(this.stickyTransientFailureMode=!0,this.children))a.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let a=this.currentPick;this.currentPick=null,a.unref(),a.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(a.getChannelzRef())}}onSubchannelStateUpdate(a,b,c,d){var f;if(null==(f=this.currentPick)?void 0:f.realSubchannelEquals(a)){c!==e.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[b,f]of this.children.entries())if(a.realSubchannelEquals(f.subchannel)){c===e.ConnectivityState.READY&&this.pickSubchannel(f.subchannel),c===e.ConnectivityState.TRANSIENT_FAILURE&&(f.hasReportedTransientFailure=!0,d&&(this.lastError=d),this.maybeEnterStickyTransientFailureMode(),b===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(b+1)),f.subchannel.startConnecting();return}}startNextSubchannelConnecting(a){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[b,c]of this.children.entries())if(b>=a){let a=c.subchannel.getConnectivityState();if(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.CONNECTING)return void this.startConnecting(b)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(a){var b,c;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=a,this.children[a].subchannel.getConnectivityState()===e.ConnectivityState.IDLE&&(j("Start connecting to subchannel with address "+this.children[a].subchannel.getAddress()),process.nextTick(()=>{var b;null==(b=this.children[a])||b.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(c=(b=setTimeout(()=>{this.startNextSubchannelConnecting(a+1)},l)).unref)?void 0:c.call(b)}pickSubchannel(a){this.currentPick&&a.realSubchannelEquals(this.currentPick)||(j("Pick subchannel with address "+a.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=a,a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(a,b){j(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.children)this.currentPick&&a.subchannel.realSubchannelEquals(this.currentPick)||a.subchannel.removeConnectivityStateListener(this.subchannelStateListener),a.subchannel.unref(),this.channelControlHelper.removeChannelzChild(a.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(a){let b=a.map(a=>({subchannel:this.channelControlHelper.createSubchannel(a,{}),hasReportedTransientFailure:!1}));for(let{subchannel:a}of b)a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef());for(let{subchannel:a}of(this.resetSubchannelList(),this.children=b,this.children))if(a.addConnectivityStateListener(this.subchannelStateListener),a.getConnectivityState()===e.ConnectivityState.READY)return void this.pickSubchannel(a);for(let a of this.children)a.subchannel.getConnectivityState()===e.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(a,b){b instanceof m&&(b.getShuffleAddressList()&&(a=o(a)),this.latestAddressList=a,this.connectToAddressList(a))}exitIdle(){this.currentState===e.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return k}}c.PickFirstLoadBalancer=p,c.setup=function(){(0,d.registerLoadBalancerType)(k,p,m),(0,d.registerDefaultLoadBalancerType)(k)}},63765,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.RoundRobinLoadBalancer=void 0;let d=a.r(39071),e=a.r(56537),f=a.r(3681),g=a.r(91177),h=a.r(11717),i=a.r(57982),j="round_robin";function k(a){h.trace(i.LogVerbosity.DEBUG,j,a)}let l="round_robin";class m{getLoadBalancerName(){return l}toJsonObject(){return{[l]:{}}}static createFromJson(a){return new m}}class n{constructor(a,b=0){this.subchannelList=a,this.nextIndex=b}pick(a){let b=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:f.PickResultType.COMPLETE,subchannel:b,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class o{constructor(a){this.channelControlHelper=a,this.subchannels=[],this.currentState=e.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(a,b,c,d,f)=>{this.calculateAndUpdateState(),(c===e.ConnectivityState.TRANSIENT_FAILURE||c===e.ConnectivityState.IDLE)&&(f&&(this.lastError=f),this.channelControlHelper.requestReresolution(),a.startConnecting())}}countSubchannelsWithState(a){return this.subchannels.filter(b=>b.getConnectivityState()===a).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(e.ConnectivityState.READY)>0){let a=this.subchannels.filter(a=>a.getConnectivityState()===e.ConnectivityState.READY),b=0;null!==this.currentReadyPicker&&(b=a.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(b=0),this.updateState(e.ConnectivityState.READY,new n(a,b))}else this.countSubchannelsWithState(e.ConnectivityState.CONNECTING)>0?this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this)):this.countSubchannelsWithState(e.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this))}updateState(a,b){k(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),a===e.ConnectivityState.READY?this.currentReadyPicker=b:this.currentReadyPicker=null,this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.subchannels)a.removeConnectivityStateListener(this.subchannelStateListener),a.unref(),this.channelControlHelper.removeChannelzChild(a.getChannelzRef());this.subchannels=[]}updateAddressList(a,b){for(let b of(this.resetSubchannelList(),k("Connect to address list "+a.map(a=>(0,g.subchannelAddressToString)(a))),this.subchannels=a.map(a=>this.channelControlHelper.createSubchannel(a,{})),this.subchannels)){b.ref(),b.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(b.getChannelzRef());let a=b.getConnectivityState();(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.TRANSIENT_FAILURE)&&b.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let a of this.subchannels)a.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return l}}c.RoundRobinLoadBalancer=o,c.setup=function(){(0,d.registerLoadBalancerType)(l,o,m)}},80304,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.experimental=c.addAdminServicesToServer=c.getChannelzHandlers=c.getChannelzServiceDefinition=c.InterceptorConfigurationError=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.StatusBuilder=c.getClientChannel=c.ServerCredentials=c.Server=c.setLogVerbosity=c.setLogger=c.load=c.loadObject=c.CallCredentials=c.ChannelCredentials=c.waitForClientReady=c.closeClient=c.Channel=c.makeGenericClientConstructor=c.makeClientConstructor=c.loadPackageDefinition=c.Client=c.compressionAlgorithms=c.propagate=c.connectivityState=c.status=c.logVerbosity=c.Metadata=c.credentials=void 0;let d=a.r(20574);Object.defineProperty(c,"CallCredentials",{enumerable:!0,get:function(){return d.CallCredentials}});let e=a.r(61655);Object.defineProperty(c,"Channel",{enumerable:!0,get:function(){return e.ChannelImplementation}});let f=a.r(69425);Object.defineProperty(c,"compressionAlgorithms",{enumerable:!0,get:function(){return f.CompressionAlgorithms}});let g=a.r(56537);Object.defineProperty(c,"connectivityState",{enumerable:!0,get:function(){return g.ConnectivityState}});let h=a.r(61591);Object.defineProperty(c,"ChannelCredentials",{enumerable:!0,get:function(){return h.ChannelCredentials}});let i=a.r(19856);Object.defineProperty(c,"Client",{enumerable:!0,get:function(){return i.Client}});let j=a.r(57982);Object.defineProperty(c,"logVerbosity",{enumerable:!0,get:function(){return j.LogVerbosity}}),Object.defineProperty(c,"status",{enumerable:!0,get:function(){return j.Status}}),Object.defineProperty(c,"propagate",{enumerable:!0,get:function(){return j.Propagate}});let k=a.r(11717),l=a.r(80721);Object.defineProperty(c,"loadPackageDefinition",{enumerable:!0,get:function(){return l.loadPackageDefinition}}),Object.defineProperty(c,"makeClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}}),Object.defineProperty(c,"makeGenericClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}});let m=a.r(57904);Object.defineProperty(c,"Metadata",{enumerable:!0,get:function(){return m.Metadata}});let n=a.r(41069);Object.defineProperty(c,"Server",{enumerable:!0,get:function(){return n.Server}});let o=a.r(4296);Object.defineProperty(c,"ServerCredentials",{enumerable:!0,get:function(){return o.ServerCredentials}});let p=a.r(36272);Object.defineProperty(c,"StatusBuilder",{enumerable:!0,get:function(){return p.StatusBuilder}}),c.credentials={combineChannelCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),combineCallCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),createInsecure:h.ChannelCredentials.createInsecure,createSsl:h.ChannelCredentials.createSsl,createFromSecureContext:h.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:d.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:d.CallCredentials.createFromGoogleCredential,createEmpty:d.CallCredentials.createEmpty},c.closeClient=a=>a.close(),c.waitForClientReady=(a,b,c)=>a.waitForReady(b,c),c.loadObject=(a,b)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.load=(a,b,c)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.setLogger=a=>{k.setLogger(a)},c.setLogVerbosity=a=>{k.setLoggerVerbosity(a)},c.getClientChannel=a=>i.Client.prototype.getChannel.call(a);var q=a.r(83278);Object.defineProperty(c,"ListenerBuilder",{enumerable:!0,get:function(){return q.ListenerBuilder}}),Object.defineProperty(c,"RequesterBuilder",{enumerable:!0,get:function(){return q.RequesterBuilder}}),Object.defineProperty(c,"InterceptingCall",{enumerable:!0,get:function(){return q.InterceptingCall}}),Object.defineProperty(c,"InterceptorConfigurationError",{enumerable:!0,get:function(){return q.InterceptorConfigurationError}});var r=a.r(74970);Object.defineProperty(c,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return r.getChannelzServiceDefinition}}),Object.defineProperty(c,"getChannelzHandlers",{enumerable:!0,get:function(){return r.getChannelzHandlers}});var s=a.r(31509);Object.defineProperty(c,"addAdminServicesToServer",{enumerable:!0,get:function(){return s.addAdminServicesToServer}}),c.experimental=a.r(94497);let t=a.r(87695),u=a.r(5560),v=a.r(40926),w=a.r(24241),x=a.r(63765),y=a.r(62818),z=a.r(74970);(()=>{t.setup(),u.setup(),v.setup(),w.setup(),x.setup(),y.setup(),z.setup()})()},69387,60574,a=>{"use strict";var b,c,d,e,f=a.i(88156),g=a.i(57179),h=f,i=a.i(69304),j="u">typeof globalThis?globalThis:a.g,k={};(function(){function a(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function d(a,b,c){c||(c=0);let d=Array(16);if("string"==typeof b)for(var e=0;e<16;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;e<16;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0],c=a.g[1],e=a.g[2];let f=a.g[3],g;g=b+(f^c&(e^f))+d[0]+0xd76aa478|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[1]+0xe8c7b756|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[2]+0x242070db|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[3]+0xc1bdceee|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[4]+0xf57c0faf|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[5]+0x4787c62a|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[6]+0xa8304613|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[7]+0xfd469501|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[8]+0x698098d8|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[9]+0x8b44f7af|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[10]+0xffff5bb1|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[11]+0x895cd7be|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[12]+0x6b901122|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[13]+0xfd987193|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[14]+0xa679438e|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[15]+0x49b40821|0,c=e+(g<<22|g>>>10),g=b+(e^f&(c^e))+d[1]+0xf61e2562|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[6]+0xc040b340|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[11]+0x265e5a51|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[0]+0xe9b6c7aa|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[5]+0xd62f105d|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[10]+0x2441453|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[15]+0xd8a1e681|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[4]+0xe7d3fbc8|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[9]+0x21e1cde6|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[14]+0xc33707d6|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[3]+0xf4d50d87|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[8]+0x455a14ed|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[13]+0xa9e3e905|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[2]+0xfcefa3f8|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[7]+0x676f02d9|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[12]+0x8d2a4c8a|0,g=b+((c=e+(g<<20|g>>>12))^e^f)+d[5]+0xfffa3942|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[8]+0x8771f681|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[11]+0x6d9d6122|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[14]+0xfde5380c|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[1]+0xa4beea44|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[4]+0x4bdecfa9|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[7]+0xf6bb4b60|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[10]+0xbebfbc70|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[13]+0x289b7ec6|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[0]+0xeaa127fa|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[3]+0xd4ef3085|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[6]+0x4881d05|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[9]+0xd9d4d039|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[12]+0xe6db99e5|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[15]+0x1fa27cf8|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[2]+0xc4ac5665|0,c=e+(g<<23|g>>>9),g=b+(e^(c|~f))+d[0]+0xf4292244|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[7]+0x432aff97|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[14]+0xab9423a7|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[5]+0xfc93a039|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[12]+0x655b59c3|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[3]+0x8f0ccc92|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[10]+0xffeff47d|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[1]+0x85845dd1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[8]+0x6fa87e4f|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[15]+0xfe2ce6e0|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[6]+0xa3014314|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[13]+0x4e0811a1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[4]+0xf7537e82|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[11]+0xbd3af235|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[2]+0x2ad7d2bb|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[9]+0xeb86d391|0,a.g[0]=a.g[0]+b|0,a.g[1]=a.g[1]+(e+(g<<21|g>>>11))|0,a.g[2]=a.g[2]+e|0,a.g[3]=a.g[3]+f|0}function e(a,b){var c=h;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}function f(a,b){this.h=b;let c=[],d=!0;for(let e=a.length-1;e>=0;e--){let f=0|a[e];d&&f==b||(c[e]=f,d=!1)}this.g=c}(function(a,b){function c(){}c.prototype=b.prototype,a.F=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.D=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)}})(a,function(){this.blockSize=-1}),a.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},a.prototype.v=function(a,b){void 0===b&&(b=a.length);let c=b-this.blockSize,e=this.C,f=this.h,g=0;for(;g<b;){if(0==f)for(;g<=c;)d(this,a,g),g+=this.blockSize;if("string"==typeof a){for(;g<b;)if(e[f++]=a.charCodeAt(g++),f==this.blockSize){d(this,e),f=0;break}}else for(;g<b;)if(e[f++]=a[g++],f==this.blockSize){d(this,e),f=0;break}}this.h=f,this.o+=b},a.prototype.A=function(){var a=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;b=8*this.o;for(var c=a.length-8;c<a.length;++c)a[c]=255&b,b/=256;for(this.v(a),a=Array(16),b=0,c=0;c<4;++c)for(let d=0;d<32;d+=8)a[b++]=this.g[c]>>>d&255;return a};var g,h={};function i(a){return -128<=a&&a<128?e(a,function(a){return new f([0|a],a<0?-1:0)}):new f([0|a],a<0?-1:0)}function j(a){if(isNaN(a)||!isFinite(a))return m;if(a<0)return r(j(-a));let b=[],c=1;for(let d=0;a>=c;d++)b[d]=a/c|0,c*=0x100000000;return new f(b,0)}function l(a,b){if(0==a.length)throw Error("number format error: empty string");if((b=b||10)<2||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return r(l(a.substring(1),b));if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character');let c=j(Math.pow(b,8)),d=m;for(let f=0;f<a.length;f+=8){var e=Math.min(8,a.length-f);let g=parseInt(a.substring(f,f+e),b);e<8?(e=j(Math.pow(b,e)),d=d.j(e).add(j(g))):d=(d=d.j(c)).add(j(g))}return d}var m=i(0),n=i(1),o=i(0x1000000);function p(a){if(0!=a.h)return!1;for(let b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function q(a){return -1==a.h}function r(a){let b=a.g.length,c=[];for(let d=0;d<b;d++)c[d]=~a.g[d];return new f(c,~a.h).add(n)}function s(a,b){return a.add(r(b))}function t(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function u(a,b){this.g=a,this.h=b}function v(a,b){if(p(b))throw Error("division by zero");if(p(a))return new u(m,m);if(q(a))return b=v(r(a),b),new u(r(b.g),r(b.h));if(q(b))return b=v(a,r(b)),new u(r(b.g),b.h);if(a.g.length>30){if(q(a)||q(b))throw Error("slowDivide_ only works with positive integers.");for(var c=n,d=b;0>=d.l(a);)c=w(c),d=w(d);var e=x(c,1),f=x(d,1);for(d=x(d,2),c=x(c,2);!p(d);){var g=f.add(d);0>=g.l(a)&&(e=e.add(c),f=g),d=x(d,1),c=x(c,1)}return b=s(a,e.j(b)),new u(e,b)}for(e=m;a.l(b)>=0;){for(d=(d=Math.ceil(Math.log(c=Math.max(1,Math.floor(a.m()/b.m())))/Math.LN2))<=48?1:Math.pow(2,d-48),g=(f=j(c)).j(b);q(g)||g.l(a)>0;)c-=d,g=(f=j(c)).j(b);p(f)&&(f=n),e=e.add(f),a=s(a,g)}return new u(e,a)}function w(a){let b=a.g.length+1,c=[];for(let d=0;d<b;d++)c[d]=a.i(d)<<1|a.i(d-1)>>>31;return new f(c,a.h)}function x(a,b){let c=b>>5;b%=32;let d=a.g.length-c,e=[];for(let f=0;f<d;f++)e[f]=b>0?a.i(f+c)>>>b|a.i(f+c+1)<<32-b:a.i(f+c);return new f(e,a.h)}(g=f.prototype).m=function(){if(q(this))return-r(this).m();let a=0,b=1;for(let c=0;c<this.g.length;c++){let d=this.i(c);a+=(d>=0?d:0x100000000+d)*b,b*=0x100000000}return a},g.toString=function(a){if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if(p(this))return"0";if(q(this))return"-"+r(this).toString(a);let b=j(Math.pow(a,6));var c=this;let d="";for(;;){let e=v(c,b).g,f=(((c=s(c,e.j(b))).g.length>0?c.g[0]:c.h)>>>0).toString(a);if(p(c=e))return f+d;for(;f.length<6;)f="0"+f;d=f+d}},g.i=function(a){return a<0?0:a<this.g.length?this.g[a]:this.h},g.l=function(a){return q(a=s(this,a))?-1:+!p(a)},g.abs=function(){return q(this)?r(this):this},g.add=function(a){let b=Math.max(this.g.length,a.g.length),c=[],d=0;for(let e=0;e<=b;e++){let b=d+(65535&this.i(e))+(65535&a.i(e)),f=(b>>>16)+(this.i(e)>>>16)+(a.i(e)>>>16);d=f>>>16,b&=65535,f&=65535,c[e]=f<<16|b}return new f(c,-0x80000000&c[c.length-1]?-1:0)},g.j=function(a){if(p(this)||p(a))return m;if(q(this))return q(a)?r(this).j(r(a)):r(r(this).j(a));if(q(a))return r(this.j(r(a)));if(0>this.l(o)&&0>a.l(o))return j(this.m()*a.m());let b=this.g.length+a.g.length,c=[];for(var d=0;d<2*b;d++)c[d]=0;for(d=0;d<this.g.length;d++)for(let b=0;b<a.g.length;b++){let e=this.i(d)>>>16,f=65535&this.i(d),g=a.i(b)>>>16,h=65535&a.i(b);c[2*d+2*b]+=f*h,t(c,2*d+2*b),c[2*d+2*b+1]+=e*h,t(c,2*d+2*b+1),c[2*d+2*b+1]+=f*g,t(c,2*d+2*b+1),c[2*d+2*b+2]+=e*g,t(c,2*d+2*b+2)}for(a=0;a<b;a++)c[a]=c[2*a+1]<<16|c[2*a];for(a=b;a<2*b;a++)c[a]=0;return new f(c,0)},g.B=function(a){return v(this,a).h},g.and=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)&a.i(d);return new f(c,this.h&a.h)},g.or=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)|a.i(d);return new f(c,this.h|a.h)},g.xor=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)^a.i(d);return new f(c,this.h^a.h)},a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,c=k.Md5=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.B,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=j,f.fromString=l,b=k.Integer=f}).apply(void 0!==j?j:"u">typeof self?self:{});var l=a.i(14834),m=a.i(24361),n=a.i(54799),o=a.i(80304),p=a.i(67523);class q{constructor(a){this.uid=a}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}q.UNAUTHENTICATED=new q(null),q.GOOGLE_CREDENTIALS=new q("google-credentials-uid"),q.FIRST_PARTY=new q("first-party-uid"),q.MOCK_USER=new q("mock-user");let r="12.9.0";function s(a){r=a}function t(a){return(0,m.inspect)(a,{depth:100})}let u=new l.Logger("@firebase/firestore");function v(){return u.logLevel}function w(a){u.setLogLevel(a)}function x(a,...b){if(u.logLevel<=l.LogLevel.DEBUG){let c=b.map(A);u.debug(`Firestore (${r}): ${a}`,...c)}}function y(a,...b){if(u.logLevel<=l.LogLevel.ERROR){let c=b.map(A);u.error(`Firestore (${r}): ${a}`,...c)}}function z(a,...b){if(u.logLevel<=l.LogLevel.WARN){let c=b.map(A);u.warn(`Firestore (${r}): ${a}`,...c)}}function A(a){if("string"==typeof a)return a;try{return t(a)}catch(b){return a}}function B(a,b,c){let d="Unexpected state";"string"==typeof b?d=b:c=b,C(a,d,c)}function C(a,b,c){let d=`FIRESTORE (${r}) INTERNAL ASSERTION FAILED: ${b} (ID: ${a.toString(16)})`;if(void 0!==c)try{let a=JSON.stringify(c);d+=" CONTEXT: "+a}catch(a){d+=" CONTEXT: "+c}throw y(d),Error(d)}function D(a,b,c,d){let e="Unexpected state";"string"==typeof c?e=c:d=c,a||C(b,e,d)}function E(a,b){a||B(57014,b)}function F(a,b){return a}let G="ok",H="cancelled",I="unknown",J="invalid-argument",K="deadline-exceeded",L="not-found",M="already-exists",N="permission-denied",O="unauthenticated",P="resource-exhausted",Q="failed-precondition",R="aborted",S="out-of-range",T="unimplemented",U="internal",V="unavailable",W="data-loss";class X extends i.FirebaseError{constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Y{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}}class Z{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class ${getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(q.UNAUTHENTICATED))}shutdown(){}}class _{constructor(a){this.token=a,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(a,b){this.changeListener=b,a.enqueueRetryable(()=>b(this.token.user))}shutdown(){this.changeListener=null}}class aa{constructor(a){this.authProvider=a,this.currentUser=q.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(a,b){D(void 0===this.tokenListener,42304);let c=this.tokenCounter,d=a=>this.tokenCounter!==c?(c=this.tokenCounter,b(a)):Promise.resolve(),e=new Y;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),e.resolve(),e=new Y,a.enqueueRetryable(()=>d(this.currentUser))};let f=()=>{let b=e;a.enqueueRetryable(async()=>{await b.promise,await d(this.currentUser)})},g=a=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),f())};this.authProvider.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){let a=this.authProvider.getImmediate({optional:!0});a?g(a):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),e.resolve(),e=new Y)}},0),f()}getToken(){let a=this.tokenCounter,b=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(b).then(b=>this.tokenCounter!==a?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(D("string"==typeof b.accessToken,31837,{tokenData:b}),new Z(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let a=this.auth&&this.auth.getUid();return D(null===a||"string"==typeof a,2055,{currentUid:a}),new q(a)}}class ab{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c,this.type="FirstParty",this.user=q.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let a=this.getAuthToken();return a&&this._headers.set("Authorization",a),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class ac{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c}getToken(){return Promise.resolve(new ab(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(a,b){a.enqueueRetryable(()=>b(q.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ad{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ae{constructor(a,b){this.appCheckProvider=b,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,(0,h._isFirebaseServerApp)(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken)}start(a,b){D(void 0===this.tokenListener,3512);let c=a=>{null!=a.error&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);let c=a.token!==this.latestAppCheckToken;return this.latestAppCheckToken=a.token,x("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?b(a.token):Promise.resolve()};this.tokenListener=b=>{a.enqueueRetryable(()=>c(b))};let d=a=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(a=>d(a)),setTimeout(()=>{if(!this.appCheck){let a=this.appCheckProvider.getImmediate({optional:!0});a?d(a):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new ad(this.serverAppAppCheckToken));let a=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(a).then(a=>a?(D("string"==typeof a.token,44558,{tokenResult:a}),this.latestAppCheckToken=a.token,new ad(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}class af{getToken(){return Promise.resolve(new ad(""))}invalidateToken(){}start(a,b){}shutdown(){}}function ag(a){if(!a)return new $;switch(a.type){case"firstParty":return new ac(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new X(J,"makeAuthCredentialsProvider failed due to invalid credential type")}}function ah(a){return(0,n.randomBytes)(a)}class ai{static newId(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=Math.floor(256/a.length)*a.length,c="",d=20;for(;c.length<d;){let e=ah(40);for(let f=0;f<e.length;++f)c.length<d&&e[f]<b&&(c+=a.charAt(e[f]%a.length))}return c}}function aj(a,b){return a<b?-1:+(a>b)}function ak(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a.charAt(d),e=b.charAt(d);if(c!==e)return an(c)===an(e)?aj(c,e):an(c)?1:-1}return aj(a.length,b.length)}let al=55296,am=57343;function an(a){let b=a.charCodeAt(0);return b>=al&&b<=am}function ao(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function ap(a){return a+"\0"}let aq="__name__";class ar{constructor(a,b,c){void 0===b?b=0:b>a.length&&B(637,{offset:b,range:a.length}),void 0===c?c=a.length-b:c>a.length-b&&B(1746,{length:c,range:a.length-b}),this.segments=a,this.offset=b,this.len=c}get length(){return this.len}isEqual(a){return 0===ar.comparator(this,a)}child(a){let b=this.segments.slice(this.offset,this.limit());return a instanceof ar?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=void 0===a?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return 0===this.length}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=ar.compareSegments(a.get(d),b.get(d));if(0!==c)return c}return aj(a.length,b.length)}static compareSegments(a,b){let c=ar.isNumericId(a),d=ar.isNumericId(b);return c&&!d?-1:!c&&d?1:c&&d?ar.extractNumericId(a).compare(ar.extractNumericId(b)):ak(a,b)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return b.fromString(a.substring(4,a.length-2))}}class as extends ar{construct(a,b,c){return new as(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){let b=[];for(let c of a){if(c.indexOf("//")>=0)throw new X(J,`Invalid segment (${c}). Paths must not contain // in them.`);b.push(...c.split("/").filter(a=>a.length>0))}return new as(b)}static emptyPath(){return new as([])}}let at=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class au extends ar{construct(a,b,c){return new au(a,b,c)}static isValidIdentifier(a){return at.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),au.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===aq}static keyField(){return new au([aq])}static fromServerFormat(a){let b=[],c="",d=0,e=()=>{if(0===c.length)throw new X(J,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);b.push(c),c=""},f=!1;for(;d<a.length;){let b=a[d];if("\\"===b){if(d+1===a.length)throw new X(J,"Path has trailing escape character: "+a);let b=a[d+1];if("\\"!==b&&"."!==b&&"`"!==b)throw new X(J,"Path has invalid escape sequence: "+a);c+=b,d+=2}else"`"===b?f=!f:"."!==b||f?c+=b:e(),d++}if(e(),f)throw new X(J,"Unterminated ` in path: "+a);return new au(b)}static emptyPath(){return new au([])}}class av{constructor(a){this.path=a}static fromPath(a){return new av(as.fromString(a))}static fromName(a){return new av(as.fromString(a).popFirst(5))}static empty(){return new av(as.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return null!==a&&0===as.comparator(this.path,a.path)}toString(){return this.path.toString()}static comparator(a,b){return as.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new av(new as(a.slice()))}}function aw(a,b,c){if(!c)throw new X(J,`Function ${a}() cannot be called with an empty ${b}.`)}function ax(a,b,c,d){if(!0===b&&!0===d)throw new X(J,`${a} and ${c} cannot be used together.`)}function ay(a){if(!av.isDocumentKey(a))throw new X(J,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function az(a){if(av.isDocumentKey(a))throw new X(J,`Invalid collection reference. Collection references must have an odd number of segments, but ${a} has ${a.length}.`)}function aA(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a))}function aB(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"==typeof a)return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a)if(a instanceof Array)return"an array";else{let b=aC(a);return b?`a custom ${b} object`:"an object"}else if("function"==typeof a)return"a function";else return B(12329,{type:typeof a})}function aC(a){return a.constructor?a.constructor.name:null}function aD(a,b){if("_delegate"in a&&(a=a._delegate),!(a instanceof b))if(b.name===a.constructor.name)throw new X(J,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let c=aB(a);throw new X(J,`Expected type '${b.name}', but it was: ${c}`)}return a}function aE(a,b){if(b<=0)throw new X(J,`Function ${a}() requires a positive number, but it was: ${b}.`)}function aF(a,b){let c={typeString:a};return b&&(c.value=b),c}function aG(a,b){let c;if(!aA(a))throw new X(J,"JSON must be an object");for(let d in b)if(b[d]){let e=b[d].typeString,f="value"in b[d]?{value:b[d].value}:void 0;if(!(d in a)){c=`JSON missing required field: '${d}'`;break}let g=a[d];if(e&&typeof g!==e){c=`JSON field '${d}' must be a ${e}.`;break}if(void 0!==f&&g!==f.value){c=`Expected '${d}' field to equal '${f.value}'`;break}}if(c)throw new X(J,c);return!0}let aH=-0xe7791f700,aI=1e6;class aJ{static now(){return aJ.fromMillis(Date.now())}static fromDate(a){return aJ.fromMillis(a.getTime())}static fromMillis(a){let b=Math.floor(a/1e3),c=Math.floor((a-1e3*b)*aI);return new aJ(b,c)}constructor(a,b){if(this.seconds=a,this.nanoseconds=b,b<0||b>=1e9)throw new X(J,"Timestamp nanoseconds out of range: "+b);if(a<aH||a>=0x3afff44180)throw new X(J,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/aI}_compareTo(a){return this.seconds===a.seconds?aj(this.nanoseconds,a.nanoseconds):aj(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:aJ._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(aG(a,aJ._jsonSchema))return new aJ(a.seconds,a.nanoseconds)}valueOf(){return String(this.seconds-aH).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}aJ._jsonSchemaVersion="firestore/timestamp/1.0",aJ._jsonSchema={type:aF("string",aJ._jsonSchemaVersion),seconds:aF("number"),nanoseconds:aF("number")};class aK{static fromTimestamp(a){return new aK(a)}static min(){return new aK(new aJ(0,0))}static max(){return new aK(new aJ(0x3afff4417f,1e9-1))}constructor(a){this.timestamp=a}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let aL=-1,aM=0;class aN{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}}function aO(a){return a.fields.find(a=>2===a.kind)}function aP(a){return a.fields.filter(a=>2!==a.kind)}function aQ(a){let b=aP(a);return 0===b.length?0:b[b.length-1].kind}function aR(a,b){let c=aj(a.collectionGroup,b.collectionGroup);if(0!==c)return c;for(let d=0;d<Math.min(a.fields.length,b.fields.length);++d)if(0!==(c=aU(a.fields[d],b.fields[d])))return c;return aj(a.fields.length,b.fields.length)}function aS(a){return`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(a=>`${a.fieldPath}:${a.kind}`).join(",")}`}aN.UNKNOWN_ID=-1;class aT{constructor(a,b){this.fieldPath=a,this.kind=b}}function aU(a,b){let c=au.comparator(a.fieldPath,b.fieldPath);return 0!==c?c:aj(a.kind,b.kind)}class aV{constructor(a,b){this.sequenceNumber=a,this.offset=b}static empty(){return new aV(aM,aY.min())}}function aW(a,b){let c=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1;return new aY(aK.fromTimestamp(1e9===d?new aJ(c+1,0):new aJ(c,d)),av.empty(),b)}function aX(a){return new aY(a.readTime,a.key,aL)}class aY{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new aY(aK.min(),av.empty(),aL)}static max(){return new aY(aK.max(),av.empty(),aL)}}function aZ(a,b){let c=a.readTime.compareTo(b.readTime);return 0!==c||0!==(c=av.comparator(a.documentKey,b.documentKey))?c:aj(a.largestBatchId,b.largestBatchId)}let a$="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class a_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}}async function a0(a){if(a.code===Q&&a.message===a$)x("LocalStore","Unexpectedly lost primary lease");else throw a}class a1{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,b){return(this.callbackAttached&&B(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(b,this.error):this.wrapSuccess(a,this.result):new a1((c,d)=>{this.nextCallback=b=>{this.wrapSuccess(a,b).next(c,d)},this.catchCallback=a=>{this.wrapFailure(b,a).next(c,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{let b=a();if(b instanceof a1)return b;return a1.resolve(b)}catch(a){return a1.reject(a)}}wrapSuccess(a,b){return a?this.wrapUserFunction(()=>a(b)):a1.resolve(b)}wrapFailure(a,b){return a?this.wrapUserFunction(()=>a(b)):a1.reject(b)}static resolve(a){return new a1((b,c)=>{b(a)})}static reject(a){return new a1((b,c)=>{c(a)})}static waitFor(a){return new a1((b,c)=>{let d=0,e=0,f=!1;a.forEach(a=>{++d,a.next(()=>{++e,f&&e===d&&b()},a=>c(a))}),f=!0,e===d&&b()})}static or(a){let b=a1.resolve(!1);for(let c of a)b=b.next(a=>a?a1.resolve(a):c());return b}static forEach(a,b){let c=[];return a.forEach((a,d)=>{c.push(b.call(this,a,d))}),this.waitFor(c)}static mapArray(a,b){return new a1((c,d)=>{let e=a.length,f=Array(e),g=0;for(let h=0;h<e;h++){let i=h;b(a[i]).next(a=>{f[i]=a,++g===e&&c(f)},a=>d(a))}})}static doWhile(a,b){return new a1((c,d)=>{let e=()=>{!0===a()?b().next(()=>{e()},d):c()};e()})}}let a2="SimpleDb",a3=3;class a4{static open(a,b,c,d){try{return new a4(b,a.transaction(d,c))}catch(a){throw new a8(b,a)}}constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.completionDeferred=new Y,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{b.error?this.completionDeferred.reject(new a8(a,b.error)):this.completionDeferred.resolve()},this.transaction.onerror=b=>{let c=bd(b.target.error);this.completionDeferred.reject(new a8(a,c))}}get completionPromise(){return this.completionDeferred.promise}abort(a){a&&this.completionDeferred.reject(a),this.aborted||(x(a2,"Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let a=this.transaction;this.aborted||"function"!=typeof a.commit||a.commit()}store(a){return new ba(this.transaction.objectStore(a))}}class a5{static delete(a){return x(a2,"Removing database:",a),bb((0,i.getGlobal)().indexedDB.deleteDatabase(a)).toPromise()}static isAvailable(){if(!(0,i.isIndexedDBAvailable)())return!1;if(a5.isMockPersistence())return!0;let a=(0,i.getUA)(),b=a5.getIOSVersion(a),c=0<b&&b<10,d=a6(a),e=0<d&&d<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0)&&!c&&!e}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(a,b){return a.store(b)}static getIOSVersion(a){let b=a.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(b?b[1].split("_").slice(0,2).join("."):"-1")}constructor(a,b,c){this.name=a,this.version=b,this.schemaConverter=c,this.lastClosedDbVersion=null,12.2===a5.getIOSVersion((0,i.getUA)())&&y("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(a){return this.db||(x(a2,"Opening database:",this.name),this.db=await new Promise((b,c)=>{let d=indexedDB.open(this.name,this.version);d.onsuccess=a=>{b(a.target.result)},d.onblocked=()=>{c(new a8(a,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=b=>{let d=b.target.error;"VersionError"===d.name?c(new X(Q,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===d.name?c(new X(Q,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d)):c(new a8(a,d))},d.onupgradeneeded=a=>{x(a2,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);let b=a.target.result;this.schemaConverter.createOrUpgrade(b,d.transaction,a.oldVersion,this.version).next(()=>{x(a2,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=a=>this.versionchangelistener(a)),this.db}setVersionChangeListener(a){this.versionchangelistener=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,b,c,d){let e="readonly"===b,f=0;for(;;){++f;try{this.db=await this.ensureDb(a);let b=a4.open(this.db,a,e?"readonly":"readwrite",c),f=d(b).next(a=>(b.maybeCommit(),a)).catch(a=>(b.abort(a),a1.reject(a))).toPromise();return f.catch(()=>{}),await b.completionPromise,f}catch(c){let a=c,b="FirebaseError"!==a.name&&f<a3;if(x(a2,"Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}function a6(a){let b=a.match(/Android ([\d.]+)/i);return Number(b?b[1].split(".").slice(0,2).join("."):"-1")}class a7{constructor(a){this.dbCursor=a,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(a){this.dbCursor=a}done(){this.shouldStop=!0}skip(a){this.nextKey=a}delete(){return bb(this.dbCursor.delete())}}class a8 extends X{constructor(a,b){super(V,`IndexedDB transaction '${a}' failed: ${b}`),this.name="IndexedDbTransactionError"}}function a9(a){return"IndexedDbTransactionError"===a.name}class ba{constructor(a){this.store=a}put(a,b){let c;return void 0!==b?(x(a2,"PUT",this.store.name,a,b),c=this.store.put(b,a)):(x(a2,"PUT",this.store.name,"<auto-key>",a),c=this.store.put(a)),bb(c)}add(a){return x(a2,"ADD",this.store.name,a,a),bb(this.store.add(a))}get(a){return bb(this.store.get(a)).next(b=>(void 0===b&&(b=null),x(a2,"GET",this.store.name,a,b),b))}delete(a){return x(a2,"DELETE",this.store.name,a),bb(this.store.delete(a))}count(){return x(a2,"COUNT",this.store.name),bb(this.store.count())}loadAll(a,b){let c=this.options(a,b),d=c.index?this.store.index(c.index):this.store;if("function"==typeof d.getAll){let a=d.getAll(c.range);return new a1((b,c)=>{a.onerror=a=>{c(a.target.error)},a.onsuccess=a=>{b(a.target.result)}})}{let a=this.cursor(c),b=[];return this.iterateCursor(a,(a,c)=>{b.push(c)}).next(()=>b)}}loadFirst(a,b){let c=this.store.getAll(a,null===b?void 0:b);return new a1((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}deleteAll(a,b){x(a2,"DELETE ALL",this.store.name);let c=this.options(a,b);c.keysOnly=!1;let d=this.cursor(c);return this.iterateCursor(d,(a,b,c)=>c.delete())}iterate(a,b){let c;b?c=a:(c={},b=a);let d=this.cursor(c);return this.iterateCursor(d,b)}iterateSerial(a){let b=this.cursor({});return new a1((c,d)=>{b.onerror=a=>{d(bd(a.target.error))},b.onsuccess=b=>{let d=b.target.result;d?a(d.primaryKey,d.value).next(a=>{a?d.continue():c()}):c()}})}iterateCursor(a,b){let c=[];return new a1((d,e)=>{a.onerror=a=>{e(a.target.error)},a.onsuccess=a=>{let e=a.target.result;if(!e)return void d();let f=new a7(e),g=b(e.primaryKey,e.value,f);if(g instanceof a1){let a=g.catch(a=>(f.done(),a1.reject(a)));c.push(a)}f.isDone?d():null===f.skipToKey?e.continue():e.continue(f.skipToKey)}}).next(()=>a1.waitFor(c))}options(a,b){let c;return void 0!==a&&("string"==typeof a?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),!a.index)return this.store.openCursor(a.range,b);{let c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}}}function bb(a){return new a1((b,c)=>{a.onsuccess=a=>{b(a.target.result)},a.onerror=a=>{c(bd(a.target.error))}})}let bc=!1;function bd(a){let b=a5.getIOSVersion((0,i.getUA)());if(b>=12.2&&b<13){let b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){let a=new X("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return bc||(bc=!0,setTimeout(()=>{throw a},0)),a}}return a}let be="IndexBackfiller",bf=15e3,bg=6e4,bh=50;class bi{constructor(a,b){this.asyncQueue=a,this.backfiller=b,this.task=null}start(){this.schedule(bf)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(a){x(be,`Scheduled in ${a}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",a,async()=>{this.task=null;try{let a=await this.backfiller.backfill();x(be,`Documents written: ${a}`)}catch(a){a9(a)?x(be,"Ignoring IndexedDB error during index backfill: ",a):await a0(a)}await this.schedule(bg)})}}class bj{constructor(a,b){this.localStore=a,this.persistence=b}async backfill(a=bh){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",b=>this.writeIndexEntries(b,a))}writeIndexEntries(a,b){let c=new Set,d=b,e=!0;return a1.doWhile(()=>!0===e&&d>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(a).next(b=>{if(!(null===b||c.has(b)))return x(be,`Processing collection: ${b}`),this.writeEntriesForCollectionGroup(a,b,d).next(a=>{d-=a,c.add(b)});e=!1})).next(()=>b-d)}writeEntriesForCollectionGroup(a,b,c){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(a,b).next(d=>this.localStore.localDocuments.getNextDocuments(a,b,d,c).next(c=>{let e=c.changes;return this.localStore.indexManager.updateIndexEntries(a,e).next(()=>this.getNewOffset(d,c)).next(c=>(x(be,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(a,b,c))).next(()=>e.size)}))}getNewOffset(a,b){let c=a;return b.changes.forEach((a,b)=>{let d=aX(b);aZ(d,c)>0&&(c=d)}),new aY(c.readTime,c.documentKey,Math.max(b.batchId,a.largestBatchId))}}class bk{constructor(a,b){this.previousValue=a,b&&(b.sequenceNumberHandler=a=>this.setPreviousValue(a),this.writeNewSequenceNumber=a=>b.writeSequenceNumber(a))}setPreviousValue(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){let a=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(a),a}}bk.INVALID=-1;let bl="\x01",bm="\x01",bn="\x10",bo="\x11";function bp(a){let b="";for(let c=0;c<a.length;c++)b.length>0&&(b=br(b)),b=bq(a.get(c),b);return br(b)}function bq(a,b){let c=b,d=a.length;for(let b=0;b<d;b++){let d=a.charAt(b);switch(d){case"\0":c+=bl+bn;break;case bl:c+=bl+bo;break;default:c+=d}}return c}function br(a){return a+bl+bm}function bs(a){let b=a.length;if(D(b>=2,64408,{path:a}),2===b)return D(a.charAt(0)===bl&&a.charAt(1)===bm,56145,{path:a}),as.emptyPath();let c=b-2,d=[],e="";for(let f=0;f<b;){let b=a.indexOf(bl,f);switch((b<0||b>c)&&B(50515,{path:a}),a.charAt(b+1)){case bm:let g,h=a.substring(f,b);0===e.length?g=h:(e+=h,g=e,e=""),d.push(g);break;case bn:e+=a.substring(f,b),e+="\0";break;case bo:e+=a.substring(f,b+1);break;default:B(61167,{path:a})}f=b+2}return new as(d)}let bt="remoteDocuments",bu="owner",bv="owner",bw="mutationQueues",bx="userId",by="mutations",bz="batchId",bA="userMutationsIndex",bB=["userId","batchId"];function bC(a){return[a]}function bD(a,b){return[a,bp(b)]}function bE(a,b,c){return[a,bp(b),c]}let bF={},bG="documentMutations",bH="remoteDocumentsV14",bI=["prefixPath","collectionGroup","readTime","documentId"],bJ="documentKeyIndex",bK=["prefixPath","collectionGroup","documentId"],bL="collectionGroupIndex",bM=["collectionGroup","readTime","prefixPath","documentId"],bN="remoteDocumentGlobal",bO="remoteDocumentGlobalKey",bP="targets",bQ="targetId",bR="queryTargetsIndex",bS=["canonicalId","targetId"],bT="targetDocuments",bU=["targetId","path"],bV="documentTargetsIndex",bW=["path","targetId"],bX="targetGlobalKey",bY="targetGlobal",bZ="collectionParents",b$=["collectionId","parent"],b_="clientMetadata",b0="clientId",b1="bundles",b2="bundleId",b3="namedQueries",b4="name",b5="indexConfiguration",b6="indexId",b7="collectionGroupIndex",b8="collectionGroup",b9="indexState",ca=["indexId","uid"],cb="sequenceNumberIndex",cc=["uid","sequenceNumber"],cd="indexEntries",ce=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],cf="documentKeyIndex",cg=["indexId","uid","orderedDocumentKey"],ch="documentOverlays",ci=["userId","collectionPath","documentId"],cj="collectionPathOverlayIndex",ck=["userId","collectionPath","largestBatchId"],cl="collectionGroupOverlayIndex",cm=["userId","collectionGroup","largestBatchId"],cn="globals",co="name",cp=[bw,by,bG,bt,bP,bu,bY,bT,b_,bN,bZ,b1,b3],cq=[...cp,ch],cr=[bw,by,bG,bH,bP,bu,bY,bT,b_,bN,bZ,b1,b3,ch],cs=cr,ct=[...cs,b5,b9,cd],cu=ct,cv=[...ct,cn],cw=cv;function cx(a){return 18===a?cw:17===a?cv:16===a?cu:15===a?ct:14===a?cs:13===a?cr:12===a?cq:11===a?cp:void B(60245)}class cy extends a_{constructor(a,b){super(),this.simpleDbTransaction=a,this.currentSequenceNumber=b}}function cz(a,b){let c=F(a);return a5.getStore(c.simpleDbTransaction,b)}function cA(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function cB(a,b){for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function cC(a,b){let c=[];for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&c.push(b(a[d],d,a));return c}function cD(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}class cE{constructor(a,b){this.comparator=a,this.root=b||cG.EMPTY}insert(a,b){return new cE(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,cG.BLACK,null,null))}remove(a){return new cE(this.comparator,this.root.remove(a,this.comparator).copy(null,null,cG.BLACK,null,null))}get(a){let b=this.root;for(;!b.isEmpty();){let c=this.comparator(a,b.key);if(0===c)return b.value;c<0?b=b.left:c>0&&(b=b.right)}return null}indexOf(a){let b=0,c=this.root;for(;!c.isEmpty();){let d=this.comparator(a,c.key);if(0===d)return b+c.left.size;d<0?c=c.left:(b+=c.left.size+1,c=c.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){let a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new cF(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new cF(this.root,a,this.comparator,!1)}getReverseIterator(){return new cF(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new cF(this.root,a,this.comparator,!0)}}class cF{constructor(a,b,c,d){this.isReverse=d,this.nodeStack=[];let e=1;for(;!a.isEmpty();)if(e=b?c(a.key,b):1,b&&d&&(e*=-1),e<0)a=this.isReverse?a.left:a.right;else if(0===e){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left}getNext(){let a=this.nodeStack.pop(),b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}}class cG{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:cG.RED,this.left=null!=d?d:cG.EMPTY,this.right=null!=e?e:cG.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new cG(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp()}removeMin(){if(this.left.isEmpty())return cG.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),(a=a.copy(null,null,null,a.left.removeMin(),null)).fixUp()}remove(a,b){let c,d=this;if(0>b(a,d.key))d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(a,b),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),0===b(a,d.key))if(d.right.isEmpty())return cG.EMPTY;else c=d.right.min(),d=d.copy(c.key,c.value,null,null,d.right.removeMin());d=d.copy(null,null,null,null,d.right.remove(a,b))}return d.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight())).rotateLeft()).colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=(a=a.rotateRight()).colorFlip()),a}rotateLeft(){let a=this.copy(null,null,cG.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){let a=this.copy(null,null,cG.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw B(43730,{key:this.key,value:this.value});if(this.right.isRed())throw B(14113,{key:this.key,value:this.value});let a=this.left.check();if(a===this.right.check())return a+ +!this.isRed();throw B(27949)}}cG.EMPTY=null,cG.RED=!0,cG.BLACK=!1;class cH{constructor(){this.size=0}get key(){throw B(57766)}get value(){throw B(16141)}get color(){throw B(16727)}get left(){throw B(29726)}get right(){throw B(36894)}copy(a,b,c,d,e){return this}insert(a,b,c){return new cG(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}cG.EMPTY=new cH;class cI{constructor(a){this.comparator=a,this.data=new cE(this.comparator)}has(a){return null!==this.data.get(a)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,b){let c=this.data.getIteratorFrom(a[0]);for(;c.hasNext();){let d=c.getNext();if(this.comparator(d.key,a[1])>=0)return;b(d.key)}}forEachWhile(a,b){let c;for(c=void 0!==b?this.data.getIteratorFrom(b):this.data.getIterator();c.hasNext();)if(!a(c.getNext().key))return}firstAfterOrEqual(a){let b=this.data.getIteratorFrom(a);return b.hasNext()?b.getNext().key:null}getIterator(){return new cJ(this.data.getIterator())}getIteratorFrom(a){return new cJ(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(a){let b=this;return b.size<a.size&&(b=a,a=this),a.forEach(a=>{b=b.add(a)}),b}isEqual(a){if(!(a instanceof cI)||this.size!==a.size)return!1;let b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(0!==this.comparator(a,d))return!1}return!0}toArray(){let a=[];return this.forEach(b=>{a.push(b)}),a}toString(){let a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(a){let b=new cI(this.comparator);return b.data=a,b}}class cJ{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function cK(a,b,c,d,e){let f=a.getIterator(),g=b.getIterator(),h=cL(f),i=cL(g);for(;h||i;){let a=!1,b=!1;if(h&&i){let d=c(h,i);d<0?b=!0:d>0&&(a=!0)}else null!=h?b=!0:a=!0;a?(d(i),i=cL(g)):b?(e(h),h=cL(f)):(h=cL(f),i=cL(g))}}function cL(a){return a.hasNext()?a.getNext():void 0}class cM{constructor(a){this.fields=a,a.sort(au.comparator)}static empty(){return new cM([])}unionWith(a){let b=new cI(au.comparator);for(let a of this.fields)b=b.add(a);for(let c of a)b=b.add(c);return new cM(b.toArray())}covers(a){for(let b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return ao(this.fields,a.fields,(a,b)=>a.isEqual(b))}}function cN(a){return Buffer.from(a,"base64").toString("binary")}function cO(a){return Buffer.from(a,"binary").toString("base64")}function cP(){return!0}class cQ{constructor(a){this.binaryString=a}static fromBase64String(a){return new cQ(cN(a))}static fromUint8Array(a){return new cQ(cR(a))}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return cO(this.binaryString)}toUint8Array(){return cS(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return aj(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}function cR(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function cS(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}cQ.EMPTY_BYTE_STRING=new cQ("");let cT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cU(a){if(D(!!a,39018),"string"==typeof a){let b=0,c=cT.exec(a);if(D(!!c,46558,{timestamp:a}),c[1]){let a=c[1];b=Number(a=(a+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(a).getTime()/1e3),nanos:b}}return{seconds:cV(a.seconds),nanos:cV(a.nanos)}}function cV(a){return"number"==typeof a?a:"string"==typeof a?Number(a):0}function cW(a){return"string"==typeof a?cQ.fromBase64String(a):cQ.fromUint8Array(a)}let cX="server_timestamp",cY="__type__",cZ="__previous_value__",c$="__local_write_time__";function c_(a){return(a?.mapValue?.fields||{})[cY]?.stringValue===cX}function c0(a,b){let c={fields:{[cY]:{stringValue:cX},[c$]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&c_(b)&&(b=c1(b)),b&&(c.fields[cZ]=b),{mapValue:c}}function c1(a){let b=a.mapValue.fields[cZ];return c_(b)?c1(b):b}function c2(a){let b=cU(a.mapValue.fields[c$].timestampValue);return new aJ(b.seconds,b.nanos)}class c3{constructor(a,b,c,d,e,f,g,h,i,j,k){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.longPollingOptions=h,this.useFetchStreams=i,this.isUsingEmulator=j,this.apiKey=k}}let c4="(default)";class c5{constructor(a,b){this.projectId=a,this.database=b||c4}static empty(){return new c5("","")}get isDefaultDatabase(){return this.database===c4}isEqual(a){return a instanceof c5&&a.projectId===this.projectId&&a.database===this.database}}function c6(a,b){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new X(J,'"projectId" not provided in firebase.initializeApp.');return new c5(a.options.projectId,b)}let c7=-1;function c8(a){return null==a}function c9(a){return 0===a&&1/a==-1/0}function da(a){return"number"==typeof a&&Number.isInteger(a)&&!c9(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}let db="__type__",dc="__max__",dd={mapValue:{fields:{__type__:{stringValue:dc}}}},de="__vector__",df="value",dg={nullValue:"NULL_VALUE"};function dh(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?c_(a)?4:dU(a)?0x1fffffffffffff:dS(a)?10:11:B(28295,{value:a})}function di(a,b){if(a===b)return!0;let c=dh(a);if(c!==dh(b))return!1;switch(c){case 0:case 0x1fffffffffffff:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return c2(a).isEqual(c2(b));case 3:return dj(a,b);case 5:return a.stringValue===b.stringValue;case 6:return dl(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return dk(a,b);case 2:return dm(a,b);case 9:return ao(a.arrayValue.values||[],b.arrayValue.values||[],di);case 10:case 11:return dn(a,b);default:return B(52216,{left:a})}}function dj(a,b){if("string"==typeof a.timestampValue&&"string"==typeof b.timestampValue&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;let c=cU(a.timestampValue),d=cU(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}function dk(a,b){return cV(a.geoPointValue.latitude)===cV(b.geoPointValue.latitude)&&cV(a.geoPointValue.longitude)===cV(b.geoPointValue.longitude)}function dl(a,b){return cW(a.bytesValue).isEqual(cW(b.bytesValue))}function dm(a,b){if("integerValue"in a&&"integerValue"in b)return cV(a.integerValue)===cV(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){let c=cV(a.doubleValue),d=cV(b.doubleValue);return c===d?c9(c)===c9(d):isNaN(c)&&isNaN(d)}return!1}function dn(a,b){let c=a.mapValue.fields||{},d=b.mapValue.fields||{};if(cA(c)!==cA(d))return!1;for(let a in c)if(c.hasOwnProperty(a)&&(void 0===d[a]||!di(c[a],d[a])))return!1;return!0}function dp(a,b){return void 0!==(a.values||[]).find(a=>di(a,b))}function dq(a,b){if(a===b)return 0;let c=dh(a),d=dh(b);if(c!==d)return aj(c,d);switch(c){case 0:case 0x1fffffffffffff:return 0;case 1:return aj(a.booleanValue,b.booleanValue);case 2:return dr(a,b);case 3:return ds(a.timestampValue,b.timestampValue);case 4:return ds(c2(a),c2(b));case 5:return ak(a.stringValue,b.stringValue);case 6:return dv(a.bytesValue,b.bytesValue);case 7:return dt(a.referenceValue,b.referenceValue);case 8:return du(a.geoPointValue,b.geoPointValue);case 9:return dw(a.arrayValue,b.arrayValue);case 10:return dx(a.mapValue,b.mapValue);case 11:return dy(a.mapValue,b.mapValue);default:throw B(23264,{leftType:c})}}function dr(a,b){let c=cV(a.integerValue||a.doubleValue),d=cV(b.integerValue||b.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}function ds(a,b){if("string"==typeof a&&"string"==typeof b&&a.length===b.length)return aj(a,b);let c=cU(a),d=cU(b),e=aj(c.seconds,d.seconds);return 0!==e?e:aj(c.nanos,d.nanos)}function dt(a,b){let c=a.split("/"),d=b.split("/");for(let a=0;a<c.length&&a<d.length;a++){let b=aj(c[a],d[a]);if(0!==b)return b}return aj(c.length,d.length)}function du(a,b){let c=aj(cV(a.latitude),cV(b.latitude));return 0!==c?c:aj(cV(a.longitude),cV(b.longitude))}function dv(a,b){let c=cW(a),d=cW(b);return c.compareTo(d)}function dw(a,b){let c=a.values||[],d=b.values||[];for(let a=0;a<c.length&&a<d.length;++a){let b=dq(c[a],d[a]);if(b)return b}return aj(c.length,d.length)}function dx(a,b){let c=a.fields||{},d=b.fields||{},e=c[df]?.arrayValue,f=d[df]?.arrayValue,g=aj(e?.values?.length||0,f?.values?.length||0);return 0!==g?g:dw(e,f)}function dy(a,b){if(a===dd.mapValue&&b===dd.mapValue)return 0;if(a===dd.mapValue)return 1;if(b===dd.mapValue)return -1;let c=a.fields||{},d=Object.keys(c),e=b.fields||{},f=Object.keys(e);d.sort(),f.sort();for(let a=0;a<d.length&&a<f.length;++a){let b=ak(d[a],f[a]);if(0!==b)return b;let g=dq(c[d[a]],e[f[a]]);if(0!==g)return g}return aj(d.length,f.length)}function dz(a){return dA(a)}function dA(a){if("nullValue"in a)return"null";if("booleanValue"in a)return""+a.booleanValue;if("integerValue"in a)return""+a.integerValue;if("doubleValue"in a)return""+a.doubleValue;if("timestampValue"in a)return dC(a.timestampValue);else if("stringValue"in a)return a.stringValue;else if("bytesValue"in a)return dB(a.bytesValue);else if("referenceValue"in a)return dE(a.referenceValue);else if("geoPointValue"in a)return dD(a.geoPointValue);else if("arrayValue"in a)return dG(a.arrayValue);else if("mapValue"in a)return dF(a.mapValue);else return B(61005,{value:a})}function dB(a){return cW(a).toBase64()}function dC(a){let b=cU(a);return`time(${b.seconds},${b.nanos})`}function dD(a){return`geo(${a.latitude},${a.longitude})`}function dE(a){return av.fromName(a).toString()}function dF(a){let b=Object.keys(a.fields||{}).sort(),c="{",d=!0;for(let e of b)d?d=!1:c+=",",c+=`${e}:${dA(a.fields[e])}`;return c+"}"}function dG(a){let b="[",c=!0;for(let d of a.values||[])c?c=!1:b+=",",b+=dA(d);return b+"]"}function dH(a){switch(dh(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let b=c1(a);return b?16+dH(b):16;case 5:return 2*a.stringValue.length;case 6:return cW(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return dJ(a.arrayValue);case 10:case 11:return dI(a.mapValue);default:throw B(13486,{value:a})}}function dI(a){let b=0;return cB(a.fields,(a,c)=>{b+=a.length+dH(c)}),b}function dJ(a){return(a.values||[]).reduce((a,b)=>a+dH(b),0)}function dK(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function dL(a){return!!a&&"integerValue"in a}function dM(a){return!!a&&"doubleValue"in a}function dN(a){return dL(a)||dM(a)}function dO(a){return!!a&&"arrayValue"in a}function dP(a){return!!a&&"nullValue"in a}function dQ(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function dR(a){return!!a&&"mapValue"in a}function dS(a){return(a?.mapValue?.fields||{})[db]?.stringValue===de}function dT(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&"object"==typeof a.timestampValue)return{timestampValue:{...a.timestampValue}};if(a.mapValue){let b={mapValue:{fields:{}}};return cB(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=dT(c)),b}{if(!a.arrayValue)return{...a};let b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=dT(a.arrayValue.values[c]);return b}}function dU(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===dc}let dV={mapValue:{fields:{[db]:{stringValue:de},[df]:{arrayValue:{}}}}};function dW(a){if("nullValue"in a)return dg;if("booleanValue"in a)return{booleanValue:!1};if("integerValue"in a||"doubleValue"in a)return{doubleValue:NaN};if("timestampValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in a)return{stringValue:""};else if("bytesValue"in a)return{bytesValue:""};else if("referenceValue"in a)return dK(c5.empty(),av.empty());else if("geoPointValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in a)return{arrayValue:{}};else if(!("mapValue"in a))return B(35942,{value:a});else return dS(a)?dV:{mapValue:{}}}function dX(a){if("nullValue"in a)return{booleanValue:!1};if("booleanValue"in a)return{doubleValue:NaN};if("integerValue"in a||"doubleValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in a)return{stringValue:""};if("stringValue"in a)return{bytesValue:""};else if("bytesValue"in a)return dK(c5.empty(),av.empty());else if("referenceValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in a)return{arrayValue:{}};else if("arrayValue"in a)return dV;else if(!("mapValue"in a))return B(61959,{value:a});else return dS(a)?{mapValue:{}}:dd}function dY(a,b){let c=dq(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?-1:!a.inclusive&&b.inclusive?1:0}function dZ(a,b){let c=dq(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?1:!a.inclusive&&b.inclusive?-1:0}class d${constructor(a){this.value=a}static empty(){return new d$({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(!dR(b=(b.mapValue.fields||{})[a.get(c)]))return null;return(b=(b.mapValue.fields||{})[a.lastSegment()])||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=dT(b)}setAll(a){let b=au.emptyPath(),c={},d=[];a.forEach((a,e)=>{if(!b.isImmediateParentOf(e)){let a=this.getFieldsMap(b);this.applyChanges(a,c,d),c={},d=[],b=e.popLast()}a?c[e.lastSegment()]=dT(a):d.push(e.lastSegment())});let e=this.getFieldsMap(b);this.applyChanges(e,c,d)}delete(a){let b=this.field(a.popLast());dR(b)&&b.mapValue.fields&&delete b.mapValue.fields[a.lastSegment()]}isEqual(a){return di(this.value,a.value)}getFieldsMap(a){let b=this.value;b.mapValue.fields||(b.mapValue={fields:{}});for(let c=0;c<a.length;++c){let d=b.mapValue.fields[a.get(c)];dR(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},b.mapValue.fields[a.get(c)]=d),b=d}return b.mapValue.fields}applyChanges(a,b,c){for(let d of(cB(b,(b,c)=>a[b]=c),c))delete a[d]}clone(){return new d$(dT(this.value))}}function d_(a){let b=[];return cB(a.fields,(a,c)=>{let d=new au([a]);if(dR(c)){let a=d_(c.mapValue).fields;if(0===a.length)b.push(d);else for(let c of a)b.push(d.child(c))}else b.push(d)}),new cM(b)}class d0{constructor(a,b,c,d,e,f,g){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.createTime=e,this.data=f,this.documentState=g}static newInvalidDocument(a){return new d0(a,0,aK.min(),aK.min(),aK.min(),d$.empty(),0)}static newFoundDocument(a,b,c,d){return new d0(a,1,b,aK.min(),c,d,0)}static newNoDocument(a,b){return new d0(a,2,b,aK.min(),aK.min(),d$.empty(),0)}static newUnknownDocument(a,b){return new d0(a,3,b,aK.min(),aK.min(),d$.empty(),2)}convertToFoundDocument(a,b){return this.createTime.isEqual(aK.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=a),this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=d$.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=d$.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=aK.min(),this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(a){return a instanceof d0&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new d0(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function d1(a,b,c){let d=b.data.field(a),e=c.data.field(a);return null!==d&&null!==e?dq(d,e):B(42886)}class d2{constructor(a,b){this.position=a,this.inclusive=b}}function d3(a,b,c){let d=0;for(let e=0;e<a.position.length;e++){let f=b[e],g=a.position[e];if(d=f.field.isKeyField()?av.comparator(av.fromName(g.referenceValue),c.key):dq(g,c.data.field(f.field)),"desc"===f.dir&&(d*=-1),0!==d)break}return d}function d4(a,b,c){let d=d3(a,b,c);return a.inclusive?d>=0:d>0}function d5(a,b,c){let d=d3(a,b,c);return a.inclusive?d<=0:d<0}function d6(a,b){if(null===a)return null===b;if(null===b||a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!di(a.position[c],b.position[c]))return!1;return!0}class d7{constructor(a,b="asc"){this.field=a,this.dir=b}}function d8(a){return a.field.canonicalString()+a.dir}function d9(a){return`${a.field.canonicalString()} (${a.dir})`}function ea(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}class eb{}class ec extends eb{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(a,b,c){if(a.isKeyField())if("in"===b||"not-in"===b)return this.createKeyFieldInFilter(a,b,c);else return new eq(a,b,c);if("array-contains"===b)return new eu(a,c);if("in"===b)return new ev(a,c);if("not-in"===b)return new ew(a,c);if("array-contains-any"===b)return new ex(a,c);else return new ec(a,b,c)}static createKeyFieldInFilter(a,b,c){return"in"===b?new er(a,c):new es(a,c)}matches(a){let b=a.data.field(this.field);return"!="===this.op?null!==b&&void 0===b.nullValue&&this.matchesComparison(dq(b,this.value)):null!==b&&dh(this.value)===dh(b)&&this.matchesComparison(dq(b,this.value))}matchesComparison(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return 0===a;case"!=":return 0!==a;case">":return a>0;case">=":return a>=0;default:return B(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ed extends eb{constructor(a,b){super(),this.filters=a,this.op=b,this.memoizedFlattenedFilters=null}static create(a,b){return new ed(a,b)}matches(a){return ee(this)?void 0===this.filters.find(b=>!b.matches(a)):void 0!==this.filters.find(b=>b.matches(a))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((a,b)=>a.concat(b.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function ee(a){return"and"===a.op}function ef(a){return"or"===a.op}function eg(a){return eh(a)&&ee(a)}function eh(a){for(let b of a.filters)if(b instanceof ed)return!1;return!0}function ei(a){if(a instanceof ec)return a.field.canonicalString()+a.op.toString()+dz(a.value);{if(eg(a))return a.filters.map(a=>ei(a)).join(",");let b=a.filters.map(a=>ei(a)).join(",");return`${a.op}(${b})`}}function ej(a,b){return a instanceof ec?ek(a,b):a instanceof ed?el(a,b):void B(19439)}function ek(a,b){return b instanceof ec&&a.op===b.op&&a.field.isEqual(b.field)&&di(a.value,b.value)}function el(a,b){return b instanceof ed&&a.op===b.op&&a.filters.length===b.filters.length&&a.filters.reduce((a,c,d)=>a&&ej(c,b.filters[d]),!0)}function em(a,b){let c=a.filters.concat(b);return ed.create(c,a.op)}function en(a){return a instanceof ec?ep(a):a instanceof ed?eo(a):"Filter"}function eo(a){return a.op.toString()+" {"+a.getFilters().map(en).join(" ,")+"}"}function ep(a){return`${a.field.canonicalString()} ${a.op} ${dz(a.value)}`}class eq extends ec{constructor(a,b,c){super(a,b,c),this.key=av.fromName(c.referenceValue)}matches(a){let b=av.comparator(a.key,this.key);return this.matchesComparison(b)}}class er extends ec{constructor(a,b){super(a,"in",b),this.keys=et("in",b)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}}class es extends ec{constructor(a,b){super(a,"not-in",b),this.keys=et("not-in",b)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}}function et(a,b){return(b.arrayValue?.values||[]).map(a=>av.fromName(a.referenceValue))}class eu extends ec{constructor(a,b){super(a,"array-contains",b)}matches(a){let b=a.data.field(this.field);return dO(b)&&dp(b.arrayValue,this.value)}}class ev extends ec{constructor(a,b){super(a,"in",b)}matches(a){let b=a.data.field(this.field);return null!==b&&dp(this.value.arrayValue,b)}}class ew extends ec{constructor(a,b){super(a,"not-in",b)}matches(a){if(dp(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let b=a.data.field(this.field);return null!==b&&void 0===b.nullValue&&!dp(this.value.arrayValue,b)}}class ex extends ec{constructor(a,b){super(a,"array-contains-any",b)}matches(a){let b=a.data.field(this.field);return!!dO(b)&&!!b.arrayValue.values&&b.arrayValue.values.some(a=>dp(this.value.arrayValue,a))}}class ey{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.memoizedCanonicalId=null}}function ez(a,b=null,c=[],d=[],e=null,f=null,g=null){return new ey(a,b,c,d,e,f,g)}function eA(a){let b=F(a);if(null===b.memoizedCanonicalId){let a=b.path.canonicalString();null!==b.collectionGroup&&(a+="|cg:"+b.collectionGroup),a+="|f:",a+=b.filters.map(a=>ei(a)).join(","),a+="|ob:",a+=b.orderBy.map(a=>d8(a)).join(","),c8(b.limit)||(a+="|l:",a+=b.limit),b.startAt&&(a+="|lb:",a+=b.startAt.inclusive?"b:":"a:",a+=b.startAt.position.map(a=>dz(a)).join(",")),b.endAt&&(a+="|ub:",a+=b.endAt.inclusive?"a:":"b:",a+=b.endAt.position.map(a=>dz(a)).join(",")),b.memoizedCanonicalId=a}return b.memoizedCanonicalId}function eB(a){let b=a.path.canonicalString();return null!==a.collectionGroup&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(a=>en(a)).join(", ")}]`),c8(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>d9(a)).join(", ")}]`),a.startAt&&(b+=", startAt: ",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>dz(a)).join(",")),a.endAt&&(b+=", endAt: ",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>dz(a)).join(",")),`Target(${b})`}function eC(a,b){if(a.limit!==b.limit||a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!ea(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let c=0;c<a.filters.length;c++)if(!ej(a.filters[c],b.filters[c]))return!1;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!d6(a.startAt,b.startAt)&&d6(a.endAt,b.endAt)}function eD(a){return av.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function eE(a,b){return a.filters.filter(a=>a instanceof ec&&a.field.isEqual(b))}function eF(a,b){let c=aO(b);if(void 0===c)return null;for(let b of eE(a,c.fieldPath))switch(b.op){case"array-contains-any":return b.value.arrayValue.values||[];case"array-contains":return[b.value]}return null}function eG(a,b){let c=new Map;for(let d of aP(b))for(let b of eE(a,d.fieldPath))switch(b.op){case"==":case"in":c.set(d.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return c.set(d.fieldPath.canonicalString(),b.value),Array.from(c.values())}return null}function eH(a,b){let c=[],d=!0;for(let e of aP(b)){let b=0===e.kind?eJ(a,e.fieldPath,a.startAt):eK(a,e.fieldPath,a.startAt);c.push(b.value),d&&(d=b.inclusive)}return new d2(c,d)}function eI(a,b){let c=[],d=!0;for(let e of aP(b)){let b=0===e.kind?eK(a,e.fieldPath,a.endAt):eJ(a,e.fieldPath,a.endAt);c.push(b.value),d&&(d=b.inclusive)}return new d2(c,d)}function eJ(a,b,c){let d=dg,e=!0;for(let c of eE(a,b)){let a=dg,b=!0;switch(c.op){case"<":case"<=":a=dW(c.value);break;case"==":case"in":case">=":a=c.value;break;case">":a=c.value,b=!1;break;case"!=":case"not-in":a=dg}0>dY({value:d,inclusive:e},{value:a,inclusive:b})&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];0>dY({value:d,inclusive:e},{value:a,inclusive:c.inclusive})&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function eK(a,b,c){let d=dd,e=!0;for(let c of eE(a,b)){let a=dd,b=!0;switch(c.op){case">=":case">":a=dX(c.value),b=!1;break;case"==":case"in":case"<=":a=c.value;break;case"<":a=c.value,b=!1;break;case"!=":case"not-in":a=dd}dZ({value:d,inclusive:e},{value:a,inclusive:b})>0&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];dZ({value:d,inclusive:e},{value:a,inclusive:c.inclusive})>0&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function eL(a){let b=new cI(au.comparator),c=!1;for(let d of a.filters)for(let a of d.getFlattenedFilters())a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?c=!0:b=b.add(a.field));for(let c of a.orderBy)c.field.isKeyField()||(b=b.add(c.field));return b.size+ +!!c}function eM(a){return null!==a.limit}class eN{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function eO(a,b,c,d,e,f,g,h){return new eN(a,b,c,d,e,f,g,h)}function eP(a){return new eN(a)}function eQ(a,b){return new eN(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function eR(a){return 0===a.filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())}function eS(a){let b=new cI(au.comparator);return a.filters.forEach(a=>{a.getFlattenedFilters().forEach(a=>{a.isInequality()&&(b=b.add(a.field))})}),b}function eT(a){return new eN(as.emptyPath(),a)}function eU(a){return av.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function eV(a){return null!==a.collectionGroup}function eW(a){let b=F(a);if(null===b.memoizedNormalizedOrderBy){b.memoizedNormalizedOrderBy=[];let a=new Set;for(let c of b.explicitOrderBy)b.memoizedNormalizedOrderBy.push(c),a.add(c.field.canonicalString());let c=b.explicitOrderBy.length>0?b.explicitOrderBy[b.explicitOrderBy.length-1].dir:"asc";eS(b).forEach(d=>{a.has(d.canonicalString())||d.isKeyField()||b.memoizedNormalizedOrderBy.push(new d7(d,c))}),a.has(au.keyField().canonicalString())||b.memoizedNormalizedOrderBy.push(new d7(au.keyField(),c))}return b.memoizedNormalizedOrderBy}function eX(a){let b=F(a);return b.memoizedTarget||(b.memoizedTarget=eZ(b,eW(a))),b.memoizedTarget}function eY(a){let b=F(a);return b.memoizedAggregateTarget||(b.memoizedAggregateTarget=eZ(b,a.explicitOrderBy)),b.memoizedAggregateTarget}function eZ(a,b){if("F"===a.limitType)return ez(a.path,a.collectionGroup,b,a.filters,a.limit,a.startAt,a.endAt);{b=b.map(a=>{let b="desc"===a.dir?"asc":"desc";return new d7(a.field,b)});let c=a.endAt?new d2(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new d2(a.startAt.position,a.startAt.inclusive):null;return ez(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}}function e$(a,b){let c=a.filters.concat([b]);return new eN(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}function e_(a,b){let c=a.explicitOrderBy.concat([b]);return new eN(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function e0(a,b,c){return new eN(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function e1(a,b){return new eN(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,b,a.endAt)}function e2(a,b){return new eN(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,b)}function e3(a,b){return eC(eX(a),eX(b))&&a.limitType===b.limitType}function e4(a){return`${eA(eX(a))}|lt:${a.limitType}`}function e5(a){return`Query(target=${eB(eX(a))}; limitType=${a.limitType})`}function e6(a,b){return b.isFoundDocument()&&e7(a,b)&&e8(a,b)&&e9(a,b)&&fa(a,b)}function e7(a,b){let c=b.key.path;return null!==a.collectionGroup?b.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(c):av.isDocumentKey(a.path)?a.path.isEqual(c):a.path.isImmediateParentOf(c)}function e8(a,b){for(let c of eW(a))if(!c.field.isKeyField()&&null===b.data.field(c.field))return!1;return!0}function e9(a,b){for(let c of a.filters)if(!c.matches(b))return!1;return!0}function fa(a,b){return(!a.startAt||!!d5(a.startAt,eW(a),b))&&(!a.endAt||!!d4(a.endAt,eW(a),b))}function fb(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function fc(a){return(b,c)=>{let d=!1;for(let e of eW(a)){let a=fd(e,b,c);if(0!==a)return a;d=d||e.field.isKeyField()}return 0}}function fd(a,b,c){let d=a.field.isKeyField()?av.comparator(b.key,c.key):d1(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return -1*d;default:return B(19790,{direction:a.dir})}}class fe{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0!==c){for(let[b,d]of c)if(this.equalsFn(b,a))return d}}has(a){return void 0!==this.get(a)}set(a,b){let c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d){this.inner[c]=[[a,b]],this.innerSize++;return}for(let c=0;c<d.length;c++)if(this.equalsFn(d[c][0],a)){d[c]=[a,b];return}d.push([a,b]),this.innerSize++}delete(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],a))return 1===c.length?delete this.inner[b]:c.splice(d,1),this.innerSize--,!0;return!1}forEach(a){cB(this.inner,(b,c)=>{for(let[b,d]of c)a(b,d)})}isEmpty(){return cD(this.inner)}size(){return this.innerSize}}let ff=new cE(av.comparator);function fg(){return ff}let fh=new cE(av.comparator);function fi(...a){let b=fh;for(let c of a)b=b.insert(c.key,c);return b}function fj(){return fn()}function fk(a){let b=fh;return a.forEach((a,c)=>b=b.insert(a,c.overlayedDocument)),b}function fl(){return fn()}function fm(){return fn()}function fn(){return new fe(a=>a.toString(),(a,b)=>a.isEqual(b))}let fo=new cE(av.comparator);function fp(){return fo}let fq=new cI(av.comparator);function fr(...a){let b=fq;for(let c of a)b=b.add(c);return b}let fs=new cI(aj);function ft(){return fs}function fu(a,b){if(a.useProto3Json){if(isNaN(b))return{doubleValue:"NaN"};else if(b===1/0)return{doubleValue:"Infinity"};else if(b===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:c9(b)?"-0":b}}function fv(a){return{integerValue:""+a}}function fw(a,b){return da(b)?fv(b):fu(a,b)}class fx{constructor(){this._=void 0}}function fy(a,b,c){return a instanceof fC?c0(c,b):a instanceof fD?fE(a,b):a instanceof fF?fG(a,b):fI(a,b)}function fz(a,b,c){return a instanceof fD?fE(a,b):a instanceof fF?fG(a,b):c}function fA(a,b){return a instanceof fH?dN(b)?b:{integerValue:0}:null}function fB(a,b){return a instanceof fD&&b instanceof fD||a instanceof fF&&b instanceof fF?ao(a.elements,b.elements,di):a instanceof fH&&b instanceof fH?di(a.operand,b.operand):a instanceof fC&&b instanceof fC}class fC extends fx{}class fD extends fx{constructor(a){super(),this.elements=a}}function fE(a,b){let c=fK(b);for(let b of a.elements)c.some(a=>di(a,b))||c.push(b);return{arrayValue:{values:c}}}class fF extends fx{constructor(a){super(),this.elements=a}}function fG(a,b){let c=fK(b);for(let b of a.elements)c=c.filter(a=>!di(a,b));return{arrayValue:{values:c}}}class fH extends fx{constructor(a,b){super(),this.serializer=a,this.operand=b}}function fI(a,b){let c=fA(a,b),d=fJ(c)+fJ(a.operand);return dL(c)&&dL(a.operand)?fv(d):fu(a.serializer,d)}function fJ(a){return cV(a.integerValue||a.doubleValue)}function fK(a){return dO(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}class fL{constructor(a,b){this.field=a,this.transform=b}}function fM(a,b){return a.field.isEqual(b.field)&&fB(a.transform,b.transform)}function fN(a,b){return void 0===a&&void 0===b||!!a&&!!b&&ao(a,b,(a,b)=>fM(a,b))}class fO{constructor(a,b){this.version=a,this.transformResults=b}}class fP{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new fP}static exists(a){return new fP(void 0,a)}static updateTime(a){return new fP(a)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}}function fQ(a,b){return void 0!==a.updateTime?b.isFoundDocument()&&b.version.isEqual(a.updateTime):void 0===a.exists||a.exists===b.isFoundDocument()}class fR{}function fS(a,b){if(!a.hasLocalMutations||b&&0===b.fields.length)return null;if(null===b)if(a.isNoDocument())return new f4(a.key,fP.none());else return new fX(a.key,a.data,fP.none());{let c=a.data,d=d$.empty(),e=new cI(au.comparator);for(let a of b.fields)if(!e.has(a)){let b=c.field(a);null===b&&a.length>1&&(a=a.popLast(),b=c.field(a)),null===b?d.delete(a):d.set(a,b),e=e.add(a)}return new f$(a.key,d,new cM(e.toArray()),fP.none())}}function fT(a,b,c){a instanceof fX?fY(a,b,c):a instanceof f$?f_(a,b,c):f5(a,b,c)}function fU(a,b,c,d){return a instanceof fX?fZ(a,b,c,d):a instanceof f$?f0(a,b,c,d):f6(a,b,c)}function fV(a,b){let c=null;for(let d of a.fieldTransforms){let a=b.data.field(d.field),e=fA(d.transform,a||null);null!=e&&(null===c&&(c=d$.empty()),c.set(d.field,e))}return c||null}function fW(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!fN(a.fieldTransforms,b.fieldTransforms)&&(0===a.type?a.value.isEqual(b.value):1!==a.type||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}class fX extends fR{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}function fY(a,b,c){let d=a.value.clone(),e=f2(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}function fZ(a,b,c,d){if(!fQ(a.precondition,b))return c;let e=a.value.clone(),f=f3(a.fieldTransforms,d,b);return e.setAll(f),b.convertToFoundDocument(b.version,e).setHasLocalMutations(),null}class f$ extends fR{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}getFieldMask(){return this.fieldMask}}function f_(a,b,c){if(!fQ(a.precondition,b))return void b.convertToUnknownDocument(c.version);let d=f2(a.fieldTransforms,b,c.transformResults),e=b.data;e.setAll(f1(a)),e.setAll(d),b.convertToFoundDocument(c.version,e).setHasCommittedMutations()}function f0(a,b,c,d){if(!fQ(a.precondition,b))return c;let e=f3(a.fieldTransforms,d,b),f=b.data;return(f.setAll(f1(a)),f.setAll(e),b.convertToFoundDocument(b.version,f).setHasLocalMutations(),null===c)?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(a=>a.field))}function f1(a){let b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){let d=a.data.field(c);b.set(c,d)}}),b}function f2(a,b,c){let d=new Map;D(a.length===c.length,32656,{serverTransformResultCount:c.length,fieldTransformCount:a.length});for(let e=0;e<c.length;e++){let f=a[e],g=f.transform,h=b.data.field(f.field);d.set(f.field,fz(g,h,c[e]))}return d}function f3(a,b,c){let d=new Map;for(let e of a){let a=e.transform,f=c.data.field(e.field);d.set(e.field,fy(a,f,b))}return d}class f4 extends fR{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function f5(a,b,c){b.convertToNoDocument(c.version).setHasCommittedMutations()}function f6(a,b,c){return fQ(a.precondition,b)?(b.convertToNoDocument(b.version).setHasLocalMutations(),null):c}class f7 extends fR{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class f8{constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){let c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){let d=this.mutations[b];d.key.isEqual(a.key)&&fT(d,a,c[b])}}applyToLocalView(a,b){for(let c of this.baseMutations)c.key.isEqual(a.key)&&(b=fU(c,a,b,this.localWriteTime));for(let c of this.mutations)c.key.isEqual(a.key)&&(b=fU(c,a,b,this.localWriteTime));return b}applyToLocalDocumentSet(a,b){let c=fm();return this.mutations.forEach(d=>{let e=a.get(d.key),f=e.overlayedDocument,g=this.applyToLocalView(f,e.mutatedFields),h=fS(f,g=b.has(d.key)?null:g);null!==h&&c.set(d.key,h),f.isValidDocument()||f.convertToNoDocument(aK.min())}),c}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),fr())}isEqual(a){return this.batchId===a.batchId&&ao(this.mutations,a.mutations,(a,b)=>fW(a,b))&&ao(this.baseMutations,a.baseMutations,(a,b)=>fW(a,b))}}class f9{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,b,c){D(a.mutations.length===c.length,58842,{mutationsSent:a.mutations.length,resultsReceived:c.length});let d=fp(),e=a.mutations;for(let a=0;a<e.length;a++)d=d.insert(e[a].key,c[a].version);return new f9(a,b,c,d)}}class ga{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return null!==a&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class gb{constructor(a,b){this.count=a,this.unchangedNames=b}}function gc(a){switch(a){case G:return B(64938);case H:case I:case K:case P:case U:case V:case O:return!1;case J:case L:case M:case N:case Q:case R:case S:case T:case W:return!0;default:return B(15467,{code:a})}}function gd(a){return gc(a)&&a!==R}function ge(a){if(void 0===a)return y("GRPC error has no .code"),I;switch(a){case d.OK:return G;case d.CANCELLED:return H;case d.UNKNOWN:return I;case d.DEADLINE_EXCEEDED:return K;case d.RESOURCE_EXHAUSTED:return P;case d.INTERNAL:return U;case d.UNAVAILABLE:return V;case d.UNAUTHENTICATED:return O;case d.INVALID_ARGUMENT:return J;case d.NOT_FOUND:return L;case d.ALREADY_EXISTS:return M;case d.PERMISSION_DENIED:return N;case d.FAILED_PRECONDITION:return Q;case d.ABORTED:return R;case d.OUT_OF_RANGE:return S;case d.UNIMPLEMENTED:return T;case d.DATA_LOSS:return W;default:return B(39323,{code:a})}}!function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS"}(d||(d={}));class gf extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let gg=null;function gh(a){if(gg)throw Error("a TestingHooksSpi instance is already set");gg=a}function gi(){return new m.TextEncoder}function gj(){return new m.TextDecoder("utf-8")}let gk=new b([0xffffffff,0xffffffff],0);function gl(a){let b=gi().encode(a),d=new c;return d.update(b),new Uint8Array(d.digest())}function gm(a){let c=new DataView(a.buffer),d=c.getUint32(0,!0),e=c.getUint32(4,!0),f=c.getUint32(8,!0),g=c.getUint32(12,!0);return[new b([d,e],0),new b([f,g],0)]}class gn{constructor(a,c,d){if(this.bitmap=a,this.padding=c,this.hashCount=d,c<0||c>=8)throw new go(`Invalid padding: ${c}`);if(d<0||a.length>0&&0===this.hashCount)throw new go(`Invalid hash count: ${d}`);if(0===a.length&&0!==c)throw new go(`Invalid padding when bitmap length is 0: ${c}`);this.bitCount=8*a.length-c,this.bitCountInInteger=b.fromNumber(this.bitCount)}getBitIndex(a,c,d){let e=a.add(c.multiply(b.fromNumber(d)));return 1===e.compare(gk)&&(e=new b([e.getBits(0),e.getBits(1)],0)),e.modulo(this.bitCountInInteger).toNumber()}isBitSet(a){return(this.bitmap[Math.floor(a/8)]&1<<a%8)!=0}mightContain(a){if(0===this.bitCount)return!1;let[b,c]=gm(gl(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);if(!this.isBitSet(d))return!1}return!0}static create(a,b,c){let d=a%8==0?0:8-a%8,e=new gn(new Uint8Array(Math.ceil(a/8)),d,b);return c.forEach(a=>e.insert(a)),e}insert(a){if(0===this.bitCount)return;let[b,c]=gm(gl(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);this.setBit(d)}}setBit(a){let b=Math.floor(a/8),c=a%8;this.bitmap[b]|=1<<c}}class go extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class gp{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,b,c){let d=new Map;return d.set(a,gq.createSynthesizedTargetChangeForCurrentChange(a,b,c)),new gp(aK.min(),d,new cE(aj),fg(),fr())}}class gq{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(a,b,c){return new gq(c,b,fr(),fr(),fr())}}class gr{constructor(a,b,c,d){this.updatedTargetIds=a,this.removedTargetIds=b,this.key=c,this.newDoc=d}}class gs{constructor(a,b){this.targetId=a,this.existenceFilter=b}}class gt{constructor(a,b,c=cQ.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}}class gu{constructor(){this.pendingResponses=0,this.documentChanges=gy(),this._resumeToken=cQ.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(a){a.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=a)}toTargetChange(){let a=fr(),b=fr(),c=fr();return this.documentChanges.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:B(38017,{changeType:e})}}),new gq(this._resumeToken,this._current,a,b,c)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=gy()}addDocumentChange(a,b){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(a,b)}removeDocumentChange(a){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(a)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,D(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let gv="WatchChangeAggregator";class gw{constructor(a){this.metadataProvider=a,this.targetStates=new Map,this.pendingDocumentUpdates=fg(),this.pendingDocumentUpdatesByTarget=gx(),this.pendingDocumentTargetMapping=gx(),this.pendingTargetResets=new cE(aj)}handleDocumentChange(a){for(let b of a.updatedTargetIds)a.newDoc&&a.newDoc.isFoundDocument()?this.addDocumentToTarget(b,a.newDoc):this.removeDocumentFromTarget(b,a.key,a.newDoc);for(let b of a.removedTargetIds)this.removeDocumentFromTarget(b,a.key,a.newDoc)}handleTargetChange(a){this.forEachTarget(a,b=>{let c=this.ensureTargetState(b);switch(a.state){case 0:this.isActiveTarget(b)&&c.updateResumeToken(a.resumeToken);break;case 1:c.recordTargetResponse(),c.isPending||c.clearPendingChanges(),c.updateResumeToken(a.resumeToken);break;case 2:c.recordTargetResponse(),c.isPending||this.removeTarget(b);break;case 3:this.isActiveTarget(b)&&(c.markCurrent(),c.updateResumeToken(a.resumeToken));break;case 4:this.isActiveTarget(b)&&(this.resetTarget(b),c.updateResumeToken(a.resumeToken));break;default:B(56790,{state:a.state})}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.targetStates.forEach((a,c)=>{this.isActiveTarget(c)&&b(c)})}handleExistenceFilter(a){let b=a.targetId,c=a.existenceFilter.count,d=this.targetDataForActiveTarget(b);if(d){let e=d.target;if(eD(e))if(0===c){let a=new av(e.path);this.removeDocumentFromTarget(b,a,d0.newNoDocument(a,aK.min()))}else D(1===c,20013,{expectedCount:c});else{let d=this.getCurrentDocumentCountForTarget(b);if(d!==c){let c=this.parseBloomFilter(a),e=c?this.applyBloomFilter(c,a,d):1;if(0!==e){this.resetTarget(b);let a=2===e?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(b,a)}gg?.notifyOnExistenceFilterMismatch(gz(d,a.existenceFilter,this.metadataProvider.getDatabaseId(),c,e))}}}}parseBloomFilter(a){let b,c,d=a.existenceFilter.unchangedNames;if(!d||!d.bits)return null;let{bits:{bitmap:e="",padding:f=0},hashCount:g=0}=d;try{b=cW(e).toUint8Array()}catch(a){if(a instanceof gf)return z("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{c=new gn(b,f,g)}catch(a){return a instanceof go?z("BloomFilter error: ",a):z("Applying bloom filter failed: ",a),null}return 0===c.bitCount?null:c}applyBloomFilter(a,b,c){return 2*(b.existenceFilter.count!==c-this.filterRemovedDocuments(a,b.targetId))}filterRemovedDocuments(a,b){let c=this.metadataProvider.getRemoteKeysForTarget(b),d=0;return c.forEach(c=>{let e=this.metadataProvider.getDatabaseId(),f=`projects/${e.projectId}/databases/${e.database}/documents/${c.path.canonicalString()}`;!a.mightContain(f)&&(this.removeDocumentFromTarget(b,c,null),d++)}),d}createRemoteEvent(a){let b=new Map;this.targetStates.forEach((c,d)=>{let e=this.targetDataForActiveTarget(d);if(e){if(c.current&&eD(e.target)){let b=new av(e.target.path);this.ensureDocumentUpdateByTarget(b).has(d)||this.targetContainsDocument(d,b)||this.removeDocumentFromTarget(d,b,d0.newNoDocument(b,a))}c.hasPendingChanges&&(b.set(d,c.toTargetChange()),c.clearPendingChanges())}});let c=fr();this.pendingDocumentTargetMapping.forEach((a,b)=>{let d=!0;b.forEachWhile(a=>{let b=this.targetDataForActiveTarget(a);return!b||"TargetPurposeLimboResolution"===b.purpose||(d=!1,!1)}),d&&(c=c.add(a))}),this.pendingDocumentUpdates.forEach((b,c)=>c.setReadTime(a));let d=new gp(a,b,this.pendingTargetResets,this.pendingDocumentUpdates,c);return this.pendingDocumentUpdates=fg(),this.pendingDocumentUpdatesByTarget=gx(),this.pendingDocumentTargetMapping=gx(),this.pendingTargetResets=new cE(aj),d}addDocumentToTarget(a,b){if(!this.isActiveTarget(a))return;let c=2*!!this.targetContainsDocument(a,b.key);this.ensureTargetState(a).addDocumentChange(b.key,c),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b.key,b),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(b.key,this.ensureDocumentUpdateByTarget(b.key).add(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b.key,this.ensureDocumentTargetMapping(b.key).add(a))}removeDocumentFromTarget(a,b,c){if(!this.isActiveTarget(a))return;let d=this.ensureTargetState(a);this.targetContainsDocument(a,b)?d.addDocumentChange(b,1):d.removeDocumentChange(b),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).delete(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).add(a)),c&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b,c))}removeTarget(a){this.targetStates.delete(a)}getCurrentDocumentCountForTarget(a){let b=this.ensureTargetState(a).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}recordPendingTargetRequest(a){this.ensureTargetState(a).recordPendingTargetRequest()}ensureTargetState(a){let b=this.targetStates.get(a);return b||(b=new gu,this.targetStates.set(a,b)),b}ensureDocumentTargetMapping(a){let b=this.pendingDocumentTargetMapping.get(a);return b||(b=new cI(aj),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(a,b)),b}ensureDocumentUpdateByTarget(a){let b=this.pendingDocumentUpdatesByTarget.get(a);return b||(b=new cI(aj),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(a,b)),b}isActiveTarget(a){let b=null!==this.targetDataForActiveTarget(a);return b||x(gv,"Detected inactive target",a),b}targetDataForActiveTarget(a){let b=this.targetStates.get(a);return b&&b.isPending?null:this.metadataProvider.getTargetDataForTarget(a)}resetTarget(a){this.targetStates.set(a,new gu),this.metadataProvider.getRemoteKeysForTarget(a).forEach(b=>{this.removeDocumentFromTarget(a,b,null)})}targetContainsDocument(a,b){return this.metadataProvider.getRemoteKeysForTarget(a).has(b)}}function gx(){return new cE(av.comparator)}function gy(){return new cE(av.comparator)}function gz(a,b,c,d,e){let f={localCacheCount:a,existenceFilterCount:b.count,databaseId:c.database,projectId:c.projectId},g=b.unchangedNames;return g&&(f.bloomFilter={applied:0===e,hashCount:g?.hashCount??0,bitmapLength:g?.bits?.bitmap?.length??0,padding:g?.bits?.padding??0,mightContain:a=>d?.mightContain(a)??!1}),f}let gA=(()=>{let a={};return a.asc="ASCENDING",a.desc="DESCENDING",a})(),gB=(()=>{let a={};return a["<"]="LESS_THAN",a["<="]="LESS_THAN_OR_EQUAL",a[">"]="GREATER_THAN",a[">="]="GREATER_THAN_OR_EQUAL",a["=="]="EQUAL",a["!="]="NOT_EQUAL",a["array-contains"]="ARRAY_CONTAINS",a.in="IN",a["not-in"]="NOT_IN",a["array-contains-any"]="ARRAY_CONTAINS_ANY",a})(),gC=(()=>{let a={};return a.and="AND",a.or="OR",a})();function gD(a,b){}class gE{constructor(a,b){this.databaseId=a,this.useProto3Json=b}}function gF(a){return new X(void 0===a.code?I:ge(a.code),a.message||"")}function gG(a,b){return a.useProto3Json||c8(b)?b:{value:b}}function gH(a){let b;return c8(b="object"==typeof a?a.value:a)?null:b}function gI(a,b){if(!a.useProto3Json)return{seconds:""+b.seconds,nanos:b.nanoseconds};{let a=new Date(1e3*b.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),c=("000000000"+b.nanoseconds).slice(-9);return`${a}.${c}Z`}}function gJ(a){let b=cU(a);return new aJ(b.seconds,b.nanos)}function gK(a,b){return a.useProto3Json?b.toBase64():b.toUint8Array()}function gL(a,b){return a.useProto3Json?(D(void 0===b||"string"==typeof b,58123),cQ.fromBase64String(b||"")):(D(void 0===b||b instanceof Buffer||b instanceof Uint8Array,16193),cQ.fromUint8Array(b||new Uint8Array))}function gM(a,b){return gI(a,b.toTimestamp())}function gN(a){return D(!!a,49232),aK.fromTimestamp(gJ(a))}function gO(a,b){return gP(a,b).canonicalString()}function gP(a,b){let c=gW(a).child("documents");return void 0===b?c:c.child(b)}function gQ(a){let b=as.fromString(a);return D(hN(b),10190,{key:b.toString()}),b}function gR(a,b){return gO(a.databaseId,b.path)}function gS(a,b){let c=gQ(b);if(c.get(1)!==a.databaseId.projectId)throw new X(J,"Tried to deserialize key from different project: "+c.get(1)+" vs "+a.databaseId.projectId);if(c.get(3)!==a.databaseId.database)throw new X(J,"Tried to deserialize key from different database: "+c.get(3)+" vs "+a.databaseId.database);return new av(gX(c))}function gT(a,b){return gO(a.databaseId,b)}function gU(a){let b=gQ(a);return 4===b.length?as.emptyPath():gX(b)}function gV(a){return new as(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function gW(a){return new as(["projects",a.projectId,"databases",a.database])}function gX(a){return D(a.length>4&&"documents"===a.get(4),29091,{key:a.toString()}),a.popFirst(5)}function gY(a,b,c){return{name:gR(a,b),fields:c.value.mapValue.fields}}function gZ(a,b){return{name:gR(a,b.key),fields:b.data.value.mapValue.fields,updateTime:gI(a,b.version.toTimestamp()),createTime:gI(a,b.createTime.toTimestamp())}}function g$(a,b,c){let d=gS(a,b.name),e=gN(b.updateTime),f=b.createTime?gN(b.createTime):aK.min(),g=new d$({mapValue:{fields:b.fields}}),h=d0.newFoundDocument(d,e,f,g);return c&&h.setHasCommittedMutations(),c?h.setHasCommittedMutations():h}function g_(a,b){D(!!b.found,43571),gD(b.found.name),gD(b.found.updateTime);let c=gS(a,b.found.name),d=gN(b.found.updateTime),e=b.found.createTime?gN(b.found.createTime):aK.min(),f=new d$({mapValue:{fields:b.found.fields}});return d0.newFoundDocument(c,d,e,f)}function g0(a,b){D(!!b.missing,3894),D(!!b.readTime,22933);let c=gS(a,b.missing),d=gN(b.readTime);return d0.newNoDocument(c,d)}function g1(a,b){return"found"in b?g_(a,b):"missing"in b?g0(a,b):B(7234,{result:b})}function g2(a,b){let c;if("targetChange"in b){gD(b.targetChange);let d=g3(b.targetChange.targetChangeType||"NO_CHANGE"),e=b.targetChange.targetIds||[],f=gL(a,b.targetChange.resumeToken),g=b.targetChange.cause;c=new gt(d,e,f,g&&gF(g)||null)}else if("documentChange"in b){gD(b.documentChange);let d=b.documentChange;gD(d.document),gD(d.document.name),gD(d.document.updateTime);let e=gS(a,d.document.name),f=gN(d.document.updateTime),g=d.document.createTime?gN(d.document.createTime):aK.min(),h=new d$({mapValue:{fields:d.document.fields}}),i=d0.newFoundDocument(e,f,g,h);c=new gr(d.targetIds||[],d.removedTargetIds||[],i.key,i)}else if("documentDelete"in b){gD(b.documentDelete);let d=b.documentDelete;gD(d.document);let e=gS(a,d.document),f=d.readTime?gN(d.readTime):aK.min(),g=d0.newNoDocument(e,f);c=new gr([],d.removedTargetIds||[],g.key,g)}else if("documentRemove"in b){gD(b.documentRemove);let d=b.documentRemove;gD(d.document);let e=gS(a,d.document);c=new gr([],d.removedTargetIds||[],e,null)}else{if(!("filter"in b))return B(11601,{change:b});gD(b.filter);let a=b.filter;gD(a.targetId);let{count:d=0,unchangedNames:e}=a,f=new gb(d,e);c=new gs(a.targetId,f)}return c}function g3(a){if("NO_CHANGE"===a)return 0;if("ADD"===a)return 1;if("REMOVE"===a)return 2;if("CURRENT"===a)return 3;if("RESET"===a)return 4;else return B(39313,{state:a})}function g4(a){if(!("targetChange"in a))return aK.min();let b=a.targetChange;return b.targetIds&&b.targetIds.length||!b.readTime?aK.min():gN(b.readTime)}function g5(a,b){let c;if(b instanceof fX)c={update:gY(a,b.key,b.value)};else if(b instanceof f4)c={delete:gR(a,b.key)};else if(b instanceof f$)c={update:gY(a,b.key,b.data),updateMask:hL(b.fieldMask)};else{if(!(b instanceof f7))return B(16599,{mutationType:b.type});c={verify:gR(a,b.key)}}return b.fieldTransforms.length>0&&(c.updateTransforms=b.fieldTransforms.map(b=>hb(a,b))),b.precondition.isNone||(c.currentDocument=g7(a,b.precondition)),c}function g6(a,b){let c=b.currentDocument?g8(b.currentDocument):fP.none(),d=b.updateTransforms?b.updateTransforms.map(b=>hc(a,b)):[];if(b.update){gD(b.update.name);let e=gS(a,b.update.name),f=new d$({mapValue:{fields:b.update.fields}});return b.updateMask?new f$(e,f,hM(b.updateMask),c,d):new fX(e,f,c,d)}return b.delete?new f4(gS(a,b.delete),c):b.verify?new f7(gS(a,b.verify),c):B(1463,{proto:b})}function g7(a,b){return void 0!==b.updateTime?{updateTime:gM(a,b.updateTime)}:void 0!==b.exists?{exists:b.exists}:B(27497)}function g8(a){return void 0!==a.updateTime?fP.updateTime(gN(a.updateTime)):void 0!==a.exists?fP.exists(a.exists):fP.none()}function g9(a,b){let c=a.updateTime?gN(a.updateTime):gN(b);return c.isEqual(aK.min())&&(c=gN(b)),new fO(c,a.transformResults||[])}function ha(a,b){return a&&a.length>0?(D(void 0!==b,14353),a.map(a=>g9(a,b))):[]}function hb(a,b){let c=b.transform;if(c instanceof fC)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof fD)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof fF)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof fH)return{fieldPath:b.field.canonicalString(),increment:c.operand};throw B(20930,{transform:b.transform})}function hc(a,b){let c=null;return"setToServerValue"in b?(D("REQUEST_TIME"===b.setToServerValue,16630,{proto:b}),c=new fC):"appendMissingElements"in b?c=new fD(b.appendMissingElements.values||[]):"removeAllFromArray"in b?c=new fF(b.removeAllFromArray.values||[]):"increment"in b?c=new fH(a,b.increment):B(16584,{proto:b}),new fL(au.fromServerFormat(b.fieldPath),c)}function hd(a,b){return{documents:[gT(a,b.path)]}}function he(a){let b=a.documents.length;return D(1===b,1966,{count:b}),eX(eP(gU(a.documents[0])))}function hf(a,b){let c,d={structuredQuery:{}},e=b.path;null!==b.collectionGroup?(c=e,d.structuredQuery.from=[{collectionId:b.collectionGroup,allDescendants:!0}]):(c=e.popLast(),d.structuredQuery.from=[{collectionId:e.lastSegment()}]),d.parent=gT(a,c);let f=hm(b.filters);f&&(d.structuredQuery.where=f);let g=hp(b.orderBy);g&&(d.structuredQuery.orderBy=g);let h=gG(a,b.limit);return null!==h&&(d.structuredQuery.limit=h),b.startAt&&(d.structuredQuery.startAt=hr(b.startAt)),b.endAt&&(d.structuredQuery.endAt=hs(b.endAt)),{queryTarget:d,parent:c}}function hg(a,b,c,d){let{queryTarget:e,parent:f}=hf(a,b),g={},h=[],i=0;return c.forEach(a=>{let b=d?a.alias:`aggregate_${i++}`;g[b]=a.alias,"count"===a.aggregateType?h.push({alias:b,count:{}}):"avg"===a.aggregateType?h.push({alias:b,avg:{field:hB(a.fieldPath)}}):"sum"===a.aggregateType&&h.push({alias:b,sum:{field:hB(a.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:e.structuredQuery},parent:e.parent},aliasMap:g,parent:f}}function hh(a){let b=gU(a.parent),c=a.structuredQuery,d=c.from?c.from.length:0,e=null;if(d>0){D(1===d,65062);let a=c.from[0];a.allDescendants?e=a.collectionId:b=b.child(a.collectionId)}let f=[];c.where&&(f=hn(c.where));let g=[];c.orderBy&&(g=hq(c.orderBy));let h=null;c.limit&&(h=gH(c.limit));let i=null;c.startAt&&(i=ht(c.startAt));let j=null;return c.endAt&&(j=hu(c.endAt)),eO(b,e,g,f,h,"F",i,j)}function hi(a){return eX(hh(a))}function hj(a,b){let c=hk(b.purpose);return null==c?null:{"goog-listen-tags":c}}function hk(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B(28987,{purpose:a})}}function hl(a,b){let c,d=b.target;if((c=eD(d)?{documents:hd(a,d)}:{query:hf(a,d).queryTarget}).targetId=b.targetId,b.resumeToken.approximateByteSize()>0){c.resumeToken=gK(a,b.resumeToken);let d=gG(a,b.expectedCount);null!==d&&(c.expectedCount=d)}else if(b.snapshotVersion.compareTo(aK.min())>0){c.readTime=gI(a,b.snapshotVersion.toTimestamp());let d=gG(a,b.expectedCount);null!==d&&(c.expectedCount=d)}return c}function hm(a){if(0!==a.length)return hF(ed.create(a,"and"))}function hn(a){let b=ho(a);return b instanceof ed&&eg(b)?b.getFilters():[b]}function ho(a){return void 0!==a.unaryFilter?hI(a):void 0!==a.fieldFilter?hJ(a):void 0!==a.compositeFilter?hK(a):B(30097,{filter:a})}function hp(a){if(0!==a.length)return a.map(a=>hD(a))}function hq(a){return a.map(a=>hE(a))}function hr(a){return{before:a.inclusive,values:a.position}}function hs(a){return{before:!a.inclusive,values:a.position}}function ht(a){let b=!!a.before;return new d2(a.values||[],b)}function hu(a){let b=!a.before;return new d2(a.values||[],b)}function hv(a){return gA[a]}function hw(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function hx(a){return gB[a]}function hy(a){return gC[a]}function hz(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B(58110);default:return B(50506)}}function hA(a){switch(a){case"AND":return"and";case"OR":return"or";default:return B(1026)}}function hB(a){return{fieldPath:a.canonicalString()}}function hC(a){return au.fromServerFormat(a.fieldPath)}function hD(a){return{field:hB(a.field),direction:hv(a.dir)}}function hE(a){return new d7(hC(a.field),hw(a.direction))}function hF(a){return a instanceof ec?hH(a):a instanceof ed?hG(a):B(54877,{filter:a})}function hG(a){let b=a.getFilters().map(a=>hF(a));return 1===b.length?b[0]:{compositeFilter:{op:hy(a.op),filters:b}}}function hH(a){if("=="===a.op){if(dQ(a.value))return{unaryFilter:{field:hB(a.field),op:"IS_NAN"}};else if(dP(a.value))return{unaryFilter:{field:hB(a.field),op:"IS_NULL"}}}else if("!="===a.op){if(dQ(a.value))return{unaryFilter:{field:hB(a.field),op:"IS_NOT_NAN"}};else if(dP(a.value))return{unaryFilter:{field:hB(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hB(a.field),op:hx(a.op),value:a.value}}}function hI(a){switch(a.unaryFilter.op){case"IS_NAN":let b=hC(a.unaryFilter.field);return ec.create(b,"==",{doubleValue:NaN});case"IS_NULL":let c=hC(a.unaryFilter.field);return ec.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let d=hC(a.unaryFilter.field);return ec.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let e=hC(a.unaryFilter.field);return ec.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B(61313);default:return B(60726)}}function hJ(a){return ec.create(hC(a.fieldFilter.field),hz(a.fieldFilter.op),a.fieldFilter.value)}function hK(a){return ed.create(a.compositeFilter.filters.map(a=>ho(a)),hA(a.compositeFilter.op))}function hL(a){let b=[];return a.fields.forEach(a=>b.push(a.canonicalString())),{fieldPaths:b}}function hM(a){return new cM((a.fieldPaths||[]).map(a=>au.fromServerFormat(a)))}function hN(a){return a.length>=4&&"projects"===a.get(0)&&"databases"===a.get(2)}function hO(a){return!!a&&"function"==typeof a._toProto&&"ProtoValue"===a._protoValueType}class hP{constructor(a,b,c,d,e=aK.min(),f=aK.min(),g=cQ.EMPTY_BYTE_STRING,h=null){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g,this.expectedCount=h}withSequenceNumber(a){return new hP(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(a,b){return new hP(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a,null)}withExpectedCount(a){return new hP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,a)}withLastLimboFreeSnapshotVersion(a){return new hP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken,this.expectedCount)}}class hQ{constructor(a){this.remoteSerializer=a}}function hR(a,b){let c;if(b.document)c=g$(a.remoteSerializer,b.document,!!b.hasCommittedMutations);else if(b.noDocument){let a=av.fromSegments(b.noDocument.path),d=hW(b.noDocument.readTime);c=d0.newNoDocument(a,d),b.hasCommittedMutations&&c.setHasCommittedMutations()}else{if(!b.unknownDocument)return B(56709);let a=av.fromSegments(b.unknownDocument.path),d=hW(b.unknownDocument.version);c=d0.newUnknownDocument(a,d)}return b.readTime&&c.setReadTime(hU(b.readTime)),c}function hS(a,b){let c=b.key,d={prefixPath:c.getCollectionPath().popLast().toArray(),collectionGroup:c.collectionGroup,documentId:c.path.lastSegment(),readTime:hT(b.readTime),hasCommittedMutations:b.hasCommittedMutations};if(b.isFoundDocument())d.document=gZ(a.remoteSerializer,b);else if(b.isNoDocument())d.noDocument={path:c.path.toArray(),readTime:hV(b.version)};else{if(!b.isUnknownDocument())return B(57904,{document:b});d.unknownDocument={path:c.path.toArray(),version:hV(b.version)}}return d}function hT(a){let b=a.toTimestamp();return[b.seconds,b.nanoseconds]}function hU(a){let b=new aJ(a[0],a[1]);return aK.fromTimestamp(b)}function hV(a){let b=a.toTimestamp();return{seconds:b.seconds,nanoseconds:b.nanoseconds}}function hW(a){let b=new aJ(a.seconds,a.nanoseconds);return aK.fromTimestamp(b)}function hX(a,b,c){let d=c.baseMutations.map(b=>g5(a.remoteSerializer,b)),e=c.mutations.map(b=>g5(a.remoteSerializer,b));return{userId:b,batchId:c.batchId,localWriteTimeMs:c.localWriteTime.toMillis(),baseMutations:d,mutations:e}}function hY(a,b){let c=(b.baseMutations||[]).map(b=>g6(a.remoteSerializer,b));for(let a=0;a<b.mutations.length-1;++a){let c=b.mutations[a];a+1<b.mutations.length&&void 0!==b.mutations[a+1].transform&&(c.updateTransforms=b.mutations[a+1].transform.fieldTransforms,b.mutations.splice(a+1,1),++a)}let d=b.mutations.map(b=>g6(a.remoteSerializer,b)),e=aJ.fromMillis(b.localWriteTimeMs);return new f8(b.batchId,e,c,d)}function hZ(a){let b,c=hW(a.readTime),d=void 0!==a.lastLimboFreeSnapshotVersion?hW(a.lastLimboFreeSnapshotVersion):aK.min();return new hP(b=h_(a.query)?he(a.query):hi(a.query),a.targetId,"TargetPurposeListen",a.lastListenSequenceNumber,c,d,cQ.fromBase64String(a.resumeToken))}function h$(a,b){let c,d=hV(b.snapshotVersion),e=hV(b.lastLimboFreeSnapshotVersion);c=eD(b.target)?hd(a.remoteSerializer,b.target):hf(a.remoteSerializer,b.target).queryTarget;let f=b.resumeToken.toBase64();return{targetId:b.targetId,canonicalId:eA(b.target),readTime:d,resumeToken:f,lastListenSequenceNumber:b.sequenceNumber,lastLimboFreeSnapshotVersion:e,query:c}}function h_(a){return void 0!==a.documents}function h0(a){return{id:a.bundleId,createTime:hW(a.createTime),version:a.version}}function h1(a){return{bundleId:a.id,createTime:hV(gN(a.createTime)),version:a.version}}function h2(a){return{name:a.name,query:h4(a.bundledQuery),readTime:hW(a.readTime)}}function h3(a){return{name:a.name,readTime:hV(gN(a.readTime)),bundledQuery:a.bundledQuery}}function h4(a){let b=hh({parent:a.parent,structuredQuery:a.structuredQuery});return"LAST"===a.limitType?e0(b,b.limit,"L"):b}function h5(a){return{name:a.name,query:h4(a.bundledQuery),readTime:gN(a.readTime)}}function h6(a){return{id:a.id,version:a.version,createTime:gN(a.createTime)}}function h7(a,b){return new ga(b.largestBatchId,g6(a.remoteSerializer,b.overlayMutation))}function h8(a,b,c){let[d,e,f]=h9(b,c.mutation.key);return{userId:b,collectionPath:e,documentId:f,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:g5(a.remoteSerializer,c.mutation)}}function h9(a,b){let c=b.path.lastSegment();return[a,bp(b.path.popLast()),c]}function ia(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}function ib(a,b){let c=b?new aV(b.sequenceNumber,new aY(hW(b.readTime),new av(bs(b.documentKey)),b.largestBatchId)):aV.empty(),d=a.fields.map(([a,b])=>new aT(au.fromServerFormat(a),b));return new aN(a.indexId,a.collectionGroup,d,c)}function ic(a,b,c,d){return{indexId:a,uid:b,sequenceNumber:c,readTime:hV(d.readTime),documentKey:bp(d.documentKey.path),largestBatchId:d.largestBatchId}}class id{getBundleMetadata(a,b){return ie(a).get(b).next(a=>{if(a)return h0(a)})}saveBundleMetadata(a,b){return ie(a).put(h1(b))}getNamedQuery(a,b){return ig(a).get(b).next(a=>{if(a)return h2(a)})}saveNamedQuery(a,b){return ig(a).put(h3(b))}}function ie(a){return cz(a,b1)}function ig(a){return cz(a,b3)}class ih{constructor(a,b){this.serializer=a,this.userId=b}static forUser(a,b){return new ih(a,b.uid||"")}getOverlay(a,b){return ii(a).get(h9(this.userId,b)).next(a=>a?h7(this.serializer,a):null)}getOverlays(a,b){let c=fl();return a1.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){let d=[];return c.forEach((c,e)=>{let f=new ga(b,e);d.push(this.saveOverlay(a,f))}),a1.waitFor(d)}removeOverlaysForBatchId(a,b,c){let d=new Set;b.forEach(a=>d.add(bp(a.getCollectionPath())));let e=[];return d.forEach(b=>{let d=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,c+1],!1,!0);e.push(ii(a).deleteAll(cj,d))}),a1.waitFor(e)}getOverlaysForCollection(a,b,c){let d=fl(),e=bp(b),f=IDBKeyRange.bound([this.userId,e,c],[this.userId,e,1/0],!0);return ii(a).loadAll(cj,f).next(a=>{for(let b of a){let a=h7(this.serializer,b);d.set(a.getKey(),a)}return d})}getOverlaysForCollectionGroup(a,b,c,d){let e,f=fl(),g=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,1/0],!0);return ii(a).iterate({index:cl,range:g},(a,b,c)=>{let g=h7(this.serializer,b);f.size()<d||g.largestBatchId===e?(f.set(g.getKey(),g),e=g.largestBatchId):c.done()}).next(()=>f)}saveOverlay(a,b){return ii(a).put(h8(this.serializer,this.userId,b))}}function ii(a){return cz(a,ch)}class ij{globalsStore(a){return cz(a,cn)}getSessionToken(a){return this.globalsStore(a).get("sessionToken").next(a=>{let b=a?.value;return b?cQ.fromUint8Array(b):cQ.EMPTY_BYTE_STRING})}setSessionToken(a,b){return this.globalsStore(a).put({name:"sessionToken",value:b.toUint8Array()})}}let ik=5,il=10,im=13,io=15,ip=20,iq=25,ir=30,is=37,it=45,iu=50,iv=53,iw=55,ix=60,iy=2;class iz{writeIndexValue(a,b){this.writeIndexValueAux(a,b),b.writeInfinity()}writeIndexValueAux(a,b){if("nullValue"in a)this.writeValueTypeLabel(b,ik);else if("booleanValue"in a)this.writeValueTypeLabel(b,il),b.writeNumber(+!!a.booleanValue);else if("integerValue"in a)this.writeValueTypeLabel(b,io),b.writeNumber(cV(a.integerValue));else if("doubleValue"in a){let c=cV(a.doubleValue);isNaN(c)?this.writeValueTypeLabel(b,im):(this.writeValueTypeLabel(b,io),c9(c)?b.writeNumber(0):b.writeNumber(c))}else if("timestampValue"in a){let c=a.timestampValue;this.writeValueTypeLabel(b,ip),"string"==typeof c&&(c=cU(c)),b.writeString(`${c.seconds||""}`),b.writeNumber(c.nanos||0)}else if("stringValue"in a)this.writeIndexString(a.stringValue,b),this.writeTruncationMarker(b);else if("bytesValue"in a)this.writeValueTypeLabel(b,ir),b.writeBytes(cW(a.bytesValue)),this.writeTruncationMarker(b);else if("referenceValue"in a)this.writeIndexEntityRef(a.referenceValue,b);else if("geoPointValue"in a){let c=a.geoPointValue;this.writeValueTypeLabel(b,it),b.writeNumber(c.latitude||0),b.writeNumber(c.longitude||0)}else"mapValue"in a?dU(a)?this.writeValueTypeLabel(b,Number.MAX_SAFE_INTEGER):dS(a)?this.writeIndexVector(a.mapValue,b):(this.writeIndexMap(a.mapValue,b),this.writeTruncationMarker(b)):"arrayValue"in a?(this.writeIndexArray(a.arrayValue,b),this.writeTruncationMarker(b)):B(19022,{indexValue:a})}writeIndexString(a,b){this.writeValueTypeLabel(b,iq),this.writeUnlabeledIndexString(a,b)}writeUnlabeledIndexString(a,b){b.writeString(a)}writeIndexMap(a,b){let c=a.fields||{};for(let a of(this.writeValueTypeLabel(b,iw),Object.keys(c)))this.writeIndexString(a,b),this.writeIndexValueAux(c[a],b)}writeIndexVector(a,b){let c=a.fields||{};this.writeValueTypeLabel(b,iv);let d=df,e=c[d].arrayValue?.values?.length||0;this.writeValueTypeLabel(b,io),b.writeNumber(cV(e)),this.writeIndexString(d,b),this.writeIndexValueAux(c[d],b)}writeIndexArray(a,b){let c=a.values||[];for(let a of(this.writeValueTypeLabel(b,iu),c))this.writeIndexValueAux(a,b)}writeIndexEntityRef(a,b){this.writeValueTypeLabel(b,is),av.fromName(a).path.forEach(a=>{this.writeValueTypeLabel(b,ix),this.writeUnlabeledIndexString(a,b)})}writeValueTypeLabel(a,b){a.writeNumber(b)}writeTruncationMarker(a){a.writeNumber(iy)}}iz.INSTANCE=new iz;let iA="\uD800",iB="\uDBFF",iC=0,iD=255,iE=1,iF=255,iG=255,iH=0,iI=64,iJ=8,iK=1024;function iL(a){let b=new DataView(new ArrayBuffer(8));return b.setFloat64(0,a,!1),new Uint8Array(b.buffer)}function iM(a){if(0===a)return 8;let b=0;return a>>4==0&&(b+=4,a<<=4),a>>6==0&&(b+=2,a<<=2),a>>7==0&&(b+=1),b}function iN(a){let b=0;for(let c=0;c<8;++c){let d=iM(255&a[c]);if(b+=d,8!==d)break}return b}function iO(a){return Math.ceil((iI-iN(a))/iJ)}class iP{constructor(){this.buffer=new Uint8Array(iK),this.position=0}writeBytesAscending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteAscending(c.value),c=b.next();this.writeSeparatorAscending()}writeBytesDescending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteDescending(c.value),c=b.next();this.writeSeparatorDescending()}writeUtf8Ascending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteAscending(a);else if(a<2048)this.writeByteAscending(960|a>>>6),this.writeByteAscending(128|63&a);else if(b<iA||iB<b)this.writeByteAscending(480|a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a);else{let a=b.codePointAt(0);this.writeByteAscending(240|a>>>18),this.writeByteAscending(128|63&a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a)}}this.writeSeparatorAscending()}writeUtf8Descending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteDescending(a);else if(a<2048)this.writeByteDescending(960|a>>>6),this.writeByteDescending(128|63&a);else if(b<iA||iB<b)this.writeByteDescending(480|a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a);else{let a=b.codePointAt(0);this.writeByteDescending(240|a>>>18),this.writeByteDescending(128|63&a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a)}}this.writeSeparatorDescending()}writeNumberAscending(a){let b=this.toOrderedBits(a),c=iO(b);this.ensureAvailable(1+c),this.buffer[this.position++]=255&c;for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=255&b[a]}writeNumberDescending(a){let b=this.toOrderedBits(a),c=iO(b);this.ensureAvailable(1+c),this.buffer[this.position++]=~(255&c);for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=~(255&b[a])}writeInfinityAscending(){this.writeEscapedByteAscending(iF),this.writeEscapedByteAscending(iG)}writeInfinityDescending(){this.writeEscapedByteDescending(iF),this.writeEscapedByteDescending(iG)}reset(){this.position=0}seed(a){this.ensureAvailable(a.length),this.buffer.set(a,this.position),this.position+=a.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(a){let b=iL(a),c=(128&b[0])!=0;b[0]^=c?255:128;for(let a=1;a<b.length;++a)b[a]^=255*!!c;return b}writeByteAscending(a){let b=255&a;b===iC?(this.writeEscapedByteAscending(iC),this.writeEscapedByteAscending(iD)):b===iF?(this.writeEscapedByteAscending(iF),this.writeEscapedByteAscending(iH)):this.writeEscapedByteAscending(b)}writeByteDescending(a){let b=255&a;b===iC?(this.writeEscapedByteDescending(iC),this.writeEscapedByteDescending(iD)):b===iF?(this.writeEscapedByteDescending(iF),this.writeEscapedByteDescending(iH)):this.writeEscapedByteDescending(a)}writeSeparatorAscending(){this.writeEscapedByteAscending(iC),this.writeEscapedByteAscending(iE)}writeSeparatorDescending(){this.writeEscapedByteDescending(iC),this.writeEscapedByteDescending(iE)}writeEscapedByteAscending(a){this.ensureAvailable(1),this.buffer[this.position++]=a}writeEscapedByteDescending(a){this.ensureAvailable(1),this.buffer[this.position++]=~a}ensureAvailable(a){let b=a+this.position;if(b<=this.buffer.length)return;let c=2*this.buffer.length;c<b&&(c=b);let d=new Uint8Array(c);d.set(this.buffer),this.buffer=d}}class iQ{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesAscending(a)}writeString(a){this.orderedCode.writeUtf8Ascending(a)}writeNumber(a){this.orderedCode.writeNumberAscending(a)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class iR{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesDescending(a)}writeString(a){this.orderedCode.writeUtf8Descending(a)}writeNumber(a){this.orderedCode.writeNumberDescending(a)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class iS{constructor(){this.orderedCode=new iP,this.ascending=new iQ(this.orderedCode),this.descending=new iR(this.orderedCode)}seed(a){this.orderedCode.seed(a)}forKind(a){return 0===a?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class iT{constructor(a,b,c,d){this._indexId=a,this._documentKey=b,this._arrayValue=c,this._directionalValue=d}successor(){let a=this._directionalValue.length,b=0===a||255===this._directionalValue[a-1]?a+1:a,c=new Uint8Array(b);return c.set(this._directionalValue,0),b!==a?c.set([0],this._directionalValue.length):++c[c.length-1],new iT(this._indexId,this._documentKey,this._arrayValue,c)}dbIndexEntry(a,b,c){return{indexId:this._indexId,uid:a,arrayValue:iW(this._arrayValue),directionalValue:iW(this._directionalValue),orderedDocumentKey:iW(b),documentKey:c.path.toArray()}}dbIndexEntryKey(a,b,c){let d=this.dbIndexEntry(a,b,c);return[d.indexId,d.uid,d.arrayValue,d.directionalValue,d.orderedDocumentKey,d.documentKey]}}function iU(a,b){let c=a._indexId-b._indexId;return 0!==c||0!==(c=iV(a._arrayValue,b._arrayValue))||0!==(c=iV(a._directionalValue,b._directionalValue))?c:av.comparator(a._documentKey,b._documentKey)}function iV(a,b){for(let c=0;c<a.length&&c<b.length;++c){let d=a[c]-b[c];if(0!==d)return d}return a.length-b.length}function iW(a){return(0,i.isSafariOrWebkit)()?iY(a):a}function iX(a){return"string"!=typeof a?a:iZ(a)}function iY(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function iZ(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}class i${constructor(a){for(const b of(this.inequalityFilters=new cI((a,b)=>au.comparator(a.field,b.field)),this.collectionId=null!=a.collectionGroup?a.collectionGroup:a.path.lastSegment(),this.orderBys=a.orderBy,this.equalityFilters=[],a.filters)){const a=b;a.isInequality()?this.inequalityFilters=this.inequalityFilters.add(a):this.equalityFilters.push(a)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(a){if(D(a.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let b=aO(a);if(void 0!==b&&!this.hasMatchingEqualityFilter(b))return!1;let c=aP(a),d=new Set,e=0,f=0;for(;e<c.length;++e)if(this.hasMatchingEqualityFilter(c[e]))d=d.add(c[e].fieldPath.canonicalString());else break;if(e===c.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!d.has(a.field.canonicalString())){let b=c[e];if(!this.matchesFilter(a,b)||!this.matchesOrderBy(this.orderBys[f++],b))return!1}++e}for(;e<c.length;++e){let a=c[e];if(f>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[f++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let a=new cI(au.comparator),b=[];for(let c of this.equalityFilters)if(!c.field.isKeyField())if("array-contains"===c.op||"array-contains-any"===c.op)b.push(new aT(c.field,2));else{if(a.has(c.field))continue;a=a.add(c.field),b.push(new aT(c.field,0))}for(let c of this.orderBys)!c.field.isKeyField()&&(a.has(c.field)||(a=a.add(c.field),b.push(new aT(c.field,+("asc"!==c.dir)))));return new aN(aN.UNKNOWN_ID,this.collectionId,b,aV.empty())}hasMatchingEqualityFilter(a){for(let b of this.equalityFilters)if(this.matchesFilter(b,a))return!0;return!1}matchesFilter(a,b){if(void 0===a||!a.field.isEqual(b.fieldPath))return!1;let c="array-contains"===a.op||"array-contains-any"===a.op;return 2===b.kind===c}matchesOrderBy(a,b){return!!a.field.isEqual(b.fieldPath)&&(0===b.kind&&"asc"===a.dir||1===b.kind&&"desc"===a.dir)}}function i_(a){if(D(a instanceof ec||a instanceof ed,20012),a instanceof ec)if(!(a instanceof ev))return a;else{let b=a.value.arrayValue?.values?.map(b=>ec.create(a.field,"==",b))||[];return ed.create(b,"or")}let b=a.filters.map(a=>i_(a));return ed.create(b,a.op)}function i0(a){if(0===a.getFilters().length)return[];let b=i5(i_(a));return(D(i3(b),7391),i1(b)||i2(b))?[b]:b.getFilters()}function i1(a){return a instanceof ec}function i2(a){return a instanceof ed&&eg(a)}function i3(a){return i1(a)||i2(a)||i4(a)}function i4(a){if(a instanceof ed&&ef(a)){for(let b of a.getFilters())if(!i1(b)&&!i2(b))return!1;return!0}return!1}function i5(a){if(D(a instanceof ec||a instanceof ed,34018),a instanceof ec)return a;if(1===a.filters.length)return i5(a.filters[0]);let b=a.filters.map(a=>i5(a)),c=ed.create(b,a.op);return i3(c=ja(c))?c:(D(c instanceof ed,64498),D(ee(c),40251),D(c.filters.length>1,57927),c.filters.reduce((a,b)=>i6(a,b)))}function i6(a,b){let c;return D(a instanceof ec||a instanceof ed,38388),D(b instanceof ec||b instanceof ed,25473),ja(c=a instanceof ec?b instanceof ec?i7(a,b):i9(a,b):b instanceof ec?i9(b,a):i8(a,b))}function i7(a,b){return ed.create([a,b],"and")}function i8(a,b){if(D(a.filters.length>0&&b.filters.length>0,48005),ee(a)&&ee(b))return em(a,b.getFilters());let c=ef(a)?a:b,d=ef(a)?b:a,e=c.filters.map(a=>i6(a,d));return ed.create(e,"or")}function i9(a,b){if(ee(b))return em(b,a.getFilters());{let c=b.filters.map(b=>i6(a,b));return ed.create(c,"or")}}function ja(a){if(D(a instanceof ec||a instanceof ed,11850),a instanceof ec)return a;let b=a.getFilters();if(1===b.length)return ja(b[0]);if(eh(a))return a;let c=b.map(a=>ja(a)),d=[];return(c.forEach(b=>{b instanceof ec?d.push(b):b instanceof ed&&(b.op===a.op?d.push(...b.filters):d.push(b))}),1===d.length)?d[0]:ed.create(d,a.op)}class jb{constructor(){this.collectionParentIndex=new jc}addToCollectionParentIndex(a,b){return this.collectionParentIndex.add(b),a1.resolve()}getCollectionParents(a,b){return a1.resolve(this.collectionParentIndex.getEntries(b))}addFieldIndex(a,b){return a1.resolve()}deleteFieldIndex(a,b){return a1.resolve()}deleteAllFieldIndexes(a){return a1.resolve()}createTargetIndexes(a,b){return a1.resolve()}getDocumentsMatchingTarget(a,b){return a1.resolve(null)}getIndexType(a,b){return a1.resolve(0)}getFieldIndexes(a,b){return a1.resolve([])}getNextCollectionGroupToUpdate(a){return a1.resolve(null)}getMinOffset(a,b){return a1.resolve(aY.min())}getMinOffsetFromCollectionGroup(a,b){return a1.resolve(aY.min())}updateCollectionGroup(a,b,c){return a1.resolve()}updateIndexEntries(a,b){return a1.resolve()}}class jc{constructor(){this.index={}}add(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new cI(as.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b];return d&&d.has(c)}getEntries(a){return(this.index[a]||new cI(as.comparator)).toArray()}}let jd="IndexedDbIndexManager",je=new Uint8Array(0);class jf{constructor(a,b){this.databaseId=b,this.collectionParentsCache=new jc,this.targetToDnfSubTargets=new fe(a=>eA(a),(a,b)=>eC(a,b)),this.uid=a.uid||""}addToCollectionParentIndex(a,b){if(!this.collectionParentsCache.has(b)){let c=b.lastSegment(),d=b.popLast();a.addOnCommittedListener(()=>{this.collectionParentsCache.add(b)});let e={collectionId:c,parent:bp(d)};return jg(a).put(e)}return a1.resolve()}getCollectionParents(a,b){let c=[],d=IDBKeyRange.bound([b,""],[ap(b),""],!1,!0);return jg(a).loadAll(d).next(a=>{for(let d of a){if(d.collectionId!==b)break;c.push(bs(d.parent))}return c})}addFieldIndex(a,b){let c=ji(a),d=ia(b);delete d.indexId;let e=c.add(d);if(!b.indexState)return e.next();{let c=jj(a);return e.next(a=>{c.put(ic(a,this.uid,b.indexState.sequenceNumber,b.indexState.offset))})}}deleteFieldIndex(a,b){let c=ji(a),d=jj(a),e=jh(a);return c.delete(b.indexId).next(()=>d.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0))).next(()=>e.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0)))}deleteAllFieldIndexes(a){let b=ji(a),c=jh(a),d=jj(a);return b.deleteAll().next(()=>c.deleteAll()).next(()=>d.deleteAll())}createTargetIndexes(a,b){return a1.forEach(this.getSubTargets(b),b=>this.getIndexType(a,b).next(c=>{if(0===c||1===c){let c=new i$(b).buildTargetIndex();if(null!=c)return this.addFieldIndex(a,c)}}))}getDocumentsMatchingTarget(a,b){let c=jh(a),d=!0,e=new Map;return a1.forEach(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>{d&&(d=!!a),e.set(b,a)})).next(()=>{if(!d)return a1.resolve(null);{let a=fr(),d=[];return a1.forEach(e,(e,f)=>{x(jd,`Using index ${aS(e)} to execute ${eA(b)}`);let g=eF(f,e),h=eG(f,e),i=eH(f,e),j=eI(f,e),k=this.encodeBound(e,f,i),l=this.encodeBound(e,f,j),m=this.encodeValues(e,f,h),n=this.generateIndexRanges(e.indexId,g,k,i.inclusive,l,j.inclusive,m);return a1.forEach(n,e=>c.loadFirst(e,b.limit).next(b=>{b.forEach(b=>{let c=av.fromSegments(b.documentKey);a.has(c)||(a=a.add(c),d.push(c))})}))}).next(()=>d)}})}getSubTargets(a){let b=this.targetToDnfSubTargets.get(a);return b||(b=0===a.filters.length?[a]:i0(ed.create(a.filters,"and")).map(b=>ez(a.path,a.collectionGroup,a.orderBy,b.getFilters(),a.limit,a.startAt,a.endAt)),this.targetToDnfSubTargets.set(a,b)),b}generateIndexRanges(a,b,c,d,e,f,g){let h=(null!=b?b.length:1)*Math.max(c.length,e.length),i=h/(null!=b?b.length:1),j=[];for(let k=0;k<h;++k){let h=b?this.encodeSingleElement(b[k/i]):je,l=this.generateLowerBound(a,h,c[k%i],d),m=this.generateUpperBound(a,h,e[k%i],f),n=g.map(b=>this.generateLowerBound(a,h,b,!0));j.push(...this.createRange(l,m,n))}return j}generateLowerBound(a,b,c,d){let e=new iT(a,av.empty(),b,c);return d?e:e.successor()}generateUpperBound(a,b,c,d){let e=new iT(a,av.empty(),b,c);return d?e.successor():e}getFieldIndex(a,b){let c=new i$(b),d=null!=b.collectionGroup?b.collectionGroup:b.path.lastSegment();return this.getFieldIndexes(a,d).next(a=>{let b=null;for(let d of a)c.servedByIndex(d)&&(!b||d.fields.length>b.fields.length)&&(b=d);return b})}getIndexType(a,b){let c=2,d=this.getSubTargets(b);return a1.forEach(d,b=>this.getFieldIndex(a,b).next(a=>{a?0!==c&&a.fields.length<eL(b)&&(c=1):c=0})).next(()=>eM(b)&&d.length>1&&2===c?1:c)}encodeDirectionalElements(a,b){let c=new iS;for(let d of aP(a)){let a=b.data.field(d.fieldPath);if(null==a)return null;let e=c.forKind(d.kind);iz.INSTANCE.writeIndexValue(a,e)}return c.encodedBytes()}encodeSingleElement(a){let b=new iS;return iz.INSTANCE.writeIndexValue(a,b.forKind(0)),b.encodedBytes()}encodeDirectionalKey(a,b){let c=new iS;return iz.INSTANCE.writeIndexValue(dK(this.databaseId,b),c.forKind(aQ(a))),c.encodedBytes()}encodeValues(a,b,c){if(null===c)return[];let d=[];d.push(new iS);let e=0;for(let f of aP(a)){let a=c[e++];for(let c of d)if(this.isInFilter(b,f.fieldPath)&&dO(a))d=this.expandIndexValues(d,f,a);else{let b=c.forKind(f.kind);iz.INSTANCE.writeIndexValue(a,b)}}return this.getEncodedBytes(d)}encodeBound(a,b,c){return this.encodeValues(a,b,c.position)}getEncodedBytes(a){let b=[];for(let c=0;c<a.length;++c)b[c]=a[c].encodedBytes();return b}expandIndexValues(a,b,c){let d=[...a],e=[];for(let a of c.arrayValue.values||[])for(let c of d){let d=new iS;d.seed(c.encodedBytes()),iz.INSTANCE.writeIndexValue(a,d.forKind(b.kind)),e.push(d)}return e}isInFilter(a,b){return!!a.filters.find(a=>a instanceof ec&&a.field.isEqual(b)&&("in"===a.op||"not-in"===a.op))}getFieldIndexes(a,b){let c=ji(a),d=jj(a);return(b?c.loadAll(b7,IDBKeyRange.bound(b,b)):c.loadAll()).next(a=>{let b=[];return a1.forEach(a,a=>d.get([a.indexId,this.uid]).next(c=>{b.push(ib(a,c))})).next(()=>b)})}getNextCollectionGroupToUpdate(a){return this.getFieldIndexes(a).next(a=>0===a.length?null:(a.sort((a,b)=>{let c=a.indexState.sequenceNumber-b.indexState.sequenceNumber;return 0!==c?c:aj(a.collectionGroup,b.collectionGroup)}),a[0].collectionGroup))}updateCollectionGroup(a,b,c){let d=ji(a),e=jj(a);return this.getNextSequenceNumber(a).next(a=>d.loadAll(b7,IDBKeyRange.bound(b,b)).next(b=>a1.forEach(b,b=>e.put(ic(b.indexId,this.uid,a,c)))))}updateIndexEntries(a,b){let c=new Map;return a1.forEach(b,(b,d)=>{let e=c.get(b.collectionGroup);return(e?a1.resolve(e):this.getFieldIndexes(a,b.collectionGroup)).next(e=>(c.set(b.collectionGroup,e),a1.forEach(e,c=>this.getExistingIndexEntries(a,b,c).next(b=>{let e=this.computeIndexEntries(d,c);return b.isEqual(e)?a1.resolve():this.updateEntries(a,d,c,b,e)}))))})}addIndexEntry(a,b,c,d){return jh(a).put(d.dbIndexEntry(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}deleteIndexEntry(a,b,c,d){return jh(a).delete(d.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}getExistingIndexEntries(a,b,c){let d=jh(a),e=new cI(iU);return d.iterate({index:cf,range:IDBKeyRange.only([c.indexId,this.uid,iW(this.encodeDirectionalKey(c,b))])},(a,d)=>{e=e.add(new iT(c.indexId,b,iX(d.arrayValue),iX(d.directionalValue)))}).next(()=>e)}computeIndexEntries(a,b){let c=new cI(iU),d=this.encodeDirectionalElements(b,a);if(null==d)return c;let e=aO(b);if(null!=e){let f=a.data.field(e.fieldPath);if(dO(f))for(let e of f.arrayValue.values||[])c=c.add(new iT(b.indexId,a.key,this.encodeSingleElement(e),d))}else c=c.add(new iT(b.indexId,a.key,je,d));return c}updateEntries(a,b,c,d,e){x(jd,"Updating index entries for document '%s'",b.key);let f=[];return cK(d,e,iU,d=>{f.push(this.addIndexEntry(a,b,c,d))},d=>{f.push(this.deleteIndexEntry(a,b,c,d))}),a1.waitFor(f)}getNextSequenceNumber(a){let b=1;return jj(a).iterate({index:cb,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(a,c,d)=>{d.done(),b=c.sequenceNumber+1}).next(()=>b)}createRange(a,b,c){c=c.sort((a,b)=>iU(a,b)).filter((a,b,c)=>!b||0!==iU(a,c[b-1]));let d=[];for(let e of(d.push(a),c)){let c=iU(e,a),f=iU(e,b);if(0===c)d[0]=a.successor();else if(c>0&&f<0)d.push(e),d.push(e.successor());else if(f>0)break}d.push(b);let e=[];for(let a=0;a<d.length;a+=2){if(this.isRangeMatchable(d[a],d[a+1]))return[];let b=d[a].dbIndexEntryKey(this.uid,je,av.empty()),c=d[a+1].dbIndexEntryKey(this.uid,je,av.empty());e.push(IDBKeyRange.bound(b,c))}return e}isRangeMatchable(a,b){return iU(a,b)>0}getMinOffsetFromCollectionGroup(a,b){return this.getFieldIndexes(a,b).next(jk)}getMinOffset(a,b){return a1.mapArray(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>a||B(44426))).next(jk)}}function jg(a){return cz(a,bZ)}function jh(a){return cz(a,cd)}function ji(a){return cz(a,b5)}function jj(a){return cz(a,b9)}function jk(a){D(0!==a.length,28825);let b=a[0].indexState.offset,c=b.largestBatchId;for(let d=1;d<a.length;d++){let e=a[d].indexState.offset;0>aZ(e,b)&&(b=e),c<e.largestBatchId&&(c=e.largestBatchId)}return new aY(b.readTime,b.documentKey,c)}function jl(a,b,c){let d=a.store(by),e=a.store(bG),f=[],g=IDBKeyRange.only(c.batchId),h=0,i=d.iterate({range:g},(a,b,c)=>(h++,c.delete()));f.push(i.next(()=>{D(1===h,47070,{batchId:c.batchId})}));let j=[];for(let a of c.mutations){let d=bE(b,a.key.path,c.batchId);f.push(e.delete(d)),j.push(a.key)}return a1.waitFor(f).next(()=>j)}function jm(a){let b;if(!a)return 0;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else if(a.noDocument)b=a.noDocument;else throw B(14731);return JSON.stringify(b).length}class jn{constructor(a,b,c,d){this.userId=a,this.serializer=b,this.indexManager=c,this.referenceDelegate=d,this.documentKeysByBatchId={}}static forUser(a,b,c,d){return D(""!==a.uid,64387),new jn(a.isAuthenticated()?a.uid:"",b,c,d)}checkEmpty(a){let b=!0,c=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return jq(a).iterate({index:bA,range:c},(a,c,d)=>{b=!1,d.done()}).next(()=>b)}addMutationBatch(a,b,c,d){let e=jr(a),f=jq(a);return f.add({}).next(g=>{D("number"==typeof g,49019);let h=new f8(g,b,c,d),i=hX(this.serializer,this.userId,h),j=[],k=new cI((a,b)=>aj(a.canonicalString(),b.canonicalString()));for(let a of d){let b=bE(this.userId,a.key.path,g);k=k.add(a.key.path.popLast()),j.push(f.put(i)),j.push(e.put(b,bF))}return k.forEach(b=>{j.push(this.indexManager.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.documentKeysByBatchId[g]=h.keys()}),a1.waitFor(j).next(()=>h)})}lookupMutationBatch(a,b){return jq(a).get(b).next(a=>a?(D(a.userId===this.userId,48,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),hY(this.serializer,a)):null)}lookupMutationKeys(a,b){return this.documentKeysByBatchId[b]?a1.resolve(this.documentKeysByBatchId[b]):this.lookupMutationBatch(a,b).next(a=>{if(!a)return null;{let c=a.keys();return this.documentKeysByBatchId[b]=c,c}})}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=IDBKeyRange.lowerBound([this.userId,c]),e=null;return jq(a).iterate({index:bA,range:d},(a,b,d)=>{b.userId===this.userId&&(D(b.batchId>=c,47524,{nextBatchId:c}),e=hY(this.serializer,b)),d.done()}).next(()=>e)}getHighestUnacknowledgedBatchId(a){let b=IDBKeyRange.upperBound([this.userId,1/0]),c=c7;return jq(a).iterate({index:bA,range:b,reverse:!0},(a,b,d)=>{c=b.batchId,d.done()}).next(()=>c)}getAllMutationBatches(a){let b=IDBKeyRange.bound([this.userId,c7],[this.userId,1/0]);return jq(a).loadAll(bA,b).next(a=>a.map(a=>hY(this.serializer,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){let c=bD(this.userId,b.path),d=IDBKeyRange.lowerBound(c),e=[];return jr(a).iterate({range:d},(c,d,f)=>{let[g,h,i]=c,j=bs(h);return g===this.userId&&b.path.isEqual(j)?jq(a).get(i).next(a=>{if(!a)throw B(61480,{indexKey:c,batchId:i});D(a.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),e.push(hY(this.serializer,a))}):void f.done()}).next(()=>e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new cI(aj),d=[];return b.forEach(b=>{let e=bD(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=jr(a).iterate({range:f},(a,d,e)=>{let[f,g,h]=a,i=bs(g);f===this.userId&&b.path.isEqual(i)?c=c.add(h):e.done()});d.push(g)}),a1.waitFor(d).next(()=>this.lookupMutationBatches(a,c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=bD(this.userId,c),f=IDBKeyRange.lowerBound(e),g=new cI(aj);return jr(a).iterate({range:f},(a,b,e)=>{let[f,h,i]=a,j=bs(h);f===this.userId&&c.isPrefixOf(j)?j.length===d&&(g=g.add(i)):e.done()}).next(()=>this.lookupMutationBatches(a,g))}lookupMutationBatches(a,b){let c=[],d=[];return b.forEach(b=>{d.push(jq(a).get(b).next(a=>{if(null===a)throw B(35274,{batchId:b});D(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),c.push(hY(this.serializer,a))}))}),a1.waitFor(d).next(()=>c)}removeMutationBatch(a,b){return jl(a.simpleDbTransaction,this.userId,b).next(c=>(a.addOnCommittedListener(()=>{this.removeCachedMutationKeys(b.batchId)}),a1.forEach(c,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}removeCachedMutationKeys(a){delete this.documentKeysByBatchId[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(b=>{if(!b)return a1.resolve();let c=IDBKeyRange.lowerBound(bC(this.userId)),d=[];return jr(a).iterate({range:c},(a,b,c)=>{if(a[0]!==this.userId)return void c.done();{let b=bs(a[1]);d.push(b)}}).next(()=>{D(0===d.length,56720,{danglingKeys:d.map(a=>a.canonicalString())})})})}containsKey(a,b){return jo(a,this.userId,b)}getMutationQueueMetadata(a){return js(a).get(this.userId).next(a=>a||{userId:this.userId,lastAcknowledgedBatchId:c7,lastStreamToken:""})}}function jo(a,b,c){let d=bD(b,c.path),e=d[1],f=IDBKeyRange.lowerBound(d),g=!1;return jr(a).iterate({range:f,keysOnly:!0},(a,c,d)=>{let[f,h,i]=a;f===b&&h===e&&(g=!0),d.done()}).next(()=>g)}function jp(a,b){let c=!1;return js(a).iterateSerial(d=>jo(a,d,b).next(a=>(a&&(c=!0),a1.resolve(!a)))).next(()=>c)}function jq(a){return cz(a,by)}function jr(a){return cz(a,bG)}function js(a){return cz(a,bw)}let jt=2;class ju{constructor(a){this.lastId=a}next(){return this.lastId+=jt,this.lastId}static forTargetCache(){return new ju(2-jt)}static forSyncEngine(){return new ju(1-jt)}}class jv{constructor(a,b){this.referenceDelegate=a,this.serializer=b}allocateTargetId(a){return this.retrieveMetadata(a).next(b=>{let c=new ju(b.highestTargetId);return b.highestTargetId=c.next(),this.saveMetadata(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.retrieveMetadata(a).next(a=>aK.fromTimestamp(new aJ(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.retrieveMetadata(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(a,b,c){return this.retrieveMetadata(a).next(d=>(d.highestListenSequenceNumber=b,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),b>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=b),this.saveMetadata(a,d)))}addTargetData(a,b){return this.saveTargetData(a,b).next(()=>this.retrieveMetadata(a).next(c=>(c.targetCount+=1,this.updateMetadataFromTargetData(b,c),this.saveMetadata(a,c))))}updateTargetData(a,b){return this.saveTargetData(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>jw(a).delete(b.targetId)).next(()=>this.retrieveMetadata(a)).next(b=>(D(b.targetCount>0,8065),b.targetCount-=1,this.saveMetadata(a,b)))}removeTargets(a,b,c){let d=0,e=[];return jw(a).iterate((f,g)=>{let h=hZ(g);h.sequenceNumber<=b&&null===c.get(h.targetId)&&(d++,e.push(this.removeTargetData(a,h)))}).next(()=>a1.waitFor(e)).next(()=>d)}forEachTarget(a,b){return jw(a).iterate((a,c)=>{b(hZ(c))})}retrieveMetadata(a){return jx(a).get(bX).next(a=>(D(null!==a,2888),a))}saveMetadata(a,b){return jx(a).put(bX,b)}saveTargetData(a,b){return jw(a).put(h$(this.serializer,b))}updateMetadataFromTargetData(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.retrieveMetadata(a).next(a=>a.targetCount)}getTargetData(a,b){let c=eA(b),d=IDBKeyRange.bound([c,-1/0],[c,1/0]),e=null;return jw(a).iterate({range:d,index:bR},(a,c,d)=>{let f=hZ(c);eC(b,f.target)&&(e=f,d.done())}).next(()=>e)}addMatchingKeys(a,b,c){let d=[],e=jy(a);return b.forEach(b=>{let f=bp(b.path);d.push(e.put({targetId:c,path:f})),d.push(this.referenceDelegate.addReference(a,c,b))}),a1.waitFor(d)}removeMatchingKeys(a,b,c){let d=jy(a);return a1.forEach(b,b=>{let e=bp(b.path);return a1.waitFor([d.delete([c,e]),this.referenceDelegate.removeReference(a,c,b)])})}removeMatchingKeysForTargetId(a,b){let c=jy(a),d=IDBKeyRange.bound([b],[b+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(a,b){let c=IDBKeyRange.bound([b],[b+1],!1,!0),d=jy(a),e=fr();return d.iterate({range:c,keysOnly:!0},(a,b,c)=>{let d=new av(bs(a[1]));e=e.add(d)}).next(()=>e)}containsKey(a,b){let c=bp(b.path),d=IDBKeyRange.bound([c],[ap(c)],!1,!0),e=0;return jy(a).iterate({index:bV,keysOnly:!0,range:d},([a,b],c,d)=>{0!==a&&(e++,d.done())}).next(()=>e>0)}getTargetDataForTarget(a,b){return jw(a).get(b).next(a=>a?hZ(a):null)}}function jw(a){return cz(a,bP)}function jx(a){return cz(a,bY)}function jy(a){return cz(a,bT)}let jz={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jA=-1,jB=0x2800000;class jC{static withCacheSize(a){return new jC(a,jC.DEFAULT_COLLECTION_PERCENTILE,jC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}}jC.DEFAULT_COLLECTION_PERCENTILE=10,jC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,jC.DEFAULT=new jC(jB,jC.DEFAULT_COLLECTION_PERCENTILE,jC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),jC.DISABLED=new jC(jA,0,0);let jD="LruGarbageCollector",jE=1048576,jF=6e4,jG=3e5;function jH([a,b],[c,d]){let e=aj(a,c);return 0===e?aj(b,d):e}class jI{constructor(a){this.maxElements=a,this.buffer=new cI(jH),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(a){let b=[a,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(b);else{let a=this.buffer.last();0>jH(b,a)&&(this.buffer=this.buffer.delete(a).add(b))}}get maxValue(){return this.buffer.last()[0]}}class jJ{constructor(a,b,c){this.garbageCollector=a,this.asyncQueue=b,this.localStore=c,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==jA&&this.scheduleGC(jF)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(a){x(jD,`Garbage collection scheduled in ${a}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){a9(a)?x(jD,"Ignoring IndexedDB error during garbage collection: ",a):await a0(a)}await this.scheduleGC(jG)})}}class jK{constructor(a,b){this.delegate=a,this.params=b}calculateTargetCount(a,b){return this.delegate.getSequenceNumberCount(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(a,b){if(0===b)return a1.resolve(bk.INVALID);let c=new jI(b);return this.delegate.forEachTarget(a,a=>c.addElement(a.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(a,a=>c.addElement(a))).next(()=>c.maxValue)}removeTargets(a,b,c){return this.delegate.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.delegate.removeOrphanedDocuments(a,b)}collect(a,b){return this.params.cacheSizeCollectionThreshold===jA?(x("LruGarbageCollector","Garbage collection skipped; disabled"),a1.resolve(jz)):this.getCacheSize(a).next(c=>c<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${c} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jz):this.runGarbageCollection(a,b))}getCacheSize(a){return this.delegate.getCacheSize(a)}runGarbageCollection(a,b){let c,d,e,f,g,h,i,j=Date.now();return this.calculateTargetCount(a,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),d=this.params.maximumSequenceNumbersToCollect):d=b,f=Date.now(),this.nthSequenceNumber(a,d))).next(d=>(c=d,g=Date.now(),this.removeTargets(a,c,b))).next(b=>(e=b,h=Date.now(),this.removeOrphanedDocuments(a,c))).next(a=>(i=Date.now(),v()<=l.LogLevel.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-j}ms
	Determined least recently used ${d} in ${g-f}ms
	Removed ${e} targets in ${h-g}ms
	Removed ${a} documents in ${i-h}ms
Total Duration: ${i-j}ms`),a1.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:e,documentsRemoved:a})))}}function jL(a,b){return new jK(a,b)}class jM{constructor(a,b){this.db=a,this.garbageCollector=jL(this,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}forEachOrphanedDocumentSequenceNumber(a,b){return this.forEachOrphanedDocument(a,(a,c)=>b(c))}addReference(a,b,c){return jP(a,c)}removeReference(a,b,c){return jP(a,c)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return jP(a,b)}isPinned(a,b){return jp(a,b)}removeOrphanedDocuments(a,b){let c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[],e=0;return this.forEachOrphanedDocument(a,(f,g)=>{if(g<=b){let b=this.isPinned(a,f).next(b=>{if(!b)return e++,c.getEntry(a,f).next(()=>(c.removeEntry(f,aK.min()),jy(a).delete(jN(f))))});d.push(b)}}).next(()=>a1.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return jP(a,b)}forEachOrphanedDocument(a,b){let c,d=jy(a),e=bk.INVALID;return d.iterate({index:bV},([a,d],{path:f,sequenceNumber:g})=>{0===a?(e!==bk.INVALID&&b(new av(bs(c)),e),e=g,c=f):e=bk.INVALID}).next(()=>{e!==bk.INVALID&&b(new av(bs(c)),e)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}}function jN(a){return[0,bp(a.path)]}function jO(a,b){return{targetId:0,path:bp(a.path),sequenceNumber:b}}function jP(a,b){return jy(a).put(jO(b,a.currentSequenceNumber))}class jQ{constructor(){this.changes=new fe(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,d0.newInvalidDocument(a).setReadTime(b))}getEntry(a,b){this.assertNotApplied();let c=this.changes.get(b);return void 0!==c?a1.resolve(c):this.getFromCache(a,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}}class jR{constructor(a){this.serializer=a}setIndexManager(a){this.indexManager=a}addEntry(a,b,c){return jV(a).put(c)}removeEntry(a,b,c){return jV(a).delete(jX(b,c))}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.setMetadata(a,c)))}getEntry(a,b){let c=d0.newInvalidDocument(b);return jV(a).iterate({index:bJ,range:IDBKeyRange.only(jW(b))},(a,d)=>{c=this.maybeDecodeDocument(b,d)}).next(()=>c)}getSizedEntry(a,b){let c={size:0,document:d0.newInvalidDocument(b)};return jV(a).iterate({index:bJ,range:IDBKeyRange.only(jW(b))},(a,d)=>{c={document:this.maybeDecodeDocument(b,d),size:jm(d)}}).next(()=>c)}getEntries(a,b){let c=fg();return this.forEachDbEntry(a,b,(a,b)=>{let d=this.maybeDecodeDocument(a,b);c=c.insert(a,d)}).next(()=>c)}getSizedEntries(a,b){let c=fg(),d=new cE(av.comparator);return this.forEachDbEntry(a,b,(a,b)=>{let e=this.maybeDecodeDocument(a,b);c=c.insert(a,e),d=d.insert(a,jm(b))}).next(()=>({documents:c,sizeMap:d}))}forEachDbEntry(a,b,c){if(b.isEmpty())return a1.resolve();let d=new cI(jZ);b.forEach(a=>d=d.add(a));let e=IDBKeyRange.bound(jW(d.first()),jW(d.last())),f=d.getIterator(),g=f.getNext();return jV(a).iterate({index:bJ,range:e},(a,b,d)=>{let e=av.fromSegments([...b.prefixPath,b.collectionGroup,b.documentId]);for(;g&&0>jZ(g,e);)c(g,null),g=f.getNext();g&&g.isEqual(e)&&(c(g,b),g=f.hasNext()?f.getNext():null),g?d.skip(jW(g)):d.done()}).next(()=>{for(;g;)c(g,null),g=f.hasNext()?f.getNext():null})}getDocumentsMatchingQuery(a,b,c,d,e){let f=b.path,g=[f.popLast().toArray(),f.lastSegment(),hT(c.readTime),c.documentKey.path.isEmpty()?"":c.documentKey.path.lastSegment()],h=[f.popLast().toArray(),f.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return jV(a).loadAll(IDBKeyRange.bound(g,h,!0)).next(a=>{e?.incrementDocumentReadCount(a.length);let c=fg();for(let e of a){let a=this.maybeDecodeDocument(av.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);a.isFoundDocument()&&(e6(b,a)||d.has(a.key))&&(c=c.insert(a.key,a))}return c})}getAllFromCollectionGroup(a,b,c,d){let e=fg(),f=jY(b,c),g=jY(b,aY.max());return jV(a).iterate({index:bL,range:IDBKeyRange.bound(f,g,!0)},(a,b,c)=>{let f=this.maybeDecodeDocument(av.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);(e=e.insert(f.key,f)).size===d&&c.done()}).next(()=>e)}newChangeBuffer(a){return new jT(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return jU(a).get(bO).next(a=>(D(!!a,20021),a))}setMetadata(a,b){return jU(a).put(bO,b)}maybeDecodeDocument(a,b){if(b){let a=hR(this.serializer,b);if(!(a.isNoDocument()&&a.version.isEqual(aK.min())))return a}return d0.newInvalidDocument(a)}}function jS(a){return new jR(a)}class jT extends jQ{constructor(a,b){super(),this.documentCache=a,this.trackRemovals=b,this.documentStates=new fe(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(a){let b=[],c=0,d=new cI((a,b)=>aj(a.canonicalString(),b.canonicalString()));return this.changes.forEach((e,f)=>{let g=this.documentStates.get(e);if(b.push(this.documentCache.removeEntry(a,e,g.readTime)),f.isValidDocument()){let h=hS(this.documentCache.serializer,f);d=d.add(e.path.popLast());let i=jm(h);c+=i-g.size,b.push(this.documentCache.addEntry(a,e,h))}else if(c-=g.size,this.trackRemovals){let c=hS(this.documentCache.serializer,f.convertToNoDocument(aK.min()));b.push(this.documentCache.addEntry(a,e,c))}}),d.forEach(c=>{b.push(this.documentCache.indexManager.addToCollectionParentIndex(a,c))}),b.push(this.documentCache.updateMetadata(a,c)),a1.waitFor(b)}getFromCache(a,b){return this.documentCache.getSizedEntry(a,b).next(a=>(this.documentStates.set(b,{size:a.size,readTime:a.document.readTime}),a.document))}getAllFromCache(a,b){return this.documentCache.getSizedEntries(a,b).next(({documents:a,sizeMap:b})=>(b.forEach((b,c)=>{this.documentStates.set(b,{size:c,readTime:a.get(b).readTime})}),a))}}function jU(a){return cz(a,bN)}function jV(a){return cz(a,bH)}function jW(a){let b=a.path.toArray();return[b.slice(0,b.length-2),b[b.length-2],b[b.length-1]]}function jX(a,b){let c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],hT(b),c[c.length-1]]}function jY(a,b){let c=b.documentKey.path.toArray();return[a,hT(b.readTime),c.slice(0,c.length-2),c.length>0?c[c.length-1]:""]}function jZ(a,b){let c=a.path.toArray(),d=b.path.toArray(),e=0;for(let a=0;a<c.length-2&&a<d.length-2;++a)if(e=aj(c[a],d[a]))return e;return(e=aj(c.length,d.length))||(e=aj(c[c.length-2],d[d.length-2]))?e:aj(c[c.length-1],d[d.length-1])}let j$=18;class j_{constructor(a,b){this.overlayedDocument=a,this.mutatedFields=b}}class j0{constructor(a,b,c,d){this.remoteDocumentCache=a,this.mutationQueue=b,this.documentOverlayCache=c,this.indexManager=d}getDocument(a,b){let c=null;return this.documentOverlayCache.getOverlay(a,b).next(d=>(c=d,this.remoteDocumentCache.getEntry(a,b))).next(a=>(null!==c&&fU(c.mutation,a,cM.empty(),aJ.now()),a))}getDocuments(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.getLocalViewOfDocuments(a,b,fr()).next(()=>b))}getLocalViewOfDocuments(a,b,c=fr()){let d=fl();return this.populateOverlays(a,d,b).next(()=>this.computeViews(a,b,d,c).next(a=>{let b=fi();return a.forEach((a,c)=>{b=b.insert(a,c.overlayedDocument)}),b}))}getOverlayedDocuments(a,b){let c=fl();return this.populateOverlays(a,c,b).next(()=>this.computeViews(a,b,c,fr()))}populateOverlays(a,b,c){let d=[];return c.forEach(a=>{b.has(a)||d.push(a)}),this.documentOverlayCache.getOverlays(a,d).next(a=>{a.forEach((a,c)=>{b.set(a,c)})})}computeViews(a,b,c,d){let e=fg(),f=fn(),g=fj();return b.forEach((a,b)=>{let g=c.get(b.key);d.has(b.key)&&(void 0===g||g.mutation instanceof f$)?e=e.insert(b.key,b):void 0!==g?(f.set(b.key,g.mutation.getFieldMask()),fU(g.mutation,b,g.mutation.getFieldMask(),aJ.now())):f.set(b.key,cM.empty())}),this.recalculateAndSaveOverlays(a,e).next(a=>(a.forEach((a,b)=>f.set(a,b)),b.forEach((a,b)=>g.set(a,new j_(b,f.get(a)??null))),g))}recalculateAndSaveOverlays(a,b){let c=fn(),d=new cE((a,b)=>a-b),e=fr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,b).next(a=>{for(let e of a)e.keys().forEach(a=>{let f=b.get(a);if(null===f)return;let g=c.get(a)||cM.empty();g=e.applyToLocalView(f,g),c.set(a,g);let h=(d.get(e.batchId)||fr()).add(a);d=d.insert(e.batchId,h)})}).next(()=>{let f=[],g=d.getReverseIterator();for(;g.hasNext();){let d=g.getNext(),h=d.key,i=d.value,j=fm();i.forEach(a=>{if(!e.has(a)){let d=fS(b.get(a),c.get(a));null!==d&&j.set(a,d),e=e.add(a)}}),f.push(this.documentOverlayCache.saveOverlays(a,h,j))}return a1.waitFor(f)}).next(()=>c)}recalculateAndSaveOverlaysForDocumentKeys(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.recalculateAndSaveOverlays(a,b))}getDocumentsMatchingQuery(a,b,c,d){return eU(b)?this.getDocumentsMatchingDocumentQuery(a,b.path):eV(b)?this.getDocumentsMatchingCollectionGroupQuery(a,b,c,d):this.getDocumentsMatchingCollectionQuery(a,b,c,d)}getNextDocuments(a,b,c,d){return this.remoteDocumentCache.getAllFromCollectionGroup(a,b,c,d).next(e=>{let f=d-e.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(a,b,c.largestBatchId,d-e.size):a1.resolve(fl()),g=aL,h=e;return f.next(b=>a1.forEach(b,(b,c)=>(g<c.largestBatchId&&(g=c.largestBatchId),e.get(b))?a1.resolve():this.remoteDocumentCache.getEntry(a,b).next(a=>{h=h.insert(b,a)})).next(()=>this.populateOverlays(a,b,e)).next(()=>this.computeViews(a,h,b,fr())).next(a=>({batchId:g,changes:fk(a)})))})}getDocumentsMatchingDocumentQuery(a,b){return this.getDocument(a,new av(b)).next(a=>{let b=fi();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}getDocumentsMatchingCollectionGroupQuery(a,b,c,d){let e=b.collectionGroup,f=fi();return this.indexManager.getCollectionParents(a,e).next(g=>a1.forEach(g,g=>{let h=eQ(b,g.child(e));return this.getDocumentsMatchingCollectionQuery(a,h,c,d).next(a=>{a.forEach((a,b)=>{f=f.insert(a,b)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(a,b,c,d){let e;return this.documentOverlayCache.getOverlaysForCollection(a,b.path,c.largestBatchId).next(f=>(e=f,this.remoteDocumentCache.getDocumentsMatchingQuery(a,b,c,e,d))).next(a=>{e.forEach((b,c)=>{let d=c.getKey();null===a.get(d)&&(a=a.insert(d,d0.newInvalidDocument(d)))});let c=fi();return a.forEach((a,d)=>{let f=e.get(a);void 0!==f&&fU(f.mutation,d,cM.empty(),aJ.now()),e6(b,d)&&(c=c.insert(a,d))}),c})}}class j1{constructor(a){this.serializer=a,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(a,b){return a1.resolve(this.bundles.get(b))}saveBundleMetadata(a,b){return this.bundles.set(b.id,h6(b)),a1.resolve()}getNamedQuery(a,b){return a1.resolve(this.namedQueries.get(b))}saveNamedQuery(a,b){return this.namedQueries.set(b.name,h5(b)),a1.resolve()}}class j2{constructor(){this.overlays=new cE(av.comparator),this.overlayByBatchId=new Map}getOverlay(a,b){return a1.resolve(this.overlays.get(b))}getOverlays(a,b){let c=fl();return a1.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){return c.forEach((c,d)=>{this.saveOverlay(a,b,d)}),a1.resolve()}removeOverlaysForBatchId(a,b,c){let d=this.overlayByBatchId.get(c);return void 0!==d&&(d.forEach(a=>this.overlays=this.overlays.remove(a)),this.overlayByBatchId.delete(c)),a1.resolve()}getOverlaysForCollection(a,b,c){let d=fl(),e=b.length+1,f=new av(b.child("")),g=this.overlays.getIteratorFrom(f);for(;g.hasNext();){let a=g.getNext().value,f=a.getKey();if(!b.isPrefixOf(f.path))break;f.path.length===e&&a.largestBatchId>c&&d.set(a.getKey(),a)}return a1.resolve(d)}getOverlaysForCollectionGroup(a,b,c,d){let e=new cE((a,b)=>a-b),f=this.overlays.getIterator();for(;f.hasNext();){let a=f.getNext().value;if(a.getKey().getCollectionGroup()===b&&a.largestBatchId>c){let b=e.get(a.largestBatchId);null===b&&(b=fl(),e=e.insert(a.largestBatchId,b)),b.set(a.getKey(),a)}}let g=fl(),h=e.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((a,b)=>g.set(a,b)),!(g.size()>=d)););return a1.resolve(g)}saveOverlay(a,b,c){let d=this.overlays.get(c.key);if(null!==d){let a=this.overlayByBatchId.get(d.largestBatchId).delete(c.key);this.overlayByBatchId.set(d.largestBatchId,a)}this.overlays=this.overlays.insert(c.key,new ga(b,c));let e=this.overlayByBatchId.get(b);void 0===e&&(e=fr(),this.overlayByBatchId.set(b,e)),this.overlayByBatchId.set(b,e.add(c.key))}}class j3{constructor(){this.sessionToken=cQ.EMPTY_BYTE_STRING}getSessionToken(a){return a1.resolve(this.sessionToken)}setSessionToken(a,b){return this.sessionToken=b,a1.resolve()}}class j4{constructor(){this.refsByKey=new cI(j5.compareByKey),this.refsByTarget=new cI(j5.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(a,b){let c=new j5(a,b);this.refsByKey=this.refsByKey.add(c),this.refsByTarget=this.refsByTarget.add(c)}addReferences(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.removeRef(new j5(a,b))}removeReferences(a,b){a.forEach(a=>this.removeReference(a,b))}removeReferencesForId(a){let b=new av(new as([])),c=new j5(b,a),d=new j5(b,a+1),e=[];return this.refsByTarget.forEachInRange([c,d],a=>{this.removeRef(a),e.push(a.key)}),e}removeAllReferences(){this.refsByKey.forEach(a=>this.removeRef(a))}removeRef(a){this.refsByKey=this.refsByKey.delete(a),this.refsByTarget=this.refsByTarget.delete(a)}referencesForId(a){let b=new av(new as([])),c=new j5(b,a),d=new j5(b,a+1),e=fr();return this.refsByTarget.forEachInRange([c,d],a=>{e=e.add(a.key)}),e}containsKey(a){let b=new j5(a,0),c=this.refsByKey.firstAfterOrEqual(b);return null!==c&&a.isEqual(c.key)}}class j5{constructor(a,b){this.key=a,this.targetOrBatchId=b}static compareByKey(a,b){return av.comparator(a.key,b.key)||aj(a.targetOrBatchId,b.targetOrBatchId)}static compareByTargetId(a,b){return aj(a.targetOrBatchId,b.targetOrBatchId)||av.comparator(a.key,b.key)}}class j6{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new cI(j5.compareByKey)}checkEmpty(a){return a1.resolve(0===this.mutationQueue.length)}addMutationBatch(a,b,c,d){let e=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let f=new f8(e,b,c,d);for(let b of(this.mutationQueue.push(f),d))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new j5(b.key,e)),this.indexManager.addToCollectionParentIndex(a,b.key.path.popLast());return a1.resolve(f)}lookupMutationBatch(a,b){return a1.resolve(this.findMutationBatch(b))}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=this.indexOfBatchId(c),e=d<0?0:d;return a1.resolve(this.mutationQueue.length>e?this.mutationQueue[e]:null)}getHighestUnacknowledgedBatchId(){return a1.resolve(0===this.mutationQueue.length?c7:this.nextBatchId-1)}getAllMutationBatches(a){return a1.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(a,b){let c=new j5(b,0),d=new j5(b,1/0),e=[];return this.batchesByDocumentKey.forEachInRange([c,d],a=>{let b=this.findMutationBatch(a.targetOrBatchId);e.push(b)}),a1.resolve(e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new cI(aj);return b.forEach(a=>{let b=new j5(a,0),d=new j5(a,1/0);this.batchesByDocumentKey.forEachInRange([b,d],a=>{c=c.add(a.targetOrBatchId)})}),a1.resolve(this.findMutationBatches(c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=c;av.isDocumentKey(e)||(e=e.child(""));let f=new j5(new av(e),0),g=new cI(aj);return this.batchesByDocumentKey.forEachWhile(a=>{let b=a.key.path;return!!c.isPrefixOf(b)&&(b.length===d&&(g=g.add(a.targetOrBatchId)),!0)},f),a1.resolve(this.findMutationBatches(g))}findMutationBatches(a){let b=[];return a.forEach(a=>{let c=this.findMutationBatch(a);null!==c&&b.push(c)}),b}removeMutationBatch(a,b){D(0===this.indexOfExistingBatchId(b.batchId,"removed"),55003),this.mutationQueue.shift();let c=this.batchesByDocumentKey;return a1.forEach(b.mutations,d=>{let e=new j5(d.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(a,d.key)}).next(()=>{this.batchesByDocumentKey=c})}removeCachedMutationKeys(a){}containsKey(a,b){let c=new j5(b,0),d=this.batchesByDocumentKey.firstAfterOrEqual(c);return a1.resolve(b.isEqual(d&&d.key))}performConsistencyCheck(a){return this.mutationQueue.length,a1.resolve()}indexOfExistingBatchId(a,b){return this.indexOfBatchId(a)}indexOfBatchId(a){return 0===this.mutationQueue.length?0:a-this.mutationQueue[0].batchId}findMutationBatch(a){let b=this.indexOfBatchId(a);return b<0||b>=this.mutationQueue.length?null:this.mutationQueue[b]}}let j7="-9223372036854775808";function j8(){return new cE(av.comparator)}class j9{constructor(a){this.sizer=a,this.docs=j8(),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(a,b){let c=b.key,d=this.docs.get(c),e=d?d.size:0,f=this.sizer(b);return this.docs=this.docs.insert(c,{document:b.mutableCopy(),size:f}),this.size+=f-e,this.indexManager.addToCollectionParentIndex(a,c.path.popLast())}removeEntry(a){let b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(a,b){let c=this.docs.get(b);return a1.resolve(c?c.document.mutableCopy():d0.newInvalidDocument(b))}getEntries(a,b){let c=fg();return b.forEach(a=>{let b=this.docs.get(a);c=c.insert(a,b?b.document.mutableCopy():d0.newInvalidDocument(a))}),a1.resolve(c)}getDocumentsMatchingQuery(a,b,c,d){let e=fg(),f=b.path,g=new av(f.child("__id"+j7+"__")),h=this.docs.getIteratorFrom(g);for(;h.hasNext();){let{key:a,value:{document:g}}=h.getNext();if(!f.isPrefixOf(a.path))break;!(a.path.length>f.length+1||0>=aZ(aX(g),c))&&(d.has(g.key)||e6(b,g))&&(e=e.insert(g.key,g.mutableCopy()))}return a1.resolve(e)}getAllFromCollectionGroup(a,b,c,d){B(9500)}forEachDocumentKey(a,b){return a1.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new kb(this)}getSize(a){return a1.resolve(this.size)}}function ka(a){return new j9(a)}class kb extends jQ{constructor(a){super(),this.documentCache=a}applyChanges(a){let b=[];return this.changes.forEach((c,d)=>{d.isValidDocument()?b.push(this.documentCache.addEntry(a,d)):this.documentCache.removeEntry(c)}),a1.waitFor(b)}getFromCache(a,b){return this.documentCache.getEntry(a,b)}getAllFromCache(a,b){return this.documentCache.getEntries(a,b)}}class kc{constructor(a){this.persistence=a,this.targets=new fe(a=>eA(a),eC),this.lastRemoteSnapshotVersion=aK.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new j4,this.targetCount=0,this.targetIdGenerator=ju.forTargetCache()}forEachTarget(a,b){return this.targets.forEach((a,c)=>b(c)),a1.resolve()}getLastRemoteSnapshotVersion(a){return a1.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return a1.resolve(this.highestSequenceNumber)}allocateTargetId(a){return this.highestTargetId=this.targetIdGenerator.next(),a1.resolve(this.highestTargetId)}setTargetsMetadata(a,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.highestSequenceNumber&&(this.highestSequenceNumber=b),a1.resolve()}saveTargetData(a){this.targets.set(a.target,a);let b=a.targetId;b>this.highestTargetId&&(this.targetIdGenerator=new ju(b),this.highestTargetId=b),a.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=a.sequenceNumber)}addTargetData(a,b){return this.saveTargetData(b),this.targetCount+=1,a1.resolve()}updateTargetData(a,b){return this.saveTargetData(b),a1.resolve()}removeTargetData(a,b){return this.targets.delete(b.target),this.references.removeReferencesForId(b.targetId),this.targetCount-=1,a1.resolve()}removeTargets(a,b,c){let d=0,e=[];return this.targets.forEach((f,g)=>{g.sequenceNumber<=b&&null===c.get(g.targetId)&&(this.targets.delete(f),e.push(this.removeMatchingKeysForTargetId(a,g.targetId)),d++)}),a1.waitFor(e).next(()=>d)}getTargetCount(a){return a1.resolve(this.targetCount)}getTargetData(a,b){let c=this.targets.get(b)||null;return a1.resolve(c)}addMatchingKeys(a,b,c){return this.references.addReferences(b,c),a1.resolve()}removeMatchingKeys(a,b,c){this.references.removeReferences(b,c);let d=this.persistence.referenceDelegate,e=[];return d&&b.forEach(b=>{e.push(d.markPotentiallyOrphaned(a,b))}),a1.waitFor(e)}removeMatchingKeysForTargetId(a,b){return this.references.removeReferencesForId(b),a1.resolve()}getMatchingKeysForTargetId(a,b){let c=this.references.referencesForId(b);return a1.resolve(c)}containsKey(a,b){return a1.resolve(this.references.containsKey(b))}}let kd="MemoryPersistence";class ke{constructor(a,b){this.mutationQueues={},this.overlays={},this.listenSequence=new bk(0),this._started=!1,this._started=!0,this.globalsCache=new j3,this.referenceDelegate=a(this),this.targetCache=new kc(this);const c=a=>this.referenceDelegate.documentSize(a);this.indexManager=new jb,this.remoteDocumentCache=ka(c),this.serializer=new hQ(b),this.bundleCache=new j1(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(a){let b=this.overlays[a.toKey()];return b||(b=new j2,this.overlays[a.toKey()]=b),b}getMutationQueue(a,b){let c=this.mutationQueues[a.toKey()];return c||(c=new j6(b,this.referenceDelegate),this.mutationQueues[a.toKey()]=c),c}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){x(kd,"Starting transaction:",a);let d=new kf(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),c(d).next(a=>this.referenceDelegate.onTransactionCommitted(d).next(()=>a)).toPromise().then(a=>(d.raiseOnCommittedEvent(),a))}mutationQueuesContainKey(a,b){return a1.or(Object.values(this.mutationQueues).map(c=>()=>c.containsKey(a,b)))}}class kf extends a_{constructor(a){super(),this.currentSequenceNumber=a}}class kg{constructor(a){this.persistence=a,this.localViewReferences=new j4,this._orphanedDocuments=null}static factory(a){return new kg(a)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw B(60996)}addReference(a,b,c){return this.localViewReferences.addReference(c,b),this.orphanedDocuments.delete(c.toString()),a1.resolve()}removeReference(a,b,c){return this.localViewReferences.removeReference(c,b),this.orphanedDocuments.add(c.toString()),a1.resolve()}markPotentiallyOrphaned(a,b){return this.orphanedDocuments.add(b.toString()),a1.resolve()}removeTarget(a,b){this.localViewReferences.removeReferencesForId(b.targetId).forEach(a=>this.orphanedDocuments.add(a.toString()));let c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(a,b.targetId).next(a=>{a.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>c.removeTargetData(a,b))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(a){let b=this.persistence.getRemoteDocumentCache().newChangeBuffer();return a1.forEach(this.orphanedDocuments,c=>{let d=av.fromPath(c);return this.isReferenced(a,d).next(a=>{a||b.removeEntry(d,aK.min())})}).next(()=>(this._orphanedDocuments=null,b.apply(a)))}updateLimboDocument(a,b){return this.isReferenced(a,b).next(a=>{a?this.orphanedDocuments.delete(b.toString()):this.orphanedDocuments.add(b.toString())})}documentSize(a){return 0}isReferenced(a,b){return a1.or([()=>a1.resolve(this.localViewReferences.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(a,b),()=>this.persistence.mutationQueuesContainKey(a,b)])}}class kh{constructor(a,b){this.persistence=a,this.orphanedSequenceNumbers=new fe(a=>bp(a.path),(a,b)=>a.isEqual(b)),this.garbageCollector=jL(this,b)}static factory(a,b){return new kh(a,b)}onTransactionStarted(){}onTransactionCommitted(a){return a1.resolve()}forEachTarget(a,b){return this.persistence.getTargetCache().forEachTarget(a,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.persistence.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachOrphanedDocumentSequenceNumber(a,b){return a1.forEach(this.orphanedSequenceNumbers,(c,d)=>this.isPinned(a,c,d).next(a=>a?a1.resolve():b(d)))}removeTargets(a,b,c){return this.persistence.getTargetCache().removeTargets(a,b,c)}removeOrphanedDocuments(a,b){let c=0,d=this.persistence.getRemoteDocumentCache(),e=d.newChangeBuffer();return d.forEachDocumentKey(a,d=>this.isPinned(a,d,b).next(a=>{a||(c++,e.removeEntry(d,aK.min()))})).next(()=>e.apply(a)).next(()=>c)}markPotentiallyOrphaned(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),a1.resolve()}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(a,c)}addReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),a1.resolve()}removeReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),a1.resolve()}updateLimboDocument(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),a1.resolve()}documentSize(a){let b=a.key.toString().length;return a.isFoundDocument()&&(b+=dH(a.data.value)),b}isPinned(a,b,c){return a1.or([()=>this.persistence.mutationQueuesContainKey(a,b),()=>this.persistence.getTargetCache().containsKey(a,b),()=>{let a=this.orphanedSequenceNumbers.get(b);return a1.resolve(void 0!==a&&a>c)}])}getCacheSize(a){return this.persistence.getRemoteDocumentCache().getSize(a)}}class ki{constructor(a){this.serializer=a}createOrUpgrade(a,b,c,d){let e=new a4("createOrUpgrade",b);c<1&&d>=1&&(kk(a),kl(a),kq(a),kn(a));let f=a1.resolve();return c<3&&d>=3&&(0!==c&&(kr(a),kq(a)),f=f.next(()=>kt(e))),c<4&&d>=4&&(0!==c&&(f=f.next(()=>km(a,e))),f=f.next(()=>{ku(a)})),c<5&&d>=5&&(f=f.next(()=>this.removeAcknowledgedMutations(e))),c<6&&d>=6&&(f=f.next(()=>(kp(a),this.addDocumentGlobal(e)))),c<7&&d>=7&&(f=f.next(()=>this.ensureSequenceNumbers(e))),c<8&&d>=8&&(f=f.next(()=>this.createCollectionParentIndex(a,e))),c<9&&d>=9&&(f=f.next(()=>{ks(a)})),c<10&&d>=10&&(f=f.next(()=>this.rewriteCanonicalIds(e))),c<11&&d>=11&&(f=f.next(()=>{kv(a),kw(a)})),c<12&&d>=12&&(f=f.next(()=>{ky(a)})),c<13&&d>=13&&(f=f.next(()=>ko(a)).next(()=>this.rewriteRemoteDocumentCache(a,e)).next(()=>a.deleteObjectStore(bt))),c<14&&d>=14&&(f=f.next(()=>this.runOverlayMigration(a,e))),c<15&&d>=15&&(f=f.next(()=>kx(a))),c<16&&d>=16&&(f=f.next(()=>{b.objectStore(b9).clear()}).next(()=>{b.objectStore(cd).clear()})),c<17&&d>=17&&(f=f.next(()=>{kz(a)})),c<18&&d>=18&&(0,i.isSafariOrWebkit)()&&(f=f.next(()=>{b.objectStore(b9).clear()}).next(()=>{b.objectStore(cd).clear()})),f}addDocumentGlobal(a){let b=0;return a.store(bt).iterate((a,c)=>{b+=jm(c)}).next(()=>{let c={byteSize:b};return a.store(bN).put(bO,c)})}removeAcknowledgedMutations(a){let b=a.store(bw),c=a.store(by);return b.loadAll().next(b=>a1.forEach(b,b=>{let d=IDBKeyRange.bound([b.userId,c7],[b.userId,b.lastAcknowledgedBatchId]);return c.loadAll(bA,d).next(c=>a1.forEach(c,c=>{D(c.userId===b.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let d=hY(this.serializer,c);return jl(a,b.userId,d).next(()=>{})}))}))}ensureSequenceNumbers(a){let b=a.store(bT),c=a.store(bt);return a.store(bY).get(bX).next(a=>{let d=c=>b.put({targetId:0,path:bp(c),sequenceNumber:a.highestListenSequenceNumber}),e=[];return c.iterate((a,c)=>{let f=new as(a),g=kj(f);e.push(b.get(g).next(a=>a?a1.resolve():d(f)))}).next(()=>a1.waitFor(e))})}createCollectionParentIndex(a,b){a.createObjectStore(bZ,{keyPath:b$});let c=b.store(bZ),d=new jc,e=a=>{if(d.add(a)){let b=a.lastSegment(),d=a.popLast();return c.put({collectionId:b,parent:bp(d)})}};return b.store(bt).iterate({keysOnly:!0},(a,b)=>e(new as(a).popLast())).next(()=>b.store(bG).iterate({keysOnly:!0},([a,b,c],d)=>e(bs(b).popLast())))}rewriteCanonicalIds(a){let b=a.store(bP);return b.iterate((a,c)=>{let d=hZ(c),e=h$(this.serializer,d);return b.put(e)})}rewriteRemoteDocumentCache(a,b){let c=b.store(bt),d=[];return c.iterate((a,c)=>{let e=b.store(bH),f=kA(c).path.toArray(),g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};d.push(e.put(g))}).next(()=>a1.waitFor(d))}runOverlayMigration(a,b){let c=b.store(by),d=jS(this.serializer),e=new ke(kg.factory,this.serializer.remoteSerializer);return c.loadAll().next(a=>{let c=new Map;return a.forEach(a=>{let b=c.get(a.userId)??fr();hY(this.serializer,a).keys().forEach(a=>b=b.add(a)),c.set(a.userId,b)}),a1.forEach(c,(a,c)=>{let f=new q(c),g=ih.forUser(this.serializer,f),h=e.getIndexManager(f);return new j0(d,jn.forUser(f,this.serializer,h,e.referenceDelegate),g,h).recalculateAndSaveOverlaysForDocumentKeys(new cy(b,bk.INVALID),a).next()})})}}function kj(a){return[0,bp(a)]}function kk(a){a.createObjectStore(bu)}function kl(a){a.createObjectStore(bw,{keyPath:bx}),a.createObjectStore(by,{keyPath:bz,autoIncrement:!0}).createIndex(bA,bB,{unique:!0}),a.createObjectStore(bG)}function km(a,b){return b.store(by).loadAll().next(c=>{a.deleteObjectStore(by),a.createObjectStore(by,{keyPath:bz,autoIncrement:!0}).createIndex(bA,bB,{unique:!0});let d=b.store(by),e=c.map(a=>d.put(a));return a1.waitFor(e)})}function kn(a){a.createObjectStore(bt)}function ko(a){let b=a.createObjectStore(bH,{keyPath:bI});b.createIndex(bJ,bK),b.createIndex(bL,bM)}function kp(a){a.createObjectStore(bN)}function kq(a){a.createObjectStore(bT,{keyPath:bU}).createIndex(bV,bW,{unique:!0}),a.createObjectStore(bP,{keyPath:bQ}).createIndex(bR,bS,{unique:!0}),a.createObjectStore(bY)}function kr(a){a.deleteObjectStore(bT),a.deleteObjectStore(bP),a.deleteObjectStore(bY)}function ks(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}function kt(a){let b=a.store(bY),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:aK.min().toTimestamp(),targetCount:0};return b.put(bX,c)}function ku(a){a.createObjectStore(b_,{keyPath:b0})}function kv(a){a.createObjectStore(b1,{keyPath:b2})}function kw(a){a.createObjectStore(b3,{keyPath:b4})}function kx(a){a.createObjectStore(b5,{keyPath:b6,autoIncrement:!0}).createIndex(b7,b8,{unique:!1}),a.createObjectStore(b9,{keyPath:ca}).createIndex(cb,cc,{unique:!1}),a.createObjectStore(cd,{keyPath:ce}).createIndex(cf,cg,{unique:!1})}function ky(a){let b=a.createObjectStore(ch,{keyPath:ci});b.createIndex(cj,ck,{unique:!1}),b.createIndex(cl,cm,{unique:!1})}function kz(a){a.createObjectStore(cn,{keyPath:co})}function kA(a){return a.document?new av(as.fromString(a.document.name).popFirst(5)):a.noDocument?av.fromSegments(a.noDocument.path):a.unknownDocument?av.fromSegments(a.unknownDocument.path):B(36783)}let kB="IndexedDbPersistence",kC=18e5,kD=5e3,kE=4e3,kF="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kG="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",kH="firestore_zombie",kI="main";class kJ{constructor(a,b,c,d,e,f,g,h,i,j,k=j$){if(this.allowTabSynchronization=a,this.persistenceKey=b,this.clientId=c,this.queue=e,this.window=f,this.document=g,this.sequenceNumberSyncer=i,this.forceOwningTab=j,this.schemaVersion=k,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=a=>Promise.resolve(),!kJ.isAvailable())throw new X(T,kG);this.referenceDelegate=new jM(this,d),this.dbName=b+kI,this.serializer=new hQ(h),this.simpleDb=new a5(this.dbName,this.schemaVersion,new ki(this.serializer)),this.globalsCache=new ij,this.targetCache=new jv(this.referenceDelegate,this.serializer),this.remoteDocumentCache=jS(this.serializer),this.bundleCache=new id,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===j&&y(kB,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new X(Q,kF);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.targetCache.getHighestSequenceNumber(a))}).then(a=>{this.listenSequence=new bk(a,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(a=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(a)))}setPrimaryStateListener(a){return this.primaryStateListener=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.simpleDb.setVersionChangeListener(async b=>{null===b.newVersion&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>kL(a).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(a).next(a=>{a||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(a)).next(b=>this.isPrimary&&!b?this.releasePrimaryLeaseIfHeld(a).next(()=>!1):!!b&&this.acquireOrExtendPrimaryLease(a).next(()=>!0))).catch(a=>{if(a9(a))return x(kB,"Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return x(kB,"Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.queue.enqueueRetryable(()=>this.primaryStateListener(a)),this.isPrimary=a})}verifyPrimaryLease(a){return kK(a).get(bv).next(a=>a1.resolve(this.isLocalClient(a)))}removeClientMetadata(a){return kL(a).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,kC)){this.lastGarbageCollectionTime=Date.now();let a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",a=>{let b=cz(a,b_);return b.loadAll().next(a=>{let c=this.filterActiveClients(a,kC),d=a.filter(a=>-1===c.indexOf(a));return a1.forEach(d,a=>b.delete(a.clientId)).next(()=>d)})}).catch(()=>[]);if(this.webStorage)for(let b of a)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(b.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",kE,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(a){return!!a&&a.ownerId===this.clientId}canActAsPrimary(a){return this.forceOwningTab?a1.resolve(!0):kK(a).get(bv).next(b=>{if(null!==b&&this.isWithinAge(b.leaseTimestampMs,kD)&&!this.isClientZombied(b.ownerId)){if(this.isLocalClient(b)&&this.networkEnabled)return!0;if(!this.isLocalClient(b)){if(!b.allowTabSynchronization)throw new X(Q,kF);return!1}}return!!this.networkEnabled&&!!this.inForeground||kL(a).loadAll().next(a=>void 0===this.filterActiveClients(a,kD).find(a=>{if(this.clientId!==a.clientId){let b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1}))}).next(a=>(this.isPrimary!==a&&x(kB,`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[bu,b_],a=>{let b=new cy(a,bk.INVALID);return this.releasePrimaryLeaseIfHeld(b).next(()=>this.removeClientMetadata(b))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(a,b){return a.filter(a=>this.isWithinAge(a.updateTimeMs,b)&&!this.isClientZombied(a.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",a=>kL(a).loadAll().next(a=>this.filterActiveClients(a,kC).map(a=>a.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(a,b){return jn.forUser(a,this.serializer,b,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(a){return new jf(a,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(a){return ih.forUser(this.serializer,a)}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){let d;x(kB,"Starting transaction:",a);let e="readonly"===b?"readonly":"readwrite",f=cx(this.schemaVersion);return this.simpleDb.runTransaction(a,e,f,e=>(d=new cy(e,this.listenSequence?this.listenSequence.next():bk.INVALID),"readwrite-primary"===b)?this.verifyPrimaryLease(d).next(a=>!!a||this.canActAsPrimary(d)).next(b=>{if(!b)throw y(`Failed to obtain primary lease for action '${a}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new X(Q,a$);return c(d)}).next(a=>this.acquireOrExtendPrimaryLease(d).next(()=>a)):this.verifyAllowTabSynchronization(d).next(()=>c(d))).then(a=>(d.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(a){return kK(a).get(bv).next(a=>{if(null!==a&&this.isWithinAge(a.leaseTimestampMs,kD)&&!this.isClientZombied(a.ownerId)&&!this.isLocalClient(a)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!a.allowTabSynchronization))throw new X(Q,kF)})}acquireOrExtendPrimaryLease(a){let b={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return kK(a).put(bv,b)}static isAvailable(){return a5.isAvailable()}releasePrimaryLeaseIfHeld(a){let b=kK(a);return b.get(bv).next(a=>this.isLocalClient(a)?(x(kB,"Releasing primary lease."),b.delete(bv)):a1.resolve())}isWithinAge(a,b){let c=Date.now(),d=c-b,e=c;return!(a<d)&&(!(a>e)||(y(`Detected an update time that is in the future: ${a} > ${e}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let a=/(?:Version|Mobile)\/1[456]/;(0,i.isSafari)()&&(navigator.appVersion.match(a)||navigator.userAgent.match(a))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(a){try{let b=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(a))!==null;return x(kB,`Client '${a}' ${b?"is":"is not"} zombied in LocalStorage`),b}catch(a){return y(kB,"Failed to get zombied client id.",a),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(a){y("Failed to set zombie client id.",a)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(a){}}zombiedClientLocalStorageKey(a){return`${kH}_${this.persistenceKey}_${a}`}}function kK(a){return cz(a,bu)}function kL(a){return cz(a,b_)}function kM(a,b){let c=a.projectId;return a.isDefaultDatabase||(c+="."+a.database),"firestore/"+b+"/"+c+"/"}async function kN(a){if(!a5.isAvailable())return Promise.resolve();let b=a+kI;await a5.delete(b)}function kO(a,b,c,d,e){b=[...b],(a=[...a]).sort(c),b.sort(c);let f=a.length,g=b.length,h=0,i=0;for(;h<g&&i<f;){let f=c(a[i],b[h]);f<0?e(a[i++]):f>0?d(b[h++]):(h++,i++)}for(;h<g;)d(b[h++]);for(;i<f;)e(a[i++])}function kP(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}let kQ="LocalStore",kR=3e8;class kS{constructor(a,b,c,d){this.persistence=a,this.queryEngine=b,this.serializer=d,this.targetDataByTarget=new cE(aj),this.targetIdByTarget=new fe(a=>eA(a),eC),this.collectionGroupReadTime=new Map,this.remoteDocuments=a.getRemoteDocumentCache(),this.targetCache=a.getTargetCache(),this.bundleCache=a.getBundleCache(),this.initializeUserComponents(c)}initializeUserComponents(a){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(a),this.indexManager=this.persistence.getIndexManager(a),this.mutationQueue=this.persistence.getMutationQueue(a,this.indexManager),this.localDocuments=new j0(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.targetDataByTarget))}}function kT(a,b,c,d){return new kS(a,b,c,d)}async function kU(a,b){let c=F(a);return await c.persistence.runTransaction("Handle user change","readonly",a=>{let d;return c.mutationQueue.getAllMutationBatches(a).next(e=>(d=e,c.initializeUserComponents(b),c.mutationQueue.getAllMutationBatches(a))).next(b=>{let e=[],f=[],g=fr();for(let a of d)for(let b of(e.push(a.batchId),a.mutations))g=g.add(b.key);for(let a of b)for(let b of(f.push(a.batchId),a.mutations))g=g.add(b.key);return c.localDocuments.getDocuments(a,g).next(a=>({affectedDocuments:a,removedBatchIds:e,addedBatchIds:f}))})})}function kV(a,b){let c,d,e=F(a),f=aJ.now(),g=b.reduce((a,b)=>a.add(b.key),fr());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let h=fg(),i=fr();return e.remoteDocuments.getEntries(a,g).next(a=>{(h=a).forEach((a,b)=>{b.isValidDocument()||(i=i.add(a))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,h)).next(d=>{c=d;let g=[];for(let a of b){let b=fV(a,c.get(a.key).overlayedDocument);null!=b&&g.push(new f$(a.key,b,d_(b.value.mapValue),fP.exists(!0)))}return e.mutationQueue.addMutationBatch(a,f,g,b)}).next(b=>{d=b;let f=b.applyToLocalDocumentSet(c,i);return e.documentOverlayCache.saveOverlays(a,b.batchId,f)})}).then(()=>({batchId:d.batchId,changes:fk(c)}))}function kW(a,b){let c=F(a);return c.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{let d=b.batch.keys(),e=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});return k9(c,a,b,e).next(()=>e.apply(a)).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b.batch.batchId)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,kX(b))).next(()=>c.localDocuments.getDocuments(a,d))})}function kX(a){let b=fr();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(b=b.add(a.batch.mutations[c].key));return b}function kY(a,b){let c=F(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",a=>{let d;return c.mutationQueue.lookupMutationBatch(a,b).next(b=>(D(null!==b,37113),d=b.keys(),c.mutationQueue.removeMutationBatch(a,b))).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,d)).next(()=>c.localDocuments.getDocuments(a,d))})}function kZ(a){let b=F(a);return b.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>b.mutationQueue.getHighestUnacknowledgedBatchId(a))}function k$(a){let b=F(a);return b.persistence.runTransaction("Get last remote snapshot version","readonly",a=>b.targetCache.getLastRemoteSnapshotVersion(a))}function k_(a,b){let c=F(a),d=b.snapshotVersion,e=c.targetDataByTarget;return c.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{let f=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});e=c.targetDataByTarget;let g=[];b.targetChanges.forEach((f,h)=>{let i=e.get(h);if(!i)return;g.push(c.targetCache.removeMatchingKeys(a,f.removedDocuments,h).next(()=>c.targetCache.addMatchingKeys(a,f.addedDocuments,h)));let j=i.withSequenceNumber(a.currentSequenceNumber);null!==b.targetMismatches.get(h)?j=j.withResumeToken(cQ.EMPTY_BYTE_STRING,aK.min()).withLastLimboFreeSnapshotVersion(aK.min()):f.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(f.resumeToken,d)),e=e.insert(h,j),k1(i,j,f)&&g.push(c.targetCache.updateTargetData(a,j))});let h=fg(),i=fr();if(b.documentUpdates.forEach(d=>{b.resolvedLimboDocuments.has(d)&&g.push(c.persistence.referenceDelegate.updateLimboDocument(a,d))}),g.push(k0(a,f,b.documentUpdates).next(a=>{h=a.changedDocuments,i=a.existenceChangedKeys})),!d.isEqual(aK.min())){let b=c.targetCache.getLastRemoteSnapshotVersion(a).next(b=>c.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,d));g.push(b)}return a1.waitFor(g).next(()=>f.apply(a)).next(()=>c.localDocuments.getLocalViewOfDocuments(a,h,i)).next(()=>h)}).then(a=>(c.targetDataByTarget=e,a))}function k0(a,b,c){let d=fr(),e=fr();return c.forEach(a=>d=d.add(a)),b.getEntries(a,d).next(a=>{let d=fg();return c.forEach((c,f)=>{let g=a.get(c);f.isFoundDocument()!==g.isFoundDocument()&&(e=e.add(c)),f.isNoDocument()&&f.version.isEqual(aK.min())?(b.removeEntry(c,f.readTime),d=d.insert(c,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||0===f.version.compareTo(g.version)&&g.hasPendingWrites?(b.addEntry(f),d=d.insert(c,f)):x(kQ,"Ignoring outdated watch update for ",c,". Current version:",g.version," Watch version:",f.version)}),{changedDocuments:d,existenceChangedKeys:e}})}function k1(a,b,c){return!!(0===a.resumeToken.approximateByteSize()||b.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=kR)||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0}async function k2(a,b){let c=F(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",a=>a1.forEach(b,b=>a1.forEach(b.addedKeys,d=>c.persistence.referenceDelegate.addReference(a,b.targetId,d)).next(()=>a1.forEach(b.removedKeys,d=>c.persistence.referenceDelegate.removeReference(a,b.targetId,d)))))}catch(a){if(a9(a))x(kQ,"Failed to update sequence numbers: "+a);else throw a}for(let a of b){let b=a.targetId;if(!a.fromCache){let a=c.targetDataByTarget.get(b),d=a.snapshotVersion,e=a.withLastLimboFreeSnapshotVersion(d);c.targetDataByTarget=c.targetDataByTarget.insert(b,e)}}}function k3(a,b){let c=F(a);return c.persistence.runTransaction("Get next mutation batch","readonly",a=>(void 0===b&&(b=c7),c.mutationQueue.getNextMutationBatchAfterBatchId(a,b)))}function k4(a,b){let c=F(a);return c.persistence.runTransaction("read document","readonly",a=>c.localDocuments.getDocument(a,b))}function k5(a,b){let c=F(a);return c.persistence.runTransaction("Allocate target","readwrite",a=>{let d;return c.targetCache.getTargetData(a,b).next(e=>e?(d=e,a1.resolve(d)):c.targetCache.allocateTargetId(a).next(e=>(d=new hP(b,e,"TargetPurposeListen",a.currentSequenceNumber),c.targetCache.addTargetData(a,d).next(()=>d))))}).then(a=>{let d=c.targetDataByTarget.get(a.targetId);return(null===d||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(c.targetDataByTarget=c.targetDataByTarget.insert(a.targetId,a),c.targetIdByTarget.set(b,a.targetId)),a})}function k6(a,b,c){let d=F(a),e=d.targetIdByTarget.get(c);return void 0!==e?a1.resolve(d.targetDataByTarget.get(e)):d.targetCache.getTargetData(b,c)}async function k7(a,b,c){let d=F(a),e=d.targetDataByTarget.get(b),f=c?"readwrite":"readwrite-primary";try{c||await d.persistence.runTransaction("Release target",f,a=>d.persistence.referenceDelegate.removeTarget(a,e))}catch(a){if(a9(a))x(kQ,`Failed to update sequence numbers for target ${b}: ${a}`);else throw a}d.targetDataByTarget=d.targetDataByTarget.remove(b),d.targetIdByTarget.delete(e.target)}function k8(a,b,c){let d=F(a),e=aK.min(),f=fr();return d.persistence.runTransaction("Execute query","readwrite",a=>k6(d,a,eX(b)).next(b=>{if(b)return e=b.lastLimboFreeSnapshotVersion,d.targetCache.getMatchingKeysForTargetId(a,b.targetId).next(a=>{f=a})}).next(()=>d.queryEngine.getDocumentsMatchingQuery(a,b,c?e:aK.min(),c?f:fr())).next(a=>(lf(d,fb(b),a),{documents:a,remoteKeys:f})))}function k9(a,b,c,d){let e=c.batch,f=e.keys(),g=a1.resolve();return f.forEach(a=>{g=g.next(()=>d.getEntry(b,a)).next(b=>{let f=c.docVersions.get(a);D(null!==f,48541),0>b.version.compareTo(f)&&(e.applyToRemoteDocument(b,c),b.isValidDocument()&&(b.setReadTime(c.commitVersion),d.addEntry(b)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(b,e))}function la(a,b){let c=F(a),d=F(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",a=>d.lookupMutationKeys(a,b).next(b=>b?c.localDocuments.getDocuments(a,b):a1.resolve(null)))}function lb(a,b){F(F(a,kS).mutationQueue).removeCachedMutationKeys(b)}function lc(a){return F(F(a,kS).persistence).getActiveClients()}function ld(a,b){let c=F(a),d=F(c.targetCache),e=c.targetDataByTarget.get(b);return e?Promise.resolve(e.target):c.persistence.runTransaction("Get target data","readonly",a=>d.getTargetDataForTarget(a,b).next(a=>a?a.target:null))}function le(a,b){let c=F(a),d=c.collectionGroupReadTime.get(b)||aK.min();return c.persistence.runTransaction("Get new document changes","readonly",a=>c.remoteDocuments.getAllFromCollectionGroup(a,b,aW(d,aL),Number.MAX_SAFE_INTEGER)).then(a=>(lf(c,b,a),a))}function lf(a,b,c){let d=a.collectionGroupReadTime.get(b)||aK.min();c.forEach((a,b)=>{b.readTime.compareTo(d)>0&&(d=b.readTime)}),a.collectionGroupReadTime.set(b,d)}function lg(a){return eX(eP(as.fromString(`__bundle__/docs/${a}`)))}async function lh(a,b,c,d){let e=F(a),f=fr(),g=fg();for(let a of c){let c=b.toDocumentKey(a.metadata.name);a.document&&(f=f.add(c));let d=b.toMutableDocument(a);d.setReadTime(b.toSnapshotVersion(a.metadata.readTime)),g=g.insert(c,d)}let h=e.remoteDocuments.newChangeBuffer({trackRemovals:!0}),i=await k5(e,lg(d));return e.persistence.runTransaction("Apply bundle documents","readwrite",a=>k0(a,h,g).next(b=>(h.apply(a),b)).next(b=>e.targetCache.removeMatchingKeysForTargetId(a,i.targetId).next(()=>e.targetCache.addMatchingKeys(a,f,i.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(a,b.changedDocuments,b.existenceChangedKeys)).next(()=>b.changedDocuments)))}function li(a,b){let c=F(a),d=gN(b.createTime);return c.persistence.runTransaction("hasNewerBundle","readonly",a=>c.bundleCache.getBundleMetadata(a,b.id)).then(a=>!!a&&a.createTime.compareTo(d)>=0)}function lj(a,b){let c=F(a);return c.persistence.runTransaction("Save bundle","readwrite",a=>c.bundleCache.saveBundleMetadata(a,b))}function lk(a,b){let c=F(a);return c.persistence.runTransaction("Get named query","readonly",a=>c.bundleCache.getNamedQuery(a,b))}async function ll(a,b,c=fr()){let d=await k5(a,eX(h4(b.bundledQuery))),e=F(a);return e.persistence.runTransaction("Save named query","readwrite",a=>{let f=gN(b.readTime);if(d.snapshotVersion.compareTo(f)>=0)return e.bundleCache.saveNamedQuery(a,b);let g=d.withResumeToken(cQ.EMPTY_BYTE_STRING,f);return e.targetDataByTarget=e.targetDataByTarget.insert(g.targetId,g),e.targetCache.updateTargetData(a,g).next(()=>e.targetCache.removeMatchingKeysForTargetId(a,d.targetId)).next(()=>e.targetCache.addMatchingKeys(a,c,d.targetId)).next(()=>e.bundleCache.saveNamedQuery(a,b))})}async function lm(a,b){let c=F(a),d=c.indexManager,e=[];return c.persistence.runTransaction("Configure indexes","readwrite",a=>d.getFieldIndexes(a).next(c=>kO(c,b,aR,b=>{e.push(d.addFieldIndex(a,b))},b=>{e.push(d.deleteFieldIndex(a,b))})).next(()=>a1.waitFor(e)))}function ln(a,b){F(a).queryEngine.indexAutoCreationEnabled=b}function lo(a){let b=F(a),c=b.indexManager;return b.persistence.runTransaction("Delete All Indexes","readwrite",a=>c.deleteAllFieldIndexes(a))}class lp{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(a){this._documentReadCount+=a}}let lq=100;function lr(){return(0,i.isSafari)()?8:a6((0,i.getUA)())>0?6:4}class ls{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=lq,this.relativeIndexReadCostPerDocument=lr()}initialize(a,b){this.localDocumentsView=a,this.indexManager=b,this.initialized=!0}getDocumentsMatchingQuery(a,b,c,d){let e={result:null};return this.performQueryUsingIndex(a,b).next(a=>{e.result=a}).next(()=>{if(!e.result)return this.performQueryUsingRemoteKeys(a,b,d,c).next(a=>{e.result=a})}).next(()=>{if(e.result)return;let c=new lp;return this.executeFullCollectionScan(a,b,c).next(d=>{if(e.result=d,this.indexAutoCreationEnabled)return this.createCacheIndexes(a,b,c,d.size)})}).next(()=>e.result)}createCacheIndexes(a,b,c,d){return c.documentReadCount<this.indexAutoCreationMinCollectionSize?(v()<=l.LogLevel.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",e5(b),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),a1.resolve()):(v()<=l.LogLevel.DEBUG&&x("QueryEngine","Query:",e5(b),"scans",c.documentReadCount,"local documents and returns",d,"documents as results."),c.documentReadCount>this.relativeIndexReadCostPerDocument*d)?(v()<=l.LogLevel.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",e5(b),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(a,eX(b))):a1.resolve()}performQueryUsingIndex(a,b){if(eR(b))return a1.resolve(null);let c=eX(b);return this.indexManager.getIndexType(a,c).next(d=>0===d?null:(null!==b.limit&&1===d&&(c=eX(b=e0(b,null,"F"))),this.indexManager.getDocumentsMatchingTarget(a,c).next(d=>{let e=fr(...d);return this.localDocumentsView.getDocuments(a,e).next(d=>this.indexManager.getMinOffset(a,c).next(c=>{let f=this.applyQuery(b,d);return this.needsRefill(b,f,e,c.readTime)?this.performQueryUsingIndex(a,e0(b,null,"F")):this.appendRemainingResults(a,f,b,c)}))})))}performQueryUsingRemoteKeys(a,b,c,d){return eR(b)||d.isEqual(aK.min())?a1.resolve(null):this.localDocumentsView.getDocuments(a,c).next(e=>{let f=this.applyQuery(b,e);return this.needsRefill(b,f,c,d)?a1.resolve(null):(v()<=l.LogLevel.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),e5(b)),this.appendRemainingResults(a,f,b,aW(d,aL)).next(a=>a))})}applyQuery(a,b){let c=new cI(fc(a));return b.forEach((b,d)=>{e6(a,d)&&(c=c.add(d))}),c}needsRefill(a,b,c,d){if(null===a.limit)return!1;if(c.size!==b.size)return!0;let e="F"===a.limitType?b.last():b.first();return!!e&&(e.hasPendingWrites||e.version.compareTo(d)>0)}executeFullCollectionScan(a,b,c){return v()<=l.LogLevel.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",e5(b)),this.localDocumentsView.getDocumentsMatchingQuery(a,b,aY.min(),c)}appendRemainingResults(a,b,c,d){return this.localDocumentsView.getDocumentsMatchingQuery(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}}let lt="firestore_clients";function lu(a,b){return`${lt}_${a}_${b}`}let lv="firestore_mutations";function lw(a,b,c){let d=`${lv}_${a}_${c}`;return b.isAuthenticated()&&(d+=`_${b.uid}`),d}let lx="firestore_targets";function ly(a,b){return`${lx}_${a}_${b}`}let lz="firestore_online_state";function lA(a){return`${lz}_${a}`}let lB="firestore_bundle_loaded_v2";function lC(a){return`${lB}_${a}`}let lD="firestore_sequence_number";function lE(a){return`${lD}_${a}`}let lF="SharedClientState";class lG{constructor(a,b,c,d){this.user=a,this.batchId=b,this.state=c,this.error=d}static fromWebStorageEntry(a,b,c){let d,e=JSON.parse(c),f="object"==typeof e&&-1!==["pending","acknowledged","rejected"].indexOf(e.state)&&(void 0===e.error||"object"==typeof e.error);return(f&&e.error&&(f="string"==typeof e.error.message&&"string"==typeof e.error.code)&&(d=new X(e.error.code,e.error.message)),f)?new lG(a,b,e.state,d):(y(lF,`Failed to parse mutation state for ID '${b}': ${c}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class lH{constructor(a,b,c){this.targetId=a,this.state=b,this.error=c}static fromWebStorageEntry(a,b){let c,d=JSON.parse(b),e="object"==typeof d&&-1!==["not-current","current","rejected"].indexOf(d.state)&&(void 0===d.error||"object"==typeof d.error);return(e&&d.error&&(e="string"==typeof d.error.message&&"string"==typeof d.error.code)&&(c=new X(d.error.code,d.error.message)),e)?new lH(a,d.state,c):(y(lF,`Failed to parse target state for ID '${a}': ${b}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class lI{constructor(a,b){this.clientId=a,this.activeTargetIds=b}static fromWebStorageEntry(a,b){let c=JSON.parse(b),d="object"==typeof c&&c.activeTargetIds instanceof Array,e=ft();for(let a=0;d&&a<c.activeTargetIds.length;++a)d=da(c.activeTargetIds[a]),e=e.add(c.activeTargetIds[a]);return d?new lI(a,e):(y(lF,`Failed to parse client data for instance '${a}': ${b}`),null)}}class lJ{constructor(a,b){this.clientId=a,this.onlineState=b}static fromWebStorageEntry(a){let b=JSON.parse(a);return"object"==typeof b&&-1!==["Unknown","Online","Offline"].indexOf(b.onlineState)&&"string"==typeof b.clientId?new lJ(b.clientId,b.onlineState):(y(lF,`Failed to parse online state: ${a}`),null)}}class lK{constructor(){this.activeTargetIds=ft()}addQueryTarget(a){this.activeTargetIds=this.activeTargetIds.add(a)}removeQueryTarget(a){this.activeTargetIds=this.activeTargetIds.delete(a)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lL{constructor(a,b,c,d,e){this.window=a,this.queue=b,this.persistenceKey=c,this.localClientId=d,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new cE(aj),this.started=!1,this.earlyEvents=[];const f=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=e,this.localClientStorageKey=lu(this.persistenceKey,this.localClientId),this.sequenceNumberKey=lE(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new lK),this.clientStateKeyRe=RegExp(`^${lt}_${f}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${lv}_${f}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${lx}_${f}_(\\d+)$`),this.onlineStateKey=lA(this.persistenceKey),this.bundleLoadedKey=lC(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(a){return!!(a&&a.localStorage)}async start(){for(let a of(await this.syncEngine.getActiveClients())){if(a===this.localClientId)continue;let b=this.getItem(lu(this.persistenceKey,a));if(b){let c=lI.fromWebStorageEntry(a,b);c&&(this.activeClients=this.activeClients.insert(c.clientId,c))}}this.persistClientState();let a=this.storage.getItem(this.onlineStateKey);if(a){let b=this.fromWebStorageOnlineState(a);b&&this.handleOnlineStateEvent(b)}for(let a of this.earlyEvents)this.handleWebStorageEvent(a);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(a){this.setItem(this.sequenceNumberKey,JSON.stringify(a))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(a){let b=!1;return this.activeClients.forEach((c,d)=>{d.activeTargetIds.has(a)&&(b=!0)}),b}addPendingMutation(a){this.persistMutationState(a,"pending")}updateMutationState(a,b,c){this.persistMutationState(a,b,c),this.removeMutationState(a)}addLocalQueryTarget(a,b=!0){let c="not-current";if(this.isActiveQueryTarget(a)){let b=this.storage.getItem(ly(this.persistenceKey,a));if(b){let d=lH.fromWebStorageEntry(a,b);d&&(c=d.state)}}return b&&this.localClientState.addQueryTarget(a),this.persistClientState(),c}removeLocalQueryTarget(a){this.localClientState.removeQueryTarget(a),this.persistClientState()}isLocalQueryTarget(a){return this.localClientState.activeTargetIds.has(a)}clearQueryState(a){this.removeItem(ly(this.persistenceKey,a))}updateQueryState(a,b,c){this.persistQueryTargetState(a,b,c)}handleUserChange(a,b,c){b.forEach(a=>{this.removeMutationState(a)}),this.currentUser=a,c.forEach(a=>{this.addPendingMutation(a)})}setOnlineState(a){this.persistOnlineState(a)}notifyBundleLoaded(a){this.persistBundleLoadedState(a)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(a){let b=this.storage.getItem(a);return x(lF,"READ",a,b),b}setItem(a,b){x(lF,"SET",a,b),this.storage.setItem(a,b)}removeItem(a){x(lF,"REMOVE",a),this.storage.removeItem(a)}handleWebStorageEvent(a){let b=a;if(b.storageArea===this.storage){if(x(lF,"EVENT",b.key,b.newValue),b.key===this.localClientStorageKey)return void y("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(b);if(null!==b.key){if(this.clientStateKeyRe.test(b.key))if(null!=b.newValue){let a=this.fromWebStorageClientState(b.key,b.newValue);if(a)return this.handleClientStateEvent(a.clientId,a)}else{let a=this.fromWebStorageClientStateKey(b.key);return this.handleClientStateEvent(a,null)}else if(this.mutationBatchKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageMutationMetadata(b.key,b.newValue);if(a)return this.handleMutationBatchEvent(a)}}else if(this.queryTargetKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageQueryTargetMetadata(b.key,b.newValue);if(a)return this.handleQueryTargetEvent(a)}}else if(b.key===this.onlineStateKey){if(null!==b.newValue){let a=this.fromWebStorageOnlineState(b.newValue);if(a)return this.handleOnlineStateEvent(a)}}else if(b.key===this.sequenceNumberKey){let a=lM(b.newValue);a!==bk.INVALID&&this.sequenceNumberHandler(a)}else if(b.key===this.bundleLoadedKey){let a=this.fromWebStoreBundleLoadedState(b.newValue);await Promise.all(a.map(a=>this.syncEngine.synchronizeWithChangedDocuments(a)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(a,b,c){let d=new lG(this.currentUser,a,b,c),e=lw(this.persistenceKey,this.currentUser,a);this.setItem(e,d.toWebStorageJSON())}removeMutationState(a){let b=lw(this.persistenceKey,this.currentUser,a);this.removeItem(b)}persistOnlineState(a){let b={clientId:this.localClientId,onlineState:a};this.storage.setItem(this.onlineStateKey,JSON.stringify(b))}persistQueryTargetState(a,b,c){let d=ly(this.persistenceKey,a),e=new lH(a,b,c);this.setItem(d,e.toWebStorageJSON())}persistBundleLoadedState(a){let b=JSON.stringify(Array.from(a));this.setItem(this.bundleLoadedKey,b)}fromWebStorageClientStateKey(a){let b=this.clientStateKeyRe.exec(a);return b?b[1]:null}fromWebStorageClientState(a,b){let c=this.fromWebStorageClientStateKey(a);return lI.fromWebStorageEntry(c,b)}fromWebStorageMutationMetadata(a,b){let c=this.mutationBatchKeyRe.exec(a),d=Number(c[1]),e=void 0!==c[2]?c[2]:null;return lG.fromWebStorageEntry(new q(e),d,b)}fromWebStorageQueryTargetMetadata(a,b){let c=Number(this.queryTargetKeyRe.exec(a)[1]);return lH.fromWebStorageEntry(c,b)}fromWebStorageOnlineState(a){return lJ.fromWebStorageEntry(a)}fromWebStoreBundleLoadedState(a){return JSON.parse(a)}async handleMutationBatchEvent(a){return a.user.uid!==this.currentUser.uid?void x(lF,`Ignoring mutation for non-active user ${a.user.uid}`):this.syncEngine.applyBatchState(a.batchId,a.state,a.error)}handleQueryTargetEvent(a){return this.syncEngine.applyTargetState(a.targetId,a.state,a.error)}handleClientStateEvent(a,b){let c=b?this.activeClients.insert(a,b):this.activeClients.remove(a),d=this.extractActiveQueryTargets(this.activeClients),e=this.extractActiveQueryTargets(c),f=[],g=[];return e.forEach(a=>{d.has(a)||f.push(a)}),d.forEach(a=>{e.has(a)||g.push(a)}),this.syncEngine.applyActiveTargetsChange(f,g).then(()=>{this.activeClients=c})}handleOnlineStateEvent(a){this.activeClients.get(a.clientId)&&this.onlineStateHandler(a.onlineState)}extractActiveQueryTargets(a){let b=ft();return a.forEach((a,c)=>{b=b.unionWith(c.activeTargetIds)}),b}}function lM(a){let b=bk.INVALID;if(null!=a)try{let c=JSON.parse(a);D("number"==typeof c,30636,{seqString:a}),b=c}catch(a){y(lF,"Failed to read sequence number from WebStorage",a)}return b}class lN{constructor(){this.localState=new lK,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a,b=!0){return b&&this.localState.addQueryTarget(a),this.queryState[a]||"not-current"}updateQueryState(a,b,c){this.queryState[a]=b}removeLocalQueryTarget(a){this.localState.removeQueryTarget(a)}isLocalQueryTarget(a){return this.localState.activeTargetIds.has(a)}clearQueryState(a){delete this.queryState[a]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(a){return this.localState.activeTargetIds.has(a)}start(){return this.localState=new lK,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}}class lO{addCallback(a){}shutdown(){}}class lP{constructor(a){this.sendFn=a.sendFn,this.closeFn=a.closeFn}onConnected(a){this.wrappedOnConnected=a}onOpen(a){this.wrappedOnOpen=a}onClose(a){this.wrappedOnClose=a}onMessage(a){this.wrappedOnMessage=a}close(){this.closeFn()}send(a){this.sendFn(a)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(a){this.wrappedOnClose(a)}callOnMessage(a){this.wrappedOnMessage(a)}}let lQ=null;function lR(){return 0x10000000+Math.round(0x80000000*Math.random())}function lS(){return null===lQ?lQ=lR():lQ++,"0x"+lQ.toString(16)}function lT(a){return new Promise((b,c)=>{a((a,d)=>{a?c(a):b(d)})})}let lU="1.9.15",lV="GrpcConnection",lW=`gl-node/${process.versions.node} fire/${r} grpc/${lU}`;function lX(a,b,c,d,e){D(null===b||"OAuth"===b.type,36936);let f=new o.Metadata;return b&&b.headers.forEach((a,b)=>f.set(b,a)),c&&c.headers.forEach((a,b)=>f.set(b,a)),d&&f.set("X-Firebase-GMPID",d),f.set("X-Goog-Api-Client",lW),f.set("Google-Cloud-Resource-Prefix",a),f.set("x-goog-request-params",a),e&&f.set("X-Goog-Api-Key",e),f}class lY{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(a,b){this.databaseInfo=b,this.cachedStub=null,this.firestore=a.google.firestore.v1,this.databasePath=`projects/${b.databaseId.projectId}/databases/${b.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){x(lV,"Creating Firestore stub.");let a=this.databaseInfo.ssl?o.credentials.createSsl():o.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,a)}return this.cachedStub}invokeRPC(a,b,c,d,e){let f=lS(),g=this.ensureActiveStub(),h=lX(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),i={database:this.databasePath,...c};return lT(b=>(x(lV,`RPC '${a}' ${f} invoked with request:`,c),g[a](i,h,(c,d)=>{c?(x(lV,`RPC '${a}' ${f} failed with error:`,c),b(new X(ge(c.code),c.message))):(x(lV,`RPC '${a}' ${f} completed with response:`,d),b(void 0,d))})))}invokeStreamingRPC(a,b,c,d,e,f){let g=lS(),h=[],i=new Y;x(lV,`RPC '${a}' ${g} invoked (streaming) with request:`,c);let j=this.ensureActiveStub(),k=lX(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),l={...c,database:this.databasePath},m=j[a](l,k),n=!1;return m.on("data",b=>{x(lV,`RPC ${a} ${g} received result:`,b),h.push(b),void 0!==f&&h.length===f&&(n=!0,i.resolve(h))}),m.on("end",()=>{x(lV,`RPC '${a}' ${g} completed.`),n||(n=!0,i.resolve(h))}),m.on("error",b=>{x(lV,`RPC '${a}' ${g} failed with error:`,b);let c=ge(b.code);i.reject(new X(c,b.message))}),i.promise}openStream(a,b,c){let d=lS(),e=this.ensureActiveStub(),f=lX(this.databasePath,b,c,this.databaseInfo.appId,this.databaseInfo.apiKey),g=e[a](f),h=!1,i=a=>{h||(h=!0,j.callOnClose(a),g.end())},j=new lP({sendFn:b=>{if(h)x(lV,`RPC '${a}' stream ${d} not sending because gRPC stream is closed:`,b);else{x(lV,`RPC '${a}' stream ${d} sending:`,b);try{g.write(b)}catch(a){throw y("Failure sending:",b),y("Error:",a),a}}},closeFn:()=>{x(lV,`RPC '${a}' stream ${d} closed locally via close().`),i()}}),k=!1;return g.on("data",b=>{h||(x(lV,`RPC '${a}' stream ${d} received:`,b),k||(j.callOnConnected(),k=!0),j.callOnMessage(b))}),g.on("end",()=>{x(lV,`RPC '${a}' stream ${d} ended.`),i()}),g.on("error",b=>{h||(z(lV,`RPC '${a}' stream ${d} error. Code:`,b.code,"Message:",b.message),i(new X(ge(b.code),b.message)))}),x(lV,`Opening RPC '${a}' stream ${d} to ${this.databaseInfo.host}`),setTimeout(()=>{j.callOnOpen()},0),j}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let lZ={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var l$={nested:lZ},l_=Object.freeze({__proto__:null,nested:lZ,default:l$});let l0={longs:String,enums:String,defaults:!0,oneofs:!1};function l1(){let a=p.fromJSON(l_,l0);return o.loadPackageDefinition(a)}function l2(a){return new lY(l1(),a)}function l3(){return new lO}function l4(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function l5(){return null}function l6(a){return new gE(a,!1)}let l7="ExponentialBackoff",l8=1e3,l9=1.5,ma=6e4;class mb{constructor(a,b,c=l8,d=l9,e=ma){this.queue=a,this.timerId=b,this.initialDelayMs=c,this.backoffFactor=d,this.maxDelayMs=e,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(a){this.cancel();let b=Math.floor(this.currentBaseMs+this.jitterDelayMs()),c=Math.max(0,Date.now()-this.lastAttemptTime),d=Math.max(0,b-c);d>0&&x(l7,`Backing off for ${d} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${b} ms, last attempt: ${c} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,d,()=>(this.lastAttemptTime=Date.now(),a())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let mc="PersistentStream",md=6e4,me=1e4;class mf{constructor(a,b,c,d,e,f,g,h){this.queue=a,this.idleTimerId=c,this.healthTimerId=d,this.connection=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new mb(a,b)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,md,()=>this.handleIdleCloseTimer()))}sendRequest(a){this.cancelIdleCheck(),this.stream.send(a)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(a,b){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==a?this.backoff.reset():b&&b.code===P?(y(b.toString()),y("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):b&&b.code===O&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=a,await this.listener.onClose(b)}tearDown(){}auth(){this.state=1;let a=this.getCloseGuardedDispatcher(this.closeCount),b=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,c])=>{this.closeCount===b&&this.startStream(a,c)},b=>{a(()=>{let a=new X(I,"Fetching auth token failed: "+b.message);return this.handleStreamClose(a)})})}startStream(a,b){let c=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(a,b),this.stream.onConnected(()=>{c(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{c(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,me,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(a=>{c(()=>this.handleStreamClose(a))}),this.stream.onMessage(a=>{c(()=>1==++this.responseCount?this.onFirst(a):this.onNext(a))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(a){return x(mc,`close with error: ${a}`),this.stream=null,this.close(4,a)}getCloseGuardedDispatcher(a){return b=>{this.queue.enqueueAndForget(()=>this.closeCount===a?b():(x(mc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mg extends mf{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}startRpc(a,b){return this.connection.openStream("Listen",a,b)}onFirst(a){return this.onNext(a)}onNext(a){this.backoff.reset();let b=g2(this.serializer,a),c=g4(a);return this.listener.onWatchChange(b,c)}watch(a){let b={};b.database=gV(this.serializer),b.addTarget=hl(this.serializer,a);let c=hj(this.serializer,a);c&&(b.labels=c),this.sendRequest(b)}unwatch(a){let b={};b.database=gV(this.serializer),b.removeTarget=a,this.sendRequest(b)}}class mh extends mf{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(a,b){return this.connection.openStream("Write",a,b)}onFirst(a){return D(!!a.streamToken,31322),this.lastStreamToken=a.streamToken,D(!a.writeResults||0===a.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(a){D(!!a.streamToken,12678),this.lastStreamToken=a.streamToken,this.backoff.reset();let b=ha(a.writeResults,a.commitTime),c=gN(a.commitTime);return this.listener.onMutationResult(c,b)}writeHandshake(){let a={};a.database=gV(this.serializer),this.sendRequest(a)}writeMutations(a){let b={streamToken:this.lastStreamToken,writes:a.map(a=>g5(this.serializer,a))};this.sendRequest(b)}}class mi{}class mj extends mi{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.connection=c,this.serializer=d,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new X(Q,"The client has already been terminated.")}invokeRPC(a,b,c,d){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,f])=>this.connection.invokeRPC(a,gP(b,c),d,e,f)).catch(a=>{if("FirebaseError"===a.name)throw a.code===O&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new X(I,a.toString())})}invokeStreamingRPC(a,b,c,d,e){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,g])=>this.connection.invokeStreamingRPC(a,gP(b,c),d,f,g,e)).catch(a=>{if("FirebaseError"===a.name)throw a.code===O&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new X(I,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function mk(a,b,c,d){return new mj(a,b,c,d)}async function ml(a,b){let c=F(a),d={writes:b.map(a=>g5(c.serializer,a))};await c.invokeRPC("Commit",c.serializer.databaseId,as.emptyPath(),d)}async function mm(a,b){let c=F(a),d={documents:b.map(a=>gR(c.serializer,a))},e=await c.invokeStreamingRPC("BatchGetDocuments",c.serializer.databaseId,as.emptyPath(),d,b.length),f=new Map;e.forEach(a=>{let b=g1(c.serializer,a);f.set(b.key.toString(),b)});let g=[];return b.forEach(a=>{let b=f.get(a.toString());D(!!b,55234,{key:a}),g.push(b)}),g}async function mn(a,b,c){let d=F(a),{request:e,aliasMap:f,parent:g}=hg(d.serializer,eY(b),c);d.connection.shouldResourcePathBeIncludedInRequest||delete e.parent;let h=(await d.invokeStreamingRPC("RunAggregationQuery",d.serializer.databaseId,g,e,1)).filter(a=>!!a.result);D(1===h.length,64727);let i=h[0].result?.aggregateFields;return Object.keys(i).reduce((a,b)=>(a[f[b]]=i[b],a),{})}function mo(a,b,c){let d=F(a);return d.verifyInitialized(),new mh(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}function mp(a,b,c){let d=F(a);return d.verifyInitialized(),new mg(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}let mq="OnlineStateTracker",mr=1,ms=1e4;class mt{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",ms,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${ms/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(a){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=mr&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${mr} times. Most recent error: ${a.toString()}`),this.setAndBroadcast("Offline")))}set(a){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===a&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(a)}setAndBroadcast(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}logClientOfflineWarningIfNecessary(a){let b=`Could not reach Cloud Firestore backend. ${a}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(y(b),this.shouldWarnClientIsOffline=!1):x(mq,b)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let mu="RemoteStore",mv=10;class mw{constructor(a,b,c,d,e){this.localStore=a,this.datastore=b,this.asyncQueue=c,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=e,this.connectivityMonitor.addCallback(a=>{c.enqueueAndForget(async()=>{mJ(this)&&(x(mu,"Restarting streams for network reachability change."),await m1(this))})}),this.onlineStateTracker=new mt(c,d)}}function mx(a,b,c,d,e){return new mw(a,b,c,d,e)}function my(a){let b=F(a);return b.offlineCauses.delete(0),mz(b)}async function mz(a){if(mJ(a))for(let b of a.onNetworkStatusChange)await b(!0)}async function mA(a){let b=F(a);b.offlineCauses.add(0),await mB(b),b.onlineStateTracker.set("Offline")}async function mB(a){for(let b of a.onNetworkStatusChange)await b(!1)}async function mC(a){let b=F(a);x(mu,"RemoteStore shutting down."),b.offlineCauses.add(5),await mB(b),b.connectivityMonitor.shutdown(),b.onlineStateTracker.set("Unknown")}function mD(a,b){let c=F(a);!c.listenTargets.has(b.targetId)&&(c.listenTargets.set(b.targetId,b),mI(c)?mH(c):m4(c).isOpen()&&mF(c,b))}function mE(a,b){let c=F(a),d=m4(c);c.listenTargets.delete(b),d.isOpen()&&mG(c,b),0===c.listenTargets.size&&(d.isOpen()?d.markIdle():mJ(c)&&c.onlineStateTracker.set("Unknown"))}function mF(a,b){if(a.watchChangeAggregator.recordPendingTargetRequest(b.targetId),b.resumeToken.approximateByteSize()>0||b.snapshotVersion.compareTo(aK.min())>0){let c=a.remoteSyncer.getRemoteKeysForTarget(b.targetId).size;b=b.withExpectedCount(c)}m4(a).watch(b)}function mG(a,b){a.watchChangeAggregator.recordPendingTargetRequest(b),m4(a).unwatch(b)}function mH(a){a.watchChangeAggregator=new gw({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),getTargetDataForTarget:b=>a.listenTargets.get(b)||null,getDatabaseId:()=>a.datastore.serializer.databaseId}),m4(a).start(),a.onlineStateTracker.handleWatchStreamStart()}function mI(a){return mJ(a)&&!m4(a).isStarted()&&a.listenTargets.size>0}function mJ(a){return 0===F(a).offlineCauses.size}function mK(a){a.watchChangeAggregator=void 0}async function mL(a){a.onlineStateTracker.set("Online")}async function mM(a){a.listenTargets.forEach((b,c)=>{mF(a,b)})}async function mN(a,b){mK(a),mI(a)?(a.onlineStateTracker.handleWatchStreamFailure(b),mH(a)):a.onlineStateTracker.set("Unknown")}async function mO(a,b,c){if(a.onlineStateTracker.set("Online"),b instanceof gt&&2===b.state&&b.cause){try{await mS(a,b)}catch(c){x(mu,"Failed to remove targets %s: %s ",b.targetIds.join(","),c),await mP(a,c)}return}if(b instanceof gr?a.watchChangeAggregator.handleDocumentChange(b):b instanceof gs?a.watchChangeAggregator.handleExistenceFilter(b):a.watchChangeAggregator.handleTargetChange(b),!c.isEqual(aK.min()))try{let b=await k$(a.localStore);c.compareTo(b)>=0&&await mR(a,c)}catch(b){x(mu,"Failed to raise snapshot:",b),await mP(a,b)}}async function mP(a,b,c){if(a9(b))a.offlineCauses.add(1),await mB(a),a.onlineStateTracker.set("Offline"),c||(c=()=>k$(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{x(mu,"Retrying IndexedDB access"),await c(),a.offlineCauses.delete(1),await mz(a)});else throw b}function mQ(a,b){return b().catch(c=>mP(a,c,b))}function mR(a,b){let c=a.watchChangeAggregator.createRemoteEvent(b);return c.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let e=a.listenTargets.get(d);e&&a.listenTargets.set(d,e.withResumeToken(c.resumeToken,b))}}),c.targetMismatches.forEach((b,c)=>{let d=a.listenTargets.get(b);d&&(a.listenTargets.set(b,d.withResumeToken(cQ.EMPTY_BYTE_STRING,d.snapshotVersion)),mG(a,b),mF(a,new hP(d.target,b,c,d.sequenceNumber)))}),a.remoteSyncer.applyRemoteEvent(c)}async function mS(a,b){let c=b.cause;for(let d of b.targetIds)a.listenTargets.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.listenTargets.delete(d),a.watchChangeAggregator.removeTarget(d))}async function mT(a){let b=F(a),c=m5(b),d=b.writePipeline.length>0?b.writePipeline[b.writePipeline.length-1].batchId:c7;for(;mU(b);)try{let a=await k3(b.localStore,d);if(null===a){0===b.writePipeline.length&&c.markIdle();break}d=a.batchId,mV(b,a)}catch(a){await mP(b,a)}mW(b)&&mX(b)}function mU(a){return mJ(a)&&a.writePipeline.length<mv}function mV(a,b){a.writePipeline.push(b);let c=m5(a);c.isOpen()&&c.handshakeComplete&&c.writeMutations(b.mutations)}function mW(a){return mJ(a)&&!m5(a).isStarted()&&a.writePipeline.length>0}function mX(a){m5(a).start()}async function mY(a){m5(a).writeHandshake()}async function mZ(a){let b=m5(a);for(let c of a.writePipeline)b.writeMutations(c.mutations)}async function m$(a,b,c){let d=a.writePipeline.shift(),e=f9.from(d,b,c);await mQ(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await mT(a)}async function m_(a,b){b&&m5(a).handshakeComplete&&await m0(a,b),mW(a)&&mX(a)}async function m0(a,b){if(gd(b.code)){let c=a.writePipeline.shift();m5(a).inhibitBackoff(),await mQ(a,()=>a.remoteSyncer.rejectFailedWrite(c.batchId,b)),await mT(a)}}async function m1(a){let b=F(a);b.offlineCauses.add(4),await mB(b),b.onlineStateTracker.set("Unknown"),b.offlineCauses.delete(4),await mz(b)}async function m2(a,b){let c=F(a);c.asyncQueue.verifyOperationInProgress(),x(mu,"RemoteStore received new credentials");let d=mJ(c);c.offlineCauses.add(3),await mB(c),d&&c.onlineStateTracker.set("Unknown"),await c.remoteSyncer.handleCredentialChange(b),c.offlineCauses.delete(3),await mz(c)}async function m3(a,b){let c=F(a);b?(c.offlineCauses.delete(2),await mz(c)):b||(c.offlineCauses.add(2),await mB(c),c.onlineStateTracker.set("Unknown"))}function m4(a){return a.watchStream||(a.watchStream=mp(a.datastore,a.asyncQueue,{onConnected:mL.bind(null,a),onOpen:mM.bind(null,a),onClose:mN.bind(null,a),onWatchChange:mO.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.watchStream.inhibitBackoff(),mI(a)?mH(a):a.onlineStateTracker.set("Unknown")):(await a.watchStream.stop(),mK(a))})),a.watchStream}function m5(a){return a.writeStream||(a.writeStream=mo(a.datastore,a.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:mY.bind(null,a),onClose:m_.bind(null,a),onHandshakeComplete:mZ.bind(null,a),onMutationResult:m$.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.writeStream.inhibitBackoff(),await mT(a)):(await a.writeStream.stop(),a.writePipeline.length>0&&(x(mu,`Stopping write stream with ${a.writePipeline.length} pending writes`),a.writePipeline=[]))})),a.writeStream}let m6="AsyncQueue";class m7{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new Y,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(a,b,c,d,e){let f=new m7(a,b,Date.now()+c,d,e);return f.start(c),f}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new X(H,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function m8(a,b){if(y(m6,`${b}: ${a}`),a9(a))return new X(V,`${b}: ${a}`);throw a}class m9{static emptySet(a){return new m9(a.comparator)}constructor(a){a?this.comparator=(b,c)=>a(b,c)||av.comparator(b.key,c.key):this.comparator=(a,b)=>av.comparator(a.key,b.key),this.keyedMap=fi(),this.sortedSet=new cE(this.comparator)}has(a){return null!=this.keyedMap.get(a)}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(a){let b=this.keyedMap.get(a);return b?this.sortedSet.indexOf(b):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){let b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){let b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof m9)||this.size!==a.size)return!1;let b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){let a=[];return(this.forEach(b=>{a.push(b.toString())}),0===a.length)?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(a,b){let c=new m9;return c.comparator=this.comparator,c.keyedMap=a,c.sortedSet=b,c}}class na{constructor(){this.changeMap=new cE(av.comparator)}track(a){let b=a.doc.key,c=this.changeMap.get(b);if(!c){this.changeMap=this.changeMap.insert(b,a);return}0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):B(63341,{change:a,oldChange:c})}getChanges(){let a=[];return this.changeMap.inorderTraversal((b,c)=>{a.push(c)}),a}}class nb{constructor(a,b,c,d,e,f,g,h,i){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h,this.hasCachedResults=i}static fromInitialDocuments(a,b,c,d,e){let f=[];return b.forEach(a=>{f.push({type:0,doc:a})}),new nb(a,b,m9.emptySet(b),f,c,d,!0,!1,e)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(this.fromCache!==a.fromCache||this.hasCachedResults!==a.hasCachedResults||this.syncStateChanged!==a.syncStateChanged||!this.mutatedKeys.isEqual(a.mutatedKeys)||!e3(this.query,a.query)||!this.docs.isEqual(a.docs)||!this.oldDocs.isEqual(a.oldDocs))return!1;let b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}}class nc{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(a=>a.listensToRemoteStore())}}function nd(){return new ne}class ne{constructor(){this.queries=nf(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){nn(this,new X(R,"Firestore shutting down"))}}function nf(){return new fe(a=>e4(a),e3)}async function ng(a,b){let c=F(a),d=3,e=b.query,f=c.queries.get(e);f?!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(d=2):(f=new nc,d=+!b.listensToRemoteStore());try{switch(d){case 0:f.viewSnap=await c.onListen(e,!0);break;case 1:f.viewSnap=await c.onListen(e,!1);break;case 2:await c.onFirstRemoteStoreListen(e)}}catch(c){let a=m8(c,`Initialization of query '${e5(b.query)}' failed`);b.onError(a);return}c.queries.set(e,f),f.listeners.push(b),b.applyOnlineStateChange(c.onlineState),f.viewSnap&&b.onViewSnapshot(f.viewSnap)&&no(c)}async function nh(a,b){let c=F(a),d=b.query,e=3,f=c.queries.get(d);if(f){let a=f.listeners.indexOf(b);a>=0&&(f.listeners.splice(a,1),0===f.listeners.length?e=+!b.listensToRemoteStore():!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(e=2))}switch(e){case 0:return c.queries.delete(d),c.onUnlisten(d,!0);case 1:return c.queries.delete(d),c.onUnlisten(d,!1);case 2:return c.onLastRemoteStoreUnlisten(d);default:return}}function ni(a,b){let c=F(a),d=!1;for(let a of b){let b=a.query,e=c.queries.get(b);if(e){for(let b of e.listeners)b.onViewSnapshot(a)&&(d=!0);e.viewSnap=a}}d&&no(c)}function nj(a,b,c){let d=F(a),e=d.queries.get(b);if(e)for(let a of e.listeners)a.onError(c);d.queries.delete(b)}function nk(a,b){let c=F(a);c.onlineState=b;let d=!1;c.queries.forEach((a,c)=>{for(let a of c.listeners)a.applyOnlineStateChange(b)&&(d=!0)}),d&&no(c)}function nl(a,b){F(a).snapshotsInSyncListeners.add(b),b.next()}function nm(a,b){F(a).snapshotsInSyncListeners.delete(b)}function nn(a,b){let c=F(a),d=c.queries;c.queries=nf(),d.forEach((a,c)=>{for(let a of c.listeners)a.onError(b)})}function no(a){a.snapshotsInSyncListeners.forEach(a=>{a.next()})}!function(a){a.Default="default",a.Cache="cache"}(e||(e={}));class np{constructor(a,b,c){this.query=a,this.queryObserver=b,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=c||{}}onViewSnapshot(a){if(!this.options.includeMetadataChanges){let b=[];for(let c of a.docChanges)3!==c.type&&b.push(c);a=new nb(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0,a.hasCachedResults)}let b=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(a)&&(this.queryObserver.next(a),b=!0):this.shouldRaiseInitialEvent(a,this.onlineState)&&(this.raiseInitialEvent(a),b=!0),this.snap=a,b}onError(a){this.queryObserver.error(a)}applyOnlineStateChange(a){this.onlineState=a;let b=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,a)&&(this.raiseInitialEvent(this.snap),b=!0),b}shouldRaiseInitialEvent(a,b){if(!a.fromCache||!this.listensToRemoteStore())return!0;let c="Offline"!==b;return(!this.options.waitForSyncWhenOnline||!c)&&(!a.docs.isEmpty()||a.hasCachedResults||"Offline"===b)}shouldRaiseEvent(a){if(a.docChanges.length>0)return!0;let b=this.snap&&this.snap.hasPendingWrites!==a.hasPendingWrites;return(!!a.syncStateChanged||!!b)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(a){a=nb.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache,a.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(a)}listensToRemoteStore(){return this.options.source!==e.Cache}}class nq{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.addedKeys=c,this.removedKeys=d}static fromSnapshot(a,b){let c=fr(),d=fr();for(let a of b.docChanges)switch(a.type){case 0:c=c.add(a.doc.key);break;case 1:d=d.add(a.doc.key)}return new nq(a,b.fromCache,c,d)}}class nr{constructor(a){this.serializer=a}toDocumentKey(a){return gS(this.serializer,a)}toMutableDocument(a){return a.metadata.exists?g$(this.serializer,a.document,!1):d0.newNoDocument(this.toDocumentKey(a.metadata.name),this.toSnapshotVersion(a.metadata.readTime))}toSnapshotVersion(a){return gN(a)}}class ns{constructor(a,b){this.bundleMetadata=a,this.serializer=b,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=nt(a)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(a){this.progress.bytesLoaded+=a.byteLength;let b=this.progress.documentsLoaded;if(a.payload.namedQuery)this._queries.push(a.payload.namedQuery);else if(a.payload.documentMetadata){this._documents.push({metadata:a.payload.documentMetadata}),!a.payload.documentMetadata.exists&&++b;let c=as.fromString(a.payload.documentMetadata.name);this.collectionGroups.add(c.get(c.length-2))}else a.payload.document&&(this._documents[this._documents.length-1].document=a.payload.document,++b);return b!==this.progress.documentsLoaded?(this.progress.documentsLoaded=b,{...this.progress}):null}getQueryDocumentMapping(a){let b=new Map,c=new nr(this.serializer);for(let d of a)if(d.metadata.queries){let a=c.toDocumentKey(d.metadata.name);for(let c of d.metadata.queries){let d=(b.get(c)||fr()).add(a);b.set(c,d)}}return b}async completeAndStoreAsync(a){let b=await lh(a,new nr(this.serializer),this._documents,this.bundleMetadata.id),c=this.getQueryDocumentMapping(this.documents);for(let b of this._queries)await ll(a,b,c.get(b.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:b}}}function nt(a){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}function nu(a){return{taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}class nv{constructor(a){this.key=a}}class nw{constructor(a){this.key=a}}class nx{constructor(a,b){this.query=a,this._syncedDocuments=b,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=fr(),this.mutatedKeys=fr(),this.docComparator=fc(a),this.documentSet=new m9(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(a,b){let c=b?b.changeSet:new na,d=b?b.documentSet:this.documentSet,e=b?b.mutatedKeys:this.mutatedKeys,f=d,g=!1,h="F"===this.query.limitType&&d.size===this.query.limit?d.last():null,i="L"===this.query.limitType&&d.size===this.query.limit?d.first():null;if(a.inorderTraversal((a,b)=>{let j=d.get(a),k=e6(this.query,b)?b:null,l=!!j&&this.mutatedKeys.has(j.key),m=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations),n=!1;j&&k?j.data.isEqual(k.data)?l!==m&&(c.track({type:3,doc:k}),n=!0):!this.shouldWaitForSyncedDocument(j,k)&&(c.track({type:2,doc:k}),n=!0,(h&&this.docComparator(k,h)>0||i&&0>this.docComparator(k,i))&&(g=!0)):!j&&k?(c.track({type:0,doc:k}),n=!0):j&&!k&&(c.track({type:1,doc:j}),n=!0,(h||i)&&(g=!0)),n&&(k?(f=f.add(k),e=m?e.add(a):e.delete(a)):(f=f.delete(a),e=e.delete(a)))}),null!==this.query.limit)for(;f.size>this.query.limit;){let a="F"===this.query.limitType?f.last():f.first();f=f.delete(a.key),e=e.delete(a.key),c.track({type:1,doc:a})}return{documentSet:f,changeSet:c,needsRefill:g,mutatedKeys:e}}shouldWaitForSyncedDocument(a,b){return a.hasLocalMutations&&b.hasCommittedMutations&&!b.hasLocalMutations}applyChanges(a,b,c,d){let e=this.documentSet;this.documentSet=a.documentSet,this.mutatedKeys=a.mutatedKeys;let f=a.changeSet.getChanges();f.sort((a,b)=>ny(a.type,b.type)||this.docComparator(a.doc,b.doc)),this.applyTargetChange(c),d=d??!1;let g=b&&!d?this.updateLimboDocuments():[],h=+!!(0===this.limboDocuments.size&&this.current&&!d),i=h!==this.syncState;return(this.syncState=h,0!==f.length||i)?{snapshot:new nb(this.query,a.documentSet,e,f,a.mutatedKeys,0===h,i,!1,!!c&&c.resumeToken.approximateByteSize()>0),limboChanges:g}:{limboChanges:g}}applyOnlineStateChange(a){return this.current&&"Offline"===a?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new na,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(a){return!this._syncedDocuments.has(a)&&!!this.documentSet.has(a)&&!this.documentSet.get(a).hasLocalMutations}applyTargetChange(a){a&&(a.addedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.delete(a)),this.current=a.current)}updateLimboDocuments(){if(!this.current)return[];let a=this.limboDocuments;this.limboDocuments=fr(),this.documentSet.forEach(a=>{this.shouldBeInLimbo(a.key)&&(this.limboDocuments=this.limboDocuments.add(a.key))});let b=[];return a.forEach(a=>{this.limboDocuments.has(a)||b.push(new nw(a))}),this.limboDocuments.forEach(c=>{a.has(c)||b.push(new nv(c))}),b}synchronizeWithPersistedState(a){this._syncedDocuments=a.remoteKeys,this.limboDocuments=fr();let b=this.computeDocChanges(a.documents);return this.applyChanges(b,!0)}computeInitialSnapshot(){return nb.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function ny(a,b){let c=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B(20277,{change:a})}};return c(a)-c(b)}let nz="SyncEngine";class nA{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}}class nB{constructor(a){this.key=a,this.receivedDocument=!1}}class nC{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.syncEngineListener={},this.queryViewsByQuery=new fe(a=>e4(a),e3),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new cE(av.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new j4,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ju.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function nD(a,b,c,d,e,f,g){let h=new nC(a,b,c,d,e,f);return g&&(h._isPrimaryClient=!0),h}async function nE(a,b,c=!0){let d,e=oc(a),f=e.queryViewsByQuery.get(b);return f?(e.sharedClientState.addLocalQueryTarget(f.targetId),d=f.view.computeInitialSnapshot()):d=await nG(e,b,c,!0),d}async function nF(a,b){let c=oc(a);await nG(c,b,!0,!1)}async function nG(a,b,c,d){let e,f=await k5(a.localStore,eX(b)),g=f.targetId,h=a.sharedClientState.addLocalQueryTarget(g,c);return d&&(e=await nH(a,b,g,"current"===h,f.resumeToken)),a.isPrimaryClient&&c&&mD(a.remoteStore,f),e}async function nH(a,b,c,d,e){a.applyDocChanges=(b,c,d)=>n_(a,b,c,d);let f=await k8(a.localStore,b,!0),g=new nx(b,f.remoteKeys),h=g.computeDocChanges(f.documents),i=gq.createSynthesizedTargetChangeForCurrentChange(c,d&&"Offline"!==a.onlineState,e),j=g.applyChanges(h,a.isPrimaryClient,i);nX(a,c,j.limboChanges);let k=new nA(b,c,g);return a.queryViewsByQuery.set(b,k),a.queriesByTarget.has(c)?a.queriesByTarget.get(c).push(b):a.queriesByTarget.set(c,[b]),j.snapshot}async function nI(a,b,c){let d=F(a),e=d.queryViewsByQuery.get(b),f=d.queriesByTarget.get(e.targetId);if(f.length>1){d.queriesByTarget.set(e.targetId,f.filter(a=>!e3(a,b))),d.queryViewsByQuery.delete(b);return}d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(e.targetId),d.sharedClientState.isActiveQueryTarget(e.targetId)||await k7(d.localStore,e.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(e.targetId),c&&mE(d.remoteStore,e.targetId),nV(d,e.targetId)}).catch(a0)):(nV(d,e.targetId),await k7(d.localStore,e.targetId,!0))}async function nJ(a,b){let c=F(a),d=c.queryViewsByQuery.get(b),e=c.queriesByTarget.get(d.targetId);c.isPrimaryClient&&1===e.length&&(c.sharedClientState.removeLocalQueryTarget(d.targetId),mE(c.remoteStore,d.targetId))}async function nK(a,b,c){let d=od(a);try{let a=await kV(d.localStore,b);d.sharedClientState.addPendingMutation(a.batchId),nT(d,a.batchId,c),await n$(d,a.changes),await mT(d.remoteStore)}catch(b){let a=m8(b,"Failed to persist write");c.reject(a)}}async function nL(a,b){let c=F(a);try{let a=await k_(c.localStore,b);b.targetChanges.forEach((a,b)=>{let d=c.activeLimboResolutionsByTarget.get(b);d&&(D(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?d.receivedDocument=!0:a.modifiedDocuments.size>0?D(d.receivedDocument,14607):a.removedDocuments.size>0&&(D(d.receivedDocument,42227),d.receivedDocument=!1))}),await n$(c,a,b)}catch(a){await a0(a)}}function nM(a,b,c){let d=F(a);if(d.isPrimaryClient&&0===c||!d.isPrimaryClient&&1===c){let a=[];d.queryViewsByQuery.forEach((c,d)=>{let e=d.view.applyOnlineStateChange(b);e.snapshot&&a.push(e.snapshot)}),nk(d.eventManager,b),a.length&&d.syncEngineListener.onWatchChange(a),d.onlineState=b,d.isPrimaryClient&&d.sharedClientState.setOnlineState(b)}}async function nN(a,b,c){let d=F(a);d.sharedClientState.updateQueryState(b,"rejected",c);let e=d.activeLimboResolutionsByTarget.get(b),f=e&&e.key;if(f){let a=new cE(av.comparator);a=a.insert(f,d0.newNoDocument(f,aK.min()));let c=fr().add(f),e=new gp(aK.min(),new Map,new cE(aj),a,c);await nL(d,e),d.activeLimboTargetsByKey=d.activeLimboTargetsByKey.remove(f),d.activeLimboResolutionsByTarget.delete(b),nZ(d)}else await k7(d.localStore,b,!1).then(()=>nV(d,b,c)).catch(a0)}async function nO(a,b){let c=F(a),d=b.batch.batchId;try{let a=await kW(c.localStore,b);nU(c,d,null),nR(c,d),c.sharedClientState.updateMutationState(d,"acknowledged"),await n$(c,a)}catch(a){await a0(a)}}async function nP(a,b,c){let d=F(a);try{let a=await kY(d.localStore,b);nU(d,b,c),nR(d,b),d.sharedClientState.updateMutationState(b,"rejected",c),await n$(d,a)}catch(a){await a0(a)}}async function nQ(a,b){let c=F(a);mJ(c.remoteStore)||x(nz,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let a=await kZ(c.localStore);if(a===c7)return void b.resolve();let d=c.pendingWritesCallbacks.get(a)||[];d.push(b),c.pendingWritesCallbacks.set(a,d)}catch(c){let a=m8(c,"Initialization of waitForPendingWrites() operation failed");b.reject(a)}}function nR(a,b){(a.pendingWritesCallbacks.get(b)||[]).forEach(a=>{a.resolve()}),a.pendingWritesCallbacks.delete(b)}function nS(a,b){a.pendingWritesCallbacks.forEach(a=>{a.forEach(a=>{a.reject(new X(H,b))})}),a.pendingWritesCallbacks.clear()}function nT(a,b,c){let d=a.mutationUserCallbacks[a.currentUser.toKey()];d||(d=new cE(aj)),d=d.insert(b,c),a.mutationUserCallbacks[a.currentUser.toKey()]=d}function nU(a,b,c){let d=F(a),e=d.mutationUserCallbacks[d.currentUser.toKey()];if(e){let a=e.get(b);a&&(c?a.reject(c):a.resolve(),e=e.remove(b)),d.mutationUserCallbacks[d.currentUser.toKey()]=e}}function nV(a,b,c=null){for(let d of(a.sharedClientState.removeLocalQueryTarget(b),a.queriesByTarget.get(b)))a.queryViewsByQuery.delete(d),c&&a.syncEngineListener.onWatchError(d,c);a.queriesByTarget.delete(b),a.isPrimaryClient&&a.limboDocumentRefs.removeReferencesForId(b).forEach(b=>{a.limboDocumentRefs.containsKey(b)||nW(a,b)})}function nW(a,b){a.enqueuedLimboResolutions.delete(b.path.canonicalString());let c=a.activeLimboTargetsByKey.get(b);null!==c&&(mE(a.remoteStore,c),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.remove(b),a.activeLimboResolutionsByTarget.delete(c),nZ(a))}function nX(a,b,c){for(let d of c)d instanceof nv?(a.limboDocumentRefs.addReference(d.key,b),nY(a,d)):d instanceof nw?(x(nz,"Document no longer in limbo: "+d.key),a.limboDocumentRefs.removeReference(d.key,b),a.limboDocumentRefs.containsKey(d.key)||nW(a,d.key)):B(19791,{limboChange:d})}function nY(a,b){let c=b.key,d=c.path.canonicalString();a.activeLimboTargetsByKey.get(c)||a.enqueuedLimboResolutions.has(d)||(x(nz,"New document in limbo: "+c),a.enqueuedLimboResolutions.add(d),nZ(a))}function nZ(a){for(;a.enqueuedLimboResolutions.size>0&&a.activeLimboTargetsByKey.size<a.maxConcurrentLimboResolutions;){let b=a.enqueuedLimboResolutions.values().next().value;a.enqueuedLimboResolutions.delete(b);let c=new av(as.fromString(b)),d=a.limboTargetIdGenerator.next();a.activeLimboResolutionsByTarget.set(d,new nB(c)),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.insert(c,d),mD(a.remoteStore,new hP(eX(eP(c.path)),d,"TargetPurposeLimboResolution",bk.INVALID))}}async function n$(a,b,c){let d=F(a),e=[],f=[],g=[];d.queryViewsByQuery.isEmpty()||(d.queryViewsByQuery.forEach((a,h)=>{g.push(d.applyDocChanges(h,b,c).then(a=>{if((a||c)&&d.isPrimaryClient){let b=a?!a.fromCache:c?.targetChanges.get(h.targetId)?.current;d.sharedClientState.updateQueryState(h.targetId,b?"current":"not-current")}if(a){e.push(a);let b=nq.fromSnapshot(h.targetId,a);f.push(b)}}))}),await Promise.all(g),d.syncEngineListener.onWatchChange(e),await k2(d.localStore,f))}async function n_(a,b,c,d){let e=b.view.computeDocChanges(c);e.needsRefill&&(e=await k8(a.localStore,b.query,!1).then(({documents:a})=>b.view.computeDocChanges(a,e)));let f=d&&d.targetChanges.get(b.targetId),g=d&&null!=d.targetMismatches.get(b.targetId),h=b.view.applyChanges(e,a.isPrimaryClient,f,g);return nX(a,b.targetId,h.limboChanges),h.snapshot}async function n0(a,b){let c=F(a);if(!c.currentUser.isEqual(b)){x(nz,"User change. New user:",b.toKey());let a=await kU(c.localStore,b);c.currentUser=b,nS(c,"'waitForPendingWrites' promise is rejected due to a user change."),c.sharedClientState.handleUserChange(b,a.removedBatchIds,a.addedBatchIds),await n$(c,a.affectedDocuments)}}function n1(a,b){let c=F(a),d=c.activeLimboResolutionsByTarget.get(b);if(d&&d.receivedDocument)return fr().add(d.key);{let a=fr(),d=c.queriesByTarget.get(b);if(!d)return a;for(let b of d){let d=c.queryViewsByQuery.get(b);a=a.unionWith(d.view.syncedDocuments)}return a}}async function n2(a,b){let c=F(a),d=await k8(c.localStore,b.query,!0),e=b.view.synchronizeWithPersistedState(d);return c.isPrimaryClient&&nX(c,b.targetId,e.limboChanges),e}async function n3(a,b){let c=F(a);return le(c.localStore,b).then(a=>n$(c,a))}async function n4(a,b,c,d){let e=F(a),f=await la(e.localStore,b);null===f?x(nz,"Cannot apply mutation batch with id: "+b):("pending"===c?await mT(e.remoteStore):"acknowledged"===c||"rejected"===c?(nU(e,b,d||null),nR(e,b),lb(e.localStore,b)):B(6720,"Unknown batchState",{batchState:c}),await n$(e,f))}async function n5(a,b){let c=F(a);if(oc(c),od(c),!0===b&&!0!==c._isPrimaryClient){let a=c.sharedClientState.getAllActiveQueryTargets(),b=await n7(c,a.toArray());for(let a of(c._isPrimaryClient=!0,await m3(c.remoteStore,!0),b))mD(c.remoteStore,a)}else if(!1===b&&!1!==c._isPrimaryClient){let a=[],b=Promise.resolve();c.queriesByTarget.forEach((d,e)=>{c.sharedClientState.isLocalQueryTarget(e)?a.push(e):b=b.then(()=>(nV(c,e),k7(c.localStore,e,!0))),mE(c.remoteStore,e)}),await b,await n7(c,a),n6(c),c._isPrimaryClient=!1,await m3(c.remoteStore,!1)}}function n6(a){let b=F(a);b.activeLimboResolutionsByTarget.forEach((a,c)=>{mE(b.remoteStore,c)}),b.limboDocumentRefs.removeAllReferences(),b.activeLimboResolutionsByTarget=new Map,b.activeLimboTargetsByKey=new cE(av.comparator)}async function n7(a,b,c){let d=F(a),e=[],f=[];for(let a of b){let b,c=d.queriesByTarget.get(a);if(c&&0!==c.length)for(let a of(b=await k5(d.localStore,eX(c[0])),c)){let b=d.queryViewsByQuery.get(a),c=await n2(d,b);c.snapshot&&f.push(c.snapshot)}else{let c=await ld(d.localStore,a);b=await k5(d.localStore,c),await nH(d,n8(c),a,!1,b.resumeToken)}e.push(b)}return d.syncEngineListener.onWatchChange(f),e}function n8(a){return eO(a.path,a.collectionGroup,a.orderBy,a.filters,a.limit,"F",a.startAt,a.endAt)}function n9(a){return lc(F(a).localStore)}async function oa(a,b,c,d){let e=F(a);if(e._isPrimaryClient)return void x(nz,"Ignoring unexpected query state notification.");let f=e.queriesByTarget.get(b);if(f&&f.length>0)switch(c){case"current":case"not-current":{let a=await le(e.localStore,fb(f[0])),d=gp.createSynthesizedRemoteEventForCurrentChange(b,"current"===c,cQ.EMPTY_BYTE_STRING);await n$(e,a,d);break}case"rejected":await k7(e.localStore,b,!0),nV(e,b,d);break;default:B(64155,c)}}async function ob(a,b,c){let d=oc(a);if(d._isPrimaryClient){for(let a of b){if(d.queriesByTarget.has(a)&&d.sharedClientState.isActiveQueryTarget(a)){x(nz,"Adding an already active target "+a);continue}let b=await ld(d.localStore,a),c=await k5(d.localStore,b);await nH(d,n8(b),c.targetId,!1,c.resumeToken),mD(d.remoteStore,c)}for(let a of c)d.queriesByTarget.has(a)&&await k7(d.localStore,a,!1).then(()=>{mE(d.remoteStore,a),nV(d,a)}).catch(a0)}}function oc(a){let b=F(a);return b.remoteStore.remoteSyncer.applyRemoteEvent=nL.bind(null,b),b.remoteStore.remoteSyncer.getRemoteKeysForTarget=n1.bind(null,b),b.remoteStore.remoteSyncer.rejectListen=nN.bind(null,b),b.syncEngineListener.onWatchChange=ni.bind(null,b.eventManager),b.syncEngineListener.onWatchError=nj.bind(null,b.eventManager),b}function od(a){let b=F(a);return b.remoteStore.remoteSyncer.applySuccessfulWrite=nO.bind(null,b),b.remoteStore.remoteSyncer.rejectFailedWrite=nP.bind(null,b),b}function oe(a,b,c){let d=F(a);of(d,b,c).then(a=>{d.sharedClientState.notifyBundleLoaded(a)})}async function of(a,b,c){try{let d=await b.getMetadata();if(await li(a.localStore,d))return await b.close(),c._completeWith(nu(d)),Promise.resolve(new Set);c._updateProgress(nt(d));let e=new ns(d,b.serializer),f=await b.nextElement();for(;f;){let a=await e.addSizedElement(f);a&&c._updateProgress(a),f=await b.nextElement()}let g=await e.completeAndStoreAsync(a.localStore);return await n$(a,g.changedDocs,void 0),await lj(a.localStore,d),c._completeWith(g.progress),Promise.resolve(g.changedCollectionGroups)}catch(a){return z(nz,`Loading bundle failed with ${a}`),c._failWith(a),Promise.resolve(new Set)}}class og{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(a){this.serializer=l6(a.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(a),this.persistence=this.createPersistence(a),await this.persistence.start(),this.localStore=this.createLocalStore(a),this.gcScheduler=this.createGarbageCollectionScheduler(a,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(a,this.localStore)}createGarbageCollectionScheduler(a,b){return null}createIndexBackfillerScheduler(a,b){return null}createLocalStore(a){return kT(this.persistence,new ls,a.initialUser,this.serializer)}createPersistence(a){return new ke(kg.factory,this.serializer)}createSharedClientState(a){return new lN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}og.provider={build:()=>new og};class oh extends og{constructor(a){super(),this.cacheSizeBytes=a}createGarbageCollectionScheduler(a,b){return D(this.persistence.referenceDelegate instanceof kh,46915),new jJ(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createPersistence(a){let b=void 0!==this.cacheSizeBytes?jC.withCacheSize(this.cacheSizeBytes):jC.DEFAULT;return new ke(a=>kh.factory(a,b),this.serializer)}}class oi extends og{constructor(a,b,c){super(),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.kind="persistent",this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await this.onlineComponentProvider.initialize(this,a),await od(this.onlineComponentProvider.syncEngine),await mT(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(a){return kT(this.persistence,new ls,a.initialUser,this.serializer)}createGarbageCollectionScheduler(a,b){return new jJ(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createIndexBackfillerScheduler(a,b){let c=new bj(b,this.persistence);return new bi(a.asyncQueue,c)}createPersistence(a){let b=kM(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=void 0!==this.cacheSizeBytes?jC.withCacheSize(this.cacheSizeBytes):jC.DEFAULT;return new kJ(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,l4(),l5(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(a){return new lN}}class oj extends oi{constructor(a,b){super(a,b,!1),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.synchronizeTabs=!0}async initialize(a){await super.initialize(a);let b=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof lL&&(this.sharedClientState.syncEngine={applyBatchState:n4.bind(null,b),applyTargetState:oa.bind(null,b),applyActiveTargetsChange:ob.bind(null,b),getActiveClients:n9.bind(null,b),synchronizeWithChangedDocuments:n3.bind(null,b)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async a=>{await n5(this.onlineComponentProvider.syncEngine,a),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start():a||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(a&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():a||this.indexBackfillerScheduler.stop())})}createSharedClientState(a){let b=l4();if(!lL.isAvailable(b))throw new X(T,"IndexedDB persistence is only available on platforms that support LocalStorage.");let c=kM(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey);return new lL(b,a.asyncQueue,c,a.clientId,a.initialUser)}}class ok{async initialize(a,b){this.localStore||(this.localStore=a.localStore,this.sharedClientState=a.sharedClientState,this.datastore=this.createDatastore(b),this.remoteStore=this.createRemoteStore(b),this.eventManager=this.createEventManager(b),this.syncEngine=this.createSyncEngine(b,!a.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>nM(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=n0.bind(null,this.syncEngine),await m3(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return nd()}createDatastore(a){let b=l6(a.databaseInfo.databaseId),c=l2(a.databaseInfo);return mk(a.authCredentials,a.appCheckCredentials,c,b)}createRemoteStore(a){return mx(this.localStore,this.datastore,a.asyncQueue,a=>nM(this.syncEngine,a,0),l3())}createSyncEngine(a,b){return nD(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}async terminate(){await mC(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ok.provider={build:()=>new ok};let ol=10240;function om(a,b=ol){let c=0;return{async read(){if(c<a.byteLength){let d={value:a.slice(c,c+b),done:!1};return c+=b,d}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function on(a,b){if(!(a instanceof Uint8Array))throw new X(J,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${aB(a)}`);return om(a,b)}class oo{constructor(a){this.observer=a,this.muted=!1}next(a){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,a)}error(a){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,a):y("Uncaught Error in snapshot listener:",a.toString()))}mute(){this.muted=!0}scheduleEvent(a,b){setTimeout(()=>{this.muted||a(b)},0)}}class op{constructor(a,b){this.payload=a,this.byteLength=b}isBundleMetadata(){return"metadata"in this.payload}}class oq{constructor(a,b){this.reader=a,this.serializer=b,this.metadata=new Y,this.buffer=new Uint8Array,this.textDecoder=gj(),this.nextElementImpl().then(a=>{a&&a.isBundleMetadata()?this.metadata.resolve(a.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(a?.payload)}`))},a=>this.metadata.reject(a))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let a=await this.readLength();if(null===a)return null;let b=this.textDecoder.decode(a),c=Number(b);return isNaN(c)&&this.raiseError(`length string (${b}) is not valid number`),new op(JSON.parse(await this.readJsonString(c)),a.length+c)}indexOfOpenBracket(){return this.buffer.findIndex(a=>123===a)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let a=this.indexOfOpenBracket();a<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let b=this.buffer.slice(0,a);return this.buffer=this.buffer.slice(a),b}async readJsonString(a){for(;this.buffer.length<a;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let b=this.textDecoder.decode(this.buffer.slice(0,a));return this.buffer=this.buffer.slice(a),b}raiseError(a){throw this.reader.cancel(),Error(`Invalid bundle format: ${a}`)}async pullMoreDataToBuffer(){let a=await this.reader.read();if(!a.done){let b=new Uint8Array(this.buffer.length+a.value.length);b.set(this.buffer),b.set(a.value,this.buffer.length),this.buffer=b}return a.done}}function or(a,b){return new oq(a,b)}class os{constructor(a,b){this.bundleData=a,this.serializer=b,this.cursor=0,this.elements=[];let c=this.nextElement();if(c&&c.isBundleMetadata())this.metadata=c;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(c?.payload)}`);do null!==(c=this.nextElement())&&this.elements.push(c);while(null!==c)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let a=this.readLength();return new op(JSON.parse(this.readJsonString(a)),a)}readJsonString(a){if(this.cursor+a>this.bundleData.length)throw new X(U,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=a)}readLength(){let a=this.cursor,b=this.cursor;for(;b<this.bundleData.length;){if("{"===this.bundleData[b]){if(b===a)throw Error("First character is a bracket and not a number");return this.cursor=b,Number(this.bundleData.slice(a,b))}b++}throw Error("Reached the end of bundle when more is expected.")}}function ot(a,b){return new os(a,b)}class ou{constructor(a){this.datastore=a,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(a){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new X(J,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let b=await mm(this.datastore,a);return b.forEach(a=>this.recordVersion(a)),b}set(a,b){this.write(b.toMutation(a,this.precondition(a))),this.writtenDocs.add(a.toString())}update(a,b){try{this.write(b.toMutation(a,this.preconditionForUpdate(a)))}catch(a){this.lastTransactionError=a}this.writtenDocs.add(a.toString())}delete(a){this.write(new f4(a,this.precondition(a))),this.writtenDocs.add(a.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let a=this.readVersions;this.mutations.forEach(b=>{a.delete(b.key.toString())}),a.forEach((a,b)=>{let c=av.fromPath(b);this.mutations.push(new f7(c,this.precondition(c)))}),await ml(this.datastore,this.mutations),this.committed=!0}recordVersion(a){let b;if(a.isFoundDocument())b=a.version;else if(a.isNoDocument())b=aK.min();else throw B(50498,{documentName:a.constructor.name});let c=this.readVersions.get(a.key.toString());if(c){if(!b.isEqual(c))throw new X(R,"Document version changed between two reads.")}else this.readVersions.set(a.key.toString(),b)}precondition(a){let b=this.readVersions.get(a.toString());return this.writtenDocs.has(a.toString())||!b?fP.none():b.isEqual(aK.min())?fP.exists(!1):fP.updateTime(b)}preconditionForUpdate(a){let b=this.readVersions.get(a.toString());if(this.writtenDocs.has(a.toString())||!b)return fP.exists(!0);if(b.isEqual(aK.min()))throw new X(J,"Can't update a document that doesn't exist.");return fP.updateTime(b)}write(a){this.ensureCommitNotCalled(),this.mutations.push(a)}ensureCommitNotCalled(){}}class ov{constructor(a,b,c,d,e){this.asyncQueue=a,this.datastore=b,this.options=c,this.updateFunction=d,this.deferred=e,this.attemptsRemaining=c.maxAttempts,this.backoff=new mb(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let a=new ou(this.datastore),b=this.tryRunUpdateFunction(a);b&&b.then(b=>{this.asyncQueue.enqueueAndForget(()=>a.commit().then(()=>{this.deferred.resolve(b)}).catch(a=>{this.handleTransactionError(a)}))}).catch(a=>{this.handleTransactionError(a)})})}tryRunUpdateFunction(a){try{let b=this.updateFunction(a);if(c8(b)||!b.catch||!b.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return b}catch(a){return this.deferred.reject(a),null}}handleTransactionError(a){this.attemptsRemaining>0&&this.isRetryableTransactionError(a)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(a)}isRetryableTransactionError(a){if(a?.name==="FirebaseError"){let b=a.code;return"aborted"===b||"failed-precondition"===b||"already-exists"===b||!gc(b)}return!1}}let ow="FirestoreClient",ox=100,oy=11,oz=20,oA=22;class oB{constructor(a,b,c,d,e){this.authCredentials=a,this.appCheckCredentials=b,this.asyncQueue=c,this._databaseInfo=d,this.user=q.UNAUTHENTICATED,this.clientId=ai.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=e,this.authCredentials.start(c,async a=>{x(ow,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(c,a=>(x(ow,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:ox}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}terminate(){this.asyncQueue.enterRestrictedMode();let a=new Y;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(c){let b=m8(c,"Failed to shutdown persistence");a.reject(b)}}),a.promise}}async function oC(a,b){a.asyncQueue.verifyOperationInProgress(),x(ow,"Initializing OfflineComponentProvider");let c=a.configuration;await b.initialize(c);let d=c.initialUser;a.setCredentialChangeListener(async a=>{d.isEqual(a)||(await kU(b.localStore,a),d=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=b}async function oD(a,b){a.asyncQueue.verifyOperationInProgress();let c=await oF(a);x(ow,"Initializing OnlineComponentProvider"),await b.initialize(c,a.configuration),a.setCredentialChangeListener(a=>m2(b.remoteStore,a)),a.setAppCheckTokenChangeListener((a,c)=>m2(b.remoteStore,c)),a._onlineComponents=b}function oE(a){return"FirebaseError"===a.name?a.code===Q||a.code===T:!("u">typeof DOMException&&a instanceof DOMException)||a.code===oA||a.code===oz||a.code===oy}async function oF(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){x(ow,"Using user provided OfflineComponentProvider");try{await oC(a,a._uninitializedComponentsProvider._offline)}catch(c){let b=c;if(!oE(b))throw b;z("Error using user provided cache. Falling back to memory cache: "+b),await oC(a,new og)}}else x(ow,"Using default OfflineComponentProvider"),await oC(a,new oh(void 0));return a._offlineComponents}async function oG(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(x(ow,"Using user provided OnlineComponentProvider"),await oD(a,a._uninitializedComponentsProvider._online)):(x(ow,"Using default OnlineComponentProvider"),await oD(a,new ok))),a._onlineComponents}function oH(a){return oF(a).then(a=>a.persistence)}function oI(a){return oF(a).then(a=>a.localStore)}function oJ(a){return oG(a).then(a=>a.remoteStore)}function oK(a){return oG(a).then(a=>a.syncEngine)}function oL(a){return oG(a).then(a=>a.datastore)}async function oM(a){let b=await oG(a),c=b.eventManager;return c.onListen=nE.bind(null,b.syncEngine),c.onUnlisten=nI.bind(null,b.syncEngine),c.onFirstRemoteStoreListen=nF.bind(null,b.syncEngine),c.onLastRemoteStoreUnlisten=nJ.bind(null,b.syncEngine),c}function oN(a){return a.asyncQueue.enqueue(async()=>{let b=await oH(a),c=await oJ(a);return b.setNetworkEnabled(!0),my(c)})}function oO(a){return a.asyncQueue.enqueue(async()=>{let b=await oH(a),c=await oJ(a);return b.setNetworkEnabled(!1),mA(c)})}function oP(a){let b=new Y;return a.asyncQueue.enqueueAndForget(async()=>nQ(await oK(a),b)),b.promise}function oQ(a,b,c,d){let e=new oo(d),f=new np(b,e,c);return a.asyncQueue.enqueueAndForget(async()=>ng(await oM(a),f)),()=>{e.mute(),a.asyncQueue.enqueueAndForget(async()=>nh(await oM(a),f))}}function oR(a,b){let c=new Y;return a.asyncQueue.enqueueAndForget(async()=>oZ(await oI(a),b,c)),c.promise}function oS(a,b,c={}){let d=new Y;return a.asyncQueue.enqueueAndForget(async()=>o$(await oM(a),a.asyncQueue,b,c,d)),d.promise}function oT(a,b){let c=new Y;return a.asyncQueue.enqueueAndForget(async()=>o_(await oI(a),b,c)),c.promise}function oU(a,b,c={}){let d=new Y;return a.asyncQueue.enqueueAndForget(async()=>o0(await oM(a),a.asyncQueue,b,c,d)),d.promise}function oV(a,b,c){let d=new Y;return a.asyncQueue.enqueueAndForget(async()=>{try{let e=await oL(a);d.resolve(mn(e,b,c))}catch(a){d.reject(a)}}),d.promise}function oW(a,b){let c=new Y;return a.asyncQueue.enqueueAndForget(async()=>nK(await oK(a),b,c)),c.promise}function oX(a,b){let c=new oo(b);return a.asyncQueue.enqueueAndForget(async()=>nl(await oM(a),c)),()=>{c.mute(),a.asyncQueue.enqueueAndForget(async()=>nm(await oM(a),c))}}function oY(a,b,c){let d=new Y;return a.asyncQueue.enqueueAndForget(async()=>{let e=await oL(a);new ov(a.asyncQueue,e,c,b,d).run()}),d.promise}async function oZ(a,b,c){try{let d=await k4(a,b);d.isFoundDocument()?c.resolve(d):d.isNoDocument()?c.resolve(null):c.reject(new X(V,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){let a=m8(d,`Failed to get document '${b} from cache`);c.reject(a)}}function o$(a,b,c,d,e){let f=new oo({next:h=>{f.mute(),b.enqueueAndForget(()=>nh(a,g));let i=h.docs.has(c);!i&&h.fromCache?e.reject(new X(V,"Failed to get document because the client is offline.")):i&&h.fromCache&&d&&"server"===d.source?e.reject(new X(V,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e.resolve(h)},error:a=>e.reject(a)}),g=new np(eP(c.path),f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return ng(a,g)}async function o_(a,b,c){try{let d=await k8(a,b,!0),e=new nx(b,d.remoteKeys),f=e.computeDocChanges(d.documents),g=e.applyChanges(f,!1);c.resolve(g.snapshot)}catch(d){let a=m8(d,`Failed to execute query '${b} against cache`);c.reject(a)}}function o0(a,b,c,d,e){let f=new oo({next:c=>{f.mute(),b.enqueueAndForget(()=>nh(a,g)),c.fromCache&&"server"===d.source?e.reject(new X(V,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e.resolve(c)},error:a=>e.reject(a)}),g=new np(c,f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return ng(a,g)}function o1(a,b,c,d){let e=o3(c,l6(b));a.asyncQueue.enqueueAndForget(async()=>{oe(await oK(a),e,d)})}function o2(a,b){return a.asyncQueue.enqueue(async()=>lk(await oI(a),b))}function o3(a,b){let c;return or(on(c="string"==typeof a?gi().encode(a):a),b)}function o4(a,b){return ot(a,b)}function o5(a,b){return a.asyncQueue.enqueue(async()=>lm(await oI(a),b))}function o6(a,b){return a.asyncQueue.enqueue(async()=>ln(await oI(a),b))}function o7(a){return a.asyncQueue.enqueue(async()=>lo(await oI(a)))}function o8(a,b){return a.timeoutSeconds===b.timeoutSeconds}function o9(a){let b={};return void 0!==a.timeoutSeconds&&(b.timeoutSeconds=a.timeoutSeconds),b}let pa="ComponentProvider",pb=new Map;function pc(a){let b=pb.get(a);b&&(x(pa,"Removing Datastore"),pb.delete(a),b.terminate())}function pd(a,b,c,d,e){return new c3(a,b,c,e.host,e.ssl,e.experimentalForceLongPolling,e.experimentalAutoDetectLongPolling,o9(e.experimentalLongPollingOptions),e.useFetchStreams,e.isUsingEmulator,d)}let pe="firestore.googleapis.com",pf=!0,pg=5,ph=30,pi=!0;class pj{constructor(a){if(void 0===a.host){if(void 0!==a.ssl)throw new X(J,"Can't provide ssl option if host option is not set");this.host=pe,this.ssl=pf}else this.host=a.host,this.ssl=a.ssl??pf;if(this.isUsingEmulator=void 0!==a.emulatorOptions,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,void 0===a.cacheSizeBytes)this.cacheSizeBytes=jB;else if(a.cacheSizeBytes!==jA&&a.cacheSizeBytes<jE)throw new X(J,`cacheSizeBytes must be at least ${jE}`);else this.cacheSizeBytes=a.cacheSizeBytes;ax("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===a.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=pi:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=o9(a.experimentalLongPollingOptions??{}),pk(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&o8(this.experimentalLongPollingOptions,a.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}function pk(a){if(void 0!==a.timeoutSeconds){if(isNaN(a.timeoutSeconds))throw new X(J,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<pg)throw new X(J,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is ${pg})`);if(a.timeoutSeconds>ph)throw new X(J,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is ${ph})`)}}class pl{constructor(a,b,c,d){this._authCredentials=a,this._appCheckCredentials=b,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pj({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new X(Q,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(a){if(this._settingsFrozen)throw new X(Q,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pj(a),this._emulatorOptions=a.emulatorOptions||{},void 0!==a.credentials&&(this._authCredentials=ag(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return pc(this),Promise.resolve()}}function pm(a,b,c,d={}){a=aD(a,pl);let e=(0,i.isCloudWorkstation)(b),f=a._getSettings(),g={...f,emulatorOptions:a._getEmulatorOptions()},h=`${b}:${c}`;e&&((0,i.pingServer)(`https://${h}`),(0,i.updateEmulatorBanner)("Firestore",!0)),f.host!==pe&&f.host!==h&&z("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let j={...f,host:h,ssl:e,emulatorOptions:d};if(!(0,i.deepEqual)(j,g)&&(a._setSettings(j),d.mockUserToken)){let b,c;if("string"==typeof d.mockUserToken)b=d.mockUserToken,c=q.MOCK_USER;else{b=(0,i.createMockUserToken)(d.mockUserToken,a._app?.options.projectId);let e=d.mockUserToken.sub||d.mockUserToken.user_id;if(!e)throw new X(J,"mockUserToken must contain 'sub' or 'user_id' field!");c=new q(e)}a._authCredentials=new _(new Z(b,c))}}class pn{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new pn(this.firestore,a,this._query)}}class po{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pp(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new po(this.firestore,a,this._key)}toJSON(){return{type:po._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,b,c){if(aG(b,po._jsonSchema))return new po(a,c||null,new av(as.fromString(b.referencePath)))}}po._jsonSchemaVersion="firestore/documentReference/1.0",po._jsonSchema={type:aF("string",po._jsonSchemaVersion),referencePath:aF("string")};class pp extends pn{constructor(a,b,c){super(a,b,eP(c)),this._path=c,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let a=this._path.popLast();return a.isEmpty()?null:new po(this.firestore,null,new av(a))}withConverter(a){return new pp(this.firestore,a,this._path)}}function pq(a,b,...c){if(a=(0,i.getModularInstance)(a),aw("collection","path",b),a instanceof pl){let d=as.fromString(b,...c);return az(d),new pp(a,null,d)}{if(!(a instanceof po)&&!(a instanceof pp))throw new X(J,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(as.fromString(b,...c));return az(d),new pp(a.firestore,null,d)}}function pr(a,b){if(a=aD(a,pl),aw("collectionGroup","collection id",b),b.indexOf("/")>=0)throw new X(J,`Invalid collection ID '${b}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new pn(a,null,eT(b))}function ps(a,b,...c){if(a=(0,i.getModularInstance)(a),1==arguments.length&&(b=ai.newId()),aw("doc","path",b),a instanceof pl){let d=as.fromString(b,...c);return ay(d),new po(a,null,new av(d))}{if(!(a instanceof po)&&!(a instanceof pp))throw new X(J,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(as.fromString(b,...c));return ay(d),new po(a.firestore,a instanceof pp?a.converter:null,new av(d))}}function pt(a,b){return a=(0,i.getModularInstance)(a),b=(0,i.getModularInstance)(b),(a instanceof po||a instanceof pp)&&(b instanceof po||b instanceof pp)&&a.firestore===b.firestore&&a.path===b.path&&a.converter===b.converter}function pu(a,b){return a=(0,i.getModularInstance)(a),b=(0,i.getModularInstance)(b),a instanceof pn&&b instanceof pn&&a.firestore===b.firestore&&e3(a._query,b._query)&&a.converter===b.converter}let pv="AsyncQueue";class pw{constructor(a=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new mb(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=a}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.verifyNotFailed(),this.enqueueInternal(a)}enterRestrictedMode(a){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=a||!1)}enqueue(a){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let b=new Y;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(a().then(b.resolve,b.reject),b.promise)).then(()=>b.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.retryableOps.push(a),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(a){if(a9(a))x(pv,"Operation failed with retryable error: "+a);else throw a}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(a){let b=this.tail.then(()=>(this.operationInProgress=!0,a().catch(a=>{throw this.failure=a,this.operationInProgress=!1,y("INTERNAL UNHANDLED ERROR: ",px(a)),a}).then(a=>(this.operationInProgress=!1,a))));return this.tail=b,b}enqueueAfterDelay(a,b,c){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(a)>-1&&(b=0);let d=m7.createAndSchedule(this,a,b,c,a=>this.removeDelayedOperation(a));return this.delayedOperations.push(d),d}verifyNotFailed(){this.failure&&B(47125,{messageOrStack:px(this.failure)})}verifyOperationInProgress(){}async drain(){let a;do a=this.tail,await a;while(a!==this.tail)}containsDelayedOperation(a){for(let b of this.delayedOperations)if(b.timerId===a)return!0;return!1}runAllDelayedOperationsUntil(a){return this.drain().then(()=>{for(let b of(this.delayedOperations.sort((a,b)=>a.targetTimeMs-b.targetTimeMs),this.delayedOperations))if(b.skipDelay(),"all"!==a&&b.timerId===a)break;return this.drain()})}skipDelaysForTimerId(a){this.timerIdsToSkip.push(a)}removeDelayedOperation(a){let b=this.delayedOperations.indexOf(a);this.delayedOperations.splice(b,1)}}function px(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}class py{constructor(){this._progressObserver={},this._taskCompletionResolver=new Y,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(a,b,c){this._progressObserver={next:a,error:b,complete:c}}catch(a){return this._taskCompletionResolver.promise.catch(a)}then(a,b){return this._taskCompletionResolver.promise.then(a,b)}_completeWith(a){this._updateProgress(a),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(a)}_failWith(a){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(a),this._taskCompletionResolver.reject(a)}_updateProgress(a){this._lastProgress=a,this._progressObserver.next&&this._progressObserver.next(a)}}let pz=jA;class pA extends pl{constructor(a,b,c,d){super(a,b,c,d),this.type="firestore",this._queue=new pw,this._persistenceKey=d?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let a=this._firestoreClient.terminate();this._queue=new pw(a),this._firestoreClient=void 0,await a}}}function pB(a,b,c){c||(c=c4);let d=(0,h._getProvider)(a,"firestore");if(d.isInitialized(c)){let a=d.getImmediate({identifier:c}),e=d.getOptions(c);if((0,i.deepEqual)(e,b))return a;throw new X(Q,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==b.cacheSizeBytes&&void 0!==b.localCache)throw new X(J,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==b.cacheSizeBytes&&b.cacheSizeBytes!==pz&&b.cacheSizeBytes<jE)throw new X(J,`cacheSizeBytes must be at least ${jE}`);return b.host&&(0,i.isCloudWorkstation)(b.host)&&(0,i.pingServer)(b.host),d.initialize({options:b,instanceIdentifier:c})}function pC(a,b){let c="object"==typeof a?a:(0,h.getApp)(),d="string"==typeof a?a:b||c4,e=(0,h._getProvider)(c,"firestore").getImmediate({identifier:d});if(!e._initialized){let a=(0,i.getDefaultEmulatorHostnameAndPort)("firestore");a&&pm(e,...a)}return e}function pD(a){if(a._terminated)throw new X(Q,"The client has already been terminated.");return a._firestoreClient||pE(a),a._firestoreClient}function pE(a){let b=a._freezeSettings(),c=pd(a._databaseId,a._app?.options.appId||"",a._persistenceKey,a._app?.options.apiKey,b);!a._componentsProvider&&b.localCache?._offlineComponentProvider&&b.localCache?._onlineComponentProvider&&(a._componentsProvider={_offline:b.localCache._offlineComponentProvider,_online:b.localCache._onlineComponentProvider}),a._firestoreClient=new oB(a._authCredentials,a._appCheckCredentials,a._queue,c,a._componentsProvider&&pF(a._componentsProvider))}function pF(a){let b=a?._online.build();return{_offline:a?._offline.build(b),_online:b}}function pG(a,b){z("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let c=a._freezeSettings();return pI(a,ok.provider,{build:a=>new oi(a,c.cacheSizeBytes,b?.forceOwnership)}),Promise.resolve()}async function pH(a){z("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let b=a._freezeSettings();pI(a,ok.provider,{build:a=>new oj(a,b.cacheSizeBytes)})}function pI(a,b,c){if((a=aD(a,pA))._firestoreClient||a._terminated)throw new X(Q,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(a._componentsProvider||a._getSettings().localCache)throw new X(Q,"SDK cache is already specified.");a._componentsProvider={_online:b,_offline:c},pE(a)}function pJ(a){if(a._initialized&&!a._terminated)throw new X(Q,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let b=new Y;return a._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await kN(kM(a._databaseId,a._persistenceKey)),b.resolve()}catch(a){b.reject(a)}}),b.promise}function pK(a){return oP(pD(a=aD(a,pA)))}function pL(a){return oN(pD(a=aD(a,pA)))}function pM(a){return oO(pD(a=aD(a,pA)))}function pN(a){return(0,h._removeServiceInstance)(a.app,"firestore",a._databaseId.database),a._delete()}function pO(a,b){let c=pD(a=aD(a,pA)),d=new py;return o1(c,a._databaseId,b,d),d}function pP(a,b){return o2(pD(a=aD(a,pA)),b).then(b=>b?new pn(a,null,b.query):null)}class pQ{constructor(a,b,c){this.alias=a,this.aggregateType=b,this.fieldPath=c}}class pR{constructor(a){this._byteString=a}static fromBase64String(a){try{return new pR(cQ.fromBase64String(a))}catch(a){throw new X(J,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new pR(cQ.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:pR._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(aG(a,pR._jsonSchema))return pR.fromBase64String(a.bytes)}}pR._jsonSchemaVersion="firestore/bytes/1.0",pR._jsonSchema={type:aF("string",pR._jsonSchemaVersion),bytes:aF("string")};class pS{constructor(...a){for(let b=0;b<a.length;++b)if(0===a[b].length)throw new X(J,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new au(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}function pT(){return new pS(aq)}class pU{constructor(a){this._methodName=a}}class pV{constructor(a,b){if(!isFinite(a)||a<-90||a>90)throw new X(J,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||b<-180||b>180)throw new X(J,"Longitude must be a number between -180 and 180, but was: "+b);this._lat=a,this._long=b}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return aj(this._lat,a._lat)||aj(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:pV._jsonSchemaVersion}}static fromJSON(a){if(aG(a,pV._jsonSchema))return new pV(a.latitude,a.longitude)}}pV._jsonSchemaVersion="firestore/geoPoint/1.0",pV._jsonSchema={type:aF("string",pV._jsonSchemaVersion),latitude:aF("number"),longitude:aF("number")};class pW{constructor(a){this._values=(a||[]).map(a=>a)}toArray(){return this._values.map(a=>a)}isEqual(a){return kP(this._values,a._values)}toJSON(){return{type:pW._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(aG(a,pW._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every(a=>"number"==typeof a))return new pW(a.vectorValues);throw new X(J,"Expected 'vectorValues' field to be a number array")}}}pW._jsonSchemaVersion="firestore/vectorValue/1.0",pW._jsonSchema={type:aF("string",pW._jsonSchemaVersion),vectorValues:aF("object")};let pX=/^__.*__$/;class pY{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return null!==this.fieldMask?new f$(a,this.data,this.fieldMask,b,this.fieldTransforms):new fX(a,this.data,b,this.fieldTransforms)}}class pZ{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return new f$(a,this.data,this.fieldMask,b,this.fieldTransforms)}}function p$(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B(40011,{dataSource:a})}}class p_{constructor(a,b,c,d,e,f){this.settings=a,this.databaseId=b,this.serializer=c,this.ignoreUndefinedProperties=d,void 0===e&&this.validatePath(),this.fieldTransforms=e||[],this.fieldMask=f||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(a){return new p_({...this.settings,...a},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePathSegment(a),c}childContextForFieldPath(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePath(),c}childContextForArray(a){return this.contextWith({path:void 0,arrayElement:!0})}createError(a){return qn(a,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(a){return void 0!==this.fieldMask.find(b=>a.isPrefixOf(b))||void 0!==this.fieldTransforms.find(b=>a.isPrefixOf(b.field))}validatePath(){if(this.path)for(let a=0;a<this.path.length;a++)this.validatePathSegment(this.path.get(a))}validatePathSegment(a){if(0===a.length)throw this.createError("Document fields must not be empty");if(p$(this.dataSource)&&pX.test(a))throw this.createError('Document fields cannot begin and end with "__"')}}class p0{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.serializer=c||l6(a)}createContext(a,b,c,d=!1){return new p_({dataSource:a,methodName:b,targetDoc:c,path:au.emptyPath(),arrayElement:!1,hasConverter:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function p1(a){let b=a._freezeSettings(),c=l6(a._databaseId);return new p0(a._databaseId,!!b.ignoreUndefinedProperties,c)}function p2(a,b,c,d,e,f={}){let g,h,i=a.createContext(f.merge||f.mergeFields?2:0,b,c,e);qj("Data must be an object, but it was:",i,d);let j=qd(d,i);if(f.merge)g=new cM(i.fieldMask),h=i.fieldTransforms;else if(f.mergeFields){let a=[];for(let d of f.mergeFields){let e=qk(b,d,c);if(!i.contains(e))throw new X(J,`Field '${e}' is specified in your field mask but missing from your input data.`);qo(a,e)||a.push(e)}g=new cM(a),h=i.fieldTransforms.filter(a=>g.covers(a.field))}else g=null,h=i.fieldTransforms;return new pY(new d$(j),g,h)}class p3 extends pU{_toFieldTransform(a){if(2===a.dataSource)a.fieldMask.push(a.path);else if(1===a.dataSource)throw a.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw a.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(a){return a instanceof p3}}function p4(a,b,c){return new p_({dataSource:3,targetDoc:b.settings.targetDoc,methodName:a._methodName,arrayElement:c},b.databaseId,b.serializer,b.ignoreUndefinedProperties)}class p5 extends pU{_toFieldTransform(a){return new fL(a.path,new fC)}isEqual(a){return a instanceof p5}}class p6 extends pU{constructor(a,b){super(a),this._elements=b}_toFieldTransform(a){let b=p4(this,a,!0),c=new fD(this._elements.map(a=>qc(a,b)));return new fL(a.path,c)}isEqual(a){return a instanceof p6&&(0,i.deepEqual)(this._elements,a._elements)}}class p7 extends pU{constructor(a,b){super(a),this._elements=b}_toFieldTransform(a){let b=p4(this,a,!0),c=new fF(this._elements.map(a=>qc(a,b)));return new fL(a.path,c)}isEqual(a){return a instanceof p7&&(0,i.deepEqual)(this._elements,a._elements)}}class p8 extends pU{constructor(a,b){super(a),this._operand=b}_toFieldTransform(a){let b=new fH(a.serializer,fw(a.serializer,this._operand));return new fL(a.path,b)}isEqual(a){return a instanceof p8&&this._operand===a._operand}}function p9(a,b,c,d){let e=a.createContext(1,b,c);qj("Data must be an object, but it was:",e,d);let f=[],g=d$.empty();return cB(d,(a,d)=>{let h=qm(b,a,c);d=(0,i.getModularInstance)(d);let j=e.childContextForFieldPath(h);if(d instanceof p3)f.push(h);else{let a=qc(d,j);null!=a&&(f.push(h),g.set(h,a))}}),new pZ(g,new cM(f),e.fieldTransforms)}function qa(a,b,c,d,e,f){let g=a.createContext(1,b,c),h=[qk(b,d,c)],j=[e];if(f.length%2!=0)throw new X(J,`Function ${b}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<f.length;a+=2)h.push(qk(b,f[a])),j.push(f[a+1]);let k=[],l=d$.empty();for(let a=h.length-1;a>=0;--a)if(!qo(k,h[a])){let b=h[a],c=j[a];c=(0,i.getModularInstance)(c);let d=g.childContextForFieldPath(b);if(c instanceof p3)k.push(b);else{let a=qc(c,d);null!=a&&(k.push(b),l.set(b,a))}}return new pZ(l,new cM(k),g.fieldTransforms)}function qb(a,b,c,d=!1){return qc(c,a.createContext(d?4:3,b))}function qc(a,b){if(qi(a=(0,i.getModularInstance)(a)))return qj("Unsupported field value:",b,a),qd(a,b);if(a instanceof pU)return qf(a,b),null;if(void 0===a&&b.ignoreUndefinedProperties)return null;if(b.path&&b.fieldMask.push(b.path),!(a instanceof Array))return qg(a,b);if(b.settings.arrayElement&&4!==b.dataSource)throw b.createError("Nested arrays are not supported");return qe(a,b)}function qd(a,b){let c={};return cD(a)?b.path&&b.path.length>0&&b.fieldMask.push(b.path):cB(a,(a,d)=>{let e=qc(d,b.childContextForField(a));null!=e&&(c[a]=e)}),{mapValue:{fields:c}}}function qe(a,b){let c=[],d=0;for(let e of a){let a=qc(e,b.childContextForArray(d));null==a&&(a={nullValue:"NULL_VALUE"}),c.push(a),d++}return{arrayValue:{values:c}}}function qf(a,b){if(!p$(b.dataSource))throw b.createError(`${a._methodName}() can only be used with update() and set()`);if(!b.path)throw b.createError(`${a._methodName}() is not currently supported inside arrays`);let c=a._toFieldTransform(b);c&&b.fieldTransforms.push(c)}function qg(a,b){if(null===(a=(0,i.getModularInstance)(a)))return{nullValue:"NULL_VALUE"};if("number"==typeof a)return fw(b.serializer,a);if("boolean"==typeof a)return{booleanValue:a};if("string"==typeof a)return{stringValue:a};if(a instanceof Date){let c=aJ.fromDate(a);return{timestampValue:gI(b.serializer,c)}}else if(a instanceof aJ){let c=new aJ(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:gI(b.serializer,c)}}else if(a instanceof pV)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};else if(a instanceof pR)return{bytesValue:gK(b.serializer,a._byteString)};else if(a instanceof po){let c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.createError(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:gO(a.firestore._databaseId||b.databaseId,a._key.path)}}else if(a instanceof pW)return qh(a,b);else if(hO(a))return a._toProto(b.serializer);else throw b.createError(`Unsupported field value: ${aB(a)}`)}function qh(a,b){return{mapValue:{fields:{[db]:{stringValue:de},[df]:{arrayValue:{values:(a instanceof pW?a.toArray():a).map(a=>{if("number"!=typeof a)throw b.createError("VectorValues must only contain numeric values.");return fu(b.serializer,a)})}}}}}}function qi(a){return"object"==typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof aJ)&&!(a instanceof pV)&&!(a instanceof pR)&&!(a instanceof po)&&!(a instanceof pU)&&!(a instanceof pW)&&!hO(a)}function qj(a,b,c){if(!qi(c)||!aA(c)){let d=aB(c);if("an object"===d)throw b.createError(a+" a custom object");throw b.createError(a+" "+d)}}function qk(a,b,c){if((b=(0,i.getModularInstance)(b))instanceof pS)return b._internalPath;if("string"==typeof b)return qm(a,b);throw qn("Field path arguments must be of type string or ",a,!1,void 0,c)}let ql=RegExp("[~\\*/\\[\\]]");function qm(a,b,c){if(b.search(ql)>=0)throw qn(`Invalid field path (${b}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,c);try{return new pS(...b.split("."))._internalPath}catch(d){throw qn(`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,c)}}function qn(a,b,c,d,e){let f=d&&!d.isEmpty(),g=void 0!==e,h=`Function ${b}() called with invalid data`;c&&(h+=" (via `toFirestore()`)"),h+=". ";let i="";return(f||g)&&(i+=" (found",f&&(i+=` in field ${d}`),g&&(i+=` in document ${e}`),i+=")"),new X(J,h+a+i)}function qo(a,b){return a.some(a=>a.isEqual(b))}class qp{convertValue(a,b="none"){switch(dh(a)){case 0:return null;case 1:return a.booleanValue;case 2:return cV(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(cW(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 11:return this.convertObject(a.mapValue,b);case 10:return this.convertVectorValue(a.mapValue);default:throw B(62114,{value:a})}}convertObject(a,b){return this.convertObjectMap(a.fields,b)}convertObjectMap(a,b="none"){let c={};return cB(a,(a,d)=>{c[a]=this.convertValue(d,b)}),c}convertVectorValue(a){return new pW(a.fields?.[df].arrayValue?.values?.map(a=>cV(a.doubleValue)))}convertGeoPoint(a){return new pV(cV(a.latitude),cV(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":let c=c1(a);if(null==c)return null;return this.convertValue(c,b);case"estimate":return this.convertTimestamp(c2(a));default:return null}}convertTimestamp(a){let b=cU(a);return new aJ(b.seconds,b.nanos)}convertDocumentKey(a,b){let c=as.fromString(a);D(hN(c),9688,{name:a});let d=new c5(c.get(1),c.get(3)),e=new av(c.popFirst(5));return d.isEqual(b)||y(`Document ${e} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),e}}class qq extends qp{constructor(a){super(),this.firestore=a}convertBytes(a){return new pR(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new po(this.firestore,null,b)}}function qr(){return new p3("deleteField")}function qs(){return new p5("serverTimestamp")}function qt(...a){return new p6("arrayUnion",a)}function qu(...a){return new p7("arrayRemove",a)}function qv(a){return new p8("increment",a)}function qw(a){return new pW(a)}function qx(a){let b=pD(aD(a.firestore,pA)),c=b._onlineComponents?.datastore.serializer;return void 0===c?null:hf(c,eX(a._query)).queryTarget}function qy(a,b){let c=cC(b,(a,b)=>new pQ(b,a.aggregateType,a._internalFieldPath)),d=pD(aD(a.firestore,pA)),e=d._onlineComponents?.datastore.serializer;return void 0===e?null:hg(e,eY(a._query),c,!0).request}var qz=i;let qA="@firebase/firestore",qB="4.11.0";function qC(a,b=!0){s(f.SDK_VERSION),(0,f._registerComponent)(new g.Component("firestore",(a,{instanceIdentifier:c,options:d})=>{let e=a.getProvider("app").getImmediate(),f=new pA(new aa(a.getProvider("auth-internal")),new ae(e,a.getProvider("app-check-internal")),c6(e,c),e);return d={useFetchStreams:b,...d},f._setSettings(d),f},"PUBLIC").setMultipleInstances(!0)),(0,f.registerVersion)(qA,qB,a),(0,f.registerVersion)(qA,qB,"esm2020")}class qD{constructor(a="count",b){this._internalFieldPath=b,this.type="AggregateField",this.aggregateType=a}}class qE{constructor(a,b,c){this._userDataWriter=b,this._data=c,this.type="AggregateQuerySnapshot",this.query=a}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new d$({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class qF{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new po(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let a=new qG(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(a){if(this._document){let b=this._document.data.field(qk("DocumentSnapshot.get",a));if(null!==b)return this._userDataWriter.convertValue(b)}}}class qG extends qF{data(){return super.data()}}function qH(a){if("L"===a.limitType&&0===a.explicitOrderBy.length)throw new X(T,"limitToLast() queries require specifying at least one orderBy() clause")}class qI{}class qJ extends qI{}function qK(a,b,...c){let d=[];for(let e of(b instanceof qI&&d.push(b),rb(d=d.concat(c)),d))a=e._apply(a);return a}class qL extends qJ{constructor(a,b,c){super(),this._field=a,this._op=b,this._value=c,this.type="where"}static _create(a,b,c){return new qL(a,b,c)}_apply(a){let b=this._parse(a);return q7(a._query,b),new pn(a.firestore,a.converter,e$(a._query,b))}_parse(a){let b=p1(a.firestore);return q0(a._query,"where",b,a.firestore._databaseId,this._field,this._op,this._value)}}function qM(a,b,c){let d=b,e=qk("where",a);return qL._create(e,d,c)}class qN extends qI{constructor(a,b){super(),this.type=a,this._queryConstraints=b}static _create(a,b){return new qN(a,b)}_parse(a){let b=this._queryConstraints.map(b=>b._parse(a)).filter(a=>a.getFilters().length>0);return 1===b.length?b[0]:ed.create(b,this._getOperator())}_apply(a){let b=this._parse(a);return 0===b.getFilters().length?a:(q8(a._query,b),new pn(a.firestore,a.converter,e$(a._query,b)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function qO(...a){return a.forEach(a=>ra("or",a)),qN._create("or",a)}function qP(...a){return a.forEach(a=>ra("and",a)),qN._create("and",a)}class qQ extends qJ{constructor(a,b){super(),this._field=a,this._direction=b,this.type="orderBy"}static _create(a,b){return new qQ(a,b)}_apply(a){let b=q1(a._query,this._field,this._direction);return new pn(a.firestore,a.converter,e_(a._query,b))}}function qR(a,b="asc"){let c=b,d=qk("orderBy",a);return qQ._create(d,c)}class qS extends qJ{constructor(a,b,c){super(),this.type=a,this._limit=b,this._limitType=c}static _create(a,b,c){return new qS(a,b,c)}_apply(a){return new pn(a.firestore,a.converter,e0(a._query,this._limit,this._limitType))}}function qT(a){return aE("limit",a),qS._create("limit",a,"F")}function qU(a){return aE("limitToLast",a),qS._create("limitToLast",a,"L")}class qV extends qJ{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new qV(a,b,c)}_apply(a){let b=q_(a,this.type,this._docOrFields,this._inclusive);return new pn(a.firestore,a.converter,e1(a._query,b))}}function qW(...a){return qV._create("startAt",a,!0)}function qX(...a){return qV._create("startAfter",a,!1)}class qY extends qJ{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new qY(a,b,c)}_apply(a){let b=q_(a,this.type,this._docOrFields,this._inclusive);return new pn(a.firestore,a.converter,e2(a._query,b))}}function qZ(...a){return qY._create("endBefore",a,!1)}function q$(...a){return qY._create("endAt",a,!0)}function q_(a,b,c,d){if(c[0]=(0,qz.getModularInstance)(c[0]),c[0]instanceof qF)return q2(a._query,a.firestore._databaseId,b,c[0]._document,d);{let e=p1(a.firestore);return q3(a._query,a.firestore._databaseId,e,b,c,d)}}function q0(a,b,c,d,e,f,g){let h;if(e.isKeyField())if("array-contains"===f||"array-contains-any"===f)throw new X(J,`Invalid Query. You can't perform '${f}' queries on documentId().`);else if("in"===f||"not-in"===f){q5(g,f);let b=[];for(let c of g)b.push(q4(d,a,c));h={arrayValue:{values:b}}}else h=q4(d,a,g);else("in"===f||"not-in"===f||"array-contains-any"===f)&&q5(g,f),h=qb(c,b,g,"in"===f||"not-in"===f);return ec.create(e,f,h)}function q1(a,b,c){if(null!==a.startAt)throw new X(J,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==a.endAt)throw new X(J,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new d7(b,c)}function q2(a,b,c,d,e){if(!d)throw new X(L,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let c of eW(a))if(c.field.isKeyField())f.push(dK(b,d.key));else{let a=d.data.field(c.field);if(c_(a))throw new X(J,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==a)f.push(a);else{let a=c.field.canonicalString();throw new X(J,`Invalid query. You are trying to start or end a query using a document for which the field '${a}' (used as the orderBy) does not exist.`)}}return new d2(f,e)}function q3(a,b,c,d,e,f){let g=a.explicitOrderBy;if(e.length>g.length)throw new X(J,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let h=[];for(let f=0;f<e.length;f++){let i=e[f];if(g[f].field.isKeyField()){if("string"!=typeof i)throw new X(J,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof i}`);if(!eV(a)&&-1!==i.indexOf("/"))throw new X(J,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${i}' contains a slash.`);let c=a.path.child(as.fromString(i));if(!av.isDocumentKey(c))throw new X(J,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${c}' is not because it contains an odd number of segments.`);let e=new av(c);h.push(dK(b,e))}else{let a=qb(c,d,i);h.push(a)}}return new d2(h,f)}function q4(a,b,c){if("string"==typeof(c=(0,qz.getModularInstance)(c))){if(""===c)throw new X(J,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eV(b)&&-1!==c.indexOf("/"))throw new X(J,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${c}' contains a '/' character.`);let d=b.path.child(as.fromString(c));if(!av.isDocumentKey(d))throw new X(J,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${d}' is not because it has an odd number of segments (${d.length}).`);return dK(a,new av(d))}if(c instanceof po)return dK(a,c._key);throw new X(J,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${aB(c)}.`)}function q5(a,b){if(!Array.isArray(a)||0===a.length)throw new X(J,`Invalid Query. A non-empty array is required for '${b.toString()}' filters.`)}function q6(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function q7(a,b){let c=q9(a.filters,q6(b.op));if(null!==c)if(c===b.op)throw new X(J,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`);else throw new X(J,`Invalid query. You cannot use '${b.op.toString()}' filters with '${c.toString()}' filters.`)}function q8(a,b){let c=a;for(let a of b.getFlattenedFilters())q7(c,a),c=e$(c,a)}function q9(a,b){for(let c of a)for(let a of c.getFlattenedFilters())if(b.indexOf(a.op)>=0)return a.op;return null}function ra(a,b){if(!(b instanceof qL)&&!(b instanceof qN))throw new X(J,`Function ${a}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function rb(a){let b=a.filter(a=>a instanceof qN).length,c=a.filter(a=>a instanceof qL).length;if(b>1||b>0&&c>0)throw new X(J,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function rc(a,b,c){return a?c&&(c.merge||c.mergeFields)?a.toFirestore(b,c):a.toFirestore(b):b}class rd extends qp{constructor(a){super(),this.firestore=a}convertBytes(a){return new pR(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new po(this.firestore,null,b)}}function re(a){return new qD("sum",qk("sum",a))}function rf(a){return new qD("avg",qk("average",a))}function rg(){return new qD("count")}function rh(a,b){return a instanceof qD&&b instanceof qD&&a.aggregateType===b.aggregateType&&a._internalFieldPath?.canonicalString()===b._internalFieldPath?.canonicalString()}function ri(a,b){return pu(a.query,b.query)&&(0,qz.deepEqual)(a.data(),b.data())}function rj(a){return rk(a,{count:rg()})}function rk(a,b){let c=aD(a.firestore,pA),d=pD(c),e=cC(b,(a,b)=>new pQ(b,a.aggregateType,a._internalFieldPath));return oV(d,a._query,e).then(b=>rl(c,a,b))}function rl(a,b,c){return new qE(b,new qq(a),c)}class rm{constructor(a){this.kind="memory",this._onlineComponentProvider=ok.provider,a?.garbageCollector?this._offlineComponentProvider=a.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new oh(void 0)}}toJSON(){return{kind:this.kind}}}class rn{constructor(a){let b;this.kind="persistent",a?.tabManager?(a.tabManager._initialize(a),b=a.tabManager):(b=rw(void 0))._initialize(a),this._onlineComponentProvider=b._onlineComponentProvider,this._offlineComponentProvider=b._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class ro{constructor(){this.kind="memoryEager",this._offlineComponentProvider=og.provider}toJSON(){return{kind:this.kind}}}class rp{constructor(a){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new oh(a)}}toJSON(){return{kind:this.kind}}}function rq(){return new ro}function rr(a){return new rp(a?.cacheSizeBytes)}function rs(a){return new rm(a)}function rt(a){return new rn(a)}class ru{constructor(a){this.forceOwnership=a,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=ok.provider,this._offlineComponentProvider={build:b=>new oi(b,a?.cacheSizeBytes,this.forceOwnership)}}}class rv{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=ok.provider,this._offlineComponentProvider={build:b=>new oj(b,a?.cacheSizeBytes)}}}function rw(a){return new ru(a?.forceOwnership)}function rx(){return new rv}let ry=gi();function rz(a){let b=JSON.stringify(a),c=ry.encode(b).byteLength;return`${c}${b}`}rz({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),rz({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),rz({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),rz({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),rz({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),rz({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),rz({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),rz({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let rA=1;class rB{constructor(a,b){this.firestore=a,this.bundleId=b,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new aJ(0,0),this.databaseId=a._databaseId,this.serializer=new gE(this.databaseId,!0),this.userDataReader=new p0(this.databaseId,!0,this.serializer)}addBundleDocument(a,b){let c=this.documents.get(a.documentPath),d=c?.metadata.queries,e=a.readTime,f=c?.metadata.readTime?gJ(c.metadata.readTime):null,g=!e&&null==f,h=void 0!==e&&(null==f||f<e);if((g||h)&&this.documents.set(a.documentPath,{document:this.toBundleDocument(a),metadata:{name:gR(this.serializer,a.documentKey),readTime:e?gI(this.serializer,e):void 0,exists:a.documentExists}}),e&&e>this.latestReadTime&&(this.latestReadTime=e),b){let c=this.documents.get(a.documentPath);c.metadata.queries=d||[],c.metadata.queries.push(b)}}addBundleQuery(a){if(this.namedQueries.has(a.name))throw Error(`Query name conflict: ${name} has already been added.`);let b=new aJ(0,0);for(let c of a.docBundleDataArray)this.addBundleDocument(c,a.name),c.readTime&&c.readTime>b&&(b=c.readTime);let c=hf(this.serializer,eX(a.query)),d={parent:a.parent,structuredQuery:c.queryTarget.structuredQuery};this.namedQueries.set(a.name,{name:a.name,bundledQuery:d,readTime:gI(this.serializer,b)})}toBundleDocument(a){let b=this.userDataReader.createContext(4,"internal toBundledDocument"),c=qd(a.documentData,b);return{name:gR(this.serializer,a.documentKey),fields:c.mapValue.fields,updateTime:gI(this.serializer,a.versionTime),createTime:gI(this.serializer,a.createdTime)}}lengthPrefixedString(a){let b=JSON.stringify(a),c=ry.encode(b).byteLength;return`${c}${b}`}build(){let a="";for(let b of this.namedQueries.values())a+=this.lengthPrefixedString({namedQuery:b});for(let b of this.documents.values()){let c=b.metadata;a+=this.lengthPrefixedString({documentMetadata:c});let d=b.document;d&&(a+=this.lengthPrefixedString({document:d}))}let b={id:this.bundleId,createTime:gI(this.serializer,this.latestReadTime),version:rA,totalDocuments:this.documents.size,totalBytes:ry.encode(a).length};return this.lengthPrefixedString({metadata:b})+a}}function rC(a,b,c,d){let e=new rB(a,ai.newId());return e.addBundleDocument(rE(d,c,b)),e.build()}function rD(a,b,c,d,e,f,g){let h=[];for(let a=0;a<f.length;a++)h.push(rE(e[a],g[a],f[a]));let i={name:c,query:b,parent:d,docBundleDataArray:h},j=new rB(a,c);return j.addBundleQuery(i),j.build()}function rE(a,b,c){return{documentData:b,documentKey:c.mutableCopy().key,documentPath:a,documentExists:!0,createdTime:c.createTime.toTimestamp(),readTime:c.readTime.toTimestamp(),versionTime:c.version.toTimestamp()}}let rF="NOT SUPPORTED";class rG{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class rH extends qF{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps);{let b=new rJ(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}}}get(a,b={}){if(this._document){let c=this._document.data.field(qk("DocumentSnapshot.get",a));if(null!==c)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new X(Q,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a=this._document,b={};if(b.type=rH._jsonSchemaVersion,b.bundle="",b.bundleSource="DocumentSnapshot",b.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument())return b;let c=this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous");return b.bundle=rC(this._firestore,a,c,this.ref.path),b}}function rI(a,b,c){if(aG(b,rH._jsonSchema)){if(b.bundle===rF)throw new X(J,"The provided JSON object was created in a client environment, which is not supported.");let d=l6(a._databaseId),e=o4(b.bundle,d),f=e.getElements(),g=new ns(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);let h=g.documents;if(1!==h.length)throw new X(J,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);let i=g$(d,h[0].document),j=new av(as.fromString(b.bundleName));return new rH(a,new rd(a),j,i,new rG(!1,!1),c||null)}}rH._jsonSchemaVersion="firestore/documentSnapshot/1.0",rH._jsonSchema={type:aF("string",rH._jsonSchemaVersion),bundleSource:aF("string","DocumentSnapshot"),bundleName:aF("string"),bundle:aF("string")};class rJ extends rH{data(a={}){return super.data(a)}}class rK{constructor(a,b,c,d){this._firestore=a,this._userDataWriter=b,this._snapshot=d,this.metadata=new rG(d.hasPendingWrites,d.fromCache),this.query=c}get docs(){let a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new rJ(this._firestore,this._userDataWriter,c.key,c,new rG(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(a={}){let b=!!a.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new X(J,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=rM(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new X(Q,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a={};a.type=rK._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=ai.newId();let b=this._firestore._databaseId.database,c=this._firestore._databaseId.projectId,d=`projects/${c}/databases/${b}/documents`,e=[],f=[],g=[];return this.docs.forEach(a=>{null!==a._document&&(e.push(a._document),f.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),g.push(a.ref.path))}),a.bundle=rD(this._firestore,this.query._query,a.bundleName,d,g,e,f),a}}function rL(a,b,c){if(aG(b,rK._jsonSchema)){if(b.bundle===rF)throw new X(J,"The provided JSON object was created in a client environment, which is not supported.");let d=l6(a._databaseId),e=o4(b.bundle,d),f=e.getElements(),g=new ns(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);if(1!==g.queries.length)throw new X(J,`Snapshot data expected 1 query but found ${g.queries.length} queries.`);let h=h4(g.queries[0].bundledQuery),i=g.documents,j=new m9;i.map(a=>{let b=g$(d,a.document);j=j.add(b)});let k=nb.fromInitialDocuments(h,j,fr(),!1,!1),l=new pn(a,c||null,h);return new rK(a,new rd(a),l,k)}}function rM(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>{let d=new rJ(a._firestore,a._userDataWriter,c.doc.key,c.doc,new rG(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:b++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||3!==a.type).map(b=>{let d=new rJ(a._firestore,a._userDataWriter,b.doc.key,b.doc,new rG(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),e=-1,f=-1;return 0!==b.type&&(e=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),1!==b.type&&(f=(c=c.add(b.doc)).indexOf(b.doc.key)),{type:rN(b.type),doc:d,oldIndex:e,newIndex:f}})}}function rN(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B(61501,{type:a})}}function rO(a,b){return a instanceof rH&&b instanceof rH?a._firestore===b._firestore&&a._key.isEqual(b._key)&&(null===a._document?null===b._document:a._document.isEqual(b._document))&&a._converter===b._converter:a instanceof rK&&b instanceof rK&&a._firestore===b._firestore&&pu(a.query,b.query)&&a.metadata.isEqual(b.metadata)&&a._snapshot.isEqual(b._snapshot)}rK._jsonSchemaVersion="firestore/querySnapshot/1.0",rK._jsonSchema={type:aF("string",rK._jsonSchemaVersion),bundleSource:aF("string","QuerySnapshot"),bundleName:aF("string"),bundle:aF("string")};let rP={maxAttempts:5};function rQ(a){if(a.maxAttempts<1)throw new X(J,"Max attempts must be at least 1")}class rR{constructor(a,b){this._firestore=a,this._commitHandler=b,this._mutations=[],this._committed=!1,this._dataReader=p1(a)}set(a,b,c){this._verifyNotCommitted();let d=rS(a,this._firestore),e=rc(d.converter,b,c),f=p2(this._dataReader,"WriteBatch.set",d._key,e,null!==d.converter,c);return this._mutations.push(f.toMutation(d._key,fP.none())),this}update(a,b,c,...d){let e;this._verifyNotCommitted();let f=rS(a,this._firestore);return e="string"==typeof(b=(0,qz.getModularInstance)(b))||b instanceof pS?qa(this._dataReader,"WriteBatch.update",f._key,b,c,d):p9(this._dataReader,"WriteBatch.update",f._key,b),this._mutations.push(e.toMutation(f._key,fP.exists(!0))),this}delete(a){this._verifyNotCommitted();let b=rS(a,this._firestore);return this._mutations=this._mutations.concat(new f4(b._key,fP.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new X(Q,"A write batch can no longer be used after commit() has been called.")}}function rS(a,b){if((a=(0,qz.getModularInstance)(a)).firestore===b)return a;throw new X(J,"Provided document reference is from a different Firestore instance.")}class rT{constructor(a,b){this._firestore=a,this._transaction=b,this._dataReader=p1(a)}get(a){let b=rS(a,this._firestore),c=new rd(this._firestore);return this._transaction.lookup([b._key]).then(a=>{if(!a||1!==a.length)return B(24041);let d=a[0];if(d.isFoundDocument())return new qF(this._firestore,c,d.key,d,b.converter);if(d.isNoDocument())return new qF(this._firestore,c,b._key,null,b.converter);throw B(18433,{doc:d})})}set(a,b,c){let d=rS(a,this._firestore),e=rc(d.converter,b,c),f=p2(this._dataReader,"Transaction.set",d._key,e,null!==d.converter,c);return this._transaction.set(d._key,f),this}update(a,b,c,...d){let e,f=rS(a,this._firestore);return e="string"==typeof(b=(0,qz.getModularInstance)(b))||b instanceof pS?qa(this._dataReader,"Transaction.update",f._key,b,c,d):p9(this._dataReader,"Transaction.update",f._key,b),this._transaction.update(f._key,e),this}delete(a){let b=rS(a,this._firestore);return this._transaction.delete(b._key),this}}class rU extends rT{constructor(a,b){super(a,b),this._firestore=a}get(a){let b=rS(a,this._firestore),c=new qq(this._firestore);return super.get(a).then(a=>new rH(this._firestore,c,b._key,a._document,new rG(!1,!1),b.converter))}}function rV(a,b,c){a=aD(a,pA);let d={...rP,...c};return rQ(d),oY(pD(a),c=>b(new rU(a,c)),d)}function rW(a){return rX(a,["next","error","complete"])}function rX(a,b){if("object"!=typeof a||null===a)return!1;let c=a;for(let a of b)if(a in c&&"function"==typeof c[a])return!0;return!1}function rY(a){a=aD(a,po);let b=aD(a.firestore,pA);return oS(pD(b),a._key).then(c=>sa(b,a,c))}function rZ(a){a=aD(a,po);let b=aD(a.firestore,pA),c=pD(b),d=new qq(b);return oR(c,a._key).then(c=>new rH(b,d,a._key,c,new rG(null!==c&&c.hasLocalMutations,!0),a.converter))}function r$(a){a=aD(a,po);let b=aD(a.firestore,pA);return oS(pD(b),a._key,{source:"server"}).then(c=>sa(b,a,c))}function r_(a){a=aD(a,pn);let b=aD(a.firestore,pA),c=pD(b),d=new qq(b);return qH(a._query),oU(c,a._query).then(c=>new rK(b,d,a,c))}function r0(a){a=aD(a,pn);let b=aD(a.firestore,pA),c=pD(b),d=new qq(b);return oT(c,a._query).then(c=>new rK(b,d,a,c))}function r1(a){a=aD(a,pn);let b=aD(a.firestore,pA),c=pD(b),d=new qq(b);return oU(c,a._query,{source:"server"}).then(c=>new rK(b,d,a,c))}function r2(a,b,c){a=aD(a,po);let d=aD(a.firestore,pA),e=rc(a.converter,b,c),f=p2(p1(d),"setDoc",a._key,e,null!==a.converter,c).toMutation(a._key,fP.none());return r9(d,[f])}function r3(a,b,c,...d){let e;a=aD(a,po);let f=aD(a.firestore,pA),g=p1(f);return r9(f,[(e="string"==typeof(b=(0,qz.getModularInstance)(b))||b instanceof pS?qa(g,"updateDoc",a._key,b,c,d):p9(g,"updateDoc",a._key,b)).toMutation(a._key,fP.exists(!0))])}function r4(a){return r9(aD(a.firestore,pA),[new f4(a._key,fP.none())])}function r5(a,b){let c=aD(a.firestore,pA),d=ps(a),e=rc(a.converter,b);return r9(c,[p2(p1(a.firestore),"addDoc",d._key,e,null!==a.converter,{}).toMutation(d._key,fP.exists(!1))]).then(()=>d)}function r6(a,...b){let c,d,e;a=(0,qz.getModularInstance)(a);let f={includeMetadataChanges:!1,source:"default"},g=0;"object"!=typeof b[0]||rW(b[g])||(f=b[g++]);let h={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(rW(b[g])){let a=b[g];b[g]=a.next?.bind(a),b[g+1]=a.error?.bind(a),b[g+2]=a.complete?.bind(a)}if(a instanceof po)d=aD(a.firestore,pA),e=eP(a._key.path),c={next:c=>{b[g]&&b[g](sa(d,a,c))},error:b[g+1],complete:b[g+2]};else{let f=aD(a,pn);d=aD(f.firestore,pA),e=f._query;let h=new qq(d);c={next:a=>{b[g]&&b[g](new rK(d,h,f,a))},error:b[g+1],complete:b[g+2]},qH(a._query)}return oQ(pD(d),e,h,c)}function r7(a,b,...c){let d,e=(0,qz.getModularInstance)(a),f=sb(b);if(f.error)throw new X(J,f.error);let g=0;if("object"!=typeof c[0]||rW(c[g])||(d=c[g++]),"QuerySnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&rW(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return sd(e,f,d,a,c[g])}if("DocumentSnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&rW(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return sc(e,f,d,a,c[g])}throw new X(J,`unsupported bundle source: ${f.bundleSource}`)}function r8(a,b){return oX(pD(a=aD(a,pA)),rW(b)?b:{next:b})}function r9(a,b){return oW(pD(a),b)}function sa(a,b,c){let d=c.docs.get(b._key),e=new qq(a);return new rH(a,e,b._key,d,new rG(c.hasPendingWrites,c.fromCache),b.converter)}function sb(a){let b={bundle:"",bundleName:"",bundleSource:""};for(let c of["bundle","bundleName","bundleSource"]){if(!(c in a)){b.error=`snapshotJson missing required field: ${c}`;break}let d=a[c];if("string"!=typeof d){b.error=`snapshotJson field '${c}' must be a string.`;break}if(0===d.length){b.error=`snapshotJson field '${c}' cannot be an empty string.`;break}"bundle"===c?b.bundle=d:"bundleName"===c?b.bundleName=d:"bundleSource"===c&&(b.bundleSource=d)}return b}function sc(a,b,c,d,e){let f,g=!1;return pO(a,b.bundle).then(()=>{g||(f=r6(new po(a,e||null,av.fromPath(b.bundleName)),c||{},d))}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function sd(a,b,c,d,e){let f,g=!1;return pO(a,b.bundle).then(()=>pP(a,b.bundleName)).then(a=>{if(a&&!g){let b=a;e&&b.withConverter(e),f=r6(a,c||{},d)}}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function se(a){return pD(a=aD(a,pA)),new rR(a,b=>r9(a,b))}function sf(a,b){let c=pD(a=aD(a,pA));return c._uninitializedComponentsProvider&&"memory"!==c._uninitializedComponentsProvider._offline.kind?o5(c,sg(b)):(z("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function sg(a){let b="string"==typeof a?sh(a):a,c=[];if(Array.isArray(b.indexes))for(let a of b.indexes){let b=si(a,"collectionGroup"),d=[];if(Array.isArray(a.fields))for(let b of a.fields){let a=qm("setIndexConfiguration",si(b,"fieldPath"));"CONTAINS"===b.arrayConfig?d.push(new aT(a,2)):"ASCENDING"===b.order?d.push(new aT(a,0)):"DESCENDING"===b.order&&d.push(new aT(a,1))}c.push(new aN(aN.UNKNOWN_ID,b,d,aV.empty()))}return c}function sh(a){try{return JSON.parse(a)}catch(a){throw new X(J,"Failed to parse JSON: "+a?.message)}}function si(a,b){if("string"!=typeof a[b])throw new X(J,"Missing string value for: "+b);return a[b]}class sj{constructor(a){this._firestore=a,this.type="PersistentCacheIndexManager"}}function sk(a){a=aD(a,pA);let b=sp.get(a);if(b)return b;let c=pD(a);if(c._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let d=new sj(a);return sp.set(a,d),d}function sl(a){so(a,!0)}function sm(a){so(a,!1)}function sn(a){o7(pD(a._firestore)).then(a=>x("deleting all persistent cache indexes succeeded")).catch(a=>z("deleting all persistent cache indexes failed",a))}function so(a,b){o6(pD(a._firestore),b).then(a=>x(`setting persistent cache index auto creation isEnabled=${b} succeeded`)).catch(a=>z(`setting persistent cache index auto creation isEnabled=${b} failed`,a))}let sp=new WeakMap;class sq{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(a){return sr.instance.onExistenceFilterMismatch(a)}}class sr{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return ss||gh(ss=new sr),ss}notifyOnExistenceFilterMismatch(a){this.existenceFilterMismatchCallbacksById.forEach(b=>b(a))}onExistenceFilterMismatch(a){let b=Symbol(),c=this.existenceFilterMismatchCallbacksById;return c.set(b,a),()=>c.delete(b)}}let ss=null;qC("node"),a.s(["AggregateField",()=>qD,"AggregateQuerySnapshot",()=>qE,"DocumentSnapshot",()=>rH,"PersistentCacheIndexManager",()=>sj,"QueryCompositeFilterConstraint",()=>qN,"QueryConstraint",()=>qJ,"QueryDocumentSnapshot",()=>rJ,"QueryEndAtConstraint",()=>qY,"QueryFieldFilterConstraint",()=>qL,"QueryLimitConstraint",()=>qS,"QueryOrderByConstraint",()=>qQ,"QuerySnapshot",()=>rK,"QueryStartAtConstraint",()=>qV,"SnapshotMetadata",()=>rG,"Transaction",()=>rU,"WriteBatch",()=>rR,"_TestingHooks",()=>sq,"addDoc",()=>r5,"aggregateFieldEqual",()=>rh,"aggregateQuerySnapshotEqual",()=>ri,"and",()=>qP,"average",()=>rf,"count",()=>rg,"deleteAllPersistentCacheIndexes",()=>sn,"deleteDoc",()=>r4,"disablePersistentCacheIndexAutoCreation",()=>sm,"documentSnapshotFromJSON",()=>rI,"enablePersistentCacheIndexAutoCreation",()=>sl,"endAt",()=>q$,"endBefore",()=>qZ,"executeWrite",()=>r9,"getAggregateFromServer",()=>rk,"getCountFromServer",()=>rj,"getDoc",()=>rY,"getDocFromCache",()=>rZ,"getDocFromServer",()=>r$,"getDocs",()=>r_,"getDocsFromCache",()=>r0,"getDocsFromServer",()=>r1,"getPersistentCacheIndexManager",()=>sk,"limit",()=>qT,"limitToLast",()=>qU,"memoryEagerGarbageCollector",()=>rq,"memoryLocalCache",()=>rs,"memoryLruGarbageCollector",()=>rr,"onSnapshot",()=>r6,"onSnapshotResume",()=>r7,"onSnapshotsInSync",()=>r8,"or",()=>qO,"orderBy",()=>qR,"persistentLocalCache",()=>rt,"persistentMultipleTabManager",()=>rx,"persistentSingleTabManager",()=>rw,"query",()=>qK,"querySnapshotFromJSON",()=>rL,"runTransaction",()=>rV,"setDoc",()=>r2,"setIndexConfiguration",()=>sf,"snapshotEqual",()=>rO,"startAfter",()=>qX,"startAt",()=>qW,"sum",()=>re,"updateDoc",()=>r3,"where",()=>qM,"writeBatch",()=>se],1787),a.s([],69387),a.i(1787),a.s(["AbstractUserDataWriter",()=>qp,"AggregateField",()=>qD,"AggregateQuerySnapshot",()=>qE,"Bytes",()=>pR,"CACHE_SIZE_UNLIMITED",()=>pz,"CollectionReference",()=>pp,"DocumentReference",()=>po,"DocumentSnapshot",()=>rH,"FieldPath",()=>pS,"FieldValue",()=>pU,"Firestore",()=>pA,"FirestoreError",()=>X,"GeoPoint",()=>pV,"LoadBundleTask",()=>py,"PersistentCacheIndexManager",()=>sj,"Query",()=>pn,"QueryCompositeFilterConstraint",()=>qN,"QueryConstraint",()=>qJ,"QueryDocumentSnapshot",()=>rJ,"QueryEndAtConstraint",()=>qY,"QueryFieldFilterConstraint",()=>qL,"QueryLimitConstraint",()=>qS,"QueryOrderByConstraint",()=>qQ,"QuerySnapshot",()=>rK,"QueryStartAtConstraint",()=>qV,"SnapshotMetadata",()=>rG,"Timestamp",()=>aJ,"Transaction",()=>rU,"VectorValue",()=>pW,"WriteBatch",()=>rR,"_AutoId",()=>ai,"_ByteString",()=>cQ,"_DatabaseId",()=>c5,"_DocumentKey",()=>av,"_EmptyAppCheckTokenProvider",()=>af,"_EmptyAuthCredentialsProvider",()=>$,"_FieldPath",()=>au,"_TestingHooks",()=>sq,"_cast",()=>aD,"_debugAssert",()=>E,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>qy,"_internalQueryToProtoQueryTarget",()=>qx,"_isBase64Available",()=>cP,"_logWarn",()=>z,"_validateIsNotUsedTogether",()=>ax,"addDoc",()=>r5,"aggregateFieldEqual",()=>rh,"aggregateQuerySnapshotEqual",()=>ri,"and",()=>qP,"arrayRemove",()=>qu,"arrayUnion",()=>qt,"average",()=>rf,"clearIndexedDbPersistence",()=>pJ,"collection",()=>pq,"collectionGroup",()=>pr,"connectFirestoreEmulator",()=>pm,"count",()=>rg,"deleteAllPersistentCacheIndexes",()=>sn,"deleteDoc",()=>r4,"deleteField",()=>qr,"disableNetwork",()=>pM,"disablePersistentCacheIndexAutoCreation",()=>sm,"doc",()=>ps,"documentId",()=>pT,"documentSnapshotFromJSON",()=>rI,"enableIndexedDbPersistence",()=>pG,"enableMultiTabIndexedDbPersistence",()=>pH,"enableNetwork",()=>pL,"enablePersistentCacheIndexAutoCreation",()=>sl,"endAt",()=>q$,"endBefore",()=>qZ,"ensureFirestoreConfigured",()=>pD,"executeWrite",()=>r9,"getAggregateFromServer",()=>rk,"getCountFromServer",()=>rj,"getDoc",()=>rY,"getDocFromCache",()=>rZ,"getDocFromServer",()=>r$,"getDocs",()=>r_,"getDocsFromCache",()=>r0,"getDocsFromServer",()=>r1,"getFirestore",()=>pC,"getPersistentCacheIndexManager",()=>sk,"increment",()=>qv,"initializeFirestore",()=>pB,"limit",()=>qT,"limitToLast",()=>qU,"loadBundle",()=>pO,"memoryEagerGarbageCollector",()=>rq,"memoryLocalCache",()=>rs,"memoryLruGarbageCollector",()=>rr,"namedQuery",()=>pP,"onSnapshot",()=>r6,"onSnapshotResume",()=>r7,"onSnapshotsInSync",()=>r8,"or",()=>qO,"orderBy",()=>qR,"persistentLocalCache",()=>rt,"persistentMultipleTabManager",()=>rx,"persistentSingleTabManager",()=>rw,"query",()=>qK,"queryEqual",()=>pu,"querySnapshotFromJSON",()=>rL,"refEqual",()=>pt,"runTransaction",()=>rV,"serverTimestamp",()=>qs,"setDoc",()=>r2,"setIndexConfiguration",()=>sf,"setLogLevel",()=>w,"snapshotEqual",()=>rO,"startAfter",()=>qX,"startAt",()=>qW,"sum",()=>re,"terminate",()=>pN,"updateDoc",()=>r3,"vector",()=>qw,"waitForPendingWrites",()=>pK,"where",()=>qM,"writeBatch",()=>se],60574)}];

//# sourceMappingURL=node_modules_91b7e15d._.js.map