{"version":3,"sources":["../../../../src/components/attendance/attendance-manager.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { collection, query, where, getDocs, doc, getDoc, documentId } from \"firebase/firestore\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { DataTable } from \"@/components/ui/data-table\";\r\nimport { Loader2, Check, X, Save, Search, Printer } from \"lucide-react\";\r\nimport { toast } from \"@/lib/toast-store\";\r\nimport { useMasterData } from \"@/context/MasterDataContext\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { BarChart3, User, CalendarDays, FileText } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport default function AttendanceManager({\r\n    classId,\r\n    sectionId,\r\n    defaultDate\r\n}: {\r\n    classId: string;\r\n    sectionId: string;\r\n    defaultDate?: string;\r\n}) {\r\n    const { user } = useAuth();\r\n    const { classes, branding } = useMasterData();\r\n    const [students, setStudents] = useState<any[]>([]);\r\n    const [attendance, setAttendance] = useState<Record<string, 'P' | 'A'>>({});\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [alreadyMarked, setAlreadyMarked] = useState(false);\r\n    const [isModified, setIsModified] = useState(false);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [viewStats, setViewStats] = useState(false);\r\n    const [statsData, setStatsData] = useState<any[]>([]);\r\n    const [statsMonth, setStatsMonth] = useState<string>(\"ALL\");\r\n\r\n    const date = defaultDate || new Date().toISOString().split('T')[0];\r\n\r\n    useEffect(() => {\r\n        if (classId && sectionId) {\r\n            if (viewStats) {\r\n                fetchStats();\r\n            } else {\r\n                fetchData();\r\n            }\r\n        }\r\n    }, [classId, sectionId, date, viewStats, statsMonth]);\r\n\r\n    const fetchStats = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // Re-fetch students\r\n            const qS = query(\r\n                collection(db, \"students\"),\r\n                where(\"classId\", \"==\", classId),\r\n                where(\"sectionId\", \"==\", sectionId)\r\n            );\r\n            const sSnap = await getDocs(qS);\r\n            const sList = sSnap.docs.map(doc => ({\r\n                id: doc.id,\r\n                studentName: doc.data().studentName, // Changed from 'name' to 'studentName' to match existing data structure\r\n                rollNumber: doc.data().rollNumber,\r\n                schoolId: doc.data().schoolId // Added schoolId for display\r\n            })).sort((a, b) => (a.rollNumber || 0) - (b.rollNumber || 0)); // Changed sort to number\r\n\r\n            // Fetch Attendance in range\r\n            const currentYear = new Date().getFullYear();\r\n            let startKey, endKey;\r\n\r\n            if (statsMonth === \"ALL\") {\r\n                startKey = `${currentYear}-01-01_${classId}_${sectionId}`;\r\n                endKey = `${currentYear}-12-31_${classId}_${sectionId}`;\r\n            } else {\r\n                // Assuming attendance doc IDs are like YYYY-MM-DD_classId_sectionId\r\n                // To query by month, we need to construct the start and end of the month for the document ID.\r\n                // Firestore queries on documentId() are lexicographical.\r\n                // So, for a month, we need to ensure the date part is within the month.\r\n                // The structure is `date_classId_sectionId`.\r\n                // For example, `2023-01-01_class1_sectionA` to `2023-01-31_class1_sectionA`\r\n                startKey = `${currentYear}-${statsMonth}-01_${classId}_${sectionId}`;\r\n                endKey = `${currentYear}-${statsMonth}-31_${classId}_${sectionId}`; // This assumes all months have 31 days, which is fine for lexicographical comparison as it will stop at the actual end of the month.\r\n            }\r\n\r\n            const q = query(\r\n                collection(db, \"attendance\"),\r\n                where(documentId(), \">=\", startKey),\r\n                where(documentId(), \"<=\", endKey)\r\n            );\r\n            const snap = await getDocs(q);\r\n            const studentStats: Record<string, { total: number, present: number }> = {};\r\n\r\n            snap.docs.forEach((doc) => {\r\n                const data = doc.data();\r\n                // Ensure the document belongs to the correct class and section, as documentId() query is broad.\r\n                // The documentId() filter is on the full ID, so it should already be specific enough.\r\n                // However, if the ID structure is different, this check might be needed:\r\n                // const [docDate, docClassId, docSectionId] = doc.id.split('_');\r\n                // if (docClassId !== classId || docSectionId !== sectionId) return;\r\n\r\n                if (data.records) {\r\n                    Object.entries(data.records).forEach(([sid, status]: [string, any]) => {\r\n                        if (!studentStats[sid]) studentStats[sid] = { total: 0, present: 0 };\r\n                        if (status === 'P' || status === 'A') {\r\n                            studentStats[sid].total++;\r\n                            if (status === 'P') studentStats[sid].present++;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            const data = sList.map(s => {\r\n                const st = studentStats[s.id] || { total: 0, present: 0 };\r\n                return {\r\n                    ...s,\r\n                    totalDays: st.total,\r\n                    presentDays: st.present,\r\n                    percentage: st.total > 0 ? ((st.present / st.total) * 100).toFixed(1) : \"0.0\"\r\n                };\r\n            });\r\n            setStatsData(data);\r\n            setStudents(sList);\r\n        } catch (error: any) {\r\n            console.error(\"Stats error\", error);\r\n            toast({ title: \"Error\", description: \"Failed to load stats\", type: \"error\" });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handlePrint = () => {\r\n        const classObj = classes.find((c: any) => c.id === classId);\r\n        const period = statsMonth === \"ALL\" ? `Annual Report ${new Date().getFullYear()}` : `Monthly Report - ${new Date(2000, Number(statsMonth) - 1).toLocaleString('default', { month: 'long' })} ${new Date().getFullYear()}`;\r\n\r\n        const html = `\r\n            <html>\r\n            <head>\r\n                <title>Student Attendance Report - ${classObj?.name} - ${period}</title>\r\n                <style>\r\n                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }\r\n                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }\r\n                    .logo { height: 80px; width: auto; object-fit: contain; }\r\n                    .header-text { text-align: left; }\r\n                    h1 { margin: 0; font-size: 28px; }\r\n                    .details { font-size: 14px; color: #666; margin-top: 2px; }\r\n                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }\r\n                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\r\n                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }\r\n                    .text-center { text-align: center; }\r\n                    .font-bold { font-weight: bold; }\r\n                    .percentage { font-weight: bold; }\r\n                    .low { color: #dc3545; }\r\n                    .good { color: #28a745; }\r\n                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                <div class=\"header\">\r\n                    ${branding?.schoolLogo ? `<img src=\"${branding.schoolLogo}\" class=\"logo\" />` : ''}\r\n                    <div class=\"header-text\">\r\n                        <h1 style=\"margin: 0;\">${branding?.schoolName || 'Attendance Report'}</h1>\r\n                        <div class=\"details\" style=\"font-weight: bold; color: #333;\">Student Attendance Report</div>\r\n                        <div class=\"details\">Class: ${classObj?.name} (${sectionId}) - ${period}</div>\r\n                    </div>\r\n                </div>\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th style=\"width: 40px;\">Roll</th>\r\n                            <th>Student Name</th>\r\n                            <th class=\"text-center\">ID</th>\r\n                            <th class=\"text-center\">Total Days</th>\r\n                            <th class=\"text-center\">Present</th>\r\n                            <th class=\"text-center\">Absents</th>\r\n                            <th class=\"text-center\">Attendance %</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${statsData.map((s, idx) => `\r\n                            <tr>\r\n                                <td>${s.rollNumber || idx + 1}</td>\r\n                                <td class=\"font-bold\">${s.studentName}</td>\r\n                                <td class=\"text-center\">${s.schoolId}</td>\r\n                                <td class=\"text-center\">${s.totalDays}</td>\r\n                                <td class=\"text-center\" style=\"color: #28a745; font-weight: bold;\">${s.presentDays}</td>\r\n                                <td class=\"text-center\">${s.totalDays - s.presentDays}</td>\r\n                                <td class=\"text-center percentage ${Number(s.percentage) < 75 ? 'low' : 'good'}\">${s.percentage}%</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                </table>\r\n                <div class=\"footer\">\r\n                    <div>Generated on: ${new Date().toLocaleString()}</div>\r\n                    <div>School Management System</div>\r\n                </div>\r\n                <script>\r\n                    window.onload = () => {\r\n                        window.print();\r\n                        window.onafterprint = () => window.close();\r\n                    };\r\n                </script>\r\n            </body>\r\n            </html>\r\n        `;\r\n\r\n        const win = window.open('', '_blank');\r\n        win?.document.write(html);\r\n        win?.document.close();\r\n    };\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // 1. Fetch Students\r\n            const sQuery = query(\r\n                collection(db, \"students\"),\r\n                where(\"classId\", \"==\", classId),\r\n                where(\"sectionId\", \"==\", sectionId),\r\n                where(\"status\", \"==\", \"ACTIVE\")\r\n            );\r\n            const sSnap = await getDocs(sQuery);\r\n            const sList = sSnap.docs.map(d => ({ id: d.id, ...d.data() } as any))\r\n                .sort((a, b) => (a.rollNumber || 0) - (b.rollNumber || 0));\r\n            setStudents(sList);\r\n\r\n            // 2. Fetch Approved Leaves to auto-mark Absent\r\n            const lQuery = query(\r\n                collection(db, \"student_leaves\"),\r\n                where(\"classId\", \"==\", classId),\r\n                where(\"status\", \"==\", \"APPROVED\")\r\n            );\r\n            const lSnap = await getDocs(lQuery);\r\n            const absentIds = new Set<string>();\r\n            lSnap.forEach(ld => {\r\n                const l = ld.data();\r\n                // Check if current date falls within leave range\r\n                if (l.fromDate <= date && l.toDate >= date) {\r\n                    // Check section match if applicable (some leaves might not have sectionId)\r\n                    if (!l.sectionId || l.sectionId === sectionId) {\r\n                        absentIds.add(l.studentId);\r\n                    }\r\n                }\r\n            });\r\n\r\n            // 3. Fetch Existing Attendance\r\n            const attId = `${date}_${classId}_${sectionId}`;\r\n            const attSnap = await getDoc(doc(db, \"attendance\", attId));\r\n\r\n            if (attSnap.exists()) {\r\n                setAlreadyMarked(true);\r\n                setAttendance(attSnap.data().records || {});\r\n            } else {\r\n                setAlreadyMarked(false);\r\n                const initial: Record<string, 'P' | 'A'> = {};\r\n                sList.forEach((s: any) => {\r\n                    // s.id is usually the School ID (SHS...). Check against approved leaves.\r\n                    const isOnLeave = absentIds.has(s.id) || (s.schoolId && absentIds.has(s.schoolId));\r\n                    initial[s.id] = isOnLeave ? 'A' : 'P';\r\n                });\r\n                setAttendance(initial);\r\n            }\r\n        } catch (e: any) {\r\n            console.error(e);\r\n            toast({ title: \"Error\", description: \"Failed to fetch data.\", type: \"error\" });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const [touched, setTouched] = useState<Set<string>>(new Set());\r\n\r\n    const toggleStatus = (studentId: string) => {\r\n        setAttendance(prev => ({\r\n            ...prev,\r\n            [studentId]: prev[studentId] === 'P' ? 'A' : 'P'\r\n        }));\r\n        setTouched(prev => {\r\n            const next = new Set(prev);\r\n            next.add(studentId);\r\n            return next;\r\n        });\r\n        setIsModified(true); // Track local modifications for UI feedback\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        setSubmitting(true);\r\n        try {\r\n            const res = await fetch(\"/api/attendance/mark\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    classId,\r\n                    sectionId,\r\n                    date,\r\n                    records: attendance,\r\n                    markedBy: user?.uid,\r\n                    markedByName: user?.displayName || \"Admin\",\r\n                    isModification: alreadyMarked,\r\n                    touchedIds: Array.from(touched) // Send explicit list of modified students\r\n                })\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!data.success) throw new Error(data.error);\r\n\r\n            toast({\r\n                title: alreadyMarked ? \"Attendance Updated\" : \"Attendance Submitted\",\r\n                description: `Updated ${data.changesCount || 0}. Sent ${data.notifCount || 0} notifications.${data.skippedCount ? ` (${data.skippedCount} users have no account)` : ''}`,\r\n                type: \"success\"\r\n            });\r\n\r\n            setAlreadyMarked(true);\r\n            setIsModified(false);\r\n            setTouched(new Set());\r\n        } catch (e: any) {\r\n            console.error(e);\r\n            toast({ title: \"Failed\", description: e.message, type: \"error\" });\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    // SEARCH FILTER\r\n    const filteredStudents = students.filter(s =>\r\n        s.studentName.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (s.schoolId && s.schoolId.toLowerCase().includes(searchQuery.toLowerCase())) ||\r\n        (s.rollNumber && String(s.rollNumber).includes(searchQuery))\r\n    );\r\n\r\n    if (loading) return <div className=\"p-10 flex justify-center\"><Loader2 className=\"animate-spin\" /></div>;\r\n\r\n    const stats = {\r\n        total: students.length,\r\n        present: Object.values(attendance).filter(v => v === 'P').length,\r\n        absent: Object.values(attendance).filter(v => v === 'A').length\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Stats */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <Card className=\"bg-black/20 border-white/10 overflow-hidden\">\r\n                    <div className=\"p-4 flex items-center justify-between\">\r\n                        <div>\r\n                            <div className=\"text-xs text-muted-foreground uppercase\">Total</div>\r\n                            <div className=\"text-2xl font-bold\">{stats.total}</div>\r\n                        </div>\r\n                        <div className=\"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500\">\r\n                            <Check className=\"w-5 h-5\" />\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n                <Card className=\"bg-black/20 border-white/10 overflow-hidden\">\r\n                    <div className=\"p-4 flex items-center justify-between border-l-4 border-emerald-500\">\r\n                        <div>\r\n                            <div className=\"text-xs text-muted-foreground uppercase\">Present</div>\r\n                            <div className=\"text-2xl font-bold text-emerald-500\">{stats.present}</div>\r\n                        </div>\r\n                        <div className=\"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500\">\r\n                            <Check className=\"w-5 h-5\" />\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n                <Card className=\"bg-black/20 border-white/10 overflow-hidden\">\r\n                    <div className=\"p-4 flex items-center justify-between border-l-4 border-red-500\">\r\n                        <div>\r\n                            <div className=\"text-xs text-muted-foreground uppercase\">Absent</div>\r\n                            <div className=\"text-2xl font-bold text-red-500\">{stats.absent}</div>\r\n                        </div>\r\n                        <div className=\"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500\">\r\n                            <X className=\"w-5 h-5\" />\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* List */}\r\n            <Card className=\"bg-black/20 border-white/10\">\r\n                <div className=\"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center\">\r\n                    <div className=\"flex bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => setViewStats(false)}\r\n                            className={!viewStats ? \"bg-emerald-500/20 text-emerald-500\" : \"text-muted-foreground hover:text-white\"}\r\n                        >\r\n                            Daily View\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => setViewStats(true)}\r\n                            className={viewStats ? \"bg-blue-500/20 text-blue-500\" : \"text-muted-foreground hover:text-white\"}\r\n                        >\r\n                            Overall Stats\r\n                        </Button>\r\n\r\n                        {viewStats && (\r\n                            <>\r\n                                <Select value={statsMonth} onValueChange={setStatsMonth}>\r\n                                    <SelectTrigger className=\"w-[140px] h-8 bg-transparent border-white/10 text-xs\">\r\n                                        <SelectValue placeholder=\"Period\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent className=\"bg-slate-900 border-white/10\">\r\n                                        <SelectItem value=\"ALL\">Full Year {new Date().getFullYear()}</SelectItem>\r\n                                        <SelectItem value=\"01\">January</SelectItem>\r\n                                        <SelectItem value=\"02\">February</SelectItem>\r\n                                        <SelectItem value=\"03\">March</SelectItem>\r\n                                        <SelectItem value=\"04\">April</SelectItem>\r\n                                        <SelectItem value=\"05\">May</SelectItem>\r\n                                        <SelectItem value=\"06\">June</SelectItem>\r\n                                        <SelectItem value=\"07\">July</SelectItem>\r\n                                        <SelectItem value=\"08\">August</SelectItem>\r\n                                        <SelectItem value=\"09\">September</SelectItem>\r\n                                        <SelectItem value=\"10\">October</SelectItem>\r\n                                        <SelectItem value=\"11\">November</SelectItem>\r\n                                        <SelectItem value=\"12\">December</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n\r\n                                <Button\r\n                                    size=\"sm\"\r\n                                    variant=\"outline\"\r\n                                    className=\"h-8 border-white/10 hover:bg-white/5 gap-2 px-3\"\r\n                                    onClick={handlePrint}\r\n                                >\r\n                                    <Printer className=\"w-3 h-3\" /> Print Report\r\n                                </Button>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {!viewStats && (\r\n                        <div className=\"relative flex-1 w-full md:max-w-xs\">\r\n                            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                placeholder=\"Search students...\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                className=\"pl-8 bg-black/40 border-white/10 w-full\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <CardContent className=\"p-0\">\r\n                    <DataTable\r\n                        data={viewStats ? statsData : filteredStudents}\r\n                        isLoading={loading}\r\n                        columns={viewStats ? [\r\n                            {\r\n                                key: \"rollNumber\",\r\n                                header: \"Roll\",\r\n                                render: (s: any, idx?: number) => (\r\n                                    <span className=\"font-mono text-sm\">{s.rollNumber || (idx ?? 0) + 1}</span>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"studentName\",\r\n                                header: \"Student Name\",\r\n                                render: (s: any) => (\r\n                                    <div>\r\n                                        <div className=\"font-medium text-white\">{s.studentName}</div>\r\n                                        <div className=\"text-[10px] text-white/40 uppercase\">{s.schoolId}</div>\r\n                                    </div>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"totalDays\",\r\n                                header: \"Total\",\r\n                                cellClassName: \"text-center\",\r\n                                render: (s: any) => <span className=\"font-mono\">{s.totalDays}</span>\r\n                            },\r\n                            {\r\n                                key: \"presentDays\",\r\n                                header: \"Present\",\r\n                                cellClassName: \"text-center\",\r\n                                render: (s: any) => <span className=\"font-bold text-emerald-400\">{s.presentDays}</span>\r\n                            },\r\n                            {\r\n                                key: \"percentage\",\r\n                                header: \"Attendance %\",\r\n                                cellClassName: \"text-center\",\r\n                                render: (s: any) => (\r\n                                    <div className=\"flex flex-col items-center min-w-[80px]\">\r\n                                        <span className={`font-bold ${Number(s.percentage) < 75 ? \"text-red-400\" : \"text-emerald-400\"}`}>\r\n                                            {s.percentage}%\r\n                                        </span>\r\n                                        <div className=\"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]\">\r\n                                            <div\r\n                                                className={`h-full ${Number(s.percentage) < 75 ? \"bg-red-500\" : \"bg-emerald-500\"}`}\r\n                                                style={{ width: `${s.percentage}%` }}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"statsStatus\",\r\n                                header: \"Status\",\r\n                                cellClassName: \"text-right\",\r\n                                render: (s: any) => (\r\n                                    <Badge variant=\"outline\" className={cn(\r\n                                        \"text-[8px] uppercase font-black tracking-tighter\",\r\n                                        Number(s.percentage) < 75 ? \"text-red-400 border-red-500/30\" : \"text-emerald-400 border-emerald-500/30\"\r\n                                    )}>\r\n                                        {Number(s.percentage) < 75 ? \"Low\" : \"Good\"}\r\n                                    </Badge>\r\n                                )\r\n                            }\r\n                        ] : [\r\n                            {\r\n                                key: \"rollNumber\",\r\n                                header: \"Roll\",\r\n                                render: (s: any, idx?: number) => (\r\n                                    <span className=\"font-mono text-sm\">{s.rollNumber || (idx ?? 0) + 1}</span>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"studentName\",\r\n                                header: \"Student Name\",\r\n                                render: (s: any) => (\r\n                                    <div>\r\n                                        <div className=\"font-medium text-white\">{s.studentName}</div>\r\n                                        <div className=\"text-[10px] text-white/40 uppercase\">{s.schoolId}</div>\r\n                                    </div>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"attendanceStatus\",\r\n                                header: \"Status\",\r\n                                cellClassName: \"text-center\",\r\n                                render: (s: any) => (\r\n                                    <Badge className={cn(\r\n                                        \"font-black uppercase tracking-tighter text-[9px]\",\r\n                                        attendance[s.id] === 'P' ? \"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20\" : \"bg-red-500/10 text-red-500 border border-red-500/20\"\r\n                                    )}>\r\n                                        {attendance[s.id] === 'P' ? \"Present\" : \"Absent\"}\r\n                                    </Badge>\r\n                                )\r\n                            },\r\n                            {\r\n                                key: \"action\",\r\n                                header: \"Action\",\r\n                                cellClassName: \"text-right\",\r\n                                render: (s: any) => (\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"ghost\"\r\n                                        className={cn(\r\n                                            \"h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg\",\r\n                                            attendance[s.id] === 'P'\r\n                                                ? \"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white\"\r\n                                                : \"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white\"\r\n                                        )}\r\n                                        onClick={() => toggleStatus(s.id)}\r\n                                    >\r\n                                        {attendance[s.id] === 'P' ? \"Mark Absent\" : \"Mark Present\"}\r\n                                    </Button>\r\n                                )\r\n                            }\r\n                        ]}\r\n                    />\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {!viewStats && (\r\n                <div className=\"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10\">\r\n                    <div className=\"text-sm text-muted-foreground\">\r\n                        {alreadyMarked\r\n                            ? (isModified ? \"You have unsaved changes.\" : `Attendance already marked by ${user?.uid === \"admin\" ? \"Admin\" : \"Teacher\"}`)\r\n                            : \"Ready to submit.\"\r\n                        }\r\n                    </div>\r\n                    <Button\r\n                        size=\"lg\"\r\n                        onClick={handleSubmit}\r\n                        disabled={submitting || (alreadyMarked && !isModified)}\r\n                        className=\"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]\"\r\n                    >\r\n                        {submitting ? <Loader2 className=\"w-5 h-5 animate-spin mr-2\" /> : <Save className=\"w-5 h-5 mr-2\" />}\r\n                        {alreadyMarked ? \"Update Attendance\" : \"Submit Attendance\"}\r\n                    </Button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}