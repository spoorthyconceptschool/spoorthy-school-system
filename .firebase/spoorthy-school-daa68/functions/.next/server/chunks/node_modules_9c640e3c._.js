module.exports=[37294,(e,t,r)=>{"use strict";var n,i,s;Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=r.Propagate=r.LogVerbosity=r.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(r.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(i||(r.LogVerbosity=i={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(s||(r.Propagate=s={})),r.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,r.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},91200,(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(r,"__esModule",{value:!0}),r.isTracerEnabled=r.trace=r.log=r.setLoggerVerbosity=r.setLogger=r.getLogger=void 0;let o=e.r(37294),l=e.r(5365),c=e.r(17887).version,u={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!=(i=null!=(n=process.env.GRPC_NODE_VERBOSITY)?n:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}r.getLogger=()=>u,r.setLogger=e=>{u=e},r.setLoggerVerbosity=e=>{h=e},r.log=(e,...t)=>{let r;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:r=u.debug;break;case o.LogVerbosity.INFO:r=u.info;break;case o.LogVerbosity.ERROR:r=u.error}r||(r=u.error),r&&r.bind(u)(...t)}};let d=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",f=new Set,p=new Set;for(let e of d.split(","))e.startsWith("-")?p.add(e.substring(1)):f.add(e);let m=f.has("all");function g(e,t,n){y(t)&&(0,r.log)(e,new Date().toISOString()+" | v"+c+" "+l.pid+" | "+t+" | "+n)}function y(e){return!p.has(e)&&(m||f.has(e))}r.trace=g,r.isTracerEnabled=y},40646,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getErrorCode=r.getErrorMessage=void 0,r.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},r.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},73155,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;let n=e.r(91200),i=e.r(37294),s=e.r(40646),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function c(e){return o.test(e)}function u(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(u(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!c(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new p;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{u(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(h(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}r.Metadata=p;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},31364,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CallCredentials=void 0;let n=e.r(73155);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{e?n(e):t?r(t):n(Error("Headers not set by metadata plugin"))})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}r.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},84049,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultRootsData=r.CIPHER_SUITES=void 0;let n=e.r(22734);r.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;r.getDefaultRootsData=function(){return i?(null===s&&(s=n.readFileSync(i)),s):null}},83106,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelCredentials=void 0;let n=e.r(55004),i=e.r(31364),s=e.r(84049);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new c((0,n.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new c(e,null!=t?t:{})}static createInsecure(){return new l}}r.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class c extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new u(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class u extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new u(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},24521,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.isLoadBalancerNameRegistered=r.createLoadBalancer=r.registerDefaultLoadBalancerType=r.registerLoadBalancerType=r.createChildChannelControlHelper=void 0,r.createChildChannelControlHelper=function(e,t){var r,n,i,s,a,o,l,c,u,h;return{createSubchannel:null!=(n=null==(r=t.createSubchannel)?void 0:r.bind(t))?n:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(c=null==(l=t.addChannelzChild)?void 0:l.bind(t))?c:e.addChannelzChild.bind(e),removeChannelzChild:null!=(h=null==(u=t.removeChannelzChild)?void 0:u.bind(t))?h:e.removeChannelzChild.bind(e)}};let n={},i=null;r.registerLoadBalancerType=function(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}},r.registerDefaultLoadBalancerType=function(e){i=e},r.createLoadBalancer=function(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null},r.isLoadBalancerNameRegistered=function(e){return e in n},r.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in n)return t;return t&&i?new n[i].LoadBalancingConfig:null},r.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}},59807,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractAndSelectServiceConfig=r.validateServiceConfig=r.validateRetryThrottling=void 0;let n=e.r(46786),i=e.r(37294),s=e.r(24521),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!=(t=n[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else r.retryPolicy=c(e.retryPolicy);else"hedgingPolicy"in e&&(r.hedgingPolicy=u(e.hedgingPolicy));return r}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(h(r));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=p(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}r.validateRetryThrottling=d,r.validateServiceConfig=f,r.extractAndSelectServiceConfig=function(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}},95653,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(r.ConnectivityState=n={}))},28835,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uriToString=r.splitHostPort=r.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;r.parseUri=function(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let i=/^\d+$/;r.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}},r.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},23359,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mapUriDefaultScheme=r.getDefaultAuthority=r.createResolver=r.registerDefaultScheme=r.registerResolver=void 0;let n=e.r(28835),i={},s=null;r.registerResolver=function(e,t){i[e]=t},r.registerDefaultScheme=function(e){s=e},r.createResolver=function(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)},r.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)},r.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,n.uriToString)(e)};else return null;return e}},87080,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.QueuePicker=r.UnavailablePicker=r.PickResultType=void 0;let i=e.r(73155),s=e.r(37294);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(r.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}r.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}r.QueuePicker=o},38644,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BackoffTimeout=void 0;let n=1e3,i=1.6,s=12e4,a=.2;function o(e,t){return Math.random()*(t-e)+e}class l{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=i,this.maxDelay=s,this.jitter=a,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(r=(t=this.timerId).unref)||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+o(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}r.BackoffTimeout=l},6279,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChildLoadBalancerHandler=void 0;let n=e.r(24521),i=e.r(95653),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(r=this.parent.currentChild)||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}r.ChildLoadBalancerHandler=a},61693,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingLoadBalancer=void 0;let n=e.r(24521),i=e.r(59807),s=e.r(95653),a=e.r(23359),o=e.r(87080),l=e.r(38644),c=e.r(37294),u=e.r(73155),h=e.r(91200),d=e.r(37294),f=e.r(28835),p=e.r(6279),m="resolving_load_balancer";function g(e){h.trace(d.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function _(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function b(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(n=s[0])?n:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let r=_(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:c.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:c.Status.OK,dynamicFilterFactories:[]}}}class S{constructor(e,t,r,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],h=(0,n.getFirstUsableConfig)(l,!0);if(null===h)return void this.handleResolutionFailure({code:c.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new u.Metadata});this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:b(d))},onError:e=>{this.handleResolutionFailure(e)}},r);const f={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}r.ResolvingLoadBalancer=S},87147,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.channelOptionsEqual=r.recognizedOptions=void 0,r.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},r.channelOptionsEqual=function(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}},46801,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.stringToSubchannelAddress=r.subchannelAddressToString=r.subchannelAddressEqual=r.isTcpSubchannelAddress=void 0;let n=e.r(4446);function i(e){return"port"in e}r.isTcpSubchannelAddress=i,r.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},r.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;r.stringToSubchannelAddress=function(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},81800,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addAdminServicesToServer=r.registerAdminService=void 0;let n=[];r.registerAdminService=function(e,t){n.push({getServiceDefinition:e,getHandlers:t})},r.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}},82169,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClientDuplexStreamImpl=r.ClientWritableStreamImpl=r.ClientReadableStreamImpl=r.ClientUnaryCallImpl=r.callErrorFromStatus=void 0;let n=e.r(27699),i=e.r(88947),s=e.r(37294);r.callErrorFromStatus=function(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})};class a extends n.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}r.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}r.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientWritableStreamImpl=l;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}r.ClientDuplexStreamImpl=c},2590,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InterceptingListenerImpl=r.isInterceptingListener=void 0,r.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}r.InterceptingListenerImpl=n},89452,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getInterceptingCall=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.InterceptorConfigurationError=void 0;let n=e.r(73155),i=e.r(2590),s=e.r(37294),a=e.r(40646);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}r.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}r.ListenerBuilder=l;class c{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}r.RequesterBuilder=c;let u=(e,t)=>{t(e)},h=(e,t)=>{t(e)},d=(e,t)=>{t(e)},f={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class p{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(r=t.start)?r:f.start,sendMessage:null!=(n=t.sendMessage)?n:f.sendMessage,halfClose:null!=(i=t.halfClose)?i:f.halfClose,cancel:null!=(s=t.cancel)?s:f.cancel}:this.requester=f}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let c={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,c,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(r=t.onReceiveMetadata)?r:u,onReceiveMessage:null!=(n=t.onReceiveMessage)?n:h,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:d};a=new i.InterceptingListenerImpl(e,c)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function m(e,t,r){var n,i;let s=null!=(n=r.deadline)?n:1/0,a=r.host,o=null!=(i=r.parent)?i:null,l=r.propagate_flags,c=r.credentials,u=e.createCall(t,s,a,o,l);return c&&u.setCredentials(c),u}r.InterceptingCall=p;class g{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null==(r=null==t?void 0:t.onReceiveMetadata)||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,r):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class y extends g{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,null),null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class v extends g{}function _(e,t,r){let n=m(e,r.path,t);return r.responseStream?new v(n,r):new y(n,r)}r.getInterceptingCall=function(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>_(n,e,t))(s)}},4681,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;let n=e.r(82169),i=e.r(75917),s=e.r(95653),a=e.r(37294),o=e.r(73155),l=e.r(89452),c=Symbol(),u=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[u]=null!=(n=r.interceptors)?n:[],delete r.interceptors,this[h]=null!=(s=r.interceptor_providers)?s:[],delete r.interceptor_providers,this[u].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[c]=r.channelOverride;else if(r.channelFactoryOverride){const n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[c]=n(e,t,r)}else this[c]=new i.ChannelImplementation(e,t,r)}close(){this[c].close()}getChannel(){return this[c]}waitForReady(e,t){let r=n=>{let i;if(n)return void t(Error("Failed to connect before the deadline"));try{i=this[c].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[c].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,f){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},_={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[c],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(_=this[d](_));let b=_.call,S={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(m=_.callOptions.interceptors)?m:[],callInterceptorProviders:null!=(g=_.callOptions.interceptor_providers)?g:[]},C=(0,l.getInterceptingCall)(S,_.methodDefinition,_.callOptions,_.channel);b.call=C;let w=null,T=!1,E=Error();return C.start(_.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==w&&C.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!T){if(T=!0,e.code===a.Status.OK)if(null===w){let t=p(E);_.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else _.callback(null,w);else{let t=p(E);_.callback((0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),C.sendMessage(i),C.halfClose(),b}makeClientStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[c],methodDefinition:y,callOptions:g.options,callback:g.callback};this[d]&&(v=this[d](v));let _=v.call,b={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},S=(0,l.getInterceptingCall)(b,v.methodDefinition,v.callOptions,v.channel);_.call=S;let C=null,w=!1,T=Error();return S.start(v.metadata,{onReceiveMetadata:e=>{_.emit("metadata",e)},onReceiveMessage(e){null!==C&&S.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),C=e},onReceiveStatus(e){if(!w){if(w=!0,e.code===a.Status.OK)if(null===C){let t=p(T);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,C);else{let t=p(T);v.callback((0,n.callErrorFromStatus)(e,t))}T=null,_.emit("status",e)}}}),_}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var f,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[c],methodDefinition:y,callOptions:g.options};this[d]&&(v=this[d](v));let _=v.call,b={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},S=(0,l.getInterceptingCall)(b,v.methodDefinition,v.callOptions,v.channel);_.call=S;let C=!1,w=Error();return S.start(v.metadata,{onReceiveMetadata(e){_.emit("metadata",e)},onReceiveMessage(e){_.push(e)},onReceiveStatus(e){if(!C){if(C=!0,_.push(null),e.code!==a.Status.OK){let t=p(w);_.emit("error",(0,n.callErrorFromStatus)(e,t))}w=null,_.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),_}makeBidiStreamRequest(e,t,r,i,s){var o,f;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[c],methodDefinition:g,callOptions:m.options};this[d]&&(y=this[d](y));let v=y.call,_={clientInterceptors:this[u],clientInterceptorProviders:this[h],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(f=y.callOptions.interceptor_providers)?f:[]},b=(0,l.getInterceptingCall)(_,y.methodDefinition,y.callOptions,y.channel);v.call=b;let S=!1,C=Error();return b.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!S){if(S=!0,v.push(null),e.code!==a.Status.OK){let t=p(C);v.emit("error",(0,n.callErrorFromStatus)(e,t))}C=null,v.emit("status",e)}}}),v}}r.Client=m},55779,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadPackageDefinition=r.makeClientConstructor=void 0;let n=e.r(4681),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,c=n.responseDeserialize,u=o(i[r],n.path,l,c);a.prototype[t]=u,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}r.makeClientConstructor=a,r.loadPackageDefinition=function(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],c=t;for(let e of i.slice(0,-1))c[e]||(c[e]={}),c=c[e];l(n)?c[o]=n:c[o]=a(n,o,{})}return t}},16702,(e,t,r)=>{var n=1/0,i="[object Symbol]",s=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,a=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,o="\\ud800-\\udfff",l="\\u0300-\\u036f\\ufe20-\\ufe23",c="\\u20d0-\\u20f0",u="\\u2700-\\u27bf",h="a-z\\xdf-\\xf6\\xf8-\\xff",d="A-Z\\xc0-\\xd6\\xd8-\\xde",f="\\ufe0e\\ufe0f",p="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",m="['â€™]",g="["+o+"]",y="["+p+"]",v="["+l+c+"]",_="\\d+",b="["+u+"]",S="["+h+"]",C="[^"+o+p+_+u+h+d+"]",w="\\ud83c[\\udffb-\\udfff]",T="[^"+o+"]",E="(?:\\ud83c[\\udde6-\\uddff]){2}",I="[\\ud800-\\udbff][\\udc00-\\udfff]",k="["+d+"]",R="\\u200d",x="(?:"+S+"|"+C+")",O="(?:"+k+"|"+C+")",A="(?:"+m+"(?:d|ll|m|re|s|t|ve))?",D="(?:"+m+"(?:D|LL|M|RE|S|T|VE))?",N="(?:"+v+"|"+w+")?",P="["+f+"]?",M="(?:"+R+"(?:"+[T,E,I].join("|")+")"+P+N+")*",L=P+N+M,F="(?:"+[b,E,I].join("|")+")"+L,B="(?:"+[T+v+"?",v,E,I,g].join("|")+")",U=RegExp(m,"g"),j=RegExp(v,"g"),q=RegExp(w+"(?="+w+")|"+B+L,"g"),V=RegExp([k+"?"+S+"+"+A+"(?="+[y,k,"$"].join("|")+")",O+"+"+D+"(?="+[y,k+x,"$"].join("|")+")",k+"?"+x+"+"+A,k+"+"+D,_,F].join("|"),"g"),z=RegExp("["+R+o+l+c+f+"]"),H=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,$={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"ss"},W=e.g&&e.g.Object===Object&&e.g,K="object"==typeof self&&self&&self.Object===Object&&self,G=W||K||Function("return this")();function Q(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function Y(e){return e.split("")}function J(e){return e.match(s)||[]}var X=function(e){return function(t){return null==e?void 0:e[t]}}($);function Z(e){return z.test(e)}function ee(e){return H.test(e)}function et(e){return Z(e)?er(e):Y(e)}function er(e){return e.match(q)||[]}function en(e){return e.match(V)||[]}var ei=Object.prototype.toString,es=G.Symbol,ea=es?es.prototype:void 0,eo=ea?ea.toString:void 0;function el(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function ec(e){if("string"==typeof e)return e;if(ef(e))return eo?eo.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}function eu(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:el(e,t,r)}function eh(e){return function(t){var r=Z(t=ep(t))?et(t):void 0,n=r?r[0]:t.charAt(0),i=r?eu(r,1).join(""):t.slice(1);return n[e]()+i}}function ed(e){return!!e&&"object"==typeof e}function ef(e){return"symbol"==typeof e||ed(e)&&ei.call(e)==i}function ep(e){return null==e?"":ec(e)}var em=function(e){return function(t){return Q(e_(ey(t).replace(U,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?eg(t):t)});function eg(e){return ev(ep(e).toLowerCase())}function ey(e){return(e=ep(e))&&e.replace(a,X).replace(j,"")}var ev=eh("toUpperCase");function e_(e,t,r){return(e=ep(e),void 0===(t=r?void 0:t))?ee(e)?en(e):J(e):e.match(t)||[]}t.exports=em},86590,(e,t,r)=>{"use strict";t.exports=function e(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}},67789,(e,t,r)=>{"use strict";var n=r;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=Array(64),s=Array(123),a=0;a<64;)s[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,s=null,a=[],o=0,l=0;t<r;){var c=e[t++];switch(l){case 0:a[o++]=i[c>>2],n=(3&c)<<4,l=1;break;case 1:a[o++]=i[n|c>>4],n=(15&c)<<2,l=2;break;case 2:a[o++]=i[n|c>>6],a[o++]=i[63&c],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=i[n],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var o="invalid encoding";n.decode=function(e,t,r){for(var n,i=r,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if(void 0===(c=s[c]))throw Error(o);switch(a){case 0:n=c,a=1;break;case 1:t[r++]=n<<2|(48&c)>>4,n=c,a=2;break;case 2:t[r++]=(15&n)<<4|(60&c)>>2,n=c,a=3;break;case 3:t[r++]=(3&n)<<6|c,a=0}}if(1===a)throw Error(o);return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},89767,(e,t,r)=>{"use strict";function n(){this._listeners={}}t.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},23758,(e,t,r)=>{"use strict";function n(e){return"u">typeof Float32Array?!function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():!function(){function t(e,t,r,n){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,r,n);else if(isNaN(t))e(0x7fc00000,r,n);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,s),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,o)}(),"u">typeof Float64Array?!function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():!function(){function t(e,t,r,n,i,s){var a,o=+(n<0);if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:0x80000000,i,s+r);else if(isNaN(n))e(0,i,s+t),e(0x7ff80000,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function r(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,c=0x100000000*(1048575&a)+s;return 2047===l?c?NaN:1/0*o:0===l?5e-324*o*c:o*Math.pow(2,l-1075)*(c+0x10000000000000)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,s,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,o,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function s(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=n(n)},56492,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},32518,(e,t,r)=>{"use strict";var n=r;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},97554,(e,t,r)=>{"use strict";t.exports=function e(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}},77400,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(16181);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e))if(!n.Long)return i.fromNumber(parseInt(e,10));else e=n.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+0x100000000*r)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},16181,(e,t,r)=>{"use strict";var n=r;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=e.r(86590),n.base64=e.r(67789),n.EventEmitter=e.r(89767),n.float=e.r(23758),n.inquire=e.r(56492),n.utf8=e.r(32518),n.pool=e.r(97554),n.LongBits=e.r(77400),n.isNode=!!(e.g&&e.g.process&&e.g.process.versions&&e.g.process.versions.node),n.global=n.isNode&&e.g||"u">typeof self&&self||e.e,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"u"<typeof Uint8Array?e:new Uint8Array(e)},n.Array="u">typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},70798,(e,t,r)=>{"use strict";t.exports={}},22805,(e,t,r)=>{"use strict";function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=s();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),c=0;c<a.length;)o[c]=a[c],l[c]=e[a[c++]];return o[c]=t,Function.apply(null,o).apply(null,l)}return Function(t)()}for(var u=Array(arguments.length-1),h=0;h<u.length;)u[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=u[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),h!==u.length)throw Error("parameter count mismatch");return r.push(e),i}function s(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}t.exports=n,n.verbose=!1},41702,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(86590),i=e.r(56492)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"u">typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"u">typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},21491,(e,t,r)=>{"use strict";var n=r,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},s=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return n+t.join("/")};n.resolve=function(e,t,r){return(r||(t=s(t)),i(t))?t:(r||(e=s(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?s(e+"/"+t):t)}},71252,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(73057);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=e.r(99726),l=e.r(37625),c=e.r(68144);function u(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function d(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=u,h.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:h.fromJSON)(a[l],r));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof c||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof h&&e instanceof h&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof h))throw Error("path conflicts with non-namespace objects")}else r.add(r=new h(n))}return t&&r.addJSON(t),r},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},h.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},h.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},h.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof h&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof h&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},h.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,r){n=e,i=t,s=r}},21773,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(99726);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=e.r(6591),s=e.r(37625);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},74944,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(73057);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=e.r(37625);function s(e,t,r,s,a,o,l,c,u){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=c,this.parsedOptions=u}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},77685,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(16181);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r)return void o.end(!0);if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},77878,(e,t,r)=>{"use strict";r.Service=e.r(77685)},20004,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(71252);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=e.r(74944),s=e.r(37625),a=e.r(77878);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},77682,(e,t,r)=>{"use strict";t.exports=i;var n=e.r(16181);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},37367,(e,t,r)=>{"use strict";t.exports=l;var n,i=e.r(16181),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c="u">typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},u=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=u(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++])return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=u(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},92458,(e,t,r)=>{"use strict";t.exports=h;var n,i=e.r(16181),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function f(e,t,r){t[r]=255&e}function p(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,+!!e)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=h.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},83476,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(52100),i=e.r(6591),s=e.r(37625);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,c="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",c)("%s={}",c)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[o.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',c):t("%s[k]=value",c)):o.repeated?(t("if(!(%s&&%s.length))",c,c)("%s=[]",c),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",c,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",c,r):t("%s.push(r.%s())",c,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",c,r):t("%s=r.%s()",c,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var u=e._fieldsArray[r];u.required&&t("if(!m.hasOwnProperty(%j))",u.name)("throw util.ProtocolError(%j,{instance:m})",a(u))}return t("return m")}},69048,(e,t,r)=>{"use strict";t.exports=l;var n=e.r(52100),i=e.r(37625);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var c=e._fieldsArray[l].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",s(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),o(t,c,"k[i]"),a(t,c,l,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",s(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(t,c,l,u+"[i]")("}");else{if(c.partOf){var h=i.safeProp(c.partOf.name);1===n[c.partOf.name]&&t("if(p%s===1)",h)("return%j",c.partOf.name+": multiple values"),n[c.partOf.name]=1,t("p%s=1",h)}a(t,c,l,u)}c.optional&&t("}")}return t("return null")}},79711,(e,t,r)=>{"use strict";var n=r,i=e.r(52100),s=e.r(37625);function a(e,t,r,n){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,c)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],c=0;c<t.length;++c)t[c].partOf||(t[c].resolve().repeated?n:t[c].map?a:l).push(t[c]);if(n.length){for(r("if(o.arrays||o.defaults){"),c=0;c<n.length;++c)r("d%s=[]",s.safeProp(n[c].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),c=0;c<a.length;++c)r("d%s={}",s.safeProp(a[c].name));r("}")}if(l.length){for(r("if(o.defaults){"),c=0;c<l.length;++c){var u=l[c],h=s.safeProp(u.name);if(u.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",h,u.resolvedType.valuesById[u.typeDefault],u.typeDefault);else if(u.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",u.typeDefault.low,u.typeDefault.high,u.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,u.typeDefault.toString(),u.typeDefault.toNumber());else if(u.bytes){var d="["+Array.prototype.slice.call(u.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,u.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,u.typeDefault)}r("}")}var f=!1;for(c=0;c<t.length;++c){var u=t[c],p=e._fieldsArray.indexOf(u),h=s.safeProp(u.name);u.map?(f||(f=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(r,u,p,h+"[ks2[j]]")("}")):u.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(r,u,p,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,u.name),o(r,u,p,h),u.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(u.partOf.name),u.name)),r("}")}return r("return d")}},13199,(e,t,r)=>{"use strict";var n=r,i=e.r(77682);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},10936,(e,t,r)=>{"use strict";t.exports=v;var n=e.r(71252);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=e.r(52100),s=e.r(68144),a=e.r(99726),o=e.r(21773),l=e.r(20004),c=e.r(77682),u=e.r(37367),h=e.r(92458),d=e.r(37625),f=e.r(19622),p=e.r(83476),m=e.r(69048),g=e.r(79711),y=e.r(13199);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof c||((e.prototype=new c).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,c,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var c=Object.keys(t.fields),u=0;u<c.length;++u)r.add((void 0!==t.fields[c[u]].keyType?o.fromJSON:a.fromJSON)(c[u],t.fields[c[u]]));if(t.oneofs)for(c=Object.keys(t.oneofs),u=0;u<c.length;++u)r.add(s.fromJSON(c[u],t.oneofs[c[u]]));if(t.nested)for(c=Object.keys(t.nested),u=0;u<c.length;++u){var h=t.nested[c[u]];r.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:n.fromJSON)(c[u],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),_(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),_(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),_(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),_(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:u,types:t,util:d}),this.verify=m(this)({types:t,util:d}),this.fromObject=g.fromObject(this)({types:t,util:d}),this.toObject=g.toObject(this)({types:t,util:d});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof u||(e=u.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},62192,(e,t,r)=>{"use strict";t.exports=h;var n,i,s,a=e.r(71252);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=e.r(99726),l=e.r(52100),c=e.r(68144),u=e.r(37625);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=u.path.resolve,h.prototype.fetch=u.fetch,h.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return u.asPromise(e,a,t,r);var o=n===d;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function c(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function h(e,t){try{if(u.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),u.isString(t)){i.filename=e;var n,s=i(t,a,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(n=c(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(n);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(n=c(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=c(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])})));if(o){var r;try{r=u.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,r)}else++p,a.fetch(e,function(r,i){if(--p,n){if(r)return void(t?p||l(null,a):l(r));h(e,i)}})}}var p=0;u.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&f(m);return o?a.resolveAll():p||l(null,a),a},h.prototype.loadSync=function(e,t){if(!u.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof c)){if(e instanceof n)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);f.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);f.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},h._configure=function(e,t,r){n=e,i=t,s=r}},37625,(e,t,r)=>{"use strict";var n,i,s=t.exports=e.r(16181),a=e.r(70798);s.codegen=e.r(22805),s.fetch=e.r(41702),s.path=e.r(21491),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var c=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(c,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(t,r){if(t.$type)return r&&t.$type.name!==r&&(s.decorateRoot.remove(t.$type),t.$type.name=r,s.decorateRoot.add(t.$type)),t.$type;n||(n=e.r(10936));var i=new n(r||t.name);return s.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i};var u=0;s.decorateEnum=function(t){if(t.$type)return t.$type;i||(i=e.r(52100));var r=new i("Enum"+u++,t);return s.decorateRoot.add(r),Object.defineProperty(t,"$type",{value:r,enumerable:!1}),r},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e.r(62192)))}})},6591,(e,t,r)=>{"use strict";var n=r,i=e.r(37625),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},99726,(e,t,r)=>{"use strict";t.exports=c;var n,i=e.r(73057);((c.prototype=Object.create(i.prototype)).constructor=c).className="Field";var s=e.r(52100),a=e.r(6591),o=e.r(37625),l=/^required|optional|repeated$/;function c(e,t,r,n,s,c,u){if(o.isObject(n)?(u=s,c=n,n=s=void 0):o.isObject(s)&&(u=c,c=s,s=void 0),i.call(this,e,c),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=u}c.fromJSON=function(e,t){var r=new c(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(c.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(c.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(c.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(c.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(c.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),c.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},c.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},c.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},c.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},c.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},c.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new c(s,e,t,r,{default:n}))}},c._configure=function(e){n=e}},68144,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(73057);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=e.r(99726),s=e.r(37625);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},73057,(e,t,r)=>{"use strict";t.exports=c,c.className="ReflectionObject";let n=e.r(68144);var i,s=e.r(37625),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function c(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(c.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),c.prototype.toJSON=function(){throw Error()},c.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},c.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},c.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},c.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},c.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},c.prototype._inferLegacyProtoFeatures=function(){return{}},c.prototype.getOption=function(e){if(this.options)return this.options[e]},c.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},c.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},c.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},c.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},c.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},c._configure=function(e){i=e}},52100,(e,t,r)=>{"use strict";t.exports=a;var n=e.r(73057);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=e.r(71252),s=e.r(37625);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},19622,(e,t,r)=>{"use strict";t.exports=o;var n=e.r(52100),i=e.r(6591),s=e.r(37625);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var c=l[t].resolve(),u=e._fieldsArray.indexOf(c),h=c.resolvedType instanceof n?"int32":c.type,d=i.basic[h];r="m"+s.safeProp(c.name),c.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,c.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(c.id<<3|2)>>>0,8|i.mapKey[c.keyType],c.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",u,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,r),o("}")("}")):c.repeated?(o("if(%s!=null&&%s.length){",r,r),c.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(c.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",h,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===d?a(o,c,u,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(c.id<<3|d)>>>0,h,r)),o("}")):(c.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,c.name),void 0===d?a(o,c,u,r):o("w.uint32(%i).%s(%s)",(c.id<<3|d)>>>0,h,r))}return o("return w")}},75084,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(92458);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(16181);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},68308,(e,t,r)=>{"use strict";t.exports=s;var n=e.r(37367);(s.prototype=Object.create(n.prototype)).constructor=s;var i=e.r(16181);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},56823,(e,t,r)=>{"use strict";var n=r;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=e.r(92458),n.BufferWriter=e.r(75084),n.Reader=e.r(37367),n.BufferReader=e.r(68308),n.util=e.r(16181),n.rpc=e.r(77878),n.roots=e.r(70798),n.configure=i,i()},15387,(e,t,r)=>{"use strict";var n=t.exports=e.r(56823);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=e.r(19622),n.decoder=e.r(83476),n.verifier=e.r(69048),n.converter=e.r(79711),n.ReflectionObject=e.r(73057),n.Namespace=e.r(71252),n.Root=e.r(62192),n.Enum=e.r(52100),n.Type=e.r(10936),n.Field=e.r(99726),n.OneOf=e.r(68144),n.MapField=e.r(21773),n.Service=e.r(20004),n.Method=e.r(74944),n.Message=e.r(77682),n.wrappers=e.r(13199),n.types=e.r(6591),n.util=e.r(37625),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},43206,(e,t,r)=>{"use strict";t.exports=f;var n=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,s=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,o=/^\s*\*?\/*/,l=/\n/g,c=/\s/,u=/\\(.?)/g,h={0:"\0",r:"\r",n:"\n",t:"	"};function d(e){return e.replace(u,function(e,t){switch(t){case"\\":case"":return t;default:return h[t]||""}})}function f(e,t){e=e.toString();var r=0,u=e.length,h=1,f=0,p={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===g?s:i;t.lastIndex=r-1;var n=t.exec(e);if(!n)throw y("string");return r=t.lastIndex,T(g),g=null,d(n[1])}function _(t){return e.charAt(t)}function b(r,n,i){var s,c={type:e.charAt(r++),lineEmpty:!1,leading:i},u=r-(t?2:3);do if(--u<0||"\n"===(s=e.charAt(u))){c.lineEmpty=!0;break}while(" "===s||"	"===s)for(var d=e.substring(r,n).split(l),m=0;m<d.length;++m)d[m]=d[m].replace(t?o:a,"").trim();c.text=d.join("\n").trim(),p[h]=c,f=h}function S(t){var r=C(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function C(e){for(var t=e;t<u&&"\n"!==_(t);)t++;return t}function w(){if(m.length>0)return m.shift();if(g)return v();var i,s,a,o,l,d=0===r;do{if(r===u)return null;for(i=!1;c.test(a=_(r));)if("\n"===a&&(d=!0,++h),++r===u)return null;if("/"===_(r)){if(++r===u)throw y("comment");if("/"===_(r))if(t){if(o=r,l=!1,S(r-1)){l=!0;do if((r=C(r))===u||(r++,!d))break;while(S(r))}else r=Math.min(u,C(r)+1);l&&(b(o,r,d),d=!0),h++,i=!0}else{for(l="/"===_(o=r+1);"\n"!==_(++r);)if(r===u)return null;++r,l&&(b(o,r-1,d),d=!0),++h,i=!0}else{if("*"!==(a=_(r)))return"/";o=r+1,l=t||"*"===_(o);do{if("\n"===a&&++h,++r===u)throw y("comment");s=a,a=_(r)}while("*"!==s||"/"!==a)++r,l&&(b(o,r-2,d),d=!0),i=!0}}}while(i)var f=r;if(n.lastIndex=0,!n.test(_(f++)))for(;f<u&&!n.test(_(f));)++f;var p=e.substring(r,r=f);return('"'===p||"'"===p)&&(g=p),p}function T(e){m.push(e)}function E(){if(!m.length){var e=w();if(null===e)return null;T(e)}return m[0]}function I(e,t){var r=E();if(r===e)return w(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function k(e){var r,n=null;return void 0===e?(r=p[h-1],delete p[h-1],r&&(t||"*"===r.type||r.lineEmpty)&&(n=r.leading?r.text:null)):(f<e&&E(),r=p[e],delete p[e],r&&!r.lineEmpty&&(t||"/"===r.type)&&(n=r.leading?null:r.text)),n}return Object.defineProperty({next:w,peek:E,push:T,skip:I,cmnt:k},"line",{get:function(){return h}})}f.unescape=d},28712,(e,t,r)=>{"use strict";t.exports=T,T.filename=null,T.defaults={keepCase:!1};var n=e.r(43206),i=e.r(62192),s=e.r(10936),a=e.r(99726),o=e.r(21773),l=e.r(68144),c=e.r(52100),u=e.r(20004),h=e.r(74944),d=e.r(73057),f=e.r(6591),p=e.r(37625),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,_=/^0[0-7]+$/,b=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,C=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function T(e,t,r){t instanceof i||(r=t,t=new i),r||(r=T.defaults);var E,I,k,R,x=r.preferTrailingComment||!1,O=n(e,r.alternateCommentMode||!1),A=O.next,D=O.push,N=O.peek,P=O.skip,M=O.cmnt,L=!0,F="proto2",B=t,U=[],j={},q=r.keepCase?function(e){return e}:p.camelCase;function V(){U.forEach(e=>{e._edition=F,Object.keys(j).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,j[t],!0)})})}function z(e,t,r){var n=T.filename;return r||(T.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+O.line+")")}function H(){var e,t=[];do{if('"'!==(e=A())&&"'"!==e)throw z(e);t.push(A()),P(e),e=N()}while('"'===e||"'"===e)return t.join("")}function $(e){var t=A();switch(t){case"'":case'"':return D(t),H();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return K(t,!0)}catch(r){if(e&&w.test(t))return t;throw z(t,"value")}}function W(e,t){do if(t&&('"'===(r=N())||"'"===r)){var r,n,i=H();if(e.push(i),F>=2023)throw z(i,"id")}else try{e.push([n=G(A()),P("to",!0)?G(A()):n])}catch(n){if(t&&w.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0))var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)})}function K(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(_.test(e))return r*parseInt(e,8);if(S.test(e))return r*parseFloat(e);throw z(e,"number",t)}function G(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw z(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(b.test(e))return parseInt(e,8);throw z(e,"id")}function Q(){if(void 0!==I)throw z("package");if(I=A(),!w.test(I))throw z(I,"name");B=B.define(I),P(";")}function Y(){var e,t=N();switch(t){case"weak":e=R||(R=[]),A();break;case"public":A();default:e=k||(k=[])}t=H(),P(";"),e.push(t)}function J(){if(P("="),(F=H())<2023)throw z(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=H()))throw z(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ef(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=O.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=T.filename),P("{",!0)){for(;"}"!==(n=A());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||x)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!C.test(t=A()))throw z(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw z(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw z(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":W(r.extensions||(r.extensions=[]));break;case"reserved":W(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!w.test(e))throw z(e);D(e),er(r,"optional")}}),e.add(r),e===B&&U.push(r)}function er(e,t,r){var n=A();if("group"===n)return void en(e,t);for(;n.endsWith(".")||N().startsWith(".");)n+=A();if(!w.test(n))throw z(n,"type");var i=A();if(!C.test(i))throw z(i,"name");i=q(i),P("=");var s=new a(i,G(A()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&U.push(s)}function en(e,t){if(F>=2023)throw z("group");var r=A();if(!C.test(r))throw z(r,"name");var n=p.lcFirst(r);r===n&&(r=p.ucFirst(r)),P("=");var i=G(A()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=T.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":W(o.reserved||(o.reserved=[]),!0);break;default:throw z(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=A();if(void 0===f.mapKey[t])throw z(t,"type");P(",");var r=A();if(!w.test(r))throw z(r,"type");P(">");var n=A();if(!C.test(n))throw z(n,"name");P("=");var i=new o(q(n),G(A()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw z(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!C.test(t=A()))throw z(t,"name");var r=new l(q(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(D(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!C.test(t=A()))throw z(t,"name");var r=new c(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":W(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===B&&U.push(r)}function eo(e,t){if(!C.test(t))throw z(t,"name");P("=");var r=G(A(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){d.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw z(e)},function(){ed(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=A());"="!==t;){if("("===t){var s=A();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=A()}var o=ec(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,eh(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function ec(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!C.test(E=A()))throw z(E,"name");if(null===E)throw z(E,"end of input");var n,i,s=E;if(P(":",!0),"{"===N())n=ec(e,t+"."+E);else if("["===N()){if(n=[],P("[",!0)){do i=$(!0),n.push(i);while(P(",",!0))P("]"),void 0!==i&&eu(e,t+"."+E,i)}}else n=$(!0),eu(e,t+"."+E,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=$(!0);return eu(e,t,o),o}function eu(e,t,r){if(B===e&&/^features\./.test(t)){j[t]=r;return}e.setOption&&e.setOption(t,r)}function eh(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0))P("]")}return e}function ef(e,t){if(!C.test(t=A()))throw z(t,"service name");var r=new u(t);ee(r,function(e){if(!Z(r,e))if("rpc"===e)ep(r,e);else throw z(e)}),e.add(r),e===B&&U.push(r)}function ep(e,t){var r=M(),n=t;if(!C.test(t=A()))throw z(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!w.test(t=A())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!w.test(t=A())))throw z(t);a=t,P(")");var c=new h(l,n,i,a,s,o);c.comment=r,ee(c,function(e){if("option"===e)el(c,e),P(";");else throw z(e)}),e.add(c)}function em(e,t){if(!w.test(t=A()))throw z(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!w.test(t))throw z(t);D(t),er(e,"optional",r)}})}for(;null!==(E=A());)switch(E){case"package":if(!L)throw z(E);Q();break;case"import":if(!L)throw z(E);Y();break;case"syntax":if(!L)throw z(E);J();break;case"edition":if(!L)throw z(E);X();break;case"option":el(B,E),P(";",!0);break;default:if(Z(B,E)){L=!1;continue}throw z(E)}return V(),T.filename=null,{package:I,imports:k,weakImports:R,root:t}}},65009,(e,t,r)=>{"use strict";t.exports=s;var n,i=/\/|\./;function s(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),s[e]=t}s("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),s("duration",{Duration:n={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),s("timestamp",{Timestamp:n}),s("empty",{Empty:{fields:{}}}),s("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),s("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),s("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),s.get=function(e){return s[e]||null}},33004,(e,t,r)=>{"use strict";var n=t.exports=e.r(15387);n.build="full",n.tokenize=e.r(43206),n.parse=e.r(28712),n.common=e.r(65009),n.Root._configure(n.Type,n.parse,n.common)},89436,(e,t,r)=>{"use strict";t.exports=e.r(33004)},87930,(e,t,r)=>{"use strict";var n=e.r(89436);t.exports=r=n.descriptor=n.Root.fromJSON(e.r(67803)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,c=n.MapField,u=n.OneOf,h=n.Service,d=n.Method;function f(e,t,n){var c=r.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});O(n,c),e instanceof s||(c.package=e.fullName.substring(1));for(var u,d=0;d<e.nestedArray.length;++d)(u=e._nestedArray[d])instanceof o?c.messageType.push(u.toDescriptor(n)):u instanceof a?c.enumType.push(u.toDescriptor()):u instanceof l?c.extension.push(u.toDescriptor(n)):u instanceof h?c.service.push(u.toDescriptor()):u instanceof i&&f(u,t,n);c.options=I(e.options,r.FileOptions),c.messageType.length+c.enumType.length+c.extension.length+c.service.length&&t.push(c)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=r.FileDescriptorSet.decode(e));var t=new s;if(e.file)for(var n,i,c,u=0;u<e.file.length;++u){i=t,(n=e.file[u]).package&&n.package.length&&(i=t.define(n.package));var d=x(n);if(n.name&&n.name.length&&t.files.push(i.filename=n.name),n.messageType)for(c=0;c<n.messageType.length;++c)i.add(o.fromDescriptor(n.messageType[c],d));if(n.enumType)for(c=0;c<n.enumType.length;++c)i.add(a.fromDescriptor(n.enumType[c],d));if(n.extension)for(c=0;c<n.extension.length;++c)i.add(l.fromDescriptor(n.extension[c],d));if(n.service)for(c=0;c<n.service.length;++c)i.add(h.fromDescriptor(n.service[c],d));var f=T(n.options,r.FileOptions);if(f){var p=Object.keys(f);for(c=0;c<p.length;++c)i.setOption(p[c],f[p[c]])}}return t.resolveAll()},s.prototype.toDescriptor=function(e){var t=r.FileDescriptorSet.create();return f(this,t.file,e),t};var p=0;o.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+p++,T(e.options,r.MessageOptions));if(n||(s._edition=t),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(u.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var c=l.fromDescriptor(e.field[i],t,!0);s.add(c),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(c)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],t,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],t,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],t,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var t,n,i=r.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(t=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof c){var s=C(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),u=C(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),h=11===u||14===u?this._fieldsArray[n].resolvedType&&k(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(r.DescriptorProto.create({name:t.typeName,field:[r.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),r.FieldDescriptorProto.create({name:"value",number:2,label:1,type:u,typeName:h})],options:r.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(r.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(r.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,r.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,t,n){if("number"==typeof e.length&&(e=r.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:b(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=t),o.options=T(e.options,r.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var c=e.defaultValue;switch(c){case"true":case"TRUE":c=!0;break;case"false":case"FALSE":c=!1;break;default:m.exec(c)&&(c=parseInt(c))}o.setOption("default",c)}return S(e.type)&&("proto3"===t?e.options&&!e.options.packed&&o.setOption("packed",!1):(!t||"proto2"===t)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var t=r.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=n.util.ucFirst(this.name),t.label=3;else{switch(t.type=C(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:t.typeName=this.resolvedType?k(this.parent,this.resolvedType):this.type}"repeated"===this.rule?t.label=3:this.required&&"proto2"===e?t.label=2:t.label=1}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=I(this.options,r.FieldOptions),null!=this.options.default&&(t.defaultValue=String(this.options.default)),this.options.proto3_optional&&(t.proto3_optional=!0)),"proto3"===e?this.packed||((t.options||(t.options=r.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((t.options||(t.options=r.FieldOptions.create())).packed=!0),t};var g=0;a.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var c=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,T(e.options,r.EnumOptions));return n||(c._edition=t),c},a.prototype.toDescriptor=function(){for(var e=[],t=0,n=Object.keys(this.values);t<n.length;++t)e.push(r.EnumValueDescriptorProto.create({name:n[t],number:this.values[n[t]]}));return r.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,r.EnumOptions)})};var y=0;u.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.OneofDescriptorProto.decode(e)),new u(e.name&&e.name.length?e.name:"oneof"+y++)},u.prototype.toDescriptor=function(){return r.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e,t,n){"number"==typeof e.length&&(e=r.ServiceDescriptorProto.decode(e));var i=new h(e.name&&e.name.length?e.name:"Service"+v++,T(e.options,r.ServiceOptions));if(n||(i._edition=t),e.method)for(var s=0;s<e.method.length;++s)i.add(d.fromDescriptor(e.method[s]));return i},h.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return r.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,r.ServiceOptions)})};var _=0;function b(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function S(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function C(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function w(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=R(n);r.resolvedType instanceof o?i[l]=w(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function T(e,t){if(e)return w(t.toObject(e),t)}function E(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var c=t.fields[l];c.resolvedType instanceof o?r[l]=E(e[a],c.resolvedType):r[l]=e[a],c.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(E(e,t))}function k(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var c=t.lookup(r[a++],!0);if(null!==c&&c!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function R(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function x(e){if("editions"===e.syntax)if(e.edition===r.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+e.edition);return"proto3"===e.syntax?"proto3":"proto2"}function O(e,t){if(e)if("proto2"===e||"proto3"===e)t.syntax=e;else if(t.syntax="editions","2023"===e)t.edition=r.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=r.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+_++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,T(e.options,r.MethodOptions))},d.prototype.toDescriptor=function(){return r.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,r.MethodOptions)})}},99040,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addCommonProtos=r.loadProtosWithOptionsSync=r.loadProtosWithOptions=void 0;let n=e.r(22734),i=e.r(14747),s=e.r(89436);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}r.loadProtosWithOptions=async function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n},r.loadProtosWithOptionsSync=function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n},r.addCommonProtos=function(){let t=e.r(99244),r=e.r(67803),n=e.r(93383),i=e.r(79715);s.common("api",t.nested.google.nested.protobuf.nested),s.common("descriptor",r.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},54960,(e,t,r)=>{!function(n,i){function s(e){return e.default||e}if("function"==typeof define&&define.amd){let t;void 0!==(t=function(){var e={};return i(e),s(e)}())&&e.v(t)}else i(r),t.exports=s(r)}("u">typeof globalThis?globalThis:"u">typeof self?self:e.e,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=c(e,0,!0),i&&(a[e]=r),r);return(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=c(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return w}else{if(e<=-m)return T;if(e+1>=m)return C}return e<0?l(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=c;var u=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var n,i=l(u(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),c=parseInt(e.substring(a,a+o),r);if(o<8){var d=l(u(r,o));s=s.mul(d).add(l(c))}else s=(s=s.mul(i)).add(l(c))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var f=0x100000000,p=0xffffffffffffffff,m=0x8000000000000000,g=o(0x1000000),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var _=o(1);r.ONE=_;var b=o(1,!0);r.UONE=b;var S=o(-1);r.NEG_ONE=S;var C=c(-1,0x7fffffff,!1);r.MAX_VALUE=C;var w=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var T=c(0,-0x80000000,!1);r.MIN_VALUE=T;var E=r.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},E.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(T))return"-"+this.neg().toString(e);else{var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(u(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),c=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},E.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return(1&this.low)==1},E.isEven=function(){return(1&this.low)==0},E.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},E.eq=E.equals,E.notEquals=function(e){return!this.eq(e)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(e){return 0>this.comp(e)},E.lt=E.lessThan,E.lessThanOrEqual=function(e){return 0>=this.comp(e)},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(e){return this.comp(e)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(e){return this.comp(e)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(_)},E.neg=E.negate,E.add=function(e){n(e)||(e=d(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,u=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,m=0;return t=0+((r=0+(o+f))>>>16),r&=65535,t+=a+h,m+=t>>>16,t&=65535,m+=s+u,p+=m>>>16,m&=65535,p+=i+l,c(t<<16|r,(p&=65535)<<16|m,this.unsigned)},E.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},E.sub=E.subtract,E.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=d(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(T))return e.isOdd()?T:y;if(e.eq(T))return this.isOdd()?T:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,u=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,m=65535&e.low,_=0,b=0;return r=0+((i=0+u*m)>>>16),i&=65535,r+=o*m,b+=r>>>16,r&=65535,r+=u*p,b+=r>>>16,r&=65535,b+=a*m,_+=b>>>16,b&=65535,b+=o*p,_+=b>>>16,b&=65535,b+=u*f,_+=b>>>16,b&=65535,_+=s*m+a*p+o*f+u*h,c(r<<16|i,(_&=65535)<<16|b,this.unsigned)},E.mul=E.multiply,E.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return b;s=v}else{if(this.eq(T))if(e.eq(_)||e.eq(S))return T;else return e.eq(T)?_:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?_:S:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(T))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:u(2,a-48),h=l(r),f=h.mul(e);f.isNegative()||f.gt(i);)r-=o,f=(h=l(r,this.unsigned)).mul(e);h.isZero()&&(h=_),s=s.add(h),i=i.sub(f)}return s},E.div=E.divide,E.modulo=function(e){return(n(e)||(e=d(e)),t)?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return c(~this.low,~this.high,this.unsigned)},E.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},E.clz=E.countLeadingZeros,E.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},E.ctz=E.countTrailingZeros,E.and=function(e){return n(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},E.or=function(e){return n(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},E.xor=function(e){return n(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},E.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?c(this.high,0,this.unsigned):c(this.high>>>e-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,c(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},E.rotl=E.rotateLeft,E.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,c(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},E.rotr=E.rotateRight,E.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return c(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):d(e,t)},E.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},45262,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.loadFileDescriptorSetFromObject=r.loadFileDescriptorSetFromBuffer=r.fromJSON=r.loadSync=r.load=r.IdempotencyLevel=r.isAnyExtension=r.Long=void 0;let i=e.r(16702),s=e.r(89436),a=e.r(87930),o=e.r(99040);r.Long=e.r(54960),r.isAnyExtension=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(n=r.IdempotencyLevel||(r.IdempotencyLevel={}));let l={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function c(e,t){return""===e?t:e+"."+t}function u(e){return e instanceof s.Service||e instanceof s.Type||e instanceof s.Enum}function h(e){return e instanceof s.Namespace||e instanceof s.Root}function d(e,t){let r=c(t,e.name);return u(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>d(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function p(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function m(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:n.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function g(e,t,r,n){let s=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:p(s),requestDeserialize:f(s,r),responseSerialize:p(a),responseDeserialize:f(a,r),originalName:i(e.name),requestType:v(s,n),responseType:v(a,n),options:m(e.parsedOptions)}}function y(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=g(s,t,r,n);return i}function v(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function _(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,l),fileDescriptorProtos:t}}function b(e,t,r,n){if(e instanceof s.Service)return y(e,t,r,n);if(e instanceof s.Type)return v(e,n);if(e instanceof s.Enum)return _(e,n);throw Error("Type mismatch in reflection object handling")}function S(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(a.FileDescriptorProto.encode(e).finish()));for(let[i,s]of d(e,""))r[i]=b(s,i,t,n);return r}function C(e,t){t=t||{};let r=s.Root.fromDescriptor(e);return r.resolveAll(),S(r,t)}r.load=function(e,t){return(0,o.loadProtosWithOptions)(e,t).then(e=>S(e,t))},r.loadSync=function(e,t){return S((0,o.loadProtosWithOptionsSync)(e,t),t)},r.fromJSON=function(e,t){t=t||{};let r=s.Root.fromJSON(e);return r.resolveAll(),S(r,t)},r.loadFileDescriptorSetFromBuffer=function(e,t){return C(a.FileDescriptorSet.decode(e),t)},r.loadFileDescriptorSetFromObject=function(e,t){return C(a.FileDescriptorSet.fromObject(e),t)},(0,o.addCommonProtos)()},54312,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.getChannelzServiceDefinition=r.getChannelzHandlers=r.unregisterChannelzRef=r.registerChannelzSocket=r.registerChannelzServer=r.registerChannelzSubchannel=r.registerChannelzChannel=r.ChannelzCallTracker=r.ChannelzChildrenTracker=r.ChannelzTrace=void 0;let n=e.r(4446),i=e.r(95653),s=e.r(37294),a=e.r(46801),o=e.r(81800),l=e.r(55779);function c(e){return{channel_id:e.id,name:e.name}}function u(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:k(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:k(e.timestamp),channel_ref:e.childChannel?c(e.childChannel):null,subchannel_ref:e.childSubchannel?u(e.childSubchannel):null}))}}}r.ChannelzTrace=p;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!=(r=this.subchannelChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(n=this.socketChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}r.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}r.ChannelzCallTracker=g;let y=1;function v(){return y++}let _=[],b=[],S=[],C=[];function w(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function T(e){return""===e?[]:[].concat(...e.split(":").map(e=>w(e)))}function E(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r,n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(T(t)),s=Buffer.from(T(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function I(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function k(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function R(e){let t=e.getInfo();return{ref:c(e.ref),data:{target:t.target,state:I(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>c(e)),subchannel_ref:t.children.subchannels.map(e=>u(e))}}function x(e,t){let r=Number.parseInt(e.request.channel_id),n=_[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r}):t(null,{channel:R(n)})}function O(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<_.length;i++){let e=_[i];if(void 0!==e&&(n.push(R(e)),n.length>=r))break}t(null,{channel:n,end:i>=S.length})}function A(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:k(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function D(e,t){let r=Number.parseInt(e.request.server_id),n=S[r];void 0===n?t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r}):t(null,{server:A(n)})}function N(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<S.length;i++){let e=S[i];if(void 0!==e&&(n.push(A(e)),n.length>=r))break}t(null,{server:n,end:i>=S.length})}function P(e,t){let r=Number.parseInt(e.request.subchannel_id),n=b[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});let i=n.getInfo();t(null,{subchannel:{ref:u(n.ref),data:{target:i.target,state:I(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:k(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=E(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),c=C[l];if(void 0===c)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let u=c.getInfo(),h=u.security?{model:"tls",tls:{cipher_suite:u.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(r=u.security.cipherSuiteStandardName)?r:void 0,other_name:null!=(n=u.security.cipherSuiteOtherName)?n:void 0,local_certificate:null!=(i=u.security.localCertificate)?i:void 0,remote_certificate:null!=(a=u.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:d(c.ref),local:u.localAddress?M(u.localAddress):null,remote:u.remoteAddress?M(u.remoteAddress):null,remote_name:null!=(o=u.remoteName)?o:void 0,security:h,data:{keep_alives_sent:u.keepAlivesSent,streams_started:u.streamsStarted,streams_succeeded:u.streamsSucceeded,streams_failed:u.streamsFailed,last_local_stream_created_timestamp:k(u.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:k(u.lastRemoteStreamCreatedTimestamp),messages_received:u.messagesReceived,messages_sent:u.messagesSent,last_message_received_timestamp:k(u.lastMessageReceivedTimestamp),last_message_sent_timestamp:k(u.lastMessageSentTimestamp),local_flow_control_window:u.localFlowControlWindow?{value:u.localFlowControlWindow}:null,remote_flow_control_window:u.remoteFlowControlWindow?{value:u.remoteFlowControlWindow}:null}}})}function F(e,t){let r=Number.parseInt(e.request.server_id),n=S[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],c=0;for(;c<o.length&&(!(o[c].id>=i)||(l.push(d(o[c])),!(l.length>=a)));c++);t(null,{socket_ref:l,end:c>=o.length})}function B(){return{GetChannel:x,GetTopChannels:O,GetServer:D,GetServers:N,GetSubchannel:P,GetSocket:L,GetServerSockets:F}}r.registerChannelzChannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(_[n]={ref:i,getInfo:t}),i},r.registerChannelzSubchannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(b[n]={ref:i,getInfo:t}),i},r.registerChannelzServer=function(e,t){let r=v(),n={id:r,kind:"server"};return t&&(S[r]={ref:n,getInfo:e}),n},r.registerChannelzSocket=function(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(C[n]={ref:i,getInfo:t}),i},r.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete _[e.id];return;case"subchannel":delete b[e.id];return;case"server":delete S[e.id];return;case"socket":delete C[e.id];return}},r.getChannelzHandlers=B;let U=null;function j(){if(U)return U;let t=(0,e.r(45262).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/node_modules/@grpc/grpc-js/build/src/../../proto"]});return U=(0,l.loadPackageDefinition)(t).grpc.channelz.v1.Channelz.service}r.getChannelzServiceDefinition=j,r.setup=function(){(0,o.registerAdminService)(j,B)}},6312,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Subchannel=void 0;let n=e.r(95653),i=e.r(38644),s=e.r(91200),a=e.r(37294),o=e.r(28835),l=e.r(46801),c=e.r(54312),u="subchannel",h=0x7fffffff;class d{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new c.ChannelzCallTracker,this.childrenTracker=new c.ChannelzChildrenTracker,this.streamTracker=new c.ChannelzCallTracker;const u={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},u),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=r["grpc.keepalive_time_ms"])?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new c.ChannelzTrace,this.channelzRef=(0,c.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,u,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,c.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}r.Subchannel=d},60702,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.DEFAULT_PORT=void 0;let n=e.r(23359),i=e.r(79594),s=e.r(24361),a=e.r(59807),o=e.r(37294),l=e.r(73155),c=e.r(91200),u=e.r(37294),h=e.r(28835),d=e.r(4446),f=e.r(38644),p="dns_resolver";function m(e){c.trace(u.LogVerbosity.DEBUG,p,e)}r.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function _(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class b{constructor(e,t,n){var i,s,a;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,h.uriToString)(e));const c=(0,h.splitHostPort)(e.path);null===c?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(c.host)||(0,d.isIPv6)(c.host)?(this.ipResult=[{host:c.host,port:null!=(i=c.port)?i:r.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=c.host,this.port=null!=(s=c.port)?s:r.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};const u={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},u),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=n["grpc.dns_min_time_between_resolutions_ms"])?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=_(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";(m("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}r.setup=function(){(0,n.registerResolver)("dns",b),(0,n.registerDefaultScheme)("dns")}},52776,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProxiedConnection=r.mapProxyName=void 0;let n=e.r(91200),i=e.r(37294),s=e.r(23359),a=e.r(21517),o=e.r(55004),l=e.r(91200),c=e.r(46801),u=e.r(28835),h=e.r(92509),d=e.r(60702),f="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,f,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}r.mapProxyName=function(e,t){var r;let n={target:e,extraOptions:{}};if((null!=(r=t["grpc.enable_http_proxy"])?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,u.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return p("Not using proxy for target in no_proxy list: "+(0,u.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,u.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},r.getProxiedConnection=function(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],f=(0,u.parseUri)(h);if(null===f)return Promise.resolve({});let m=(0,u.splitHostPort)(f.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!=(l=m.port)?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,c.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let _=(0,c.subchannelAddressToString)(e);return p("Using proxy "+_+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,c,h)=>{var d;if(l.removeAllListeners(),c.removeAllListeners(),200===a.statusCode)if(p("Successfully connected to "+y.path+" through proxy "+_),"secureContext"in r){let n=(0,s.getDefaultAuthority)(f),i=(0,u.splitHostPort)(n),a=null!=(d=null==i?void 0:i.host)?d:n,l=o.connect(Object.assign({host:a,servername:a,socket:c},r),()=>{p("Successfully established a TLS connection to "+y.path+" through proxy "+_),e({socket:l,realTarget:f})});l.on("error",e=>{p("Failed to establish a TLS connection to "+y.path+" through proxy "+_+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+y.path+" through proxy "+_),e({socket:c,realTarget:f});else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+_+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+_+" with error "+e.message),t()}),l.end()})}},23754,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class i{constructor(e){this.maxReadMessageLength=e,this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}r.StreamDecoder=i},56791,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelCall=void 0;let n=e.r(25328),i=e.r(46786),s=e.r(37294),a=e.r(73155),o=e.r(23754),l=e.r(91200),c=e.r(37294),u="subchannel_call";function h(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class d{constructor(e,t,r,i,l){var c;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const u=null!=(c=i.getOptions()["grpc.max_receive_message_length"])?c:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(u),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(c.LogVerbosity.DEBUG,u,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null==(r=e.callback)||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}r.Http2SubchannelCall=d},62152,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getNextCallNumber=void 0;let n=0;r.getNextCallNumber=function(){return n++}},36673,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2SubchannelConnector=void 0;let n=e.r(25328),i=e.r(55004),s=e.r(54312),a=e.r(37294),o=e.r(52776),l=e.r(91200),c=e.r(23359),u=e.r(46801),h=e.r(28835),d=e.r(4446),f=e.r(56791),p=e.r(62152),m="transport",g="transport_flowctrl",y=e.r(17887).version,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:_,HTTP2_HEADER_METHOD:b,HTTP2_HEADER_PATH:S,HTTP2_HEADER_TE:C,HTTP2_HEADER_USER_AGENT:w}=n.constants,T=2e4,E=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=T,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,u.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(E)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n,i=this.session.socket,s=i.remoteAddress?(0,u.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,u.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!=(e=r.standardName)?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(r=this.session.state.remoteWindowSize)?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[w]=this.userAgent,l[_]="application/grpc",l[b]="POST",l[S]=r,l[C]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,n,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class k{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let m;s.realTarget?(m=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,u.subchannelAddressToString)(e)));let g=(0,c.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!=(p=null==(f=(0,h.splitHostPort)(g))?void 0:f.host)?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let _=n.connect(v+g,y);this.session=_;let b="Failed to connect";_.unref(),_.once("connect",()=>{_.removeAllListeners(),a(new I(_,e,r,m)),this.session=null}),_.once("close",()=>{this.session=null,setImmediate(()=>{o(`${b} (${new Date().toISOString()})`)})}),_.once("error",e=>{b=e.message,this.trace("connection failed with error "+b)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,c.getDefaultAuthority)(null!=(n=(0,h.parseUri)(r["grpc.http_connect_target"]))?n:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}r.Http2SubchannelConnector=k},75971,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSubchannelPool=r.SubchannelPool=void 0;let n=e.r(87147),i=e.r(6312),s=e.r(46801),a=e.r(28835),o=e.r(36673),l=1e4;class c{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let c=(0,a.uriToString)(e);if(c in this.pool){for(let e of this.pool[c])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let u=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return c in this.pool||(this.pool[c]=[]),this.pool[c].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:u}),u.ref(),u}}r.SubchannelPool=c;let u=new c;r.getSubchannelPool=function(e){return e?u:new c}},31702,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FilterStackFactory=r.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}r.FilterStack=n;class i{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new i([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}r.FilterStackFactory=i},43138,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(r.CompressionAlgorithms=n={}))},74e3,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}r.BaseFilter=n},69355,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CompressionFilterFactory=r.CompressionFilter=void 0;let n=e.r(6461),i=e.r(43138),s=e.r(37294),a=e.r(74e3),o=e.r(91200),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class c{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(+!!t,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class u extends c{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends c{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends c{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class f extends c{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e,t){switch(e){case"identity":return new u;case"deflate":return new h(t);case"gzip":return new d(t);default:return new f(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new u,this.receiveCompression=new u,this.currentCompressionAlgorithm="identity";const a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(r=e["grpc.max_receive_message_length"])?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){const e=i.CompressionAlgorithms[a],r=null==(n=t.serverSupportedEncodingHeader)?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new u,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r,n=await e;return r=!(this.sendCompression instanceof u)&&((null!=(t=n.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}r.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}r.CompressionFilterFactory=g},24064,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deadlineToString=r.getRelativeTimeout=r.getDeadlineTimeoutString=r.minDeadline=void 0,r.minDeadline=function(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t};let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];r.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")};let i=0x7fffffff;r.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>i?1/0:t},r.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},14040,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.restrictControlPlaneStatusCode=void 0;let n=e.r(37294),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];r.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}},27806,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoadBalancingCall=void 0;let n=e.r(95653),i=e.r(37294),s=e.r(24064),a=e.r(73155),o=e.r(87080),l=e.r(28835),c=e.r(91200),u=e.r(14040),h=e.r(25328),d="load_balancing_call";class f{constructor(e,t,r,n,i,s,a){var o,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const u=this.methodName.split("/");let h="";u.length>=2&&(h=u[1]);const d=null!=(c=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?c:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){c.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(r=this.listener)||r.onReceiveStatus(i),null==(n=this.onCallEnded)||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null==(e=r.status)?void 0:e.code)+" "+(null==(t=r.status)?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,c;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let u=this.metadata.clone();if(u.merge(e),u.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&u.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(u,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(c=r.onCallStarted)||c.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,u.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:c,details:d}=(0,u.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:c,details:d,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,u.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}r.LoadBalancingCall=f},35988,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ResolvingCall=void 0;let n=e.r(37294),i=e.r(24064),s=e.r(73155),a=e.r(91200),o=e.r(14040),l="resolving_call";class c{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}r.ResolvingCall=c},88622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RetryingCall=r.MessageBufferTracker=r.RetryThrottler=void 0;let n=e.r(37294),i=e.r(73155),s=e.r(91200),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}r.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}r.MessageBufferTracker=l;let c="grpc-previous-rpc-attempts";class u{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";const e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state)return void t(!1);let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return void t(!1);if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;"RETRY"!==this.state?t(!1):(null==(r=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?n:[],e.code)){let n;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null==(r=this.retryThrottler)||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!=(e=n.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(r=(t=this.hedgingTimer).unref)||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(c,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(c,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(c,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null==(r=(t=this.getBufferEntry(i)).callback)||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null==(r=e.callback)||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}r.RetryingCall=u},36927,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}r.BaseSubchannelWrapper=n},37158,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalChannel=void 0;let n=e.r(83106),i=e.r(61693),s=e.r(75971),a=e.r(87080),o=e.r(37294),l=e.r(31702),c=e.r(69355),u=e.r(23359),h=e.r(91200),d=e.r(52776),f=e.r(28835),p=e.r(95653),m=e.r(54312),g=e.r(27806),y=e.r(24064),v=e.r(35988),_=e.r(62152),b=e.r(14040),S=e.r(88622),C=e.r(36927),w=0x7fffffff,T=1e3,E=18e5,I=new Map,k=0x1000000,R=1048576;class x extends C.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class O{constructor(e,t,r){var g,y,v,_,C,O,A,D;if(this.credentials=t,this.options=r,this.connectivityState=p.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;const N=(0,f.parseUri)(e);if(null===N)throw Error(`Could not parse target name "${e}"`);const P=(0,u.mapUriDefaultScheme)(N);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},w),null==(y=(g=this.callRefTimer).unref)||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,u.getDefaultAuthority)(P);const M=(0,d.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=r["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new S.MessageBufferTracker(null!=(_=r["grpc.retry_buffer_size"])?_:k,null!=(C=r["grpc.per_rpc_retry_buffer_size"])?C:R),this.keepaliveTime=null!=(O=r["grpc.keepalive_time_ms"])?O:-1,this.idleTimeoutMs=Math.max(null!=(A=r["grpc.client_idle_timeout_ms"])?A:E,T);const L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new x(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new S.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,b.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new c.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));const F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(D=F.stack)?void 0:D.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(n=(r=this.callRefTimer).ref)||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+p.ConnectivityState[this.connectivityState]+" -> "+p.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+p.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==p.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(r=(t=this.idleTimer).unref)||r.call(t)}maybeStartIdleTimer(){this.connectivityState===p.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,_.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,_.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new S.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,_.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,f.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(r,Error("Deadline passed without connectivity state change"));n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}r.InternalChannel=O},75917,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChannelImplementation=void 0;let n=e.r(83106),i=e.r(37158);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}r.ChannelImplementation=s},17755,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Http2ServerCallStream=r.ServerDuplexStreamImpl=r.ServerWritableStreamImpl=r.ServerReadableStreamImpl=r.ServerUnaryCallImpl=void 0;let n=e.r(27699),i=e.r(25328),s=e.r(88947),a=e.r(6461),o=e.r(37294),l=e.r(73155),c=e.r(23754),u=e.r(91200),h=e.r(40646),d="server_call";function f(e){u.trace(o.LogVerbosity.DEBUG,d,e)}let p="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},_={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},b={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},S={waitForTrailers:!0};class C extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerUnaryCallImpl=C;class w extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}r.ServerReadableStreamImpl=w;class T extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",r)}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerWritableStreamImpl=T;class E extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}r.ServerDuplexStreamImpl=E,E.prototype._read=w.prototype._read,E.prototype._write=T.prototype._write,E.prototype._final=T.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;f("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},b),_),t);this.stream.respond(r,S)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);u.isTracerEnabled(d)&&f("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(k,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function c(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",c),n.removeListener("end",u),n.removeListener("error",u),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function u(l){if(n.removeListener("data",c),n.removeListener("end",u),n.removeListener("error",u),void 0!==l)return void r({code:o.Status.INTERNAL,details:l.message});if(0===i)return void r({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);Buffer.isBuffer(f)?t(s.deserializeMessageWithInternalError(f)):f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(f("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[p]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[p]:encodeURI(e.details)},b),null==(r=e.metadata)?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new c.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){f("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}f("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function k(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}r.Http2ServerCallStream=I},1255,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerCredentials=void 0;let n=e.r(84049);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}r.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},2622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Server=void 0;let n=e.r(25328),i=e.r(37294),s=e.r(17755),a=e.r(1255),o=e.r(23359),l=e.r(91200),c=e.r(46801),u=e.r(28835),h=e.r(54312),d=0x7fffffff,f=0x7fffffff,p=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function _(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class b{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:d,this.maxConnectionAgeGraceMs=null!=(r=this.options["grpc.max_connection_age_grace_ms"])?r:d,this.keepaliveTimeMs=null!=(n=this.options["grpc.keepalive_time_ms"])?n:f,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,c.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,c.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=r.standardName)?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(r=e.state.localWindowSize)?r:null,remoteFlowControlWindow:null!=(n=e.state.remoteWindowSize)?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i,s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):_(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,u.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(f,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,c.subchannelAddressToString)(e)),r=(0,c.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,c.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,h.registerChannelzSocket)((0,c.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,c.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,c.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,c.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,c.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},_={onSuccessfulResolution:(t,r,n)=>{let s;(_.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length)?p(Error(`No addresses resolved for port ${e}`),0):(s=(0,c.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),p(Error(r),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,_,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof r&&!!r.startsWith("application/grpc")||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a)return void this._respondWithError(v(n),e,r);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n)return void this._respondWithError(v(r),e,null);let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!=(n=i.get("grpc-encoding")[0])?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)S(e,t,i,s);else if("clientStream"===a)C(e,t,i,s);else if("serverStream"===a)w(e,t,i,s);else{if("bidi"!==a)return!1;T(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started)return void e.destroy();let o=(0,h.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let c=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+c),this.sessionChildrenTracker.refChild(o));let u=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;u=null==(i=(r=setTimeout(()=>{var t,r;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+c);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null==(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(r)}let m=null==(a=(s=setInterval(()=>{var t,r;let n=null==(r=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+c),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+c),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),u&&clearTimeout(u),f&&clearTimeout(f),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function S(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function C(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function T(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}r.Server=b},75347,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}r.StatusBuilder=n},27005,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDuration=r.durationToMs=r.msToDuration=void 0,r.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},r.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},r.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},87591,(e,t,r)=>{"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.OutlierDetectionLoadBalancer=r.OutlierDetectionLoadBalancingConfig=void 0;let i=e.r(95653),s=e.r(37294),a=e.r(27005),o=e.r(62746),l=e.r(24521),c=e.r(6279),u=e.r(87080),h=e.r(46801),d=e.r(36927),f=e.r(91200),p="outlier_detection";function m(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let g="outlier_detection",y=(null!=(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},_={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function b(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function S(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function C(e,t,r){let n=r?`${r}.${t}`:t;if(b(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class w{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},_),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(S(e,"interval"),S(e,"base_ejection_time"),S(e,"max_ejection_time"),C(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");b(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),C(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),b(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),b(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");C(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),C(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),b(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),b(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}r.OutlierDetectionLoadBalancingConfig=w;class T extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function E(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=E(),this.inactiveBucket=E()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=E()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class k{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==u.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null==(n=t.onCallEnded)||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class R{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new c.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new T(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new k(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if((m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(r=(t=this.ejectionTimer).unref)||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof w))return;let n=new Set;for(let t of e)n.add((0,h.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}r.OutlierDetectionLoadBalancer=R,r.setup=function(){y&&(0,o.registerLoadBalancerType)(g,R,w)}},62746,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OutlierDetectionLoadBalancingConfig=r.BaseSubchannelWrapper=r.registerAdminService=r.FilterStackFactory=r.BaseFilter=r.PickResultType=r.QueuePicker=r.UnavailablePicker=r.ChildLoadBalancerHandler=r.subchannelAddressToString=r.validateLoadBalancingConfig=r.getFirstUsableConfig=r.registerLoadBalancerType=r.createChildChannelControlHelper=r.BackoffTimeout=r.durationToMs=r.uriToString=r.createResolver=r.registerResolver=r.log=r.trace=void 0;var n=e.r(91200);Object.defineProperty(r,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(r,"log",{enumerable:!0,get:function(){return n.log}});var i=e.r(23359);Object.defineProperty(r,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(r,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=e.r(28835);Object.defineProperty(r,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=e.r(27005);Object.defineProperty(r,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=e.r(38644);Object.defineProperty(r,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=e.r(24521);Object.defineProperty(r,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(r,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(r,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(r,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var c=e.r(46801);Object.defineProperty(r,"subchannelAddressToString",{enumerable:!0,get:function(){return c.subchannelAddressToString}});var u=e.r(6279);Object.defineProperty(r,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return u.ChildLoadBalancerHandler}});var h=e.r(87080);Object.defineProperty(r,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(r,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(r,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=e.r(74e3);Object.defineProperty(r,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=e.r(31702);Object.defineProperty(r,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=e.r(81800);Object.defineProperty(r,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var m=e.r(36927);Object.defineProperty(r,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=e.r(87591);Object.defineProperty(r,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},87988,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(23359);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}r.setup=function(){(0,n.registerResolver)("unix",i)}},22268,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=void 0;let n=e.r(4446),i=e.r(37294),s=e.r(73155),a=e.r(23359),o=e.r(28835),l=e.r(91200),c="ip_resolver";function u(e){l.trace(i.LogVerbosity.DEBUG,c,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,u("Resolver constructed for target "+(0,o.uriToString)(e));const l=[];if(e.scheme!==h&&e.scheme!==d){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(const t of e.path.split(",")){const r=(0,o.splitHostPort)(t);if(null===r||e.scheme===h&&!(0,n.isIPv4)(r.host)||e.scheme===d&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!=(a=r.port)?a:f})}this.addresses=l,u("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}r.setup=function(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}},36980,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.PickFirstLoadBalancer=r.shuffled=r.PickFirstLoadBalancingConfig=void 0;let n=e.r(24521),i=e.r(95653),s=e.r(87080),a=e.r(91200),o=e.r(37294),l="pick_first";function c(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let u="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return u}toJsonObject(){return{[u]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}r.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}r.shuffled=p;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(c("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(c("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=p(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return u}}r.PickFirstLoadBalancer=m,r.setup=function(){(0,n.registerLoadBalancerType)(u,m,d),(0,n.registerDefaultLoadBalancerType)(u)}},43250,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.setup=r.RoundRobinLoadBalancer=void 0;let n=e.r(24521),i=e.r(95653),s=e.r(87080),a=e.r(46801),o=e.r(91200),l=e.r(37294),c="round_robin";function u(e){o.trace(l.LogVerbosity.DEBUG,c,e)}let h="round_robin";class d{getLoadBalancerName(){return h}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),u("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}r.RoundRobinLoadBalancer=p,r.setup=function(){(0,n.registerLoadBalancerType)(h,p,d)}},48834,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.experimental=r.addAdminServicesToServer=r.getChannelzHandlers=r.getChannelzServiceDefinition=r.InterceptorConfigurationError=r.InterceptingCall=r.RequesterBuilder=r.ListenerBuilder=r.StatusBuilder=r.getClientChannel=r.ServerCredentials=r.Server=r.setLogVerbosity=r.setLogger=r.load=r.loadObject=r.CallCredentials=r.ChannelCredentials=r.waitForClientReady=r.closeClient=r.Channel=r.makeGenericClientConstructor=r.makeClientConstructor=r.loadPackageDefinition=r.Client=r.compressionAlgorithms=r.propagate=r.connectivityState=r.status=r.logVerbosity=r.Metadata=r.credentials=void 0;let n=e.r(31364);Object.defineProperty(r,"CallCredentials",{enumerable:!0,get:function(){return n.CallCredentials}});let i=e.r(75917);Object.defineProperty(r,"Channel",{enumerable:!0,get:function(){return i.ChannelImplementation}});let s=e.r(43138);Object.defineProperty(r,"compressionAlgorithms",{enumerable:!0,get:function(){return s.CompressionAlgorithms}});let a=e.r(95653);Object.defineProperty(r,"connectivityState",{enumerable:!0,get:function(){return a.ConnectivityState}});let o=e.r(83106);Object.defineProperty(r,"ChannelCredentials",{enumerable:!0,get:function(){return o.ChannelCredentials}});let l=e.r(4681);Object.defineProperty(r,"Client",{enumerable:!0,get:function(){return l.Client}});let c=e.r(37294);Object.defineProperty(r,"logVerbosity",{enumerable:!0,get:function(){return c.LogVerbosity}}),Object.defineProperty(r,"status",{enumerable:!0,get:function(){return c.Status}}),Object.defineProperty(r,"propagate",{enumerable:!0,get:function(){return c.Propagate}});let u=e.r(91200),h=e.r(55779);Object.defineProperty(r,"loadPackageDefinition",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),Object.defineProperty(r,"makeClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}}),Object.defineProperty(r,"makeGenericClientConstructor",{enumerable:!0,get:function(){return h.makeClientConstructor}});let d=e.r(73155);Object.defineProperty(r,"Metadata",{enumerable:!0,get:function(){return d.Metadata}});let f=e.r(2622);Object.defineProperty(r,"Server",{enumerable:!0,get:function(){return f.Server}});let p=e.r(1255);Object.defineProperty(r,"ServerCredentials",{enumerable:!0,get:function(){return p.ServerCredentials}});let m=e.r(75347);Object.defineProperty(r,"StatusBuilder",{enumerable:!0,get:function(){return m.StatusBuilder}}),r.credentials={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},r.closeClient=e=>e.close(),r.waitForClientReady=(e,t,r)=>e.waitForReady(t,r),r.loadObject=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.load=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},r.setLogger=e=>{u.setLogger(e)},r.setLogVerbosity=e=>{u.setLoggerVerbosity(e)},r.getClientChannel=e=>l.Client.prototype.getChannel.call(e);var g=e.r(89452);Object.defineProperty(r,"ListenerBuilder",{enumerable:!0,get:function(){return g.ListenerBuilder}}),Object.defineProperty(r,"RequesterBuilder",{enumerable:!0,get:function(){return g.RequesterBuilder}}),Object.defineProperty(r,"InterceptingCall",{enumerable:!0,get:function(){return g.InterceptingCall}}),Object.defineProperty(r,"InterceptorConfigurationError",{enumerable:!0,get:function(){return g.InterceptorConfigurationError}});var y=e.r(54312);Object.defineProperty(r,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return y.getChannelzServiceDefinition}}),Object.defineProperty(r,"getChannelzHandlers",{enumerable:!0,get:function(){return y.getChannelzHandlers}});var v=e.r(81800);Object.defineProperty(r,"addAdminServicesToServer",{enumerable:!0,get:function(){return v.addAdminServicesToServer}}),r.experimental=e.r(62746);let _=e.r(60702),b=e.r(87988),S=e.r(22268),C=e.r(36980),w=e.r(43250),T=e.r(87591),E=e.r(54312);(()=>{_.setup(),b.setup(),S.setup(),C.setup(),w.setup(),T.setup(),E.setup()})()},23469,(e,t,r)=>{var n=e.r(874),i=n.Buffer;function s(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(s(n,r),r.Buffer=a),a.prototype=Object.create(i.prototype),s(i,a),a.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},1357,(e,t,r)=>{"use strict";var n=e.r(88947).Stream,i=e.r(24361),s=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(s,n),s.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},s.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},s.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},s.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},s.prototype.destroy=function(){this.end()};var a=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};i.inherits(a,n),a.prototype.pause=function(){this._driver.io._paused=!0},a.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},a.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},a.prototype.end=function(e){void 0!==e&&this.write(e)},a.prototype.destroy=function(){},r.IO=s,r.Messages=a},77390,(e,t,r)=>{"use strict";var n=function(){this.clear()};n.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],n.prototype.clear=function(){this._sent={},this._lines=[]},n.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var r=e.toLowerCase();(!this._sent.hasOwnProperty(r)||this.ALLOWED_DUPLICATES.indexOf(r)>=0)&&(this._sent[r]=!0,this._lines.push(e+": "+t+"\r\n"))}},n.prototype.toString=function(){return this._lines.join("")},n.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")},t.exports=n},57104,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=function(){this._queue=[],this._queueSize=0,this._offset=0};i.prototype.put=function(e){e&&0!==e.length&&(n.isBuffer(e)||(e=n.from(e)),this._queue.push(e),this._queueSize+=e.length)},i.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return n.alloc(0);this._queueSize-=e;var t,r,i=this._queue,s=e,a=i[0];if(a.length>=e)if(a.length===e)return i.shift();else return r=a.slice(0,e),i[0]=a.slice(e),r;for(var o=0,l=i.length;o<l&&!(s<i[o].length);o++)s-=i[o].length;return t=i.splice(0,o),s>0&&i.length>0&&(t.push(i[0].slice(0,s)),i[0]=i[0].slice(s)),n.concat(t,e)},i.prototype.eachByte=function(e,t){for(var r,n,i;this._queue.length>0;){for(n=(r=this._queue[0]).length;this._offset<n;)i=this._offset,this._offset+=1,e.call(t,r[i]);this._offset=0,this._queue.shift()}},t.exports=i},26769,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=e.r(27699).EventEmitter,s=e.r(24361),a=e.r(1357),o=e.r(77390),l=e.r(57104),c=function(e,t,r){i.call(this),c.validateOptions(r||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new l,this._options=r||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new o,this.__queue=[],this.readyState=0,this.url=t,this.io=new a.IO(this),this.messages=new a.Messages(this),this._bindEventListeners()};s.inherits(c,i),c.isWebSocket=function(e){var t=e.headers.connection||"",r=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===r.toLowerCase()},c.validateOptions=function(e,t){for(var r in e)if(0>t.indexOf(r))throw Error("Unrecognized option: "+r)};var u={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var r=e.messages;r.readable&&r.emit("data",t.data)}),this.on("error",function(t){var r=e.messages;r.readable&&r.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!c.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new o;return t.set("Content-Type","text/plain"),t.set("Content-Length",n.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(n.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new c.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new c.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var h in u)c.prototype[h]=u[h];c.ConnectEvent=function(){},c.OpenEvent=function(){},c.CloseEvent=function(e,t){this.code=e,this.reason=t},c.MessageEvent=function(e){this.data=e},c.PingEvent=function(e){this.data=e},c.PongEvent=function(e){this.data=e},t.exports=c},7897,(e,t,r)=>{function n(e){if(void 0!==e&&e!==n.REQUEST&&e!==n.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===e||this.initialize(e),this.maxHeaderSize=n.maxHeaderSize}r.HTTPParser=n,n.prototype.initialize=function(e,t){if(e!==n.REQUEST&&e!==n.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},n.encoding="ascii",n.maxHeaderSize=81920,n.REQUEST="REQUEST",n.RESPONSE="RESPONSE";var i=n.kOnHeaders=1,s=n.kOnHeadersComplete=2,a=n.kOnBody=3,o=n.kOnMessageComplete=4;n.prototype[i]=n.prototype[s]=n.prototype[a]=n.prototype[o]=function(){};var l=!0;Object.defineProperty(n,"kOnExecute",{get:function(){return l=!1,99}});var c=r.methods=n.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],u=c.indexOf("CONNECT");n.prototype.reinitialize=n,n.prototype.close=n.prototype.pause=n.prototype.resume=n.prototype.remove=n.prototype.free=function(){},n.prototype._compatMode0_11=!1,n.prototype.getAsyncId=function(){return 0};var h={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};n.prototype.execute=function(e,t,r){if(!(this instanceof n))throw TypeError("not a HTTPParser");t=t||0,r="number"==typeof r?r:e.length,this.chunk=e,this.offset=t;var i=this.end=t+r;try{for(;this.offset<i&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,r=this.offset-t,h[this.state]&&(this.headerSize+=r,this.headerSize>(this.maxHeaderSize||n.maxHeaderSize)))?Error("max header size exceeded"):r};var d={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};n.prototype.finish=function(){if(!this.hadError){if(!d[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[o]())}},n.prototype.consume=n.prototype.unconsume=n.prototype.getCurrentBuffer=function(){},n.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},n.prototype.nextRequest=function(){this.userCall()(this[o]()),this.reinitialize(this.type)},n.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,r=this.offset;r<e;r++)if(10===t[r]){var i=this.line+t.toString(n.encoding,this.offset,r);return"\r"===i.charAt(i.length-1)&&(i=i.substr(0,i.length-1)),this.line="",this.offset=r+1,i}this.line+=t.toString(n.encoding,this.offset,this.end),this.offset=this.end};var f=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,p=/^[ \t]+(.*[^ \t])/;n.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw y("HPE_LF_EXPECTED");var r=f.exec(e),n=r&&r[1];if(n)t.push(n),t.push(r[2]);else{var i=p.exec(e);i&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=i[1])}};var m=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;n.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=m.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:c.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var g=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function y(e){var t=Error("Parse Error");return t.code=e,t}n.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=g.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var r=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((r/100|0)==1||204===r||304===r)&&(this.body_bytes=0),this.state="HEADER"}},n.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},n.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var r,i,a=t.headers,o=!1,c=!1,h=0;h<a.length;h+=2)switch(a[h].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===a[h+1].toLowerCase();break;case"content-length":if(r=+a[h+1],o){if(r!==this.body_bytes)throw y("HPE_UNEXPECTED_CONTENT_LENGTH")}else o=!0,this.body_bytes=r;break;case"connection":this.connection+=a[h+1].toLowerCase();break;case"upgrade":c=!0}if(this.isChunked&&o&&(o=!1,this.body_bytes=null),c&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===n.REQUEST||101===t.statusCode:t.upgrade=t.method===u,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(i=l?this.userCall()(this[s](t)):this.userCall()(this[s](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!i)this.state="BODY_CHUNKHEAD";else{if(i||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},n.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},n.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},n.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();if(void 0!==e){if(""!==e)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},n.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[i](this.trailers,"")),this.nextRequest()))},n.prototype.BODY_RAW=function(){this.userCall()(this[a](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},n.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk.slice(this.offset,this.offset+e),0,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=n["kOn"+e];Object.defineProperty(n.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,u="CONNECT",this[t]=e}})})},43176,(e,t,r)=>{"use strict";var n=e.r(7897).HTTPParser,i=e.r(23469).Buffer,s={request:n.REQUEST||"request",response:n.RESPONSE||"response"},a=function(e){this._type=e,this._parser=new n(s[e]),this._complete=!1,this.headers={};var t=null,r=this;this._parser.onHeaderField=function(e,r,n){t=e.toString("utf8",r,r+n).toLowerCase()},this._parser.onHeaderValue=function(e,n,i){var s=e.toString("utf8",n,n+i);r.headers.hasOwnProperty(t)?r.headers[t]+=", "+s:r.headers[t]=s},this._parser.onHeadersComplete=this._parser[n.kOnHeadersComplete]=function(e,t,n,i,s,o){var l=arguments[0];if("object"==typeof l&&(i=l.method,s=l.url,o=l.statusCode,n=l.headers),r.method="number"==typeof i?a.METHODS[i]:i,r.statusCode=o,r.url=s,n){for(var c,u,h=0,d=n.length;h<d;h+=2)c=n[h].toLowerCase(),u=n[h+1],r.headers.hasOwnProperty(c)?r.headers[c]+=", "+u:r.headers[c]=u;r._complete=!0}}};a.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var o=process.version?process.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===o[0]&&12===o[1]&&(a.METHODS[16]="REPORT",a.METHODS[17]="MKACTIVITY",a.METHODS[18]="CHECKOUT",a.METHODS[19]="MERGE",a.METHODS[20]="M-SEARCH",a.METHODS[21]="NOTIFY",a.METHODS[22]="SUBSCRIBE",a.METHODS[23]="UNSUBSCRIBE",a.METHODS[24]="PATCH",a.METHODS[25]="PURGE"),a.prototype.isComplete=function(){return this._complete},a.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):i.alloc(0))},t.exports=a},66334,(e,t,r)=>{"use strict";var n=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,i=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,s=RegExp(n.source+"(?:=(?:"+n.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),a=RegExp(n.source+"(?: *; *"+s.source+")*","g"),o=RegExp("^"+a.source+"(?: *, *"+a.source+")*$"),l=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,c=Object.prototype.hasOwnProperty,u={parseHeader:function(e){var t=new h;if(""===e||void 0===e)return t;if(!o.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(a).forEach(function(e){var r=e.match(RegExp(s.source,"g")),n=r.shift(),i={};r.forEach(function(e){var t,r=e.match(s),n=r[1];t=void 0!==r[2]?r[2]:void 0===r[3]||r[3].replace(/\\/g,""),l.test(t)&&(t=parseFloat(t)),c.call(i,n)?(i[n]=[].concat(i[n]),i[n].push(t)):i[n]=t},this),t.push(n,i)},this),t},serializeParams:function(e,t){var r=[],n=function(e,t){t instanceof Array?t.forEach(function(t){n(e,t)}):!0===t?r.push(e):"number"==typeof t?r.push(e+"="+t):i.test(t)?r.push(e+'="'+t.replace(/"/g,'\\"')+'"'):r.push(e+"="+t)};for(var s in t)n(s,t[s]);return[e].concat(r).join("; ")}},h=function(){this._byName={},this._inOrder=[]};h.prototype.push=function(e,t){c.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},h.prototype.eachOffer=function(e,t){for(var r=this._inOrder,n=0,i=r.length;n<i;n++)e.call(t,r[n].name,r[n].params)},h.prototype.byName=function(e){return this._byName[e]||[]},h.prototype.toArray=function(){return this._inOrder.slice()},t.exports=u},62993,(e,t,r)=>{"use strict";var n=function(e){this._bufferSize=e,this.clear()};n.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},n.prototype.push=function(e){var t=!1,r=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,r=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,r&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},n.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},n.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}},t.exports=n},28396,(e,t,r)=>{"use strict";var n=e.r(62993),i=function(e,t){this._session=e,this._method=t,this._queue=new n(i.QUEUE_SIZE),this._stopped=!1,this.pending=0};i.QUEUE_SIZE=8,i.prototype.call=function(e,t,r,n){if(!this._stopped){var i={error:e,message:t,callback:r,context:n,done:!1},s=!1,a=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var o=function(e,t){s^(s=!0)&&(e?(a._stop(),i.error=e,i.message=null):i.message=t,i.done=!0,a._flushQueue())};try{this._session[this._method](t,o)}catch(e){o(e)}}},i.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},i.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)},t.exports=i},77196,(e,t,r)=>{"use strict";var n=e.r(62993),i=function(){this._complete=!1,this._callbacks=new n(i.QUEUE_SIZE)};i.QUEUE_SIZE=4,i.all=function(e){var t=new i,r=e.length,n=r;for(0===r&&t.done();n--;)e[n].then(function(){0==(r-=1)&&t.done()});return t},i.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},i.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()},t.exports=i},63447,(e,t,r)=>{"use strict";var n=e.r(28396),i=e.r(77196),s=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new n(this._session,"processIncomingMessage"),outgoing:new n(this._session,"processOutgoingMessage")}};s.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},s.prototype.incoming=function(e,t,r,n){this._exec("incoming",e,t,r,n)},s.prototype.outgoing=function(e,t,r,n){this._exec("outgoing",e,t,r,n)},s.prototype.close=function(){return this._closed=this._closed||new i,this._doClose(),this._closed},s.prototype._exec=function(e,t,r,n,i){this._functors[e].call(t,r,function(e,t){e&&(e.message=this._ext.name+": "+e.message),n.call(i,e,t),this._doClose()},this)},s.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},t.exports=s},16174,(e,t,r)=>{"use strict";var n=e.r(63447),i=e.r(77196),s=function(e){this._cells=e.map(function(e){return new n(e)}),this._stopped={incoming:!1,outgoing:!1}};s.prototype.processIncomingMessage=function(e,t,r){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,r)},s.prototype.processOutgoingMessage=function(e,t,r){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,r)},s.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var r=this._cells.map(function(e){return e.close()});e&&i.all(r).then(function(){e.call(t)})},s.prototype._loop=function(e,t,r,n,i,s,a){for(var o=this._cells,l=o.length,c=this;l--;)o[l].pending(e);var u=function(t,i,l){if(t===r)return s.call(a,i,l);o[t][e](i,l,function(r,i){r&&(c._stopped[e]=!0),u(t+n,r,i)})};u(t,null,i)},t.exports=s},10412,(e,t,r)=>{"use strict";var n=e.r(66334),i=e.r(16174),s=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};s.MESSAGE_OPCODES=[1,2];var a={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],r={};return this._inOrder.forEach(function(i){var s=i.createClientSession();if(s){var a=[i,s];e.push(a),r[i.name]=a;var o=s.generateOffer();o=o?[].concat(o):[],o.forEach(function(e){t.push(n.serializeParams(i.name,e))},this)}},this),this._sessions=e,this._index=r,t.length>0?t.join(", "):null},activate:function(e){var t=n.parseHeader(e),r=[];t.eachOffer(function(e,t){var i=this._index[e];if(!i)throw Error('Server sent an extension response for unknown extension "'+e+'"');var s=i[0],a=i[1],o=this._reserved(s);if(o)throw Error("Server sent two extension responses that use the RSV"+o[0]+' bit: "'+o[1]+'" and "'+s.name+'"');if(!0!==a.activate(t))throw Error("Server sent unacceptable extension parameters: "+n.serializeParams(e,t));this._reserve(s),r.push(i)},this),this._sessions=r,this._pipeline=new i(r)},generateResponse:function(e){var t=[],r=[],s=n.parseHeader(e);return this._inOrder.forEach(function(e){var i=s.byName(e.name);if(!(0===i.length||this._reserved(e))){var a=e.createServerSession(i);a&&(this._reserve(e),t.push([e,a]),r.push(n.serializeParams(e.name,a.generateResponse())))}},this),this._sessions=t,this._pipeline=new i(t),r.length>0?r.join(", "):null},validFrameRsv:function(e){var t,r={rsv1:!1,rsv2:!1,rsv3:!1};if(s.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var n=0,i=this._sessions.length;n<i;n++)t=this._sessions[n][0],r.rsv1=r.rsv1||t.rsv1,r.rsv2=r.rsv2||t.rsv2,r.rsv3=r.rsv3||t.rsv3;return(r.rsv1||!e.rsv1)&&(r.rsv2||!e.rsv2)&&(r.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,r){this._pipeline.processIncomingMessage(e,t,r)},processOutgoingMessage:function(e,t,r){this._pipeline.processOutgoingMessage(e,t,r)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var o in a)s.prototype[o]=a[o];t.exports=s},85530,(e,t,r)=>{"use strict";var n=function(){},i={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var s in i)n.prototype[s]=i[s];t.exports=n},52190,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},s={read:function(){return this.data=this.data||n.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var a in s)i.prototype[a]=s[a];t.exports=i},93177,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=e.r(54799),s=e.r(24361),a=e.r(10412),o=e.r(26769),l=e.r(85530),c=e.r(52190),u=function(e,t,r){if(o.apply(this,arguments),this._extensions=new a,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var n=this._request.headers["sec-websocket-protocol"],i=this._protocols;void 0!==n&&("string"==typeof n&&(n=n.split(/ *, */)),this.protocol=n.filter(function(e){return i.indexOf(e)>=0})[0]),this.version="hybi-"+u.VERSION}};s.inherits(u,o),u.VERSION="13",u.mask=function(e,t,r){if(!t||0===t.length)return e;r=r||0;for(var n=0,i=e.length-r;n<i;n++)e[r+n]=e[r+n]^t[n%4];return e},u.generateAccept=function(e){var t=i.createHash("sha1");return t.update(e+u.GUID),t.digest("base64")},u.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var h={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new o.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,r){if(this.readyState<=0)return this._queue([e,t,r]);if(this.readyState>2)return!1;e instanceof Array&&(e=n.from(e)),"number"==typeof e&&(e=e.toString());var s,a,o=new c,u="string"==typeof e;o.rsv1=o.rsv2=o.rsv3=!1,o.opcode=this.OPCODES[t||(u?"text":"binary")],s=u?n.from(e,"utf8"):e,r&&(a=s,(s=n.allocUnsafe(2+a.length)).writeUInt16BE(r,0),a.copy(s,2)),o.data=s;var h=function(e){var t=new l;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=i.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(o.opcode)>=0?this._extensions.processOutgoingMessage(o,function(e,t){if(e)return this._fail("extension_error",e.message);h.call(this,t)},this):h.call(this,o),!0},_sendFrame:function(e){var t=e.length,r=t<=125?2:t<=65535?4:10,i=r+4*!!e.masked,s=n.allocUnsafe(i+t),a=e.masked?this.MASK:0;s[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?s[1]=a|t:t<=65535?(s[1]=126|a,s.writeUInt16BE(t,2)):(s[1]=127|a,s.writeUInt32BE(Math.floor(t/0x100000000),2),s.writeUInt32BE(t%0x100000000,6)),e.payload.copy(s,i),e.masked&&(e.maskingKey.copy(s,r),u.mask(s,e.maskingKey,i)),this._write(s)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==u.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",u.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var r=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);r&&this._headers.set("Sec-WebSocket-Extensions",r);var i=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return n.from(i.join("\r\n"),"utf8")},_shutdown:function(e,t,r){delete this._frame,delete this._message,this._stage=5;var n=1===this.readyState;this.readyState=2,this._extensions.close(function(){n&&this.frame(t,"close",e),this.readyState=3,r&&this.emit("error",Error(t)),this.emit("close",new o.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),r=this._frame=new l;return(r.final=(e&this.FIN)===this.FIN,r.rsv1=t[0],r.rsv2=t[1],r.rsv3=t[2],r.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(r))?0>this.OPCODE_CODES.indexOf(r.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+r.opcode):0>this.MESSAGE_OPCODES.indexOf(r.opcode)&&!r.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+r.opcode):this._message&&this.OPENING_OPCODES.indexOf(r.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!r.rsv1+", reserved2 = "+ +!!r.rsv2+", reserved3 = "+ +!!r.rsv3)},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,r,n,i,s,a=this._frame,l=a.payload=u.mask(e,a.maskingKey),h=a.opcode;if(delete this._frame,h===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(a)}if((h===this.OPCODES.text||h===this.OPCODES.binary)&&(this._message=new c,this._message.pushFrame(a)),a.final&&this.MESSAGE_OPCODES.indexOf(h)>=0)return this._emitMessage(this._message);h===this.OPCODES.close&&(r=l.length>=2?l.readUInt16BE(0):null,n=l.length>2?this._encode(l.slice(2)):null,0!==l.length&&!(null!==r&&r>=this.MIN_RESERVED_ERROR&&r<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(r)&&(r=this.ERRORS.protocol_error),(l.length>125||l.length>2&&!n)&&(r=this.ERRORS.protocol_error),this._shutdown(r||this.DEFAULT_ERROR_CODE,n||"")),h===this.OPCODES.ping&&(this.frame(l,"pong"),this.emit("ping",new o.PingEvent(l.toString()))),h===this.OPCODES.pong&&(s=(i=this._pingCallbacks)[t=this._encode(l)],delete i[t],s&&s(),this.emit("pong",new o.PongEvent(l.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var r=t.data;if(t.opcode===this.OPCODES.text&&(r=this._encode(r)),null===r)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new o.MessageEvent(r))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):0x100000000*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var d in h)u.prototype[d]=h[d];t.exports=u},28128,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=e.r(88947).Stream,s=e.r(92509),a=e.r(24361),o=e.r(26769),l=e.r(77390),c=e.r(43176),u={"ws:":80,"wss:":443},h=function(e,t,r){this._client=e,this._http=new c("response"),this._origin="object"==typeof e.url?e.url:s.parse(e.url),this._url="object"==typeof t?t:s.parse(t),this._options=r||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new l,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&n.from(this._url.auth,"utf8").toString("base64");i&&this._headers.set("Proxy-Authorization","Basic "+i)};a.inherits(h,i);var d={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||u[e.protocol],r=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",n.from(r.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new o.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var f in d)h.prototype[f]=d[f];t.exports=h},22667,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=e.r(54799),s=e.r(92509),a=e.r(24361),o=e.r(43176),l=e.r(26769),c=e.r(93177),u=e.r(28128),h=function(e,t){this.version="hybi-"+c.VERSION,c.call(this,null,e,t),this.readyState=-1,this._key=h.generateKey(),this._accept=c.generateAccept(this._key),this._http=new o("response");var r=s.parse(this.url),i=r.auth&&n.from(r.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(r.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(r.pathname||"/")+(r.search||""),this._headers.set("Host",r.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",c.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),i&&this._headers.set("Authorization","Basic "+i)};a.inherits(h,c),h.generateKey=function(){return i.randomBytes(16).toString("base64")};var d={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new u(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){return 3===this.readyState?void 0:this.readyState>0?c.prototype.parse.call(this,e):(this._http.parse(e),this._http.isComplete())?void(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body))):void 0},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return n.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new l.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",r=e.connection||"",n=e["sec-websocket-accept"]||"",i=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===r)return this._failHandshake("'Connection' header is missing");if("upgrade"!==r.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(n!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==i)if(0>this._protocols.indexOf(i))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=i;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var f in d)h.prototype[f]=d[f];t.exports=h},85861,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=e.r(26769),s=e.r(24361),a=function(e,t,r){i.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};s.inherits(a,i);var o={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=n.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new i.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=n.byteLength(e),r=n.allocUnsafe(t+2);return r[0]=0,r.write(e,1),r[r.length-1]=255,this._write(r),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return n.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var l in o)a.prototype[l]=o[l];t.exports=a},74398,(e,t,r)=>{"use strict";var n=e.r(23469).Buffer,i=e.r(26769),s=e.r(85861),a=e.r(54799),o=e.r(24361),l=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},c=function(e){return(e.match(/ /g)||[]).length},u=function(e,t,r){s.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};o.inherits(u,s);var h={BODY_SIZE:8,start:function(){return!!s.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(n.from([255,0])),this.readyState=3,this.emit("close",new i.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],r=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!r)throw Error("Missing required header: Sec-WebSocket-Key2");var i=l(t),s=c(t),a=l(r),o=c(r);if(i%s!=0||a%o!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[i/s,a/o];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return n.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=a.createHash("md5"),t=n.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),n.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),n.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return s.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var d in h)u.prototype[d]=h[d];t.exports=u},71810,(e,t,r)=>{"use strict";var n=e.r(24361),i=e.r(43176),s=e.r(26769),a=e.r(85861),o=e.r(74398),l=e.r(93177),c=function(e){s.call(this,null,null,e),this._http=new i("request")};n.inherits(c,s);var u={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=c.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(r){t.emit(e,r)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new s.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var h in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){u[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),u)c.prototype[h]=u[h];c.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},c.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},c.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var r=e.headers,n=r["sec-websocket-version"],i=r["sec-websocket-key"],s=r["sec-websocket-key1"],c=r["sec-websocket-key2"],u=this.determineUrl(e);return n||i?new l(e,u,t):s||c?new o(e,u,t):new a(e,u,t)},t.exports=c},12350,(e,t,r)=>{"use strict";var n=e.r(26769),i=e.r(22667),s=e.r(71810);t.exports={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new i(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new s(e)},http:function(){return s.http.apply(s,arguments)},isSecureRequest:function(e){return s.isSecureRequest(e)},isWebSocket:function(e){return n.isWebSocket(e)},validateOptions:function(e,t){n.validateOptions(e,t)}}},75615,(e,t,r)=>{"use strict";var n=function(e,t){for(var r in this.type=e,t)this[r]=t[r]};n.prototype.initEvent=function(e,t,r){this.type=e,this.bubbles=t,this.cancelable=r},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,t.exports=n},35338,(e,t,r)=>{"use strict";var n=e.r(75615);t.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,r){this.on(e,t)},removeEventListener:function(e,t,r){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=n.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}}},55051,(e,t,r)=>{"use strict";var n=e.r(88947).Stream,i=e.r(24361),s=e.r(12350),a=e.r(35338),o=e.r(75615),l=function(e){e=e||{},s.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var r in t)this._driver.setHeader(r,t[r]);var n=e.extensions;n&&[].concat(n).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=l.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(e){i._open()}),this._driver.on("message",function(e){i._receiveMessage(e.data)}),this._driver.on("close",function(e){i._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){i._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};i.inherits(l,n),l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l.CLOSE_TIMEOUT=3e4;var c={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>l.OPEN)&&(e instanceof Buffer||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>l.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<l.CLOSING){var r=this;this._closeTimer=setTimeout(function(){r._beginClose("",1006)},l.CLOSE_TIMEOUT)}this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===l.CONNECTING){this.readyState=l.OPEN,this.protocol=this._driver.protocol||"";var e=new o("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>l.OPEN)return!1;this.readable&&this.emit("data",e);var t=new o("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=l.CLOSING)){var t=new o("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==l.CLOSED){this.readyState=l.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=this._closeParams?this._closeParams[1]:1006,r=new o("close",{code:t,reason:e});r.initEvent("close",!1,!1),this.dispatchEvent(r)}}};for(var u in c)l.prototype[u]=c[u];for(var h in a)l.prototype[h]=a[h];t.exports=l},11237,(e,t,r)=>{"use strict";var n=e.r(24361),i=e.r(4446),s=e.r(55004),a=e.r(92509),o=e.r(12350),l=e.r(55051);e.r(75615);var c={"http:":80,"https:":443,"ws:":80,"wss:":443},u=["https:","wss:"],h=function(e,t,r){r=r||{},this.url=e,this._driver=o.client(this.url,{maxLength:r.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){v.headers=v._driver.headers,v.statusCode=v._driver.statusCode})},this);var n=r.proxy||{},h=a.parse(n.origin||this.url),d=h.port||c[h.protocol],f=u.indexOf(h.protocol)>=0,p=function(){v._onConnect()},m=r.net||{},g=r.tls||{},y=n.origin?n.tls||{}:g,v=this;m.host=y.host=h.hostname,m.port=y.port=d,g.ca=g.ca||r.ca,y.servername=y.servername||h.hostname,this._stream=f?s.connect(y,p):i.connect(m,p),n.origin&&this._configureProxy(n,g),l.call(this,r)};n.inherits(h,l),h.prototype._onConnect=function(){(this._proxy||this._driver).start()},h.prototype._configureProxy=function(e,t){var r,n=a.parse(this.url),i=u.indexOf(n.protocol)>=0,o=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(r in e.headers)this._proxy.setHeader(r,e.headers[r]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var e={socket:o._stream,servername:n.hostname};for(r in t)e[r]=t[r];o._stream=s.connect(e),o._configureStream()}o._driver.io.pipe(o._stream),o._stream.pipe(o._driver.io),o._driver.start()}),this._proxy.on("error",function(e){o._driver.emit("error",e)})},t.exports=h},41663,(e,t,r)=>{"use strict";var n=e.r(88947).Stream,i=e.r(24361),s=e.r(12350),a=e.r(77390),o=e.r(55051),l=e.r(35338),c=e.r(75615),u=function(e,t,r){this.writable=!0,r=r||{},this._stream=t.socket,this._ping=r.ping||this.DEFAULT_PING,this._retry=r.retry||this.DEFAULT_RETRY;var n=s.isSecureRequest(e)?"https:":"http:";this.url=n+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=o.CONNECTING;var i=new a,l=this;if(r.headers)for(var c in r.headers)i.set(c,r.headers[c]);if(this._stream&&this._stream.writable){process.nextTick(function(){l._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var u="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+i.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(u),this._stream.on("drain",function(){l.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){l.ping()},1e3*this._ping)),["error","end"].forEach(function(e){l._stream.on(e,function(){l.close()})})}};i.inherits(u,n),u.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var h={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===o.CONNECTING){this.readyState=o.OPEN;var e=new c("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>o.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var r="";return(t=t||{}).event&&(r+="event: "+t.event+"\r\n"),t.id&&(r+="id: "+t.id+"\r\n"),r+="data: "+e+"\r\n\r\n",this._write(r)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>o.OPEN)return!1;this.readyState=o.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new c("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var d in h)u.prototype[d]=h[d];for(var f in l)u.prototype[f]=l[f];t.exports=u},51900,(e,t,r)=>{"use strict";var n=e.r(24361),i=e.r(12350),s=e.r(55051),a=function(e,t,r,n,a){a=a||{},this._stream=t,this._driver=i.http(e,{maxLength:a.maxLength,protocols:n});var o=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var l=function(){o._stream.removeListener("data",l)};this._stream.on("data",l),s.call(this,a),process.nextTick(function(){o._driver.start(),o._driver.io.write(r)})}};n.inherits(a,s),a.isWebSocket=function(e){return i.isWebSocket(e)},a.validateOptions=function(e,t){i.validateOptions(e,t)},a.WebSocket=a,a.Client=e.r(11237),a.EventSource=e.r(41663),t.exports=a},76038,e=>{"use strict";let t,r,n,i,s,a,o,l,c,u,h,d,f,p;var m,g,y,v,_,b,S,C,w=e.i(47909),T=e.i(74017),E=e.i(96250),I=e.i(59756),k=e.i(61916),R=e.i(74677),x=e.i(69741),O=e.i(16795),A=e.i(87718),D=e.i(95169),N=e.i(47587),P=e.i(66012),M=e.i(70101),L=e.i(26937),F=e.i(10372),B=e.i(93695);e.i(52474);var U=e.i(220),j=e.i(89171);let q=()=>void 0,V={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},z=function(e,t){if(!e)throw H(t)},H=function(e){return Error("Firebase Database ("+V.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},$=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},W=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},K={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=i>>2,u=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),n.push(r[c],r[u],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray($(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):W(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new G;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class G extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let Q=function(e){let t=$(e);return K.encodeByteArray(t,!0)},Y=function(e){return Q(e).replace(/\./g,"")},J=function(e){try{return K.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function X(e){return Z(void 0,e)}function Z(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(let r in t)t.hasOwnProperty(r)&&ee(r)&&(e[r]=Z(e[r],t[r]));return e}function ee(e){return"__proto__"!==e}function et(){return"u">typeof self?self:e.g}let er=()=>et().__FIREBASE_DEFAULTS__,en=()=>{if("u"<typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},ei=()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&J(e[1]);return t&&JSON.parse(t)},es=()=>{try{return q()||er()||en()||ei()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},ea=e=>es()?.emulatorHosts?.[e],eo=e=>{let t=ea(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},el=()=>es()?.config;class ec{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function eu(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function eh(e){return(await fetch(e,{credentials:"include"})).ok}function ed(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e},o="";return[Y(JSON.stringify(r)),Y(JSON.stringify(a)),o].join(".")}function ef(e,t){}function ep(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function em(){return!1}function eg(){let t=es()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function ey(){return ev()}function ev(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function e_(){return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function eb(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function eS(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function eC(){return!0===V.NODE_CLIENT||!0===V.NODE_ADMIN}function ew(){return!eg()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function eT(){return!eg()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function eE(){try{return"object"==typeof indexedDB}catch(e){return!1}}function eI(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}let ek="FirebaseError";class eR extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=ek,Object.setPrototypeOf(this,eR.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ex.prototype.create)}}class ex{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?eO(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new eR(n,a,r)}}function eO(e,t){return e.replace(eA,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let eA=/\{\$([^}]+)}/g;function eD(e){return JSON.parse(e)}function eN(e){return JSON.stringify(e)}let eP=function(e){let t={},r={},n={},i="";try{let s=e.split(".");t=eD(J(s[0])||""),r=eD(J(s[1])||""),i=s[2],n=r.d||{},delete r.d}catch(e){}return{header:t,claims:r,data:n,signature:i}},eM=function(e){let t=eP(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},eL=function(e){let t=eP(e).claims;return"object"==typeof t&&!0===t.admin};function eF(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eB(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eU(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ej(e,t,r){let n={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(r,e[i],i,e));return n}function eq(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(eV(r)&&eV(s)){if(!eq(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function eV(e){return null!==e&&"object"==typeof e}function ez(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function eH(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function e$(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class eW{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let r,n;t||(t=0);let i=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)i[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)i[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=l^a&(o^l),n=0x5a827999):(r=a^o^l,n=0x6ed9eba1):e<60?(r=a&o|l&(a|o),n=0x8f1bbcdc):(r=a^o^l,n=0xca62c1d6);let t=(s<<5|s>>>27)+r+c+n+i[e]|0;c=l,l=o,o=(a<<30|a>>>2)&0xffffffff,a=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+a|0,this.chain_[2]=this.chain_[2]+o|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+c|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let r=t-this.blockSize,n=0,i=this.buf_,s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=r;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let r=0;for(let t=0;t<5;t++)for(let n=24;n>=0;n-=8)e[r]=this.chain_[t]>>n&255,++r;return e}}function eK(e,t){let r=new eG(e,t);return r.subscribe.bind(r)}class eG{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=eQ(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=eY),void 0===n.error&&(n.error=eY),void 0===n.complete&&(n.complete=eY);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eQ(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function eY(){}function eJ(e,t){return`${e} failed: ${t} argument `}let eX=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){let t=i-55296;z(++n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},eZ=function(e){let t=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,r++):t+=3}return t};function e0(e){return e&&e._delegate?e._delegate:e}V.NODE_CLIENT=!0;class e1{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let e2="[DEFAULT]";class e3{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new ec;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(e4(e))try{this.getOrInitializeService({instanceIdentifier:e2})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=e2){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=e2){return this.instances.has(e)}getOptions(e=e2){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:e6(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=e2){return this.component?this.component.multipleInstances?e:e2:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function e6(e){return e===e2?void 0:e}function e4(e){return"EAGER"===e.instantiationMode}class e5{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new e3(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let e8=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(m||(m={}));let e7={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},e9=m.INFO,te={[m.DEBUG]:"log",[m.VERBOSE]:"log",[m.INFO]:"info",[m.WARN]:"warn",[m.ERROR]:"error"},tt=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=te[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class tr{constructor(e){this.name=e,this._logLevel=e9,this._logHandler=tt,this._userLogHandler=null,e8.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in m))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?e7[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,m.DEBUG,...e),this._logHandler(this,m.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,m.VERBOSE,...e),this._logHandler(this,m.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,m.INFO,...e),this._logHandler(this,m.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,m.WARN,...e),this._logHandler(this,m.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,m.ERROR,...e),this._logHandler(this,m.ERROR,...e)}}function tn(e){e8.forEach(t=>{t.setLogLevel(e)})}function ti(e,t){for(let r of e8){let n=null;t&&t.level&&(n=e7[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:m[r].toLowerCase(),message:s,args:i,type:t.name})}}}let ts=(e,t)=>t.some(t=>e instanceof t);function ta(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function to(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let tl=new WeakMap,tc=new WeakMap,tu=new WeakMap,th=new WeakMap,td=new WeakMap;function tf(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(t_(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&tl.set(t,e)}).catch(()=>{}),td.set(t,e),t}function tp(e){if(tc.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});tc.set(e,t)}let tm={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return tc.get(e);if("objectStoreNames"===t)return e.objectStoreNames||tu.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return t_(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function tg(e){tm=e(tm)}function ty(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?to().includes(e)?function(...t){return e.apply(tb(this),t),t_(tl.get(this))}:function(...t){return t_(e.apply(tb(this),t))}:function(t,...r){let n=e.call(tb(this),t,...r);return tu.set(n,t.sort?t.sort():[t]),t_(n)}}function tv(e){return"function"==typeof e?ty(e):(e instanceof IDBTransaction&&tp(e),ts(e,ta()))?new Proxy(e,tm):e}function t_(e){if(e instanceof IDBRequest)return tf(e);if(th.has(e))return th.get(e);let t=tv(e);return t!==e&&(th.set(e,t),td.set(t,e)),t}let tb=e=>td.get(e);function tS(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=t_(a);return n&&a.addEventListener("upgradeneeded",e=>{n(t_(a.result),e.oldVersion,e.newVersion,t_(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let tC=["get","getKey","getAll","getAllKeys","count"],tw=["put","add","delete","clear"],tT=new Map;function tE(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(tT.get(t))return tT.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=tw.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||tC.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return tT.set(t,s),s}tg(e=>({...e,get:(t,r,n)=>tE(t,r)||e.get(t,r,n),has:(t,r)=>!!tE(t,r)||e.has(t,r)}));class tI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!tk(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function tk(e){let t=e.getComponent();return t?.type==="VERSION"}let tR="@firebase/app",tx="0.14.8",tO=new tr("@firebase/app"),tA="12.9.0",tD="[DEFAULT]",tN={[tR]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tP=new Map,tM=new Map,tL=new Map;function tF(e,t){try{e.container.addComponent(t)}catch(r){tO.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function tB(e,t){e.container.addOrOverwriteComponent(t)}function tU(e){let t=e.name;if(tL.has(t))return tO.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(tL.set(t,e),tP.values()))tF(r,e);for(let t of tM.values())tF(t,e);return!0}function tj(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function tq(e,t,r=tD){tj(e,t).clearInstance(r)}function tV(e){return void 0!==e.options}function tz(e){return!tV(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tH(e){return null!=e&&void 0!==e.settings}function t$(){tL.clear()}let tW=new ex("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tK{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new e1("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tW.create("app-deleted",{appName:this._name})}}function tG(e,t){let r=J(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tQ extends tK{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&tG(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tG(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,t2(tR,tx,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){t1(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tW.create("server-app-deleted")}}let tY=tA;function tJ(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:tD,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw tW.create("bad-app-name",{appName:String(i)});if(r||(r=el()),!r)throw tW.create("no-options");let s=tP.get(i);if(s)if(eq(r,s.options)&&eq(n,s.config))return s;else throw tW.create("duplicate-app",{appName:i});let a=new e5(i);for(let e of tL.values())a.addComponent(e);let o=new tK(r,n,a);return tP.set(i,o),o}function tX(e,t={}){let r;if(ey()&&!ev())throw tW.create("invalid-server-app-environment");let n=t||{};if(e&&(tV(e)?r=e.options:tz(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=el()),!r)throw tW.create("no-options");let i={...n,...r};void 0!==i.releaseOnDeref&&delete i.releaseOnDeref;let s=e=>[...e].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0);if(void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw tW.create("finalization-registry-not-supported",{});let a=""+s(JSON.stringify(i)),o=tM.get(a);if(o)return o.incRefCount(n.releaseOnDeref),o;let l=new e5(a);for(let e of tL.values())l.addComponent(e);let c=new tQ(r,n,a,l);return tM.set(a,c),c}function tZ(e=tD){let t=tP.get(e);if(!t&&e===tD&&el())return tJ();if(!t)throw tW.create("no-app",{appName:e});return t}function t0(){return Array.from(tP.values())}async function t1(e){let t=!1,r=e.name;tP.has(r)?(t=!0,tP.delete(r)):tM.has(r)&&0>=e.decRefCount()&&(tM.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function t2(e,t,r){let n=tN[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),tO.warn(e.join(" "));return}tU(new e1(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function t3(e,t){if(null!==e&&"function"!=typeof e)throw tW.create("invalid-log-argument");ti(e,t)}function t6(e){tn(e)}let t4="firebase-heartbeat-database",t5=1,t8="firebase-heartbeat-store",t7=null;function t9(){return t7||(t7=tS(t4,t5,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(t8)}catch(e){console.warn(e)}}}).catch(e=>{throw tW.create("idb-open",{originalErrorMessage:e.message})})),t7}async function re(e){try{let t=(await t9()).transaction(t8),r=await t.objectStore(t8).get(rr(e));return await t.done,r}catch(e){if(e instanceof eR)tO.warn(e.message);else{let t=tW.create("idb-get",{originalErrorMessage:e?.message});tO.warn(t.message)}}}async function rt(e,t){try{let r=(await t9()).transaction(t8,"readwrite"),n=r.objectStore(t8);await n.put(t,rr(e)),await r.done}catch(e){if(e instanceof eR)tO.warn(e.message);else{let t=tW.create("idb-set",{originalErrorMessage:e?.message});tO.warn(t.message)}}}function rr(e){return`${e.name}!${e.options.appId}`}let rn=1024,ri=30;class rs{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rl(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=ra();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>ri){let e=ru(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){tO.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=ra(),{heartbeatsToSend:t,unsentEntries:r}=ro(this._heartbeatsCache.heartbeats),n=Y(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return tO.warn(e),""}}}function ra(){return new Date().toISOString().substring(0,10)}function ro(e,t=rn){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),rc(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),rc(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class rl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!eE()&&eI().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await re(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return rt(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return rt(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function rc(e){return Y(JSON.stringify({version:2,heartbeats:e})).length}function ru(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){tU(new e1("platform-logger",e=>new tI(e),"PRIVATE")),tU(new e1("heartbeat",e=>new rs(e),"PRIVATE")),t2(tR,tx,""),t2(tR,tx,"esm2020"),t2("fire-js","")})(""),e.s(["SDK_VERSION",()=>tY,"_DEFAULT_ENTRY_NAME",()=>tD,"_addComponent",()=>tF,"_addOrOverwriteComponent",()=>tB,"_apps",()=>tP,"_clearComponents",()=>t$,"_components",()=>tL,"_getProvider",()=>tj,"_isFirebaseApp",()=>tV,"_isFirebaseServerApp",()=>tH,"_isFirebaseServerAppSettings",()=>tz,"_registerComponent",()=>tU,"_removeServiceInstance",()=>tq,"_serverApps",()=>tM,"deleteApp",()=>t1,"getApp",()=>tZ,"getApps",()=>t0,"initializeApp",()=>tJ,"initializeServerApp",()=>tX,"onLog",()=>t3,"registerVersion",()=>t2,"setLogLevel",()=>t6],15710);var rh="u">typeof globalThis?globalThis:e.g,rd={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function t(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,r){void 0===r&&(r=e.length);let n=r-this.blockSize,i=this.C,s=this.h,a=0;for(;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i,s={};function a(e){return -128<=e&&e<128?r(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return p(o(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new n(t,0)}function l(e,t){if(0==e.length)throw Error("number format error: empty string");if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return p(l(e.substring(1),t));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=o(Math.pow(t,8)),n=c;for(let s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);let a=parseInt(e.substring(s,s+i),t);i<8?(i=o(Math.pow(t,i)),n=n.j(i).add(o(a))):n=(n=n.j(r)).add(o(a))}return n}var c=a(0),u=a(1),h=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new n(r,~e.h).add(u)}function m(e,t){return e.add(p(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function _(e,t){this.g=e,this.h=t}function b(e,t){if(d(t))throw Error("division by zero");if(d(e))return new _(c,c);if(f(e))return t=b(p(e),t),new _(p(t.g),p(t.h));if(f(t))return t=b(e,p(t)),new _(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=u,n=t;0>=n.l(e);)r=S(r),n=S(n);var i=C(r,1),s=C(n,1);for(n=C(n,2),r=C(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=C(n,1),r=C(r,1)}return t=m(e,i.j(t)),new _(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=o(r)).j(t);f(a)||a.l(e)>0;)r-=n,a=(s=o(r)).j(t);d(s)&&(s=u),i=i.add(s),e=m(e,a)}return new _(i,e)}function S(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(r,e.h)}function C(e,t){let r=t>>5;t%=32;let i=e.g.length-r,s=[];for(let n=0;n<i;n++)s[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=o(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=m(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return f(e=m(this,e))?-1:+!d(e)},i.abs=function(){return f(this)?p(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],i=0;for(let n=0;n<=t;n++){let t=i+(65535&this.i(n))+(65535&e.i(n)),s=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);i=s>>>16,t&=65535,s&=65535,r[n]=s<<16|t}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(d(this)||d(e))return c;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(h)&&0>e.l(h))return o(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){let n=this.i(i)>>>16,s=65535&this.i(i),a=e.i(t)>>>16,o=65535&e.i(t);r[2*i+2*t]+=s*o,v(r,2*i+2*t),r[2*i+2*t+1]+=n*o,v(r,2*i+2*t+1),r[2*i+2*t+1]+=s*a,v(r,2*i+2*t+1),r[2*i+2*t+2]+=n*a,v(r,2*i+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},i.B=function(e){return b(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new n(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new n(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,y=rd.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=l,g=rd.Integer=n}).apply(void 0!==rh?rh:"u">typeof self?self:{});var rf=e.i(24361),rp=e.i(54799),rm=e.i(48834),rg=e.i(45262);class ry{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ry.UNAUTHENTICATED=new ry(null),ry.GOOGLE_CREDENTIALS=new ry("google-credentials-uid"),ry.FIRST_PARTY=new ry("first-party-uid"),ry.MOCK_USER=new ry("mock-user");let rv="12.9.0";function r_(e){rv=e}function rb(e){return(0,rf.inspect)(e,{depth:100})}let rS=new tr("@firebase/firestore");function rC(){return rS.logLevel}function rw(e,...t){if(rS.logLevel<=m.DEBUG){let r=t.map(rI);rS.debug(`Firestore (${rv}): ${e}`,...r)}}function rT(e,...t){if(rS.logLevel<=m.ERROR){let r=t.map(rI);rS.error(`Firestore (${rv}): ${e}`,...r)}}function rE(e,...t){if(rS.logLevel<=m.WARN){let r=t.map(rI);rS.warn(`Firestore (${rv}): ${e}`,...r)}}function rI(e){if("string"==typeof e)return e;try{return rb(e)}catch(t){return e}}function rk(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,rR(e,n,r)}function rR(e,t,r){let n=`FIRESTORE (${rv}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw rT(n),Error(n)}function rx(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||rR(t,i,n)}function rO(e,t){return e}let rA="ok",rD="cancelled",rN="unknown",rP="invalid-argument",rM="deadline-exceeded",rL="not-found",rF="already-exists",rB="permission-denied",rU="unauthenticated",rj="resource-exhausted",rq="failed-precondition",rV="aborted",rz="out-of-range",rH="unimplemented",r$="internal",rW="unavailable",rK="data-loss";class rG extends eR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rQ{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rY{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rJ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ry.UNAUTHENTICATED))}shutdown(){}}class rX{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rZ{constructor(e){this.authProvider=e,this.currentUser=ry.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){rx(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new rQ;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new rQ,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{rw("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(rw("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rQ)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(rw("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(rx("string"==typeof t.accessToken,31837,{tokenData:t}),new rY(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return rx(null===e||"string"==typeof e,2055,{currentUid:e}),new ry(e)}}class r0{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=ry.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class r1{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new r0(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(ry.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class r2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class r3{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,tH(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){rx(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&rw("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,rw("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{rw("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):rw("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new r2(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(rx("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new r2(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function r6(e){if(!e)return new rJ;switch(e.type){case"firstParty":return new r1(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rG(rP,"makeAuthCredentialsProvider failed due to invalid credential type")}}function r4(e){return(0,rp.randomBytes)(e)}class r5{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=r4(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function r8(e,t){return e<t?-1:+(e>t)}function r7(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return nt(r)===nt(i)?r8(r,i):nt(r)?1:-1}return r8(e.length,t.length)}let r9=55296,ne=57343;function nt(e){let t=e.charCodeAt(0);return t>=r9&&t<=ne}function nr(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function nn(e){return e+"\0"}let ni="__name__";class ns{constructor(e,t,r){void 0===t?t=0:t>e.length&&rk(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&rk(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ns.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ns?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=ns.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return r8(e.length,t.length)}static compareSegments(e,t){let r=ns.isNumericId(e),n=ns.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?ns.extractNumericId(e).compare(ns.extractNumericId(t)):r7(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return g.fromString(e.substring(4,e.length-2))}}class na extends ns{construct(e,t,r){return new na(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new rG(rP,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new na(t)}static emptyPath(){return new na([])}}let no=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nl extends ns{construct(e,t,r){return new nl(e,t,r)}static isValidIdentifier(e){return no.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nl.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ni}static keyField(){return new nl([ni])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new rG(rP,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new rG(rP,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rG(rP,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new rG(rP,"Unterminated ` in path: "+e);return new nl(t)}static emptyPath(){return new nl([])}}class nc{constructor(e){this.path=e}static fromPath(e){return new nc(na.fromString(e))}static fromName(e){return new nc(na.fromString(e).popFirst(5))}static empty(){return new nc(na.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===na.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return na.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new nc(new na(e.slice()))}}function nu(e,t,r){if(!r)throw new rG(rP,`Function ${e}() cannot be called with an empty ${t}.`)}function nh(e,t,r,n){if(!0===t&&!0===n)throw new rG(rP,`${e} and ${r} cannot be used together.`)}function nd(e){if(!nc.isDocumentKey(e))throw new rG(rP,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function nf(e){if(nc.isDocumentKey(e))throw new rG(rP,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function np(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function nm(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=ng(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return rk(12329,{type:typeof e})}function ng(e){return e.constructor?e.constructor.name:null}function ny(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new rG(rP,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let r=nm(e);throw new rG(rP,`Expected type '${t.name}', but it was: ${r}`)}return e}function nv(e,t){if(t<=0)throw new rG(rP,`Function ${e}() requires a positive number, but it was: ${t}.`)}function n_(e,t){let r={typeString:e};return t&&(r.value=t),r}function nb(e,t){let r;if(!np(e))throw new rG(rP,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new rG(rP,r);return!0}let nS=-0xe7791f700,nC=1e6;class nw{static now(){return nw.fromMillis(Date.now())}static fromDate(e){return nw.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*nC);return new nw(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new rG(rP,"Timestamp nanoseconds out of range: "+t);if(e<nS||e>=0x3afff44180)throw new rG(rP,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/nC}_compareTo(e){return this.seconds===e.seconds?r8(this.nanoseconds,e.nanoseconds):r8(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nw._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nb(e,nw._jsonSchema))return new nw(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-nS).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}nw._jsonSchemaVersion="firestore/timestamp/1.0",nw._jsonSchema={type:n_("string",nw._jsonSchemaVersion),seconds:n_("number"),nanoseconds:n_("number")};class nT{static fromTimestamp(e){return new nT(e)}static min(){return new nT(new nw(0,0))}static max(){return new nT(new nw(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let nE=-1,nI=0;class nk{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function nR(e){return e.fields.find(e=>2===e.kind)}function nx(e){return e.fields.filter(e=>2!==e.kind)}function nO(e){let t=nx(e);return 0===t.length?0:t[t.length-1].kind}function nA(e,t){let r=r8(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=nP(e.fields[n],t.fields[n])))return r;return r8(e.fields.length,t.fields.length)}function nD(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}nk.UNKNOWN_ID=-1;class nN{constructor(e,t){this.fieldPath=e,this.kind=t}}function nP(e,t){let r=nl.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:r8(e.kind,t.kind)}class nM{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new nM(nI,nB.min())}}function nL(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new nB(nT.fromTimestamp(1e9===n?new nw(r+1,0):new nw(r,n)),nc.empty(),t)}function nF(e){return new nB(e.readTime,e.key,nE)}class nB{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new nB(nT.min(),nc.empty(),nE)}static max(){return new nB(nT.max(),nc.empty(),nE)}}function nU(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=nc.comparator(e.documentKey,t.documentKey))?r:r8(e.largestBatchId,t.largestBatchId)}let nj="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nq{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nV(e){if(e.code===rq&&e.message===nj)rw("LocalStore","Unexpectedly lost primary lease");else throw e}class nz{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&rk(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nz((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof nz)return t;return nz.resolve(t)}catch(e){return nz.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nz.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nz.reject(t)}static resolve(e){return new nz((t,r)=>{t(e)})}static reject(e){return new nz((t,r)=>{r(e)})}static waitFor(e){return new nz((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=nz.resolve(!1);for(let r of e)t=t.next(e=>e?nz.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new nz((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new nz((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let nH="SimpleDb",n$=3;class nW{static open(e,t,r,n){try{return new nW(t,e.transaction(n,r))}catch(e){throw new nY(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rQ,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new nY(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=n1(t.target.error);this.completionDeferred.reject(new nY(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(rw(nH,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new nX(this.transaction.objectStore(e))}}class nK{static delete(e){return rw(nH,"Removing database:",e),nZ(et().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!eE())return!1;if(nK.isMockPersistence())return!0;let e=ep(),t=nK.getIOSVersion(e),r=0<t&&t<10,n=nG(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===nK.getIOSVersion(ep())&&rT("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(rw(nH,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new nY(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new rG(rq,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new rG(rq,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new nY(e,n))},n.onupgradeneeded=e=>{rw(nH,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{rw(nH,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=nW.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),nz.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<n$;if(rw(nH,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function nG(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class nQ{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return nZ(this.dbCursor.delete())}}class nY extends rG{constructor(e,t){super(rW,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function nJ(e){return"IndexedDbTransactionError"===e.name}class nX{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(rw(nH,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(rw(nH,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),nZ(r)}add(e){return rw(nH,"ADD",this.store.name,e,e),nZ(this.store.add(e))}get(e){return nZ(this.store.get(e)).next(t=>(void 0===t&&(t=null),rw(nH,"GET",this.store.name,e,t),t))}delete(e){return rw(nH,"DELETE",this.store.name,e),nZ(this.store.delete(e))}count(){return rw(nH,"COUNT",this.store.name),nZ(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new nz((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new nz((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){rw(nH,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new nz((r,n)=>{t.onerror=e=>{n(n1(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}iterateCursor(e,t){let r=[];return new nz((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new nQ(i),a=t(i.primaryKey,i.value,s);if(a instanceof nz){let e=a.catch(e=>(s.done(),nz.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>nz.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function nZ(e){return new nz((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(n1(e.target.error))}})}let n0=!1;function n1(e){let t=nK.getIOSVersion(ep());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new rG("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return n0||(n0=!0,setTimeout(()=>{throw e},0)),e}}return e}let n2="IndexBackfiller",n3=15e3,n6=6e4,n4=50;class n5{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(n3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){rw(n2,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();rw(n2,`Documents written: ${e}`)}catch(e){nJ(e)?rw(n2,"Ignoring IndexedDB error during index backfill: ",e):await nV(e)}await this.schedule(n6)})}}class n8{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=n4){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return nz.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return rw(n2,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(rw(n2,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=nF(t);nU(n,r)>0&&(r=n)}),new nB(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class n7{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}n7.INVALID=-1;let n9="\x01",ie="\x01",it="\x10",ir="\x11";function ii(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=ia(t)),t=is(e.get(r),t);return ia(t)}function is(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=n9+it;break;case n9:r+=n9+ir;break;default:r+=n}}return r}function ia(e){return e+n9+ie}function io(e){let t=e.length;if(rx(t>=2,64408,{path:e}),2===t)return rx(e.charAt(0)===n9&&e.charAt(1)===ie,56145,{path:e}),na.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(n9,s);switch((t<0||t>r)&&rk(50515,{path:e}),e.charAt(t+1)){case ie:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case it:i+=e.substring(s,t),i+="\0";break;case ir:i+=e.substring(s,t+1);break;default:rk(61167,{path:e})}s=t+2}return new na(n)}let il="remoteDocuments",ic="owner",iu="owner",ih="mutationQueues",id="userId",ip="mutations",im="batchId",ig="userMutationsIndex",iy=["userId","batchId"];function iv(e){return[e]}function i_(e,t){return[e,ii(t)]}function ib(e,t,r){return[e,ii(t),r]}let iS={},iC="documentMutations",iw="remoteDocumentsV14",iT=["prefixPath","collectionGroup","readTime","documentId"],iE="documentKeyIndex",iI=["prefixPath","collectionGroup","documentId"],ik="collectionGroupIndex",iR=["collectionGroup","readTime","prefixPath","documentId"],ix="remoteDocumentGlobal",iO="remoteDocumentGlobalKey",iA="targets",iD="targetId",iN="queryTargetsIndex",iP=["canonicalId","targetId"],iM="targetDocuments",iL=["targetId","path"],iF="documentTargetsIndex",iB=["path","targetId"],iU="targetGlobalKey",ij="targetGlobal",iq="collectionParents",iV=["collectionId","parent"],iz="clientMetadata",iH="clientId",i$="bundles",iW="bundleId",iK="namedQueries",iG="name",iQ="indexConfiguration",iY="indexId",iJ="collectionGroupIndex",iX="collectionGroup",iZ="indexState",i0=["indexId","uid"],i1="sequenceNumberIndex",i2=["uid","sequenceNumber"],i3="indexEntries",i6=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],i4="documentKeyIndex",i5=["indexId","uid","orderedDocumentKey"],i8="documentOverlays",i7=["userId","collectionPath","documentId"],i9="collectionPathOverlayIndex",se=["userId","collectionPath","largestBatchId"],st="collectionGroupOverlayIndex",sr=["userId","collectionGroup","largestBatchId"],sn="globals",si="name",ss=[ih,ip,iC,il,iA,ic,ij,iM,iz,ix,iq,i$,iK],sa=[...ss,i8],so=[ih,ip,iC,iw,iA,ic,ij,iM,iz,ix,iq,i$,iK,i8],sl=so,sc=[...sl,iQ,iZ,i3],su=sc,sh=[...sc,sn],sd=sh;function sf(e){return 18===e?sd:17===e?sh:16===e?su:15===e?sc:14===e?sl:13===e?so:12===e?sa:11===e?ss:void rk(60245)}class sp extends nq{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function sm(e,t){let r=rO(e);return nK.getStore(r.simpleDbTransaction,t)}function sg(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function sy(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function sv(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function s_(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sb{constructor(e,t){this.comparator=e,this.root=t||sC.EMPTY}insert(e,t){return new sb(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sC.BLACK,null,null))}remove(e){return new sb(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sC.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sS(this.root,e,this.comparator,!1)}getReverseIterator(){return new sS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sS(this.root,e,this.comparator,!0)}}class sS{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sC{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:sC.RED,this.left=null!=n?n:sC.EMPTY,this.right=null!=i?i:sC.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new sC(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return sC.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key))if(n.right.isEmpty())return sC.EMPTY;else r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sC.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sC.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rk(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rk(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw rk(27949)}}sC.EMPTY=null,sC.RED=!0,sC.BLACK=!1;class sw{constructor(){this.size=0}get key(){throw rk(57766)}get value(){throw rk(16141)}get color(){throw rk(16727)}get left(){throw rk(29726)}get right(){throw rk(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new sC(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}sC.EMPTY=new sw;class sT{constructor(e){this.comparator=e,this.data=new sb(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sE(this.data.getIterator())}getIteratorFrom(e){return new sE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sT)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sT(this.comparator);return t.data=e,t}}class sE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sI(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sk(s),l=sk(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sk(a)):t?(i(o),o=sk(s)):(o=sk(s),l=sk(a))}}function sk(e){return e.hasNext()?e.getNext():void 0}class sR{constructor(e){this.fields=e,e.sort(nl.comparator)}static empty(){return new sR([])}unionWith(e){let t=new sT(nl.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new sR(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return nr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function sx(e){return Buffer.from(e,"base64").toString("binary")}function sO(e){return Buffer.from(e,"binary").toString("base64")}class sA{constructor(e){this.binaryString=e}static fromBase64String(e){return new sA(sx(e))}static fromUint8Array(e){return new sA(sD(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return sO(this.binaryString)}toUint8Array(){return sN(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return r8(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function sD(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function sN(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}sA.EMPTY_BYTE_STRING=new sA("");let sP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sM(e){if(rx(!!e,39018),"string"==typeof e){let t=0,r=sP.exec(e);if(rx(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sL(e.seconds),nanos:sL(e.nanos)}}function sL(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sF(e){return"string"==typeof e?sA.fromBase64String(e):sA.fromUint8Array(e)}let sB="server_timestamp",sU="__type__",sj="__previous_value__",sq="__local_write_time__";function sV(e){return(e?.mapValue?.fields||{})[sU]?.stringValue===sB}function sz(e,t){let r={fields:{[sU]:{stringValue:sB},[sq]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&sV(t)&&(t=sH(t)),t&&(r.fields[sj]=t),{mapValue:r}}function sH(e){let t=e.mapValue.fields[sj];return sV(t)?sH(t):t}function s$(e){let t=sM(e.mapValue.fields[sq].timestampValue);return new nw(t.seconds,t.nanos)}class sW{constructor(e,t,r,n,i,s,a,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c,this.apiKey=u}}let sK="(default)";class sG{constructor(e,t){this.projectId=e,this.database=t||sK}static empty(){return new sG("","")}get isDefaultDatabase(){return this.database===sK}isEqual(e){return e instanceof sG&&e.projectId===this.projectId&&e.database===this.database}}function sQ(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rG(rP,'"projectId" not provided in firebase.initializeApp.');return new sG(e.options.projectId,t)}let sY=-1;function sJ(e){return null==e}function sX(e){return 0===e&&1/e==-1/0}function sZ(e){return"number"==typeof e&&Number.isInteger(e)&&!sX(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let s0="__type__",s1="__max__",s2={mapValue:{fields:{__type__:{stringValue:s1}}}},s3="__vector__",s6="value",s4={nullValue:"NULL_VALUE"};function s5(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sV(e)?4:aP(e)?0x1fffffffffffff:aD(e)?10:11:rk(28295,{value:e})}function s8(e,t){if(e===t)return!0;let r=s5(e);if(r!==s5(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return s$(e).isEqual(s$(t));case 3:return s7(e,t);case 5:return e.stringValue===t.stringValue;case 6:return ae(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return s9(e,t);case 2:return at(e,t);case 9:return nr(e.arrayValue.values||[],t.arrayValue.values||[],s8);case 10:case 11:return ar(e,t);default:return rk(52216,{left:e})}}function s7(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=sM(e.timestampValue),n=sM(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function s9(e,t){return sL(e.geoPointValue.latitude)===sL(t.geoPointValue.latitude)&&sL(e.geoPointValue.longitude)===sL(t.geoPointValue.longitude)}function ae(e,t){return sF(e.bytesValue).isEqual(sF(t.bytesValue))}function at(e,t){if("integerValue"in e&&"integerValue"in t)return sL(e.integerValue)===sL(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=sL(e.doubleValue),n=sL(t.doubleValue);return r===n?sX(r)===sX(n):isNaN(r)&&isNaN(n)}return!1}function ar(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(sg(r)!==sg(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!s8(r[e],n[e])))return!1;return!0}function an(e,t){return void 0!==(e.values||[]).find(e=>s8(e,t))}function ai(e,t){if(e===t)return 0;let r=s5(e),n=s5(t);if(r!==n)return r8(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return r8(e.booleanValue,t.booleanValue);case 2:return as(e,t);case 3:return aa(e.timestampValue,t.timestampValue);case 4:return aa(s$(e),s$(t));case 5:return r7(e.stringValue,t.stringValue);case 6:return ac(e.bytesValue,t.bytesValue);case 7:return ao(e.referenceValue,t.referenceValue);case 8:return al(e.geoPointValue,t.geoPointValue);case 9:return au(e.arrayValue,t.arrayValue);case 10:return ah(e.mapValue,t.mapValue);case 11:return ad(e.mapValue,t.mapValue);default:throw rk(23264,{leftType:r})}}function as(e,t){let r=sL(e.integerValue||e.doubleValue),n=sL(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function aa(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return r8(e,t);let r=sM(e),n=sM(t),i=r8(r.seconds,n.seconds);return 0!==i?i:r8(r.nanos,n.nanos)}function ao(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=r8(r[e],n[e]);if(0!==t)return t}return r8(r.length,n.length)}function al(e,t){let r=r8(sL(e.latitude),sL(t.latitude));return 0!==r?r:r8(sL(e.longitude),sL(t.longitude))}function ac(e,t){let r=sF(e),n=sF(t);return r.compareTo(n)}function au(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=ai(r[e],n[e]);if(t)return t}return r8(r.length,n.length)}function ah(e,t){let r=e.fields||{},n=t.fields||{},i=r[s6]?.arrayValue,s=n[s6]?.arrayValue,a=r8(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:au(i,s)}function ad(e,t){if(e===s2.mapValue&&t===s2.mapValue)return 0;if(e===s2.mapValue)return 1;if(t===s2.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=r7(n[e],s[e]);if(0!==t)return t;let a=ai(r[n[e]],i[s[e]]);if(0!==a)return a}return r8(n.length,s.length)}function af(e){return ap(e)}function ap(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return ag(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return am(e.bytesValue);else if("referenceValue"in e)return av(e.referenceValue);else if("geoPointValue"in e)return ay(e.geoPointValue);else if("arrayValue"in e)return ab(e.arrayValue);else if("mapValue"in e)return a_(e.mapValue);else return rk(61005,{value:e})}function am(e){return sF(e).toBase64()}function ag(e){let t=sM(e);return`time(${t.seconds},${t.nanos})`}function ay(e){return`geo(${e.latitude},${e.longitude})`}function av(e){return nc.fromName(e).toString()}function a_(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ap(e.fields[i])}`;return r+"}"}function ab(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ap(n);return t+"]"}function aS(e){switch(s5(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=sH(e);return t?16+aS(t):16;case 5:return 2*e.stringValue.length;case 6:return sF(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return aw(e.arrayValue);case 10:case 11:return aC(e.mapValue);default:throw rk(13486,{value:e})}}function aC(e){let t=0;return sy(e.fields,(e,r)=>{t+=e.length+aS(r)}),t}function aw(e){return(e.values||[]).reduce((e,t)=>e+aS(t),0)}function aT(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function aE(e){return!!e&&"integerValue"in e}function aI(e){return!!e&&"doubleValue"in e}function ak(e){return aE(e)||aI(e)}function aR(e){return!!e&&"arrayValue"in e}function ax(e){return!!e&&"nullValue"in e}function aO(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aA(e){return!!e&&"mapValue"in e}function aD(e){return(e?.mapValue?.fields||{})[s0]?.stringValue===s3}function aN(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return sy(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=aN(r)),t}{if(!e.arrayValue)return{...e};let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=aN(e.arrayValue.values[r]);return t}}function aP(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===s1}let aM={mapValue:{fields:{[s0]:{stringValue:s3},[s6]:{arrayValue:{}}}}};function aL(e){if("nullValue"in e)return s4;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return aT(sG.empty(),nc.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return rk(35942,{value:e});else return aD(e)?aM:{mapValue:{}}}function aF(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return aT(sG.empty(),nc.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return aM;else if(!("mapValue"in e))return rk(61959,{value:e});else return aD(e)?{mapValue:{}}:s2}function aB(e,t){let r=ai(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function aU(e,t){let r=ai(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class aj{constructor(e){this.value=e}static empty(){return new aj({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!aA(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aN(t)}setAll(e){let t=nl.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=aN(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());aA(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return s8(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];aA(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(sy(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new aj(aN(this.value))}}function aq(e){let t=[];return sy(e.fields,(e,r)=>{let n=new nl([e]);if(aA(r)){let e=aq(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new sR(t)}class aV{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new aV(e,0,nT.min(),nT.min(),nT.min(),aj.empty(),0)}static newFoundDocument(e,t,r,n){return new aV(e,1,t,nT.min(),r,n,0)}static newNoDocument(e,t){return new aV(e,2,t,nT.min(),nT.min(),aj.empty(),0)}static newUnknownDocument(e,t){return new aV(e,3,t,nT.min(),nT.min(),aj.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(nT.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=aj.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=aj.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nT.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof aV&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new aV(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function az(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?ai(n,i):rk(42886)}class aH{constructor(e,t){this.position=e,this.inclusive=t}}function a$(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?nc.comparator(nc.fromName(a.referenceValue),r.key):ai(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function aW(e,t,r){let n=a$(e,t,r);return e.inclusive?n>=0:n>0}function aK(e,t,r){let n=a$(e,t,r);return e.inclusive?n<=0:n<0}function aG(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!s8(e.position[r],t.position[r]))return!1;return!0}class aQ{constructor(e,t="asc"){this.field=e,this.dir=t}}function aY(e){return e.field.canonicalString()+e.dir}function aJ(e){return`${e.field.canonicalString()} (${e.dir})`}function aX(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class aZ{}class a0 extends aZ{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,r);else return new oi(e,t,r);if("array-contains"===t)return new ol(e,r);if("in"===t)return new oc(e,r);if("not-in"===t)return new ou(e,r);if("array-contains-any"===t)return new oh(e,r);else return new a0(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new os(e,r):new oa(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(ai(t,this.value)):null!==t&&s5(this.value)===s5(t)&&this.matchesComparison(ai(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rk(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class a1 extends aZ{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new a1(e,t)}matches(e){return a2(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function a2(e){return"and"===e.op}function a3(e){return"or"===e.op}function a6(e){return a4(e)&&a2(e)}function a4(e){for(let t of e.filters)if(t instanceof a1)return!1;return!0}function a5(e){if(e instanceof a0)return e.field.canonicalString()+e.op.toString()+af(e.value);{if(a6(e))return e.filters.map(e=>a5(e)).join(",");let t=e.filters.map(e=>a5(e)).join(",");return`${e.op}(${t})`}}function a8(e,t){return e instanceof a0?a7(e,t):e instanceof a1?a9(e,t):void rk(19439)}function a7(e,t){return t instanceof a0&&e.op===t.op&&e.field.isEqual(t.field)&&s8(e.value,t.value)}function a9(e,t){return t instanceof a1&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&a8(r,t.filters[n]),!0)}function oe(e,t){let r=e.filters.concat(t);return a1.create(r,e.op)}function ot(e){return e instanceof a0?on(e):e instanceof a1?or(e):"Filter"}function or(e){return e.op.toString()+" {"+e.getFilters().map(ot).join(" ,")+"}"}function on(e){return`${e.field.canonicalString()} ${e.op} ${af(e.value)}`}class oi extends a0{constructor(e,t,r){super(e,t,r),this.key=nc.fromName(r.referenceValue)}matches(e){let t=nc.comparator(e.key,this.key);return this.matchesComparison(t)}}class os extends a0{constructor(e,t){super(e,"in",t),this.keys=oo("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class oa extends a0{constructor(e,t){super(e,"not-in",t),this.keys=oo("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function oo(e,t){return(t.arrayValue?.values||[]).map(e=>nc.fromName(e.referenceValue))}class ol extends a0{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return aR(t)&&an(t.arrayValue,this.value)}}class oc extends a0{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&an(this.value.arrayValue,t)}}class ou extends a0{constructor(e,t){super(e,"not-in",t)}matches(e){if(an(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!an(this.value.arrayValue,t)}}class oh extends a0{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!aR(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>an(this.value.arrayValue,e))}}class od{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function of(e,t=null,r=[],n=[],i=null,s=null,a=null){return new od(e,t,r,n,i,s,a)}function op(e){let t=rO(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>a5(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>aY(e)).join(","),sJ(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>af(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>af(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function om(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>ot(e)).join(", ")}]`),sJ(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>aJ(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>af(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>af(e)).join(",")),`Target(${t})`}function og(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!aX(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!a8(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!aG(e.startAt,t.startAt)&&aG(e.endAt,t.endAt)}function oy(e){return nc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ov(e,t){return e.filters.filter(e=>e instanceof a0&&e.field.isEqual(t))}function o_(e,t){let r=nR(t);if(void 0===r)return null;for(let t of ov(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function ob(e,t){let r=new Map;for(let n of nx(t))for(let t of ov(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function oS(e,t){let r=[],n=!0;for(let i of nx(t)){let t=0===i.kind?ow(e,i.fieldPath,e.startAt):oT(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new aH(r,n)}function oC(e,t){let r=[],n=!0;for(let i of nx(t)){let t=0===i.kind?oT(e,i.fieldPath,e.endAt):ow(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new aH(r,n)}function ow(e,t,r){let n=s4,i=!0;for(let r of ov(e,t)){let e=s4,t=!0;switch(r.op){case"<":case"<=":e=aL(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=s4}0>aB({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>aB({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function oT(e,t,r){let n=s2,i=!0;for(let r of ov(e,t)){let e=s2,t=!0;switch(r.op){case">=":case">":e=aF(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=s2}aU({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];aU({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function oE(e){let t=new sT(nl.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}function oI(e){return null!==e.limit}class ok{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function oR(e,t,r,n,i,s,a,o){return new ok(e,t,r,n,i,s,a,o)}function ox(e){return new ok(e)}function oO(e,t){return new ok(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function oA(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oD(e){let t=new sT(nl.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function oN(e){return nc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function oP(e){return null!==e.collectionGroup}function oM(e){let t=rO(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";oD(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new aQ(n,r))}),e.has(nl.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new aQ(nl.keyField(),r))}return t.memoizedNormalizedOrderBy}function oL(e){let t=rO(e);return t.memoizedTarget||(t.memoizedTarget=oB(t,oM(e))),t.memoizedTarget}function oF(e){let t=rO(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=oB(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function oB(e,t){if("F"===e.limitType)return of(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new aQ(e.field,t)});let r=e.endAt?new aH(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new aH(e.startAt.position,e.startAt.inclusive):null;return of(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function oU(e,t){let r=e.filters.concat([t]);return new ok(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function oj(e,t){let r=e.explicitOrderBy.concat([t]);return new ok(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function oq(e,t,r){return new ok(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function oV(e,t){return new ok(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function oz(e,t){return new ok(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function oH(e,t){return og(oL(e),oL(t))&&e.limitType===t.limitType}function o$(e){return`${op(oL(e))}|lt:${e.limitType}`}function oW(e){return`Query(target=${om(oL(e))}; limitType=${e.limitType})`}function oK(e,t){return t.isFoundDocument()&&oG(e,t)&&oQ(e,t)&&oY(e,t)&&oJ(e,t)}function oG(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):nc.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function oQ(e,t){for(let r of oM(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function oY(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function oJ(e,t){return(!e.startAt||!!aK(e.startAt,oM(e),t))&&(!e.endAt||!!aW(e.endAt,oM(e),t))}function oX(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oZ(e){return(t,r)=>{let n=!1;for(let i of oM(e)){let e=o0(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function o0(e,t,r){let n=e.field.isKeyField()?nc.comparator(t.key,r.key):az(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return rk(19790,{direction:e.dir})}}class o1{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){sy(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return s_(this.inner)}size(){return this.innerSize}}let o2=new sb(nc.comparator);function o3(){return o2}let o6=new sb(nc.comparator);function o4(...e){let t=o6;for(let r of e)t=t.insert(r.key,r);return t}function o5(){return le()}function o8(e){let t=o6;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function o7(){return le()}function o9(){return le()}function le(){return new o1(e=>e.toString(),(e,t)=>e.isEqual(t))}let lt=new sb(nc.comparator);function lr(){return lt}let ln=new sT(nc.comparator);function li(...e){let t=ln;for(let r of e)t=t.add(r);return t}let ls=new sT(r8);function la(){return ls}function lo(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sX(t)?"-0":t}}function ll(e){return{integerValue:""+e}}function lc(e,t){return sZ(t)?ll(t):lo(e,t)}class lu{constructor(){this._=void 0}}function lh(e,t,r){return e instanceof lm?sz(r,t):e instanceof lg?ly(e,t):e instanceof lv?l_(e,t):lS(e,t)}function ld(e,t,r){return e instanceof lg?ly(e,t):e instanceof lv?l_(e,t):r}function lf(e,t){return e instanceof lb?ak(t)?t:{integerValue:0}:null}function lp(e,t){return e instanceof lg&&t instanceof lg||e instanceof lv&&t instanceof lv?nr(e.elements,t.elements,s8):e instanceof lb&&t instanceof lb?s8(e.operand,t.operand):e instanceof lm&&t instanceof lm}class lm extends lu{}class lg extends lu{constructor(e){super(),this.elements=e}}function ly(e,t){let r=lw(t);for(let t of e.elements)r.some(e=>s8(e,t))||r.push(t);return{arrayValue:{values:r}}}class lv extends lu{constructor(e){super(),this.elements=e}}function l_(e,t){let r=lw(t);for(let t of e.elements)r=r.filter(e=>!s8(e,t));return{arrayValue:{values:r}}}class lb extends lu{constructor(e,t){super(),this.serializer=e,this.operand=t}}function lS(e,t){let r=lf(e,t),n=lC(r)+lC(e.operand);return aE(r)&&aE(e.operand)?ll(n):lo(e.serializer,n)}function lC(e){return sL(e.integerValue||e.doubleValue)}function lw(e){return aR(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class lT{constructor(e,t){this.field=e,this.transform=t}}function lE(e,t){return e.field.isEqual(t.field)&&lp(e.transform,t.transform)}function lI(e,t){return void 0===e&&void 0===t||!!e&&!!t&&nr(e,t,(e,t)=>lE(e,t))}class lk{constructor(e,t){this.version=e,this.transformResults=t}}class lR{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new lR}static exists(e){return new lR(void 0,e)}static updateTime(e){return new lR(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lx(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lO{}function lA(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new l$(e.key,lR.none());else return new lL(e.key,e.data,lR.none());{let r=e.data,n=aj.empty(),i=new sT(nl.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new lU(e.key,n,new sR(i.toArray()),lR.none())}}function lD(e,t,r){e instanceof lL?lF(e,t,r):e instanceof lU?lj(e,t,r):lW(e,t,r)}function lN(e,t,r,n){return e instanceof lL?lB(e,t,r,n):e instanceof lU?lq(e,t,r,n):lK(e,t,r)}function lP(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=lf(n.transform,e||null);null!=i&&(null===r&&(r=aj.empty()),r.set(n.field,i))}return r||null}function lM(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!lI(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lL extends lO{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function lF(e,t,r){let n=e.value.clone(),i=lz(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function lB(e,t,r,n){if(!lx(e.precondition,t))return r;let i=e.value.clone(),s=lH(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class lU extends lO{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function lj(e,t,r){if(!lx(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=lz(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(lV(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function lq(e,t,r,n){if(!lx(e.precondition,t))return r;let i=lH(e.fieldTransforms,n,t),s=t.data;return(s.setAll(lV(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function lV(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function lz(e,t,r){let n=new Map;rx(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,ld(a,o,r[i]))}return n}function lH(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,lh(e,s,t))}return n}class l$ extends lO{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function lW(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function lK(e,t,r){return lx(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class lG extends lO{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class lQ{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&lD(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=lN(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=lN(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=o9();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=lA(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(nT.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),li())}isEqual(e){return this.batchId===e.batchId&&nr(this.mutations,e.mutations,(e,t)=>lM(e,t))&&nr(this.baseMutations,e.baseMutations,(e,t)=>lM(e,t))}}class lY{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){rx(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=lr(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new lY(e,t,r,n)}}class lJ{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class lX{constructor(e,t){this.count=e,this.unchangedNames=t}}function lZ(e){switch(e){case rA:return rk(64938);case rD:case rN:case rM:case rj:case r$:case rW:case rU:return!1;case rP:case rL:case rF:case rB:case rq:case rV:case rz:case rH:case rK:return!0;default:return rk(15467,{code:e})}}function l0(e){return lZ(e)&&e!==rV}function l1(e){if(void 0===e)return rT("GRPC error has no .code"),rN;switch(e){case v.OK:return rA;case v.CANCELLED:return rD;case v.UNKNOWN:return rN;case v.DEADLINE_EXCEEDED:return rM;case v.RESOURCE_EXHAUSTED:return rj;case v.INTERNAL:return r$;case v.UNAVAILABLE:return rW;case v.UNAUTHENTICATED:return rU;case v.INVALID_ARGUMENT:return rP;case v.NOT_FOUND:return rL;case v.ALREADY_EXISTS:return rF;case v.PERMISSION_DENIED:return rB;case v.FAILED_PRECONDITION:return rq;case v.ABORTED:return rV;case v.OUT_OF_RANGE:return rz;case v.UNIMPLEMENTED:return rH;case v.DATA_LOSS:return rK;default:return rk(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(v||(v={}));class l2 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let l3=null;function l6(e){if(l3)throw Error("a TestingHooksSpi instance is already set");l3=e}function l4(){return new rf.TextEncoder}function l5(){return new rf.TextDecoder("utf-8")}let l8=new g([0xffffffff,0xffffffff],0);function l7(e){let t=l4().encode(e),r=new y;return r.update(t),new Uint8Array(r.digest())}function l9(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new g([r,n],0),new g([i,s],0)]}class ce{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ct(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new ct(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new ct(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=g.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(g.fromNumber(r)));return 1===n.compare(l8)&&(n=new g([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=l9(l7(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new ce(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=l9(l7(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ct extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class cr{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,cn.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new cr(nT.min(),n,new sb(r8),o3(),li())}}class cn{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new cn(r,t,li(),li(),li())}}class ci{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class cs{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class ca{constructor(e,t,r=sA.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class co{constructor(){this.pendingResponses=0,this.documentChanges=ch(),this._resumeToken=sA.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=li(),t=li(),r=li();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:rk(38017,{changeType:i})}}),new cn(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=ch()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,rx(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let cl="WatchChangeAggregator";class cc{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=o3(),this.pendingDocumentUpdatesByTarget=cu(),this.pendingDocumentTargetMapping=cu(),this.pendingTargetResets=new sb(r8)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:rk(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(oy(i))if(0===r){let e=new nc(i.path);this.removeDocumentFromTarget(t,e,aV.newNoDocument(e,nT.min()))}else rx(1===r,20013,{expectedCount:r});else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}l3?.notifyOnExistenceFilterMismatch(cd(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r,n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=sF(i).toUint8Array()}catch(e){if(e instanceof l2)return rE("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new ce(t,s,a)}catch(e){return e instanceof ct?rE("BloomFilter error: ",e):rE("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return 2*(t.existenceFilter.count!==r-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&oy(i.target)){let t=new nc(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,aV.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=li();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new cr(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=o3(),this.pendingDocumentUpdatesByTarget=cu(),this.pendingDocumentTargetMapping=cu(),this.pendingTargetResets=new sb(r8),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new co,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new sT(r8),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new sT(r8),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||rw(cl,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new co),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function cu(){return new sb(nc.comparator)}function ch(){return new sb(nc.comparator)}function cd(e,t,r,n,i){let s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}let cf=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),cp=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),cm=(()=>{let e={};return e.and="AND",e.or="OR",e})();function cg(e,t){}class cy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function cv(e){return new rG(void 0===e.code?rN:l1(e.code),e.message||"")}function c_(e,t){return e.useProto3Json||sJ(t)?t:{value:t}}function cb(e){let t;return sJ(t="object"==typeof e?e.value:e)?null:t}function cS(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function cC(e){let t=sM(e);return new nw(t.seconds,t.nanos)}function cw(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function cT(e,t){return e.useProto3Json?(rx(void 0===t||"string"==typeof t,58123),sA.fromBase64String(t||"")):(rx(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),sA.fromUint8Array(t||new Uint8Array))}function cE(e,t){return cS(e,t.toTimestamp())}function cI(e){return rx(!!e,49232),nT.fromTimestamp(cC(e))}function ck(e,t){return cR(e,t).canonicalString()}function cR(e,t){let r=cM(e).child("documents");return void 0===t?r:r.child(t)}function cx(e){let t=na.fromString(e);return rx(uI(t),10190,{key:t.toString()}),t}function cO(e,t){return ck(e.databaseId,t.path)}function cA(e,t){let r=cx(t);if(r.get(1)!==e.databaseId.projectId)throw new rG(rP,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new rG(rP,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new nc(cL(r))}function cD(e,t){return ck(e.databaseId,t)}function cN(e){let t=cx(e);return 4===t.length?na.emptyPath():cL(t)}function cP(e){return new na(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function cM(e){return new na(["projects",e.projectId,"databases",e.database])}function cL(e){return rx(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function cF(e,t,r){return{name:cO(e,t),fields:r.value.mapValue.fields}}function cB(e,t){return{name:cO(e,t.key),fields:t.data.value.mapValue.fields,updateTime:cS(e,t.version.toTimestamp()),createTime:cS(e,t.createTime.toTimestamp())}}function cU(e,t,r){let n=cA(e,t.name),i=cI(t.updateTime),s=t.createTime?cI(t.createTime):nT.min(),a=new aj({mapValue:{fields:t.fields}}),o=aV.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function cj(e,t){rx(!!t.found,43571),cg(t.found.name),cg(t.found.updateTime);let r=cA(e,t.found.name),n=cI(t.found.updateTime),i=t.found.createTime?cI(t.found.createTime):nT.min(),s=new aj({mapValue:{fields:t.found.fields}});return aV.newFoundDocument(r,n,i,s)}function cq(e,t){rx(!!t.missing,3894),rx(!!t.readTime,22933);let r=cA(e,t.missing),n=cI(t.readTime);return aV.newNoDocument(r,n)}function cV(e,t){return"found"in t?cj(e,t):"missing"in t?cq(e,t):rk(7234,{result:t})}function cz(e,t){let r;if("targetChange"in t){cg(t.targetChange);let n=cH(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=cT(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new ca(n,i,s,a&&cv(a)||null)}else if("documentChange"in t){cg(t.documentChange);let n=t.documentChange;cg(n.document),cg(n.document.name),cg(n.document.updateTime);let i=cA(e,n.document.name),s=cI(n.document.updateTime),a=n.document.createTime?cI(n.document.createTime):nT.min(),o=new aj({mapValue:{fields:n.document.fields}}),l=aV.newFoundDocument(i,s,a,o);r=new ci(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){cg(t.documentDelete);let n=t.documentDelete;cg(n.document);let i=cA(e,n.document),s=n.readTime?cI(n.readTime):nT.min(),a=aV.newNoDocument(i,s);r=new ci([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){cg(t.documentRemove);let n=t.documentRemove;cg(n.document);let i=cA(e,n.document);r=new ci([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return rk(11601,{change:t});cg(t.filter);let e=t.filter;cg(e.targetId);let{count:n=0,unchangedNames:i}=e,s=new lX(n,i);r=new cs(e.targetId,s)}return r}function cH(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return rk(39313,{state:e})}function c$(e){if(!("targetChange"in e))return nT.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?nT.min():cI(t.readTime)}function cW(e,t){let r;if(t instanceof lL)r={update:cF(e,t.key,t.value)};else if(t instanceof l$)r={delete:cO(e,t.key)};else if(t instanceof lU)r={update:cF(e,t.key,t.data),updateMask:uT(t.fieldMask)};else{if(!(t instanceof lG))return rk(16599,{mutationType:t.type});r={verify:cO(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>cX(e,t))),t.precondition.isNone||(r.currentDocument=cG(e,t.precondition)),r}function cK(e,t){let r=t.currentDocument?cQ(t.currentDocument):lR.none(),n=t.updateTransforms?t.updateTransforms.map(t=>cZ(e,t)):[];if(t.update){cg(t.update.name);let i=cA(e,t.update.name),s=new aj({mapValue:{fields:t.update.fields}});return t.updateMask?new lU(i,s,uE(t.updateMask),r,n):new lL(i,s,r,n)}return t.delete?new l$(cA(e,t.delete),r):t.verify?new lG(cA(e,t.verify),r):rk(1463,{proto:t})}function cG(e,t){return void 0!==t.updateTime?{updateTime:cE(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:rk(27497)}function cQ(e){return void 0!==e.updateTime?lR.updateTime(cI(e.updateTime)):void 0!==e.exists?lR.exists(e.exists):lR.none()}function cY(e,t){let r=e.updateTime?cI(e.updateTime):cI(t);return r.isEqual(nT.min())&&(r=cI(t)),new lk(r,e.transformResults||[])}function cJ(e,t){return e&&e.length>0?(rx(void 0!==t,14353),e.map(e=>cY(e,t))):[]}function cX(e,t){let r=t.transform;if(r instanceof lm)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof lg)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof lv)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof lb)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw rk(20930,{transform:t.transform})}function cZ(e,t){let r=null;return"setToServerValue"in t?(rx("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new lm):"appendMissingElements"in t?r=new lg(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new lv(t.removeAllFromArray.values||[]):"increment"in t?r=new lb(e,t.increment):rk(16584,{proto:t}),new lT(nl.fromServerFormat(t.fieldPath),r)}function c0(e,t){return{documents:[cD(e,t.path)]}}function c1(e){let t=e.documents.length;return rx(1===t,1966,{count:t}),oL(ox(cN(e.documents[0])))}function c2(e,t){let r,n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=cD(e,r);let s=c9(t.filters);s&&(n.structuredQuery.where=s);let a=ur(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=c_(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=ui(t.startAt)),t.endAt&&(n.structuredQuery.endAt=us(t.endAt)),{queryTarget:n,parent:r}}function c3(e,t,r,n){let{queryTarget:i,parent:s}=c2(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:up(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:up(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function c6(e){let t=cN(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){rx(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=ue(r.where));let a=[];r.orderBy&&(a=un(r.orderBy));let o=null;r.limit&&(o=cb(r.limit));let l=null;r.startAt&&(l=ua(r.startAt));let c=null;return r.endAt&&(c=uo(r.endAt)),oR(t,i,a,s,o,"F",l,c)}function c4(e){return oL(c6(e))}function c5(e,t){let r=c8(t.purpose);return null==r?null:{"goog-listen-tags":r}}function c8(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rk(28987,{purpose:e})}}function c7(e,t){let r,n=t.target;if((r=oy(n)?{documents:c0(e,n)}:{query:c2(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=cw(e,t.resumeToken);let n=c_(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(nT.min())>0){r.readTime=cS(e,t.snapshotVersion.toTimestamp());let n=c_(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function c9(e){if(0!==e.length)return uv(a1.create(e,"and"))}function ue(e){let t=ut(e);return t instanceof a1&&a6(t)?t.getFilters():[t]}function ut(e){return void 0!==e.unaryFilter?uS(e):void 0!==e.fieldFilter?uC(e):void 0!==e.compositeFilter?uw(e):rk(30097,{filter:e})}function ur(e){if(0!==e.length)return e.map(e=>ug(e))}function un(e){return e.map(e=>uy(e))}function ui(e){return{before:e.inclusive,values:e.position}}function us(e){return{before:!e.inclusive,values:e.position}}function ua(e){let t=!!e.before;return new aH(e.values||[],t)}function uo(e){let t=!e.before;return new aH(e.values||[],t)}function ul(e){return cf[e]}function uc(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function uu(e){return cp[e]}function uh(e){return cm[e]}function ud(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rk(58110);default:return rk(50506)}}function uf(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rk(1026)}}function up(e){return{fieldPath:e.canonicalString()}}function um(e){return nl.fromServerFormat(e.fieldPath)}function ug(e){return{field:up(e.field),direction:ul(e.dir)}}function uy(e){return new aQ(um(e.field),uc(e.direction))}function uv(e){return e instanceof a0?ub(e):e instanceof a1?u_(e):rk(54877,{filter:e})}function u_(e){let t=e.getFilters().map(e=>uv(e));return 1===t.length?t[0]:{compositeFilter:{op:uh(e.op),filters:t}}}function ub(e){if("=="===e.op){if(aO(e.value))return{unaryFilter:{field:up(e.field),op:"IS_NAN"}};else if(ax(e.value))return{unaryFilter:{field:up(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aO(e.value))return{unaryFilter:{field:up(e.field),op:"IS_NOT_NAN"}};else if(ax(e.value))return{unaryFilter:{field:up(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:up(e.field),op:uu(e.op),value:e.value}}}function uS(e){switch(e.unaryFilter.op){case"IS_NAN":let t=um(e.unaryFilter.field);return a0.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=um(e.unaryFilter.field);return a0.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=um(e.unaryFilter.field);return a0.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=um(e.unaryFilter.field);return a0.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rk(61313);default:return rk(60726)}}function uC(e){return a0.create(um(e.fieldFilter.field),ud(e.fieldFilter.op),e.fieldFilter.value)}function uw(e){return a1.create(e.compositeFilter.filters.map(e=>ut(e)),uf(e.compositeFilter.op))}function uT(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function uE(e){return new sR((e.fieldPaths||[]).map(e=>nl.fromServerFormat(e)))}function uI(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function uk(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class uR{constructor(e,t,r,n,i=nT.min(),s=nT.min(),a=sA.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new uR(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new uR(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new uR(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new uR(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ux{constructor(e){this.remoteSerializer=e}}function uO(e,t){let r;if(t.document)r=cU(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=nc.fromSegments(t.noDocument.path),n=uM(t.noDocument.readTime);r=aV.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return rk(56709);let e=nc.fromSegments(t.unknownDocument.path),n=uM(t.unknownDocument.version);r=aV.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(uN(t.readTime)),r}function uA(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:uD(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=cB(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:uP(t.version)};else{if(!t.isUnknownDocument())return rk(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:uP(t.version)}}return n}function uD(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function uN(e){let t=new nw(e[0],e[1]);return nT.fromTimestamp(t)}function uP(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function uM(e){let t=new nw(e.seconds,e.nanoseconds);return nT.fromTimestamp(t)}function uL(e,t,r){let n=r.baseMutations.map(t=>cW(e.remoteSerializer,t)),i=r.mutations.map(t=>cW(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function uF(e,t){let r=(t.baseMutations||[]).map(t=>cK(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>cK(e.remoteSerializer,t)),i=nw.fromMillis(t.localWriteTimeMs);return new lQ(t.batchId,i,r,n)}function uB(e){let t,r=uM(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?uM(e.lastLimboFreeSnapshotVersion):nT.min();return new uR(t=uj(e.query)?c1(e.query):c4(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,sA.fromBase64String(e.resumeToken))}function uU(e,t){let r,n=uP(t.snapshotVersion),i=uP(t.lastLimboFreeSnapshotVersion);r=oy(t.target)?c0(e.remoteSerializer,t.target):c2(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:op(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function uj(e){return void 0!==e.documents}function uq(e){return{id:e.bundleId,createTime:uM(e.createTime),version:e.version}}function uV(e){return{bundleId:e.id,createTime:uP(cI(e.createTime)),version:e.version}}function uz(e){return{name:e.name,query:u$(e.bundledQuery),readTime:uM(e.readTime)}}function uH(e){return{name:e.name,readTime:uP(cI(e.readTime)),bundledQuery:e.bundledQuery}}function u$(e){let t=c6({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?oq(t,t.limit,"L"):t}function uW(e){return{name:e.name,query:u$(e.bundledQuery),readTime:cI(e.readTime)}}function uK(e){return{id:e.id,version:e.version,createTime:cI(e.createTime)}}function uG(e,t){return new lJ(t.largestBatchId,cK(e.remoteSerializer,t.overlayMutation))}function uQ(e,t,r){let[n,i,s]=uY(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:cW(e.remoteSerializer,r.mutation)}}function uY(e,t){let r=t.path.lastSegment();return[e,ii(t.path.popLast()),r]}function uJ(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function uX(e,t){let r=t?new nM(t.sequenceNumber,new nB(uM(t.readTime),new nc(io(t.documentKey)),t.largestBatchId)):nM.empty(),n=e.fields.map(([e,t])=>new nN(nl.fromServerFormat(e),t));return new nk(e.indexId,e.collectionGroup,n,r)}function uZ(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:uP(n.readTime),documentKey:ii(n.documentKey.path),largestBatchId:n.largestBatchId}}class u0{getBundleMetadata(e,t){return u1(e).get(t).next(e=>{if(e)return uq(e)})}saveBundleMetadata(e,t){return u1(e).put(uV(t))}getNamedQuery(e,t){return u2(e).get(t).next(e=>{if(e)return uz(e)})}saveNamedQuery(e,t){return u2(e).put(uH(t))}}function u1(e){return sm(e,i$)}function u2(e){return sm(e,iK)}class u3{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new u3(e,t.uid||"")}getOverlay(e,t){return u6(e).get(uY(this.userId,t)).next(e=>e?uG(this.serializer,e):null)}getOverlays(e,t){let r=o7();return nz.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new lJ(t,i);n.push(this.saveOverlay(e,s))}),nz.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(ii(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(u6(e).deleteAll(i9,n))}),nz.waitFor(i)}getOverlaysForCollection(e,t,r){let n=o7(),i=ii(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return u6(e).loadAll(i9,s).next(e=>{for(let t of e){let e=uG(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=o7(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return u6(e).iterate({index:st,range:a},(e,t,r)=>{let a=uG(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return u6(e).put(uQ(this.serializer,this.userId,t))}}function u6(e){return sm(e,i8)}class u4{globalsStore(e){return sm(e,sn)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=e?.value;return t?sA.fromUint8Array(t):sA.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let u5=5,u8=10,u7=13,u9=15,he=20,ht=25,hr=30,hn=37,hi=45,hs=50,ha=53,ho=55,hl=60,hc=2;class hu{writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,u5);else if("booleanValue"in e)this.writeValueTypeLabel(t,u8),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,u9),t.writeNumber(sL(e.integerValue));else if("doubleValue"in e){let r=sL(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,u7):(this.writeValueTypeLabel(t,u9),sX(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,he),"string"==typeof r&&(r=sM(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,hr),t.writeBytes(sF(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,hi),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?aP(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):aD(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):rk(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,ht),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,ho),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,ha);let n=s6,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,u9),t.writeNumber(sL(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,hs),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,hn),nc.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,hl),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(hc)}}hu.INSTANCE=new hu;let hh="\uD800",hd="\uDBFF",hf=0,hp=255,hm=1,hg=255,hy=255,hv=0,h_=64,hb=8,hS=1024;function hC(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function hw(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function hT(e){let t=0;for(let r=0;r<8;++r){let n=hw(255&e[r]);if(t+=n,8!==n)break}return t}function hE(e){return Math.ceil((h_-hT(e))/hb)}class hI{constructor(){this.buffer=new Uint8Array(hS),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<hh||hd<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<hh||hd<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=hE(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=hE(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(hg),this.writeEscapedByteAscending(hy)}writeInfinityDescending(){this.writeEscapedByteDescending(hg),this.writeEscapedByteDescending(hy)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=hC(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}writeByteAscending(e){let t=255&e;t===hf?(this.writeEscapedByteAscending(hf),this.writeEscapedByteAscending(hp)):t===hg?(this.writeEscapedByteAscending(hg),this.writeEscapedByteAscending(hv)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===hf?(this.writeEscapedByteDescending(hf),this.writeEscapedByteDescending(hp)):t===hg?(this.writeEscapedByteDescending(hg),this.writeEscapedByteDescending(hv)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(hf),this.writeEscapedByteAscending(hm)}writeSeparatorDescending(){this.writeEscapedByteDescending(hf),this.writeEscapedByteDescending(hm)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class hk{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class hR{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class hx{constructor(){this.orderedCode=new hI,this.ascending=new hk(this.orderedCode),this.descending=new hR(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class hO{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new hO(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:hN(this._arrayValue),directionalValue:hN(this._directionalValue),orderedDocumentKey:hN(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function hA(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=hD(e._arrayValue,t._arrayValue))||0!==(r=hD(e._directionalValue,t._directionalValue))?r:nc.comparator(e._documentKey,t._documentKey)}function hD(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function hN(e){return eT()?hM(e):e}function hP(e){return"string"!=typeof e?e:hL(e)}function hM(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function hL(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class hF{constructor(e){for(const t of(this.inequalityFilters=new sT((e,t)=>nl.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){const e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(rx(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=nR(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=nx(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new sT(nl.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new nN(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new nN(r.field,0))}for(let r of this.orderBys)!r.field.isKeyField()&&(e.has(r.field)||(e=e.add(r.field),t.push(new nN(r.field,+("asc"!==r.dir)))));return new nk(nk.UNKNOWN_ID,this.collectionId,t,nM.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function hB(e){if(rx(e instanceof a0||e instanceof a1,20012),e instanceof a0)if(!(e instanceof oc))return e;else{let t=e.value.arrayValue?.values?.map(t=>a0.create(e.field,"==",t))||[];return a1.create(t,"or")}let t=e.filters.map(e=>hB(e));return a1.create(t,e.op)}function hU(e){if(0===e.getFilters().length)return[];let t=hH(hB(e));return(rx(hV(t),7391),hj(t)||hq(t))?[t]:t.getFilters()}function hj(e){return e instanceof a0}function hq(e){return e instanceof a1&&a6(e)}function hV(e){return hj(e)||hq(e)||hz(e)}function hz(e){if(e instanceof a1&&a3(e)){for(let t of e.getFilters())if(!hj(t)&&!hq(t))return!1;return!0}return!1}function hH(e){if(rx(e instanceof a0||e instanceof a1,34018),e instanceof a0)return e;if(1===e.filters.length)return hH(e.filters[0]);let t=e.filters.map(e=>hH(e)),r=a1.create(t,e.op);return hV(r=hQ(r))?r:(rx(r instanceof a1,64498),rx(a2(r),40251),rx(r.filters.length>1,57927),r.filters.reduce((e,t)=>h$(e,t)))}function h$(e,t){let r;return rx(e instanceof a0||e instanceof a1,38388),rx(t instanceof a0||t instanceof a1,25473),hQ(r=e instanceof a0?t instanceof a0?hW(e,t):hG(e,t):t instanceof a0?hG(t,e):hK(e,t))}function hW(e,t){return a1.create([e,t],"and")}function hK(e,t){if(rx(e.filters.length>0&&t.filters.length>0,48005),a2(e)&&a2(t))return oe(e,t.getFilters());let r=a3(e)?e:t,n=a3(e)?t:e,i=r.filters.map(e=>h$(e,n));return a1.create(i,"or")}function hG(e,t){if(a2(t))return oe(t,e.getFilters());{let r=t.filters.map(t=>h$(e,t));return a1.create(r,"or")}}function hQ(e){if(rx(e instanceof a0||e instanceof a1,11850),e instanceof a0)return e;let t=e.getFilters();if(1===t.length)return hQ(t[0]);if(a4(e))return e;let r=t.map(e=>hQ(e)),n=[];return(r.forEach(t=>{t instanceof a0?n.push(t):t instanceof a1&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:a1.create(n,e.op)}class hY{constructor(){this.collectionParentIndex=new hJ}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),nz.resolve()}getCollectionParents(e,t){return nz.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return nz.resolve()}deleteFieldIndex(e,t){return nz.resolve()}deleteAllFieldIndexes(e){return nz.resolve()}createTargetIndexes(e,t){return nz.resolve()}getDocumentsMatchingTarget(e,t){return nz.resolve(null)}getIndexType(e,t){return nz.resolve(0)}getFieldIndexes(e,t){return nz.resolve([])}getNextCollectionGroupToUpdate(e){return nz.resolve(null)}getMinOffset(e,t){return nz.resolve(nB.min())}getMinOffsetFromCollectionGroup(e,t){return nz.resolve(nB.min())}updateCollectionGroup(e,t,r){return nz.resolve()}updateIndexEntries(e,t){return nz.resolve()}}class hJ{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new sT(na.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new sT(na.comparator)).toArray()}}let hX="IndexedDbIndexManager",hZ=new Uint8Array(0);class h0{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new hJ,this.targetToDnfSubTargets=new o1(e=>op(e),(e,t)=>og(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:ii(n)};return h1(e).put(i)}return nz.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[nn(t),""],!1,!0);return h1(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(io(n.parent))}return r})}addFieldIndex(e,t){let r=h3(e),n=uJ(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=h6(e);return i.next(e=>{r.put(uZ(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=h3(e),n=h6(e),i=h2(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=h3(e),r=h2(e),n=h6(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return nz.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new hF(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=h2(e),n=!0,i=new Map;return nz.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return nz.resolve(null);{let e=li(),n=[];return nz.forEach(i,(i,s)=>{rw(hX,`Using index ${nD(i)} to execute ${op(t)}`);let a=o_(s,i),o=ob(s,i),l=oS(s,i),c=oC(s,i),u=this.encodeBound(i,s,l),h=this.encodeBound(i,s,c),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,u,l.inclusive,h,c.inclusive,d);return nz.forEach(f,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=nc.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:hU(a1.create(e.filters,"and")).map(t=>of(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),c=[];for(let u=0;u<o;++u){let o=t?this.encodeSingleElement(t[u/l]):hZ,h=this.generateLowerBound(e,o,r[u%l],n),d=this.generateUpperBound(e,o,i[u%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));c.push(...this.createRange(h,d,f))}return c}generateLowerBound(e,t,r,n){let i=new hO(e,nc.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new hO(e,nc.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new hF(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return nz.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<oE(t)&&(r=1):r=0})).next(()=>oI(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new hx;for(let n of nx(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);hu.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new hx;return hu.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new hx;return hu.INSTANCE.writeIndexValue(aT(this.databaseId,t),r.forKind(nO(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new hx);let i=0;for(let s of nx(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&aR(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);hu.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new hx;n.seed(r.encodedBytes()),hu.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof a0&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=h3(e),n=h6(e);return(t?r.loadAll(iJ,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return nz.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(uX(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:r8(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=h3(e),i=h6(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(iJ,IDBKeyRange.bound(t,t)).next(t=>nz.forEach(t,t=>i.put(uZ(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return nz.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?nz.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),nz.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?nz.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return h2(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return h2(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=h2(e),i=new sT(hA);return n.iterate({index:i4,range:IDBKeyRange.only([r.indexId,this.uid,hN(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new hO(r.indexId,t,hP(n.arrayValue),hP(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new sT(hA),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=nR(t);if(null!=i){let s=e.data.field(i.fieldPath);if(aR(s))for(let i of s.arrayValue.values||[])r=r.add(new hO(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new hO(t.indexId,e.key,hZ,n));return r}updateEntries(e,t,r,n,i){rw(hX,"Updating index entries for document '%s'",t.key);let s=[];return sI(n,i,hA,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),nz.waitFor(s)}getNextSequenceNumber(e){let t=1;return h6(e).iterate({index:i1,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>hA(e,t)).filter((e,t,r)=>!t||0!==hA(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=hA(i,e),s=hA(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,hZ,nc.empty()),r=n[e+1].dbIndexEntryKey(this.uid,hZ,nc.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return hA(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(h4)}getMinOffset(e,t){return nz.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||rk(44426))).next(h4)}}function h1(e){return sm(e,iq)}function h2(e){return sm(e,i3)}function h3(e){return sm(e,iQ)}function h6(e){return sm(e,iZ)}function h4(e){rx(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>nU(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new nB(t.readTime,t.documentKey,r)}function h5(e,t,r){let n=e.store(ip),i=e.store(iC),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{rx(1===o,47070,{batchId:r.batchId})}));let c=[];for(let e of r.mutations){let n=ib(t,e.key.path,r.batchId);s.push(i.delete(n)),c.push(e.key)}return nz.waitFor(s).next(()=>c)}function h8(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw rk(14731);return JSON.stringify(t).length}class h7{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return rx(""!==e.uid,64387),new h7(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return dt(e).iterate({index:ig,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=dr(e),s=dt(e);return s.add({}).next(a=>{rx("number"==typeof a,49019);let o=new lQ(a,t,r,n),l=uL(this.serializer,this.userId,o),c=[],u=new sT((e,t)=>r8(e.canonicalString(),t.canonicalString()));for(let e of n){let t=ib(this.userId,e.key.path,a);u=u.add(e.key.path.popLast()),c.push(s.put(l)),c.push(i.put(t,iS))}return u.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),nz.waitFor(c).next(()=>o)})}lookupMutationBatch(e,t){return dt(e).get(t).next(e=>e?(rx(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),uF(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?nz.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return dt(e).iterate({index:ig,range:n},(e,t,n)=>{t.userId===this.userId&&(rx(t.batchId>=r,47524,{nextBatchId:r}),i=uF(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=sY;return dt(e).iterate({index:ig,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,sY],[this.userId,1/0]);return dt(e).loadAll(ig,t).next(e=>e.map(e=>uF(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=i_(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return dr(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,c=io(o);return a===this.userId&&t.path.isEqual(c)?dt(e).get(l).next(e=>{if(!e)throw rk(61480,{indexKey:r,batchId:l});rx(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(uF(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sT(r8),n=[];return t.forEach(t=>{let i=i_(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=dr(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=io(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),nz.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=i_(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new sT(r8);return dr(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,c=io(o);s===this.userId&&r.isPrefixOf(c)?c.length===n&&(a=a.add(l)):i.done()}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(dt(e).get(t).next(e=>{if(null===e)throw rk(35274,{batchId:t});rx(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(uF(this.serializer,e))}))}),nz.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return h5(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),nz.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return nz.resolve();let r=IDBKeyRange.lowerBound(iv(this.userId)),n=[];return dr(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId)return void r.done();{let t=io(e[1]);n.push(t)}}).next(()=>{rx(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return h9(e,this.userId,t)}getMutationQueueMetadata(e){return dn(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:sY,lastStreamToken:""})}}function h9(e,t,r){let n=i_(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return dr(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function de(e,t){let r=!1;return dn(e).iterateSerial(n=>h9(e,n,t).next(e=>(e&&(r=!0),nz.resolve(!e)))).next(()=>r)}function dt(e){return sm(e,ip)}function dr(e){return sm(e,iC)}function dn(e){return sm(e,ih)}let di=2;class ds{constructor(e){this.lastId=e}next(){return this.lastId+=di,this.lastId}static forTargetCache(){return new ds(2-di)}static forSyncEngine(){return new ds(1-di)}}class da{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new ds(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>nT.fromTimestamp(new nw(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dl(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(rx(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return dl(e).iterate((s,a)=>{let o=uB(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>nz.waitFor(i)).next(()=>n)}forEachTarget(e,t){return dl(e).iterate((e,r)=>{t(uB(r))})}retrieveMetadata(e){return dc(e).get(iU).next(e=>(rx(null!==e,2888),e))}saveMetadata(e,t){return dc(e).put(iU,t)}saveTargetData(e,t){return dl(e).put(uU(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=op(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return dl(e).iterate({range:n,index:iN},(e,r,n)=>{let s=uB(r);og(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=du(e);return t.forEach(t=>{let s=ii(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),nz.waitFor(n)}removeMatchingKeys(e,t,r){let n=du(e);return nz.forEach(t,t=>{let i=ii(t.path);return nz.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=du(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=du(e),i=li();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new nc(io(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=ii(t.path),n=IDBKeyRange.bound([r],[nn(r)],!1,!0),i=0;return du(e).iterate({index:iF,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return dl(e).get(t).next(e=>e?uB(e):null)}}function dl(e){return sm(e,iA)}function dc(e){return sm(e,ij)}function du(e){return sm(e,iM)}let dh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dd=-1,df=0x2800000;class dp{static withCacheSize(e){return new dp(e,dp.DEFAULT_COLLECTION_PERCENTILE,dp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}dp.DEFAULT_COLLECTION_PERCENTILE=10,dp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dp.DEFAULT=new dp(df,dp.DEFAULT_COLLECTION_PERCENTILE,dp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dp.DISABLED=new dp(dd,0,0);let dm="LruGarbageCollector",dg=1048576,dy=6e4,dv=3e5;function d_([e,t],[r,n]){let i=r8(e,r);return 0===i?r8(t,n):i}class db{constructor(e){this.maxElements=e,this.buffer=new sT(d_),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>d_(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class dS{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==dd&&this.scheduleGC(dy)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){rw(dm,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nJ(e)?rw(dm,"Ignoring IndexedDB error during garbage collection: ",e):await nV(e)}await this.scheduleGC(dv)})}}class dC{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nz.resolve(n7.INVALID);let r=new db(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===dd?(rw("LruGarbageCollector","Garbage collection skipped; disabled"),nz.resolve(dh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(rw("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dh):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l,c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rw("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),rC()<=m.DEBUG&&rw("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-c}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-c}ms`),nz.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function dw(e,t){return new dC(e,t)}class dT{constructor(e,t){this.db=e,this.garbageCollector=dw(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return dk(e,r)}removeReference(e,t,r){return dk(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return dk(e,t)}isPinned(e,t){return de(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,nT.min()),du(e).delete(dE(s))))});n.push(t)}}).next(()=>nz.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return dk(e,t)}forEachOrphanedDocument(e,t){let r,n=du(e),i=n7.INVALID;return n.iterate({index:iF},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==n7.INVALID&&t(new nc(io(r)),i),i=a,r=s):i=n7.INVALID}).next(()=>{i!==n7.INVALID&&t(new nc(io(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function dE(e){return[0,ii(e.path)]}function dI(e,t){return{targetId:0,path:ii(e.path),sequenceNumber:t}}function dk(e,t){return du(e).put(dI(t,e.currentSequenceNumber))}class dR{constructor(){this.changes=new o1(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,aV.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?nz.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class dx{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return dN(e).put(r)}removeEntry(e,t,r){return dN(e).delete(dM(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=aV.newInvalidDocument(t);return dN(e).iterate({index:iE,range:IDBKeyRange.only(dP(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:aV.newInvalidDocument(t)};return dN(e).iterate({index:iE,range:IDBKeyRange.only(dP(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:h8(n)}}).next(()=>r)}getEntries(e,t){let r=o3();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=o3(),n=new sb(nc.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,h8(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return nz.resolve();let n=new sT(dF);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(dP(n.first()),dP(n.last())),s=n.getIterator(),a=s.getNext();return dN(e).iterate({index:iE,range:i},(e,t,n)=>{let i=nc.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>dF(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(dP(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),uD(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dN(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=o3();for(let i of e){let e=this.maybeDecodeDocument(nc.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(oK(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=o3(),s=dL(t,r),a=dL(t,nB.max());return dN(e).iterate({index:ik,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(nc.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new dA(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return dD(e).get(iO).next(e=>(rx(!!e,20021),e))}setMetadata(e,t){return dD(e).put(iO,t)}maybeDecodeDocument(e,t){if(t){let e=uO(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(nT.min())))return e}return aV.newInvalidDocument(e)}}function dO(e){return new dx(e)}class dA extends dR{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new o1(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new sT((e,t)=>r8(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=uA(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=h8(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=uA(this.documentCache.serializer,s.convertToNoDocument(nT.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),nz.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function dD(e){return sm(e,ix)}function dN(e){return sm(e,iw)}function dP(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function dM(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],uD(t),r[r.length-1]]}function dL(e,t){let r=t.documentKey.path.toArray();return[e,uD(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function dF(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=r8(r[e],n[e]))return i;return(i=r8(r.length,n.length))||(i=r8(r[r.length-2],n[n.length-2]))?i:r8(r[r.length-1],n[n.length-1])}let dB=18;class dU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class dj{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&lN(r.mutation,e,sR.empty(),nw.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,li()).next(()=>t))}getLocalViewOfDocuments(e,t,r=li()){let n=o7();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=o4();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=o7();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,li()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=o3(),s=le(),a=o5();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof lU)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),lN(a.mutation,t,a.mutation.getFieldMask(),nw.now())):s.set(t.key,sR.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new dU(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=le(),n=new sb((e,t)=>e-t),i=li();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||sR.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||li()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,c=o9();l.forEach(e=>{if(!i.has(e)){let n=lA(t.get(e),r.get(e));null!==n&&c.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,c))}return nz.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return oN(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oP(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):nz.resolve(o7()),a=nE,o=i;return s.next(t=>nz.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?nz.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,li())).next(e=>({batchId:a,changes:o8(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new nc(t)).next(e=>{let t=o4();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=o4();return this.indexManager.getCollectionParents(e,i).next(a=>nz.forEach(a,a=>{let o=oO(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,aV.newInvalidDocument(n)))});let r=o4();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&lN(s.mutation,n,sR.empty(),nw.now()),oK(t,n)&&(r=r.insert(e,n))}),r})}}class dq{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return nz.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,uK(t)),nz.resolve()}getNamedQuery(e,t){return nz.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,uW(t)),nz.resolve()}}class dV{constructor(){this.overlays=new sb(nc.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return nz.resolve(this.overlays.get(t))}getOverlays(e,t){let r=o7();return nz.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),nz.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),nz.resolve()}getOverlaysForCollection(e,t,r){let n=o7(),i=t.length+1,s=new nc(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return nz.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new sb((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=o7(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=o7(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return nz.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new lJ(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=li(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class dz{constructor(){this.sessionToken=sA.EMPTY_BYTE_STRING}getSessionToken(e){return nz.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nz.resolve()}}class dH{constructor(){this.refsByKey=new sT(d$.compareByKey),this.refsByTarget=new sT(d$.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new d$(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new d$(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new nc(new na([])),r=new d$(t,e),n=new d$(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new nc(new na([])),r=new d$(t,e),n=new d$(t,e+1),i=li();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new d$(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class d${constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return nc.comparator(e.key,t.key)||r8(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return r8(e.targetOrBatchId,t.targetOrBatchId)||nc.comparator(e.key,t.key)}}class dW{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new sT(d$.compareByKey)}checkEmpty(e){return nz.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new lQ(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new d$(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nz.resolve(s)}lookupMutationBatch(e,t){return nz.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return nz.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return nz.resolve(0===this.mutationQueue.length?sY:this.nextBatchId-1)}getAllMutationBatches(e){return nz.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new d$(t,0),n=new d$(t,1/0),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),nz.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sT(r8);return t.forEach(e=>{let t=new d$(e,0),n=new d$(e,1/0);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),nz.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;nc.isDocumentKey(i)||(i=i.child(""));let s=new d$(new nc(i),0),a=new sT(r8);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),nz.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){rx(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return nz.forEach(t.mutations,n=>{let i=new d$(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new d$(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return nz.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,nz.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let dK="-9223372036854775808";function dG(){return new sb(nc.comparator)}class dQ{constructor(e){this.sizer=e,this.docs=dG(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return nz.resolve(r?r.document.mutableCopy():aV.newInvalidDocument(t))}getEntries(e,t){let r=o3();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():aV.newInvalidDocument(e))}),nz.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=o3(),s=t.path,a=new nc(s.child("__id"+dK+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=nU(nF(a),r))&&(n.has(a.key)||oK(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nz.resolve(i)}getAllFromCollectionGroup(e,t,r,n){rk(9500)}forEachDocumentKey(e,t){return nz.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new dJ(this)}getSize(e){return nz.resolve(this.size)}}function dY(e){return new dQ(e)}class dJ extends dR{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),nz.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class dX{constructor(e){this.persistence=e,this.targets=new o1(e=>op(e),og),this.lastRemoteSnapshotVersion=nT.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new dH,this.targetCount=0,this.targetIdGenerator=ds.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),nz.resolve()}getLastRemoteSnapshotVersion(e){return nz.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nz.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),nz.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),nz.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ds(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,nz.resolve()}updateTargetData(e,t){return this.saveTargetData(t),nz.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,nz.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),nz.waitFor(i).next(()=>n)}getTargetCount(e){return nz.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return nz.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),nz.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),nz.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),nz.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return nz.resolve(r)}containsKey(e,t){return nz.resolve(this.references.containsKey(t))}}let dZ="MemoryPersistence";class d0{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new n7(0),this._started=!1,this._started=!0,this.globalsCache=new dz,this.referenceDelegate=e(this),this.targetCache=new dX(this);const r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new hY,this.remoteDocumentCache=dY(r),this.serializer=new ux(t),this.bundleCache=new dq(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dV,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new dW(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){rw(dZ,"Starting transaction:",e);let n=new d1(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return nz.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class d1 extends nq{constructor(e){super(),this.currentSequenceNumber=e}}class d2{constructor(e){this.persistence=e,this.localViewReferences=new dH,this._orphanedDocuments=null}static factory(e){return new d2(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw rk(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),nz.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),nz.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),nz.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nz.forEach(this.orphanedDocuments,r=>{let n=nc.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,nT.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return nz.or([()=>nz.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class d3{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new o1(e=>ii(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=dw(this,t)}static factory(e,t){return new d3(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return nz.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return nz.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?nz.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,nT.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),nz.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),nz.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),nz.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),nz.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=aS(e.data.value)),t}isPinned(e,t,r){return nz.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return nz.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class d6{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new nW("createOrUpgrade",t);r<1&&n>=1&&(d5(e),d8(e),fr(e),d9(e));let s=nz.resolve();return r<3&&n>=3&&(0!==r&&(fn(e),fr(e)),s=s.next(()=>fs(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>d7(e,i))),s=s.next(()=>{fa(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(ft(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{fi(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{fo(e),fl(e)})),r<12&&n>=12&&(s=s.next(()=>{fu(e)})),r<13&&n>=13&&(s=s.next(()=>fe(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(il))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>fc(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(iZ).clear()}).next(()=>{t.objectStore(i3).clear()})),r<17&&n>=17&&(s=s.next(()=>{fh(e)})),r<18&&n>=18&&eT()&&(s=s.next(()=>{t.objectStore(iZ).clear()}).next(()=>{t.objectStore(i3).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(il).iterate((e,r)=>{t+=h8(r)}).next(()=>{let r={byteSize:t};return e.store(ix).put(iO,r)})}removeAcknowledgedMutations(e){let t=e.store(ih),r=e.store(ip);return t.loadAll().next(t=>nz.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,sY],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(ig,n).next(r=>nz.forEach(r,r=>{rx(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=uF(this.serializer,r);return h5(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(iM),r=e.store(il);return e.store(ij).get(iU).next(e=>{let n=r=>t.put({targetId:0,path:ii(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new na(e),a=d4(s);i.push(t.get(a).next(e=>e?nz.resolve():n(s)))}).next(()=>nz.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(iq,{keyPath:iV});let r=t.store(iq),n=new hJ,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:ii(n)})}};return t.store(il).iterate({keysOnly:!0},(e,t)=>i(new na(e).popLast())).next(()=>t.store(iC).iterate({keysOnly:!0},([e,t,r],n)=>i(io(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(iA);return t.iterate((e,r)=>{let n=uB(r),i=uU(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(il),n=[];return r.iterate((e,r)=>{let i=t.store(iw),s=fd(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>nz.waitFor(n))}runOverlayMigration(e,t){let r=t.store(ip),n=dO(this.serializer),i=new d0(d2.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??li();uF(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),nz.forEach(r,(e,r)=>{let s=new ry(r),a=u3.forUser(this.serializer,s),o=i.getIndexManager(s);return new dj(n,h7.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new sp(t,n7.INVALID),e).next()})})}}function d4(e){return[0,ii(e)]}function d5(e){e.createObjectStore(ic)}function d8(e){e.createObjectStore(ih,{keyPath:id}),e.createObjectStore(ip,{keyPath:im,autoIncrement:!0}).createIndex(ig,iy,{unique:!0}),e.createObjectStore(iC)}function d7(e,t){return t.store(ip).loadAll().next(r=>{e.deleteObjectStore(ip),e.createObjectStore(ip,{keyPath:im,autoIncrement:!0}).createIndex(ig,iy,{unique:!0});let n=t.store(ip),i=r.map(e=>n.put(e));return nz.waitFor(i)})}function d9(e){e.createObjectStore(il)}function fe(e){let t=e.createObjectStore(iw,{keyPath:iT});t.createIndex(iE,iI),t.createIndex(ik,iR)}function ft(e){e.createObjectStore(ix)}function fr(e){e.createObjectStore(iM,{keyPath:iL}).createIndex(iF,iB,{unique:!0}),e.createObjectStore(iA,{keyPath:iD}).createIndex(iN,iP,{unique:!0}),e.createObjectStore(ij)}function fn(e){e.deleteObjectStore(iM),e.deleteObjectStore(iA),e.deleteObjectStore(ij)}function fi(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function fs(e){let t=e.store(ij),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:nT.min().toTimestamp(),targetCount:0};return t.put(iU,r)}function fa(e){e.createObjectStore(iz,{keyPath:iH})}function fo(e){e.createObjectStore(i$,{keyPath:iW})}function fl(e){e.createObjectStore(iK,{keyPath:iG})}function fc(e){e.createObjectStore(iQ,{keyPath:iY,autoIncrement:!0}).createIndex(iJ,iX,{unique:!1}),e.createObjectStore(iZ,{keyPath:i0}).createIndex(i1,i2,{unique:!1}),e.createObjectStore(i3,{keyPath:i6}).createIndex(i4,i5,{unique:!1})}function fu(e){let t=e.createObjectStore(i8,{keyPath:i7});t.createIndex(i9,se,{unique:!1}),t.createIndex(st,sr,{unique:!1})}function fh(e){e.createObjectStore(sn,{keyPath:si})}function fd(e){return e.document?new nc(na.fromString(e.document.name).popFirst(5)):e.noDocument?nc.fromSegments(e.noDocument.path):e.unknownDocument?nc.fromSegments(e.unknownDocument.path):rk(36783)}let ff="IndexedDbPersistence",fp=18e5,fm=5e3,fg=4e3,fy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",fv="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",f_="firestore_zombie",fb="main";class fS{constructor(e,t,r,n,i,s,a,o,l,c,u=dB){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=c,this.schemaVersion=u,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=e=>Promise.resolve(),!fS.isAvailable())throw new rG(rH,fv);this.referenceDelegate=new dT(this,n),this.dbName=t+fb,this.serializer=new ux(o),this.simpleDb=new nK(this.dbName,this.schemaVersion,new d6(this.serializer)),this.globalsCache=new u4,this.targetCache=new da(this.referenceDelegate,this.serializer),this.remoteDocumentCache=dO(this.serializer),this.bundleCache=new u0,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===c&&rT(ff,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new rG(rq,fy);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new n7(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>fw(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(nJ(e))return rw(ff,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return rw(ff,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return fC(e).get(iu).next(e=>nz.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return fw(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,fp)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=sm(e,iz);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,fp),n=e.filter(e=>-1===r.indexOf(e));return nz.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",fg,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?nz.resolve(!0):fC(e).get(iu).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,fm)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new rG(rq,fy);return!1}}return!!this.networkEnabled&&!!this.inForeground||fw(e).loadAll().next(e=>void 0===this.filterActiveClients(e,fm).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&rw(ff,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[ic,iz],e=>{let t=new sp(e,n7.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>fw(e).loadAll().next(e=>this.filterActiveClients(e,fp).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return h7.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new h0(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return u3.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;rw(ff,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=sf(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new sp(i,this.listenSequence?this.listenSequence.next():n7.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw rT(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new rG(rq,nj);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return fC(e).get(iu).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,fm)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new rG(rq,fy)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fC(e).put(iu,t)}static isAvailable(){return nK.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=fC(e);return t.get(iu).next(e=>this.isLocalClient(e)?(rw(ff,"Releasing primary lease."),t.delete(iu)):nz.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(rT(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;ew()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{let t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return rw(ff,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return rT(ff,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){rT("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${f_}_${this.persistenceKey}_${e}`}}function fC(e){return sm(e,ic)}function fw(e){return sm(e,iz)}function fT(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}function fE(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function fI(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let fk="LocalStore",fR=3e8;class fx{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new sb(r8),this.targetIdByTarget=new o1(e=>op(e),og),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dj(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function fO(e,t,r,n){return new fx(e,t,r,n)}async function fA(e,t){let r=rO(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=li();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function fD(e,t){let r,n,i=rO(e),s=nw.now(),a=t.reduce((e,t)=>e.add(t.key),li());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=o3(),l=li();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=lP(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new lU(e.key,t,aq(t.value.mapValue),lR.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:o8(r)}))}function fN(e,t){let r=rO(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fK(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,fP(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function fP(e){let t=li();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function fM(e,t){let r=rO(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(rx(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function fL(e){let t=rO(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function fF(e,t){let r=rO(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(sA.EMPTY_BYTE_STRING,nT.min()).withLastLimboFreeSnapshotVersion(nT.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),i=i.insert(o,c),fU(l,c,s)&&a.push(r.targetCache.updateTargetData(e,c))});let o=o3(),l=li();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(fB(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(nT.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return nz.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function fB(e,t,r){let n=li(),i=li();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=o3();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(nT.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):rw(fk,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function fU(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=fR)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function fj(e,t){let r=rO(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>nz.forEach(t,t=>nz.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>nz.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(nJ(e))rw(fk,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function fq(e,t){let r=rO(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=sY),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function fV(e,t){let r=rO(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function fz(e,t){let r=rO(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,nz.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new uR(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function fH(e,t,r){let n=rO(e),i=n.targetIdByTarget.get(r);return void 0!==i?nz.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function f$(e,t,r){let n=rO(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(nJ(e))rw(fk,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function fW(e,t,r){let n=rO(e),i=nT.min(),s=li();return n.persistence.runTransaction("Execute query","readwrite",e=>fH(n,e,oL(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:nT.min(),r?s:li())).next(e=>(fZ(n,oX(t),e),{documents:e,remoteKeys:s})))}function fK(e,t,r,n){let i=r.batch,s=i.keys(),a=nz.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);rx(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function fG(e,t){let r=rO(e),n=rO(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):nz.resolve(null)))}function fQ(e,t){rO(rO(e,fx).mutationQueue).removeCachedMutationKeys(t)}function fY(e){return rO(rO(e,fx).persistence).getActiveClients()}function fJ(e,t){let r=rO(e),n=rO(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function fX(e,t){let r=rO(e),n=r.collectionGroupReadTime.get(t)||nT.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,nL(n,nE),Number.MAX_SAFE_INTEGER)).then(e=>(fZ(r,t,e),e))}function fZ(e,t,r){let n=e.collectionGroupReadTime.get(t)||nT.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function f0(e){return oL(ox(na.fromString(`__bundle__/docs/${e}`)))}async function f1(e,t,r,n){let i=rO(e),s=li(),a=o3();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await fz(i,f0(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>fB(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function f2(e,t){let r=rO(e),n=cI(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function f3(e,t){let r=rO(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function f6(e,t){let r=rO(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function f4(e,t,r=li()){let n=await fz(e,oL(u$(t.bundledQuery))),i=rO(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=cI(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(sA.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function f5(e,t){let r=rO(e),n=r.indexManager,i=[];return r.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(r=>fE(r,t,nA,t=>{i.push(n.addFieldIndex(e,t))},t=>{i.push(n.deleteFieldIndex(e,t))})).next(()=>nz.waitFor(i)))}function f8(e,t){rO(e).queryEngine.indexAutoCreationEnabled=t}function f7(e){let t=rO(e),r=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}class f9{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let pe=100;function pt(){return ew()?8:nG(ep())>0?6:4}class pr{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=pe,this.relativeIndexReadCostPerDocument=pt()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new f9;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(rC()<=m.DEBUG&&rw("QueryEngine","SDK will not create cache indexes for query:",oW(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),nz.resolve()):(rC()<=m.DEBUG&&rw("QueryEngine","Query:",oW(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(rC()<=m.DEBUG&&rw("QueryEngine","The SDK decides to create cache indexes for query:",oW(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oL(t))):nz.resolve()}performQueryUsingIndex(e,t){if(oA(t))return nz.resolve(null);let r=oL(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=oL(t=oq(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=li(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,oq(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return oA(t)||n.isEqual(nT.min())?nz.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?nz.resolve(null):(rC()<=m.DEBUG&&rw("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oW(t)),this.appendRemainingResults(e,s,t,nL(n,nE)).next(e=>e))})}applyQuery(e,t){let r=new sT(oZ(e));return t.forEach((t,n)=>{oK(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return rC()<=m.DEBUG&&rw("QueryEngine","Using full collection scan to execute query:",oW(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,nB.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let pn="firestore_clients";function pi(e,t){return`${pn}_${e}_${t}`}let ps="firestore_mutations";function pa(e,t,r){let n=`${ps}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let po="firestore_targets";function pl(e,t){return`${po}_${e}_${t}`}let pc="firestore_online_state";function pu(e){return`${pc}_${e}`}let ph="firestore_bundle_loaded_v2";function pd(e){return`${ph}_${e}`}let pf="firestore_sequence_number";function pp(e){return`${pf}_${e}`}let pm="SharedClientState";class pg{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n,i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new rG(i.error.code,i.error.message)),s)?new pg(e,t,i.state,n):(rT(pm,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class py{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r,n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new rG(n.error.code,n.error.message)),i)?new py(e,n.state,r):(rT(pm,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pv{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=la();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sZ(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new pv(e,i):(rT(pm,`Failed to parse client data for instance '${e}': ${t}`),null)}}class p_{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new p_(t.clientId,t.onlineState):(rT(pm,`Failed to parse online state: ${e}`),null)}}class pb{constructor(){this.activeTargetIds=la()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class pS{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new sb(r8),this.started=!1,this.earlyEvents=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=pi(this.persistenceKey,this.localClientId),this.sequenceNumberKey=pp(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new pb),this.clientStateKeyRe=RegExp(`^${pn}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${ps}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${po}_${s}_(\\d+)$`),this.onlineStateKey=pu(this.persistenceKey),this.bundleLoadedKey=pd(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(pi(this.persistenceKey,e));if(t){let r=pv.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(pl(this.persistenceKey,e));if(t){let n=py.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(pl(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return rw(pm,"READ",e,t),t}setItem(e,t){rw(pm,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){rw(pm,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(rw(pm,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void rT("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=pC(t.newValue);e!==n7.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new pg(this.currentUser,e,t,r),i=pa(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=pa(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=pl(this.persistenceKey,e),i=new py(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return pv.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return pg.fromWebStorageEntry(new ry(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return py.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return p_.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void rw(pm,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=la();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function pC(e){let t=n7.INVALID;if(null!=e)try{let r=JSON.parse(e);rx("number"==typeof r,30636,{seqString:e}),t=r}catch(e){rT(pm,"Failed to read sequence number from WebStorage",e)}return t}class pw{constructor(){this.localState=new pb,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new pb,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pT{addCallback(e){}shutdown(){}}class pE{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let pI=null;function pk(){return 0x10000000+Math.round(0x80000000*Math.random())}function pR(){return null===pI?pI=pk():pI++,"0x"+pI.toString(16)}function px(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let pO="1.9.15",pA="GrpcConnection",pD=`gl-node/${process.versions.node} fire/${rv} grpc/${pO}`;function pN(e,t,r,n,i){rx(null===t||"OAuth"===t.type,36936);let s=new rm.Metadata;return t&&t.headers.forEach((e,t)=>s.set(t,e)),r&&r.headers.forEach((e,t)=>s.set(t,e)),n&&s.set("X-Firebase-GMPID",n),s.set("X-Goog-Api-Client",pD),s.set("Google-Cloud-Resource-Prefix",e),s.set("x-goog-request-params",e),i&&s.set("X-Goog-Api-Key",i),s}class pP{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){rw(pA,"Creating Firestore stub.");let e=this.databaseInfo.ssl?rm.credentials.createSsl():rm.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=pR(),a=this.ensureActiveStub(),o=pN(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),l={database:this.databasePath,...r};return px(t=>(rw(pA,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(rw(pA,`RPC '${e}' ${s} failed with error:`,r),t(new rG(l1(r.code),r.message))):(rw(pA,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=pR(),o=[],l=new rQ;rw(pA,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let c=this.ensureActiveStub(),u=pN(this.databasePath,n,i,this.databaseInfo.appId,this.databaseInfo.apiKey),h={...r,database:this.databasePath},d=c[e](h,u),f=!1;return d.on("data",t=>{rw(pA,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{rw(pA,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{rw(pA,`RPC '${e}' ${a} failed with error:`,t);let r=l1(t.code);l.reject(new rG(r,t.message))}),l.promise}openStream(e,t,r){let n=pR(),i=this.ensureActiveStub(),s=pN(this.databasePath,t,r,this.databaseInfo.appId,this.databaseInfo.apiKey),a=i[e](s),o=!1,l=e=>{o||(o=!0,c.callOnClose(e),a.end())},c=new pE({sendFn:t=>{if(o)rw(pA,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{rw(pA,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw rT("Failure sending:",t),rT("Error:",e),e}}},closeFn:()=>{rw(pA,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),u=!1;return a.on("data",t=>{o||(rw(pA,`RPC '${e}' stream ${n} received:`,t),u||(c.callOnConnected(),u=!0),c.callOnMessage(t))}),a.on("end",()=>{rw(pA,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(rE(pA,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new rG(l1(t.code),t.message)))}),rw(pA,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{c.callOnOpen()},0),c}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let pM={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var pL={nested:pM},pF=Object.freeze({__proto__:null,nested:pM,default:pL});let pB={longs:String,enums:String,defaults:!0,oneofs:!1};function pU(){let e=rg.fromJSON(pF,pB);return rm.loadPackageDefinition(e)}function pj(e){return new pP(pU(),e)}function pq(){return new pT}function pV(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function pz(){return null}function pH(e){return new cy(e,!1)}let p$="ExponentialBackoff",pW=1e3,pK=1.5,pG=6e4;class pQ{constructor(e,t,r=pW,n=pK,i=pG){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&rw(p$,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let pY="PersistentStream",pJ=6e4,pX=1e4;class pZ{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new pQ(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,pJ,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===rj?(rT(t.toString()),rT("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===rU&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new rG(rN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,pX,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return rw(pY,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(rw(pY,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class p0 extends pZ{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=cz(this.serializer,e),r=c$(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=cP(this.serializer),t.addTarget=c7(this.serializer,e);let r=c5(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=cP(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class p1 extends pZ{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return rx(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,rx(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){rx(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=cJ(e.writeResults,e.commitTime),r=cI(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=cP(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>cW(this.serializer,e))};this.sendRequest(t)}}class p2{}class p3 extends p2{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new rG(rq,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,cR(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rU&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rG(rN,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,cR(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===rU&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new rG(rN,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function p6(e,t,r,n){return new p3(e,t,r,n)}async function p4(e,t){let r=rO(e),n={writes:t.map(e=>cW(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,na.emptyPath(),n)}async function p5(e,t){let r=rO(e),n={documents:t.map(e=>cO(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,na.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=cV(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());rx(!!t,55234,{key:e}),a.push(t)}),a}async function p8(e,t,r){let n=rO(e),{request:i,aliasMap:s,parent:a}=c3(n.serializer,oF(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;let o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);rx(1===o.length,64727);let l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function p7(e,t,r){let n=rO(e);return n.verifyInitialized(),new p1(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function p9(e,t,r){let n=rO(e);return n.verifyInitialized(),new p0(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let me="OnlineStateTracker",mt=1,mr=1e4;class mn{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",mr,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${mr/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=mt&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${mt} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(rT(t),this.shouldWarnClientIsOffline=!1):rw(me,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let mi="RemoteStore",ms=10;class ma{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{my(this)&&(rw(mi,"Restarting streams for network reachability change."),await mF(this))})}),this.onlineStateTracker=new mn(r,n)}}function mo(e,t,r,n,i){return new ma(e,t,r,n,i)}async function ml(e){if(my(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function mc(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function mu(e){let t=rO(e);rw(mi,"RemoteStore shutting down."),t.offlineCauses.add(5),await mc(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function mh(e,t){let r=rO(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),mg(r)?mm(r):mj(r).isOpen()&&mf(r,t))}function md(e,t){let r=rO(e),n=mj(r);r.listenTargets.delete(t),n.isOpen()&&mp(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():my(r)&&r.onlineStateTracker.set("Unknown"))}function mf(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nT.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}mj(e).watch(t)}function mp(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),mj(e).unwatch(t)}function mm(e){e.watchChangeAggregator=new cc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),mj(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function mg(e){return my(e)&&!mj(e).isStarted()&&e.listenTargets.size>0}function my(e){return 0===rO(e).offlineCauses.size}function mv(e){e.watchChangeAggregator=void 0}async function m_(e){e.onlineStateTracker.set("Online")}async function mb(e){e.listenTargets.forEach((t,r)=>{mf(e,t)})}async function mS(e,t){mv(e),mg(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),mm(e)):e.onlineStateTracker.set("Unknown")}async function mC(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof ca&&2===t.state&&t.cause){try{await mI(e,t)}catch(r){rw(mi,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await mw(e,r)}return}if(t instanceof ci?e.watchChangeAggregator.handleDocumentChange(t):t instanceof cs?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(nT.min()))try{let t=await fL(e.localStore);r.compareTo(t)>=0&&await mE(e,r)}catch(t){rw(mi,"Failed to raise snapshot:",t),await mw(e,t)}}async function mw(e,t,r){if(nJ(t))e.offlineCauses.add(1),await mc(e),e.onlineStateTracker.set("Offline"),r||(r=()=>fL(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rw(mi,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await ml(e)});else throw t}function mT(e,t){return t().catch(r=>mw(e,r,t))}function mE(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(sA.EMPTY_BYTE_STRING,n.snapshotVersion)),mp(e,t),mf(e,new uR(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function mI(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function mk(e){let t=rO(e),r=mq(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:sY;for(;mR(t);)try{let e=await fq(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,mx(t,e)}catch(e){await mw(t,e)}mO(t)&&mA(t)}function mR(e){return my(e)&&e.writePipeline.length<ms}function mx(e,t){e.writePipeline.push(t);let r=mq(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function mO(e){return my(e)&&!mq(e).isStarted()&&e.writePipeline.length>0}function mA(e){mq(e).start()}async function mD(e){mq(e).writeHandshake()}async function mN(e){let t=mq(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function mP(e,t,r){let n=e.writePipeline.shift(),i=lY.from(n,t,r);await mT(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await mk(e)}async function mM(e,t){t&&mq(e).handshakeComplete&&await mL(e,t),mO(e)&&mA(e)}async function mL(e,t){if(l0(t.code)){let r=e.writePipeline.shift();mq(e).inhibitBackoff(),await mT(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await mk(e)}}async function mF(e){let t=rO(e);t.offlineCauses.add(4),await mc(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await ml(t)}async function mB(e,t){let r=rO(e);r.asyncQueue.verifyOperationInProgress(),rw(mi,"RemoteStore received new credentials");let n=my(r);r.offlineCauses.add(3),await mc(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await ml(r)}async function mU(e,t){let r=rO(e);t?(r.offlineCauses.delete(2),await ml(r)):t||(r.offlineCauses.add(2),await mc(r),r.onlineStateTracker.set("Unknown"))}function mj(e){return e.watchStream||(e.watchStream=p9(e.datastore,e.asyncQueue,{onConnected:m_.bind(null,e),onOpen:mb.bind(null,e),onClose:mS.bind(null,e),onWatchChange:mC.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),mg(e)?mm(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),mv(e))})),e.watchStream}function mq(e){return e.writeStream||(e.writeStream=p7(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:mD.bind(null,e),onClose:mM.bind(null,e),onHandshakeComplete:mN.bind(null,e),onMutationResult:mP.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await mk(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(rw(mi,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let mV="AsyncQueue";class mz{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new rQ,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new mz(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rG(rD,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mH(e,t){if(rT(mV,`${t}: ${e}`),nJ(e))return new rG(rW,`${t}: ${e}`);throw e}class m${static emptySet(e){return new m$(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||nc.comparator(t.key,r.key):this.comparator=(e,t)=>nc.comparator(e.key,t.key),this.keyedMap=o4(),this.sortedSet=new sb(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof m$)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new m$;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class mW{constructor(){this.changeMap=new sb(nc.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):rk(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class mK{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new mK(e,t,m$.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!oH(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class mG{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function mQ(){return new mY}class mY{constructor(){this.queries=mJ(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){m4(this,new rG(rV,"Firestore shutting down"))}}function mJ(){return new o1(e=>o$(e),oH)}async function mX(e,t){let r=rO(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new mG,n=+!t.listensToRemoteStore());try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=mH(r,`Initialization of query '${oW(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&m5(r)}async function mZ(e,t){let r=rO(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function m0(e,t){let r=rO(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&m5(r)}function m1(e,t,r){let n=rO(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function m2(e,t){let r=rO(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&m5(r)}function m3(e,t){rO(e).snapshotsInSyncListeners.add(t),t.next()}function m6(e,t){rO(e).snapshotsInSyncListeners.delete(t)}function m4(e,t){let r=rO(e),n=r.queries;r.queries=mJ(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function m5(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(_||(_={}));class m8{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new mK(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=mK.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==_.Cache}}class m7{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=li(),n=li();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new m7(e,t.fromCache,r,n)}}class m9{constructor(e){this.serializer=e}toDocumentKey(e){return cA(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?cU(this.serializer,e.document,!1):aV.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return cI(e)}}class ge{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=gt(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=na.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){let t=new Map,r=new m9(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||li()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await f1(e,new m9(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await f4(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function gt(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function gr(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class gn{constructor(e){this.key=e}}class gi{constructor(e){this.key=e}}class gs{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=li(),this.mutatedKeys=li(),this.docComparator=oZ(e),this.documentSet=new m$(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new mW,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let c=n.get(e),u=oK(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(r.track({type:3,doc:u}),f=!0):!this.shouldWaitForSyncedDocument(c,u)&&(r.track({type:2,doc:u}),f=!0,(o&&this.docComparator(u,o)>0||l&&0>this.docComparator(u,l))&&(a=!0)):!c&&u?(r.track({type:0,doc:u}),f=!0):c&&!u&&(r.track({type:1,doc:c}),f=!0,(o||l)&&(a=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>ga(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;let a=t&&!n?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!n),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new mK(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new mW,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=li(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new gi(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new gn(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=li();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return mK.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function ga(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rk(20277,{change:e})}};return r(e)-r(t)}let go="SyncEngine";class gl{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class gc{constructor(e){this.key=e,this.receivedDocument=!1}}class gu{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new o1(e=>o$(e),oH),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new sb(nc.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new dH,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ds.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function gh(e,t,r,n,i,s,a){let o=new gu(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function gd(e,t,r=!0){let n,i=gK(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await gp(i,t,r,!0),n}async function gf(e,t){let r=gK(e);await gp(r,t,!0,!1)}async function gp(e,t,r,n){let i,s=await fz(e.localStore,oL(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await gm(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&mh(e.remoteStore,s),i}async function gm(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>gP(e,t,r,n);let s=await fW(e.localStore,t,!0),a=new gs(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=cn.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),c=a.applyChanges(o,e.isPrimaryClient,l);gO(e,r,c.limboChanges);let u=new gl(t,r,a);return e.queryViewsByQuery.set(t,u),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),c.snapshot}async function gg(e,t,r){let n=rO(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!oH(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await f$(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&md(n.remoteStore,i.targetId),gR(n,i.targetId)}).catch(nV)):(gR(n,i.targetId),await f$(n.localStore,i.targetId,!0))}async function gy(e,t){let r=rO(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),md(r.remoteStore,n.targetId))}async function gv(e,t,r){let n=gG(e);try{let e=await fD(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),gI(n,e.batchId,r),await gN(n,e.changes),await mk(n.remoteStore)}catch(t){let e=mH(t,"Failed to persist write");r.reject(e)}}async function g_(e,t){let r=rO(e);try{let e=await fF(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(rx(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?rx(n.receivedDocument,14607):e.removedDocuments.size>0&&(rx(n.receivedDocument,42227),n.receivedDocument=!1))}),await gN(r,e,t)}catch(e){await nV(e)}}function gb(e,t,r){let n=rO(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),m2(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function gS(e,t,r){let n=rO(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new sb(nc.comparator);e=e.insert(s,aV.newNoDocument(s,nT.min()));let r=li().add(s),i=new cr(nT.min(),new Map,new sb(r8),e,r);await g_(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),gD(n)}else await f$(n.localStore,t,!1).then(()=>gR(n,t,r)).catch(nV)}async function gC(e,t){let r=rO(e),n=t.batch.batchId;try{let e=await fN(r.localStore,t);gk(r,n,null),gT(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await gN(r,e)}catch(e){await nV(e)}}async function gw(e,t,r){let n=rO(e);try{let e=await fM(n.localStore,t);gk(n,t,r),gT(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await gN(n,e)}catch(e){await nV(e)}}function gT(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function gE(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new rG(rD,t))})}),e.pendingWritesCallbacks.clear()}function gI(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new sb(r8)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function gk(e,t,r){let n=rO(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function gR(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||gx(e,t)})}function gx(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(md(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),gD(e))}function gO(e,t,r){for(let n of r)n instanceof gn?(e.limboDocumentRefs.addReference(n.key,t),gA(e,n)):n instanceof gi?(rw(go,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||gx(e,n.key)):rk(19791,{limboChange:n})}function gA(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(rw(go,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),gD(e))}function gD(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new nc(na.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new gc(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),mh(e.remoteStore,new uR(oL(ox(r.path)),n,"TargetPurposeLimboResolution",n7.INVALID))}}async function gN(e,t,r){let n=rO(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){let t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);let t=m7.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await fj(n.localStore,s))}async function gP(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await fW(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return gO(e,t.targetId,o.limboChanges),o.snapshot}async function gM(e,t){let r=rO(e);if(!r.currentUser.isEqual(t)){rw(go,"User change. New user:",t.toKey());let e=await fA(r.localStore,t);r.currentUser=t,gE(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await gN(r,e.affectedDocuments)}}function gL(e,t){let r=rO(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return li().add(n.key);{let e=li(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function gF(e,t){let r=rO(e),n=await fW(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&gO(r,t.targetId,i.limboChanges),i}async function gB(e,t){let r=rO(e);return fX(r.localStore,t).then(e=>gN(r,e))}async function gU(e,t,r,n){let i=rO(e),s=await fG(i.localStore,t);null===s?rw(go,"Cannot apply mutation batch with id: "+t):("pending"===r?await mk(i.remoteStore):"acknowledged"===r||"rejected"===r?(gk(i,t,n||null),gT(i,t),fQ(i.localStore,t)):rk(6720,"Unknown batchState",{batchState:r}),await gN(i,s))}async function gj(e,t){let r=rO(e);if(gK(r),gG(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await gV(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await mU(r.remoteStore,!0),t))mh(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(gR(r,i),f$(r.localStore,i,!0))),md(r.remoteStore,i)}),await t,await gV(r,e),gq(r),r._isPrimaryClient=!1,await mU(r.remoteStore,!1)}}function gq(e){let t=rO(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{md(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new sb(nc.comparator)}async function gV(e,t,r){let n=rO(e),i=[],s=[];for(let e of t){let t,r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await fz(n.localStore,oL(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await gF(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await fJ(n.localStore,e);t=await fz(n.localStore,r),await gm(n,gz(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function gz(e){return oR(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function gH(e){return fY(rO(e).localStore)}async function g$(e,t,r,n){let i=rO(e);if(i._isPrimaryClient)return void rw(go,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await fX(i.localStore,oX(s[0])),n=cr.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,sA.EMPTY_BYTE_STRING);await gN(i,e,n);break}case"rejected":await f$(i.localStore,t,!0),gR(i,t,n);break;default:rk(64155,r)}}async function gW(e,t,r){let n=gK(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){rw(go,"Adding an already active target "+e);continue}let t=await fJ(n.localStore,e),r=await fz(n.localStore,t);await gm(n,gz(t),r.targetId,!1,r.resumeToken),mh(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await f$(n.localStore,e,!1).then(()=>{md(n.remoteStore,e),gR(n,e)}).catch(nV)}}function gK(e){let t=rO(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=g_.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=gL.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=gS.bind(null,t),t.syncEngineListener.onWatchChange=m0.bind(null,t.eventManager),t.syncEngineListener.onWatchError=m1.bind(null,t.eventManager),t}function gG(e){let t=rO(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=gC.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=gw.bind(null,t),t}function gQ(e,t,r){let n=rO(e);gY(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function gY(e,t,r){try{let n=await t.getMetadata();if(await f2(e.localStore,n))return await t.close(),r._completeWith(gr(n)),Promise.resolve(new Set);r._updateProgress(gt(n));let i=new ge(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await gN(e,a.changedDocs,void 0),await f3(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return rE(go,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class gJ{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pH(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return fO(this.persistence,new pr,e.initialUser,this.serializer)}createPersistence(e){return new d0(d2.factory,this.serializer)}createSharedClientState(e){return new pw}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gJ.provider={build:()=>new gJ};class gX extends gJ{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return rx(this.persistence.referenceDelegate instanceof d3,46915),new dS(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?dp.withCacheSize(this.cacheSizeBytes):dp.DEFAULT;return new d0(e=>d3.factory(e,t),this.serializer)}}class gZ extends gJ{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await gG(this.onlineComponentProvider.syncEngine),await mk(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return fO(this.persistence,new pr,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new dS(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new n8(t,this.persistence);return new n5(e.asyncQueue,r)}createPersistence(e){let t=fT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?dp.withCacheSize(this.cacheSizeBytes):dp.DEFAULT;return new fS(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,pV(),pz(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new pw}}class g0 extends gZ{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof pS&&(this.sharedClientState.syncEngine={applyBatchState:gU.bind(null,t),applyTargetState:g$.bind(null,t),applyActiveTargetsChange:gW.bind(null,t),getActiveClients:gH.bind(null,t),synchronizeWithChangedDocuments:gB.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await gj(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=pV();if(!pS.isAvailable(t))throw new rG(rH,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=fT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new pS(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class g1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>gb(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gM.bind(null,this.syncEngine),await mU(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return mQ()}createDatastore(e){let t=pH(e.databaseInfo.databaseId),r=pj(e.databaseInfo);return p6(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return mo(this.localStore,this.datastore,e.asyncQueue,e=>gb(this.syncEngine,e,0),pq())}createSyncEngine(e,t){return gh(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await mu(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}g1.provider={build:()=>new g1};let g2=10240;function g3(e,t=g2){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function g6(e,t){if(!(e instanceof Uint8Array))throw new rG(rP,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${nm(e)}`);return g3(e,t)}class g4{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):rT("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class g5{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class g8{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rQ,this.buffer=new Uint8Array,this.textDecoder=l5(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new g5(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function g7(e,t){return new g8(e,t)}class g9{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new g5(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new rG(r$,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}function ye(e,t){return new g9(e,t)}class yt{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new rG(rP,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await p5(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new l$(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=nc.fromPath(t);this.mutations.push(new lG(r,this.precondition(r)))}),await p4(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=nT.min();else throw rk(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new rG(rV,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?lR.none():t.isEqual(nT.min())?lR.exists(!1):lR.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return lR.exists(!0);if(t.isEqual(nT.min()))throw new rG(rP,"Can't update a document that doesn't exist.");return lR.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class yr{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.attemptsRemaining=r.maxAttempts,this.backoff=new pQ(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new yt(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(sJ(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e?.name==="FirebaseError"){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lZ(t)}return!1}}let yn="FirestoreClient",yi=100,ys=11,ya=20,yo=22;class yl{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=ry.UNAUTHENTICATED,this.clientId=r5.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{rw(yn,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(rw(yn,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:yi}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rQ;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=mH(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function yc(e,t){e.asyncQueue.verifyOperationInProgress(),rw(yn,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await fA(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function yu(e,t){e.asyncQueue.verifyOperationInProgress();let r=await yd(e);rw(yn,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>mB(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>mB(t.remoteStore,r)),e._onlineComponents=t}function yh(e){return"FirebaseError"===e.name?e.code===rq||e.code===rH:!("u">typeof DOMException&&e instanceof DOMException)||e.code===yo||e.code===ya||e.code===ys}async function yd(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rw(yn,"Using user provided OfflineComponentProvider");try{await yc(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!yh(t))throw t;rE("Error using user provided cache. Falling back to memory cache: "+t),await yc(e,new gJ)}}else rw(yn,"Using default OfflineComponentProvider"),await yc(e,new gX(void 0));return e._offlineComponents}async function yf(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rw(yn,"Using user provided OnlineComponentProvider"),await yu(e,e._uninitializedComponentsProvider._online)):(rw(yn,"Using default OnlineComponentProvider"),await yu(e,new g1))),e._onlineComponents}function yp(e){return yd(e).then(e=>e.localStore)}function ym(e){return yf(e).then(e=>e.syncEngine)}function yg(e){return yf(e).then(e=>e.datastore)}async function yy(e){let t=await yf(e),r=t.eventManager;return r.onListen=gd.bind(null,t.syncEngine),r.onUnlisten=gg.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=gf.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=gy.bind(null,t.syncEngine),r}function yv(e,t,r,n){let i=new g4(n),s=new m8(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>mX(await yy(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>mZ(await yy(e),s))}}function y_(e,t){let r=new rQ;return e.asyncQueue.enqueueAndForget(async()=>yk(await yp(e),t,r)),r.promise}function yb(e,t,r={}){let n=new rQ;return e.asyncQueue.enqueueAndForget(async()=>yR(await yy(e),e.asyncQueue,t,r,n)),n.promise}function yS(e,t){let r=new rQ;return e.asyncQueue.enqueueAndForget(async()=>yx(await yp(e),t,r)),r.promise}function yC(e,t,r={}){let n=new rQ;return e.asyncQueue.enqueueAndForget(async()=>yO(await yy(e),e.asyncQueue,t,r,n)),n.promise}function yw(e,t,r){let n=new rQ;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await yg(e);n.resolve(p8(i,t,r))}catch(e){n.reject(e)}}),n.promise}function yT(e,t){let r=new rQ;return e.asyncQueue.enqueueAndForget(async()=>gv(await ym(e),t,r)),r.promise}function yE(e,t){let r=new g4(t);return e.asyncQueue.enqueueAndForget(async()=>m3(await yy(e),r)),()=>{r.mute(),e.asyncQueue.enqueueAndForget(async()=>m6(await yy(e),r))}}function yI(e,t,r){let n=new rQ;return e.asyncQueue.enqueueAndForget(async()=>{let i=await yg(e);new yr(e.asyncQueue,i,r,t,n).run()}),n.promise}async function yk(e,t,r){try{let n=await fV(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new rG(rW,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=mH(n,`Failed to get document '${t} from cache`);r.reject(e)}}function yR(e,t,r,n,i){let s=new g4({next:o=>{s.mute(),t.enqueueAndForget(()=>mZ(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new rG(rW,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new rG(rW,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new m8(ox(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mX(e,a)}async function yx(e,t,r){try{let n=await fW(e,t,!0),i=new gs(t,n.remoteKeys),s=i.computeDocChanges(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=mH(n,`Failed to execute query '${t} against cache`);r.reject(e)}}function yO(e,t,r,n,i){let s=new g4({next:r=>{s.mute(),t.enqueueAndForget(()=>mZ(e,a)),r.fromCache&&"server"===n.source?i.reject(new rG(rW,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new m8(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mX(e,a)}function yA(e,t,r,n){let i=yN(r,pH(t));e.asyncQueue.enqueueAndForget(async()=>{gQ(await ym(e),i,n)})}function yD(e,t){return e.asyncQueue.enqueue(async()=>f6(await yp(e),t))}function yN(e,t){let r;return g7(g6(r="string"==typeof e?l4().encode(e):e),t)}function yP(e,t){return ye(e,t)}function yM(e,t){return e.asyncQueue.enqueue(async()=>f5(await yp(e),t))}function yL(e,t){return e.asyncQueue.enqueue(async()=>f8(await yp(e),t))}function yF(e){return e.asyncQueue.enqueue(async()=>f7(await yp(e)))}function yB(e,t){return e.timeoutSeconds===t.timeoutSeconds}function yU(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let yj="ComponentProvider",yq=new Map;function yV(e){let t=yq.get(e);t&&(rw(yj,"Removing Datastore"),yq.delete(e),t.terminate())}function yz(e,t,r,n,i){return new sW(e,t,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,yU(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,n)}let yH="firestore.googleapis.com",y$=!0,yW=5,yK=30,yG=!0;class yQ{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new rG(rP,"Can't provide ssl option if host option is not set");this.host=yH,this.ssl=y$}else this.host=e.host,this.ssl=e.ssl??y$;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=df;else if(e.cacheSizeBytes!==dd&&e.cacheSizeBytes<dg)throw new rG(rP,`cacheSizeBytes must be at least ${dg}`);else this.cacheSizeBytes=e.cacheSizeBytes;nh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yG:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yU(e.experimentalLongPollingOptions??{}),yY(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&yB(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function yY(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rG(rP,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<yW)throw new rG(rP,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${yW})`);if(e.timeoutSeconds>yK)throw new rG(rP,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${yK})`)}}class yJ{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rG(rq,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rG(rq,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yQ(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=r6(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return yV(this),Promise.resolve()}}function yX(e,t,r,n={}){e=ny(e,yJ);let i=eu(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(eh(`https://${o}`),ef("Firestore",!0)),s.host!==yH&&s.host!==o&&rE("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!eq(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=ry.MOCK_USER;else{t=ed(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new rG(rP,"mockUserToken must contain 'sub' or 'user_id' field!");r=new ry(i)}e._authCredentials=new rX(new rY(t,r))}}class yZ{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new yZ(this.firestore,e,this._query)}}class y0{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new y1(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new y0(this.firestore,e,this._key)}toJSON(){return{type:y0._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(nb(t,y0._jsonSchema))return new y0(e,r||null,new nc(na.fromString(t.referencePath)))}}y0._jsonSchemaVersion="firestore/documentReference/1.0",y0._jsonSchema={type:n_("string",y0._jsonSchemaVersion),referencePath:n_("string")};class y1 extends yZ{constructor(e,t,r){super(e,t,ox(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new y0(this.firestore,null,new nc(e))}withConverter(e){return new y1(this.firestore,e,this._path)}}function y2(e,t,...r){if(e=e0(e),nu("collection","path",t),e instanceof yJ){let n=na.fromString(t,...r);return nf(n),new y1(e,null,n)}{if(!(e instanceof y0)&&!(e instanceof y1))throw new rG(rP,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(na.fromString(t,...r));return nf(n),new y1(e.firestore,null,n)}}function y3(e,t,...r){if(e=e0(e),1==arguments.length&&(t=r5.newId()),nu("doc","path",t),e instanceof yJ){let n=na.fromString(t,...r);return nd(n),new y0(e,null,new nc(n))}{if(!(e instanceof y0)&&!(e instanceof y1))throw new rG(rP,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(na.fromString(t,...r));return nd(n),new y0(e.firestore,e instanceof y1?e.converter:null,new nc(n))}}function y6(e,t){return e=e0(e),t=e0(t),e instanceof yZ&&t instanceof yZ&&e.firestore===t.firestore&&oH(e._query,t._query)&&e.converter===t.converter}let y4="AsyncQueue";class y5{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new pQ(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rQ;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(nJ(e))rw(y4,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,rT("INTERNAL UNHANDLED ERROR: ",y8(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=mz.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&rk(47125,{messageOrStack:y8(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function y8(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class y7{constructor(){this._progressObserver={},this._taskCompletionResolver=new rQ,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let y9=dd;class ve extends yJ{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new y5,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new y5(e),this._firestoreClient=void 0,await e}}}function vt(e,t,r){r||(r=sK);let n=tj(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r});if(eq(n.getOptions(r),t))return e;throw new rG(rq,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new rG(rP,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&t.cacheSizeBytes!==y9&&t.cacheSizeBytes<dg)throw new rG(rP,`cacheSizeBytes must be at least ${dg}`);return t.host&&eu(t.host)&&eh(t.host),n.initialize({options:t,instanceIdentifier:r})}function vr(e,t){let r="object"==typeof e?e:tZ(),n="string"==typeof e?e:t||sK,i=tj(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=eo("firestore");e&&yX(i,...e)}return i}function vn(e){if(e._terminated)throw new rG(rq,"The client has already been terminated.");return e._firestoreClient||vi(e),e._firestoreClient}function vi(e){let t=e._freezeSettings(),r=yz(e._databaseId,e._app?.options.appId||"",e._persistenceKey,e._app?.options.apiKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new yl(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&vs(e._componentsProvider))}function vs(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function va(e,t){let r=vn(e=ny(e,ve)),n=new y7;return yA(r,e._databaseId,t,n),n}function vo(e,t){return yD(vn(e=ny(e,ve)),t).then(t=>t?new yZ(e,null,t.query):null)}class vl{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class vc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vc(sA.fromBase64String(e))}catch(e){throw new rG(rP,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vc(sA.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:vc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nb(e,vc._jsonSchema))return vc.fromBase64String(e.bytes)}}vc._jsonSchemaVersion="firestore/bytes/1.0",vc._jsonSchema={type:n_("string",vc._jsonSchemaVersion),bytes:n_("string")};class vu{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rG(rP,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class vh{constructor(e){this._methodName=e}}class vd{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rG(rP,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rG(rP,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return r8(this._lat,e._lat)||r8(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:vd._jsonSchemaVersion}}static fromJSON(e){if(nb(e,vd._jsonSchema))return new vd(e.latitude,e.longitude)}}vd._jsonSchemaVersion="firestore/geoPoint/1.0",vd._jsonSchema={type:n_("string",vd._jsonSchemaVersion),latitude:n_("number"),longitude:n_("number")};class vf{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return fI(this._values,e._values)}toJSON(){return{type:vf._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nb(e,vf._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new vf(e.vectorValues);throw new rG(rP,"Expected 'vectorValues' field to be a number array")}}}vf._jsonSchemaVersion="firestore/vectorValue/1.0",vf._jsonSchema={type:n_("string",vf._jsonSchemaVersion),vectorValues:n_("object")};let vp=/^__.*__$/;class vm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new lU(e,this.data,this.fieldMask,t,this.fieldTransforms):new lL(e,this.data,t,this.fieldTransforms)}}class vg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new lU(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vy(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rk(40011,{dataSource:e})}}class vv{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new vv({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return vF(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(vy(this.dataSource)&&vp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class v_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pH(e)}createContext(e,t,r,n=!1){return new vv({dataSource:e,methodName:t,targetDoc:r,path:nl.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function vb(e){let t=e._freezeSettings(),r=pH(e._databaseId);return new v_(e._databaseId,!!t.ignoreUndefinedProperties,r)}function vS(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);vN("Data must be an object, but it was:",l,n);let c=vk(n,l);if(s.merge)a=new sR(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=vP(t,n,r);if(!l.contains(i))throw new rG(rP,`Field '${i}' is specified in your field mask but missing from your input data.`);vB(e,i)||e.push(i)}a=new sR(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new vm(new aj(c),a,o)}class vC extends vh{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof vC}}function vw(e,t,r,n){let i=e.createContext(1,t,r);vN("Data must be an object, but it was:",i,n);let s=[],a=aj.empty();return sy(n,(e,n)=>{let o=vL(t,e,r);n=e0(n);let l=i.childContextForFieldPath(o);if(n instanceof vC)s.push(o);else{let e=vI(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new vg(a,new sR(s),i.fieldTransforms)}function vT(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[vP(t,n,r)],l=[i];if(s.length%2!=0)throw new rG(rP,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(vP(t,s[e])),l.push(s[e+1]);let c=[],u=aj.empty();for(let e=o.length-1;e>=0;--e)if(!vB(c,o[e])){let t=o[e],r=l[e];r=e0(r);let n=a.childContextForFieldPath(t);if(r instanceof vC)c.push(t);else{let e=vI(r,n);null!=e&&(c.push(t),u.set(t,e))}}return new vg(u,new sR(c),a.fieldTransforms)}function vE(e,t,r,n=!1){return vI(r,e.createContext(n?4:3,t))}function vI(e,t){if(vD(e=e0(e)))return vN("Unsupported field value:",t,e),vk(e,t);if(e instanceof vh)return vx(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return vO(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return vR(e,t)}function vk(e,t){let r={};return s_(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sy(e,(e,n)=>{let i=vI(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function vR(e,t){let r=[],n=0;for(let i of e){let e=vI(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function vx(e,t){if(!vy(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function vO(e,t){if(null===(e=e0(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return lc(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=nw.fromDate(e);return{timestampValue:cS(t.serializer,r)}}else if(e instanceof nw){let r=new nw(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:cS(t.serializer,r)}}else if(e instanceof vd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof vc)return{bytesValue:cw(t.serializer,e._byteString)};else if(e instanceof y0){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:ck(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof vf)return vA(e,t);else if(uk(e))return e._toProto(t.serializer);else throw t.createError(`Unsupported field value: ${nm(e)}`)}function vA(e,t){return{mapValue:{fields:{[s0]:{stringValue:s3},[s6]:{arrayValue:{values:(e instanceof vf?e.toArray():e).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return lo(t.serializer,e)})}}}}}}function vD(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof nw)&&!(e instanceof vd)&&!(e instanceof vc)&&!(e instanceof y0)&&!(e instanceof vh)&&!(e instanceof vf)&&!uk(e)}function vN(e,t,r){if(!vD(r)||!np(r)){let n=nm(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function vP(e,t,r){if((t=e0(t))instanceof vu)return t._internalPath;if("string"==typeof t)return vL(e,t);throw vF("Field path arguments must be of type string or ",e,!1,void 0,r)}let vM=RegExp("[~\\*/\\[\\]]");function vL(e,t,r){if(t.search(vM)>=0)throw vF(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new vu(...t.split("."))._internalPath}catch(n){throw vF(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function vF(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new rG(rP,o+e+l)}function vB(e,t){return e.some(e=>e.isEqual(t))}class vU{convertValue(e,t="none"){switch(s5(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sL(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sF(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw rk(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return sy(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new vf(e.fields?.[s6].arrayValue?.values?.map(e=>sL(e.doubleValue)))}convertGeoPoint(e){return new vd(sL(e.latitude),sL(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=sH(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(s$(e));default:return null}}convertTimestamp(e){let t=sM(e);return new nw(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=na.fromString(e);rx(uI(r),9688,{name:e});let n=new sG(r.get(1),r.get(3)),i=new nc(r.popFirst(5));return n.isEqual(t)||rT(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class vj extends vU{constructor(e){super(),this.firestore=e}convertBytes(e){return new vc(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new y0(this.firestore,null,t)}}let vq="@firebase/firestore",vV="4.11.0";function vz(e,t=!0){r_(tY),tU(new e1("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new ve(new rZ(e.getProvider("auth-internal")),new r3(i,e.getProvider("app-check-internal")),sQ(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),t2(vq,vV,e),t2(vq,vV,"esm2020")}class vH{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class v${constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new aj({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class vW{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new y0(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new vK(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(vP("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vK extends vW{data(){return super.data()}}function vG(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rG(rH,"limitToLast() queries require specifying at least one orderBy() clause")}class vQ{}class vY extends vQ{}function vJ(e,t,...r){let n=[];for(let i of(t instanceof vQ&&n.push(t),_g(n=n.concat(r)),n))e=i._apply(e);return e}class vX extends vY{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vX(e,t,r)}_apply(e){let t=this._parse(e);return _d(e._query,t),new yZ(e.firestore,e.converter,oU(e._query,t))}_parse(e){let t=vb(e.firestore);return _s(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vZ(e,t,r){let n=t,i=vP("where",e);return vX._create(i,n,r)}class v0 extends vQ{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new v0(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:a1.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(_f(e._query,t),new yZ(e.firestore,e.converter,oU(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function v1(...e){return e.forEach(e=>_m("or",e)),v0._create("or",e)}function v2(...e){return e.forEach(e=>_m("and",e)),v0._create("and",e)}class v3 extends vY{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new v3(e,t)}_apply(e){let t=_a(e._query,this._field,this._direction);return new yZ(e.firestore,e.converter,oj(e._query,t))}}function v6(e,t="asc"){let r=t,n=vP("orderBy",e);return v3._create(n,r)}class v4 extends vY{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new v4(e,t,r)}_apply(e){return new yZ(e.firestore,e.converter,oq(e._query,this._limit,this._limitType))}}function v5(e){return nv("limit",e),v4._create("limit",e,"F")}function v8(e){return nv("limitToLast",e),v4._create("limitToLast",e,"L")}class v7 extends vY{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new v7(e,t,r)}_apply(e){let t=_i(e,this.type,this._docOrFields,this._inclusive);return new yZ(e.firestore,e.converter,oV(e._query,t))}}function v9(...e){return v7._create("startAt",e,!0)}function _e(...e){return v7._create("startAfter",e,!1)}class _t extends vY{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new _t(e,t,r)}_apply(e){let t=_i(e,this.type,this._docOrFields,this._inclusive);return new yZ(e.firestore,e.converter,oz(e._query,t))}}function _r(...e){return _t._create("endBefore",e,!1)}function _n(...e){return _t._create("endAt",e,!0)}function _i(e,t,r,n){if(r[0]=e0(r[0]),r[0]instanceof vW)return _o(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=vb(e.firestore);return _l(e._query,e.firestore._databaseId,i,t,r,n)}}function _s(e,t,r,n,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new rG(rP,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){_u(a,s);let t=[];for(let r of a)t.push(_c(n,e,r));o={arrayValue:{values:t}}}else o=_c(n,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&_u(a,s),o=vE(r,t,a,"in"===s||"not-in"===s);return a0.create(i,s,o)}function _a(e,t,r){if(null!==e.startAt)throw new rG(rP,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new rG(rP,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new aQ(t,r)}function _o(e,t,r,n,i){if(!n)throw new rG(rL,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of oM(e))if(r.field.isKeyField())s.push(aT(t,n.key));else{let e=n.data.field(r.field);if(sV(e))throw new rG(rP,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new rG(rP,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new aH(s,i)}function _l(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new rG(rP,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new rG(rP,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!oP(e)&&-1!==l.indexOf("/"))throw new rG(rP,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(na.fromString(l));if(!nc.isDocumentKey(r))throw new rG(rP,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new nc(r);o.push(aT(t,i))}else{let e=vE(r,n,l);o.push(e)}}return new aH(o,s)}function _c(e,t,r){if("string"==typeof(r=e0(r))){if(""===r)throw new rG(rP,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oP(t)&&-1!==r.indexOf("/"))throw new rG(rP,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(na.fromString(r));if(!nc.isDocumentKey(n))throw new rG(rP,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return aT(e,new nc(n))}if(r instanceof y0)return aT(e,r._key);throw new rG(rP,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nm(r)}.`)}function _u(e,t){if(!Array.isArray(e)||0===e.length)throw new rG(rP,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function _h(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function _d(e,t){let r=_p(e.filters,_h(t.op));if(null!==r)if(r===t.op)throw new rG(rP,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new rG(rP,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function _f(e,t){let r=e;for(let e of t.getFlattenedFilters())_d(r,e),r=oU(r,e)}function _p(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function _m(e,t){if(!(t instanceof vX)&&!(t instanceof v0))throw new rG(rP,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function _g(e){let t=e.filter(e=>e instanceof v0).length,r=e.filter(e=>e instanceof vX).length;if(t>1||t>0&&r>0)throw new rG(rP,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function _y(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class _v extends vU{constructor(e){super(),this.firestore=e}convertBytes(e){return new vc(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new y0(this.firestore,null,t)}}function __(e){return new vH("sum",vP("sum",e))}function _b(e){return new vH("avg",vP("average",e))}function _S(){return new vH("count")}function _C(e,t){return e instanceof vH&&t instanceof vH&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function _w(e,t){return y6(e.query,t.query)&&eq(e.data(),t.data())}function _T(e){return _E(e,{count:_S()})}function _E(e,t){let r=ny(e.firestore,ve),n=vn(r),i=sv(t,(e,t)=>new vl(t,e.aggregateType,e._internalFieldPath));return yw(n,e._query,i).then(t=>_I(r,e,t))}function _I(e,t,r){return new v$(t,new vj(e),r)}class _k{constructor(e){this.kind="memory",this._onlineComponentProvider=g1.provider,e?.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new gX(void 0)}}toJSON(){return{kind:this.kind}}}class _R{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=_F(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class _x{constructor(){this.kind="memoryEager",this._offlineComponentProvider=gJ.provider}toJSON(){return{kind:this.kind}}}class _O{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new gX(e)}}toJSON(){return{kind:this.kind}}}function _A(){return new _x}function _D(e){return new _O(e?.cacheSizeBytes)}function _N(e){return new _k(e)}function _P(e){return new _R(e)}class _M{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=g1.provider,this._offlineComponentProvider={build:t=>new gZ(t,e?.cacheSizeBytes,this.forceOwnership)}}}class _L{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=g1.provider,this._offlineComponentProvider={build:t=>new g0(t,e?.cacheSizeBytes)}}}function _F(e){return new _M(e?.forceOwnership)}function _B(){return new _L}let _U=l4();function _j(e){let t=JSON.stringify(e),r=_U.encode(t).byteLength;return`${r}${t}`}_j({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),_j({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),_j({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),_j({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),_j({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),_j({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),_j({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),_j({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let _q=1;class _V{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new nw(0,0),this.databaseId=e._databaseId,this.serializer=new cy(this.databaseId,!0),this.userDataReader=new v_(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?cC(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:cO(this.serializer,e.documentKey),readTime:i?cS(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new nw(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=c2(this.serializer,oL(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:cS(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=vk(e.documentData,t);return{name:cO(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:cS(this.serializer,e.versionTime),createTime:cS(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=_U.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:cS(this.serializer,this.latestReadTime),version:_q,totalDocuments:this.documents.size,totalBytes:_U.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function _z(e,t,r,n){let i=new _V(e,r5.newId());return i.addBundleDocument(_$(n,r,t)),i.build()}function _H(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(_$(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},c=new _V(e,r);return c.addBundleQuery(l),c.build()}function _$(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}let _W="NOT SUPPORTED";class _K{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _G extends vW{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new _Y(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(vP("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new rG(rq,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=_G._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=_z(this._firestore,e,r,this.ref.path),t}}function _Q(e,t,r){if(nb(t,_G._jsonSchema)){if(t.bundle===_W)throw new rG(rP,"The provided JSON object was created in a client environment, which is not supported.");let n=pH(e._databaseId),i=yP(t.bundle,n),s=i.getElements(),a=new ge(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);let o=a.documents;if(1!==o.length)throw new rG(rP,`Expected bundle data to contain 1 document, but it contains ${o.length} documents.`);let l=cU(n,o[0].document),c=new nc(na.fromString(t.bundleName));return new _G(e,new _v(e),c,l,new _K(!1,!1),r||null)}}_G._jsonSchemaVersion="firestore/documentSnapshot/1.0",_G._jsonSchema={type:n_("string",_G._jsonSchemaVersion),bundleSource:n_("string","DocumentSnapshot"),bundleName:n_("string"),bundle:n_("string")};class _Y extends _G{data(e={}){return super.data(e)}}class _J{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new _K(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new _Y(this._firestore,this._userDataWriter,r.key,r,new _K(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rG(rP,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=_Z(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new rG(rq,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=_J._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=r5.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=_H(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function _X(e,t,r){if(nb(t,_J._jsonSchema)){if(t.bundle===_W)throw new rG(rP,"The provided JSON object was created in a client environment, which is not supported.");let n=pH(e._databaseId),i=yP(t.bundle,n),s=i.getElements(),a=new ge(i.getMetadata(),n);for(let e of s)a.addSizedElement(e);if(1!==a.queries.length)throw new rG(rP,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let o=u$(a.queries[0].bundledQuery),l=a.documents,c=new m$;l.map(e=>{let t=cU(n,e.document);c=c.add(t)});let u=mK.fromInitialDocuments(o,c,li(),!1,!1),h=new yZ(e,r||null,o);return new _J(e,new _v(e),h,u)}}function _Z(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new _Y(e._firestore,e._userDataWriter,r.doc.key,r.doc,new _K(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new _Y(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _K(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:_0(t.type),doc:n,oldIndex:i,newIndex:s}})}}function _0(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rk(61501,{type:e})}}function _1(e,t){return e instanceof _G&&t instanceof _G?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _J&&t instanceof _J&&e._firestore===t._firestore&&y6(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}_J._jsonSchemaVersion="firestore/querySnapshot/1.0",_J._jsonSchema={type:n_("string",_J._jsonSchemaVersion),bundleSource:n_("string","QuerySnapshot"),bundleName:n_("string"),bundle:n_("string")};let _2={maxAttempts:5};function _3(e){if(e.maxAttempts<1)throw new rG(rP,"Max attempts must be at least 1")}class _6{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=vb(e)}set(e,t,r){this._verifyNotCommitted();let n=_4(e,this._firestore),i=_y(n.converter,t,r),s=vS(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,lR.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=_4(e,this._firestore);return i="string"==typeof(t=e0(t))||t instanceof vu?vT(this._dataReader,"WriteBatch.update",s._key,t,r,n):vw(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,lR.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=_4(e,this._firestore);return this._mutations=this._mutations.concat(new l$(t._key,lR.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new rG(rq,"A write batch can no longer be used after commit() has been called.")}}function _4(e,t){if((e=e0(e)).firestore===t)return e;throw new rG(rP,"Provided document reference is from a different Firestore instance.")}class _5{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=vb(e)}get(e){let t=_4(e,this._firestore),r=new _v(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return rk(24041);let n=e[0];if(n.isFoundDocument())return new vW(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new vW(this._firestore,r,t._key,null,t.converter);throw rk(18433,{doc:n})})}set(e,t,r){let n=_4(e,this._firestore),i=_y(n.converter,t,r),s=vS(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=_4(e,this._firestore);return i="string"==typeof(t=e0(t))||t instanceof vu?vT(this._dataReader,"Transaction.update",s._key,t,r,n):vw(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=_4(e,this._firestore);return this._transaction.delete(t._key),this}}class _8 extends _5{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=_4(e,this._firestore),r=new vj(this._firestore);return super.get(e).then(e=>new _G(this._firestore,r,t._key,e._document,new _K(!1,!1),t.converter))}}function _7(e,t,r){e=ny(e,ve);let n={..._2,...r};return _3(n),yI(vn(e),r=>t(new _8(e,r)),n)}function _9(e){return be(e,["next","error","complete"])}function be(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}function bt(e){e=ny(e,y0);let t=ny(e.firestore,ve);return yb(vn(t),e._key).then(r=>bm(t,e,r))}function br(e){e=ny(e,y0);let t=ny(e.firestore,ve),r=vn(t),n=new vj(t);return y_(r,e._key).then(r=>new _G(t,n,e._key,r,new _K(null!==r&&r.hasLocalMutations,!0),e.converter))}function bn(e){e=ny(e,y0);let t=ny(e.firestore,ve);return yb(vn(t),e._key,{source:"server"}).then(r=>bm(t,e,r))}function bi(e){e=ny(e,yZ);let t=ny(e.firestore,ve),r=vn(t),n=new vj(t);return vG(e._query),yC(r,e._query).then(r=>new _J(t,n,e,r))}function bs(e){e=ny(e,yZ);let t=ny(e.firestore,ve),r=vn(t),n=new vj(t);return yS(r,e._query).then(r=>new _J(t,n,e,r))}function ba(e){e=ny(e,yZ);let t=ny(e.firestore,ve),r=vn(t),n=new vj(t);return yC(r,e._query,{source:"server"}).then(r=>new _J(t,n,e,r))}function bo(e,t,r){e=ny(e,y0);let n=ny(e.firestore,ve),i=_y(e.converter,t,r),s=vS(vb(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,lR.none());return bp(n,[s])}function bl(e,t,r,...n){let i;e=ny(e,y0);let s=ny(e.firestore,ve),a=vb(s);return bp(s,[(i="string"==typeof(t=e0(t))||t instanceof vu?vT(a,"updateDoc",e._key,t,r,n):vw(a,"updateDoc",e._key,t)).toMutation(e._key,lR.exists(!0))])}function bc(e){return bp(ny(e.firestore,ve),[new l$(e._key,lR.none())])}function bu(e,t){let r=ny(e.firestore,ve),n=y3(e),i=_y(e.converter,t);return bp(r,[vS(vb(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,lR.exists(!1))]).then(()=>n)}function bh(e,...t){let r,n,i;e=e0(e);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[0]||_9(t[a])||(s=t[a++]);let o={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(_9(t[a])){let e=t[a];t[a]=e.next?.bind(e),t[a+1]=e.error?.bind(e),t[a+2]=e.complete?.bind(e)}if(e instanceof y0)n=ny(e.firestore,ve),i=ox(e._key.path),r={next:r=>{t[a]&&t[a](bm(n,e,r))},error:t[a+1],complete:t[a+2]};else{let s=ny(e,yZ);n=ny(s.firestore,ve),i=s._query;let o=new vj(n);r={next:e=>{t[a]&&t[a](new _J(n,o,s,e))},error:t[a+1],complete:t[a+2]},vG(e._query)}return yv(vn(n),i,o,r)}function bd(e,t,...r){let n,i=e0(e),s=bg(t);if(s.error)throw new rG(rP,s.error);let a=0;if("object"!=typeof r[0]||_9(r[a])||(n=r[a++]),"QuerySnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&_9(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return bv(i,s,n,e,r[a])}if("DocumentSnapshot"===s.bundleSource){let e=null;if("object"==typeof r[a]&&_9(r[a])){let t=r[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:r[a++],error:r[a++],complete:r[a++]};return by(i,s,n,e,r[a])}throw new rG(rP,`unsupported bundle source: ${s.bundleSource}`)}function bf(e,t){return yE(vn(e=ny(e,ve)),_9(t)?t:{next:t})}function bp(e,t){return yT(vn(e),t)}function bm(e,t,r){let n=r.docs.get(t._key),i=new vj(e);return new _G(e,i,t._key,n,new _K(r.hasPendingWrites,r.fromCache),t.converter)}function bg(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}function by(e,t,r,n,i){let s,a=!1;return va(e,t.bundle).then(()=>{a||(s=bh(new y0(e,i||null,nc.fromPath(t.bundleName)),r||{},n))}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function bv(e,t,r,n,i){let s,a=!1;return va(e,t.bundle).then(()=>vo(e,t.bundleName)).then(e=>{if(e&&!a){let t=e;i&&t.withConverter(i),s=bh(e,r||{},n)}}).catch(e=>(n.error&&n.error(e),()=>{})),()=>{!a&&(a=!0,s&&s())}}function b_(e){return vn(e=ny(e,ve)),new _6(e,t=>bp(e,t))}function bb(e,t){let r=vn(e=ny(e,ve));return r._uninitializedComponentsProvider&&"memory"!==r._uninitializedComponentsProvider._offline.kind?yM(r,bS(t)):(rE("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function bS(e){let t="string"==typeof e?bC(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=bw(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=vL("setIndexConfiguration",bw(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new nN(e,2)):"ASCENDING"===t.order?n.push(new nN(e,0)):"DESCENDING"===t.order&&n.push(new nN(e,1))}r.push(new nk(nk.UNKNOWN_ID,t,n,nM.empty()))}return r}function bC(e){try{return JSON.parse(e)}catch(e){throw new rG(rP,"Failed to parse JSON: "+e?.message)}}function bw(e,t){if("string"!=typeof e[t])throw new rG(rP,"Missing string value for: "+t);return e[t]}class bT{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function bE(e){e=ny(e,ve);let t=bO.get(e);if(t)return t;let r=vn(e);if(r._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let n=new bT(e);return bO.set(e,n),n}function bI(e){bx(e,!0)}function bk(e){bx(e,!1)}function bR(e){yF(vn(e._firestore)).then(e=>rw("deleting all persistent cache indexes succeeded")).catch(e=>rE("deleting all persistent cache indexes failed",e))}function bx(e,t){yL(vn(e._firestore),t).then(e=>rw(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>rE(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let bO=new WeakMap;class bA{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return bD.instance.onExistenceFilterMismatch(e)}}class bD{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return bN||l6(bN=new bD),bN}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let bN=null;function bP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}vz("node"),e.s(["AggregateField",()=>vH,"AggregateQuerySnapshot",()=>v$,"DocumentSnapshot",()=>_G,"PersistentCacheIndexManager",()=>bT,"QueryCompositeFilterConstraint",()=>v0,"QueryConstraint",()=>vY,"QueryDocumentSnapshot",()=>_Y,"QueryEndAtConstraint",()=>_t,"QueryFieldFilterConstraint",()=>vX,"QueryLimitConstraint",()=>v4,"QueryOrderByConstraint",()=>v3,"QuerySnapshot",()=>_J,"QueryStartAtConstraint",()=>v7,"SnapshotMetadata",()=>_K,"Transaction",()=>_8,"WriteBatch",()=>_6,"_TestingHooks",()=>bA,"addDoc",()=>bu,"aggregateFieldEqual",()=>_C,"aggregateQuerySnapshotEqual",()=>_w,"and",()=>v2,"average",()=>_b,"count",()=>_S,"deleteAllPersistentCacheIndexes",()=>bR,"deleteDoc",()=>bc,"disablePersistentCacheIndexAutoCreation",()=>bk,"documentSnapshotFromJSON",()=>_Q,"enablePersistentCacheIndexAutoCreation",()=>bI,"endAt",()=>_n,"endBefore",()=>_r,"executeWrite",()=>bp,"getAggregateFromServer",()=>_E,"getCountFromServer",()=>_T,"getDoc",()=>bt,"getDocFromCache",()=>br,"getDocFromServer",()=>bn,"getDocs",()=>bi,"getDocsFromCache",()=>bs,"getDocsFromServer",()=>ba,"getPersistentCacheIndexManager",()=>bE,"limit",()=>v5,"limitToLast",()=>v8,"memoryEagerGarbageCollector",()=>_A,"memoryLocalCache",()=>_N,"memoryLruGarbageCollector",()=>_D,"onSnapshot",()=>bh,"onSnapshotResume",()=>bd,"onSnapshotsInSync",()=>bf,"or",()=>v1,"orderBy",()=>v6,"persistentLocalCache",()=>_P,"persistentMultipleTabManager",()=>_B,"persistentSingleTabManager",()=>_F,"query",()=>vJ,"querySnapshotFromJSON",()=>_X,"runTransaction",()=>_7,"setDoc",()=>bo,"setIndexConfiguration",()=>bb,"snapshotEqual",()=>_1,"startAfter",()=>_e,"startAt",()=>v9,"sum",()=>__,"updateDoc",()=>bl,"where",()=>vZ,"writeBatch",()=>b_],92178),e.i(92178),t2("firebase","12.9.0","app"),e.i(15710);let bM=bP,bL=new ex("auth","Firebase",bP()),bF=new tr("@firebase/auth");function bB(e,...t){bF.logLevel<=m.WARN&&bF.warn(`Auth (${tY}): ${e}`,...t)}function bU(e,...t){bF.logLevel<=m.ERROR&&bF.error(`Auth (${tY}): ${e}`,...t)}function bj(e,...t){throw bH(e,...t)}function bq(e,...t){return bH(e,...t)}function bV(e,t,r){return new ex("auth","Firebase",{...bM(),[t]:r}).create(t,{appName:e.name})}function bz(e){return bV(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function bH(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return bL.create(e,...t)}function b$(e,t,...r){if(!e)throw bH(t,...r)}function bW(e){let t="INTERNAL ASSERTION FAILED: "+e;throw bU(t),Error(t)}function bK(e,t){e||bW(t)}function bG(){return"http:"===bQ()||"https:"===bQ()}function bQ(){return"u">typeof self&&self.location?.protocol||null}function bY(){return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(bG()||eb()||"connection"in navigator))||navigator.onLine}function bJ(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}class bX{constructor(e,t){this.shortDelay=e,this.longDelay=t,bK(t>e,"Short delay should be less than long delay!"),this.isMobile=em()||eS()}get(){return bY()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function bZ(e,t){bK(e.emulator,"Emulator should always be set here");let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class b0{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void bW("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void bW("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void bW("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let b1={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},b2=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],b3=new bX(3e4,6e4);function b6(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function b4(e,t,r,n,i={}){return b5(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=ez({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return e_()||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&eu(e.emulatorConfig.host)&&(l.credentials="include"),b0.fetch()(await b7(e,e.config.apiHost,r,a),l)})}async function b5(e,t,r){e._canInitEmulator=!1;let n={...b1,...t};try{let t=new Se(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw St(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw St(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw St(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw St(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw bV(e,a,r);bj(e,a)}}catch(t){if(t instanceof eR)throw t;bj(e,"network-request-failed",{message:String(t)})}}async function b8(e,t,r,n,i={}){let s=await b4(e,t,r,n,i);return"mfaPendingCredential"in s&&bj(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function b7(e,t,r,n){let i=`${t}${r}?${n}`,s=e,a=s.config.emulator?bZ(e.config,i):`${e.config.apiScheme}://${i}`;return b2.includes(r)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(a).toString():a}function b9(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Se{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(bq(this.auth,"network-request-failed")),b3.get())})}}function St(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=bq(e,t,n);return i.customData._tokenResponse=r,i}function Sr(e){return void 0!==e&&void 0!==e.enterprise}class Sn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return b9(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Si(e,t){return b4(e,"GET","/v2/recaptchaConfig",b6(e,t))}async function Ss(e,t){return b4(e,"POST","/v1/accounts:delete",t)}async function Sa(e,t){return b4(e,"POST","/v1/accounts:lookup",t)}function So(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function Sl(e,t=!1){let r=e0(e),n=await r.getIdToken(t),i=Su(n);b$(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:So(Sc(i.auth_time)),issuedAtTime:So(Sc(i.iat)),expirationTime:So(Sc(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Sc(e){return 1e3*Number(e)}function Su(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return bU("JWT malformed, contained fewer than 3 sections"),null;try{let e=J(r);if(!e)return bU("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return bU("Caught error parsing JWT payload as JSON",e?.toString()),null}}function Sh(e){let t=Su(e);return b$(t,"internal-error"),b$(void 0!==t.exp,"internal-error"),b$(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Sd(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof eR&&Sf(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function Sf({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class Sp{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Sm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=So(this.lastLoginAt),this.creationTime=So(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Sg(e){let t=e.auth,r=await e.getIdToken(),n=await Sd(e,Sa(t,{idToken:r}));b$(n?.users.length,t,"internal-error");let i=n.users[0];e._notifyReloadListener(i);let s=i.providerUserInfo?.length?S_(i.providerUserInfo):[],a=Sv(e.providerData,s),o=e.isAnonymous,l=!(e.email&&i.passwordHash)&&!a?.length,c=!!o&&l;Object.assign(e,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Sm(i.createdAt,i.lastLoginAt),isAnonymous:c})}async function Sy(e){let t=e0(e);await Sg(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Sv(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function S_(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Sb(e,t){let r=await b5(e,{},async()=>{let r=ez({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await b7(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&eu(e.emulatorConfig.host)&&(o.credentials="include"),b0.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function SS(e,t){return b4(e,"POST","/v2/accounts:revokeToken",b6(e,t))}class SC{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){b$(e.idToken,"internal-error"),b$(void 0!==e.idToken,"internal-error"),b$(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Sh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){b$(0!==e.length,"internal-error");let t=Sh(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(b$(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await Sb(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new SC;return r&&(b$("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(b$("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(b$("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new SC,this.toJSON())}_performRefresh(){return bW("not implemented")}}function Sw(e,t){b$("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ST{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new Sp(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new Sm(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await Sd(this,this.stsTokenManager.getToken(this.auth,e));return b$(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Sl(this,e)}reload(){return Sy(this)}_assign(e){this!==e&&(b$(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new ST({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){b$(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Sg(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tH(this.auth.app))return Promise.reject(bz(this.auth));let e=await this.getIdToken();return await Sd(this,Ss(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;b$(u&&p,e,"internal-error");let m=SC.fromJSON(this.name,p);b$("string"==typeof u,e,"internal-error"),Sw(r,e.name),Sw(n,e.name),b$("boolean"==typeof h,e,"internal-error"),b$("boolean"==typeof d,e,"internal-error"),Sw(i,e.name),Sw(s,e.name),Sw(a,e.name),Sw(o,e.name),Sw(l,e.name),Sw(c,e.name);let g=new ST({uid:u,auth:e,email:n,emailVerified:h,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:c});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let n=new SC;n.updateFromServerResponse(t);let i=new ST({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await Sg(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];b$(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?S_(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new SC;a.updateFromIdToken(r);let o=new ST({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new Sm(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}let SE=new Map;function SI(e){bK(e instanceof Function,"Expected a class definition");let t=SE.get(e);return t?bK(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,SE.set(e,t)),t}class Sk{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Sk.type="NONE";let SR=Sk;function Sx(e,t,r){return`firebase:${e}:${t}:${r}`}class SO{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=Sx(this.userKey,n.apiKey,i),this.fullPersistenceKey=Sx("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await Sa(this.auth,{idToken:e}).catch(()=>void 0);return t?ST._fromGetAccountInfoResponse(this.auth,t,e):null}return ST._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new SO(SI(SR),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||SI(SR),s=Sx(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await Sa(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await ST._fromGetAccountInfoResponse(e,r,t)}else n=ST._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new SO(i,e,r)}}function SA(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(SM(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(SD(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(SF(t))return"Blackberry";if(SB(t))return"Webos";if(SN(t))return"Safari";if((t.includes("chrome/")||SP(t))&&!t.includes("edge/"))return"Chrome";if(SL(t))return"Android";let r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if(n?.length===2)return n[1]}return"Other"}function SD(e=ep()){return/firefox\//i.test(e)}function SN(e=ep()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function SP(e=ep()){return/crios\//i.test(e)}function SM(e=ep()){return/iemobile/i.test(e)}function SL(e=ep()){return/android/i.test(e)}function SF(e=ep()){return/blackberry/i.test(e)}function SB(e=ep()){return/webos/i.test(e)}function SU(e,t=[]){let r;switch(e){case"Browser":r=SA(ep());break;case"Worker":r=`${SA(ep())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${tY}/${n}`}class Sj{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function Sq(e,t={}){return b4(e,"GET","/v2/passwordPolicy",b6(e,t))}let SV=6;class Sz{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??SV,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class SH{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new SW(this),this.idTokenSubscription=new SW(this),this.beforeStateQueue=new Sj(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=SI(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await SO.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await Sa(this,{idToken:e}),r=await ST._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(tH(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(r=s.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(b$(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Sg(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=bJ()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tH(this.app))return Promise.reject(bz(this));let t=e?e0(e):null;return t&&b$(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&b$(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tH(this.app)?Promise.reject(bz(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tH(this.app)?Promise.reject(bz(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(SI(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new Sz(await Sq(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ex("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await SS(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&SI(e)||this._popupRedirectResolver;b$(t,this,"argument-error"),this.redirectPersistenceManager=await SO.create(this,[SI(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(b$(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return b$(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=SU(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(tH(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&bB(`Error while retrieving App Check token: ${e.error}`),e?.token}}function S$(e){return e0(e)}class SW{constructor(e){this.auth=e,this.observer=null,this.addObserver=eK(e=>this.observer=e)}get next(){return b$(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class SK{constructor(){this.enterprise=new SG}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class SG{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let SQ="recaptcha-enterprise",SY="NO_RECAPTCHA";class SJ{constructor(e){this.type=SQ,this.auth=S$(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{Si(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new Sn(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;Sr(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(SY)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new SK().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{!t&&Sr(window.grecaptcha)?n(r,e,i):i(Error("RecaptchaVerifier is only supported in browser"))}).catch(e=>{i(e)})})}}async function SX(e,t,r,n=!1,i=!1){let s,a=new SJ(e);if(i)s=SY;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function SZ(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await SX(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await SX(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await SX(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await SX(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await SX(e,t,r,!1,!0);return n(e,i)}}function S0(e,t){let r=tj(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(eq(r.getOptions(),t??{}))return e;bj(e,"already-initialized")}return r.initialize({options:t})}function S1(e,t){let r=t?.persistence||[],n=(Array.isArray(r)?r:[r]).map(SI);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t?.popupRedirectResolver)}function S2(e,t,r){let n=S$(e);b$(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=!!r?.disableWarnings,s=S3(t),{host:a,port:o}=S6(t),l=null===o?"":`:${o}`,c={url:`${s}//${a}${l}/`},u=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){b$(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),b$(eq(c,n.config.emulator)&&eq(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=c,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,eu(a)?(eh(`${s}//${a}${l}`),ef("Auth",!0)):i||S5()}function S3(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function S6(e){let t=S3(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:S4(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:S4(t)}}}function S4(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function S5(){"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}class S8{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return bW("not implemented")}_getIdTokenResponse(e){return bW("not implemented")}_linkToIdToken(e,t){return bW("not implemented")}_getReauthenticationResolver(e){return bW("not implemented")}}async function S7(e,t){return b4(e,"POST","/v1/accounts:signUp",t)}async function S9(e,t){return b8(e,"POST","/v1/accounts:signInWithPassword",b6(e,t))}async function Ce(e,t){return b8(e,"POST","/v1/accounts:signInWithEmailLink",b6(e,t))}async function Ct(e,t){return b8(e,"POST","/v1/accounts:signInWithEmailLink",b6(e,t))}class Cr extends S8{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new Cr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Cr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return SZ(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",S9,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Ce(e,{email:this._email,oobCode:this._password});default:bj(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return SZ(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",S7,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Ct(e,{idToken:t,email:this._email,oobCode:this._password});default:bj(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Cn(e,t){return b8(e,"POST","/v1/accounts:signInWithIdp",b6(e,t))}let Ci="http://localhost";class Cs extends S8{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new Cs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):bj("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new Cs(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return Cn(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,Cn(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Cn(e,t)}buildRequest(){let e={requestUri:Ci,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ez(t)}return e}}function Ca(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Co(e){let t=eH(e$(e)).link,r=t?eH(e$(t)).deep_link_id:null,n=eH(e$(e)).deep_link_id;return(n?eH(e$(n)).link:null)||n||r||t||e}class Cl{constructor(e){const t=eH(e$(e)),r=t.apiKey??null,n=t.oobCode??null,i=Ca(t.mode??null);b$(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=Co(e);try{return new Cl(t)}catch{return null}}}class Cc{constructor(){this.providerId=Cc.PROVIDER_ID}static credential(e,t){return Cr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=Cl.parseLink(t);return b$(r,"argument-error"),Cr._fromEmailAndCode(e,r.code,r.tenantId)}}Cc.PROVIDER_ID="password",Cc.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Cc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Cu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ch extends Cu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Cd extends Ch{constructor(){super("facebook.com")}static credential(e){return Cs._fromParams({providerId:Cd.PROVIDER_ID,signInMethod:Cd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cd.credentialFromTaggedObject(e)}static credentialFromError(e){return Cd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cd.credential(e.oauthAccessToken)}catch{return null}}}Cd.FACEBOOK_SIGN_IN_METHOD="facebook.com",Cd.PROVIDER_ID="facebook.com";class Cf extends Ch{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Cs._fromParams({providerId:Cf.PROVIDER_ID,signInMethod:Cf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Cf.credentialFromTaggedObject(e)}static credentialFromError(e){return Cf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Cf.credential(t,r)}catch{return null}}}Cf.GOOGLE_SIGN_IN_METHOD="google.com",Cf.PROVIDER_ID="google.com";class Cp extends Ch{constructor(){super("github.com")}static credential(e){return Cs._fromParams({providerId:Cp.PROVIDER_ID,signInMethod:Cp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cp.credentialFromTaggedObject(e)}static credentialFromError(e){return Cp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cp.credential(e.oauthAccessToken)}catch{return null}}}Cp.GITHUB_SIGN_IN_METHOD="github.com",Cp.PROVIDER_ID="github.com";class Cm extends Ch{constructor(){super("twitter.com")}static credential(e,t){return Cs._fromParams({providerId:Cm.PROVIDER_ID,signInMethod:Cm.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Cm.credentialFromTaggedObject(e)}static credentialFromError(e){return Cm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Cm.credential(t,r)}catch{return null}}}Cm.TWITTER_SIGN_IN_METHOD="twitter.com",Cm.PROVIDER_ID="twitter.com";class Cg{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Cy._fromServerResponse(e,t):"totpInfo"in t?Cv._fromServerResponse(e,t):bj(e,"internal-error")}}class Cy extends Cg{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Cy(t)}}class Cv extends Cg{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Cv(t)}}function C_(e,t){return b4(e,"POST","/v2/accounts/mfaEnrollment:start",b6(e,t))}function Cb(e,t){return b4(e,"POST","/v2/accounts/mfaEnrollment:finalize",b6(e,t))}new WeakMap;var CS="@firebase/auth",CC="1.12.0";class Cw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){b$(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function CT(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function CE(e){tU(new e1("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;b$(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new SH(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:SU(e)});return S1(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),tU(new e1("auth-internal",e=>new Cw(S$(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),t2(CS,CC,CT(e)),t2(CS,CC,"esm2020")}function CI(e=tZ()){let t=tj(e,"auth");if(t.isInitialized())return t.getImmediate();let r=S0(e),n=ea("auth");return n&&S2(r,`http://${n}`),r}function Ck(e,t){return b4(e,"POST","/v2/accounts/mfaSignIn:finalize",b6(e,t))}b0.initialize(fetch,Headers,Response),CE("Node"),bq("operation-not-supported-in-this-environment"),SH.prototype.setPersistence=async()=>{};class CR{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return bW("unexpected MultiFactorSessionType")}}}class Cx{static assertionForEnrollment(e,t){return CO._fromSecret(e,t)}static assertionForSignIn(e,t){return CO._fromEnrollmentId(e,t)}static async generateSecret(e){let t=e;b$(void 0!==t.user?.auth,"internal-error");let r=await C_(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return CA._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}Cx.FACTOR_ID="totp";class CO extends CR{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new CO(t,void 0,e)}static _fromEnrollmentId(e,t){return new CO(t,e)}async _finalizeEnroll(e,t,r){return b$(void 0!==this.secret,e,"argument-error"),Cb(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){b$(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return Ck(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class CA{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new CA(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let r=!1;return(CD(e)||CD(t))&&(r=!0),r&&(CD(e)&&(e=this.auth.currentUser?.email||"unknownuser"),CD(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function CD(e){return void 0===e||e?.length===0}e.s([],43972),e.i(43972);let CN="functions";class CP{constructor(e,t,r,n){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,tH(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||r.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n?.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{let e=await this.auth.getToken();return e?.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){let t=await this.getAuthToken();return{authToken:t,messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let CM="us-central1";class CL{constructor(e,t,r,n,i=CM,s=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new CP(e,t,r,n),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(i);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=CM}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;if(null!==this.emulatorOrigin){let r=this.emulatorOrigin;return`${r}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function CF(e,t,r){let n=eu(t);e.emulatorOrigin=`http${n?"s":""}://${t}:${r}`,n&&(eh(e.emulatorOrigin+"/backends"),ef("Functions",!0))}let CB="@firebase/functions",CU="0.13.1",Cj="auth-internal",Cq="app-check-internal",CV="messaging-internal";function Cz(e=tZ(),t=CM){let r=tj(e0(e),CN).getImmediate({identifier:t}),n=eo("functions");return n&&CH(r,...n),r}function CH(e,t,r){CF(e0(e),t,r)}!function(e){tU(new e1(CN,(e,{instanceIdentifier:t})=>new CL(e.getProvider("app").getImmediate(),e.getProvider(Cj),e.getProvider(CV),e.getProvider(Cq),t),"PUBLIC").setMultipleInstances(!0)),t2(CB,CU,void 0),t2(CB,CU,"esm2020")}();let C$="firebasestorage.googleapis.com",CW="storageBucket",CK=12e4,CG=6e5;class CQ extends eR{constructor(e,t,r=0){super(CY(e),`Firebase Storage: ${t} (${CY(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,CQ.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return CY(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function CY(e){return"storage/"+e}function CJ(){let e="An unknown error occurred, please check the error payload for server response.";return new CQ(b.UNKNOWN,e)}function CX(){return new CQ(b.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function CZ(){return new CQ(b.CANCELED,"User canceled the upload/download.")}function C0(e){return new CQ(b.INVALID_URL,"Invalid URL '"+e+"'.")}function C1(e){return new CQ(b.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function C2(e){return new CQ(b.INVALID_ARGUMENT,e)}function C3(){return new CQ(b.APP_DELETED,"The Firebase app was deleted.")}function C6(e){return new CQ(b.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(b||(b={}));class C4{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=C4.makeFromUrl(e,t)}catch(t){return new C4(e,"")}if(""===r.path)return r;throw C1(e)}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)";function i(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}let s=RegExp("^gs://"+n+"(/(.*))?$","i"),a={bucket:1,path:3};function o(e){e.path_=decodeURIComponent(e.path)}let l="v[A-Za-z0-9_]+",c=t.replace(/[.]/g,"\\."),u="(/([^?#]*).*)?$",h=RegExp(`^https?://${c}/${l}/b/${n}/o${u}`,"i"),d=t===C$?"(?:storage.googleapis.com|storage.cloud.google.com)":t,f="([^?#]*)",p=[{regex:s,indices:a,postModify:i},{regex:h,indices:{bucket:1,path:3},postModify:o},{regex:RegExp(`^https?://${d}/${n}/${f}`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let t=0;t<p.length;t++){let n=p[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new C4(e,t),n.postModify(r);break}}if(null==r)throw C0(e);return r}}class C5{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function C8(e,t,r){let n=1,i=null,s=null,a=!1,o=0;function l(){return 2===o}let c=!1;function u(...e){c||(c=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(f,l())},t)}function d(){s&&clearTimeout(s)}function f(e,...t){let r;if(c)return void d();if(e||l()||a){d(),u.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,h(r)}let p=!1;function m(e){p||(p=!0,d(),!c&&(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,m(!0)},r),m}function C7(e){e(!1)}function C9(e){return void 0!==e}function we(e,t,r,n){if(n<t)throw C2(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw C2(`Invalid value for '${e}'. Expected ${r} or less.`)}function wt(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}function wr(e,t){let r=e>=500&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(S||(S={}));class wn{constructor(e,t,r,n,i,s,a,o,l,c,u,h=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new wi(!1,null,!0));let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let t=r.getErrorCode()===S.NO_ERROR,i=r.getStatus();!t||wr(i,this.additionalRetryCodes_)&&this.retry?e(!1,new wi(!1,null,r.getErrorCode()===S.ABORT)):e(!0,new wi(-1!==this.successCodes_.indexOf(i),r))})},t=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());C9(e)?r(e):r()}catch(e){n(e)}else if(null!==i){let e=CJ();e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?C3():CZ():CX())};this.canceled_?t(!1,new wi(!1,null,!0)):this.backoffId_=C8(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&C7(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class wi{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function ws(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}function wa(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function wo(e,t){t&&(e["X-Firebase-GMPID"]=t)}function wl(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}function wc(e,t,r,n,i,s,a=!0,o=!1){let l=wt(e.urlParams),c=e.url+l,u=Object.assign({},e.headers);return wo(u,t),ws(u,r),wa(u,s),wl(u,n),new wn(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}function wu(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}function wh(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}class wd{constructor(e,t){this._service=e,t instanceof C4?this._location=t:this._location=C4.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new wd(e,t)}get root(){let e=new C4(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wh(this._location.path)}get storage(){return this._service}get parent(){let e=wu(this._location.path);if(null===e)return null;let t=new C4(this._location.bucket,e);return new wd(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw C6(e)}}function wf(e,t){let r=t?.[CW];return null==r?null:C4.makeFromBucketSpec(r,e)}function wp(e,t,r,n={}){e.host=`${t}:${r}`;let i=eu(t);i&&(eh(`https://${e.host}/b`),ef("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"==typeof s?s:ed(s,e.app.options.projectId))}class wm{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=C$,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=CK,this._maxUploadRetryTime=CG,this._requests=new Set,null!=n?this._bucket=C4.makeFromBucketSpec(n,this._host):this._bucket=wf(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=C4.makeFromBucketSpec(this._url,e):this._bucket=wf(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){we("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){we("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(tH(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new wd(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new C5(C3());{let s=wc(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let wg="@firebase/storage",wy="0.14.0",wv="storage";function w_(e=tZ(),t){let r=tj(e=e0(e),wv).getImmediate({identifier:t}),n=eo("storage");return n&&wb(r,...n),r}function wb(e,t,r,n={}){wp(e,t,r,n)}function wS(e,{instanceIdentifier:t}){return new wm(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,tY)}!function(){tU(new e1(wv,wS,"PUBLIC").setMultipleInstances(!0)),t2(wg,wy)}();var wC=e.i(51900);let ww="5",wT="v",wE="s",wI="r",wk="f",wR=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wx="ls",wO="p",wA="ac",wD="websocket",wN="long_polling";class wP{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eF(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let wM=function(e){return new wP},wL=wM("localStorage"),wF=wM("sessionStorage"),wB=new tr("@firebase/database"),wU=function(){let e=1;return function(){return e++}}(),wj=function(e){let t=eX(e),r=new eW;r.update(t);let n=r.digest();return K.encodeByteArray(n)},wq=function(...e){let t="";for(let r=0;r<e.length;r++){let n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=wq.apply(null,n):"object"==typeof n?t+=eN(n):t+=n,t+=" "}return t},wV=null,wz=!0,wH=function(e,t){z(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(wB.logLevel=m.VERBOSE,wV=wB.log.bind(wB),t&&wF.set("logging_enabled",!0)):"function"==typeof e?wV=e:(wV=null,wF.remove("logging_enabled"))},w$=function(...e){if(!0===wz&&(wz=!1,null===wV&&!0===wF.get("logging_enabled")&&wH(!0)),wV){let t=wq.apply(null,e);wV(t)}},wW=function(e){return function(...t){w$(e,...t)}},wK=function(...e){let t="FIREBASE INTERNAL ERROR: "+wq(...e);wB.error(t)},wG=function(...e){let t=`FIREBASE FATAL ERROR: ${wq(...e)}`;throw wB.error(t),Error(t)},wQ=function(...e){let t="FIREBASE WARNING: "+wq(...e);wB.warn(t)},wY=function(){},wJ=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},wX=function(e){if(eC()||"complete"===document.readyState)e();else{let t=!1,r=function(){document.body?t||(t=!0,e()):setTimeout(r,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&r()}),window.attachEvent("onload",r))}},wZ="[MIN_NAME]",w0="[MAX_NAME]",w1=function(e,t){if(e===t)return 0;{if(e===wZ||t===w0)return -1;if(t===wZ||e===w0)return 1;let r=Tn(e),n=Tn(t);if(null!==r)if(null!==n)return r-n==0?e.length-t.length:r-n;else return -1;return null!==n?1:e<t?-1:1}},w2=function(e,t){return e===t?0:e<t?-1:1},w3=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+eN(t))},w6=function(e){if("object"!=typeof e||null===e)return eN(e);let t=[];for(let r in e)t.push(r);t.sort();let r="{";for(let n=0;n<t.length;n++)0!==n&&(r+=","),r+=eN(t[n]),r+=":",r+=w6(e[t[n]]);return r+"}"},w4=function(e,t){let r=e.length;if(r<=t)return[e];let n=[];for(let i=0;i<r;i+=t)i+t>r?n.push(e.substring(i,r)):n.push(e.substring(i,i+t));return n};function w5(e,t){for(let r in e)e.hasOwnProperty(r)&&t(r,e[r])}let w8=function(e){let t,r,n,i,s;z(!wJ(e),"Invalid JSON number");let a=11,o=52,l=1023;0===e?(r=0,n=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=Math.pow(2,1-l)?(r=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),l))+l,n=Math.round(e*Math.pow(2,o-i)-Math.pow(2,o))):(r=0,n=Math.round(e/Math.pow(2,1-l-o))));let c=[];for(s=o;s;s-=1)c.push(n%2?1:0),n=Math.floor(n/2);for(s=a;s;s-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(+!!t),c.reverse();let u=c.join(""),h="";for(s=0;s<64;s+=8){let e=parseInt(u.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()},w7=function(){return!1},w9=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},Te=RegExp("^-?(0*)\\d{1,10}$"),Tt=-0x80000000,Tr=0x7fffffff,Tn=function(e){if(Te.test(e)){let t=Number(e);if(t>=Tt&&t<=Tr)return t}return null},Ti=function(e){try{e()}catch(e){setTimeout(()=>{throw wQ("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},Ts=function(){return"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ta=function(e,t){let r=setTimeout(e,t);return"number"==typeof r&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(r):"object"==typeof r&&r.unref&&r.unref(),r};class To{constructor(e,t,r,n,i=!1,s="",a=!1,o=!1,l=null){this.secure=t,this.namespace=r,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=wL.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&wL.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Tl(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function Tc(e,t,r){let n;if(z("string"==typeof t,"typeof type must == string"),z("object"==typeof r,"typeof params must == object"),t===wD)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===wN)n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);Tl(e)&&(r.ns=e.namespace);let i=[];return w5(r,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}class Tu{constructor(){this.counters_={}}incrementCounter(e,t=1){eF(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return X(this.counters_)}}let Th={},Td={};function Tf(e){let t=e.toString();return Th[t]||(Th[t]=new Tu),Th[t]}function Tp(e,t){let r=e.toString();return Td[r]||(Td[r]=t()),Td[r]}let Tm="";function Tg(e){Tm=e}let Ty=16384,Tv=45e3,T_=null;function Tb(e){T_=e}"u">typeof MozWebSocket?T_=MozWebSocket:"u">typeof WebSocket&&(T_=WebSocket);class TS{constructor(e,t,r,n,i,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wW(this.connId),this.stats_=Tf(t),this.connURL=TS.connectionURL_(t,s,a,n,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,n,i){let s={};return s[wT]=ww,!eC()&&"u">typeof location&&location.hostname&&wR.test(location.hostname)&&(s[wI]=wk),t&&(s[wE]=t),r&&(s[wx]=r),n&&(s[wA]=n),i&&(s[wO]=i),Tc(e,wD,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,wL.set("previous_websocket_failure",!0);try{let e;if(eC()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${ww}/${Tm}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let r=process.env,n=0===this.connURL.indexOf("wss://")?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;n&&(e.proxy={origin:n})}this.mySock=new T_(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){TS.forceDisallow_=!0}static isAvailable(){let e=!1;if("u">typeof navigator&&navigator.userAgent){let t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&4.4>parseFloat(r[1])&&(e=!0)}return!e&&null!==T_&&!TS.forceDisallow_}static previouslyFailed(){return wL.isInMemoryStorage||!0===wL.get("previous_websocket_failure")}markConnectionHealthy(){wL.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=eD(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(z(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=eN(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=w4(t,Ty);r.length>1&&this.sendString_(String(r.length));for(let e=0;e<r.length;e++)this.sendString_(r[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Tv))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}TS.responsesRequiredToBeHealthy=2,TS.healthyTimeout=3e4;let TC="@firebase/database",Tw="1.1.0";class TT{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tH(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){wQ(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class TE{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(w$("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',wQ(e)}}class TI{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}TI.OWNER="owner";class Tk{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Ti(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let TR="start",Tx="close",TO="pLPCommand",TA="pRTLPCB",TD="id",TN="pw",TP="ser",TM="cb",TL="seg",TF="ts",TB="d",TU="dframe",Tj=1870,Tq=30,TV=1840,Tz=25e3,TH=3e4;class T${constructor(e,t,r,n,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wW(e),this.stats_=Tf(t),this.urlFn=e=>(this.appCheckToken&&(e[wA]=this.appCheckToken),Tc(t,wN,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Tk(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(TH)),wX(()=>{if(this.isClosed_)return;this.scriptTagHolder=new TW((...e)=>{let[t,r,n,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===TR)this.id=r,this.password=n;else if(t===Tx)r?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(r,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,r]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,r)},()=>{this.onClosed_()},this.urlFn);let e={};e[TR]="t",e[TP]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e[TM]=this.scriptTagHolder.uniqueCallbackIdentifier),e[wT]=ww,this.transportSessionId&&(e[wE]=this.transportSessionId),this.lastSessionId&&(e[wx]=this.lastSessionId),this.applicationId&&(e[wO]=this.applicationId),this.appCheckToken&&(e[wA]=this.appCheckToken),"u">typeof location&&location.hostname&&wR.test(location.hostname)&&(e[wI]=wk);let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){T$.forceAllow_=!0}static forceDisallow(){T$.forceDisallow_=!0}static isAvailable(){return!eC()&&(!!T$.forceAllow_||!T$.forceDisallow_&&"u">typeof document&&null!=document.createElement&&!w7()&&!w9())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=eN(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=w4(Q(t),TV);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(eC())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[TU]="t",r[TD]=e,r[TN]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=eN(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class TW{constructor(e,t,r,n){if(this.onDisconnect=r,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,eC())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=wU(),window[TO+this.uniqueCallbackIdentifier]=e,window[TA+this.uniqueCallbackIdentifier]=t,this.myIFrame=TW.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";</script>');const n="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){w$("frame writing exception"),e.stack&&w$(e.stack),w$(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||w$("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e[TD]=this.myID,e[TN]=this.myPW,e[TP]=this.currentSerial;let t=this.urlFn(e),r="",n=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+Tq+r.length<=Tj){let e=this.pendingSegs.shift();r=r+"&"+TL+n+"="+e.seg+"&"+TF+n+"="+e.ts+"&"+TB+n+"="+e.d,n++}else break;return t+=r,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(r,Math.floor(Tz)),i=()=>{clearTimeout(n),r()};this.addTag(e,i)}addTag(e,t){eC()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{w$("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))}}class TK{static get ALL_TRANSPORTS(){return[T$,TS]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=TS&&TS.isAvailable(),r=t&&!TS.previouslyFailed();if(e.webSocketOnly&&(t||wQ("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[TS];else{let e=this.transports_=[];for(let t of TK.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);TK.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}TK.globalTransportInitialized_=!1;let TG=6e4,TQ=5e3,TY=10240,TJ=102400,TX="t",TZ="d",T0="s",T1="r",T2="e",T3="o",T6="a",T4="n",T5="p",T8="h";class T7{constructor(e,t,r,n,i,s,a,o,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wW("c:"+this.id+":"),this.transportManager_=new TK(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=Ta(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>TJ?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>TY?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(TX in e){let t=e[TX];t===T6?this.upgradeIfSecondaryHealthy_():t===T1?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===T3&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=w3("t",e),r=w3("d",e);if("c"===t)this.onSecondaryControl_(r);else if("d"===t)this.pendingDataMessages.push(r);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:T5,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:T6,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:T4,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=w3("t",e),r=w3("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=w3(TX,e);if(TZ in e){let r=e[TZ];if(t===T8){let e={...r};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if(t===T4){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===T0?this.onConnectionShutdown_(r):t===T1?this.onReset_(r):t===T2?wK("Server Error: "+r):t===T3?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):wK("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ww!==r&&wQ("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Ta(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(TG))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ta(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(TQ))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:T5,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(wL.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class T9{put(e,t,r,n){}merge(e,t,r,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class Ee{constructor(e){this.allowedEvents_=e,this.listeners_={},z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let n=this.getInitialEvent(e);n&&t.apply(r,n)}off(e,t,r){this.validateEventType_(e);let n=this.listeners_[e]||[];for(let e=0;e<n.length;e++)if(n[e].callback===t&&(!r||r===n[e].context))return void n.splice(e,1)}validateEventType_(e){z(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Et extends Ee{static getInstance(){return new Et}constructor(){super(["online"]),this.online_=!0}getInitialEvent(e){return z("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}let Er=32,En=768;class Ei{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Es(){return new Ei("")}function Ea(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Eo(e){return e.pieces_.length-e.pieceNum_}function El(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Ei(e.pieces_,t)}function Ec(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Eu(e){let t="";for(let r=e.pieceNum_;r<e.pieces_.length;r++)""!==e.pieces_[r]&&(t+="/"+encodeURIComponent(String(e.pieces_[r])));return t||"/"}function Eh(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Ed(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let r=e.pieceNum_;r<e.pieces_.length-1;r++)t.push(e.pieces_[r]);return new Ei(t,0)}function Ef(e,t){let r=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)r.push(e.pieces_[t]);if(t instanceof Ei)for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&r.push(e[t])}return new Ei(r,0)}function Ep(e){return e.pieceNum_>=e.pieces_.length}function Em(e,t){let r=Ea(e),n=Ea(t);if(null===r)return t;if(r===n)return Em(El(e),El(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Eg(e,t){if(Eo(e)!==Eo(t))return!1;for(let r=e.pieceNum_,n=t.pieceNum_;r<=e.pieces_.length;r++,n++)if(e.pieces_[r]!==t.pieces_[n])return!1;return!0}function Ey(e,t){let r=e.pieceNum_,n=t.pieceNum_;if(Eo(e)>Eo(t))return!1;for(;r<e.pieces_.length;){if(e.pieces_[r]!==t.pieces_[n])return!1;++r,++n}return!0}class Ev{constructor(e,t){this.errorPrefix_=t,this.parts_=Eh(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eZ(this.parts_[e]);ES(this)}}function E_(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=eZ(t),ES(e)}function Eb(e){let t=e.parts_.pop();e.byteLength_-=eZ(t),e.parts_.length>0&&(e.byteLength_-=1)}function ES(e){if(e.byteLength_>En)throw Error(e.errorPrefix_+"has a key path longer than "+En+" bytes ("+e.byteLength_+").");if(e.parts_.length>Er)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Er+") or object contains a cycle "+EC(e))}function EC(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Ew extends Ee{static getInstance(){return new Ew}constructor(){let e,t;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return z("visible"===e,"Unknown event type: "+e),[this.visible_]}}let ET=1e3,EE=3e5,EI=3e4,Ek=1.3,ER=3e4,Ex="server_kill",EO=3;class EA extends T9{constructor(e,t,r,n,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=EA.nextPersistentConnectionId_++,this.log_=wW("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ET,this.maxReconnectDelay_=EE,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!eC())throw Error("Auth override specified in options, but not supported on non Node.js platforms");Ew.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Et.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){let n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(eN(i)),z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[n]=r)}get(e){this.initConnection_();let t=new ec,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{let r=e.d;"ok"===e.s?t.resolve(r):t.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,r,n){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),z(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let a={onComplete:n,hashFn:t,query:e,tag:r};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){let t=e.query,r=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+r+" for "+n);let i={p:r},s="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(s,i,i=>{let s=i.d,a=i.s;EA.warnOnListenWarnings_(s,t),(this.listens.get(r)&&this.listens.get(r).get(n))===e&&(this.log_("listen response",i),"ok"!==a&&this.removeListen_(r,n),e.onComplete&&e.onComplete(a,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eF(e,"w")){let r=eB(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();wQ(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||eL(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=EI)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=eM(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(t,r,t=>{let r=t.s,n=t.d||"error";this.authToken_===e&&("ok"===r?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,r=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){let r=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+n),z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,n)&&this.connected_&&this.sendUnlisten_(r,n,e._queryObject,t)}sendUnlisten_(e,t,r,n){this.log_("Unlisten on "+e+" for "+t);let i={p:e},s="n";n&&(i.q=r,i.t=n),this.sendRequest(s,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,n){let i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,r,n){this.putInternal("p",e,t,r,n)}merge(e,t,r,n){this.putInternal("m",e,t,r,n)}putInternal(e,t,r,n,i){this.initConnection_();let s={p:t,d:r};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;let a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(r.s,r.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+eN(e));let t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):wK("Unrecognized action received from server: "+eN(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ET,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ET,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>ER&&(this.reconnectDelay_=ET),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ek)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+EA.nextConnectionId_++,i=this.lastSessionId,s=!1,a=null,o=function(){a?a.close():(s=!0,r())},l=function(e){z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:o,sendRequest:l};let c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[o,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);s?w$("getToken() completed but was canceled"):(w$("getToken() completed. Creating connection."),this.authToken_=o&&o.accessToken,this.appCheckToken_=l&&l.token,a=new T7(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,e=>{wQ(e+" ("+this.repoInfo_.toString()+")"),this.interrupt(Ex)},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&wQ(e),o())}}}interrupt(e){w$("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){w$("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eU(this.interruptReasons_)&&(this.reconnectDelay_=ET,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;r=t?t.map(e=>w6(e)).join("$"):"default";let n=this.removeListen_(e,r);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){let r,n=new Ei(e).toString();if(this.listens.has(n)){let e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){w$("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=EO&&(this.reconnectDelay_=EI,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){w$("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=EO&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";eC()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Tm.replace(/\./g,"-")]=1,em()?e["framework.cordova"]=1:eS()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=Et.getInstance().currentlyOnline();return eU(this.interruptReasons_)&&e}}EA.nextPersistentConnectionId_=0,EA.nextConnectionId_=0;class ED{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ED(e,t)}}class EN{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new ED(wZ,e),n=new ED(wZ,t);return 0!==this.compare(r,n)}minPost(){return ED.MIN}}class EP extends EN{static get __EMPTY_NODE(){return n}static set __EMPTY_NODE(e){n=e}compare(e,t){return w1(e.name,t.name)}isDefinedOn(e){throw H("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ED.MIN}maxPost(){return new ED(w0,n)}makePost(e,t){return z("string"==typeof e,"KeyIndex indexValue must always be a string."),new ED(e,n)}toString(){return".key"}}let EM=new EP;class EL{constructor(e,t,r,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class EF{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:EF.RED,this.left=null!=n?n:EU.EMPTY_NODE,this.right=null!=i?i:EU.EMPTY_NODE}copy(e,t,r,n,i){return new EF(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp_()}removeMin_(){if(this.left.isEmpty())return EU.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let r,n;if(r=this,0>t(e,r.key))r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()||(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),r.right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()||(r=r.moveRedRight_()),0===t(e,r.key))if(r.right.isEmpty())return EU.EMPTY_NODE;else n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_());r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,EF.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,EF.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}EF.RED=!0,EF.BLACK=!1;class EB{copy(e,t,r,n,i){return this}insert(e,t,r){return new EF(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class EU{constructor(e,t=EU.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new EU(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,EF.BLACK,null,null))}remove(e){return new EU(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,EF.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,n=null;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))if(r.left.isEmpty())if(n)return n.key;else return null;else{for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:t>0&&(n=r,r=r.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new EL(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new EL(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new EL(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new EL(this.root_,null,this.comparator_,!0,e)}}function Ej(e,t){return w1(e.name,t.name)}function Eq(e,t){return w1(e,t)}function EV(e){i=e}EU.EMPTY_NODE=new EB;let Ez=function(e){return"number"==typeof e?"number:"+w8(e):"string:"+e},EH=function(e){if(e.isLeafNode()){let t=e.val();z("string"==typeof t||"number"==typeof t||"object"==typeof t&&eF(t,".sv"),"Priority must be a string or number.")}else z(e===i||e.isEmpty(),"priority of unexpected type.");z(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class E${static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=E$.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,z(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),EH(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new E$(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:E$.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ep(e)?this:".priority"===Ea(e)?this.priorityNode_:E$.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:E$.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let r=Ea(e);return null===r?t:t.isEmpty()&&".priority"!==r?this:(z(".priority"!==r||1===Eo(e),".priority must be the last token in a path"),this.updateImmediateChild(r,E$.__childrenNodeConstructor.EMPTY_NODE.updateChild(El(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Ez(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=w8(this.value_):e+=this.value_,this.lazyHash_=wj(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===E$.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof E$.__childrenNodeConstructor?-1:(z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,r=typeof this.value_,n=E$.VALUE_TYPE_ORDER.indexOf(t),i=E$.VALUE_TYPE_ORDER.indexOf(r);return(z(n>=0,"Unknown leaf type: "+t),z(i>=0,"Unknown leaf type: "+r),n!==i)?i-n:"object"===r?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(!e.isLeafNode())return!1;{let t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}}}function EW(e){a=e}function EK(e){o=e}E$.VALUE_TYPE_ORDER=["object","boolean","number","string"];class EG extends EN{compare(e,t){let r=e.node.getPriority(),n=t.node.getPriority(),i=r.compareTo(n);return 0===i?w1(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ED.MIN}maxPost(){return new ED(w0,new E$("[PRIORITY-POST]",o))}makePost(e,t){return new ED(t,new E$("[PRIORITY-POST]",a(e)))}toString(){return".priority"}}let EQ=new EG,EY=Math.log(2);class EJ{constructor(e){const t=e=>parseInt(Math.log(e)/EY,10),r=e=>parseInt(Array(e+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const n=r(this.count);this.bits_=e+1&n}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let EX=function(e,t,r,n){e.sort(t);let i=function(t,n){let s,a,o=n-t;if(0===o)return null;if(1===o)return s=e[t],new EF(a=r?r(s):s,s.node,EF.BLACK,null,null);{let l=parseInt(o/2,10)+t,c=i(t,l),u=i(l+1,n);return s=e[l],new EF(a=r?r(s):s,s.node,EF.BLACK,c,u)}};return new EU(n||t,function(t){let n=null,s=null,a=e.length,o=function(t,n){let s=a-t,o=a;a-=t;let c=i(s+1,o),u=e[s];l(new EF(r?r(u):u,u.node,n,null,c))},l=function(e){n?n.left=e:s=e,n=e};for(let e=0;e<t.count;++e){let r=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));r?o(n,EF.BLACK):(o(n,EF.BLACK),o(n,EF.RED))}return s}(new EJ(e.length)))},EZ={};class E0{static get Default(){return z(EZ&&EQ,"ChildrenNode.ts has not been loaded"),l=l||new E0({".priority":EZ},{".priority":EQ})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eB(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof EU?t:null}hasIndex(e){return eF(this.indexSet_,e.toString())}addIndex(e,t){let r;z(e!==EM,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],i=!1,s=t.getIterator(ED.Wrap),a=s.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=s.getNext();r=i?EX(n,e.getCompare()):EZ;let o=e.toString(),l={...this.indexSet_};l[o]=e;let c={...this.indexes_};return c[o]=r,new E0(c,l)}addToIndexes(e,t){return new E0(ej(this.indexes_,(r,n)=>{let i=eB(this.indexSet_,n);if(z(i,"Missing index implementation for "+n),r===EZ)if(!i.isDefinedOn(e.node))return EZ;else{let r=[],n=t.getIterator(ED.Wrap),s=n.getNext();for(;s;)s.name!==e.name&&r.push(s),s=n.getNext();return r.push(e),EX(r,i.getCompare())}{let n=t.get(e.name),i=r;return n&&(i=i.remove(new ED(e.name,n))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new E0(ej(this.indexes_,r=>{if(r===EZ)return r;{let n=t.get(e.name);return n?r.remove(new ED(e.name,n)):r}}),this.indexSet_)}}class E1{static get EMPTY_NODE(){return c||(c=new E1(new EU(Eq),null,E0.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&EH(this.priorityNode_),this.children_.isEmpty()&&z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||c}updatePriority(e){return this.children_.isEmpty()?this:new E1(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?c:t}}getChild(e){let t=Ea(e);return null===t?this:this.getImmediateChild(t).getChild(El(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(z(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let r,n,i=new ED(e,t);t.isEmpty()?(r=this.children_.remove(e),n=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,t),n=this.indexMap_.addToIndexes(i,this.children_));let s=r.isEmpty()?c:this.priorityNode_;return new E1(r,s,n)}}updateChild(e,t){let r=Ea(e);if(null===r)return t;{z(".priority"!==Ea(e)||1===Eo(e),".priority must be the last token in a path");let n=this.getImmediateChild(r).updateChild(El(e),t);return this.updateImmediateChild(r,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},r=0,n=0,i=!0;if(this.forEachChild(EQ,(s,a)=>{t[s]=a.val(e),r++,i&&E1.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):i=!1}),e||!i||!(n<2*r))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let r in t)e[r]=t[r];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Ez(this.getPriority().val())+":"),this.forEachChild(EQ,(t,r)=>{let n=r.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":wj(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){let n=this.resolveIndex_(r);if(!n)return this.children_.getPredecessorKey(e);{let r=n.getPredecessorKey(new ED(e,t));return r?r.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new ED(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new ED(t,this.children_.get(t)):null}forEachChild(e,t){let r=this.resolveIndex_(e);return r?r.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,e=>e);{let r=this.children_.getIteratorFrom(e.name,ED.Wrap),n=r.peek();for(;null!=n&&0>t.compare(n,e);)r.getNext(),n=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,e=>e);{let r=this.children_.getReverseIteratorFrom(e.name,ED.Wrap),n=r.peek();for(;null!=n&&t.compare(n,e)>0;)r.getNext(),n=r.peek();return r}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===E3?-1:0}withIndex(e){if(e===EM||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new E1(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===EM||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;{if(e.isLeafNode())return!1;let t=e;if(!this.getPriority().equals(t.getPriority()))return!1;if(this.children_.count()!==t.children_.count())return!1;{let e=this.getIterator(EQ),r=t.getIterator(EQ),n=e.getNext(),i=r.getNext();for(;n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=e.getNext(),i=r.getNext()}return null===n&&null===i}}}resolveIndex_(e){return e===EM?null:this.indexMap_.get(e.toString())}}E1.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class E2 extends E1{constructor(){super(new EU(Eq),E1.EMPTY_NODE,E0.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return E1.EMPTY_NODE}isEmpty(){return!1}}let E3=new E2;Object.defineProperties(ED,{MIN:{value:new ED(wZ,E1.EMPTY_NODE)},MAX:{value:new ED(w0,E3)}}),EP.__EMPTY_NODE=E1.EMPTY_NODE,E$.__childrenNodeConstructor=E1,EV(E3),EK(E3);let E6=!0;function E4(e,t=null){if(null===e)return E1.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),z(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new E$(e,E4(t));if(e instanceof Array||!E6){let r=E1.EMPTY_NODE;return w5(e,(t,n)=>{if(eF(e,t)&&"."!==t.substring(0,1)){let e=E4(n);(e.isLeafNode()||!e.isEmpty())&&(r=r.updateImmediateChild(t,e))}}),r.updatePriority(E4(t))}{let r=[],n=!1;if(w5(e,(e,t)=>{if("."!==e.substring(0,1)){let i=E4(t);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),r.push(new ED(e,i)))}}),0===r.length)return E1.EMPTY_NODE;let i=EX(r,Ej,e=>e.name,Eq);if(!n)return new E1(i,E4(t),E0.Default);{let e=EX(r,EQ.getCompare());return new E1(i,E4(t),new E0({".priority":e},{".priority":EQ}))}}}EW(E4);class E5 extends EN{constructor(e){super(),this.indexPath_=e,z(!Ep(e)&&".priority"!==Ea(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),n=this.extractChild(t.node),i=r.compareTo(n);return 0===i?w1(e.name,t.name):i}makePost(e,t){let r=E4(e);return new ED(t,E1.EMPTY_NODE.updateChild(this.indexPath_,r))}maxPost(){return new ED(w0,E1.EMPTY_NODE.updateChild(this.indexPath_,E3))}toString(){return Eh(this.indexPath_,0).join("/")}}class E8 extends EN{compare(e,t){let r=e.node.compareTo(t.node);return 0===r?w1(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ED.MIN}maxPost(){return ED.MAX}makePost(e,t){return new ED(t,E4(e))}toString(){return".value"}}let E7=new E8;function E9(e){return{type:"value",snapshotNode:e}}function Ie(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function It(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ir(e,t,r){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:r}}function In(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}class Ii{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=EQ}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(z(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:wZ}hasEnd(){return this.endSet_}getIndexEndValue(){return z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(z(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:w0}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===EQ}copy(){let e=new Ii;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Is(e){let t,r={};if(e.isDefault())return r;if(e.index_===EQ?t="$priority":e.index_===E7?t="$value":e.index_===EM?t="$key":(z(e.index_ instanceof E5,"Unrecognized index type!"),t=e.index_.toString()),r.orderBy=eN(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";r[t]=eN(e.indexStartValue_),e.startNameSet_&&(r[t]+=","+eN(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";r[t]=eN(e.indexEndValue_),e.endNameSet_&&(r[t]+=","+eN(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?r.limitToFirst=e.limit_:r.limitToLast=e.limit_),r}function Ia(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let r=e.viewFrom_;""===r&&(r=e.isViewFromLeft()?"l":"r"),t.vf=r}return e.index_!==EQ&&(t.i=e.index_.toString()),t}class Io extends T9{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=n,this.log_=wW("p:rest:"),this.listens_={}}listen(e,t,r,n){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=Io.getListenId_(e,r),a={};this.listens_[s]=a;let o=Is(e._queryParams);this.restRequest_(i+".json",o,(e,t)=>{let o=t;if(404===e&&(o=null,e=null),null===e&&this.onDataUpdate_(i,o,!1,r),eB(this.listens_,s)===a){let t;n(t=e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}})}unlisten(e,t){let r=Io.getListenId_(e,t);delete this.listens_[r]}get(e){let t=Is(e._queryParams),r=e._path.toString(),n=new ec;return this.restRequest_(r+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(r,i,!1,null),n.resolve(i)):n.reject(Error(i))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(t.auth=n.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ez(t);this.log_("Sending REST request for "+s);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&4===a.readyState){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=eD(a.responseText)}catch(e){wQ("Failed to parse JSON response for "+s+": "+a.responseText)}r(null,e)}else 401!==a.status&&404!==a.status&&wQ("Got unsuccessful REST response for "+s+" Status: "+a.status),r(a.status);r=null}},a.open("GET",s,!0),a.send()})}}class Il{constructor(){this.rootNode_=E1.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Ic(){return{value:null,children:new Map}}function Iu(e,t,r){if(Ep(t))e.value=r,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,r);else{let n=Ea(t);e.children.has(n)||e.children.set(n,Ic()),Iu(e.children.get(n),t=El(t),r)}}function Ih(e,t,r){null!==e.value?r(t,e.value):Id(e,(e,n)=>{Ih(n,new Ei(t.toString()+"/"+e),r)})}function Id(e,t){e.children.forEach((e,r)=>{t(r,e)})}class If{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&w5(this.last_,(e,r)=>{t[e]=t[e]-r}),this.last_=e,t}}let Ip=1e4,Im=3e4,Ig=3e5;class Iy{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new If(e);const r=Ip+(Im-Ip)*Math.random();Ta(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;w5(e,(e,n)=>{n>0&&eF(this.statsToReport_,e)&&(t[e]=n,r=!0)}),r&&this.server_.reportStats(t),Ta(this.reportStats_.bind(this),Math.floor(2*Math.random()*Ig))}}function Iv(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function I_(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ib(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(C||(C={}));class IS{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=C.ACK_USER_WRITE,this.source=Iv()}operationForChild(e){if(!Ep(this.path))return z(Ea(this.path)===e,"operationForChild called for unrelated child."),new IS(El(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Ei(e));return new IS(Es(),t,this.revert)}}}class IC{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=C.OVERWRITE}operationForChild(e){return Ep(this.path)?new IC(this.source,Es(),this.snap.getImmediateChild(e)):new IC(this.source,El(this.path),this.snap)}}class Iw{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=C.MERGE}operationForChild(e){if(!Ep(this.path))return z(Ea(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Iw(this.source,El(this.path),this.children);{let t=this.children.subtree(new Ei(e));return t.isEmpty()?null:t.value?new IC(this.source,Es(),t.value):new Iw(this.source,Es(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class IT{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ep(e))return this.isFullyInitialized()&&!this.filtered_;let t=Ea(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function IE(e,t,r,n){let i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(In(t.childName,t.snapshotNode))}),II(e,i,"child_removed",t,n,r),II(e,i,"child_added",t,n,r),II(e,i,"child_moved",s,n,r),II(e,i,"child_changed",t,n,r),II(e,i,"value",t,n,r),i}function II(e,t,r,n,i,s){let a=n.filter(e=>e.type===r);a.sort((t,r)=>IR(e,t,r)),a.forEach(r=>{let n=Ik(e,r,s);i.forEach(i=>{i.respondsTo(r.type)&&t.push(i.createEvent(n,e.query_))})})}function Ik(e,t,r){return"value"===t.type||"child_removed"===t.type||(t.prevName=r.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function IR(e,t,r){if(null==t.childName||null==r.childName)throw H("Should only compare child_ events.");let n=new ED(t.childName,t.snapshotNode),i=new ED(r.childName,r.snapshotNode);return e.index_.compare(n,i)}function Ix(e,t){return{eventCache:e,serverCache:t}}function IO(e,t,r,n){return Ix(new IT(t,r,n),e.serverCache)}function IA(e,t,r,n){return Ix(e.eventCache,new IT(t,r,n))}function ID(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function IN(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let IP=()=>(u||(u=new EU(w2)),u);class IM{static fromObject(e){let t=new IM(null);return w5(e,(e,r)=>{t=t.set(new Ei(e),r)}),t}constructor(e,t=IP()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Es(),value:this.value};{if(Ep(e))return null;let r=Ea(e),n=this.children.get(r);if(null===n)return null;{let i=n.findRootMostMatchingPathAndValue(El(e),t);return null!=i?{path:Ef(new Ei(r),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ep(e))return this;{let t=Ea(e),r=this.children.get(t);return null!==r?r.subtree(El(e)):new IM(null)}}set(e,t){if(Ep(e))return new IM(t,this.children);{let r=Ea(e),n=(this.children.get(r)||new IM(null)).set(El(e),t),i=this.children.insert(r,n);return new IM(this.value,i)}}remove(e){if(Ep(e))if(this.children.isEmpty())return new IM(null);else return new IM(null,this.children);{let t=Ea(e),r=this.children.get(t);if(!r)return this;{let n,i=r.remove(El(e));return(n=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&n.isEmpty())?new IM(null):new IM(this.value,n)}}}get(e){if(Ep(e))return this.value;{let t=Ea(e),r=this.children.get(t);return r?r.get(El(e)):null}}setTree(e,t){if(Ep(e))return t;{let r,n=Ea(e),i=(this.children.get(n)||new IM(null)).setTree(El(e),t);return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new IM(this.value,r)}}fold(e){return this.fold_(Es(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((n,i)=>{r[n]=i.fold_(Ef(e,n),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Es(),t)}findOnPath_(e,t,r){let n=!!this.value&&r(t,this.value);if(n)return n;{if(Ep(e))return null;let n=Ea(e),i=this.children.get(n);return i?i.findOnPath_(El(e),Ef(t,n),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Es(),t)}foreachOnPath_(e,t,r){if(Ep(e))return this;{this.value&&r(t,this.value);let n=Ea(e),i=this.children.get(n);return i?i.foreachOnPath_(El(e),Ef(t,n),r):new IM(null)}}foreach(e){this.foreach_(Es(),e)}foreach_(e,t){this.children.inorderTraversal((r,n)=>{n.foreach_(Ef(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class IL{constructor(e){this.writeTree_=e}static empty(){return new IL(new IM(null))}}function IF(e,t,r){if(Ep(t))return new IL(new IM(r));{let n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){let i=n.path,s=n.value,a=Em(i,t);return s=s.updateChild(a,r),new IL(e.writeTree_.set(i,s))}{let n=new IM(r);return new IL(e.writeTree_.setTree(t,n))}}}function IB(e,t,r){let n=e;return w5(r,(e,r)=>{n=IF(n,Ef(t,e),r)}),n}function IU(e,t){return Ep(t)?IL.empty():new IL(e.writeTree_.setTree(t,new IM(null)))}function Ij(e,t){return null!=Iq(e,t)}function Iq(e,t){let r=e.writeTree_.findRootMostValueAndPath(t);return null!=r?e.writeTree_.get(r.path).getChild(Em(r.path,t)):null}function IV(e){let t=[],r=e.writeTree_.value;return null!=r?r.isLeafNode()||r.forEachChild(EQ,(e,r)=>{t.push(new ED(e,r))}):e.writeTree_.children.inorderTraversal((e,r)=>{null!=r.value&&t.push(new ED(e,r.value))}),t}function Iz(e,t){if(Ep(t))return e;{let r=Iq(e,t);return new IL(null!=r?new IM(r):e.writeTree_.subtree(t))}}function IH(e){return e.writeTree_.isEmpty()}function I$(e,t){return IW(Es(),e.writeTree_,t)}function IW(e,t,r){if(null!=t.value)return r.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(z(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):r=IW(Ef(e,t),i,r)}),r.getChild(e).isEmpty()||null===n||(r=r.updateChild(Ef(e,".priority"),n)),r}}function IK(e,t){return ks(t,e)}function IG(e,t,r,n,i){z(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:r,writeId:n,visible:i}),i&&(e.visibleWrites=IF(e.visibleWrites,t,r)),e.lastWriteId=n}function IQ(e,t){for(let r=0;r<e.allWrites.length;r++){let n=e.allWrites[r];if(n.writeId===t)return n}return null}function IY(e,t){let r=e.allWrites.findIndex(e=>e.writeId===t);z(r>=0,"removeWrite called with nonexistent writeId.");let n=e.allWrites[r];e.allWrites.splice(r,1);let i=n.visible,s=!1,a=e.allWrites.length-1;for(;i&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&IJ(t,n.path)?i=!1:Ey(n.path,t.path)&&(s=!0)),a--}return!!i&&(s?IX(e):n.snap?e.visibleWrites=IU(e.visibleWrites,n.path):w5(n.children,t=>{e.visibleWrites=IU(e.visibleWrites,Ef(n.path,t))}),!0)}function IJ(e,t){if(e.snap)return Ey(e.path,t);for(let r in e.children)if(e.children.hasOwnProperty(r)&&Ey(Ef(e.path,r),t))return!0;return!1}function IX(e){e.visibleWrites=I0(e.allWrites,IZ,Es()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function IZ(e){return e.visible}function I0(e,t,r){let n=IL.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)Ey(r,t)?n=IF(n,e=Em(r,t),s.snap):Ey(t,r)&&(e=Em(t,r),n=IF(n,Es(),s.snap.getChild(e)));else if(s.children){if(Ey(r,t))n=IB(n,e=Em(r,t),s.children);else if(Ey(t,r))if(Ep(e=Em(t,r)))n=IB(n,Es(),s.children);else{let t=eB(s.children,Ea(e));if(t){let r=t.getChild(El(e));n=IF(n,Es(),r)}}}else throw H("WriteRecord should have .snap or .children")}}return n}function I1(e,t,r,n,i){if(n||i){let s=Iz(e.visibleWrites,t);if(!i&&IH(s))return r;{if(!i&&null==r&&!Ij(s,Es()))return null;let a=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(Ey(e.path,t)||Ey(t,e.path))};return I$(I0(e.allWrites,a,t),r||E1.EMPTY_NODE)}}{let n=Iq(e.visibleWrites,t);if(null!=n)return n;{let n=Iz(e.visibleWrites,t);return IH(n)?r:null!=r||Ij(n,Es())?I$(n,r||E1.EMPTY_NODE):null}}}function I2(e,t,r){let n=E1.EMPTY_NODE,i=Iq(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(EQ,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(!r)return IV(Iz(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n;{let i=Iz(e.visibleWrites,t);return r.forEachChild(EQ,(e,t)=>{let r=I$(Iz(i,new Ei(e)),t);n=n.updateImmediateChild(e,r)}),IV(i).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}}function I3(e,t,r,n,i){z(n||i,"Either existingEventSnap or existingServerSnap must exist");let s=Ef(t,r);if(Ij(e.visibleWrites,s))return null;{let t=Iz(e.visibleWrites,s);return IH(t)?i.getChild(r):I$(t,i.getChild(r))}}function I6(e,t,r,n){let i=Ef(t,r),s=Iq(e.visibleWrites,i);return null!=s?s:n.isCompleteForChild(r)?I$(Iz(e.visibleWrites,i),n.getNode().getImmediateChild(r)):null}function I4(e,t){return Iq(e.visibleWrites,t)}function I5(e,t,r,n,i,s,a){let o,l=Iz(e.visibleWrites,t),c=Iq(l,Es());if(null!=c)o=c;else{if(null==r)return[];o=I$(l,r)}if((o=o.withIndex(a)).isEmpty()||o.isLeafNode())return[];{let e=[],t=a.getCompare(),r=s?o.getReverseIteratorFrom(n,a):o.getIteratorFrom(n,a),l=r.getNext();for(;l&&e.length<i;)0!==t(l,n)&&e.push(l),l=r.getNext();return e}}function I8(){return{visibleWrites:IL.empty(),allWrites:[],lastWriteId:-1}}function I7(e,t,r,n){return I1(e.writeTree,e.treePath,t,r,n)}function I9(e,t){return I2(e.writeTree,e.treePath,t)}function ke(e,t,r,n){return I3(e.writeTree,e.treePath,t,r,n)}function kt(e,t){return I4(e.writeTree,Ef(e.treePath,t))}function kr(e,t,r,n,i,s){return I5(e.writeTree,e.treePath,t,r,n,i,s)}function kn(e,t,r){return I6(e.writeTree,e.treePath,t,r)}function ki(e,t){return ks(Ef(e.treePath,t),e.writeTree)}function ks(e,t){return{treePath:e,writeTree:t}}class ka{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;z("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),z(".priority"!==r,"Only non-priority child changes can be tracked.");let n=this.changeMap.get(r);if(n){let i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(r,Ir(r,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(r);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(r,It(r,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(r,Ie(r,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(r,Ir(r,e.snapshotNode,n.oldSnap));else throw H("Illegal combination of changes: "+e+" occurred after "+n)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class ko{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}let kl=new ko;class kc{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new IT(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return kn(this.writes_,e,t)}}getChildAfterChild(e,t,r){let n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:IN(this.viewCache_),i=kr(this.writes_,n,t,1,r,e);return 0===i.length?null:i[0]}}function ku(e,t){z(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),z(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function kh(e,t,r,n,i){let s,a,o=new ka;if(r.type===C.OVERWRITE){let l=r;l.source.fromUser?s=km(e,t,l.path,l.snap,n,i,o):(z(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!Ep(l.path),s=kp(e,t,l.path,l.snap,n,i,a,o))}else if(r.type===C.MERGE){let l=r;l.source.fromUser?s=ky(e,t,l.path,l.children,n,i,o):(z(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),s=k_(e,t,l.path,l.children,n,i,a,o))}else if(r.type===C.ACK_USER_WRITE){let a=r;s=a.revert?kC(e,t,a.path,n,i,o):kb(e,t,a.path,a.affectedTree,n,i,o)}else if(r.type===C.LISTEN_COMPLETE)s=kS(e,t,r.path,n,o);else throw H("Unknown operation type: "+r.type);let l=o.getChanges();return kd(t,s,l),{viewCache:s,changes:l}}function kd(e,t,r){let n=t.eventCache;if(n.isFullyInitialized()){let i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=ID(e);!(r.length>0)&&e.eventCache.isFullyInitialized()&&(!i||n.getNode().equals(s))&&n.getNode().getPriority().equals(s.getPriority())||r.push(E9(ID(t)))}}function kf(e,t,r,n,i,s){let a=t.eventCache;if(null!=kt(n,r))return t;{let o,l;if(Ep(r))if(z(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let r=IN(t),i=I9(n,r instanceof E1?r:E1.EMPTY_NODE);o=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let r=I7(n,IN(t));o=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let c=Ea(r);if(".priority"===c){z(1===Eo(r),"Can't have a priority with additional path components");let i=a.getNode(),s=ke(n,r,i,l=t.serverCache.getNode());o=null!=s?e.filter.updatePriority(i,s):a.getNode()}else{let u,h=El(r);if(a.isCompleteForChild(c)){l=t.serverCache.getNode();let e=ke(n,r,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(c).updateChild(h,e):a.getNode().getImmediateChild(c)}else u=kn(n,c,t.serverCache);o=null!=u?e.filter.updateChild(a.getNode(),c,u,h,i,s):a.getNode()}}return IO(t,o,a.isFullyInitialized()||Ep(r),e.filter.filtersNodes())}}function kp(e,t,r,n,i,s,a,o){let l,c=t.serverCache,u=a?e.filter:e.filter.getIndexedFilter();if(Ep(r))l=u.updateFullNode(c.getNode(),n,null);else if(u.filtersNodes()&&!c.isFiltered()){let e=c.getNode().updateChild(r,n);l=u.updateFullNode(c.getNode(),e,null)}else{let e=Ea(r);if(!c.isCompleteForPath(r)&&Eo(r)>1)return t;let i=El(r),s=c.getNode().getImmediateChild(e).updateChild(i,n);l=".priority"===e?u.updatePriority(c.getNode(),s):u.updateChild(c.getNode(),e,s,i,kl,null)}let h=IA(t,l,c.isFullyInitialized()||Ep(r),u.filtersNodes()),d=new kc(i,h,s);return kf(e,h,r,i,d,o)}function km(e,t,r,n,i,s,a){let o,l,c=t.eventCache,u=new kc(i,t,s);if(Ep(r))l=e.filter.updateFullNode(t.eventCache.getNode(),n,a),o=IO(t,l,!0,e.filter.filtersNodes());else{let i=Ea(r);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),n),o=IO(t,l,c.isFullyInitialized(),c.isFiltered());else{let s,l=El(r),h=c.getNode().getImmediateChild(i);if(Ep(l))s=n;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===Ec(l)&&e.getChild(Ed(l)).isEmpty()?e:e.updateChild(l,n):E1.EMPTY_NODE}o=h.equals(s)?t:IO(t,e.filter.updateChild(c.getNode(),i,s,l,u,a),c.isFullyInitialized(),e.filter.filtersNodes())}}return o}function kg(e,t){return e.eventCache.isCompleteForChild(t)}function ky(e,t,r,n,i,s,a){let o=t;return n.foreach((n,l)=>{let c=Ef(r,n);kg(t,Ea(c))&&(o=km(e,o,c,l,i,s,a))}),n.foreach((n,l)=>{let c=Ef(r,n);kg(t,Ea(c))||(o=km(e,o,c,l,i,s,a))}),o}function kv(e,t,r){return r.foreach((e,r)=>{t=t.updateChild(e,r)}),t}function k_(e,t,r,n,i,s,a,o){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c=t;l=Ep(r)?n:new IM(null).setTree(r,n);let u=t.serverCache.getNode();return l.children.inorderTraversal((r,n)=>{if(u.hasChild(r)){let l=kv(e,t.serverCache.getNode().getImmediateChild(r),n);c=kp(e,c,new Ei(r),l,i,s,a,o)}}),l.children.inorderTraversal((r,n)=>{let l=!t.serverCache.isCompleteForChild(r)&&null===n.value;if(!u.hasChild(r)&&!l){let l=kv(e,t.serverCache.getNode().getImmediateChild(r),n);c=kp(e,c,new Ei(r),l,i,s,a,o)}}),c}function kb(e,t,r,n,i,s,a){if(null!=kt(i,r))return t;let o=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value)if(Ep(r)&&l.isFullyInitialized()||l.isCompleteForPath(r))return kp(e,t,r,l.getNode().getChild(r),i,s,o,a);else{if(!Ep(r))return t;let n=new IM(null);return l.getNode().forEachChild(EM,(e,t)=>{n=n.set(new Ei(e),t)}),k_(e,t,r,n,i,s,o,a)}{let c=new IM(null);return n.foreach((e,t)=>{let n=Ef(r,e);l.isCompleteForPath(n)&&(c=c.set(e,l.getNode().getChild(n)))}),k_(e,t,r,c,i,s,o,a)}}function kS(e,t,r,n,i){let s=t.serverCache;return kf(e,IA(t,s.getNode(),s.isFullyInitialized()||Ep(r),s.isFiltered()),r,n,kl,i)}function kC(e,t,r,n,i,s){let a;if(null!=kt(n,r))return t;{let o,l=new kc(n,t,i),c=t.eventCache.getNode();if(Ep(r)||".priority"===Ea(r)){let r;if(t.serverCache.isFullyInitialized())r=I7(n,IN(t));else{let e=t.serverCache.getNode();z(e instanceof E1,"serverChildren would be complete if leaf node"),r=I9(n,e)}o=e.filter.updateFullNode(c,r,s)}else{let i=Ea(r),u=kn(n,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),(o=null!=u?e.filter.updateChild(c,i,u,El(r),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,E1.EMPTY_NODE,El(r),l,s):c).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=I7(n,IN(t))).isLeafNode()&&(o=e.filter.updateFullNode(o,a,s))}return a=t.serverCache.isFullyInitialized()||null!=kt(n,Es()),IO(t,o,a,e.filter.filtersNodes())}}function kw(e,t){let r=IN(e.viewCache_);return r&&(e.query._queryParams.loadsAllData()||!Ep(t)&&!r.getImmediateChild(Ea(t)).isEmpty())?r.getChild(t):null}function kT(e,t,r,n){t.type===C.MERGE&&null!==t.source.queryId&&(z(IN(e.viewCache_),"We should always have a full cache before handling merges"),z(ID(e.viewCache_),"Missing event cache, even though we have a server cache"));let i=e.viewCache_,s=kh(e.processor_,i,t,r,n);return ku(e.processor_,s.viewCache),z(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,kE(e,s.changes,s.viewCache.eventCache.getNode(),null)}function kE(e,t,r,n){let i=n?[n]:e.eventRegistrations_;return IE(e.eventGenerator_,t,r,i)}function kI(e){z(!h,"__referenceConstructor has already been defined"),h=e}function kk(e,t,r,n){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return z(null!=s,"SyncTree gave us an op for an invalid query."),kT(s,t,r,n)}{let i=[];for(let s of e.views.values())i=i.concat(kT(s,t,r,n));return i}}function kR(e,t){let r=null;for(let n of e.views.values())r=r||kw(n,t);return r}function kx(e){z(!d,"__referenceConstructor has already been defined"),d=e}class kO{constructor(e){this.listenProvider_=e,this.syncPointTree_=new IM(null),this.pendingWriteTree_=I8(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function kA(e,t,r,n,i){return(IG(e.pendingWriteTree_,t,r,n,i),i)?kB(e,new IC(Iv(),t,r)):[]}function kD(e,t,r=!1){let n=IQ(e.pendingWriteTree_,t);if(!IY(e.pendingWriteTree_,t))return[];{let t=new IM(null);return null!=n.snap?t=t.set(Es(),!0):w5(n.children,e=>{t=t.set(new Ei(e),!0)}),kB(e,new IS(n.path,t,r))}}function kN(e,t,r){return kB(e,new IC(I_(),t,r))}function kP(e,t,r){let n=IM.fromObject(r);return kB(e,new Iw(I_(),t,n))}function kM(e,t,r,n){let i=kq(e,n);if(null==i)return[];{let n=kV(i),s=n.path,a=n.queryId,o=Em(s,t);return kz(e,s,new IC(Ib(a),o,r))}}function kL(e,t,r,n){let i=kq(e,n);if(!i)return[];{let n=kV(i),s=n.path,a=n.queryId,o=Em(s,t),l=IM.fromObject(r);return kz(e,s,new Iw(Ib(a),o,l))}}function kF(e,t,r){let n=!0,i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,r)=>{let n=kR(r,Em(e,t));if(n)return n});return I1(i,t,s,r,n)}function kB(e,t){return kU(t,e.syncPointTree_,null,IK(e.pendingWriteTree_,Es()))}function kU(e,t,r,n){if(Ep(e.path))return kj(e,t,r,n);{let i=t.get(Es());null==r&&null!=i&&(r=kR(i,Es()));let s=[],a=Ea(e.path),o=e.operationForChild(a),l=t.children.get(a);if(l&&o){let e=r?r.getImmediateChild(a):null,t=ki(n,a);s=s.concat(kU(o,l,e,t))}return i&&(s=s.concat(kk(i,e,n,r))),s}}function kj(e,t,r,n){let i=t.get(Es());null==r&&null!=i&&(r=kR(i,Es()));let s=[];return t.children.inorderTraversal((t,i)=>{let a=r?r.getImmediateChild(t):null,o=ki(n,t),l=e.operationForChild(t);l&&(s=s.concat(kj(l,i,a,o)))}),i&&(s=s.concat(kk(i,e,n,r))),s}function kq(e,t){return e.tagToQueryMap.get(t)}function kV(e){let t=e.indexOf("$");return z(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Ei(e.substr(0,t))}}function kz(e,t,r){let n=e.syncPointTree_.get(t);return z(n,"Missing sync point for query tag that we're tracking"),kk(n,r,IK(e.pendingWriteTree_,t),null)}class kH{constructor(e){this.node_=e}getImmediateChild(e){return new kH(this.node_.getImmediateChild(e))}node(){return this.node_}}class k${constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Ef(this.path_,e);return new k$(this.syncTree_,t)}node(){return kF(this.syncTree_,this.path_)}}let kW=function(e){return(e=e||{}).timestamp=e.timestamp||new Date().getTime(),e},kK=function(e,t,r){return e&&"object"==typeof e?(z(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?kG(e[".sv"],t,r):"object"==typeof e[".sv"]?kQ(e[".sv"],t):void z(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},kG=function(e,t,r){if("timestamp"===e)return r.timestamp;z(!1,"Unexpected server value: "+e)},kQ=function(e,t,r){e.hasOwnProperty("increment")||z(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let n=e.increment;"number"!=typeof n&&z(!1,"Unexpected increment value: "+n);let i=t.node();if(z(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;let s=i.getValue();return"number"!=typeof s?n:s+n},kY=function(e,t,r,n){return kX(t,new k$(r,e),n)},kJ=function(e,t,r){return kX(e,new kH(t),r)};function kX(e,t,r){let n,i=kK(e.getPriority().val(),t.getImmediateChild(".priority"),r);if(e.isLeafNode()){let n=e,s=kK(n.getValue(),t,r);return s!==n.getValue()||i!==n.getPriority().val()?new E$(s,E4(i)):e}{let s=e;return n=s,i!==s.getPriority().val()&&(n=n.updatePriority(new E$(i))),s.forEachChild(EQ,(e,i)=>{let s=kX(i,t.getImmediateChild(e),r);s!==i&&(n=n.updateImmediateChild(e,s))}),n}}class kZ{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function k0(e,t){let r=t instanceof Ei?t:new Ei(t),n=e,i=Ea(r);for(;null!==i;){let e=eB(n.node.children,i)||{children:{},childCount:0};n=new kZ(i,n,e),i=Ea(r=El(r))}return n}function k1(e){return e.node.value}function k2(e,t){e.node.value=t,k9(e)}function k3(e){return e.node.childCount>0}function k6(e){return void 0===k1(e)&&!k3(e)}function k4(e,t){w5(e.node.children,(r,n)=>{t(new kZ(r,e,n))})}function k5(e,t,r,n){r&&!n&&t(e),k4(e,e=>{k5(e,t,!0,n)}),r&&n&&t(e)}function k8(e,t,r){let n=r?e:e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}return!1}function k7(e){return new Ei(null===e.parent?e.name:k7(e.parent)+"/"+e.name)}function k9(e){null!==e.parent&&Re(e.parent,e.name,e)}function Re(e,t,r){let n=k6(r),i=eF(e.node.children,t);n&&i?(delete e.node.children[t],e.node.childCount--,k9(e)):n||i||(e.node.children[t]=r.node,e.node.childCount++,k9(e))}let Rt=/[\[\].#$\/\u0000-\u001F\u007F]/,Rr=/[\[\].#$\u0000-\u001F\u007F]/,Rn=0xa00000,Ri=function(e){return"string"==typeof e&&0!==e.length&&!Rt.test(e)},Rs=function(e){return"string"==typeof e&&0!==e.length&&!Rr.test(e)},Ra=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Rs(e)},Ro=function(e,t,r){let n=r instanceof Ei?new Ev(r,e):r;if(void 0===t)throw Error(e+"contains undefined "+EC(n));if("function"==typeof t)throw Error(e+"contains a function "+EC(n)+" with contents = "+t.toString());if(wJ(t))throw Error(e+"contains "+t.toString()+" "+EC(n));if("string"==typeof t&&t.length>Rn/3&&eZ(t)>Rn)throw Error(e+"contains a string greater than "+Rn+" utf8 bytes "+EC(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let r=!1,i=!1;if(w5(t,(t,s)=>{if(".value"===t)r=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Ri(t)))throw Error(e+" contains an invalid key ("+t+") "+EC(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');E_(n,t),Ro(e,s,n),Eb(n)}),r&&i)throw Error(e+' contains ".value" child '+EC(n)+" in addition to actual children.")}},Rl=function(e,t){let r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ri(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&!Ra(r))throw Error(eJ(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Rc{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ru(e,t){let r=null;for(let n=0;n<t.length;n++){let i=t[n],s=i.getPath();null===r||Eg(s,r.path)||(e.eventLists_.push(r),r=null),null===r&&(r={events:[],path:s}),r.events.push(i)}r&&e.eventLists_.push(r)}function Rh(e,t,r){Ru(e,r),Rd(e,e=>Ey(e,t)||Ey(t,e))}function Rd(e,t){e.recursionDepth_++;let r=!0;for(let n=0;n<e.eventLists_.length;n++){let i=e.eventLists_[n];i&&(t(i.path)?(Rf(e.eventLists_[n]),e.eventLists_[n]=null):r=!1)}r&&(e.eventLists_=[]),e.recursionDepth_--}function Rf(e){for(let t=0;t<e.events.length;t++){let r=e.events[t];if(null!==r){e.events[t]=null;let n=r.getEventRunner();wV&&w$("event: "+r.toString()),Ti(n)}}}let Rp="repo_interrupt",Rm=25;class Rg{constructor(e,t,r,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Rc,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ic(),this.transactionQueueTree_=new kZ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ry(e,t,r){if(e.stats_=Tf(e.repoInfo_),e.forceRestClient_||Ts())e.server_=new Io(e.repoInfo_,(t,r,n,i)=>{Rb(e,t,r,n,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>RS(e,!0),0);else{if(null!=r){if("object"!=typeof r)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{eN(r)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new EA(e.repoInfo_,t,(t,r,n,i)=>{Rb(e,t,r,n,i)},t=>{RS(e,t)},t=>{RC(e,t)},e.authTokenProvider_,e.appCheckProvider_,r),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=Tp(e.repoInfo_,()=>new Iy(e.stats_,e.server_)),e.infoData_=new Il,e.infoSyncTree_=new kO({startListening:(t,r,n,i)=>{let s=[],a=e.infoData_.getNode(t._path);return a.isEmpty()||(s=kN(e.infoSyncTree_,t._path,a),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),Rw(e,"connected",!1),e.serverSyncTree_=new kO({startListening:(t,r,n,i)=>(e.server_.listen(t,n,r,(r,n)=>{let s=i(r,n);Rh(e.eventQueue_,t._path,s)}),[]),stopListening:(t,r)=>{e.server_.unlisten(t,r)}})}function Rv(e){let t=e.infoData_.getNode(new Ei(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function R_(e){return kW({timestamp:Rv(e)})}function Rb(e,t,r,n,i){e.dataUpdateCount++;let s=new Ei(t);r=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,r):r;let a=[];if(i)if(n){let t=ej(r,e=>E4(e));a=kL(e.serverSyncTree_,s,t,i)}else{let t=E4(r);a=kM(e.serverSyncTree_,s,t,i)}else if(n){let t=ej(r,e=>E4(e));a=kP(e.serverSyncTree_,s,t)}else{let t=E4(r);a=kN(e.serverSyncTree_,s,t)}let o=s;a.length>0&&(o=RA(e,s)),Rh(e.eventQueue_,o,a)}function RS(e,t){Rw(e,"connected",t),!1===t&&RE(e)}function RC(e,t){w5(t,(t,r)=>{Rw(e,t,r)})}function Rw(e,t,r){let n=new Ei("/.info/"+t),i=E4(r);e.infoData_.updateSnapshot(n,i);let s=kN(e.infoSyncTree_,n,i);Rh(e.eventQueue_,n,s)}function RT(e){return e.nextWriteId_++}function RE(e){Rk(e,"onDisconnectEvents");let t=R_(e),r=Ic();Ih(e.onDisconnect_,Es(),(n,i)=>{let s=kY(n,i,e.serverSyncTree_,t);Iu(r,n,s)});let n=[];Ih(r,Es(),(t,r)=>{n=n.concat(kN(e.serverSyncTree_,t,r));let i=RF(e,t);RA(e,i)}),e.onDisconnect_=Ic(),Rh(e.eventQueue_,Es(),n)}function RI(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Rp)}function Rk(e,...t){let r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),w$(r,...t)}function RR(e,t,r){return kF(e.serverSyncTree_,t,r)||E1.EMPTY_NODE}function Rx(e,t=e.transactionQueueTree_){if(t||RL(e,t),k1(t)){let r=RP(e,t);z(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&RO(e,k7(t),r)}else k3(t)&&k4(t,t=>{Rx(e,t)})}function RO(e,t,r){let n=RR(e,t,r.map(e=>e.currentWriteId)),i=n,s=n.hash();for(let e=0;e<r.length;e++){let n=r[e];z(0===n.status,"tryToSendTransactionQueue_: items in queue should all be run."),n.status=1,n.retryCount++;let s=Em(t,n.path);i=i.updateChild(s,n.currentOutputSnapshotRaw)}let a=i.val(!0),o=t;e.server_.put(o.toString(),a,n=>{Rk(e,"transaction put response",{path:o.toString(),status:n});let i=[];if("ok"===n){let n=[];for(let t=0;t<r.length;t++)r[t].status=2,i=i.concat(kD(e.serverSyncTree_,r[t].currentWriteId)),r[t].onComplete&&n.push(()=>r[t].onComplete(null,!0,r[t].currentOutputSnapshotResolved)),r[t].unwatcher();RL(e,k0(e.transactionQueueTree_,t)),Rx(e,e.transactionQueueTree_),Rh(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)Ti(n[e])}else{if("datastale"===n)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{wQ("transaction at "+o.toString()+" failed: "+n);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=n}RA(e,t)}},s)}function RA(e,t){let r=RN(e,t),n=k7(r),i=RP(e,r);return RD(e,i,n),n}function RD(e,t,r){if(0===t.length)return;let n=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let a=0;a<t.length;a++){let o=t[a],l=Em(r,o.path),c=!1,u;if(z(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)c=!0,u=o.abortReason,i=i.concat(kD(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=Rm)c=!0,u="maxretry",i=i.concat(kD(e.serverSyncTree_,o.currentWriteId,!0));else{let r=RR(e,o.path,s);o.currentInputSnapshot=r;let n=t[a].update(r.val());if(void 0!==n){Ro("transaction failed: Data returned ",n,o.path);let t=E4(n);"object"==typeof n&&null!=n&&eF(n,".priority")||(t=t.updatePriority(r.getPriority()));let a=o.currentWriteId,l=kJ(t,r,R_(e));o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=l,o.currentWriteId=RT(e),s.splice(s.indexOf(a),1),i=(i=i.concat(kA(e.serverSyncTree_,o.path,l,o.currentWriteId,o.applyLocally))).concat(kD(e.serverSyncTree_,a,!0))}else c=!0,u="nodata",i=i.concat(kD(e.serverSyncTree_,o.currentWriteId,!0))}Rh(e.eventQueue_,r,i),i=[],c&&(t[a].status=2,function(e){setTimeout(e,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&("nodata"===u?n.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):n.push(()=>t[a].onComplete(Error(u),!1,null))))}RL(e,e.transactionQueueTree_);for(let e=0;e<n.length;e++)Ti(n[e]);Rx(e,e.transactionQueueTree_)}function RN(e,t){let r,n=e.transactionQueueTree_;for(r=Ea(t);null!==r&&void 0===k1(n);)n=k0(n,r),r=Ea(t=El(t));return n}function RP(e,t){let r=[];return RM(e,t,r),r.sort((e,t)=>e.order-t.order),r}function RM(e,t,r){let n=k1(t);if(n)for(let e=0;e<n.length;e++)r.push(n[e]);k4(t,t=>{RM(e,t,r)})}function RL(e,t){let r=k1(t);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,k2(t,r.length>0?r:void 0)}k4(t,t=>{RL(e,t)})}function RF(e,t){let r=k7(RN(e,t)),n=k0(e.transactionQueueTree_,t);return k8(n,t=>{RB(e,t)}),RB(e,n),k5(n,t=>{RB(e,t)}),r}function RB(e,t){let r=k1(t);if(r){let n=[],i=[],s=-1;for(let t=0;t<r.length;t++)3===r[t].status||(1===r[t].status?(z(s===t-1,"All SENT items should be at beginning of queue."),s=t,r[t].status=3,r[t].abortReason="set"):(z(0===r[t].status,"Unexpected transaction status in abort"),r[t].unwatcher(),i=i.concat(kD(e.serverSyncTree_,r[t].currentWriteId,!0)),r[t].onComplete&&n.push(r[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?k2(t,void 0):r.length=s+1,Rh(e.eventQueue_,k7(t),i);for(let e=0;e<n.length;e++)Ti(n[e])}}function RU(e){let t="",r=e.split("/");for(let e=0;e<r.length;e++)if(r[e].length>0){let n=r[e];try{n=decodeURIComponent(n.replace(/\+/g," "))}catch(e){}t+="/"+n}return t}function Rj(e){let t={};for(let r of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===r.length)continue;let n=r.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):wQ(`Invalid query segment '${r}' in query '${e}'`)}return t}let Rq=function(e,t){let r=RV(e),n=r.namespace;"firebase.com"===r.domain&&wG(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===r.domain||wG("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||wY();let i="ws"===r.scheme||"wss"===r.scheme;return{repoInfo:new To(r.host,r.secure,n,i,t,"",n!==r.subdomain),path:new Ei(r.pathString)}},RV=function(e){let t="",r="",n="",i="",s="",a=!0,o="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(o=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=RU(e.substring(u,h)));let d=Rj(e.substring(Math.min(e.length,h)));(c=t.indexOf(":"))>=0?(a="https"===o||"wss"===o,l=parseInt(t.substring(c+1),10)):c=t.length;let f=t.slice(0,c);if("localhost"===f.toLowerCase())r="localhost";else if(f.split(".").length<=2)r=f;else{let e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),r=t.substring(e+1),s=n}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:r,subdomain:n,secure:a,scheme:o,pathString:i,namespace:s}};class Rz{constructor(e,t,r,n){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=n}get key(){return Ep(this._path)?null:Ec(this._path)}get ref(){return new RH(this._repo,this._path)}get _queryIdentifier(){let e=w6(Ia(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return Ia(this._queryParams)}isEqual(e){if(!((e=e0(e))instanceof Rz))return!1;let t=this._repo===e._repo,r=Eg(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&r&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+Eu(this._path)}}class RH extends Rz{constructor(e,t){super(e,t,new Ii,!1)}get parent(){let e=Ed(this._path);return null===e?null:new RH(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}kI(RH),kx(RH);let R$="FIREBASE_DATABASE_EMULATOR_HOST",RW={},RK=!1;function RG(e,t,r,n){let i=t.lastIndexOf(":"),s=eu(t.substring(0,i));e.repoInfo_=new To(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,r),n&&(e.authTokenProvider_=n)}function RQ(e,t,r,n,i){let s,a,o=n||e.options.databaseURL;void 0===o&&(e.options.projectId||wG("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),w$("Using default host for project ",e.options.projectId),o=`${e.options.projectId}-default-rtdb.firebaseio.com`);let l=Rq(o,i),c=l.repoInfo;"u">typeof process&&process.env&&(s=process.env[R$]),s?(a=!0,c=(l=Rq(o=`http://${s}?ns=${c.namespace}`,i)).repoInfo):a=!l.repoInfo.secure;let u=i&&a?new TI(TI.OWNER):new TE(e.name,e.options,t);return Rl("Invalid Firebase Database URL",l),Ep(l.path)||wG("Database URL must point to the root of a Firebase Database (not including a child path)."),new RX(RJ(c,e,u,new TT(e,r)),e)}function RY(e,t){let r=RW[t];r&&r[e.key]===e||wG(`Database ${t}(${e.repoInfo_}) has already been deleted.`),RI(e),delete r[e.key]}function RJ(e,t,r,n){let i=RW[t.name];i||(i={},RW[t.name]=i);let s=i[e.toURLString()];return s&&wG("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Rg(e,RK,r,n),i[e.toURLString()]=s,s}class RX{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ry(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new RH(this._repo,Es())),this._rootInternal}_delete(){return null!==this._rootInternal&&(RY(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&wG("Cannot call "+e+" on a deleted database.")}}function RZ(e=tZ(),t){let r=tj(e,"database").getImmediate({identifier:t});if(!r._instanceStarted){let e=eo("database");e&&R0(r,...e)}return r}function R0(e,t,r,n={}){let i;(e=e0(e))._checkNotDeleted("useEmulator");let s=`${t}:${r}`,a=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&eq(n,a.repoInfo_.emulatorOptions))return;wG("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}a.repoInfo_.nodeAdmin?(n.mockUserToken&&wG('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new TI(TI.OWNER)):n.mockUserToken&&(i=new TI("string"==typeof n.mockUserToken?n.mockUserToken:ed(n.mockUserToken,e.app.options.projectId))),eu(t)&&(eh(t),ef("Database",!0)),RG(a,s,n,i)}function R1(e){Tg(tY),tU(new e1("database",(e,{instanceIdentifier:t})=>RQ(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),t2(TC,Tw,e),t2(TC,Tw,"esm2020")}EA.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},EA.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Tb(wC.default.Client),R1("node");let R2={apiKey:"AIzaSyAM6qJVQyW-Dt9VQevxEBxKXewYcXiBCd4",authDomain:"spoorthy-school-daa68.firebaseapp.com",projectId:"spoorthy-school-daa68",storageBucket:"spoorthy-school-daa68.appspot.com",messagingSenderId:"44655361000",appId:"1:44655361000:web:b178f676d7e65c9019825d",measurementId:"G-RMRPMQXMBL",databaseURL:"https://spoorthy-school-daa68-default-rtdb.firebaseio.com"};p=t0().length?vr(f=tZ()):vt(f=tJ(R2),{localCache:_P({tabManager:_B()})}),CI(f),Cz(f),w_(f),RZ(f);let R3=async()=>{let e=b_(p),t=async e=>{let t=vJ(y2(p,e)),r=await bi(t),n=b_(p);r.docs.forEach(e=>{n.delete(e.ref)}),await n.commit()};await t("students"),await t("master_villages"),await t("master_classes"),await t("master_sections"),await t("master_class_sections"),[{schoolId:"SCSS93821",studentName:"Aarav Patel",grade:"Class 10",section:"A",fatherName:"Vikram Patel",fatherMobile:"9876543210",village:"Miyapur",status:"active",type:"student",password:"changeMe123",mustChangePassword:!0,createdAt:nw.now()},{schoolId:"SCSS93822",studentName:"Diya Sharma",grade:"Class 9",section:"B",fatherName:"Suresh Sharma",fatherMobile:"9876543211",village:"Bachupally",status:"active",type:"student",password:"changeMe123",mustChangePassword:!0,createdAt:nw.now()},{schoolId:"SCSS93823",studentName:"Ishaan Kumar",grade:"Class 10",section:"A",fatherName:"Rajeev Kumar",fatherMobile:"9876543212",village:"Nizampet",status:"active",type:"student",password:"changeMe123",mustChangePassword:!0,createdAt:nw.now()},{schoolId:"SCSS93824",studentName:"Vihaan Singh",grade:"Class 8",section:"C",fatherName:"Amit Singh",fatherMobile:"9876543213",village:"Kukatpally",status:"inactive",type:"student",password:"changeMe123",mustChangePassword:!0,createdAt:nw.now()},{schoolId:"SCSS93825",studentName:"Ananya Gupta",grade:"Class 10",section:"B",fatherName:"Manish Gupta",fatherMobile:"9876543214",village:"Miyapur",status:"active",type:"student",password:"changeMe123",mustChangePassword:!0,createdAt:nw.now()}].forEach(t=>{let r=y3(p,"students",t.schoolId);e.set(r,t)}),[{teacherId:"T202601",name:"Priya Reddy",subject:"Mathematics",designation:"Senior Teacher",phone:"9988776655",status:"active",type:"teacher",createdAt:nw.now()},{teacherId:"T202602",name:"Rahul Verma",subject:"Science",designation:"Lab Instructor",phone:"9988776656",status:"active",type:"teacher",createdAt:nw.now()},{teacherId:"T202603",name:"Sneha Kapoor",subject:"English",designation:"Teacher",phone:"9988776657",status:"on_leave",type:"teacher",createdAt:nw.now()}].forEach(t=>{let r=y3(p,"teachers",t.teacherId);e.set(r,t)}),[{studentName:"Rohan Gupta",grade:"Class 5",fatherName:"Sanjay Gupta",phone:"9123456780",status:"submitted",submittedAt:nw.now()},{studentName:"Meara Reddy",grade:"Class 1",fatherName:"Vishnu Reddy",phone:"9123456781",status:"approved",submittedAt:nw.now()}].forEach(t=>{let r=y3(y2(p,"applications"));e.set(r,t)}),[{studentId:"2026001",studentName:"Aarav Patel",amount:15e3,type:"credit",method:"razorpay",status:"success",date:nw.now()},{studentId:"2026002",studentName:"Diya Sharma",amount:5e3,type:"credit",method:"cash",status:"success",date:nw.now()},{studentId:"2026003",studentName:"Ishaan Kumar",amount:7500,type:"credit",method:"cash",status:"success",date:nw.now()}].forEach(t=>{let r=y3(y2(p,"payments"));e.set(r,t)});let r={terms:[{id:"term1",name:"Term 1",dueDate:"2026-06-30",isActive:!0,amounts:{"Class 10":15e3,"Class 9":14e3}},{id:"term2",name:"Term 2",dueDate:"2026-10-31",isActive:!0,amounts:{"Class 10":15e3,"Class 9":14e3}},{id:"term3",name:"Term 3",dueDate:"2027-02-28",isActive:!1,amounts:{"Class 10":15e3,"Class 9":14e3}}]},n=y3(p,"config","fees");e.set(n,r),[{title:"School Annual Day 2026",content:"We are excited to announce the Annual Day celebrations on Feb 20th. All parents are invited.",audience:"all",date:nw.now(),status:"published"},{title:"Exam Schedule - Class 10",content:"Pre-board exams start from March 1st. Please check the timetable section.",audience:"students",grade:"Class 10",date:nw.now(),status:"published"}].forEach(t=>{let r=y3(y2(p,"notices"));e.set(r,t)}),[{staffId:"T202603",staffName:"Sneha Kapoor",type:"Sick Leave",startDate:"2026-01-20",endDate:"2026-01-22",reason:"Viral fever",status:"pending",appliedAt:nw.now()},{staffId:"T202601",staffName:"Priya Reddy",type:"Casual Leave",startDate:"2026-02-05",endDate:"2026-02-05",reason:"Personal work",status:"approved",appliedAt:nw.now()}].forEach(t=>{let r=y3(y2(p,"leaves"));e.set(r,t)}),["Miyapur","Bachupally","Nizampet","Kukatpally","Hyder Nagar","Pragathi Nagar"].forEach(t=>{let r=y3(y2(p,"master_villages"));e.set(r,{name:t,isActive:!0,createdAt:nw.now(),updatedAt:nw.now()})});let i=Array.from({length:10},(e,t)=>`Class ${t+1}`),s=["A","B","C"];return i.forEach((t,r)=>{e.set(y3(y2(p,"master_classes")),{name:t,isActive:!0,order:r+1,createdAt:nw.now()})}),s.forEach(t=>{e.set(y3(y2(p,"master_sections")),{name:t,isActive:!0,createdAt:nw.now()})}),i.forEach(t=>{s.forEach(r=>{e.set(y3(y2(p,"master_class_sections")),{className:t,sectionName:r,displayName:`${t} - ${r}`,isActive:!0,createdAt:nw.now()})})}),await e.commit(),!0};async function R6(){try{return await R3(),j.NextResponse.json({success:!0,message:"Data seeded successfully with updated schema (Classes with Order)."})}catch(e){return j.NextResponse.json({success:!1,error:e.message},{status:500})}}e.s(["GET",()=>R6],62582);var R4=e.i(62582);let R5="",R8=new w.AppRouteRouteModule({definition:{kind:T.RouteKind.APP_ROUTE,page:"/api/setup-data/route",pathname:"/api/setup-data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/setup-data/route.ts",nextConfigOutput:R5,userland:R4}),{workAsyncStorage:R7,workUnitAsyncStorage:R9,serverHooks:xe}=R8;function xt(){return(0,E.patchFetch)({workAsyncStorage:R7,workUnitAsyncStorage:R9})}async function xr(e,t,r){R8.isDev&&(0,I.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/setup-data/route";n=n.replace(/\/index$/,"")||"/";let i=!1,s=await R8.prepare(e,t,{srcPage:n,multiZoneDraftMode:i});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:a,params:o,nextConfig:l,parsedUrl:c,isDraftMode:u,prerenderManifest:h,routerServerContext:d,isOnDemandRevalidate:f,revalidateOnlyGenerated:p,resolvedPathname:m,clientReferenceManifest:g,serverActionsManifest:y}=s,v=(0,x.normalizeAppPath)(n),_=!!(h.dynamicRoutes[v]||h.routes[m]),b=async()=>((null==d?void 0:d.render404)?await d.render404(e,t,c,!1):t.end("This page could not be found"),null);if(_&&!u){let e=!!h.routes[m],t=h.dynamicRoutes[v];if(t&&!1===t.fallback&&!e){if(l.experimental.adapterPath)return await b();throw new B.NoFallbackError}}let S=null;!_||R8.isDev||u||(S="/index"===(S=m)?"/":S);let C=!0===R8.isDev||!_,w=_&&!C;y&&g&&(0,R.setManifestsSingleton)({page:n,clientReferenceManifest:g,serverActionsManifest:y});let E=e.method||"GET",j=(0,k.getTracer)(),q=j.getActiveScopeSpan(),V={params:o,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!l.experimental.authInterrupts},cacheComponents:!!l.cacheComponents,supportsDynamicResponse:C,incrementalCache:(0,I.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:l.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,i)=>R8.onRequestError(e,t,n,i,d)},sharedContext:{buildId:a}},z=new O.NodeNextRequest(e),H=new O.NodeNextResponse(t),$=A.NextRequestAdapter.fromNodeNextRequest(z,(0,A.signalFromNodeResponse)(t));try{let i=async e=>R8.handle($,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==D.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${E} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${E} ${n}`)}),s=!!(0,I.getRequestMeta)(e,"minimalMode"),a=async a=>{var o,c;let m=async({previousCacheEntry:o})=>{try{if(!s&&f&&p&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(a);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=V.renderOpts.collectedTags;if(!_)return await (0,P.sendResponse)(z,H,n,V.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,M.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[F.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=F.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,i=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=F.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:U.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){if(null==o?void 0:o.isStale){let r=!1;await R8.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,N.getRevalidateReason)({isStaticGeneration:w,isOnDemandRevalidate:f})},r,d)}throw t}},g=await R8.handleResponse({req:e,nextConfig:l,cacheKey:S,routeKind:T.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:f,revalidateOnlyGenerated:p,responseGenerator:m,waitUntil:r.waitUntil,isMinimalMode:s});if(!_)return null;if((null==g||null==(o=g.value)?void 0:o.kind)!==U.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(c=g.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",f?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),u&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,M.fromNodeOutgoingHttpHeaders)(g.value.headers);return s&&_||y.delete(F.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,L.getCacheControlHeader)(g.cacheControl)),await (0,P.sendResponse)(z,H,new Response(g.value.body,{headers:y,status:g.value.status||200})),null};q?await a(q):await j.withPropagatedContext(e.headers,()=>j.trace(D.BaseServerSpan.handleRequest,{spanName:`${E} ${n}`,kind:k.SpanKind.SERVER,attributes:{"http.method":E,"http.target":e.url}},a))}catch(t){if(!(t instanceof B.NoFallbackError)){let r=!1;await R8.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,N.getRevalidateReason)({isStaticGeneration:w,isOnDemandRevalidate:f})},r,d)}if(_)throw t;return await (0,P.sendResponse)(z,H,new Response(null,{status:500})),null}}e.s(["handler",()=>xr,"patchFetch",()=>xt,"routeModule",()=>R8,"serverHooks",()=>xe,"workAsyncStorage",()=>R7,"workUnitAsyncStorage",()=>R9],76038)}];

//# sourceMappingURL=node_modules_9c640e3c._.js.map