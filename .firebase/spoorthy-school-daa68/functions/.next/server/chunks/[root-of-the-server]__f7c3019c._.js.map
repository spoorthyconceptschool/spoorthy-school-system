{"version":3,"sources":["../../../src/lib/firebase-admin.ts","../../../src/lib/notifications-server.ts"],"sourcesContent":["import \"server-only\";\r\nimport admin from \"firebase-admin\";\r\n\r\nif (!admin.apps.length) {\r\n    try {\r\n        if (process.env.FIREBASE_PRIVATE_KEY) {\r\n            console.log(`[FirebaseAdmin] Initializing with project: ${process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID}, bucket: ${process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET}`);\r\n            admin.initializeApp({\r\n                credential: admin.credential.cert({\r\n                    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n                    clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n                    privateKey: process.env.FIREBASE_PRIVATE_KEY.replace(/\\\\n/g, \"\\n\"),\r\n                }),\r\n                databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL || `https://${process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID}.firebaseio.com`,\r\n                storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET\r\n            });\r\n        } else {\r\n            console.warn(\"FIREBASE_PRIVATE_KEY missing. Admin SDK not initialized.\");\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Firebase Admin Init Failed:\", error);\r\n    }\r\n}\r\n\r\nexport const adminDb = admin.apps.length ? admin.firestore() : null as any;\r\nexport const adminAuth = admin.apps.length ? admin.auth() : null as any;\r\nexport const adminStorage = admin.apps.length ? admin.storage() : null as any;\r\nexport const adminRtdb = admin.apps.length ? admin.database() : null as any;\r\n","import { adminDb } from \"./firebase-admin\";\r\nimport { Timestamp } from \"firebase-admin/firestore\";\r\n\r\nexport async function createServerNotification(props: {\r\n    userId?: string;\r\n    target?: string;\r\n    title: string;\r\n    message: string;\r\n    type: string;\r\n    actionBy?: string;\r\n    actionByName?: string;\r\n}) {\r\n    try {\r\n        await adminDb.collection(\"notifications\").add({\r\n            ...props,\r\n            status: \"UNREAD\",\r\n            createdAt: Timestamp.now()\r\n        });\r\n    } catch (e) {\r\n        console.error(\"Failed to create server notification:\", e);\r\n    }\r\n}\r\n\r\nexport async function notifyManagerActionServer(props: {\r\n    userId?: string;\r\n    target?: string;\r\n    title: string;\r\n    message: string;\r\n    type: string;\r\n    actionBy: string;\r\n    actionByName: string;\r\n}) {\r\n    // 1. Notify Admins\r\n    await createServerNotification({\r\n        ...props,\r\n        target: \"ALL_ADMINS\",\r\n        title: `[Manager Action] ${props.title}`\r\n    });\r\n\r\n    // 2. Notify specific user or group if provided\r\n    if (props.userId || (props.target && props.target !== \"ALL_ADMINS\")) {\r\n        await createServerNotification(props);\r\n    }\r\n}\r\n"],"names":[],"mappings":"y/BAAA,EAAA,CAAA,CAAA,OACA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,GAAI,CAAC,EAAA,OAAK,CAAC,IAAI,CAAC,MAAM,CAClB,CADoB,EAChB,CACI,QAAQ,GAAG,CAAC,oBAAoB,EAAE,AAClC,QAAQ,GAAG,CAAC,CAAC,2CAA2C,4DAA8C,OACtG,EAAA,CADgH,MAC3G,CAAC,aAAa,CAAC,CAChB,WAAY,EAAA,OAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAC9B,SAAS,CAAA,GAHkJ,qBAI3J,YAAa,QAAQ,GAAG,CAAC,qBAAqB,CAC9C,WAAY,QAAQ,GAAG,CAAC,oBAAoB,CAAC,OAAO,CAAC,OAAQ,KACjE,GACA,YAAa,CAAA,2DACb,IAD8D,CAAC,QAAQ,AAC1D,CAAA,mCACjB,IAEA,QAAQ,IAAI,CAAC,KAJ4G,eAAe,CAAC,sCAMjJ,CAAE,MAAO,EAAO,CACZ,QAAQ,KAAK,CAAC,8BAA+B,EACjD,CAGG,IAAM,EAAU,EAAA,OAAK,CAAC,IAAI,CAAC,MAAM,CAAG,EAAA,OAAK,CAAC,SAAS,GAAK,KAClD,EAAY,EAAA,OAAK,CAAC,IAAI,CAAC,MAAM,CAAG,EAAA,OAAK,CAAC,IAAI,GAAK,KAC/C,EAAe,EAAA,OAAK,CAAC,IAAI,CAAC,MAAM,CAAG,EAAA,OAAK,CAAC,OAAO,GAAK,KACrD,EAAY,EAAA,OAAK,CAAC,IAAI,CAAC,MAAM,CAAG,EAAA,OAAK,CAAC,QAAQ,GAAK,sOC3BhE,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,gBAEO,eAAe,EAAyB,CAQ9C,EACG,GAAI,CACA,MAAM,EAAA,OAAO,CAAC,UAAU,CAAC,iBAAiB,GAAG,CAAC,CAC1C,GAAG,CAAK,CACR,OAAQ,SACR,UAAW,EAAA,SAAS,CAAC,GAAG,EAC5B,EACJ,CAAE,MAAO,EAAG,CACR,QAAQ,KAAK,CAAC,wCAAyC,EAC3D,CACJ,CAEO,eAAe,EAA0B,CAQ/C,EAEG,MAAM,EAAyB,CAC3B,GAAG,CAAK,CACR,OAAQ,aACR,MAAO,CAAC,iBAAiB,EAAE,EAAM,KAAK,CAAA,CAAE,AAC5C,IAGI,EAAM,MAAM,EAAK,EAAM,MAAM,EAAI,AAAiB,iBAAX,MAAM,AAAK,GAAe,AACjE,MAAM,EAAyB,EAEvC"}