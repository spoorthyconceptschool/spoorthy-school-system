(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3281,e=>{"use strict";let t=(0,e.i(75254).default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],3281)},93479,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,type:a,...l},r)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-12 w-full rounded-full border border-white/10 bg-[#282828] px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all shadow-inner hover:bg-[#333]",e),ref:r,...l}));l.displayName="Input",e.s(["Input",()=>l])},10204,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("label",{ref:l,className:(0,s.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...a}));l.displayName="Label",e.s(["Label",()=>l])},76639,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(26999),l=e.i(37727),r=e.i(75157);let i=s.Root,d=s.Trigger,n=s.Portal;s.Close;let o=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(s.Overlay,{ref:l,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));o.displayName=s.Overlay.displayName;let c=a.forwardRef(({className:e,children:a,...i},d)=>(0,t.jsxs)(n,{children:[(0,t.jsx)(o,{}),(0,t.jsxs)(s.Content,{ref:d,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[a,(0,t.jsxs)(s.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(l.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));c.displayName=s.Content.displayName;let m=({className:e,...a})=>(0,t.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});m.displayName="DialogHeader";let x=({className:e,...a})=>(0,t.jsx)("div",{className:(0,r.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});x.displayName="DialogFooter";let h=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(s.Title,{ref:l,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));h.displayName=s.Title.displayName;let p=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(s.Description,{ref:l,className:(0,r.cn)("text-sm text-muted-foreground",e),...a}));p.displayName=s.Description.displayName,e.s(["Dialog",()=>i,"DialogContent",()=>c,"DialogDescription",()=>p,"DialogFooter",()=>x,"DialogHeader",()=>m,"DialogTitle",()=>h,"DialogTrigger",()=>d])},84774,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:l,className:(0,s.cn)("w-full caption-bottom text-sm",e),...a})}));l.displayName="Table";let r=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("thead",{ref:l,className:(0,s.cn)("[&_tr]:border-b",e),...a}));r.displayName="TableHeader";let i=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tbody",{ref:l,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...a}));i.displayName="TableBody",a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tfoot",{ref:l,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let d=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tr",{ref:l,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));d.displayName="TableRow";let n=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("th",{ref:l,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));n.displayName="TableHead";let o=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("td",{ref:l,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));o.displayName="TableCell",a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("caption",{ref:l,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>l,"TableBody",()=>i,"TableCell",()=>o,"TableHead",()=>n,"TableHeader",()=>r,"TableRow",()=>d])},69049,41071,e=>{"use strict";var t=e.i(43476),a=e.i(84774),s=e.i(75157),l=e.i(19455);let r=(0,e.i(75254).default)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>r],41071);var i=e.i(55146);function d({data:e,columns:d,isLoading:n,onRowClick:o,actions:c}){return n?(0,t.jsx)("div",{className:"w-full h-48 flex items-center justify-center bg-white/5 rounded-xl animate-pulse",children:(0,t.jsx)("div",{className:"h-4 w-4 bg-accent/50 rounded-full animate-ping"})}):(0,t.jsxs)("div",{className:"w-full space-y-3",children:[(0,t.jsx)("div",{className:"overflow-x-auto rounded-xl md:rounded-2xl border border-white/10 bg-black/20 backdrop-blur-md custom-scrollbar",children:(0,t.jsxs)(a.Table,{className:"w-full",children:[(0,t.jsx)(a.TableHeader,{className:"bg-white/5",children:(0,t.jsxs)(a.TableRow,{className:"border-white/10 hover:bg-transparent",children:[d.map(e=>(0,t.jsx)(a.TableHead,{className:(0,s.cn)("text-muted-foreground font-black uppercase text-[7px] md:text-[10px] tracking-widest h-8 md:h-12 whitespace-nowrap px-2 md:px-6 italic",e.headerClassName),children:e.header},e.key)),c&&(0,t.jsx)(a.TableHead,{className:"w-[30px] md:w-[50px] whitespace-nowrap px-2 md:px-6"})]})}),(0,t.jsx)(a.TableBody,{children:0===e.length?(0,t.jsx)(a.TableRow,{children:(0,t.jsx)(a.TableCell,{colSpan:d.length+ +!!c,className:"h-24 md:h-32 text-center text-muted-foreground border-white/10 whitespace-nowrap text-[10px] md:text-sm italic",children:"No results found."})}):e.map((e,n)=>(0,t.jsxs)(a.TableRow,{className:(0,s.cn)("border-white/5 transition-all duration-300 hover:bg-[#64FFDA]/5 group cursor-default",o&&"cursor-pointer"),onClick:()=>o?.(e),children:[d.map(l=>(0,t.jsx)(a.TableCell,{className:(0,s.cn)("py-2 md:py-4 px-2 md:px-6 font-medium whitespace-nowrap text-[10px] md:text-sm",l.cellClassName),children:(0,t.jsx)("div",{className:"flex flex-col",children:l.render?l.render(e,n):(0,t.jsx)("span",{className:"text-white group-hover:text-accent transition-colors",children:e[l.key]})})},`${e.id}-${l.key}`)),c&&(0,t.jsx)(a.TableCell,{className:"px-2 md:px-6",children:(0,t.jsxs)(i.DropdownMenu,{children:[(0,t.jsx)(i.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(l.Button,{variant:"ghost",className:"h-7 w-7 md:h-8 md:w-8 p-0 hover:bg-white/10 text-muted-foreground hover:text-white",children:[(0,t.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,t.jsx)(r,{className:"h-3 w-3 md:h-4 md:w-4"})]})}),(0,t.jsxs)(i.DropdownMenuContent,{align:"end",className:"bg-[#0A192F] border-white/10 backdrop-blur-xl rounded-xl",children:[(0,t.jsx)(i.DropdownMenuLabel,{className:"text-[10px] uppercase font-black tracking-widest text-muted-foreground/60 p-3 italic",children:"Operations"}),(0,t.jsx)(i.DropdownMenuSeparator,{className:"bg-white/5"}),(0,t.jsx)("div",{className:"p-1",children:c(e)})]})]})})]},e.id||n))})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 md:py-4 px-3 md:px-6 bg-white/5 border border-white/10 rounded-xl md:rounded-2xl",children:[(0,t.jsxs)("div",{className:"text-[8px] md:text-xs font-black uppercase tracking-widest text-muted-foreground italic",children:["Scope: ",(0,t.jsxs)("span",{className:"text-white ml-1",children:[e.length," items"]})]}),(0,t.jsxs)("div",{className:"flex gap-1 md:gap-2",children:[(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Prev"}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Next"})]})]})]})}e.s(["DataTable",()=>d],69049)},40160,e=>{"use strict";let t=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],40160)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},70756,e=>{"use strict";let t=(0,e.i(75254).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],70756)},87828,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(76639),l=e.i(19455),r=e.i(93479),i=e.i(10204),d=e.i(31278),n=e.i(70756),o=e.i(78894),c=e.i(32341),m=e.i(80691);function x({isOpen:e,onClose:x,user:h,onSuccess:p}){let{user:u}=(0,c.useAuth)(),[g,b]=(0,a.useState)(""),[f,j]=(0,a.useState)(!1);if(!h)return null;let N=async e=>{if(e.preventDefault(),!h.uid)return void(0,m.toast)({title:"Error",description:"User has no linked account.",type:"error"});j(!0);try{let e=await fetch("/api/admin/users/reset-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await u?.getIdToken()}`},body:JSON.stringify({targetUid:h.uid,schoolId:h.schoolId,role:h.role,newPassword:g})}),t=await e.json();t.success?((0,m.toast)({title:"Password Changed",description:`Proactively updated password for ${h.name}.`,type:"success"}),b(""),p&&p(),x()):(0,m.toast)({title:"Reset Failed",description:t.error||"Could not change password.",type:"error"})}catch(e){(0,m.toast)({title:"Error",description:e.message||"An unexpected error occurred.",type:"error"})}finally{j(!1)}};return(0,t.jsx)(s.Dialog,{open:e,onOpenChange:x,children:(0,t.jsxs)(s.DialogContent,{className:"bg-zinc-950 border-white/10 text-white sm:max-w-[425px]",children:[(0,t.jsxs)(s.DialogHeader,{children:[(0,t.jsxs)(s.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Lock,{className:"w-5 h-5 text-amber-500"}),"Reset Password"]}),(0,t.jsxs)(s.DialogDescription,{children:["Set a new password for ",(0,t.jsx)("span",{className:"font-bold text-white",children:h.name})," (",h.schoolId,")."]})]}),(0,t.jsxs)("form",{onSubmit:N,className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg text-xs text-amber-500 flex gap-2",children:[(0,t.jsx)(o.AlertTriangle,{className:"w-4 h-4 shrink-0"}),(0,t.jsx)("p",{children:"This will immediately update the user's password and log them out of all devices."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"New Password"}),(0,t.jsx)(r.Input,{value:g,onChange:e=>b(e.target.value),className:"bg-black/20",placeholder:"Enter new password",required:!0,minLength:6})]}),(0,t.jsxs)(s.DialogFooter,{children:[(0,t.jsx)(l.Button,{type:"button",variant:"ghost",onClick:x,disabled:f,children:"Cancel"}),(0,t.jsxs)(l.Button,{type:"submit",className:"bg-amber-600 hover:bg-amber-700 text-white",disabled:f,children:[f?(0,t.jsx)(d.Loader2,{className:"animate-spin w-4 h-4 mr-2"}):null,"Update Password"]})]})]})]})})}e.s(["AdminChangePasswordModal",()=>x])},43432,e=>{"use strict";let t=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>t],43432)},69074,e=>{"use strict";let t=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],69074)},22915,e=>{"use strict";let t=(0,e.i(75254).default)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);e.s(["Archive",()=>t],22915)},29592,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(25913),l=e.i(75157);let r=(0,s.cva)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=a.forwardRef(({className:e,variant:a,...s},i)=>(0,t.jsx)("div",{ref:i,role:"alert",className:(0,l.cn)(r({variant:a}),e),...s}));i.displayName="Alert";let d=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("h5",{ref:s,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",e),...a}));d.displayName="AlertTitle";let n=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("div",{ref:s,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",e),...a}));n.displayName="AlertDescription",e.s(["Alert",()=>i,"AlertDescription",()=>n,"AlertTitle",()=>d])},51537,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(76639),l=e.i(19455),r=e.i(93479),i=e.i(10204),d=e.i(29592),n=e.i(78894),o=e.i(70756),c=e.i(27612),m=e.i(22915),x=e.i(31278),h=e.i(75157),p=e.i(80691);function u({isOpen:e,onClose:u,user:b,checkEligibility:f,onDeactivate:j,onDelete:N}){let[w,v]=(0,a.useState)("deactivate"),[y,k]=(0,a.useState)(!1),[S,C]=(0,a.useState)(null),[D,I]=(0,a.useState)(""),[T,A]=(0,a.useState)("");(0,a.useEffect)(()=>{e&&(v("deactivate"),I(""),A(""),C(null),f().then(C))},[e,f]);let M="DELETE",P=D===M,z=async()=>{if("delete"!==w||P){k(!0);try{"deactivate"===w?(await j(T||"Admin request"),(0,p.toast)({title:"User Deactivated",description:`${b.name} has been deactivated.`,type:"success"})):(await N(T||"Admin request"),(0,p.toast)({title:"User Deleted",description:`${b.name} has been permanently deleted.`,type:"success"})),u()}catch(e){console.error(e),(0,p.toast)({title:"Action Failed",description:e.message||"Something went wrong. Please try again.",type:"error"})}finally{k(!1)}}};return(0,t.jsx)(s.Dialog,{open:e,onOpenChange:u,children:(0,t.jsxs)(s.DialogContent,{className:"sm:max-w-md bg-black/95 border-white/10 text-white backdrop-blur-xl",children:[(0,t.jsxs)(s.DialogHeader,{children:[(0,t.jsx)(s.DialogTitle,{className:"text-xl font-bold flex items-center gap-2",children:"delete"===w?(0,t.jsxs)("span",{className:"text-red-500 flex items-center gap-2",children:[(0,t.jsx)(c.Trash2,{className:"w-5 h-5"})," Permanent Delete"]}):(0,t.jsxs)("span",{className:"text-yellow-500 flex items-center gap-2",children:[(0,t.jsx)(m.Archive,{className:"w-5 h-5"})," Deactivate User"]})}),(0,t.jsxs)(s.DialogDescription,{className:"text-zinc-400",children:["Managing access for ",(0,t.jsx)("span",{className:"text-white font-medium",children:b.name})," (",b.schoolId,")"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 bg-white/5 p-1 rounded-lg",children:[(0,t.jsxs)("button",{onClick:()=>v("deactivate"),className:(0,h.cn)("flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-md transition-all","deactivate"===w?"bg-yellow-500/20 text-yellow-500":"text-zinc-500 hover:text-zinc-300"),children:[(0,t.jsx)(m.Archive,{className:"w-4 h-4"})," Deactivate"]}),(0,t.jsxs)("button",{onClick:()=>v("delete"),disabled:!S?.canDelete&&!b.isDemo,className:(0,h.cn)("flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-md transition-all","delete"===w?"bg-red-500/20 text-red-500":S?.canDelete||b.isDemo?"text-zinc-500 hover:text-zinc-300":"opacity-50 cursor-not-allowed text-zinc-600"),children:[!S?.canDelete&&!b.isDemo&&(0,t.jsx)(o.Lock,{className:"w-3 h-3"})," ",(0,t.jsx)(c.Trash2,{className:"w-4 h-4"})," Hard Delete"]})]}),"deactivate"===w&&(0,t.jsxs)("div",{className:"space-y-4 animate-in fade-in zoom-in-95 duration-200",children:[(0,t.jsxs)(d.Alert,{className:"bg-yellow-500/10 border-yellow-500/20",children:[(0,t.jsx)(n.AlertTriangle,{className:"h-4 w-4 text-yellow-500"}),(0,t.jsx)(d.AlertTitle,{className:"text-yellow-500",children:"Recommended Action"}),(0,t.jsx)(d.AlertDescription,{className:"text-yellow-500/80 text-xs",children:"Deactivation immediately revokes login access but preserves historical records (payments, grades, etc.). This is reversible."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs uppercase text-zinc-500",children:"Reason (Optional)"}),(0,t.jsx)(r.Input,{className:"bg-black/40 border-white/10",placeholder:"e.g. Graduated, Left School",value:T,onChange:e=>A(e.target.value)})]})]}),"delete"===w&&(0,t.jsx)("div",{className:"space-y-4 animate-in fade-in zoom-in-95 duration-200",children:S?.canDelete||b.isDemo?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(d.Alert,{className:"bg-red-500/10 border-red-500/20",children:[(0,t.jsx)(g,{}),(0,t.jsx)(d.AlertTitle,{className:"text-red-500 font-bold",children:"ACCOUNT DELETION (ARCHIVE)"}),(0,t.jsxs)(d.AlertDescription,{className:"text-red-500/80 text-xs mt-1",children:["This action will deactivate the user account and mark it as ",(0,t.jsx)("strong",{children:"DELETED"}),". All data will be archived and preserved. The user will no longer be able to log in.",(0,t.jsx)("br",{className:"my-2"}),"This action can be reversed by an administrator."]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-xs uppercase text-red-400",children:"Type Confirmation"}),(0,t.jsx)("div",{className:"bg-black/40 p-2 rounded border border-red-500/20 text-center font-mono text-xs select-all text-red-300",children:M}),(0,t.jsx)(r.Input,{className:"bg-black/40 border-red-500/30 text-red-500 focus-visible:ring-red-500",placeholder:M,value:D,onChange:e=>I(e.target.value),onPaste:e=>e.preventDefault()})]})]}):(0,t.jsxs)(d.Alert,{className:"bg-red-900/20 border-red-500/20",children:[(0,t.jsx)(o.Lock,{className:"h-4 w-4 text-red-500"}),(0,t.jsx)(d.AlertTitle,{className:"text-red-500",children:"Deletion Blocked"}),(0,t.jsx)(d.AlertDescription,{className:"text-red-400/80 text-xs mt-1",children:S?.reason||"This user has linked records and cannot be hard deleted."})]})})]}),(0,t.jsxs)(s.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,t.jsx)(l.Button,{variant:"ghost",onClick:u,disabled:y,children:"Cancel"}),(0,t.jsxs)(l.Button,{disabled:y||"delete"===w&&!P,className:(0,h.cn)("delete"===w?"bg-red-600 hover:bg-red-700 text-white":"bg-yellow-600 hover:bg-yellow-700 text-white"),onClick:z,children:[y&&(0,t.jsx)(x.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),"delete"===w?"Delete Permanently":"Confirm Deactivation"]})]})]})})}function g(){return(0,t.jsx)(n.AlertTriangle,{className:"h-4 w-4 text-red-500"})}e.s(["DeleteUserModal",()=>u])},34161,e=>{"use strict";let t=(0,e.i(75254).default)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);e.s(["Key",()=>t],34161)},87130,e=>{"use strict";let t=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},34858,e=>{"use strict";var t=e.i(43476);e.i(36180);var a=e.i(98925),s=e.i(59141),l=e.i(71645),r=e.i(76639),i=e.i(19455),d=e.i(93479),n=e.i(10204),o=e.i(7233),c=e.i(31278),m=e.i(95468),x=e.i(3281),h=e.i(67489),p=e.i(32341),u=e.i(72498),g=e.i(80691),b=e.i(71431);function f({onSuccess:e}){let{user:f}=(0,p.useAuth)(),{villages:j,classes:N,sections:w,classSections:v,branding:y,loading:k}=(0,u.useMasterData)(),[S,C]=(0,l.useState)(!1),[D,I]=(0,l.useState)(!1),[T,A]=(0,l.useState)(null),[M,P]=(0,l.useState)({studentName:"",parentName:"",parentPhone:"",villageId:"",classId:"",sectionId:"",transportRequired:!1}),z=Object.values(j||{}).map(e=>({id:e.id,name:e.name})).sort((e,t)=>e.name.localeCompare(t.name)),R=Object.values(N||{}).map(e=>({id:e.id,name:e.name,order:e.order||99})).sort((e,t)=>e.order-t.order),L=M.classId?Object.values(v||{}).filter(e=>e.classId===M.classId).map(e=>w[e.sectionId]).filter(Boolean).map(e=>({id:e.id,name:e.name})).sort((e,t)=>e.name.localeCompare(t.name)):[],O=async t=>{if(t.preventDefault(),!M.studentName||M.studentName.length<2)return(0,g.toast)({title:"Name Required",type:"error"});if(!/^\d{10}$/.test(M.parentPhone))return(0,g.toast)({title:"Invalid Mobile",type:"error"});if(!M.villageId||!M.classId)return(0,g.toast)({title:"Missing Fields",type:"error"});I(!0);try{let t=await f?.getIdToken(),a=z.find(e=>e.id===M.villageId)?.name||"",s=R.find(e=>e.id===M.classId)?.name||"",l=L.find(e=>e.id===M.sectionId)?.name||"",r={studentName:M.studentName.trim(),parentName:M.parentName.trim(),parentMobile:M.parentPhone,villageId:M.villageId,villageName:a,classId:M.classId,className:s,sectionId:M.sectionId,sectionName:l,transportRequired:M.transportRequired};console.log("Creating student with payload:",r);let i=await fetch("/api/admin/students/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(r)}),d=await i.json();if(!i.ok)throw Error(d.error);(0,g.toast)({title:"Admission Successful",type:"success"}),A({schoolId:d.data.schoolId,studentName:M.studentName,className:s||"N/A"}),P({studentName:"",parentName:"",parentPhone:"",villageId:"",classId:"",sectionId:"",transportRequired:!1}),e?.()}catch(e){(0,g.toast)({title:"Admission Failed",description:e.message,type:"error"})}finally{I(!1)}};return(0,t.jsxs)(r.Dialog,{open:S,onOpenChange:e=>{C(e),e||A(null)},children:[(0,t.jsx)(r.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{className:"gap-2 bg-accent text-accent-foreground",children:[(0,t.jsx)(o.Plus,{size:16})," Add Student"]})}),(0,t.jsxs)(r.DialogContent,{className:"sm:max-w-[500px] bg-black/95 border-white/10 text-white",children:[(0,t.jsx)(r.DialogHeader,{children:(0,t.jsx)(r.DialogTitle,{children:"Student Admission"})}),T?(0,t.jsxs)("div",{className:"py-10 flex flex-col items-center space-y-6",children:[(0,t.jsx)(m.CheckCircle2,{className:"w-12 h-12 text-emerald-500"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h3",{className:"text-xl font-bold",children:"Admission Confirmed!"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[T.studentName," enrolled successfully."]})]}),(0,t.jsx)("div",{className:"flex flex-col w-full gap-2",children:(0,t.jsxs)(i.Button,{className:"w-full bg-emerald-500 hover:bg-emerald-600 gap-2 font-bold h-12",onClick:async()=>{I(!0);let e=(0,a.query)((0,a.collection)(s.db,"student_fee_ledgers"),(0,a.where)("studentId","==",T.schoolId)),t=await (0,a.getDocs)(e);if(!t.empty){let e=t.docs[0].data();(0,b.printStudentFeeStructure)({studentName:T.studentName,schoolId:T.schoolId,className:T.className,items:e.items||[],totalPaid:e.totalPaid||0,schoolLogo:y?.schoolLogo,schoolName:y?.schoolName})}I(!1)},children:[(0,t.jsx)(x.Printer,{size:18})," Print / View Fee Structure"]})}),(0,t.jsx)(i.Button,{variant:"ghost",onClick:()=>C(!1),children:"Done"})]}):(0,t.jsxs)("form",{onSubmit:O,className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Student Name"}),(0,t.jsx)(d.Input,{required:!0,value:M.studentName,onChange:e=>P({...M,studentName:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Parent Name"}),(0,t.jsx)(d.Input,{required:!0,value:M.parentName,onChange:e=>P({...M,parentName:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Parent Mobile"}),(0,t.jsx)(d.Input,{required:!0,maxLength:10,value:M.parentPhone,onChange:e=>P({...M,parentPhone:e.target.value.replace(/\D/g,"")})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Village"}),(0,t.jsxs)(h.Select,{onValueChange:e=>P({...M,villageId:e}),children:[(0,t.jsx)(h.SelectTrigger,{children:(0,t.jsx)(h.SelectValue,{placeholder:"Select Village"})}),(0,t.jsx)(h.SelectContent,{children:z.map(e=>(0,t.jsx)(h.SelectItem,{value:e.id,children:e.name},e.id))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Class"}),(0,t.jsxs)(h.Select,{onValueChange:e=>P({...M,classId:e,sectionId:""}),children:[(0,t.jsx)(h.SelectTrigger,{children:(0,t.jsx)(h.SelectValue,{placeholder:"Select Class"})}),(0,t.jsx)(h.SelectContent,{children:R.map(e=>(0,t.jsx)(h.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Section"}),(0,t.jsxs)(h.Select,{value:M.sectionId,onValueChange:e=>P({...M,sectionId:e}),children:[(0,t.jsx)(h.SelectTrigger,{children:(0,t.jsx)(h.SelectValue,{placeholder:"Section"})}),(0,t.jsx)(h.SelectContent,{children:L.map(e=>(0,t.jsx)(h.SelectItem,{value:e.id,children:e.name},e.id))})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 py-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"transport",className:"w-4 h-4 rounded border-white/20 bg-black/50 accent-emerald-500",checked:M.transportRequired,onChange:e=>P({...M,transportRequired:e.target.checked})}),(0,t.jsx)(n.Label,{htmlFor:"transport",className:"cursor-pointer",children:"Transport Required?"})]}),(0,t.jsx)(i.Button,{type:"submit",disabled:D,className:"w-full bg-accent text-accent-foreground font-bold h-12",children:D?(0,t.jsx)(c.Loader2,{className:"animate-spin"}):"Confirm Admission"})]})]})]})}e.s(["AddStudentModal",()=>f])},49444,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566);e.i(36180);var l=e.i(98925),r=e.i(59141),i=e.i(34858),d=e.i(51537),n=e.i(87828),o=e.i(87130),c=e.i(55436),m=e.i(41071),x=e.i(34161),h=e.i(27612),p=e.i(31278),u=e.i(84614),g=e.i(46897),b=e.i(43432),f=e.i(10980),j=e.i(93479),N=e.i(76639),w=e.i(19455),v=e.i(69074);let y=(0,e.i(75254).default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var k=e.i(40160),S=e.i(69638),C=e.i(70016),D=e.i(72498);function I({onSuccess:e}){let[s,l]=(0,a.useState)(!1),[r,i]=(0,a.useState)(null),[d,n]=(0,a.useState)([]),[o,c]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),{classes:h}=(0,D.useMasterData)(),u=async()=>{if(d.length){c(!0),x(null);try{let t=await fetch("/api/admin/students/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({students:d})}),a=await t.json();if(!t.ok)throw Error(a.error||"Upload failed");x(a),a.success>0&&e()}catch(e){console.error(e),alert("Upload Error: "+e.message)}finally{c(!1)}}};return(0,t.jsxs)(N.Dialog,{open:s,onOpenChange:e=>{l(e),e||(i(null),n([]),x(null))},children:[(0,t.jsx)(N.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(w.Button,{variant:"outline",className:"gap-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20",children:[(0,t.jsx)(y,{className:"w-4 h-4"})," Bulk Import"]})}),(0,t.jsxs)(N.DialogContent,{className:"bg-black/95 border-white/10 text-white max-w-2xl",children:[(0,t.jsx)(N.DialogHeader,{children:(0,t.jsx)(N.DialogTitle,{children:"Import Students via Excel/CSV"})}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{className:"bg-white/5 p-4 rounded-lg flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,t.jsx)("p",{className:"font-bold text-white mb-1",children:"Step 1: Download Template"}),(0,t.jsx)("p",{children:"Use our template ensuring columns match exactly."})]}),(0,t.jsx)(w.Button,{variant:"ghost",size:"sm",asChild:!0,className:"text-blue-400 hover:bg-blue-400/10 cursor-pointer",children:(0,t.jsxs)("a",{href:"/templates/student_import.xlsx",download:"StudentImportTemplate.xlsx",children:[(0,t.jsx)(k.Download,{className:"w-4 h-4 mr-2"})," Template.xlsx"]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"font-bold text-sm text-gray-400",children:"Step 2: Upload File"}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-white/10 rounded-lg p-6 text-center hover:bg-white/5 transition-colors relative",children:[(0,t.jsx)("input",{type:"file",accept:".xlsx, .xls, .csv",onChange:e=>{let t=e.target.files?.[0];if(!t)return;i(t);let a=new FileReader;a.onload=e=>{let t=e.target?.result,a=C.read(t,{type:"binary"}),s=a.SheetNames[0],l=a.Sheets[s];n(C.utils.sheet_to_json(l)),x(null)},a.readAsBinaryString(t)},className:"absolute inset-0 opacity-0 cursor-pointer"}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-400",children:[(0,t.jsx)(v.Upload,{className:"w-8 h-8 opacity-50"}),(0,t.jsx)("p",{children:r?r.name:"Click to browse or drag file here"})]})]})]}),d.length>0&&!m&&(0,t.jsxs)("div",{className:"space-y-4 animate-in fade-in",children:[(0,t.jsxs)("div",{className:"bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 p-3 rounded text-sm flex items-center gap-2",children:[(0,t.jsx)(S.CheckCircle,{className:"w-4 h-4"}),"Ready to import ",d.length," students."]}),(0,t.jsx)(w.Button,{onClick:u,disabled:o,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold",children:o?(0,t.jsx)(p.Loader2,{className:"animate-spin mr-2"}):"Start Import"})]}),m&&(0,t.jsxs)("div",{className:"bg-black/30 p-4 rounded-lg border border-white/10 space-y-2 animate-in fade-in",children:[(0,t.jsx)("h4",{className:"font-bold mb-2",children:"Import Results"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,t.jsxs)("div",{className:"bg-emerald-500/10 p-2 rounded border border-emerald-500/20 text-emerald-400",children:[(0,t.jsx)("div",{className:"text-xl font-bold",children:m.success}),(0,t.jsx)("div",{className:"text-xs uppercase",children:"Success"})]}),(0,t.jsxs)("div",{className:"bg-red-500/10 p-2 rounded border border-red-500/20 text-red-400",children:[(0,t.jsx)("div",{className:"text-xl font-bold",children:m.failed}),(0,t.jsx)("div",{className:"text-xs uppercase",children:"Failed"})]})]}),m.errors.length>0&&(0,t.jsx)("div",{className:"mt-4 max-h-32 overflow-y-auto text-xs text-red-300 space-y-1 bg-black/20 p-2 rounded",children:m.errors.map((e,a)=>(0,t.jsxs)("div",{children:["â€¢ ",e]},a))}),(0,t.jsx)(w.Button,{variant:"outline",onClick:()=>{i(null),n([]),x(null),l(!1)},className:"w-full mt-4",children:"Done"})]})]})]})]})}var T=e.i(69049),A=e.i(10204),M=e.i(78583),P=e.i(3281),z=e.i(75157);function R({students:e}){let{classes:s,villages:l,branding:r}=(0,D.useMasterData)(),[i,d]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[c,m]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[u,b]=(0,a.useState)("none"),f=Object.values(s||{}).map(e=>({id:e.id,name:e.name,order:e.order||99})).sort((e,t)=>e.order-t.order),j=Object.values(l||{}).map(e=>({id:e.id,name:e.name})).sort((e,t)=>e.name.localeCompare(t.name)),v=()=>e.filter(e=>{let t=0===c.length||c.includes(e.classId)||c.includes(e.className),a=0===x.length||x.includes(e.villageId)||x.includes(e.villageName);return t&&a}),y=async()=>{o(!0);try{let e=C.utils.book_new(),t=v();if(0===t.length){alert("No students found for the selected filters."),o(!1);return}let a=t.map(e=>({ID:e.schoolId,"Student Name":e.studentName,"Parent Name":e.parentName,Class:e.className,Section:e.sectionName||"N/A","Parent Mobile":e.parentMobile,Village:e.villageName,Status:e.status,"Login Password":e.recoveryPassword||"N/A"})),s=C.utils.json_to_sheet(a,{header:["ID","Student Name","Parent Name","Class","Section","Parent Mobile","Village","Status","Login Password"]});C.utils.book_append_sheet(e,s,"Students");let l=C.write(e,{bookType:"xlsx",type:"array"}),r=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download=`Student_Reports_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(i),document.body.removeChild(n),d(!1)}catch(e){console.error(e),alert("Export Failed: "+e.message)}finally{o(!1)}};return(0,t.jsxs)(N.Dialog,{open:i,onOpenChange:d,children:[(0,t.jsx)(N.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(w.Button,{variant:"outline",className:"h-9 md:h-12 gap-2 border-white/10 bg-white/5 text-white/70 hover:bg-white/10 rounded-xl px-4 md:px-6 transition-all",children:[(0,t.jsx)(M.FileText,{className:"w-4 h-4"})," ",(0,t.jsx)("span",{className:"hidden sm:inline",children:"Reports & Export"}),(0,t.jsx)("span",{className:"sm:hidden",children:"Reports"})]})}),(0,t.jsxs)(N.DialogContent,{className:"bg-[#0A192F] border-white/10 text-white max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl shadow-2xl backdrop-blur-3xl",children:[(0,t.jsx)(N.DialogHeader,{children:(0,t.jsx)(N.DialogTitle,{className:"text-2xl font-display font-bold italic bg-gradient-to-r from-blue-400 to-indigo-400 bg-clip-text text-transparent",children:"Student Reporting Center"})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"p-5 bg-blue-500/5 border border-blue-500/10 rounded-2xl space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-blue-400 text-xs font-bold uppercase tracking-tighter",children:[(0,t.jsx)(P.Printer,{size:16})," Student List Printing"]}),(0,t.jsx)("p",{className:"text-[11px] text-blue-300 opacity-70 leading-relaxed italic",children:"Generate high-quality physical student directories. Use the filters on the right to target specific groups."}),(0,t.jsxs)("div",{className:"space-y-2 pt-1 border-t border-white/5 mt-2",children:[(0,t.jsx)(A.Label,{className:"text-[10px] font-black text-white/40 uppercase tracking-widest",children:"Grouping Strategy"}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{id:"none",label:"None"},{id:"class",label:"By Class"},{id:"village",label:"By Village"}].map(e=>(0,t.jsx)("button",{onClick:()=>b(e.id),className:(0,z.cn)("py-2 px-2 rounded-xl text-[11px] font-bold border transition-all",u===e.id?"bg-blue-600 border-blue-500 text-white shadow-lg shadow-blue-500/20":"bg-white/5 border-white/10 text-white/40 hover:bg-white/10"),children:e.label},e.id))})]}),(0,t.jsxs)(w.Button,{onClick:()=>{let e=v();if(0===e.length)return void alert("No students selected");e.sort((e,t)=>(e.studentName||"").localeCompare(t.studentName||""));let t=window.open("","_blank");if(!t)return;let a=new Date().toLocaleString(),s={};"none"===u?s["Student Directory Report"]=e:e.forEach(e=>{let t="class"===u?e.className||"Other Class":e.villageName||"Other Village";s[t]||(s[t]=[]),s[t].push(e)});let l=Object.keys(s),i=`
            <html>
            <head>
                <title>Student List report</title>
                <style>
                    @media print {
                        .page-break { page-break-after: always; }
                    }
                    body { font-family: sans-serif; padding: 20px; color: #333; }
                    .group-container { margin-bottom: 40px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 11px; }
                    th { background-color: #f2f2f2; }
                    h1 { text-align: center; color: #333; margin-bottom: 5px; }
                    .header-meta { text-align: center; font-size: 12px; color: #666; margin-bottom: 20px; }
                    .branding { display: flex; align-items: center; justify-content: center; gap: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                    .school-info h1 { margin: 0; font-size: 24px; text-align: left; }
                    .school-info p { margin: 2px 0; font-size: 12px; color: #666; }
                    .group-header { font-size: 16px; font-bold; margin-top: 20px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
                </style>
            </head>
            <body>
                ${l.map((e,t)=>`
                    <div class="group-container ${"none"!==u?"page-break":""}">
                        <div class="branding">
                            ${r?.schoolLogo?`<img src="${r.schoolLogo}" style="height: 60px;" />`:""}
                            <div class="school-info">
                                <h1>${r?.schoolName}</h1>
                                <p>${r?.address||""}</p>
                                <p><strong>${"none"!==u?`${u.toUpperCase()} List: ${e}`:e}</strong> | ${a}</p>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 40px;">S.No</th>
                                    <th style="width: 80px;">ID</th>
                                    <th>Student Name</th>
                                    <th>Parent Name</th>
                                    <th>Mobile</th>
                                    <th>Class</th>
                                    <th>Village</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${s[e].map((e,t)=>`
                                    <tr>
                                        <td>${t+1}</td>
                                        <td>${e.schoolId}</td>
                                        <td>${e.studentName}</td>
                                        <td>${e.parentName}</td>
                                        <td>${e.parentMobile}</td>
                                        <td>${e.className}</td>
                                        <td>${e.villageName}</td>
                                    </tr>
                                `).join("")}
                            </tbody>
                        </table>
                        <p style="font-size: 10px; margin-top: 10px;">Total Students in this group: ${s[e].length}</p>
                    </div>
                `).join("")}
                <script>
                    window.onload = () => { window.print(); window.close(); };
                </script>
            </body>
            </html>
        `;t.document.write(i),t.document.close()},variant:"outline",className:"w-full mt-2 h-12 gap-2 border-blue-500/40 bg-blue-500/10 text-blue-400 hover:bg-blue-600 hover:text-white rounded-2xl transition-all font-black uppercase tracking-tighter",children:[(0,t.jsx)(P.Printer,{size:16})," Print Selected Students"]})]}),(0,t.jsxs)("div",{className:"p-4 bg-white/5 border border-white/10 rounded-2xl space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-emerald-400 text-xs font-bold",children:[(0,t.jsx)(k.Download,{size:14})," Quick Export"]}),(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground italic",children:"Download student data in Excel format for offline management."})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(A.Label,{className:"text-muted-foreground uppercase text-[10px] font-black tracking-widest flex items-center gap-2",children:[(0,t.jsx)(g.MapPin,{size:12})," Filter Hierarchy"]}),(0,t.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-widest",children:"Target Classes"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>m(f.map(e=>e.id)),className:"text-[9px] font-black text-emerald-400 hover:underline uppercase",children:"All"}),(0,t.jsx)("button",{onClick:()=>m([]),className:"text-[9px] font-black text-red-400 hover:underline uppercase",children:"Clear"})]})]}),(0,t.jsx)("div",{className:"h-[120px] overflow-y-auto pr-2 custom-scrollbar space-y-1",children:f.map(e=>(0,t.jsxs)("div",{onClick:()=>{var t;return t=e.id,void m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:(0,z.cn)("flex items-center gap-2 p-1.5 rounded-lg cursor-pointer text-[11px] transition-colors",c.includes(e.id)?"bg-blue-500/20 text-blue-400":"text-white/40 hover:bg-white/5"),children:[(0,t.jsx)("div",{className:(0,z.cn)("w-3 h-3 rounded-sm border",c.includes(e.id)?"bg-blue-500 border-blue-500":"border-white/20")}),e.name]},e.id))})]}),(0,t.jsxs)("div",{className:"border-t border-white/5 pt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-widest",children:"Target Villages"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>h(j.map(e=>e.id)),className:"text-[9px] font-black text-cyan-400 hover:underline uppercase",children:"All"}),(0,t.jsx)("button",{onClick:()=>h([]),className:"text-[9px] font-black text-red-500 hover:underline uppercase",children:"Clear"})]})]}),(0,t.jsx)("div",{className:"h-[120px] overflow-y-auto pr-2 custom-scrollbar space-y-1",children:j.map(e=>(0,t.jsxs)("div",{onClick:()=>{var t;return t=e.id,void h(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:(0,z.cn)("flex items-center gap-2 p-1.5 rounded-lg cursor-pointer text-[11px] transition-colors",x.includes(e.id)?"bg-cyan-500/20 text-cyan-400":"text-white/40 hover:bg-white/5"),children:[(0,t.jsx)("div",{className:(0,z.cn)("w-3 h-3 rounded-sm border",x.includes(e.id)?"bg-cyan-500 border-cyan-500":"border-white/20")}),e.name]},e.id))})]})]})})]}),(0,t.jsx)(N.DialogFooter,{className:"pt-4 border-t border-white/5",children:(0,t.jsx)(w.Button,{onClick:y,disabled:n,className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white font-black h-12 rounded-2xl shadow-xl shadow-emerald-500/20 transition-all uppercase tracking-tighter",children:n?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Loader2,{className:"animate-spin w-4 h-4"})," Generating Package..."]}):"Export Student Dataset"})})]})]})}var L=e.i(67489),O=e.i(55146),B=e.i(87486),E=e.i(32341);function V(){let e=(0,s.useRouter)(),{user:N}=(0,E.useAuth)(),{villages:v,classes:y,selectedYear:k}=(0,D.useMasterData)(),[S,C]=(0,a.useState)("");(0,a.useEffect)(()=>{if(!N)return;let e=(0,l.onSnapshot)((0,l.doc)(r.db,"users",N.uid),e=>{e.exists()&&C(e.data().role)});return()=>e()},[N]);let[A,M]=(0,a.useState)([]),[P,V]=(0,a.useState)([]),[$,F]=(0,a.useState)(!0),[U,H]=(0,a.useState)(""),[q,_]=(0,a.useState)("all"),[G,K]=(0,a.useState)("all"),[J,Y]=(0,a.useState)("all"),Q=Object.values(v||{}).map(e=>({id:e.id,name:e.name})).sort((e,t)=>e.name.localeCompare(t.name)),X=Object.values(y||{}).map(e=>({id:e.id,name:e.name,order:e.order||99})).sort((e,t)=>e.order-t.order),[W,Z]=(0,a.useState)(null),[ee,et]=(0,a.useState)(!1),[ea,es]=(0,a.useState)(null),[el,er]=(0,a.useState)(!1),[ei,ed]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=!0,t=ei?(0,l.query)((0,l.collection)(r.db,"students"),(0,l.limit)(1e3)):(0,l.query)((0,l.collection)(r.db,"students"),(0,l.orderBy)("createdAt","desc"),(0,l.limit)(1e3)),a=(0,l.onSnapshot)(t,t=>{if(!e)return;let a=t.docs.map(e=>({id:e.id,studentDocId:e.id,...e.data()}));ei&&(a=a.sort((e,t)=>(t.createdAt?.seconds||0)-(e.createdAt?.seconds||0))),M(a),F(!1)},t=>{e&&(t.message.includes("index")&&!ei?ed(!0):(console.error("Student list error:",t),F(!1)))});return()=>{e=!1,a()}},[ei]),(0,a.useEffect)(()=>{let e=A;if(k&&(e=e.filter(e=>(e.academicYear||"2025-2026")===k)),"all"!==q&&(e=e.filter(e=>e.status===q)),"all"!==J&&(e=e.filter(e=>e.classId===J||e.className===J)),"all"!==G&&(e=e.filter(e=>e.villageId===G||e.villageName===G)),U.trim()){let t=U.toLowerCase().trim();e=e.filter(e=>e.studentName?.toLowerCase().includes(t)||e.schoolId?.toLowerCase().includes(t)||e.parentName?.toLowerCase().includes(t)||e.parentMobile?.includes(t))}V(e)},[U,q,G,J,A,k]),(0,t.jsxs)("div",{className:"space-y-4 md:space-y-6 animate-in fade-in duration-500 max-w-7xl mx-auto p-1 md:p-6 pb-20",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between pt-2 md:pt-4 gap-4 md:gap-6 px-1 md:px-0",children:[(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,t.jsx)("h1",{className:"text-2xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic leading-tight",children:"Student Directory"}),(0,t.jsxs)("p",{className:"text-muted-foreground text-[10px] md:text-lg tracking-tight uppercase font-black opacity-50",children:["Managing ",(0,t.jsxs)("span",{className:"text-white",children:[A.length," enrolled students"]})," across all grades"]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 md:gap-2",children:[(0,t.jsx)(R,{students:P}),"MANAGER"!==S&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I,{onSuccess:()=>{window.location.reload()}}),(0,t.jsx)(i.AddStudentModal,{})]})]})]}),(0,t.jsxs)("div",{className:"bg-black/20 p-3 md:p-5 rounded-xl md:rounded-2xl border border-white/10 backdrop-blur-md space-y-3 md:space-y-4 shadow-2xl mx-0",children:[(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)(c.Search,{className:"absolute left-3 md:left-4 top-1/2 -translate-y-1/2 w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"}),(0,t.jsx)(j.Input,{placeholder:"Search name, ID, or mobile...",className:"pl-9 md:pl-11 h-10 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl focus:ring-accent/30 text-xs md:text-sm",value:U,onChange:e=>H(e.target.value)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:flex lg:flex-wrap gap-1.5 md:gap-2",children:[(0,t.jsxs)(L.Select,{value:q,onValueChange:_,children:[(0,t.jsx)(L.SelectTrigger,{className:"w-full lg:w-[160px] h-9 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl text-xs md:text-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Filter,{size:12,className:"text-white/40"}),(0,t.jsx)(L.SelectValue,{placeholder:"Status"})]})}),(0,t.jsxs)(L.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(L.SelectItem,{value:"all",children:"All Status"}),(0,t.jsx)(L.SelectItem,{value:"ACTIVE",children:"Active"}),(0,t.jsx)(L.SelectItem,{value:"INACTIVE",children:"Inactive"})]})]}),(0,t.jsxs)(L.Select,{value:J,onValueChange:Y,children:[(0,t.jsx)(L.SelectTrigger,{className:"w-full lg:w-[160px] h-9 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl text-xs md:text-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.BookOpen,{size:12,className:"text-white/40"}),(0,t.jsx)(L.SelectValue,{placeholder:"Class"})]})}),(0,t.jsxs)(L.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(L.SelectItem,{value:"all",children:"All Classes"}),X.map(e=>(0,t.jsx)(L.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)(L.Select,{value:G,onValueChange:K,children:[(0,t.jsx)(L.SelectTrigger,{className:"w-full lg:w-[180px] h-9 md:h-12 bg-white/5 border-white/10 rounded-lg md:rounded-xl text-xs md:text-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.MapPin,{size:12,className:"text-white/40"}),(0,t.jsx)(L.SelectValue,{placeholder:"Village"})]})}),(0,t.jsxs)(L.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(L.SelectItem,{value:"all",children:"All Villages"}),Q.map(e=>(0,t.jsx)(L.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(U||"all"!==q||"all"!==J||"all"!==G)&&(0,t.jsx)(w.Button,{variant:"ghost",size:"sm",onClick:()=>{H(""),_("all"),Y("all"),K("all")},className:"h-9 md:h-12 px-3 md:px-6 text-[8px] md:text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-white rounded-lg md:rounded-xl border border-dashed border-white/10 transition-all col-span-2 md:col-span-1",children:"Clear Filters"})]})]}),$?(0,t.jsx)("div",{className:"flex justify-center p-20 animate-pulse",children:(0,t.jsx)(p.Loader2,{className:"w-12 h-12 animate-spin text-accent"})}):(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)(T.DataTable,{data:P,isLoading:$,onRowClick:t=>e.push(`/admin/students/${t.schoolId}`),columns:[{key:"studentInfo",header:"Student Info",render:e=>(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-9 h-9 rounded-xl bg-white/5 flex items-center justify-center border border-white/5 group-hover:border-accent/30 transition-colors",children:(0,t.jsx)(u.User,{size:16,className:"text-white/40 group-hover:text-accent transition-colors"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-bold text-sm text-white group-hover:text-accent transition-colors leading-tight",children:e.studentName}),(0,t.jsxs)("span",{className:"text-[10px] font-mono text-white/40 tracking-tighter uppercase",children:["ID: ",e.schoolId]})]})]})},{key:"classPlacement",header:"Class & Placement",render:e=>(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-[10px] uppercase font-black text-white/60 tracking-tighter bg-white/5 px-2 py-0.5 rounded border border-white/5 w-fit",children:e.className}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-white/30",children:[(0,t.jsx)(g.MapPin,{size:10,className:"opacity-40"}),(0,t.jsx)("span",{className:"truncate max-w-[120px]",children:e.villageName})]})]})},{key:"parentDetails",header:"Parent Details",render:e=>(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)("span",{className:"text-xs font-bold text-white/80",children:e.parentName}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-white/40",children:[(0,t.jsx)(b.Phone,{size:10,className:"opacity-40"}),(0,t.jsx)("span",{className:"font-mono",children:e.parentMobile})]})]})},{key:"credentials",header:"Login Credentials",render:e=>(0,t.jsx)("div",{className:"flex flex-col gap-0.5",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-[10px] text-amber-400 font-bold",children:[(0,t.jsx)(x.Key,{size:10,className:"opacity-60"}),(0,t.jsxs)("span",{className:"uppercase tracking-tighter",children:["Pass: ",e.recoveryPassword||e.parentMobile]})]})})},{key:"status",header:"Status",cellClassName:"text-center",render:e=>(0,t.jsx)(B.Badge,{className:(0,z.cn)("text-[9px] font-black uppercase tracking-tighter py-0 h-5 border-none transition-all","ACTIVE"===e.status?"bg-emerald-500/10 text-emerald-400":"bg-red-500/10 text-red-400"),children:e.status})},{key:"management",header:"Management",cellClassName:"text-right",render:e=>(0,t.jsx)("div",{className:"flex items-center justify-end gap-1",onClick:e=>e.stopPropagation(),children:("ADMIN"===S||"MANAGER"===S)&&(0,t.jsxs)(O.DropdownMenu,{children:[(0,t.jsx)(O.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(w.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-lg hover:bg-white/10",children:(0,t.jsx)(m.MoreHorizontal,{size:14})})}),(0,t.jsxs)(O.DropdownMenuContent,{align:"end",className:"bg-zinc-900 border-white/10 text-white min-w-[160px] p-1.5 rounded-xl shadow-2xl",children:[(0,t.jsxs)(O.DropdownMenuItem,{onClick:()=>{e.uid?(es({uid:e.uid,schoolId:e.schoolId,name:e.studentName,role:"STUDENT"}),er(!0)):alert("UID Missing")},className:"rounded-lg gap-2 text-xs font-bold text-amber-500 hover:text-amber-400 transition-colors",children:[(0,t.jsx)(x.Key,{size:14})," Reset Password"]}),"ADMIN"===S&&(0,t.jsxs)(O.DropdownMenuItem,{onClick:()=>{Z(e),et(!0)},className:"rounded-lg gap-2 text-xs font-bold text-red-500 hover:text-red-400 transition-colors",children:[(0,t.jsx)(h.Trash2,{size:14})," Delete Student"]})]})]})})}]})}),(0,t.jsx)(n.AdminChangePasswordModal,{isOpen:el,onClose:()=>er(!1),user:ea,onSuccess:()=>{window.location.reload()}}),W&&(0,t.jsx)(d.DeleteUserModal,{isOpen:ee,onClose:()=>{et(!1),Z(null)},user:{id:W.schoolId,schoolId:W.schoolId,name:W.studentName,role:"student"},checkEligibility:async()=>{let e=(0,l.query)((0,l.collection)(r.db,"payments"),(0,l.where)("studentId","==",W.schoolId),(0,l.limit)(1));return(await (0,l.getDocs)(e)).empty?{canDelete:!0}:{canDelete:!1,reason:"Payments exist."}},onDeactivate:async e=>{W&&await (0,l.updateDoc)((0,l.doc)(r.db,"students",W.studentDocId||W.schoolId),{status:"INACTIVE",deactivationReason:e,updatedAt:new Date().toISOString()})},onDelete:async e=>{if(!W)return;if(!N)return void alert("You are not authenticated");let t=await N.getIdToken(),a=await fetch("/api/admin/users/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({targetUid:W.uid,schoolId:W.schoolId,role:"STUDENT",collectionName:"students"})}),s=await a.json();if(!s.success)throw Error(s.error||"Delete failed")}})]})}e.s(["default",()=>V],49444)}]);