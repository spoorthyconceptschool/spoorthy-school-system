(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32296,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566);e.i(36180);var d=e.i(98925),l=e.i(59141),i=e.i(19455),r=e.i(93479),n=e.i(10204),c=e.i(76639),o=e.i(71689),m=e.i(88511),x=e.i(27612),h=e.i(31278),u=e.i(61659),p=e.i(51737),g=e.i(27516),b=e.i(84765),N=e.i(70756),j=e.i(16715),f=e.i(3281),w=e.i(22016),y=e.i(15288),v=e.i(75157),S=e.i(67489),I=e.i(51537),D=e.i(78894),C=e.i(80691),A=e.i(32341);function T({isOpen:e,onClose:s,studentId:d,ledgerItems:l,onSuccess:o}){let[m,x]=(0,a.useState)(""),[u,p]=(0,a.useState)("DISCOUNT"),[g,b]=(0,a.useState)(""),[N,j]=(0,a.useState)(""),[f,w]=(0,a.useState)(!1),y=l.find(e=>e.id===m),v=y&&g?"DISCOUNT"===u?Math.max(0,y.amount-Number(g)):Number(g):null,{user:I}=(0,A.useAuth)(),T=async()=>{if(m&&g&&N&&I){w(!0);try{let e=await I.getIdToken(),t=await fetch("/api/admin/fees/adjust",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({studentId:d,adjustments:[{id:m,type:u,value:Number(g)}],reason:N})}),a=await t.json();if(!t.ok)throw Error(a.error);(0,C.toast)({title:"Fees Adjusted",description:"Student fees have been updated.",type:"success"}),o(),s()}catch(e){(0,C.toast)({title:"Adjustment Failed",description:e.message||"Could not update fees.",type:"error"})}finally{w(!1)}}};return(0,t.jsx)(c.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(c.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[500px]",children:[(0,t.jsx)(c.DialogHeader,{children:(0,t.jsx)(c.DialogTitle,{children:"Adjust Student Fees"})}),(0,t.jsxs)("div",{className:"space-y-4 py-2",children:[(0,t.jsxs)("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md flex items-start gap-2 text-xs text-yellow-500",children:[(0,t.jsx)(D.AlertTriangle,{className:"w-4 h-4 shrink-0"}),(0,t.jsx)("p",{children:"Adjustments are permanently recorded in the audit log. Ensure you have authorization to offer discounts or overrides."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Select Fee Term"}),(0,t.jsxs)(S.Select,{value:m,onValueChange:x,children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(S.SelectValue,{placeholder:"Choose term..."})}),(0,t.jsx)(S.SelectContent,{children:l.filter(e=>"PAID"!==e.status).map(e=>(0,t.jsxs)(S.SelectItem,{value:e.id,children:[e.name," (Current: ₹",e.amount,")"]},e.id))})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Adjustment Type"}),(0,t.jsxs)(S.Select,{value:u,onValueChange:e=>p(e),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(S.SelectValue,{})}),(0,t.jsxs)(S.SelectContent,{children:[(0,t.jsx)(S.SelectItem,{value:"DISCOUNT",children:"Discount (Reduce by)"}),(0,t.jsx)(S.SelectItem,{value:"OVERRIDE",children:"Override (Set to)"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Value (₹)"}),(0,t.jsx)(r.Input,{type:"number",value:g,onChange:e=>b(e.target.value),className:"bg-white/5 border-white/10",placeholder:"e.g. 5000"})]})]}),y&&(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white/5 rounded px-3",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"New Amount:"}),(0,t.jsx)("span",{className:"font-mono font-bold text-emerald-400",children:null!==v?`₹${v.toLocaleString()}`:"-"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Reason (Mandatory)"}),(0,t.jsx)(r.Input,{value:N,onChange:e=>j(e.target.value),className:"bg-white/5 border-white/10",placeholder:"e.g. Merit Scholarship, Sibling Discount"})]})]}),(0,t.jsxs)(c.DialogFooter,{children:[(0,t.jsx)(i.Button,{variant:"ghost",onClick:s,children:"Cancel"}),(0,t.jsx)(i.Button,{onClick:T,disabled:f||!m||!g||!N,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:f?(0,t.jsx)(h.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Adjustment"})]})]})})}var k=e.i(87486),P=e.i(87828),E=e.i(71431),L=e.i(72498),M=e.i(90281);function R(){let e=(0,s.useParams)(),D=(0,s.useRouter)(),C=e.id,[R,F]=(0,a.useState)(null),[$,O]=(0,a.useState)([]),[B,V]=(0,a.useState)(null),[U,_]=(0,a.useState)(!0),[z,G]=(0,a.useState)(""),{user:H}=(0,A.useAuth)();(0,a.useEffect)(()=>{if(!H)return;let e=(0,d.onSnapshot)((0,d.doc)(l.db,"users",H.uid),e=>{e.exists()&&G(e.data().role)});return()=>e()},[H]);let[q,K]=(0,a.useState)(!1),[J,Y]=(0,a.useState)({}),[Q,W]=(0,a.useState)(!1),{villages:X,classes:Z,sections:ee,classSections:et,branding:ea,selectedYear:es}=(0,L.useMasterData)(),ed=Object.values(X||{}).map(e=>({id:e.id,name:e.name})).sort((e,t)=>e.name.localeCompare(t.name)),el=Object.values(Z||{}).map(e=>({id:e.id,name:e.name,order:e.order||99})).sort((e,t)=>e.order-t.order),ei=Object.values(ee||{}).map(e=>({id:e.id,name:e.name})).sort((e,t)=>e.name.localeCompare(t.name)),[er,en]=(0,a.useState)(!1),[ec,eo]=(0,a.useState)(!1),[em,ex]=(0,a.useState)({amount:"",method:"cash",date:new Date().toISOString().split("T")[0],remarks:""}),[eh,eu]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if(C){_(!0);try{let e=(0,d.doc)(l.db,"students",C),t=await (0,d.getDoc)(e);if(!t.exists()){alert("Student Not Found"),D.push("/admin/students");return}let a={id:t.id,...t.data()};if(!a.uid)try{let e=(0,d.doc)(l.db,"usersBySchoolId",a.schoolId),t=await (0,d.getDoc)(e);t.exists()&&(a.uid=t.data().uid)}catch(e){console.warn("UID Lookup Failed",e)}F(a),Y(a);let s=(0,d.query)((0,d.collection)(l.db,"payments"),(0,d.where)("studentId","==",a.schoolId)),i=(await (0,d.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}));O(i.sort((e,t)=>{let a=e.date?.toDate?e.date.toDate():new Date(e.date);return(t.date?.toDate?t.date.toDate():new Date(t.date))-a}));let r=(0,d.doc)(l.db,"student_fee_ledgers",`${a.schoolId}_${es||"2025-2026"}`),n=await (0,d.getDoc)(r);n.exists()?V(n.data()):V(null)}catch(e){console.error("Fetch Error:",e)}finally{_(!1)}}})()},[C,D,es]);let ep=async()=>{if(R)try{let e=ed.find(e=>e.id===J.villageId)?.name||J.villageName,t=el.find(e=>e.id===J.classId)?.name||J.className,a=ei.find(e=>e.id===J.sectionId)?.name||J.sectionName,s={...J,villageName:e||null,className:t||null,sectionName:a||null};Object.keys(s).forEach(e=>void 0===s[e]&&delete s[e]),await (0,d.updateDoc)((0,d.doc)(l.db,"students",R.id),s),F({...R,...s}),K(!1),await (0,d.addDoc)((0,d.collection)(l.db,"audit_logs"),{action:"UPDATE_STUDENT_PROFILE",targetId:R.id,details:s,timestamp:d.Timestamp.now()}),"MANAGER"===z&&await (0,M.notifyManagerAction)({userId:R.uid||R.id,title:"Profile Updated",message:`Student profile ${R.studentName} has been updated by Manager ${H?.displayName||"System"}.`,type:"INFO",actionBy:H?.uid,actionByName:H?.displayName||"Manager"}),alert("Profile Updated Successfully")}catch(e){console.error(e),alert("Update Failed: "+e.message)}},eg=async e=>{if(e.preventDefault(),R){eu(!0);try{let e=Number(em.amount);if(e<=0)throw Error("Invalid Amount");let t=new Date,a=`${t.toLocaleDateString()} ${t.toLocaleTimeString()}`,s="MANAGER"===z?` | Collected by manager: ${H?.displayName||"Manager"} at ${a}`:"",i={studentId:R.schoolId,studentName:R.studentName,amount:e,method:em.method,date:d.Timestamp.fromDate(new Date(em.date)),status:"success",remarks:(em.remarks||"")+s,createdAt:d.Timestamp.now(),verifiedBy:"MANAGER"===z?`manager:${H?.displayName||"Manager"}`:"admin"},r=await (0,d.addDoc)((0,d.collection)(l.db,"payments"),i),n=eb+e,c=(0,d.doc)(l.db,"student_fee_ledgers",`${R.schoolId}_${es||"2025-2026"}`);if(await (0,d.updateDoc)(c,{totalPaid:n,status:n>=eN?"PAID":"PENDING",updatedAt:new Date().toISOString()}),O([{id:r.id,...i},...$]),V(e=>e?{...e,totalPaid:n,status:n>=eN?"PAID":"PENDING"}:null),"MANAGER"===z)await (0,M.notifyManagerAction)({userId:R.uid||R.id,title:"Fee Payment Received",message:`Payment of ₹${e.toLocaleString()} received via ${em.method}. ${em.remarks?`(${em.remarks})`:""}`,type:"FEE",actionBy:H?.uid,actionByName:H?.displayName||"Manager"});else try{await (0,d.addDoc)((0,d.collection)(l.db,"notifications"),{target:"ALL_ADMINS",title:"Fee Collected",message:`Collected ₹${e.toLocaleString()} from ${R.studentName} (${R.schoolId}) via ${em.method}.`,type:"FEE",status:"UNREAD",createdAt:d.Timestamp.now()}),R.uid&&await (0,d.addDoc)((0,d.collection)(l.db,"notifications"),{userId:R.uid,title:"Fee Payment Received",message:`Payment of ₹${e.toLocaleString()} received via ${em.method}.`,type:"FEE",status:"UNREAD",createdAt:d.Timestamp.now()})}catch(e){console.error("Failed to notify admins",e)}en(!1),ex({amount:"",method:"cash",date:new Date().toISOString().split("T")[0],remarks:""}),alert("Payment Recorded & Ledger Updated")}catch(e){alert(e.message)}finally{eu(!1)}}},eb=$.reduce((e,t)=>e+(Number(t.amount)||0),0),eN=B?B.items.reduce((e,t)=>e+t.amount,0):0,ej=eN-eb,ef=eN>0?Math.min(eb/eN*100,100):0,ew=(()=>{if(!B)return{items:[],termsPaid:0,termsTotal:0,customPaid:0,customTotal:0,pending:[],termsPending:0,customPending:0};let e=[...B.items].sort((e,t)=>new Date(e.dueDate).getTime()-new Date(t.dueDate).getTime()),t=eb,a=e.map(e=>{let a=Math.min(t,e.amount);t-=a;let s=e.amount-a,d="PENDING";return a>=e.amount?d="PAID":a>0&&(d="PARTIAL"),{...e,distributedPaid:a,distributedDue:s,distributedStatus:d}});return{items:a,termsPaid:a.filter(e=>"TERM"===e.type).reduce((e,t)=>e+t.distributedPaid,0),termsTotal:a.filter(e=>"TERM"===e.type).reduce((e,t)=>e+t.amount,0),customPaid:a.filter(e=>"TERM"!==e.type).reduce((e,t)=>e+t.distributedPaid,0),customTotal:a.filter(e=>"TERM"!==e.type).reduce((e,t)=>e+t.amount,0),termsPending:a.filter(e=>"TERM"===e.type).reduce((e,t)=>e+t.distributedDue,0),customPending:a.filter(e=>"TERM"!==e.type).reduce((e,t)=>e+t.distributedDue,0),pending:a.filter(e=>e.distributedDue>0).map(e=>({name:e.name,due:e.distributedDue}))}})(),[ey,ev]=(0,a.useState)(!1),[eS,eI]=(0,a.useState)(!1),eD=async()=>{if(R){eI(!0);try{let e=(await (0,d.getDoc)((0,d.doc)(l.db,"config","fees"))).data(),t=(e?.terms||[]).filter(e=>e.isActive),a=(0,d.query)((0,d.collection)(l.db,"custom_fees"),(0,d.where)("status","==","ACTIVE")),s=await (0,d.getDocs)(a),i=R.classId,r=R.className||"Class 1",n=[];t.forEach(e=>{let t=e.amounts?.[r]||0;t>0&&n.push({id:`TERM_${e.id}`,type:"TERM",name:e.name,dueDate:e.dueDate,amount:Number(t),paidAmount:0,status:"PENDING"})}),s.docs.forEach(e=>{let t=e.data(),a=!1;"CLASS"===t.targetType&&t.targetIds?.includes(i)&&(a=!0),a&&n.push({id:`CUSTOM_${e.id}`,type:"CUSTOM",name:t.name,dueDate:t.dueDate,amount:Number(t.amount),paidAmount:0,status:"PENDING"})});let c=es||"2025-2026",o=(0,d.doc)(l.db,"student_fee_ledgers",`${R.schoolId}_${c}`),m=await (0,d.getDoc)(o),x=[];m.exists()&&(x=m.data().items||[]);let h=[...x];n.forEach(e=>{let t=h.findIndex(t=>t.id===e.id);if(-1===t)h.push(e);else{let a=h[t];0===a.paidAmount?h[t]={...a,amount:e.amount,dueDate:e.dueDate,name:e.name}:h[t]={...a,dueDate:e.dueDate,name:e.name}}});let u=h.reduce((e,t)=>e+t.amount,0),p={studentId:R.schoolId,academicYearId:c,classId:R.classId,className:R.className,totalFee:u,totalPaid:B?.totalPaid||0,status:(B?.totalPaid||0)>=u?"PAID":"PENDING",items:h,updatedAt:new Date().toISOString()};await (0,d.setDoc)(o,p,{merge:!0}),V({...p,items:h}),"MANAGER"===z&&await (0,M.notifyManagerAction)({userId:R.uid||R.schoolId,title:"Fee Structure Synced",message:`Fee structure for ${R.studentName} has been recalculated & synced with global config by Manager ${H?.displayName||"Manager"}.`,type:"INFO",actionBy:H?.uid,actionByName:H?.displayName||"Manager"}),alert("Fees Recalculated Successfully")}catch(e){console.error(e),alert("Recalculate Failed: "+e.message)}finally{eI(!1)}}};return U?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[50vh] space-y-4",children:[(0,t.jsx)(h.Loader2,{className:"w-10 h-10 animate-spin text-accent"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading Profile..."})]}):R?(0,t.jsxs)("div",{className:"space-y-3 md:space-y-6 max-w-7xl mx-auto pb-20 animate-in fade-in duration-500 p-1 md:p-0",children:[(0,t.jsx)(P.AdminChangePasswordModal,{isOpen:ey,onClose:()=>ev(!1),user:{uid:R.uid||"",schoolId:R.schoolId,name:R.studentName,role:"STUDENT"}}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 pt-2 md:pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,t.jsx)(w.default,{href:"/admin/students",children:(0,t.jsx)(i.Button,{variant:"outline",size:"icon",className:"h-8 w-8 md:h-9 md:w-9 border-white/10 hover:bg-white/10",children:(0,t.jsx)(o.ArrowLeft,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"})})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,t.jsx)("h1",{className:"text-lg md:text-3xl font-display font-bold text-white leading-tight",children:R.studentName}),(0,t.jsx)(k.Badge,{variant:"ACTIVE"===R.status?"default":"destructive",className:"uppercase text-[7px] md:text-[10px] h-4 md:h-5 px-1 py-0",children:R.status})]}),(0,t.jsxs)("p",{className:"text-[9px] md:text-sm text-muted-foreground font-mono flex items-center gap-1.5 md:gap-2",children:[(0,t.jsx)("span",{className:"text-accent font-bold",children:R.schoolId}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{className:"truncate max-w-[100px] md:max-w-none",children:Z[R.classId]?.name||R.className||"Class"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 md:gap-2",children:[("ADMIN"===z||"MANAGER"===z)&&(0,t.jsxs)(c.Dialog,{open:er,onOpenChange:en,children:[(0,t.jsx)(c.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{size:"sm",className:"h-8 md:h-11 bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg text-[10px] md:text-sm font-bold flex-1 md:flex-none",children:[(0,t.jsx)(u.CreditCard,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"})," Collect Fee"]})}),(0,t.jsxs)(c.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-md",children:[(0,t.jsx)(c.DialogHeader,{children:(0,t.jsx)(c.DialogTitle,{children:"Collect Payment"})}),(0,t.jsxs)("form",{onSubmit:eg,className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-400 text-sm flex justify-between",children:[(0,t.jsx)("span",{children:"Current Due:"}),(0,t.jsxs)("span",{className:"font-bold font-mono",children:["₹",ej.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(n.Label,{children:["Amount Received (₹) ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(r.Input,{required:!0,type:"number",min:"1",placeholder:"Enter amount...",className:"bg-white/5 border-white/10 font-mono text-lg",value:em.amount,onChange:e=>ex({...em,amount:e.target.value})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Mode"}),(0,t.jsxs)(S.Select,{value:em.method,onValueChange:e=>ex({...em,method:e}),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10 h-10",children:(0,t.jsx)(S.SelectValue,{})}),(0,t.jsxs)(S.SelectContent,{className:"bg-[#0A192F] border-white/10 text-white",children:[(0,t.jsx)(S.SelectItem,{value:"cash",children:"Cash"}),(0,t.jsx)(S.SelectItem,{value:"upi",children:"UPI / GPay"}),(0,t.jsx)(S.SelectItem,{value:"cheque",children:"Cheque"}),(0,t.jsx)(S.SelectItem,{value:"bank_transfer",children:"Transfer"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Date"}),(0,t.jsx)(r.Input,{type:"date",required:!0,className:"bg-white/5 border-white/10 h-10",value:em.date,onChange:e=>ex({...em,date:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Remarks"}),(0,t.jsx)(r.Input,{placeholder:"Note...",className:"bg-white/5 border-white/10 h-10",value:em.remarks,onChange:e=>ex({...em,remarks:e.target.value})})]}),(0,t.jsx)(c.DialogFooter,{children:(0,t.jsx)(i.Button,{type:"submit",disabled:eh,className:"w-full bg-emerald-600 hover:bg-emerald-700",children:eh?(0,t.jsx)(h.Loader2,{className:"animate-spin"}):"Confirm Payment"})})]})]})]}),q?(0,t.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>K(!1),className:"h-8 text-[10px] md:text-xs",children:"Cancel"}),(0,t.jsx)(i.Button,{size:"sm",onClick:ep,className:"h-8 bg-blue-600 hover:bg-blue-700 text-white text-[10px] md:text-xs px-3",children:"Save"})]}):("ADMIN"===z||"MANAGER"===z)&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,t.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>ev(!0),className:"h-8 md:h-9 border-white/10 bg-white/5 text-[9px] md:text-sm px-1.5 md:px-4",children:[(0,t.jsx)(N.Lock,{className:"w-3 h-3 md:w-3.5 md:h-3.5 mr-1"})," ",(0,t.jsx)("span",{className:"hidden sm:inline",children:"Reset"})]}),(0,t.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>K(!0),className:"h-8 md:h-9 border-white/10 bg-white/5 text-[9px] md:text-sm px-1.5 md:px-4",children:[(0,t.jsx)(m.Edit,{className:"w-3 h-3 md:w-3.5 md:h-3.5 mr-1"})," Edit"]}),"ADMIN"===z&&(0,t.jsx)(i.Button,{variant:"destructive",size:"sm",onClick:()=>W(!0),className:"h-8 md:h-9 bg-red-500/10 border-red-500/20 text-red-500 hover:bg-red-500/20 px-1.5 md:px-3",children:(0,t.jsx)(p.ShieldAlert,{className:"w-3 h-3 md:w-3.5 md:h-3.5"})})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-4",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-3 md:space-y-4",children:[(0,t.jsxs)(y.Card,{className:"bg-black/20 border-white/10 backdrop-blur-sm",children:[(0,t.jsx)(y.CardHeader,{className:"py-2 md:py-3 px-1.5 md:px-6",children:(0,t.jsx)(y.CardTitle,{className:"text-xs md:text-xl font-bold text-accent italic",children:"Personal Information"})}),(0,t.jsxs)(y.CardContent,{className:"grid grid-cols-2 gap-x-2 md:gap-x-3 gap-y-2 md:gap-y-3 px-1.5 md:px-6 pb-3 md:pb-6",children:[(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Student Name"}),(0,t.jsx)(r.Input,{disabled:!q,className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm font-bold disabled:opacity-100",value:J.studentName,onChange:e=>Y({...J,studentName:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Parent Name"}),(0,t.jsx)(r.Input,{disabled:!q,className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm disabled:opacity-100",value:J.parentName,onChange:e=>Y({...J,parentName:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1 col-span-2 md:col-span-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Mobile / Password"}),(0,t.jsx)(r.Input,{disabled:!q,className:"bg-white/5 border-white/10 font-mono h-8 md:h-10 text-[12px] md:text-sm disabled:opacity-100",value:J.parentMobile,onChange:e=>Y({...J,parentMobile:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Village"}),(0,t.jsxs)(S.Select,{disabled:!q,value:J.villageId,onValueChange:e=>Y({...J,villageId:e}),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,t.jsx)(S.SelectValue,{placeholder:"Village"})}),(0,t.jsx)(S.SelectContent,{className:"bg-[#0A192F] border-white/10",children:ed.map(e=>(0,t.jsx)(S.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Class"}),(0,t.jsxs)(S.Select,{disabled:!q,value:J.classId,onValueChange:e=>Y({...J,classId:e}),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,t.jsx)(S.SelectValue,{placeholder:"Class"})}),(0,t.jsx)(S.SelectContent,{className:"bg-[#0A192F] border-white/10",children:el.map(e=>(0,t.jsx)(S.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Section"}),(0,t.jsxs)(S.Select,{disabled:!q,value:J.sectionId,onValueChange:e=>Y({...J,sectionId:e}),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,t.jsx)(S.SelectValue,{placeholder:"Section"})}),(0,t.jsx)(S.SelectContent,{className:"bg-[#0A192F] border-white/10",children:ei.map(e=>(0,t.jsx)(S.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-0.5 md:space-y-1",children:[(0,t.jsx)(n.Label,{className:"text-[8px] md:text-xs text-muted-foreground uppercase font-black tracking-tighter",children:"Status"}),(0,t.jsxs)(S.Select,{disabled:!q,value:J.status,onValueChange:e=>Y({...J,status:e}),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white/5 border-white/10 h-8 md:h-10 text-[12px] md:text-sm px-2 disabled:opacity-100",children:(0,t.jsx)(S.SelectValue,{})}),(0,t.jsxs)(S.SelectContent,{className:"bg-[#0A192F] border-white/10",children:[(0,t.jsx)(S.SelectItem,{value:"ACTIVE",children:"Active"}),(0,t.jsx)(S.SelectItem,{value:"PROMOTED",children:"Promoted"}),(0,t.jsx)(S.SelectItem,{value:"DETAINED",children:"Detained"}),(0,t.jsx)(S.SelectItem,{value:"INACTIVE",children:"Inactive"}),(0,t.jsx)(S.SelectItem,{value:"ALUMNI",children:"Alumni"})]})]})]})]})]}),(0,t.jsxs)(y.Card,{className:"bg-black/20 border-white/10",children:[(0,t.jsxs)(y.CardHeader,{className:"flex flex-row items-center justify-between py-2 md:py-3 px-1.5 md:px-6",children:[(0,t.jsx)(y.CardTitle,{className:"text-xs md:text-xl font-bold text-accent italic",children:"Fee Structure"}),(0,t.jsxs)("div",{className:"flex gap-1",children:[("ADMIN"===z||"MANAGER"===z)&&(0,t.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:eD,disabled:eS,className:"h-6 px-1.5 md:h-7 md:px-2 border-white/10 bg-white/5 text-[8px] md:text-[9px] font-bold",children:[(0,t.jsx)(j.RefreshCw,{className:`w-2.5 h-2.5 md:w-3 md:h-3 mr-1 ${eS?"animate-spin":""}`})," Sync"]}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",className:"h-6 px-1.5 md:h-7 md:px-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 text-[8px] md:text-[9px] font-bold",onClick:()=>B&&(0,E.printStudentFeeStructure)({studentName:R.studentName,schoolId:R.schoolId,className:R.className,items:B.items||[],totalPaid:B.totalPaid||0,schoolLogo:ea?.schoolLogo,schoolName:ea?.schoolName}),children:(0,t.jsx)(f.Printer,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-1"})}),("ADMIN"===z||"MANAGER"===z)&&(0,t.jsxs)(i.Button,{variant:"outline",size:"sm",className:"h-6 px-1.5 md:h-7 md:px-2 border-white/10 bg-white/5 text-[8px] md:text-[9px] font-bold",onClick:()=>eo(!0),children:[(0,t.jsx)(b.Settings2,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-1"})," Adjust"]})]})]}),(0,t.jsx)(y.CardContent,{className:"px-1.5 md:px-6 pb-3",children:B&&B.items&&0!==B.items.length?(0,t.jsx)("div",{className:"w-full overflow-x-auto custom-scrollbar",children:(0,t.jsxs)("table",{className:"w-full border-collapse min-w-[600px]",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black border-b border-white/10 italic",children:[(0,t.jsx)("th",{className:"px-1 md:px-3 py-2 text-left",children:"Fee Item"}),(0,t.jsx)("th",{className:"px-1 md:px-2 py-2 text-right",children:"Total"}),(0,t.jsx)("th",{className:"px-1 md:px-2 py-2 text-right",children:"Paid"}),(0,t.jsx)("th",{className:"px-1 md:px-2 py-2 text-right",children:"Due"}),(0,t.jsx)("th",{className:"px-1 md:px-3 py-2 text-right",children:"Status"})]})}),(0,t.jsx)("tbody",{children:ew.items.map(e=>(0,t.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors group",children:[(0,t.jsx)("td",{className:"px-1 md:px-3 py-2",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-[11px] md:text-sm font-bold text-white group-hover:text-accent transition-colors leading-tight",children:e.name}),(0,t.jsx)("span",{className:"text-[7px] md:text-[9px] text-white/30 uppercase font-black tracking-tighter",children:e.type})]})}),(0,t.jsxs)("td",{className:"px-1 md:px-2 py-2 text-right font-mono text-[9px] md:text-xs text-white/70",children:["₹",e.amount.toLocaleString()]}),(0,t.jsxs)("td",{className:"px-1 md:px-2 py-2 text-right font-mono text-[9px] md:text-xs text-emerald-400",children:["₹",e.distributedPaid.toLocaleString()]}),(0,t.jsxs)("td",{className:"px-1 md:px-2 py-2 text-right font-mono text-[10px] md:text-xs text-red-400 font-bold",children:["₹",e.distributedDue.toLocaleString()]}),(0,t.jsx)("td",{className:"px-1 md:px-3 py-2 text-right",children:(0,t.jsx)("span",{className:(0,v.cn)("inline-flex px-1 py-0.5 md:px-1.5 rounded-[4px] text-[7px] md:text-[9px] font-black uppercase tracking-tighter","PAID"===e.distributedStatus?"bg-emerald-500/10 text-emerald-400":"PARTIAL"===e.distributedStatus?"bg-amber-500/10 text-amber-500":"bg-red-500/10 text-red-500"),children:e.distributedStatus})})]},e.id))})]})}):(0,t.jsx)("div",{className:"text-center py-6 text-muted-foreground border border-dashed border-white/10 rounded-lg text-xs bg-white/5",children:"No fee structure assigned. Update details or click Sync."})})]}),(0,t.jsxs)(y.Card,{className:"bg-black/20 border-white/10",children:[(0,t.jsxs)(y.CardHeader,{className:"flex flex-row items-center justify-between py-2 md:py-3 px-1.5 md:px-6",children:[(0,t.jsx)(y.CardTitle,{className:"text-xs md:text-xl font-bold text-accent italic",children:"History"}),(0,t.jsx)(g.History,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"})]}),(0,t.jsx)(y.CardContent,{className:"px-1.5 md:px-6 pb-3",children:0===$.length?(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground border border-dashed border-white/10 rounded-lg text-[10px]",children:"No payments."}):(0,t.jsx)("div",{className:"space-y-1",children:$.slice(0,5).map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center px-2 md:px-3 py-1 md:py-1.5 rounded-lg bg-white/10 border border-white/10 group",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:"text-[10px] md:text-xs font-bold flex items-center gap-1 md:gap-1.5",children:[(0,t.jsx)("span",{className:"uppercase text-[6px] md:text-[8px] font-black text-white/50 bg-black/40 px-1 py-0.5 rounded tracking-tighter",children:e.method}),e.remarks||"Fee Payment"]}),(0,t.jsx)("span",{className:"text-[8px] md:text-[10px] text-muted-foreground",children:e.date?.toDate?e.date.toDate().toLocaleDateString():e.date})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 md:gap-2",children:[(0,t.jsxs)("span",{className:"font-mono font-black text-emerald-400 text-[10px] md:text-xs",children:["+₹",e.amount.toLocaleString()]}),(0,t.jsx)(i.Button,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>(0,E.printPaymentReceipt)({payment:e,student:R,ledger:B,schoolLogo:ea?.schoolLogo,schoolName:ea?.schoolName}),children:(0,t.jsx)(f.Printer,{className:"w-3 h-3"})})]})]},e.id))})})]})]}),(0,t.jsxs)("div",{className:"space-y-3 md:space-y-4",children:[(0,t.jsxs)(y.Card,{className:"bg-gradient-to-br from-black/40 to-black/20 border-white/10 sticky top-6",children:[(0,t.jsx)(y.CardHeader,{className:"py-2 md:py-3 px-1.5 md:px-6",children:(0,t.jsx)(y.CardTitle,{className:"text-[11px] md:text-base font-bold text-accent italic",children:"Overview"})}),(0,t.jsxs)(y.CardContent,{className:"space-y-3 md:space-y-4 px-1.5 md:px-6 pb-4 md:pb-6",children:[(0,t.jsx)("div",{className:"relative h-1.5 md:h-2 w-full bg-white/5 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-emerald-600 to-emerald-400",style:{width:`${ef}%`}})}),(0,t.jsxs)("div",{className:"space-y-3 md:space-y-4 pt-1 md:pt-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-1 gap-2 md:gap-3",children:[(0,t.jsxs)("div",{className:"bg-white/5 p-2 md:p-3 rounded-xl border border-white/5 space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black tracking-tighter",children:"Term"}),(0,t.jsxs)("span",{className:"text-[10px] md:text-xs font-bold text-white",children:["₹",ew.termsTotal.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center border-t border-white/5 pt-1",children:[(0,t.jsx)("span",{className:"text-[7px] md:text-[9px] text-white/30 uppercase font-black",children:"Due"}),(0,t.jsxs)("span",{className:"text-[9px] md:text-[10px] font-bold text-amber-500",children:["₹",ew.termsPending.toLocaleString()]})]})]}),(0,t.jsxs)("div",{className:"bg-white/5 p-2 md:p-3 rounded-xl border border-white/5 space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-[8px] md:text-[10px] text-muted-foreground uppercase font-black tracking-tighter",children:"Custom"}),(0,t.jsxs)("span",{className:"text-[10px] md:text-xs font-bold text-white",children:["₹",ew.customTotal.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center border-t border-white/5 pt-1",children:[(0,t.jsx)("span",{className:"text-[7px] md:text-[9px] text-white/30 uppercase font-black",children:"Due"}),(0,t.jsxs)("span",{className:"text-[9px] md:text-[10px] font-bold text-amber-500",children:["₹",ew.customPending.toLocaleString()]})]})]})]}),(0,t.jsxs)("div",{className:"p-2 md:p-4 bg-red-500/10 border border-red-500/20 rounded-xl space-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-black text-[8px] md:text-[10px] uppercase text-red-400 italic leading-none mb-1",children:"Total Due"}),(0,t.jsxs)("span",{className:`font-mono font-black text-xl md:text-3xl ${ej>0?"text-white":"text-emerald-400"}`,children:["₹",ej.toLocaleString()]})]}),ej>0&&(0,t.jsxs)(i.Button,{size:"sm",onClick:()=>R&&(0,E.printPendingFeeReport)({studentName:R.studentName,schoolId:R.schoolId,className:R.className,items:ew.pending.map(e=>({name:e.name,amount:e.due,type:"CUSTOM"})),totalPaid:B?.totalPaid||0,schoolLogo:ea?.schoolLogo,schoolName:ea?.schoolName}),className:"w-full bg-white text-black hover:bg-zinc-200 font-bold h-8 md:h-10 rounded-lg shadow-lg text-[9px] md:text-sm",children:[(0,t.jsx)(f.Printer,{className:"w-3 h-3 md:w-4 md:h-4 mr-2"})," Statement"]})]})]})]})]}),(0,t.jsxs)(y.Card,{className:"bg-red-500/5 border-red-500/10",children:[(0,t.jsx)(y.CardHeader,{className:"py-2 px-3 md:px-4",children:(0,t.jsx)(y.CardTitle,{className:"text-red-400 text-[8px] md:text-[10px] uppercase font-black tracking-widest italic",children:"Danger"})}),(0,t.jsx)(y.CardContent,{className:"px-3 md:px-4 pb-3 md:pb-4",children:(0,t.jsxs)(i.Button,{variant:"destructive",size:"sm",className:"w-full bg-red-500/10 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/20 font-bold h-8 md:h-9 text-[9px] md:text-sm",onClick:()=>W(!0),children:[(0,t.jsx)(x.Trash2,{className:"w-3 h-3 md:w-3.5 md:h-3.5 mr-2"})," Delete"]})})]})]}),R&&(0,t.jsx)(I.DeleteUserModal,{isOpen:Q,onClose:()=>W(!1),user:{id:R.id,schoolId:R.schoolId,name:R.studentName,role:"student"},checkEligibility:async()=>$.length>0?{canDelete:!1,reason:`Recorded ${$.length} payments. Deactivate instead.`}:{canDelete:!0},onDeactivate:async()=>{await (0,d.updateDoc)((0,d.doc)(l.db,"students",R.id),{status:"INACTIVE"}),F(e=>e?{...e,status:"INACTIVE"}:null),alert("Student Deactivated")},onDelete:async e=>{await (0,d.deleteDoc)((0,d.doc)(l.db,"students",R.id)),await (0,d.addDoc)((0,d.collection)(l.db,"audit_logs"),{action:"DELETE_USER_HARD",targetId:R.id,targetType:"student",reason:e,timestamp:d.Timestamp.now()}),D.push("/admin/students")}}),B&&R&&(0,t.jsx)(T,{isOpen:ec,onClose:()=>eo(!1),studentId:R.schoolId,ledgerItems:B.items,onSuccess:()=>void window.location.reload()})]})]}):null}e.s(["default",()=>R],32296)}]);