(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("rounded-2xl border border-[#64FFDA]/10 bg-[#112240]/40 backdrop-blur-lg text-white shadow-xl transition-all duration-300 hover:bg-[#112240]/60 hover:border-[#64FFDA]/30 hover:shadow-[0_0_20px_-5px_rgba(100,255,218,0.1)] group",e),...t}));r.displayName="Card";let l=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let i=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h3",{ref:r,className:(0,s.cn)("font-bold text-xl tracking-tight text-white group-hover:text-accent transition-colors",e),...t}));i.displayName="CardTitle";let o=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-white/60 font-medium",e),...t}));o.displayName="CardDescription";let d=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter",e.s(["Card",()=>r,"CardContent",()=>d,"CardDescription",()=>o,"CardHeader",()=>l,"CardTitle",()=>i])},71689,e=>{"use strict";let a=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>a],71689)},93479,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let r=t.forwardRef(({className:e,type:t,...r},l)=>(0,a.jsx)("input",{type:t,className:(0,s.cn)("flex h-12 w-full rounded-full border border-white/10 bg-[#282828] px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all shadow-inner hover:bg-[#333]",e),ref:l,...r}));r.displayName="Input",e.s(["Input",()=>r])},10204,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("label",{ref:r,className:(0,s.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...t}));r.displayName="Label",e.s(["Label",()=>r])},76639,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(26999),r=e.i(37727),l=e.i(75157);let i=s.Root,o=s.Trigger,d=s.Portal;s.Close;let n=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(s.Overlay,{ref:r,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));n.displayName=s.Overlay.displayName;let c=t.forwardRef(({className:e,children:t,...i},o)=>(0,a.jsxs)(d,{children:[(0,a.jsx)(n,{}),(0,a.jsxs)(s.Content,{ref:o,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,(0,a.jsxs)(s.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(r.X,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));c.displayName=s.Content.displayName;let m=({className:e,...t})=>(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});m.displayName="DialogHeader";let x=({className:e,...t})=>(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});x.displayName="DialogFooter";let h=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(s.Title,{ref:r,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));h.displayName=s.Title.displayName;let u=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)(s.Description,{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",e),...t}));u.displayName=s.Description.displayName,e.s(["Dialog",()=>i,"DialogContent",()=>c,"DialogDescription",()=>u,"DialogFooter",()=>x,"DialogHeader",()=>m,"DialogTitle",()=>h,"DialogTrigger",()=>o])},24687,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));r.displayName="Textarea",e.s(["Textarea",()=>r])},88511,e=>{"use strict";let a=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>a],88511)},70756,e=>{"use strict";let a=(0,e.i(75254).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>a],70756)},87828,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(76639),r=e.i(19455),l=e.i(93479),i=e.i(10204),o=e.i(31278),d=e.i(70756),n=e.i(78894),c=e.i(32341),m=e.i(80691);function x({isOpen:e,onClose:x,user:h,onSuccess:u}){let{user:p}=(0,c.useAuth)(),[f,g]=(0,t.useState)(""),[b,j]=(0,t.useState)(!1);if(!h)return null;let y=async e=>{if(e.preventDefault(),!h.uid)return void(0,m.toast)({title:"Error",description:"User has no linked account.",type:"error"});j(!0);try{let e=await fetch("/api/admin/users/reset-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await p?.getIdToken()}`},body:JSON.stringify({targetUid:h.uid,schoolId:h.schoolId,role:h.role,newPassword:f})}),a=await e.json();a.success?((0,m.toast)({title:"Password Changed",description:`Proactively updated password for ${h.name}.`,type:"success"}),g(""),u&&u(),x()):(0,m.toast)({title:"Reset Failed",description:a.error||"Could not change password.",type:"error"})}catch(e){(0,m.toast)({title:"Error",description:e.message||"An unexpected error occurred.",type:"error"})}finally{j(!1)}};return(0,a.jsx)(s.Dialog,{open:e,onOpenChange:x,children:(0,a.jsxs)(s.DialogContent,{className:"bg-zinc-950 border-white/10 text-white sm:max-w-[425px]",children:[(0,a.jsxs)(s.DialogHeader,{children:[(0,a.jsxs)(s.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Lock,{className:"w-5 h-5 text-amber-500"}),"Reset Password"]}),(0,a.jsxs)(s.DialogDescription,{children:["Set a new password for ",(0,a.jsx)("span",{className:"font-bold text-white",children:h.name})," (",h.schoolId,")."]})]}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg text-xs text-amber-500 flex gap-2",children:[(0,a.jsx)(n.AlertTriangle,{className:"w-4 h-4 shrink-0"}),(0,a.jsx)("p",{children:"This will immediately update the user's password and log them out of all devices."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{children:"New Password"}),(0,a.jsx)(l.Input,{value:f,onChange:e=>g(e.target.value),className:"bg-black/20",placeholder:"Enter new password",required:!0,minLength:6})]}),(0,a.jsxs)(s.DialogFooter,{children:[(0,a.jsx)(r.Button,{type:"button",variant:"ghost",onClick:x,disabled:b,children:"Cancel"}),(0,a.jsxs)(r.Button,{type:"submit",className:"bg-amber-600 hover:bg-amber-700 text-white",disabled:b,children:[b?(0,a.jsx)(o.Loader2,{className:"animate-spin w-4 h-4 mr-2"}):null,"Update Password"]})]})]})]})})}e.s(["AdminChangePasswordModal",()=>x])},25652,e=>{"use strict";let a=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>a],25652)},43432,e=>{"use strict";let a=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>a],43432)},12426,e=>{"use strict";let a=(0,e.i(75254).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>a],12426)},83211,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(80691),r=e.i(76639),l=e.i(19455),i=e.i(93479),o=e.i(10204),d=e.i(31278),n=e.i(12426),c=e.i(25652);let m=(0,e.i(75254).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var x=e.i(59141),h=e.i(32341);function u({isOpen:u,onClose:p,person:f,onSuccess:g}){let[b,j]=(0,t.useState)(""),[y,w]=(0,t.useState)(!1),[N,v]=(0,t.useState)(null),{user:S}=(0,h.useAuth)();(0,t.useEffect)(()=>{u&&f&&(j(f.currentSalary.toString()),"STAFF"===f.role&&f.roleCode?C(f.roleCode):v(null))},[u,f]);let C=async a=>{try{let{getDocs:t,query:s,collection:r,where:l}=await e.A(27510),i=s(r(x.db,"master_staff_roles"),l("code","==",a)),o=await t(i);if(!o.empty){let e=o.docs[0].data();v(e.basicSalary||0)}}catch(e){console.error(e),(0,s.toast)({title:"Error fetching role data",description:"Could not fetch role salary details.",type:"error"})}},k=async()=>{if(f&&b){w(!0);try{if(!S)throw Error("Not authenticated");let e=await S.getIdToken(),a=await fetch("/api/admin/payroll/adjust-salary",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({personId:f.id,role:f.role,amount:Number(b),roleCode:f.roleCode})}),t=await a.json();if(!a.ok)throw Error(t.error||"Failed to adjust salary");(0,s.toast)({title:"Salary Adjusted",description:`Successfully updated salary for ${f.name}`,type:"success"}),g(),p()}catch(e){(0,s.toast)({title:"Adjustment Failed",description:e.message||"An error occurred while updating salary.",type:"error"})}finally{w(!1)}}};if(!f)return null;let D=f.currentSalary,A=Number(b)||0,I=A-D;return(0,a.jsx)(r.Dialog,{open:u,onOpenChange:p,children:(0,a.jsxs)(r.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[400px] w-[95vw] rounded-2xl",children:[(0,a.jsx)(r.DialogHeader,{children:(0,a.jsx)(r.DialogTitle,{className:"text-xl font-display italic",children:"Adjust Salary"})}),(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6 py-2 md:py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 md:p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,a.jsx)("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent font-black text-sm md:text-base",children:f.name.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sm md:text-base",children:f.name}),(0,a.jsxs)("div",{className:"text-[10px] text-muted-foreground font-mono uppercase tracking-tighter opacity-70",children:[f.schoolId," • ",f.role]})]})]}),null!==N&&(0,a.jsxs)("div",{className:"px-3 py-1.5 rounded-lg bg-blue-500/5 border border-blue-500/10 flex justify-between items-center text-[10px]",children:[(0,a.jsx)("span",{className:"text-blue-400 font-black tracking-widest uppercase",children:"Role Baseline"}),(0,a.jsxs)("span",{className:"font-mono font-bold text-blue-300",children:["₹",N.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"space-y-1.5 md:space-y-2",children:[(0,a.jsx)(o.Label,{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground",children:"Monthly Base Salary (₹)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,a.jsx)(i.Input,{type:"number",value:b,onChange:e=>j(e.target.value),className:"pl-9 bg-white/5 border-white/10 h-10 md:h-12 text-sm md:text-lg font-mono focus:ring-accent/30 rounded-xl",placeholder:"Enter Amount"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{className:"p-2.5 md:p-3 rounded-xl bg-white/5 border border-white/10 text-center md:text-left",children:[(0,a.jsx)("div",{className:"text-[8px] md:text-[10px] uppercase font-black tracking-widest text-muted-foreground mb-0.5 md:mb-1",children:"Current"}),(0,a.jsxs)("div",{className:"text-sm md:text-lg font-mono font-bold",children:["₹",D?.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"p-2.5 md:p-3 rounded-xl bg-white/5 border border-white/10 text-center md:text-left",children:[(0,a.jsx)("div",{className:"text-[8px] md:text-[10px] uppercase font-black tracking-widest text-muted-foreground mb-0.5 md:mb-1",children:"Proposed"}),(0,a.jsxs)("div",{className:"text-sm md:text-lg font-mono font-bold",children:["₹",A?.toLocaleString()]})]})]}),0!==I&&(0,a.jsxs)("div",{className:`p-3 md:p-4 rounded-xl flex items-center justify-between ${I>0?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 font-black uppercase text-[10px] tracking-widest",children:[I>0?(0,a.jsx)(c.TrendingUp,{className:"w-4 h-4"}):(0,a.jsx)(m,{className:"w-4 h-4"}),I>0?"Increase":"Decrease"]}),(0,a.jsxs)("div",{className:"text-base md:text-xl font-mono font-bold",children:[I>0?"+":""," ₹",Math.abs(I).toLocaleString()]})]})]}),(0,a.jsx)(r.DialogFooter,{children:(0,a.jsx)(l.Button,{onClick:k,disabled:y||A===D||A<0,className:"w-full bg-white text-black hover:bg-zinc-200 h-10 md:h-12 rounded-xl font-black uppercase tracking-tighter text-xs md:text-sm shadow-lg shadow-white/5",children:y?(0,a.jsx)(d.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Adjustment"})})]})})}e.s(["AdjustSalaryModal",()=>u],83211)},65261,e=>{"use strict";let a=(0,e.i(75254).default)("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);e.s(["KeyRound",()=>a],65261)},41462,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(18566);e.i(36180);var r=e.i(98925),l=e.i(59141),i=e.i(19455),o=e.i(15288),d=e.i(87486),n=e.i(31278),c=e.i(71689),m=e.i(43432),x=e.i(46897),h=e.i(12426),u=e.i(52754),p=e.i(88511),f=e.i(76639),g=e.i(10204),b=e.i(93479),j=e.i(67489),y=e.i(24687),w=e.i(32341),N=e.i(83211),v=e.i(80691);function S({isOpen:e,onClose:s,staff:o,onSuccess:d}){let[c,m]=(0,t.useState)([]),[x,h]=(0,t.useState)(!1),[u,p]=(0,t.useState)({roleId:"",name:"",mobile:"",address:""}),[y,w]=(0,t.useState)(!1);(0,t.useEffect)(()=>{e&&o&&(p({roleId:o.roleId||"",name:o.name||"",mobile:o.mobile||"",address:o.address||""}),N())},[e,o]);let N=async()=>{h(!0);try{let e=(0,r.query)((0,r.collection)(l.db,"master_staff_roles"),(0,r.where)("hasLogin","==",!1)),a=await (0,r.getDocs)(e);m(a.docs.map(e=>({id:e.id,...e.data()})))}catch(e){console.error(e)}finally{h(!1)}},S=async e=>{if(e.preventDefault(),o?.id){w(!0);try{let e=c.find(e=>e.id===u.roleId)||c.find(e=>e.code===o.roleCode),a=(0,r.doc)(l.db,"staff",o.id);await (0,r.updateDoc)(a,{name:u.name,mobile:u.mobile,address:u.address,roleId:u.roleId,roleName:e?.name||o.roleName,roleCode:e?.code||o.roleCode,updatedAt:new Date().toISOString()}),(0,v.toast)({title:"Staff Updated",description:`Successfully updated record for ${u.name}`,type:"success"}),d(),s()}catch(e){(0,v.toast)({title:"Update Failed",description:e.message||"Could not update staff record.",type:"error"})}finally{w(!1)}}};return(0,a.jsx)(f.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(f.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[425px]",children:[(0,a.jsx)(f.DialogHeader,{children:(0,a.jsx)(f.DialogTitle,{children:"Edit Staff Member"})}),(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Job Role"}),(0,a.jsxs)(j.Select,{value:u.roleId,onValueChange:e=>p({...u,roleId:e}),disabled:x,children:[(0,a.jsx)(j.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(j.SelectValue,{placeholder:x?"Loading roles...":"Select Role"})}),(0,a.jsx)(j.SelectContent,{className:"bg-black border-white/10 text-white",children:c.map(e=>(0,a.jsxs)(j.SelectItem,{value:e.id,children:[e.name," (",e.code,")"]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Full Name"}),(0,a.jsx)(b.Input,{required:!0,value:u.name,onChange:e=>p({...u,name:e.target.value}),className:"bg-white/5 border-white/10"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Mobile Number"}),(0,a.jsx)(b.Input,{required:!0,type:"tel",pattern:"[0-9]{10}",value:u.mobile,onChange:e=>p({...u,mobile:e.target.value}),className:"bg-white/5 border-white/10 font-mono",maxLength:10})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Address"}),(0,a.jsx)(b.Input,{required:!0,value:u.address,onChange:e=>p({...u,address:e.target.value}),className:"bg-white/5 border-white/10"})]}),(0,a.jsxs)(f.DialogFooter,{className:"mt-4",children:[(0,a.jsx)(i.Button,{type:"button",variant:"ghost",onClick:s,disabled:y,children:"Cancel"}),(0,a.jsxs)(i.Button,{type:"submit",disabled:y||!u.roleId,className:"bg-white text-black hover:bg-zinc-200",children:[y?(0,a.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Save Changes"]})]})]})]})})}var C=e.i(87828),k=e.i(65261),D=e.i(39616);function A(){let{user:e}=(0,w.useAuth)(),{id:v}=(0,s.useParams)(),A=(0,s.useRouter)(),[I,T]=(0,t.useState)(null),[L,R]=(0,t.useState)(!0),[P,F]=(0,t.useState)("");(0,t.useEffect)(()=>{if(!e)return;let a=(0,r.onSnapshot)((0,r.doc)(l.db,"users",e.uid),e=>{e.exists()&&F(e.data().role)});return()=>a()},[e]);let[M,B]=(0,t.useState)([]),[O,E]=(0,t.useState)(!1),[H,z]=(0,t.useState)({month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear().toString(),amount:"",method:"CASH",notes:""}),[q,U]=(0,t.useState)(!1),[_,V]=(0,t.useState)(!1),[J,$]=(0,t.useState)(!1),[K,G]=(0,t.useState)(!1);(0,t.useEffect)(()=>{v&&(Y(),Q())},[v]);let Y=async()=>{try{let e=(0,r.doc)(l.db,"staff",v),a=await (0,r.getDoc)(e);a.exists()?T(a.data()):(alert("Staff not found"),A.back())}catch(e){console.error(e)}finally{R(!1)}},Q=async()=>{try{(0,r.query)((0,r.collection)(l.db,"salary_payments"),(0,r.where)("personId","==",v),(0,r.orderBy)("createdAt","desc"));let e=(0,r.query)((0,r.collection)(l.db,"salary_payments"),(0,r.where)("personId","==",v)),a=(await (0,r.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}));a.sort((e,a)=>a.createdAt?.seconds-e.createdAt?.seconds),B(a)}catch(e){console.error(e)}},W=async()=>{U(!0);try{if(!H.amount)throw Error("Amount required");let a=await e?.getIdToken(),t=await fetch("/api/admin/payroll/process",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({personId:v,personType:"STAFF",...H,amount:Number(H.amount)})}),s=await t.json();if(!t.ok)throw Error(s.error);alert("Salary Payment Recorded!"),E(!1),Q()}catch(e){alert(e.message)}finally{U(!1)}};return L?(0,a.jsx)("div",{className:"p-10 flex justify-center",children:(0,a.jsx)(n.Loader2,{className:"animate-spin"})}):I?(0,a.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500",children:[(0,a.jsxs)("div",{className:"flex flex-col xl:flex-row xl:items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 w-full xl:w-auto",children:[(0,a.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>A.back(),children:(0,a.jsx)(c.ArrowLeft,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-display font-bold",children:I.name}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-muted-foreground mt-1",children:[(0,a.jsx)(d.Badge,{variant:"outline",className:"border-yellow-500/50 text-yellow-400 font-mono",children:I.schoolId}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)(d.Badge,{variant:"secondary",children:I.roleName})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 w-full xl:w-auto xl:ml-auto",children:[(0,a.jsxs)(i.Button,{onClick:()=>G(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,a.jsx)(k.KeyRound,{className:"w-4 h-4 mr-2"})," Reset Password"]}),(0,a.jsxs)(i.Button,{onClick:()=>$(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,a.jsx)(p.Edit,{className:"w-4 h-4 mr-2"})," Edit Details"]}),"MANAGER"!==P&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Button,{onClick:()=>V(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,a.jsx)(D.Settings,{className:"w-4 h-4 mr-2"})," Adjust Salary"]}),(0,a.jsxs)(i.Button,{onClick:()=>E(!0),className:"bg-green-600 hover:bg-green-700 text-white flex-1 md:flex-none",children:[(0,a.jsx)(u.Wallet,{className:"w-4 h-4 mr-2"})," Pay Salary"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)(o.Card,{className:"md:col-span-2 bg-black/40 border-white/10",children:[(0,a.jsx)(o.CardHeader,{children:(0,a.jsx)(o.CardTitle,{className:"text-lg",children:"Staff Details"})}),(0,a.jsx)(o.CardContent,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Label,{className:"text-muted-foreground",children:"Mobile"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(m.Phone,{className:"w-4 h-4 text-blue-400"}),(0,a.jsx)("span",{className:"font-mono",children:I.mobile})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Label,{className:"text-muted-foreground",children:"Role Code"}),(0,a.jsx)("div",{className:"mt-1 font-mono",children:I.roleCode})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(g.Label,{className:"text-muted-foreground",children:"Address"}),(0,a.jsxs)("div",{className:"flex items-start gap-2 mt-1",children:[(0,a.jsx)(x.MapPin,{className:"w-4 h-4 text-red-400 mt-1"}),(0,a.jsx)("span",{children:I.address})]})]})]})})]}),"MANAGER"!==P&&(0,a.jsxs)(o.Card,{className:"bg-black/40 border-white/10",children:[(0,a.jsx)(o.CardHeader,{children:(0,a.jsx)(o.CardTitle,{className:"text-lg",children:"Payroll"})}),(0,a.jsxs)(o.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 text-center",children:[(0,a.jsx)("div",{className:"text-muted-foreground text-sm uppercase tracking-wider mb-1",children:"Base Salary"}),(0,a.jsxs)("div",{className:"text-3xl font-display font-bold",children:["₹",I.baseSalary?.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold mb-3",children:"Recent Payments"}),(0,a.jsxs)("div",{className:"space-y-2",children:[M.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white/5 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-bold",children:[e.month," ",e.year]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.method})]}),(0,a.jsxs)("div",{className:"font-mono text-green-400 font-bold",children:["+₹",e.amount.toLocaleString()]})]},e.id)),0===M.length&&(0,a.jsx)("div",{className:"text-center text-muted-foreground text-sm",children:"No payment history"})]})]})]})]})]}),(0,a.jsx)(f.Dialog,{open:O,onOpenChange:E,children:(0,a.jsxs)(f.DialogContent,{className:"bg-black/95 border-white/10 text-white",children:[(0,a.jsx)(f.DialogHeader,{children:(0,a.jsxs)(f.DialogTitle,{children:["Pay Salary to ",I.name]})}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Month"}),(0,a.jsxs)(j.Select,{value:H.month,onValueChange:e=>z({...H,month:e}),children:[(0,a.jsx)(j.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(j.SelectValue,{})}),(0,a.jsx)(j.SelectContent,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(e=>(0,a.jsx)(j.SelectItem,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Year"}),(0,a.jsx)(b.Input,{value:H.year,onChange:e=>z({...H,year:e.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Amount (₹)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,a.jsx)(b.Input,{type:"number",value:H.amount,onChange:e=>z({...H,amount:e.target.value}),className:"pl-9 bg-white/5 border-white/10",placeholder:I.baseSalary?.toString()})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Standard Base: ₹",I.baseSalary?.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Payment Mode"}),(0,a.jsxs)(j.Select,{value:H.method,onValueChange:e=>z({...H,method:e}),children:[(0,a.jsx)(j.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(j.SelectValue,{})}),(0,a.jsxs)(j.SelectContent,{children:[(0,a.jsx)(j.SelectItem,{value:"CASH",children:"Cash"}),(0,a.jsx)(j.SelectItem,{value:"UPI",children:"UPI / Online"}),(0,a.jsx)(j.SelectItem,{value:"CHEQUE",children:"Cheque"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.Label,{children:"Notes (Optional)"}),(0,a.jsx)(y.Textarea,{value:H.notes,onChange:e=>z({...H,notes:e.target.value}),className:"bg-white/5 border-white/10",placeholder:"e.g. Overtime"})]})]}),(0,a.jsx)(f.DialogFooter,{children:(0,a.jsx)(i.Button,{onClick:W,disabled:q,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:q?(0,a.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Payment"})})]})}),(0,a.jsx)(N.AdjustSalaryModal,{isOpen:_,onClose:()=>V(!1),person:I?{id:v,name:I.name,schoolId:I.schoolId,role:"STAFF",currentSalary:I.baseSalary||0,roleCode:I.roleCode}:null,onSuccess:()=>Y()}),(0,a.jsx)(S,{isOpen:J,onClose:()=>$(!1),staff:I?{id:v,...I}:null,onSuccess:()=>Y()}),(0,a.jsx)(C.AdminChangePasswordModal,{isOpen:K,onClose:()=>G(!1),user:I?{uid:I.uid,schoolId:I.schoolId,name:I.name,role:"STAFF"}:null})]}):null}e.s(["default",()=>A],41462)},27510,e=>{e.v(a=>Promise.all(["static/chunks/54ab083194d7bfbe.js"].map(a=>e.l(a))).then(()=>a(48323)))}]);