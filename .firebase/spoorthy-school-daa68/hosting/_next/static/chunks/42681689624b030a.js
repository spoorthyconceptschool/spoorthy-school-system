(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93479,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,type:a,...l},r)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-12 w-full rounded-full border border-white/10 bg-[#282828] px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all shadow-inner hover:bg-[#333]",e),ref:r,...l}));l.displayName="Input",e.s(["Input",()=>l])},10204,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("label",{ref:l,className:(0,s.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...a}));l.displayName="Label",e.s(["Label",()=>l])},76639,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(26999),l=e.i(37727),r=e.i(75157);let d=s.Root,o=s.Trigger,n=s.Portal;s.Close;let i=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(s.Overlay,{ref:l,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));i.displayName=s.Overlay.displayName;let c=a.forwardRef(({className:e,children:a,...d},o)=>(0,t.jsxs)(n,{children:[(0,t.jsx)(i,{}),(0,t.jsxs)(s.Content,{ref:o,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...d,children:[a,(0,t.jsxs)(s.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(l.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));c.displayName=s.Content.displayName;let m=({className:e,...a})=>(0,t.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});m.displayName="DialogHeader";let x=({className:e,...a})=>(0,t.jsx)("div",{className:(0,r.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});x.displayName="DialogFooter";let h=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(s.Title,{ref:l,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));h.displayName=s.Title.displayName;let u=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)(s.Description,{ref:l,className:(0,r.cn)("text-sm text-muted-foreground",e),...a}));u.displayName=s.Description.displayName,e.s(["Dialog",()=>d,"DialogContent",()=>c,"DialogDescription",()=>u,"DialogFooter",()=>x,"DialogHeader",()=>m,"DialogTitle",()=>h,"DialogTrigger",()=>o])},84774,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:l,className:(0,s.cn)("w-full caption-bottom text-sm",e),...a})}));l.displayName="Table";let r=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("thead",{ref:l,className:(0,s.cn)("[&_tr]:border-b",e),...a}));r.displayName="TableHeader";let d=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tbody",{ref:l,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...a}));d.displayName="TableBody",a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tfoot",{ref:l,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let o=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("tr",{ref:l,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));o.displayName="TableRow";let n=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("th",{ref:l,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));n.displayName="TableHead";let i=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("td",{ref:l,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));i.displayName="TableCell",a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("caption",{ref:l,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>l,"TableBody",()=>d,"TableCell",()=>i,"TableHead",()=>n,"TableHeader",()=>r,"TableRow",()=>o])},69049,41071,e=>{"use strict";var t=e.i(43476),a=e.i(84774),s=e.i(75157),l=e.i(19455);let r=(0,e.i(75254).default)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>r],41071);var d=e.i(55146);function o({data:e,columns:o,isLoading:n,onRowClick:i,actions:c}){return n?(0,t.jsx)("div",{className:"w-full h-48 flex items-center justify-center bg-white/5 rounded-xl animate-pulse",children:(0,t.jsx)("div",{className:"h-4 w-4 bg-accent/50 rounded-full animate-ping"})}):(0,t.jsxs)("div",{className:"w-full space-y-3",children:[(0,t.jsx)("div",{className:"overflow-x-auto rounded-xl md:rounded-2xl border border-white/10 bg-black/20 backdrop-blur-md custom-scrollbar",children:(0,t.jsxs)(a.Table,{className:"w-full",children:[(0,t.jsx)(a.TableHeader,{className:"bg-white/5",children:(0,t.jsxs)(a.TableRow,{className:"border-white/10 hover:bg-transparent",children:[o.map(e=>(0,t.jsx)(a.TableHead,{className:(0,s.cn)("text-muted-foreground font-black uppercase text-[7px] md:text-[10px] tracking-widest h-8 md:h-12 whitespace-nowrap px-2 md:px-6 italic",e.headerClassName),children:e.header},e.key)),c&&(0,t.jsx)(a.TableHead,{className:"w-[30px] md:w-[50px] whitespace-nowrap px-2 md:px-6"})]})}),(0,t.jsx)(a.TableBody,{children:0===e.length?(0,t.jsx)(a.TableRow,{children:(0,t.jsx)(a.TableCell,{colSpan:o.length+ +!!c,className:"h-24 md:h-32 text-center text-muted-foreground border-white/10 whitespace-nowrap text-[10px] md:text-sm italic",children:"No results found."})}):e.map((e,n)=>(0,t.jsxs)(a.TableRow,{className:(0,s.cn)("border-white/5 transition-all duration-300 hover:bg-[#64FFDA]/5 group cursor-default",i&&"cursor-pointer"),onClick:()=>i?.(e),children:[o.map(l=>(0,t.jsx)(a.TableCell,{className:(0,s.cn)("py-2 md:py-4 px-2 md:px-6 font-medium whitespace-nowrap text-[10px] md:text-sm",l.cellClassName),children:(0,t.jsx)("div",{className:"flex flex-col",children:l.render?l.render(e,n):(0,t.jsx)("span",{className:"text-white group-hover:text-accent transition-colors",children:e[l.key]})})},`${e.id}-${l.key}`)),c&&(0,t.jsx)(a.TableCell,{className:"px-2 md:px-6",children:(0,t.jsxs)(d.DropdownMenu,{children:[(0,t.jsx)(d.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(l.Button,{variant:"ghost",className:"h-7 w-7 md:h-8 md:w-8 p-0 hover:bg-white/10 text-muted-foreground hover:text-white",children:[(0,t.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,t.jsx)(r,{className:"h-3 w-3 md:h-4 md:w-4"})]})}),(0,t.jsxs)(d.DropdownMenuContent,{align:"end",className:"bg-[#0A192F] border-white/10 backdrop-blur-xl rounded-xl",children:[(0,t.jsx)(d.DropdownMenuLabel,{className:"text-[10px] uppercase font-black tracking-widest text-muted-foreground/60 p-3 italic",children:"Operations"}),(0,t.jsx)(d.DropdownMenuSeparator,{className:"bg-white/5"}),(0,t.jsx)("div",{className:"p-1",children:c(e)})]})]})})]},e.id||n))})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 md:py-4 px-3 md:px-6 bg-white/5 border border-white/10 rounded-xl md:rounded-2xl",children:[(0,t.jsxs)("div",{className:"text-[8px] md:text-xs font-black uppercase tracking-widest text-muted-foreground italic",children:["Scope: ",(0,t.jsxs)("span",{className:"text-white ml-1",children:[e.length," items"]})]}),(0,t.jsxs)("div",{className:"flex gap-1 md:gap-2",children:[(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Prev"}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Next"})]})]})]})}e.s(["DataTable",()=>o],69049)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},40160,e=>{"use strict";let t=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],40160)},24687,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let l=a.forwardRef(({className:e,...a},l)=>(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:l,...a}));l.displayName="Textarea",e.s(["Textarea",()=>l])},12426,e=>{"use strict";let t=(0,e.i(75254).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],12426)},89463,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(19455),l=e.i(93479),r=e.i(67489);e.i(36180);var d=e.i(98925),o=e.i(59141),n=e.i(31278),i=e.i(40160),c=e.i(55436),m=e.i(95468),x=e.i(76639),h=e.i(10204),u=e.i(24687),p=e.i(12426),b=e.i(32341);function g({isOpen:e,onClose:d,employee:o,payment:i,paidAmount:c=0,leavesCount:m=0,defaultMonth:g,defaultYear:f,onSuccess:y}){let{user:w}=(0,b.useAuth)(),[N,j]=(0,a.useState)(!1),[v,S]=(0,a.useState)({month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear().toString(),amount:"",deductions:"",bonuses:"",method:"CASH",notes:"",type:"SALARY"}),[k,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(o&&e)if(i)S({month:i.month,year:i.year,amount:i.baseAmount?.toString()||i.amount?.toString()||"",deductions:i.deductions?.toString()||"0",bonuses:i.bonuses?.toString()||"0",method:i.method||"CASH",notes:i.notes||"",type:i.type||"SALARY"});else{let e=Math.max(0,(o.baseSalary||0)-c);S({month:g||new Date().toLocaleString("default",{month:"long"}),year:f||new Date().getFullYear().toString(),amount:e>0?e.toString():"",deductions:"",bonuses:"",method:"CASH",notes:"",type:"SALARY"})}},[o,i,c,e,g,f]);let T=async()=>{if(o){j(!0);try{let e=Number(v.amount);if(!e&&0!==e)throw Error("Base Amount is required");let t=await w?.getIdToken(),a=await fetch("/api/admin/payroll/process",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({paymentId:i?.id,personId:o.id,personType:o.personType,...v,amount:e,deductions:Number(v.deductions)||0,bonuses:Number(v.bonuses)||0,leavesCount:m})}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to process payment");alert(i?"Payment Updated Successfully!":"Payment Recorded Successfully!"),y(),d()}catch(e){console.error(e),alert(e.message)}finally{j(!1)}}},D=async()=>{if(i?.id&&confirm("Are you sure you want to delete this payment record?")){C(!0);try{let e=await w?.getIdToken();if(!(await fetch("/api/admin/payroll/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({paymentId:i.id})})).ok)throw Error("Failed to delete payment");alert("Payment Record Deleted"),y(),d()}catch(e){alert(e.message)}finally{C(!1)}}};if(!o)return null;let A=Number(v.amount)||0,L=Number(v.deductions)||0,I=Number(v.bonuses)||0;return(0,t.jsx)(x.Dialog,{open:e,onOpenChange:e=>{e||d()},children:(0,t.jsxs)(x.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[500px]",children:[(0,t.jsx)(x.DialogHeader,{className:"pb-2 border-b border-white/5",children:(0,t.jsxs)(x.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(p.DollarSign,{className:"w-4 h-4 text-emerald-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:i?"Edit Payment":"Add Payment"}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground font-normal",children:o.name})]})]})}),(0,t.jsx)("div",{className:"max-h-[70vh] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-white/10",children:(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsx)("div",{className:"flex bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-1",children:["SALARY","BONUS","ADVANCE","ADJUSTMENT"].map(e=>(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>S({...v,type:e}),className:`flex-1 text-[10px] h-7 px-1 ${v.type===e?"bg-emerald-500/20 text-emerald-400":"text-muted-foreground hover:bg-white/5"}`,children:e},e))}),!i&&(0,t.jsx)("div",{className:"bg-gradient-to-br from-emerald-500/10 to-blue-500/10 p-4 rounded-xl border border-white/10 shadow-inner",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-y-2 text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Base Salary"}),(0,t.jsxs)("span",{className:"text-right font-mono",children:["₹",Number(o.baseSalary||0).toLocaleString()]}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Already Paid"}),(0,t.jsxs)("span",{className:"text-right font-mono text-emerald-400",children:["- ₹",c.toLocaleString()]}),(0,t.jsxs)("div",{className:"col-span-2 pt-2 mt-1 border-t border-white/10 flex justify-between items-end",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Remaining"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-orange-400 leading-tight",children:["₹",Math.max(0,(o.baseSalary||0)-c).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"text-right flex flex-col items-end",children:[(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:["Leaves (",v.month,")"]}),(0,t.jsxs)("span",{className:`text-sm font-bold ${m>0?"text-red-400":"text-emerald-400"}`,children:[m," Days"]})]})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{children:"Month"}),(0,t.jsxs)(r.Select,{value:v.month,onValueChange:e=>S({...v,month:e}),children:[(0,t.jsx)(r.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(r.SelectValue,{})}),(0,t.jsx)(r.SelectContent,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(e=>(0,t.jsx)(r.SelectItem,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{children:"Year"}),(0,t.jsx)(l.Input,{value:v.year,onChange:e=>S({...v,year:e.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{children:"Base Salary Amount (₹)"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,t.jsx)(l.Input,{type:"number",value:v.amount,onChange:e=>S({...v,amount:e.target.value}),className:"pl-9 bg-white/5 border-white/10",placeholder:o.baseSalary?o.baseSalary.toString():"0"})]}),o.baseSalary?(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Default Base: ₹",o.baseSalary.toLocaleString()]}):null]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{className:"text-red-400",children:"Deductions (₹)"}),(0,t.jsx)(l.Input,{type:"number",value:v.deductions,onChange:e=>S({...v,deductions:e.target.value}),className:"bg-white/5 border-white/10 text-red-400",placeholder:"0"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{className:"text-emerald-400",children:"Bonuses / Adds (₹)"}),(0,t.jsx)(l.Input,{type:"number",value:v.bonuses,onChange:e=>S({...v,bonuses:e.target.value}),className:"bg-white/5 border-white/10 text-emerald-400",placeholder:"0"})]})]}),(0,t.jsx)("div",{className:"space-y-2 bg-slate-900 border border-slate-800 p-3 rounded",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs uppercase text-slate-400",children:"Net Pay"}),(0,t.jsxs)("span",{className:"text-xl font-bold font-mono",children:["₹",(A-L+I).toLocaleString()]})]})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{children:"Payment Mode"}),(0,t.jsxs)(r.Select,{value:v.method,onValueChange:e=>S({...v,method:e}),children:[(0,t.jsx)(r.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(r.SelectValue,{})}),(0,t.jsxs)(r.SelectContent,{children:[(0,t.jsx)(r.SelectItem,{value:"CASH",children:"Cash"}),(0,t.jsx)(r.SelectItem,{value:"UPI",children:"UPI / Online"}),(0,t.jsx)(r.SelectItem,{value:"CHEQUE",children:"Cheque"}),(0,t.jsx)(r.SelectItem,{value:"BANK_TRANSFER",children:"Bank Transfer"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Label,{className:"text-xs text-muted-foreground",children:"Notes (Reason for adjustments)"}),(0,t.jsx)(u.Textarea,{value:v.notes,onChange:e=>S({...v,notes:e.target.value}),className:"bg-white/5 border-white/10 h-16 text-sm",placeholder:"e.g. Overtime adjustment, Leave deduction..."})]})]})}),(0,t.jsxs)(x.DialogFooter,{className:"pt-4 border-t border-white/5 flex flex-row items-center justify-between gap-2",children:[i?(0,t.jsxs)(s.Button,{variant:"destructive",size:"sm",onClick:D,disabled:k||N,className:"bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white border-red-500/20",children:[k&&(0,t.jsx)(n.Loader2,{className:"w-3 h-3 mr-2 animate-spin"}),"Delete"]}):(0,t.jsx)("div",{}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(s.Button,{onClick:d,variant:"ghost",className:"text-muted-foreground hover:text-white",children:"Cancel"}),(0,t.jsxs)(s.Button,{onClick:T,disabled:N||k,className:"bg-green-600 hover:bg-green-700 text-white",children:[N&&(0,t.jsx)(n.Loader2,{className:"w-4 h-4 mr-2 animate-spin"}),i?"Update Payment":"Confirm Payment"]})]})]})]})})}var f=e.i(69049),y=e.i(87486),w=e.i(72498),N=e.i(75157);function j(){let{branding:e}=(0,w.useMasterData)(),[x,h]=(0,a.useState)(!0),[u,p]=(0,a.useState)([]),[b,j]=(0,a.useState)([]),[v,S]=(0,a.useState)({}),[k,C]=(0,a.useState)(new Date().toLocaleString("default",{month:"long"})),[T,D]=(0,a.useState)(new Date().getFullYear().toString()),[A,L]=(0,a.useState)(""),[I,R]=(0,a.useState)("ALL"),[P,$]=(0,a.useState)("ALL"),[F,B]=(0,a.useState)(null),[E,M]=(0,a.useState)(null),[H,z]=(0,a.useState)(0),[O,V]=(0,a.useState)(!1);(0,a.useEffect)(()=>{U()},[k,T]);let U=async()=>{h(!0);try{let e=(await (0,d.getDocs)((0,d.query)((0,d.collection)(o.db,"teachers"),(0,d.where)("status","==","ACTIVE")))).docs.map(e=>{let t=e.data();return{id:e.id,...t,personType:"TEACHER",roleDisplay:"Teacher",baseSalary:t.baseSalary||t.salary}}),t=(await (0,d.getDocs)((0,d.collection)(o.db,"staff"))).docs.map(e=>{let t=e.data();return{id:e.id,...t,personType:"STAFF",roleDisplay:t.roleName||"Staff",baseSalary:t.baseSalary||t.salary}}),a=[...e,...t].sort((e,t)=>e.name.localeCompare(t.name));p(a);let s=(0,d.query)((0,d.collection)(o.db,"salary_payments"),(0,d.where)("month","==",k),(0,d.where)("year","==",T)),l=(await (0,d.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}));j(l);let r=new Date(`${k} 1, 2000`).getMonth()+1,n=String(r).padStart(2,"0"),i=`${T}-${n}-01`,c=`${T}-${n}-31`,m=(0,d.query)((0,d.collection)(o.db,"attendance"),(0,d.where)((0,d.documentId)(),">=",`TEACHERS_${i}`),(0,d.where)((0,d.documentId)(),"<=",`TEACHERS_${c}`)),x=await (0,d.getDocs)(m),h={};x.forEach(e=>{let t=e.data();t.records&&Object.entries(t.records).forEach(([e,t])=>{"A"===t&&(h[e]=(h[e]||0)+1)})});let u=(0,d.query)((0,d.collection)(o.db,"attendance"),(0,d.where)((0,d.documentId)(),">=",`STAFF_${i}`),(0,d.where)((0,d.documentId)(),"<=",`STAFF_${c}`));(await (0,d.getDocs)(u)).forEach(e=>{let t=e.data();t.records&&Object.entries(t.records).forEach(([e,t])=>{"A"===t&&(h[e]=(h[e]||0)+1)})}),S(h)}catch(e){console.error("Error fetching payroll data:",e)}finally{h(!1)}},q=e=>b.filter(t=>t.personId===e),J=(e,t,a=0)=>{B(e),M(t||null),z(a),V(!0)},Y=u.filter(e=>{let t=e.name.toLowerCase().includes(A.toLowerCase())||e.schoolId&&e.schoolId.toLowerCase().includes(A.toLowerCase()),a="ALL"===I||e.personType===I,s=q(e.id),l=s.reduce((e,t)=>e+(Number(t.amount)||0),0),r=s.reduce((e,t)=>e+(Number(t.deductions)||0),0),d=(e.baseSalary||0)>0&&l+r>=(e.baseSalary||0),o="ALL"===P||"PAID"===P&&d||"UNPAID"===P&&!d;return t&&a&&o}),_=b.reduce((e,t)=>e+(Number(t.amount)||0),0),K=0;u.forEach(e=>{let t=q(e.id),a=t.reduce((e,t)=>e+(Number(t.amount)||0),0),s=t.reduce((e,t)=>e+(Number(t.deductions)||0),0);(e.baseSalary||0)>0&&a+s>=(e.baseSalary||0)&&K++});let W=u.length-K;return(0,t.jsxs)("div",{className:"space-y-4 md:space-y-6 animate-in fade-in duration-500 max-w-none p-0 pb-20",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between pt-2 md:pt-4 gap-4 md:gap-6 px-1 md:px-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent italic leading-tight",children:"Payroll Center"}),(0,t.jsxs)("p",{className:"text-muted-foreground text-sm md:text-lg tracking-tight",children:["Managing staff disbursements for ",(0,t.jsxs)("span",{className:"text-white font-bold",children:[k," ",T]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[(0,t.jsxs)(r.Select,{value:k,onValueChange:C,children:[(0,t.jsx)(r.SelectTrigger,{className:"w-[120px] md:w-[140px] bg-black/40 border-white/10 rounded-xl h-9 md:h-11 text-xs md:text-sm",children:(0,t.jsx)(r.SelectValue,{})}),(0,t.jsx)(r.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(e=>(0,t.jsx)(r.SelectItem,{value:e,children:e},e))})]}),(0,t.jsx)(l.Input,{value:T,onChange:e=>D(e.target.value),className:"w-[80px] md:w-[100px] bg-black/40 border-white/10 text-center rounded-xl h-9 md:h-11 font-mono font-bold text-xs md:text-sm"}),(0,t.jsxs)(s.Button,{variant:"outline",className:"h-9 md:h-11 gap-2 border-white/10 bg-white/5 rounded-xl hover:bg-white/10 px-3 md:px-4 text-xs md:text-sm",onClick:()=>{let t=`
            <html>
                <head>
                    <title>Payroll Report - ${k} ${T}</title>
                    <style>
                        body { font-family: sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .status-paid { color: green; font-weight: bold; }
                        .status-unpaid { color: orange; font-weight: bold; }
                        .header-row { border: none !important; background: white !important; }
                        .header-cell { border: none !important; padding: 20px 0; text-align: center; }
                        .print-header { display: flex; align-items: center; justify-content: center; gap: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 10px; }
                        .school-logo { height: 80px; width: auto; object-fit: contain; }
                        .school-details { text-align: left; }
                        @media print {
                            thead { display: table-header-group; }
                            tr { page-break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <table>
                        <thead>
                            <tr class="header-row">
                                <th colspan="9" class="header-cell">
                                    <div class="print-header">
                                        ${e?.schoolLogo?`<img src="${e.schoolLogo}" class="school-logo" onload="window.print();" onerror="window.print();" />`:""}
                                        <div class="school-details">
                                            <h1 style="margin: 0; font-size: 24px; text-transform: uppercase;">${e?.schoolName||"Payroll Report"}</h1>
                                            ${e?.address?`<div style="font-size: 14px; color: #666; margin-top: 5px;">${e.address}</div>`:""}
                                            <h2 style="margin: 10px 0 0 0; font-size: 18px; color: #444;">Monthly Payroll - ${k} ${T}</h2>
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th>Name</th>
                                <th>ID</th>
                                <th>Role</th>
                                <th>Leaves</th>
                                <th>Base Salary</th>
                                <th>Deductions</th>
                                <th>Bonuses</th>
                                <th>Paid Amount (Net)</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Y.map(e=>{let t=q(e.id),a=t.reduce((e,t)=>e+(Number(t.amount)||0),0),s=t.reduce((e,t)=>e+(Number(t.deductions)||0),0),l=(e.baseSalary||0)>0&&a+s>=(e.baseSalary||0),r=v[e.schoolId]||0;return`
                                    <tr>
                                        <td>${e.name}</td>
                                        <td>${e.schoolId}</td>
                                        <td>${e.roleDisplay}</td>
                                        <td>${r}</td>
                                        <td>${e.baseSalary||"-"}</td>
                                        <td>${t.reduce((e,t)=>e+(t.deductions||0),0)||"-"}</td>
                                        <td>${t.reduce((e,t)=>e+(t.bonuses||0),0)||"-"}</td>
                                        <td style="font-weight: bold;">${a?"₹"+Number(a).toLocaleString():"-"}</td>
                                        <td class="${l?"status-paid":"status-unpaid"}">${l?"PAID":"PENDING"}</td>
                                    </tr>
                                `}).join("")}
                        </tbody>
                    </table>
                    <script>
                        // Fallback in case image onload doesn't fire or no image
                        if (!document.querySelector('img')) {
                            window.print();
                        } else {
                            setTimeout(() => {
                                // If print hasn't happened yet (e.g. image stuck)
                                // We can't easily detect if print dialog opened, but this is a safety net
                                // Actually, simpler to just rely on onload/onerror for image
                            }, 2000);
                        }
                    </script>
                </body>
            </html>
        `,a=window.open("","","width=900,height=700");a&&(a.document.write(t),a.document.close())},children:[(0,t.jsx)(i.Download,{size:14,className:"md:w-4 md:h-4"})," ",(0,t.jsx)("span",{className:"hidden sm:inline",children:"Print Report"}),(0,t.jsx)("span",{className:"sm:hidden",children:"Print"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4 px-2 md:px-0",children:[(0,t.jsxs)("div",{className:"bg-emerald-500/5 border border-emerald-500/10 p-4 md:p-5 rounded-2xl backdrop-blur-sm shadow-xl flex sm:flex-col justify-between items-center sm:items-start",children:[(0,t.jsx)("p",{className:"text-xs md:text-[10px] font-black uppercase tracking-widest text-emerald-400 italic",children:"Total Disbursed"}),(0,t.jsxs)("div",{className:"text-2xl md:text-3xl font-mono font-black text-white",children:["₹",_.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"bg-blue-500/5 border border-blue-500/10 p-4 md:p-5 rounded-2xl backdrop-blur-sm shadow-xl flex sm:flex-col justify-between items-center sm:items-start",children:[(0,t.jsx)("p",{className:"text-xs md:text-[10px] font-black uppercase tracking-widest text-blue-400 italic",children:"Accounts Paid"}),(0,t.jsxs)("div",{className:"text-2xl md:text-3xl font-mono font-black text-white",children:[K," ",(0,t.jsx)("span",{className:"text-xs md:text-xs text-blue-400/50",children:"Staff"})]})]}),(0,t.jsxs)("div",{className:"bg-orange-500/5 border border-orange-500/10 p-4 md:p-5 rounded-2xl backdrop-blur-sm shadow-xl flex sm:flex-col justify-between items-center sm:items-start",children:[(0,t.jsx)("p",{className:"text-xs md:text-[10px] font-black uppercase tracking-widest text-orange-400 italic",children:"Outstanding"}),(0,t.jsxs)("div",{className:"text-2xl md:text-3xl font-mono font-black text-white",children:[W," ",(0,t.jsx)("span",{className:"text-xs md:text-xs text-orange-400/50",children:"Pending"})]})]})]}),(0,t.jsx)("div",{className:"bg-black/20 p-3 md:p-5 rounded-2xl border border-white/10 backdrop-blur-md space-y-3 md:space-y-4 shadow-2xl mx-2 md:mx-0",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-2 md:gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(c.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-3.5 h-3.5 md:w-4 md:h-4 text-muted-foreground"}),(0,t.jsx)(l.Input,{value:A,onChange:e=>L(e.target.value),placeholder:"Find by name or staff ID...",className:"pl-10 md:pl-11 h-10 md:h-12 bg-white/5 border-white/10 rounded-xl focus:ring-accent/30 text-xs md:text-sm"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:flex gap-2",children:[(0,t.jsxs)(r.Select,{value:I,onValueChange:R,children:[(0,t.jsx)(r.SelectTrigger,{className:"w-full md:w-[150px] h-10 md:h-12 bg-white/5 border-white/10 rounded-xl text-xs md:text-sm",children:(0,t.jsx)(r.SelectValue,{placeholder:"All Roles"})}),(0,t.jsxs)(r.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(r.SelectItem,{value:"ALL",children:"All Roles"}),(0,t.jsx)(r.SelectItem,{value:"TEACHER",children:"Teachers"}),(0,t.jsx)(r.SelectItem,{value:"STAFF",children:"Helpers"})]})]}),(0,t.jsxs)(r.Select,{value:P,onValueChange:$,children:[(0,t.jsx)(r.SelectTrigger,{className:"w-full md:w-[150px] h-10 md:h-12 bg-white/5 border-white/10 rounded-xl text-xs md:text-sm",children:(0,t.jsx)(r.SelectValue,{placeholder:"All Status"})}),(0,t.jsxs)(r.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(r.SelectItem,{value:"ALL",children:"All Status"}),(0,t.jsx)(r.SelectItem,{value:"PAID",children:"Disbursed"}),(0,t.jsx)(r.SelectItem,{value:"UNPAID",children:"Pending"})]})]})]})]})}),x?(0,t.jsx)("div",{className:"flex justify-center p-20 animate-pulse",children:(0,t.jsx)(n.Loader2,{className:"w-12 h-12 animate-spin text-accent"})}):(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)(f.DataTable,{data:Y,isLoading:x,columns:[{key:"employeeInfo",header:"Employee Info",render:e=>(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-bold text-[13px] md:text-sm text-white group-hover:text-accent transition-colors leading-tight",children:e.name}),(0,t.jsx)("span",{className:"text-[9px] md:text-[10px] font-mono text-white/60 tracking-tighter uppercase",children:e.schoolId}),(0,t.jsxs)("span",{className:"text-[7px] md:text-[8px] text-white/50 mt-0.5 md:mt-1 uppercase font-black",children:["Base: ₹",Number(e.baseSalary||0).toLocaleString()]})]})},{key:"role",header:"Role",render:e=>(0,t.jsx)("span",{className:"text-[9px] md:text-[10px] uppercase font-black text-muted-foreground tracking-tighter bg-white/5 px-2 py-0.5 rounded border border-white/5",children:e.roleDisplay})},{key:"absents",header:"Absents",cellClassName:"text-center",render:e=>{let a=v[e.schoolId]||0;return(0,t.jsx)("span",{className:(0,N.cn)("font-black text-xs md:text-sm",a>0?"text-orange-400":"text-emerald-400/30"),children:a})}},{key:"payments",header:"Month Payments",render:e=>{let a=q(e.id),l=a.reduce((e,t)=>e+(Number(t.amount)||0),0),r=a.reduce((e,t)=>e+(Number(t.deductions)||0),0),d=(e.baseSalary||0)>0&&l+r>=(e.baseSalary||0);return(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 md:gap-1.5 min-w-[120px] md:min-w-[140px]",children:[a.map(a=>(0,t.jsxs)(y.Badge,{variant:"outline",className:"cursor-pointer hover:bg-white/10 transition-colors gap-1 px-1.5 md:px-2 border-white/10 bg-white/5 py-0 md:py-0.5",onClick:()=>J(e,a),children:[(0,t.jsxs)("span",{className:"text-[8px] md:text-[9px] font-bold text-emerald-400",children:["₹",a.amount]}),(0,t.jsx)("span",{className:"text-[6px] md:text-[7px] opacity-40 uppercase font-black",children:a.type||"S"})]},a.id)),!d&&(0,t.jsx)(s.Button,{size:"sm",variant:"ghost",className:"h-5 md:h-6 px-2 md:px-3 text-[8px] md:text-[9px] rounded-lg bg-[#64FFDA]/10 text-[#64FFDA] hover:bg-[#64FFDA] hover:text-[#0A192F] font-black uppercase tracking-tighter transition-all",onClick:()=>J(e,void 0,l),children:"Pay Now"})]})}},{key:"disbursement",header:"Net Disbursement",cellClassName:"text-right",render:e=>{let a=q(e.id),s=a.reduce((e,t)=>e+(Number(t.amount)||0),0),l=a.reduce((e,t)=>e+(Number(t.deductions)||0),0),r=(e.baseSalary||0)>0&&s+l>=(e.baseSalary||0);return(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 md:gap-2",children:[(0,t.jsxs)("span",{className:(0,N.cn)("font-mono font-black text-base md:text-lg transition-colors",r?"text-emerald-400":s>0?"text-blue-400 font-bold":"text-white/20"),children:["₹",Number(s).toLocaleString()]}),r&&(0,t.jsx)(m.CheckCircle2,{className:"w-3 md:w-3.5 h-3 md:h-3.5 text-emerald-500",strokeWidth:3})]}),!r&&e.baseSalary&&(s>0||l>0)&&(0,t.jsxs)("span",{className:"text-[8px] md:text-[9px] font-black text-orange-500 uppercase italic",children:["Due: ₹",Number(Math.max(0,e.baseSalary-s-l)).toLocaleString()]})]})}}]})}),(0,t.jsx)(g,{isOpen:O,onClose:()=>V(!1),employee:F,payment:E,paidAmount:H,leavesCount:F&&v[F.schoolId]||0,defaultMonth:k,defaultYear:T,onSuccess:()=>U()})]})}e.s(["default",()=>j],89463)}]);