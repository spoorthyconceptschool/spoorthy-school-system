(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("rounded-2xl border border-[#64FFDA]/10 bg-[#112240]/40 backdrop-blur-lg text-white shadow-xl transition-all duration-300 hover:bg-[#112240]/60 hover:border-[#64FFDA]/30 hover:shadow-[0_0_20px_-5px_rgba(100,255,218,0.1)] group",e),...a}));r.displayName="Card";let l=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...a}));l.displayName="CardHeader";let d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("h3",{ref:r,className:(0,s.cn)("font-bold text-xl tracking-tight text-white group-hover:text-accent transition-colors",e),...a}));d.displayName="CardTitle";let n=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-white/60 font-medium",e),...a}));n.displayName="CardDescription";let i=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",e),...a}));i.displayName="CardContent",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter",e.s(["Card",()=>r,"CardContent",()=>i,"CardDescription",()=>n,"CardHeader",()=>l,"CardTitle",()=>d])},93479,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let r=a.forwardRef(({className:e,type:a,...r},l)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-12 w-full rounded-full border border-white/10 bg-[#282828] px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all shadow-inner hover:bg-[#333]",e),ref:l,...r}));r.displayName="Input",e.s(["Input",()=>r])},3281,e=>{"use strict";let t=(0,e.i(75254).default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],3281)},84774,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:r,className:(0,s.cn)("w-full caption-bottom text-sm",e),...a})}));r.displayName="Table";let l=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("thead",{ref:r,className:(0,s.cn)("[&_tr]:border-b",e),...a}));l.displayName="TableHeader";let d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tbody",{ref:r,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...a}));d.displayName="TableBody",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tfoot",{ref:r,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let n=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tr",{ref:r,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));n.displayName="TableRow";let i=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("th",{ref:r,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));i.displayName="TableHead";let o=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("td",{ref:r,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));o.displayName="TableCell",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("caption",{ref:r,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>r,"TableBody",()=>d,"TableCell",()=>o,"TableHead",()=>i,"TableHeader",()=>l,"TableRow",()=>n])},69049,41071,e=>{"use strict";var t=e.i(43476),a=e.i(84774),s=e.i(75157),r=e.i(19455);let l=(0,e.i(75254).default)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>l],41071);var d=e.i(55146);function n({data:e,columns:n,isLoading:i,onRowClick:o,actions:c}){return i?(0,t.jsx)("div",{className:"w-full h-48 flex items-center justify-center bg-white/5 rounded-xl animate-pulse",children:(0,t.jsx)("div",{className:"h-4 w-4 bg-accent/50 rounded-full animate-ping"})}):(0,t.jsxs)("div",{className:"w-full space-y-3",children:[(0,t.jsx)("div",{className:"overflow-x-auto rounded-xl md:rounded-2xl border border-white/10 bg-black/20 backdrop-blur-md custom-scrollbar",children:(0,t.jsxs)(a.Table,{className:"w-full",children:[(0,t.jsx)(a.TableHeader,{className:"bg-white/5",children:(0,t.jsxs)(a.TableRow,{className:"border-white/10 hover:bg-transparent",children:[n.map(e=>(0,t.jsx)(a.TableHead,{className:(0,s.cn)("text-muted-foreground font-black uppercase text-[7px] md:text-[10px] tracking-widest h-8 md:h-12 whitespace-nowrap px-2 md:px-6 italic",e.headerClassName),children:e.header},e.key)),c&&(0,t.jsx)(a.TableHead,{className:"w-[30px] md:w-[50px] whitespace-nowrap px-2 md:px-6"})]})}),(0,t.jsx)(a.TableBody,{children:0===e.length?(0,t.jsx)(a.TableRow,{children:(0,t.jsx)(a.TableCell,{colSpan:n.length+ +!!c,className:"h-24 md:h-32 text-center text-muted-foreground border-white/10 whitespace-nowrap text-[10px] md:text-sm italic",children:"No results found."})}):e.map((e,i)=>(0,t.jsxs)(a.TableRow,{className:(0,s.cn)("border-white/5 transition-all duration-300 hover:bg-[#64FFDA]/5 group cursor-default",o&&"cursor-pointer"),onClick:()=>o?.(e),children:[n.map(r=>(0,t.jsx)(a.TableCell,{className:(0,s.cn)("py-2 md:py-4 px-2 md:px-6 font-medium whitespace-nowrap text-[10px] md:text-sm",r.cellClassName),children:(0,t.jsx)("div",{className:"flex flex-col",children:r.render?r.render(e,i):(0,t.jsx)("span",{className:"text-white group-hover:text-accent transition-colors",children:e[r.key]})})},`${e.id}-${r.key}`)),c&&(0,t.jsx)(a.TableCell,{className:"px-2 md:px-6",children:(0,t.jsxs)(d.DropdownMenu,{children:[(0,t.jsx)(d.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{variant:"ghost",className:"h-7 w-7 md:h-8 md:w-8 p-0 hover:bg-white/10 text-muted-foreground hover:text-white",children:[(0,t.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,t.jsx)(l,{className:"h-3 w-3 md:h-4 md:w-4"})]})}),(0,t.jsxs)(d.DropdownMenuContent,{align:"end",className:"bg-[#0A192F] border-white/10 backdrop-blur-xl rounded-xl",children:[(0,t.jsx)(d.DropdownMenuLabel,{className:"text-[10px] uppercase font-black tracking-widest text-muted-foreground/60 p-3 italic",children:"Operations"}),(0,t.jsx)(d.DropdownMenuSeparator,{className:"bg-white/5"}),(0,t.jsx)("div",{className:"p-1",children:c(e)})]})]})})]},e.id||i))})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 md:py-4 px-3 md:px-6 bg-white/5 border border-white/10 rounded-xl md:rounded-2xl",children:[(0,t.jsxs)("div",{className:"text-[8px] md:text-xs font-black uppercase tracking-widest text-muted-foreground italic",children:["Scope: ",(0,t.jsxs)("span",{className:"text-white ml-1",children:[e.length," items"]})]}),(0,t.jsxs)("div",{className:"flex gap-1 md:gap-2",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Prev"}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Next"})]})]})]})}e.s(["DataTable",()=>n],69049)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},77572,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(81140),r=e.i(30030),l=e.i(42727),d=e.i(96626),n=e.i(48425),i=e.i(86318),o=e.i(69340),c=e.i(10772),h="Tabs",[m,x]=(0,r.createContextScope)(h,[l.createRovingFocusGroupScope]),u=(0,l.createRovingFocusGroupScope)(),[p,b]=m(h),f=a.forwardRef((e,a)=>{let{__scopeTabs:s,value:r,onValueChange:l,defaultValue:d,orientation:m="horizontal",dir:x,activationMode:u="automatic",...b}=e,f=(0,i.useDirection)(x),[g,w]=(0,o.useControllableState)({prop:r,onChange:l,defaultProp:d??"",caller:h});return(0,t.jsx)(p,{scope:s,baseId:(0,c.useId)(),value:g,onValueChange:w,orientation:m,dir:f,activationMode:u,children:(0,t.jsx)(n.Primitive.div,{dir:f,"data-orientation":m,...b,ref:a})})});f.displayName=h;var g="TabsList",w=a.forwardRef((e,a)=>{let{__scopeTabs:s,loop:r=!0,...d}=e,i=b(g,s),o=u(s);return(0,t.jsx)(l.Root,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:r,children:(0,t.jsx)(n.Primitive.div,{role:"tablist","aria-orientation":i.orientation,...d,ref:a})})});w.displayName=g;var j="TabsTrigger",v=a.forwardRef((e,a)=>{let{__scopeTabs:r,value:d,disabled:i=!1,...o}=e,c=b(j,r),h=u(r),m=S(c.baseId,d),x=k(c.baseId,d),p=d===c.value;return(0,t.jsx)(l.Item,{asChild:!0,...h,focusable:!i,active:p,children:(0,t.jsx)(n.Primitive.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":x,"data-state":p?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:m,...o,ref:a,onMouseDown:(0,s.composeEventHandlers)(e.onMouseDown,e=>{i||0!==e.button||!1!==e.ctrlKey?e.preventDefault():c.onValueChange(d)}),onKeyDown:(0,s.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&c.onValueChange(d)}),onFocus:(0,s.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==c.activationMode;p||i||!e||c.onValueChange(d)})})})});v.displayName=j;var N="TabsContent",y=a.forwardRef((e,s)=>{let{__scopeTabs:r,value:l,forceMount:i,children:o,...c}=e,h=b(N,r),m=S(h.baseId,l),x=k(h.baseId,l),u=l===h.value,p=a.useRef(u);return a.useEffect(()=>{let e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(d.Presence,{present:i||u,children:({present:a})=>(0,t.jsx)(n.Primitive.div,{"data-state":u?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":m,hidden:!a,id:x,tabIndex:0,...c,ref:s,style:{...e.style,animationDuration:p.current?"0s":void 0},children:a&&o})})});function S(e,t){return`${e}-trigger-${t}`}function k(e,t){return`${e}-content-${t}`}y.displayName=N;var C=e.i(75157);let I=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(w,{ref:s,className:(0,C.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...a}));I.displayName=w.displayName;let A=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(v,{ref:s,className:(0,C.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...a}));A.displayName=v.displayName;let D=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(y,{ref:s,className:(0,C.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a}));D.displayName=y.displayName,e.s(["Tabs",()=>f,"TabsContent",()=>D,"TabsList",()=>I,"TabsTrigger",()=>A],77572)},94919,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(32341),r=e.i(59141);e.i(36180);var l=e.i(98925),d=e.i(15288),n=e.i(19455),i=e.i(87486),o=e.i(69049),c=e.i(31278),h=e.i(43531),m=e.i(37727),x=e.i(56909),u=e.i(55436),p=e.i(3281),b=e.i(80691),f=e.i(72498),g=e.i(93479),w=e.i(67489),j=e.i(75157);function v({classId:e,sectionId:v,defaultDate:N}){let{user:y}=(0,s.useAuth)(),{classes:S,branding:k}=(0,f.useMasterData)(),[C,I]=(0,a.useState)([]),[A,D]=(0,a.useState)({}),[$,T]=(0,a.useState)(!0),[P,L]=(0,a.useState)(!1),[R,F]=(0,a.useState)(!1),[E,M]=(0,a.useState)(!1),[z,B]=(0,a.useState)(""),[O,_]=(0,a.useState)(!1),[V,H]=(0,a.useState)([]),[Y,U]=(0,a.useState)("ALL"),q=N||new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{e&&v&&(O?J():G())},[e,v,q,O,Y]);let J=async()=>{T(!0);try{let t,a,s=(0,l.query)((0,l.collection)(r.db,"students"),(0,l.where)("classId","==",e),(0,l.where)("sectionId","==",v)),d=(await (0,l.getDocs)(s)).docs.map(e=>({id:e.id,studentName:e.data().studentName,rollNumber:e.data().rollNumber,schoolId:e.data().schoolId})).sort((e,t)=>(e.rollNumber||0)-(t.rollNumber||0)),n=new Date().getFullYear();"ALL"===Y?(t=`${n}-01-01_${e}_${v}`,a=`${n}-12-31_${e}_${v}`):(t=`${n}-${Y}-01_${e}_${v}`,a=`${n}-${Y}-31_${e}_${v}`);let i=(0,l.query)((0,l.collection)(r.db,"attendance"),(0,l.where)((0,l.documentId)(),">=",t),(0,l.where)((0,l.documentId)(),"<=",a)),o=await (0,l.getDocs)(i),c={};o.docs.forEach(e=>{let t=e.data();t.records&&Object.entries(t.records).forEach(([e,t])=>{c[e]||(c[e]={total:0,present:0}),("P"===t||"A"===t)&&(c[e].total++,"P"===t&&c[e].present++)})});let h=d.map(e=>{let t=c[e.id]||{total:0,present:0};return{...e,totalDays:t.total,presentDays:t.present,percentage:t.total>0?(t.present/t.total*100).toFixed(1):"0.0"}});H(h),I(d)}catch(e){console.error("Stats error",e),(0,b.toast)({title:"Error",description:"Failed to load stats",type:"error"})}finally{T(!1)}},G=async()=>{T(!0);try{let t=(0,l.query)((0,l.collection)(r.db,"students"),(0,l.where)("classId","==",e),(0,l.where)("sectionId","==",v),(0,l.where)("status","==","ACTIVE")),a=(await (0,l.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>(e.rollNumber||0)-(t.rollNumber||0));I(a);let s=(0,l.query)((0,l.collection)(r.db,"student_leaves"),(0,l.where)("classId","==",e),(0,l.where)("status","==","APPROVED")),d=await (0,l.getDocs)(s),n=new Set;d.forEach(e=>{let t=e.data();t.fromDate<=q&&t.toDate>=q&&(!t.sectionId||t.sectionId===v)&&n.add(t.studentId)});let i=`${q}_${e}_${v}`,o=await (0,l.getDoc)((0,l.doc)(r.db,"attendance",i));if(o.exists())F(!0),D(o.data().records||{});else{F(!1);let e={};a.forEach(t=>{let a=n.has(t.id)||t.schoolId&&n.has(t.schoolId);e[t.id]=a?"A":"P"}),D(e)}}catch(e){console.error(e),(0,b.toast)({title:"Error",description:"Failed to fetch data.",type:"error"})}finally{T(!1)}},[K,X]=(0,a.useState)(new Set),Q=async()=>{L(!0);try{let t=await fetch("/api/attendance/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:e,sectionId:v,date:q,records:A,markedBy:y?.uid,markedByName:y?.displayName||"Admin",isModification:R,touchedIds:Array.from(K)})}),a=await t.json();if(!a.success)throw Error(a.error);(0,b.toast)({title:R?"Attendance Updated":"Attendance Submitted",description:`Updated ${a.changesCount||0}. Sent ${a.notifCount||0} notifications.${a.skippedCount?` (${a.skippedCount} users have no account)`:""}`,type:"success"}),F(!0),M(!1),X(new Set)}catch(e){console.error(e),(0,b.toast)({title:"Failed",description:e.message,type:"error"})}finally{L(!1)}},W=C.filter(e=>e.studentName.toLowerCase().includes(z.toLowerCase())||e.schoolId&&e.schoolId.toLowerCase().includes(z.toLowerCase())||e.rollNumber&&String(e.rollNumber).includes(z));if($)return(0,t.jsx)("div",{className:"p-10 flex justify-center",children:(0,t.jsx)(c.Loader2,{className:"animate-spin"})});let Z={total:C.length,present:Object.values(A).filter(e=>"P"===e).length,absent:Object.values(A).filter(e=>"A"===e).length};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(d.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Total"}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:Z.total})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500",children:(0,t.jsx)(h.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(d.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-emerald-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Present"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-500",children:Z.present})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500",children:(0,t.jsx)(h.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(d.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-red-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Absent"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-500",children:Z.absent})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500",children:(0,t.jsx)(m.X,{className:"w-5 h-5"})})]})})]}),(0,t.jsxs)(d.Card,{className:"bg-black/20 border-white/10",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center",children:[(0,t.jsxs)("div",{className:"flex bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>_(!1),className:O?"text-muted-foreground hover:text-white":"bg-emerald-500/20 text-emerald-500",children:"Daily View"}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>_(!0),className:O?"bg-blue-500/20 text-blue-500":"text-muted-foreground hover:text-white",children:"Overall Stats"}),O&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(w.Select,{value:Y,onValueChange:U,children:[(0,t.jsx)(w.SelectTrigger,{className:"w-[140px] h-8 bg-transparent border-white/10 text-xs",children:(0,t.jsx)(w.SelectValue,{placeholder:"Period"})}),(0,t.jsxs)(w.SelectContent,{className:"bg-slate-900 border-white/10",children:[(0,t.jsxs)(w.SelectItem,{value:"ALL",children:["Full Year ",new Date().getFullYear()]}),(0,t.jsx)(w.SelectItem,{value:"01",children:"January"}),(0,t.jsx)(w.SelectItem,{value:"02",children:"February"}),(0,t.jsx)(w.SelectItem,{value:"03",children:"March"}),(0,t.jsx)(w.SelectItem,{value:"04",children:"April"}),(0,t.jsx)(w.SelectItem,{value:"05",children:"May"}),(0,t.jsx)(w.SelectItem,{value:"06",children:"June"}),(0,t.jsx)(w.SelectItem,{value:"07",children:"July"}),(0,t.jsx)(w.SelectItem,{value:"08",children:"August"}),(0,t.jsx)(w.SelectItem,{value:"09",children:"September"}),(0,t.jsx)(w.SelectItem,{value:"10",children:"October"}),(0,t.jsx)(w.SelectItem,{value:"11",children:"November"}),(0,t.jsx)(w.SelectItem,{value:"12",children:"December"})]})]}),(0,t.jsxs)(n.Button,{size:"sm",variant:"outline",className:"h-8 border-white/10 hover:bg-white/5 gap-2 px-3",onClick:()=>{let t=S.find(t=>t.id===e),a="ALL"===Y?`Annual Report ${new Date().getFullYear()}`:`Monthly Report - ${new Date(2e3,Number(Y)-1).toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,s=`
            <html>
            <head>
                <title>Student Attendance Report - ${t?.name} - ${a}</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }
                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                    .logo { height: 80px; width: auto; object-fit: contain; }
                    .header-text { text-align: left; }
                    h1 { margin: 0; font-size: 28px; }
                    .details { font-size: 14px; color: #666; margin-top: 2px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }
                    .text-center { text-align: center; }
                    .font-bold { font-weight: bold; }
                    .percentage { font-weight: bold; }
                    .low { color: #dc3545; }
                    .good { color: #28a745; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    ${k?.schoolLogo?`<img src="${k.schoolLogo}" class="logo" />`:""}
                    <div class="header-text">
                        <h1 style="margin: 0;">${k?.schoolName||"Attendance Report"}</h1>
                        <div class="details" style="font-weight: bold; color: #333;">Student Attendance Report</div>
                        <div class="details">Class: ${t?.name} (${v}) - ${a}</div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">Roll</th>
                            <th>Student Name</th>
                            <th class="text-center">ID</th>
                            <th class="text-center">Total Days</th>
                            <th class="text-center">Present</th>
                            <th class="text-center">Absents</th>
                            <th class="text-center">Attendance %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${V.map((e,t)=>`
                            <tr>
                                <td>${e.rollNumber||t+1}</td>
                                <td class="font-bold">${e.studentName}</td>
                                <td class="text-center">${e.schoolId}</td>
                                <td class="text-center">${e.totalDays}</td>
                                <td class="text-center" style="color: #28a745; font-weight: bold;">${e.presentDays}</td>
                                <td class="text-center">${e.totalDays-e.presentDays}</td>
                                <td class="text-center percentage ${75>Number(e.percentage)?"low":"good"}">${e.percentage}%</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <div class="footer">
                    <div>Generated on: ${new Date().toLocaleString()}</div>
                    <div>School Management System</div>
                </div>
                <script>
                    window.onload = () => {
                        window.print();
                        window.onafterprint = () => window.close();
                    };
                </script>
            </body>
            </html>
        `,r=window.open("","_blank");r?.document.write(s),r?.document.close()},children:[(0,t.jsx)(p.Printer,{className:"w-3 h-3"})," Print Report"]})]})]}),!O&&(0,t.jsxs)("div",{className:"relative flex-1 w-full md:max-w-xs",children:[(0,t.jsx)(u.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(g.Input,{placeholder:"Search students...",value:z,onChange:e=>B(e.target.value),className:"pl-8 bg-black/40 border-white/10 w-full"})]})]}),(0,t.jsx)(d.CardContent,{className:"p-0",children:(0,t.jsx)(o.DataTable,{data:O?V:W,isLoading:$,columns:O?[{key:"rollNumber",header:"Roll",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:e.rollNumber||(a??0)+1})},{key:"studentName",header:"Student Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.studentName}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.schoolId})]})},{key:"totalDays",header:"Total",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-mono",children:e.totalDays})},{key:"presentDays",header:"Present",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-bold text-emerald-400",children:e.presentDays})},{key:"percentage",header:"Attendance %",cellClassName:"text-center",render:e=>(0,t.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,t.jsxs)("span",{className:`font-bold ${75>Number(e.percentage)?"text-red-400":"text-emerald-400"}`,children:[e.percentage,"%"]}),(0,t.jsx)("div",{className:"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]",children:(0,t.jsx)("div",{className:`h-full ${75>Number(e.percentage)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${e.percentage}%`}})})]})},{key:"statsStatus",header:"Status",cellClassName:"text-right",render:e=>(0,t.jsx)(i.Badge,{variant:"outline",className:(0,j.cn)("text-[8px] uppercase font-black tracking-tighter",75>Number(e.percentage)?"text-red-400 border-red-500/30":"text-emerald-400 border-emerald-500/30"),children:75>Number(e.percentage)?"Low":"Good"})}]:[{key:"rollNumber",header:"Roll",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:e.rollNumber||(a??0)+1})},{key:"studentName",header:"Student Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.studentName}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.schoolId})]})},{key:"attendanceStatus",header:"Status",cellClassName:"text-center",render:e=>(0,t.jsx)(i.Badge,{className:(0,j.cn)("font-black uppercase tracking-tighter text-[9px]","P"===A[e.id]?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"),children:"P"===A[e.id]?"Present":"Absent"})},{key:"action",header:"Action",cellClassName:"text-right",render:e=>(0,t.jsx)(n.Button,{size:"sm",variant:"ghost",className:(0,j.cn)("h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg","P"===A[e.id]?"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white":"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white"),onClick:()=>{var t;return t=e.id,void(D(e=>({...e,[t]:"P"===e[t]?"A":"P"})),X(e=>{let a=new Set(e);return a.add(t),a}),M(!0))},children:"P"===A[e.id]?"Mark Absent":"Mark Present"})}]})})]}),!O&&(0,t.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:R?E?"You have unsaved changes.":`Attendance already marked by ${y?.uid==="admin"?"Admin":"Teacher"}`:"Ready to submit."}),(0,t.jsxs)(n.Button,{size:"lg",onClick:Q,disabled:P||R&&!E,className:"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]",children:[P?(0,t.jsx)(c.Loader2,{className:"w-5 h-5 animate-spin mr-2"}):(0,t.jsx)(x.Save,{className:"w-5 h-5 mr-2"}),R?"Update Attendance":"Submit Attendance"]})]})]})}e.s(["default",()=>v])},58294,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(72498),r=e.i(94919),l=e.i(32341),d=e.i(59141);e.i(36180);var n=e.i(98925),i=e.i(15288),o=e.i(19455),c=e.i(87486),h=e.i(31278),m=e.i(43531),x=e.i(37727),u=e.i(56909);let p=(0,e.i(75254).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var b=e.i(55436),f=e.i(3281),g=e.i(80691),w=e.i(93479),j=e.i(67489),v=e.i(69049),N=e.i(75157);function y({defaultDate:e}){let{user:r}=(0,l.useAuth)(),{branding:y}=(0,s.useMasterData)(),[S,k]=(0,a.useState)([]),[C,I]=(0,a.useState)({}),[A,D]=(0,a.useState)(!0),[$,T]=(0,a.useState)(!1),[P,L]=(0,a.useState)(!1),[R,F]=(0,a.useState)(!1),[E,M]=(0,a.useState)(new Set),[z,B]=(0,a.useState)({}),[O,_]=(0,a.useState)(""),[V,H]=(0,a.useState)(!1),[Y,U]=(0,a.useState)([]),[q,J]=(0,a.useState)("ALL"),G=e||new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{V?K():X()},[G,V,q]);let K=async()=>{D(!0);try{let e,t,a=(0,n.query)((0,n.collection)(d.db,"teachers"),(0,n.where)("status","==","ACTIVE")),s=(await (0,n.getDocs)(a)).docs.map(e=>({id:e.id,schoolId:e.data().schoolId||e.id,name:e.data().name})).sort((e,t)=>e.name.localeCompare(t.name)),r=new Date().getFullYear();"ALL"===q?(e=`TEACHERS_${r}-01-01`,t=`TEACHERS_${r}-12-31`):(e=`TEACHERS_${r}-${q}-01`,t=`TEACHERS_${r}-${q}-31`);let l=(0,n.query)((0,n.collection)(d.db,"attendance"),(0,n.where)((0,n.documentId)(),">=",e),(0,n.where)((0,n.documentId)(),"<=",t)),i=await (0,n.getDocs)(l),o={};i.docs.forEach(e=>{let t=e.data();t.records&&Object.entries(t.records).forEach(([e,t])=>{o[e]||(o[e]={total:0,present:0}),("P"===t||"A"===t)&&(o[e].total++,"P"===t&&o[e].present++)})});let c=s.map(e=>{let t=o[e.schoolId]||{total:0,present:0};return{...e,totalDays:t.total,presentDays:t.present,percentage:t.total>0?(t.present/t.total*100).toFixed(1):"0.0"}});U(c),k(s)}catch(e){console.error("Stats error",e),(0,g.toast)({title:"Error",description:"Failed to load stats",type:"error"})}finally{D(!1)}},X=async()=>{D(!0);try{let e=(0,n.query)((0,n.collection)(d.db,"teachers"),(0,n.where)("status","==","ACTIVE")),t=(await (0,n.getDocs)(e)).docs.map(e=>{let t=e.data();return{id:e.id,schoolId:t.schoolId||e.id,name:t.name,uid:t.uid}}).sort((e,t)=>e.name.localeCompare(t.name));k(t);let a=(0,n.query)((0,n.collection)(d.db,"leave_requests"),(0,n.where)("status","==","APPROVED")),s=await (0,n.getDocs)(a),r={},l={};t.forEach(e=>{e.uid&&(l[e.uid]=e.schoolId)}),s.forEach(e=>{let t=e.data();if(t.fromDate<=G&&t.toDate>=G){let e=l[t.teacherId];e&&(r[e]=!0)}}),B(r);let i=`TEACHERS_${G}`,o=await (0,n.getDoc)((0,n.doc)(d.db,"attendance",i));if(o.exists())L(!0),I(o.data().records||{});else{L(!1);let e={};t.forEach(t=>{let a=r[t.schoolId];e[t.schoolId]=a?"A":"P"}),I(e)}}catch(e){console.error(e),(0,g.toast)({title:"Error",description:"Failed to fetch data.",type:"error"})}finally{D(!1)}},Q=async()=>{T(!0);try{let e=await fetch("/api/admin/attendance/teachers/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:G,records:C,markedBy:r?.uid,markedByName:r?.displayName||"Admin",isModification:P,touchedIds:Array.from(E)})}),t=await e.json();if(!t.success)throw Error(t.error);(0,g.toast)({title:P?"Attendance Updated":"Attendance Submitted",description:`Updated ${t.changesCount||0} records.`,type:"success"}),L(!0),F(!1),M(new Set)}catch(e){console.error(e),(0,g.toast)({title:"Failed",description:e.message,type:"error"})}finally{T(!1)}},W=S.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())||e.schoolId.toLowerCase().includes(O.toLowerCase()));if(A)return(0,t.jsx)("div",{className:"p-10 flex justify-center",children:(0,t.jsx)(h.Loader2,{className:"animate-spin"})});let Z={total:S.length,present:Object.values(C).filter(e=>"P"===e).length,absent:Object.values(C).filter(e=>"A"===e).length};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Total Teachers"}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:Z.total})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500",children:(0,t.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-emerald-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Present"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-500",children:Z.present})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500",children:(0,t.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-red-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Absent"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-500",children:Z.absent})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500",children:(0,t.jsx)(x.X,{className:"w-5 h-5"})})]})})]}),(0,t.jsxs)(i.Card,{className:"bg-black/20 border-white/10",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center",children:[(0,t.jsxs)("div",{className:"flex flex-wrap bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2",children:[(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>H(!1),className:V?"text-muted-foreground hover:text-white":"bg-emerald-500/20 text-emerald-500",children:"Daily View"}),(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>H(!0),className:V?"bg-blue-500/20 text-blue-500":"text-muted-foreground hover:text-white",children:"Overall Stats"}),V&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(j.Select,{value:q,onValueChange:J,children:[(0,t.jsx)(j.SelectTrigger,{className:"w-[140px] h-8 bg-transparent border-white/10 text-xs",children:(0,t.jsx)(j.SelectValue,{placeholder:"Period"})}),(0,t.jsxs)(j.SelectContent,{className:"bg-slate-900 border-white/10",children:[(0,t.jsxs)(j.SelectItem,{value:"ALL",children:["Full Year ",new Date().getFullYear()]}),(0,t.jsx)(j.SelectItem,{value:"01",children:"January"}),(0,t.jsx)(j.SelectItem,{value:"02",children:"February"}),(0,t.jsx)(j.SelectItem,{value:"03",children:"March"}),(0,t.jsx)(j.SelectItem,{value:"04",children:"April"}),(0,t.jsx)(j.SelectItem,{value:"05",children:"May"}),(0,t.jsx)(j.SelectItem,{value:"06",children:"June"}),(0,t.jsx)(j.SelectItem,{value:"07",children:"July"}),(0,t.jsx)(j.SelectItem,{value:"08",children:"August"}),(0,t.jsx)(j.SelectItem,{value:"09",children:"September"}),(0,t.jsx)(j.SelectItem,{value:"10",children:"October"}),(0,t.jsx)(j.SelectItem,{value:"11",children:"November"}),(0,t.jsx)(j.SelectItem,{value:"12",children:"December"})]})]}),(0,t.jsxs)(o.Button,{size:"sm",variant:"outline",className:"h-8 border-white/10 hover:bg-white/5 gap-2 px-3",onClick:()=>{let e="ALL"===q?`Annual Report ${new Date().getFullYear()}`:`Monthly Report - ${new Date(2e3,Number(q)-1).toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,t=`
            <html>
            <head>
                <title>Teacher Attendance Report - ${e}</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }
                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                    .logo { height: 80px; width: auto; object-fit: contain; }
                    .header-text { text-align: left; }
                    h1 { margin: 0; font-size: 28px; }
                    .period { font-size: 14px; color: #666; margin-top: 2px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }
                    .text-center { text-align: center; }
                    .font-bold { font-weight: bold; }
                    .percentage { font-weight: bold; }
                    .low { color: #dc3545; }
                    .good { color: #28a745; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    ${y?.schoolLogo?`<img src="${y.schoolLogo}" class="logo" />`:""}
                    <div class="header-text">
                        <h1 style="margin: 0;">${y?.schoolName||"Attendance Report"}</h1>
                        <div class="period">Teacher Attendance - ${e}</div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Teacher Name</th>
                            <th class="text-center">ID</th>
                            <th class="text-center">Total Days</th>
                            <th class="text-center">Present</th>
                            <th class="text-center">Absents</th>
                            <th class="text-center">Attendance %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Y.map((e,t)=>`
                            <tr>
                                <td>${t+1}</td>
                                <td class="font-bold">${e.name}</td>
                                <td class="text-center">${e.schoolId}</td>
                                <td class="text-center">${e.totalDays}</td>
                                <td class="text-center" style="color: #28a745; font-weight: bold;">${e.presentDays}</td>
                                <td class="text-center">${e.totalDays-e.presentDays}</td>
                                <td class="text-center percentage ${80>Number(e.percentage)?"low":"good"}">${e.percentage}%</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <div class="footer">
                    <div>Generated on: ${new Date().toLocaleString()}</div>
                    <div>School Management System</div>
                </div>
                <script>
                    window.onload = () => {
                        window.print();
                        window.onafterprint = () => window.close();
                    };
                </script>
            </body>
            </html>
        `,a=window.open("","_blank");a?.document.write(t),a?.document.close()},children:[(0,t.jsx)(f.Printer,{className:"w-3 h-3"})," Print Report"]})]})]}),!V&&(0,t.jsxs)("div",{className:"relative flex-1 w-full md:max-w-xs",children:[(0,t.jsx)(b.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(w.Input,{placeholder:"Search teachers...",value:O,onChange:e=>_(e.target.value),className:"pl-8 bg-black/40 border-white/10 w-full"})]})]}),(0,t.jsx)(i.CardContent,{className:"p-0",children:(0,t.jsx)(v.DataTable,{data:V?Y:W,isLoading:A,columns:V?[{key:"index",header:"#",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:(a??0)+1})},{key:"name",header:"Teacher Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.schoolId})]})},{key:"totalDays",header:"Total",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-mono",children:e.totalDays})},{key:"presentDays",header:"Present",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-bold text-emerald-400",children:e.presentDays})},{key:"percentage",header:"Attendance %",cellClassName:"text-center",render:e=>(0,t.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,t.jsxs)("span",{className:`font-bold ${80>Number(e.percentage)?"text-red-400":"text-emerald-400"}`,children:[e.percentage,"%"]}),(0,t.jsx)("div",{className:"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]",children:(0,t.jsx)("div",{className:`h-full ${80>Number(e.percentage)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${e.percentage}%`}})})]})},{key:"leaves",header:"Leaves",cellClassName:"text-right",render:e=>(0,t.jsx)("span",{className:"text-white/40",children:e.totalDays-e.presentDays})}]:[{key:"index",header:"#",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:(a??0)+1})},{key:"name",header:"Teacher Name",render:e=>{let a=z[e.schoolId];return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium flex items-center gap-2 text-white",children:[e.name,a&&(0,t.jsxs)(c.Badge,{variant:"outline",className:"text-[8px] md:text-[10px] border-yellow-500/50 text-yellow-500 bg-yellow-500/10 gap-1 px-1 py-0 uppercase font-black",children:[(0,t.jsx)(p,{className:"w-3 h-3"})," Leave"]})]}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.schoolId})]})}},{key:"attendanceStatus",header:"Status",cellClassName:"text-center",render:e=>{let a=C[e.schoolId];return(0,t.jsx)(c.Badge,{className:(0,N.cn)("font-black uppercase tracking-tighter text-[9px]","P"===a?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"),children:"P"===a?"Present":"Absent"})}},{key:"action",header:"Action",cellClassName:"text-right",render:e=>{let a=C[e.schoolId];return(0,t.jsx)(o.Button,{size:"sm",variant:"ghost",className:(0,N.cn)("h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg","P"===a?"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white":"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white"),onClick:()=>{var t;return t=e.schoolId,void(I(e=>({...e,[t]:"P"===e[t]?"A":"P"})),M(e=>{let a=new Set(e);return a.add(t),a}),F(!0))},children:"P"===a?"Mark Absent":"Mark Present"})}}]})})]}),!V&&(0,t.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:P?R?"You have unsaved changes.":`Attendance already marked by ${r?.uid==="admin"?"Admin":"System"}`:"Ready to submit."}),(0,t.jsxs)(o.Button,{size:"lg",onClick:Q,disabled:$||P&&!R,className:"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]",children:[$?(0,t.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin mr-2"}):(0,t.jsx)(u.Save,{className:"w-5 h-5 mr-2"}),P?"Update Attendance":"Submit Attendance"]})]})]})}function S({defaultDate:e}){let{user:r}=(0,l.useAuth)(),{branding:p}=(0,s.useMasterData)(),[y,S]=(0,a.useState)([]),[k,C]=(0,a.useState)({}),[I,A]=(0,a.useState)(!0),[D,$]=(0,a.useState)(!1),[T,P]=(0,a.useState)(!1),[L,R]=(0,a.useState)(!1),[F,E]=(0,a.useState)(new Set),[M,z]=(0,a.useState)(""),[B,O]=(0,a.useState)(!1),[_,V]=(0,a.useState)([]),[H,Y]=(0,a.useState)("ALL"),U=e||new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{B?q():J()},[U,B,H]);let q=async()=>{A(!0);try{let e,t,a=(await (0,n.getDocs)((0,n.collection)(d.db,"staff"))).docs.map(e=>{let t=e.data();return{id:e.id,schoolId:e.id,name:t.name,role:t.roleName||"Staff"}}).sort((e,t)=>e.name.localeCompare(t.name)),s=new Date().getFullYear();"ALL"===H?(e=`STAFF_${s}-01-01`,t=`STAFF_${s}-12-31`):(e=`STAFF_${s}-${H}-01`,t=`STAFF_${s}-${H}-31`);let r=(0,n.query)((0,n.collection)(d.db,"attendance"),(0,n.where)((0,n.documentId)(),">=",e),(0,n.where)((0,n.documentId)(),"<=",t)),l=await (0,n.getDocs)(r),i={};l.docs.forEach(e=>{let t=e.data();t.records&&Object.entries(t.records).forEach(([e,t])=>{i[e]||(i[e]={total:0,present:0}),("P"===t||"A"===t)&&(i[e].total++,"P"===t&&i[e].present++)})});let o=a.map(e=>{let t=i[e.schoolId]||{total:0,present:0};return{...e,totalDays:t.total,presentDays:t.present,percentage:t.total>0?(t.present/t.total*100).toFixed(1):"0.0"}});V(o),S(a)}catch(e){console.error("Stats error",e),(0,g.toast)({title:"Error",description:"Failed to load stats",type:"error"})}finally{A(!1)}},J=async()=>{A(!0);try{let e=(await (0,n.getDocs)((0,n.collection)(d.db,"staff"))).docs.map(e=>{let t=e.data();return{id:e.id,schoolId:e.id,name:t.name,role:t.roleName||"Staff"}}).sort((e,t)=>e.name.localeCompare(t.name));S(e);let t=`STAFF_${U}`,a=await (0,n.getDoc)((0,n.doc)(d.db,"attendance",t));if(a.exists())P(!0),C(a.data().records||{});else{P(!1);let t={};e.forEach(e=>{t[e.schoolId]="P"}),C(t)}}catch(e){console.error(e),(0,g.toast)({title:"Error",description:"Failed to fetch data.",type:"error"})}finally{A(!1)}},G=async()=>{$(!0);try{let e=await fetch("/api/admin/attendance/staff/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:U,records:k,markedBy:r?.uid,markedByName:r?.displayName||"Admin",isModification:T,touchedIds:Array.from(F)})}),t=await e.json();if(!t.success)throw Error(t.error);(0,g.toast)({title:T?"Attendance Updated":"Attendance Submitted",description:`Updated ${t.changesCount||0} records.`,type:"success"}),P(!0),R(!1),E(new Set)}catch(e){console.error(e),(0,g.toast)({title:"Failed",description:e.message,type:"error"})}finally{$(!1)}},K=y.filter(e=>e.name.toLowerCase().includes(M.toLowerCase())||e.role.toLowerCase().includes(M.toLowerCase()));if(I)return(0,t.jsx)("div",{className:"p-10 flex justify-center",children:(0,t.jsx)(h.Loader2,{className:"animate-spin"})});let X={total:y.length,present:Object.values(k).filter(e=>"P"===e).length,absent:Object.values(k).filter(e=>"A"===e).length};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Total Staff"}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:X.total})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500",children:(0,t.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-emerald-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Present"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-500",children:X.present})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500",children:(0,t.jsx)(m.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-red-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Absent"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-500",children:X.absent})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500",children:(0,t.jsx)(x.X,{className:"w-5 h-5"})})]})})]}),(0,t.jsxs)(i.Card,{className:"bg-black/20 border-white/10",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center",children:[(0,t.jsxs)("div",{className:"flex flex-wrap bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2",children:[(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>O(!1),className:B?"text-muted-foreground hover:text-white":"bg-emerald-500/20 text-emerald-500",children:"Daily View"}),(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>O(!0),className:B?"bg-blue-500/20 text-blue-500":"text-muted-foreground hover:text-white",children:"Overall Stats"}),B&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(j.Select,{value:H,onValueChange:Y,children:[(0,t.jsx)(j.SelectTrigger,{className:"w-[140px] h-8 bg-transparent border-white/10 text-xs",children:(0,t.jsx)(j.SelectValue,{placeholder:"Period"})}),(0,t.jsxs)(j.SelectContent,{className:"bg-slate-900 border-white/10",children:[(0,t.jsxs)(j.SelectItem,{value:"ALL",children:["Full Year ",new Date().getFullYear()]}),(0,t.jsx)(j.SelectItem,{value:"01",children:"January"}),(0,t.jsx)(j.SelectItem,{value:"02",children:"February"}),(0,t.jsx)(j.SelectItem,{value:"03",children:"March"}),(0,t.jsx)(j.SelectItem,{value:"04",children:"April"}),(0,t.jsx)(j.SelectItem,{value:"05",children:"May"}),(0,t.jsx)(j.SelectItem,{value:"06",children:"June"}),(0,t.jsx)(j.SelectItem,{value:"07",children:"July"}),(0,t.jsx)(j.SelectItem,{value:"08",children:"August"}),(0,t.jsx)(j.SelectItem,{value:"09",children:"September"}),(0,t.jsx)(j.SelectItem,{value:"10",children:"October"}),(0,t.jsx)(j.SelectItem,{value:"11",children:"November"}),(0,t.jsx)(j.SelectItem,{value:"12",children:"December"})]})]}),(0,t.jsxs)(o.Button,{size:"sm",variant:"outline",className:"h-8 border-white/10 hover:bg-white/5 gap-2 px-3",onClick:()=>{let e="ALL"===H?`Annual Report ${new Date().getFullYear()}`:`Monthly Report - ${new Date(2e3,Number(H)-1).toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,t=`
            <html>
            <head>
                <title>Staff Attendance Report - ${e}</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }
                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                    .logo { height: 80px; width: auto; object-fit: contain; }
                    .header-text { text-align: left; }
                    h1 { margin: 0; font-size: 28px; }
                    .period { font-size: 14px; color: #666; margin-top: 2px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }
                    .text-center { text-align: center; }
                    .font-bold { font-weight: bold; }
                    .percentage { font-weight: bold; }
                    .low { color: #dc3545; }
                    .good { color: #28a745; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    ${p?.schoolLogo?`<img src="${p.schoolLogo}" class="logo" />`:""}
                    <div class="header-text">
                        <h1 style="margin: 0;">${p?.schoolName||"Attendance Report"}</h1>
                        <div class="period">Staff Attendance - ${e}</div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">#</th>
                            <th>Staff Name</th>
                            <th>Role</th>
                            <th class="text-center">Total Days</th>
                            <th class="text-center">Present</th>
                            <th class="text-center">Absents</th>
                            <th class="text-center">Attendance %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${_.map((e,t)=>`
                            <tr>
                                <td>${t+1}</td>
                                <td class="font-bold">${e.name}</td>
                                <td>${e.role}</td>
                                <td class="text-center">${e.totalDays}</td>
                                <td class="text-center" style="color: #28a745; font-weight: bold;">${e.presentDays}</td>
                                <td class="text-center">${e.totalDays-e.presentDays}</td>
                                <td class="text-center percentage ${80>Number(e.percentage)?"low":"good"}">${e.percentage}%</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <div class="footer">
                    <div>Generated on: ${new Date().toLocaleString()}</div>
                    <div>School Management System</div>
                </div>
                <script>
                    window.onload = () => {
                        window.print();
                        window.onafterprint = () => window.close();
                    };
                </script>
            </body>
            </html>
        `,a=window.open("","_blank");a?.document.write(t),a?.document.close()},children:[(0,t.jsx)(f.Printer,{className:"w-3 h-3"})," Print Report"]})]})]}),!B&&(0,t.jsxs)("div",{className:"relative flex-1 w-full md:max-w-xs",children:[(0,t.jsx)(b.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(w.Input,{placeholder:"Search staff...",value:M,onChange:e=>z(e.target.value),className:"pl-8 bg-black/40 border-white/10 w-full"})]})]}),(0,t.jsx)(i.CardContent,{className:"p-0",children:(0,t.jsx)(v.DataTable,{data:B?_:K,isLoading:I,columns:B?[{key:"index",header:"#",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:(a??0)+1})},{key:"name",header:"Staff Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.role})]})},{key:"totalDays",header:"Total",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-mono",children:e.totalDays})},{key:"presentDays",header:"Present",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-bold text-emerald-400",children:e.presentDays})},{key:"percentage",header:"Attendance %",cellClassName:"text-center",render:e=>(0,t.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,t.jsxs)("span",{className:`font-bold ${80>Number(e.percentage)?"text-red-400":"text-emerald-400"}`,children:[e.percentage,"%"]}),(0,t.jsx)("div",{className:"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]",children:(0,t.jsx)("div",{className:`h-full ${80>Number(e.percentage)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${e.percentage}%`}})})]})},{key:"absents",header:"Absents",cellClassName:"text-right",render:e=>(0,t.jsx)("span",{className:"text-white/40",children:e.totalDays-e.presentDays})}]:[{key:"index",header:"#",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:(a??0)+1})},{key:"name",header:"Staff Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.role})]})},{key:"attendanceStatus",header:"Status",cellClassName:"text-center",render:e=>{let a=k[e.schoolId];return(0,t.jsx)(c.Badge,{className:(0,N.cn)("font-black uppercase tracking-tighter text-[9px]","P"===a?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"),children:"P"===a?"Present":"Absent"})}},{key:"action",header:"Action",cellClassName:"text-right",render:e=>{let a=k[e.schoolId];return(0,t.jsx)(o.Button,{size:"sm",variant:"ghost",className:(0,N.cn)("h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg","P"===a?"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white":"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white"),onClick:()=>{var t;return t=e.schoolId,void(C(e=>({...e,[t]:"P"===e[t]?"A":"P"})),E(e=>{let a=new Set(e);return a.add(t),a}),R(!0))},children:"P"===a?"Mark Absent":"Mark Present"})}}]})})]}),!B&&(0,t.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:T?L?"You have unsaved changes.":`Attendance already marked by ${r?.uid==="admin"?"Admin":"System"}`:"Ready to submit."}),(0,t.jsxs)(o.Button,{size:"lg",onClick:G,disabled:D||T&&!L,className:"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]",children:[D?(0,t.jsx)(h.Loader2,{className:"w-5 h-5 animate-spin mr-2"}):(0,t.jsx)(u.Save,{className:"w-5 h-5 mr-2"}),T?"Update Attendance":"Submit Attendance"]})]})]})}var k=e.i(77572);function C(){let{classes:e,classSections:l,sections:d}=(0,s.useMasterData)(),[n,o]=(0,a.useState)(""),[c,h]=(0,a.useState)(""),[m,x]=(0,a.useState)(new Date().toISOString().split("T")[0]),u=n?Object.values(l||{}).filter(e=>e.classId===n).map(e=>d[e.sectionId]).filter(Boolean):[];return(0,t.jsxs)("div",{className:"max-w-none p-0 space-y-6 animate-in fade-in",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 border-b border-white/10 pb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-display font-bold",children:"Attendance Management"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Mark or modify attendance for students and teachers."})]}),(0,t.jsxs)("div",{className:"w-full md:w-48 space-y-2",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground uppercase font-medium",children:"Select Date"}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:"bg-white/5 border border-white/10 rounded-md py-2 px-3 w-full text-white focus:outline-none focus:ring-1 focus:ring-emerald-500/50"})})]})]}),(0,t.jsxs)(k.Tabs,{defaultValue:"student",className:"w-full",children:[(0,t.jsxs)(k.TabsList,{className:"flex flex-wrap h-auto w-full md:grid md:grid-cols-3 md:w-full max-w-[600px] mb-6 bg-black/40 border border-white/10 gap-2 p-1",children:[(0,t.jsx)(k.TabsTrigger,{value:"student",className:"flex-1 min-w-[140px]",children:"Student Attendance"}),(0,t.jsx)(k.TabsTrigger,{value:"teacher",className:"flex-1 min-w-[140px]",children:"Teacher Attendance"}),(0,t.jsx)(k.TabsTrigger,{value:"staff",className:"flex-1 min-w-[140px]",children:"Staff Attendance"})]}),(0,t.jsxs)(k.TabsContent,{value:"student",className:"space-y-6",children:[(0,t.jsx)(i.Card,{className:"bg-black/20 border-white/10 p-4",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[(0,t.jsxs)("div",{className:"space-y-2 w-full md:w-48",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground uppercase",children:"Class"}),(0,t.jsxs)(j.Select,{value:n,onValueChange:e=>{o(e),h("")},children:[(0,t.jsx)(j.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(j.SelectValue,{placeholder:"Select Class"})}),(0,t.jsx)(j.SelectContent,{children:Object.values(e).map(e=>(0,t.jsx)(j.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2 w-full md:w-32",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground uppercase",children:"Section"}),(0,t.jsxs)(j.Select,{value:c,onValueChange:h,disabled:!n,children:[(0,t.jsx)(j.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,t.jsx)(j.SelectValue,{placeholder:"Sec"})}),(0,t.jsx)(j.SelectContent,{children:u.map(e=>(0,t.jsx)(j.SelectItem,{value:e.id,children:e.name},e.id))})]}),n&&0===u.length&&(0,t.jsx)("p",{className:"text-[10px] text-red-400",children:"No sections linked."})]})]})}),n&&c?(0,t.jsx)("div",{children:(0,t.jsx)(r.default,{classId:n,sectionId:c,defaultDate:m})},`${n}-${c}-${m}`):(0,t.jsx)("div",{className:"flex flex-col items-center justify-center p-20 border border-dashed border-white/10 rounded-xl bg-white/5",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Please select Class and Section to view student attendance."})})]}),(0,t.jsx)(k.TabsContent,{value:"teacher",children:(0,t.jsx)(y,{defaultDate:m})}),(0,t.jsx)(k.TabsContent,{value:"staff",children:(0,t.jsx)(S,{defaultDate:m})})]})]})}e.s(["default",()=>C],58294)}]);