(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=N[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function p(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return p(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return p(this,e,t,r,!1)};function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",m=0;m<f;)g+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return g}function v(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function I(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function E(e,t,r,n,s){return t*=1,r>>>=0,s||I(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function T(e,t,r,n,s){return t*=1,r>>>=0,s||I(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,C(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,C(x(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return C(x(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,C(A(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,C(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return T(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return T(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var _=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(_,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,g=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=g,a/=256,u-=8);e[r+f-g]|=128*m}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,98925,e=>{"use strict";var t,r,n,i,s,a,o,l,u,h,c,d,f,g,m=e.i(92953),p=e.i(8070),y=e.i(47167),w=e.i(67034),v=e.i(97427),b="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,I={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var n=function(){this.blockSize=-1};function i(){}function s(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}i.prototype=n.prototype,e.F=n.prototype,e.prototype=new i,e.prototype.constructor=e,e.D=function(e,t,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return n.prototype[t].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,n=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){s(this,n),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var o,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new a([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return p(h(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function g(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function p(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new a(r,~e.h).add(d)}function y(e,t){return e.add(p(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(g(t))throw Error("division by zero");if(g(e))return new v(c,c);if(m(e))return t=b(p(e),t),new v(p(t.g),p(t.h));if(m(t))return t=b(e,p(t)),new v(p(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=T(r,1),s=T(n,1);for(n=T(n,2),r=T(r,2);!g(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=T(n,1),r=T(r,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);m(a)||a.l(e)>0;)r-=n,a=(s=h(r)).j(t);g(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function E(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new a(r,e.h)}function T(e,t){let r=t>>5;t%=32;let n=e.g.length-r,i=[];for(let s=0;s<n;s++)i[s]=t>0?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new a(i,e.h)}(o=a.prototype).m=function(){if(m(this))return-p(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},o.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(g(this))return"0";if(m(this))return"-"+p(this).toString(e);let t=h(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(g(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},o.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return m(e=y(this,e))?-1:+!g(e)},o.abs=function(){return m(this)?p(this):this},o.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new a(r,-0x80000000&r[r.length-1]?-1:0)},o.j=function(e){if(g(this)||g(e))return c;if(m(this))return m(e)?p(this).j(p(e)):p(p(this).j(e));if(m(e))return p(this.j(p(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,w(r,2*n+2*t),r[2*n+2*t+1]+=i*o,w(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,w(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,w(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new a(r,0)},o.B=function(e){return b(this,e).h},o.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new a(r,this.h&e.h)},o.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new a(r,this.h|e.h)},o.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new a(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,r=I.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return p(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=h(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=h(Math.pow(r,s)),i=i.j(s).add(h(a))):i=(i=i.j(n)).add(h(a))}return i},t=I.Integer=a}).apply(void 0!==b?b:"u">typeof self?self:"u">typeof window?window:{});var E=e.i(83877),T="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,_={};(function(){var e,t,r=Object.defineProperty,c=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof T&&T];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function d(e,t){if(t)e:{var n=c;e=e.split(".");for(var i=0;i<e.length-1;i++){var s=e[i];if(!(s in n))break e;n=n[s]}(t=t(i=n[e=e[e.length-1]]))!=i&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}d("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var f=f||{},g=this||self;function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function p(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=p).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var b="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function I(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,C=!1,D=new class{constructor(){this.h=this.g=null}add(e,t){let r=S.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},N=()=>{let e=Promise.resolve(void 0);A=()=>{e.then(k)}};function k(){let e;for(var t;e=null,D.g&&(e=D.g,D.g=D.g.next,D.g||(D.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){g.setTimeout(()=>{throw e},0)}(e)}S.j(t),S.h<100&&(S.h++,t.next=S.g,S.g=t)}C=!1}function R(){this.u=this.u,this.C=this.C}function M(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},M.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function L(e,t){M.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(L,M),L.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&L.Z.h.call(this)},L.prototype.h=function(){L.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),V=0;function U(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++V,this.da=this.fa=!1}function B(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function j(e){let t={};for(let r in e)t[r]=e[r];return t}let z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function G(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<z.length;t++)r=z[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function K(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(B(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function Q(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}K.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=Q(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new U(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),W={};function J(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=m(i)?!!i.capture:!!i,o=ee(e);if(o||(e[H]=o=new K(e)),(r=o.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Z.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)O||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(X(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=ee(t))?($(r,e),0==r.h&&(r.src=null,t[H]=null)):B(e)}}}function X(e){return e in W?W[e]:W[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new L(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Y(e),e=r.call(n,t)}return e}function ee(e){return(e=e[H])instanceof K?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function er(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function en(){R.call(this),this.i=new K(this),this.M=this,this.G=null}function ei(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new M(t,e);else if(t instanceof M)t.target=t.target||e;else{var a=t;G(t=new M(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=es(r=t.g=i[n],s,!0,t)&&a;if(a=es(r=t.g=e,s,!0,t)&&a,a=es(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=es(r=t.g=i[n],s,!1,t)&&a}function es(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}v(en,R),en.prototype[F]=!0,en.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=m(i)?!!i.capture:!!i,n=er(n),t&&t[F])?(t=t.i,(a=String(r).toString())in t.g&&(n=Q(r=t.g[a],n,i,s))>-1&&(B(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=ee(t))&&(r=t.g[r.toString()],t=-1,r&&(t=Q(r,n,i,s)),(n=t>-1?r[t]:null)&&Y(n))}(this,e,t,r,n)},en.prototype.N=function(){if(en.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)B(r[e]);delete e.g[t],e.h--}}this.G=null},en.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},en.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ea extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:g.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eo(e){R.call(this),this.h=e,this.g={}}v(eo,R);var el=[];function eu(e){q(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}eo.prototype.N=function(){eo.Z.N.call(this),eu(this)},eo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eh=g.JSON.stringify,ec=g.JSON.parse,ed=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function ef(){}function eg(){}var em={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){M.call(this,"d")}function ey(){M.call(this,"c")}v(ep,M),v(ey,M);var ew={},ev=null;function eb(){return ev=ev||new en}function eI(e){M.call(this,ew.Ia,e)}function eE(e){let t=eb();ei(t,new eI(t))}function eT(e,t){M.call(this,ew.STAT_EVENT,e),this.stat=t}function e_(e){let t=eb();ei(t,new eT(t,e))}function eS(e,t){M.call(this,ew.Ja,e),this.size=t}function ex(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eA(){this.g=!0}function eC(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return eh(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}ew.Ia="serverreachability",v(eI,M),ew.STAT_EVENT="statevent",v(eT,M),ew.Ja="timingevent",v(eS,M),eA.prototype.ua=function(){this.g=!1},eA.prototype.info=function(){};var eD={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eN={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ek(){}function eR(e){return encodeURIComponent(String(e))}function eM(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new eo(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eO}function eO(){this.i=null,this.g="",this.h=!1}v(ek,ef),ek.prototype.g=function(){return new XMLHttpRequest},e=new ek;var eP={},eL={};function eF(e,t,r){e.M=1,e.A=e4(e2(t)),e.u=r,e.R=!0,eV(e,null)}function eV(e,t){e.F=Date.now(),eB(e),e.B=e2(e.A);var r,n,i,s,a,o,l=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),tc(l.i,"t",u),e.C=0,l=e.j.L,e.h=new eO,e.g=tY(e.j,l?t:null,!e.u),e.P>0&&(e.O=new ea(y(e.Y,e,e.g),e.P)),t=e.V,l=e.g,u=e.ba;var h="readystatechange";Array.isArray(h)||(h&&(el[0]=h.toString()),h=el);for(let e=0;e<h.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=er(n),t&&t[F]?t.K(r,n,m(i)?!!i.capture:!!i,s):J(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=er(n),t&&t[F]?t.J(r,n,m(i)?!!i.capture:!!i,s):J(t,r,n,!1,i,s)}(l,h[e],u||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eE(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,o=e.u,r.info(function(){if(r.g)if(o){var e="",t=o.split("&");for(let r=0;r<t.length;r++){var l=t[r].split("=");if(l.length>1){let t=l[0];l=l[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eU(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eB(e){e.T=Date.now()+e.H,eq(e,e.H)}function eq(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ex(y(e.aa,e),t)}function ej(e){e.D&&(g.clearTimeout(e.D),e.D=null)}function ez(e){0==e.j.I||e.K||t$(e.j,e)}function eG(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eu(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eK(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eJ(r.h,e))){if(!e.L&&eJ(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tK(r),tP(r);else break e;tj(r),e_(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=ex(y(r.Va,r),6e3));1>=eW(r.h)&&r.ta&&(r.ta=void 0)}else tH(r,11)}else if((e.L||r.g==e)&&tK(r),!P(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eY(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e8(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tJ(n,n.L?n.ba:null,n.W),e.L){eX(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(ej(e),eB(e)),n.g=e}else tq(n);r.i.length>0&&tF(r)}else"stop"!=o[0]&&"close"!=o[0]||tH(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tH(r,7):tO(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eE(4)}catch(e){}}eM.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},eM.prototype.Y=function(e){try{if(e==this.g)e:{let d=tN(this.g),f=this.g.ya(),m=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=d||7==f||(8==f||m<=0?eE(3):eE(2)),ej(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eU(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let r="",n=t.length,i=4==tN(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return eG(e),ez(e),"";e.h.i=new g.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,a=this.l,o=this.S,n.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+o+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,a,o,l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(l)){var h=l;break t}}h=null}if(e=h)eC(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eK(this,e);else{this.o=!1,this.m=3,e_(12),eG(this),ez(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eL:isNaN(r=Number(t.substring(r,n)))?eP:(n+=1)+r>t.length?eL:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eL){4==d&&(this.m=4,e_(14),e=!1),eC(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eP){this.m=4,e_(15),eC(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eC(this.i,this.l,t,null),eK(this,t);if(eU(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=r.length||this.h.h||(this.m=1,e_(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.aa&&!c.P&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(c),c.P=!0,e_(11))}}else eC(this.i,this.l,r,"[Invalid Chunked Response]"),eG(this),ez(this)}else eC(this.i,this.l,r,null),eK(this,r);4==d&&eG(this),this.o&&!this.K&&(4==d?t$(this.j,this):(this.o=!1,eB(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(P(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,e_(12)):(this.m=0,e_(13)),eG(this),ez(this)}}}catch(e){}finally{}},eM.prototype.cancel=function(){this.K=!0,eG(this)},eM.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eE(),e_(17)),eG(this),this.m=2,ez(this)):eq(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eQ(e){this.l=e||10,e=g.PerformanceNavigationTiming?(e=g.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eH(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eW(e){return e.h?1:e.g?e.g.size:0}function eJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eY(e,t){e.g?e.g.add(t):e.h=t}function eX(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eZ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return I(e.i)}eQ.prototype.cancel=function(){if(this.i=eZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e1(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e1?(this.l=e.l,e5(this,e.j),this.o=e.o,this.g=e.g,e6(this,e.u),this.h=e.h,e3(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(e0))?(this.l=!1,e5(this,t[1]||"",!0),this.o=e7(t[2]||""),this.g=e7(t[3]||"",!0),e6(this,t[4]),this.h=e7(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e7(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e2(e){return new e1(e)}function e5(e,t,r){e.j=r?e7(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e6(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,r){var n,i;t instanceof ta?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(to(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(tl(this,t),tc(this,r,e))},n)),n.j=i):(r||(t=e9(t,ti)),e.i=new ta(t,e.l))}function e8(e,t,r){e.i.set(t,r)}function e4(e){return e8(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e7(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e9(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,te),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e1.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e9(t,tt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e9(t,tt,!0),"@"),e.push(eR(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e9(r,"/"==r.charAt(0)?tn:tr,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e9(r,ts)),e.join("")},e1.prototype.resolve=function(e){let t=e2(this),r=!!e.j;r?e5(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e6(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e3(t,td(e.i)):r=!!e.m,r&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tr=/[#\?:]/g,tn=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tl(e,t){to(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tu(e,t){return to(e),t=tf(e,t),e.g.has(t)}function th(e,t){to(e);let r=[];if("string"==typeof t)tu(e,t)&&(r=r.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tc(e,t,r){tl(e,t),r.length>0&&(e.i=null,e.g.set(tf(e,t),I(r)),e.h+=r.length)}function td(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tg(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tm(){this.g=new ed}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){en.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tw(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tI(e){let t="";return q(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tE(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tI(r),"string"==typeof e?null!=r&&eR(r):e8(e,t,r))}function tT(e){en.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tf(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tu(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=th(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eR(r);r=th(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eR(r[t])),e.push(n)}}return this.i=e.join("&")},v(tp,ef),tp.prototype.g=function(){return new ty(this.i,this.h)},v(ty,en),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||g).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tw(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tb(this),3==this.readyState&&tw(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tT,en);var t_=/^https?$/i,tS=["POST","PUT"];function tx(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tA(e),tD(e)}function tA(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tC(e){if(e.h&&void 0!==f){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(ei(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(e0)[1]||null;!t&&g.self&&g.self.location&&(t=g.self.location.protocol.slice(0,-1)),r=!t_.test(t?t.toLowerCase():"")}t=r}if(t)ei(e,"complete"),ei(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tA(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||ei(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tM(e){this.za=0,this.i=[],this.j=new eA,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eQ(e&&e.concurrentRequestLimit),this.Ba=new tm,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tO(e){if(tL(e),3==e.I){var t=e.V++,r=e2(e.J);if(e8(r,"SID",e.M),e8(r,"RID",t),e8(r,"TYPE","terminate"),tU(e,r),(t=new eM(e,e.j,t)).M=2,t.A=e4(e2(r)),r=!1,g.navigator&&g.navigator.sendBeacon)try{r=g.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&g.Image&&((new Image).src=t.A,r=!0),r||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eB(t)}tW(e)}function tP(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tL(e){tP(e),e.v&&(g.clearTimeout(e.v),e.v=null),tK(e),e.h.cancel(),e.m&&("number"==typeof e.m&&g.clearTimeout(e.m),e.m=null)}function tF(e){if(!eH(e.h)&&!e.m){e.m=!0;var t=e.Ea;A||N(),C||(A(),C=!0),D.add(t,e),e.D=0}}function tV(e,t){var r;r=t?t.l:e.V++;let n=e2(e.J);e8(n,"SID",e.M),e8(n,"RID",r),e8(n,"AID",e.K),tU(e,n),e.u&&e.o&&tE(n,e.u,e.o),r=new eM(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tB(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eY(e.h,r),eF(r,n,t)}function tU(e,t){e.H&&q(e.H,function(e,r){e8(t,r,e)}),e.l&&q({},function(e,r){e8(t,r,e)})}function tB(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let l=0;l<r;l++){var s=i[l].g;let r=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),o=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;m(r)&&(n=eh(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(o){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;A||N(),C||(A(),C=!0),D.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=ex(y(e.Da,e),tQ(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(g.clearTimeout(e.B),e.B=null)}function tG(e){e.g=new eM(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e2(e.na);e8(t,"RID","rpc"),e8(t,"SID",e.M),e8(t,"AID",e.K),e8(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e8(t,"TO",e.ia),e8(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&tE(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e4(e2(t)),r.u=null,r.R=!0,eV(r,e)}function tK(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function t$(e,t){var r,n=null;if(e.g==t){tK(e),tz(e),e.g=null;var i=2}else{if(!eJ(e.h,t))return;n=t.G,eX(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ei(i=eb(),new eS(i,n)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eW(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=ex(y(e.Ea,e,r),tQ(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tH(e,5);break;case 4:tH(e,10);break;case 3:tH(e,6);break;default:tH(e,2)}}}function tQ(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tH(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var r,n=y(e.bb,e),i=e.Ua;let o=!i;i=new e1(i||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||e5(i,"https"),e4(i),o?function(e,t){let r=new eA;if(g.Image){let n=new Image;n.onload=w(tg,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(tg,r,"TestLoadImage: error",!1,t,n),n.onabort=w(tg,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(tg,r,"TestLoadImage: timeout",!1,t,n),g.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eA,s=new AbortController,a=setTimeout(()=>{s.abort(),tg(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tg(t,"TestPingServer: ok",!0,n):tg(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(a),tg(t,"TestPingServer: error",!1,n)}))}else e_(2);e.I=0,e.l&&e.l.pa(t),tW(e),tL(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eZ(e.h);(0!=t.length||0!=e.i.length)&&(E(e.ja,t),E(e.ja,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,r){var n=r instanceof e1?e2(r):new e1(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e6(n,n.u);else{var i=g.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e1(null);n&&e5(e,n),t&&(e.g=t),i&&e6(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e8(n,r,t),e8(n,"VER",e.ka),tU(e,n),n}function tY(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tT(e.Aa&&!e.ma?new tp({ab:r}):e.ma)).Fa(e.L),t}function tX(){}function tZ(){}function t0(e,t){en.call(this),this.g=new tM(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!P(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){ey.call(this),this.status=1}function t5(e){this.g=e}(t=tT.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tx(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&t instanceof g.FormData,!(Array.prototype.indexOf.call(tS,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tx(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ei(this,"complete"),ei(this,"abort"),tD(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),tT.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tC(this):this.Xa())},t.Xa=function(){tC(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tM.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){e_(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tJ(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eM(this,this.j,e),s=this.o;if(this.U&&(s?G(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tB(this,i,t),e8(r=e2(this.J),"RID",e),e8(r,"CVER",22),this.G&&e8(r,"X-HTTP-Session-Id",this.G),tU(this,r),s&&(this.R?t="headers="+eR(tI(s))+"&"+t:this.u&&tE(r,this.u,s)),eY(this.h,i),this.Ra&&e8(r,"TYPE","init"),this.S?(e8(r,"$req",t),e8(r,"SID","null"),i.U=!0,eF(i,r,null)):eF(i,r,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eH(this.h)||tV(this))},t.Da=function(){if(this.v=null,tG(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ex(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,e_(10),tP(this),tG(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tj(this),e_(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),e_(2)):(this.j.info("Failed to ping google.com"),e_(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tX.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,en),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tO(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=eh(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tO(this.g),delete this.g,t0.Z.N.call(this)},v(t1,ep),v(t2,ey),v(t5,tX),t5.prototype.ra=function(){ei(this.g,"a")},t5.prototype.qa=function(e){ei(this.g,new t1(e))},t5.prototype.pa=function(e){ei(this.g,new t2)},t5.prototype.oa=function(){ei(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,h=_.createWebChannelTransport=function(){return new tZ},u=_.getStatEventTarget=function(){return eb()},l=_.Event=ew,o=_.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eD.NO_ERROR=0,eD.TIMEOUT=8,eD.HTTP_ERROR=6,a=_.ErrorCode=eD,eN.COMPLETE="complete",s=_.EventType=eN,eg.EventType=em,em.OPEN="a",em.CLOSE="b",em.ERROR="c",em.MESSAGE="d",en.prototype.listen=en.prototype.J,i=_.WebChannel=eg,_.FetchXmlHttpFactory=tp,tT.prototype.listenOnce=tT.prototype.K,tT.prototype.getLastError=tT.prototype.Ha,tT.prototype.getLastErrorCode=tT.prototype.ya,tT.prototype.getStatus=tT.prototype.ca,tT.prototype.getResponseJson=tT.prototype.La,tT.prototype.getResponseText=tT.prototype.la,tT.prototype.send=tT.prototype.ea,tT.prototype.setWithCredentials=tT.prototype.Fa,n=_.XhrIo=tT}).apply(void 0!==T?T:"u">typeof self?self:"u">typeof window?window:{});class S{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let x="12.9.0",A=new E.Logger("@firebase/firestore");function C(){return A.logLevel}function D(e){A.setLogLevel(e)}function N(e,...t){if(A.logLevel<=E.LogLevel.DEBUG){let r=t.map(M);A.debug(`Firestore (${x}): ${e}`,...r)}}function k(e,...t){if(A.logLevel<=E.LogLevel.ERROR){let r=t.map(M);A.error(`Firestore (${x}): ${e}`,...r)}}function R(e,...t){if(A.logLevel<=E.LogLevel.WARN){let r=t.map(M);A.warn(`Firestore (${x}): ${e}`,...r)}}function M(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function O(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,P(e,n,r)}function P(e,t,r){let n=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw k(n),Error(n)}function L(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||P(t,i,n)}function F(e,t){e||O(57014,t)}let V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends v.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class B{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class q{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class j{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(S.UNAUTHENTICATED))}shutdown(){}}class z{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class G{constructor(e){this.t=e,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){L(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new B;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new B,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new B)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(L("string"==typeof t.accessToken,31837,{l:t}),new q(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return L(null===e||"string"==typeof e,2055,{h:e}),new S(e)}}class K{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=S.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class ${constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new K(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(S.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Q{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class H{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,m._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){L(void 0===this.o,3512);let r=e=>{null!=e.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,N("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Q(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(L("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Q(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class W{getToken(){return Promise.resolve(new Q(""))}invalidateToken(){}start(e,t){}shutdown(){}}class J{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function Y(e,t){return e<t?-1:+(e>t)}function X(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return Z(r)===Z(i)?Y(r,i):Z(r)?1:-1}return Y(e.length,t.length)}function Z(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function ee(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let et="__name__";class er{constructor(e,t,r){void 0===t?t=0:t>e.length&&O(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&O(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===er.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof er?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=er.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return Y(e.length,t.length)}static compareSegments(e,t){let r=er.isNumericId(e),n=er.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?er.extractNumericId(e).compare(er.extractNumericId(t)):X(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class en extends er{construct(e,t,r){return new en(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new U(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new en(t)}static emptyPath(){return new en([])}}let ei=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class es extends er{construct(e,t,r){return new es(e,t,r)}static isValidIdentifier(e){return ei.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),es.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===et}static keyField(){return new es([et])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new U(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new U(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new U(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new U(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new es(t)}static emptyPath(){return new es([])}}class ea{constructor(e){this.path=e}static fromPath(e){return new ea(en.fromString(e))}static fromName(e){return new ea(en.fromString(e).popFirst(5))}static empty(){return new ea(en.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===en.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return en.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ea(new en(e.slice()))}}function eo(e,t,r){if(!r)throw new U(V.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function el(e,t,r,n){if(!0===t&&!0===n)throw new U(V.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function eu(e){if(!ea.isDocumentKey(e))throw new U(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function eh(e){if(ea.isDocumentKey(e))throw new U(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ec(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ed(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":O(12329,{type:typeof e})}function ef(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new U(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=ed(e);throw new U(V.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function eg(e,t){if(t<=0)throw new U(V.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function em(e,t){let r={typeString:e};return t&&(r.value=t),r}function ep(e,t){let r;if(!ec(e))throw new U(V.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new U(V.INVALID_ARGUMENT,r);return!0}class ey{static now(){return ey.fromMillis(Date.now())}static fromDate(e){return ey.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new ey(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new U(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new U(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Y(this.nanoseconds,e.nanoseconds):Y(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ey._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ep(e,ey._jsonSchema))return new ey(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ey._jsonSchemaVersion="firestore/timestamp/1.0",ey._jsonSchema={type:em("string",ey._jsonSchemaVersion),seconds:em("number"),nanoseconds:em("number")};class ew{static fromTimestamp(e){return new ew(e)}static min(){return new ew(new ey(0,0))}static max(){return new ew(new ey(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ev{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function eb(e){return e.fields.find(e=>2===e.kind)}function eI(e){return e.fields.filter(e=>2!==e.kind)}function eE(e,t){let r=Y(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=es.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:Y(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return Y(e.fields.length,t.fields.length)}ev.UNKNOWN_ID=-1;class eT{constructor(e,t){this.fieldPath=e,this.kind=t}}class e_{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new e_(0,eA.min())}}function eS(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new eA(ew.fromTimestamp(1e9===n?new ey(r+1,0):new ey(r,n)),ea.empty(),t)}function ex(e){return new eA(e.readTime,e.key,-1)}class eA{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new eA(ew.min(),ea.empty(),-1)}static max(){return new eA(ew.max(),ea.empty(),-1)}}function eC(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=ea.comparator(e.documentKey,t.documentKey))?r:Y(e.largestBatchId,t.largestBatchId)}let eD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ek(e){if(e.code!==V.FAILED_PRECONDITION||e.message!==eD)throw e;N("LocalStore","Unexpectedly lost primary lease")}class eR{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eR((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eR?t:eR.resolve(t)}catch(e){return eR.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eR.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eR.reject(t)}static resolve(e){return new eR((t,r)=>{t(e)})}static reject(e){return new eR((t,r)=>{r(e)})}static waitFor(e){return new eR((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=eR.resolve(!1);for(let r of e)t=t.next(e=>e?eR.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new eR((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new eR((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let eM="SimpleDb";class eO{static open(e,t,r,n){try{return new eO(t,e.transaction(n,r))}catch(e){throw new eV(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new B,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new eV(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=ez(t.target.error);this.S.reject(new eV(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(N(eM,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eB(this.transaction.objectStore(e))}}class eP{static delete(e){return N(eM,"Removing database:",e),eq((0,v.getGlobal)().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,v.isIndexedDBAvailable)())return!1;if(eP.F())return!0;let e=(0,v.getUA)(),t=eP.M(e),r=eL(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==y.default&&"YES"===y.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===eP.M((0,v.getUA)())&&k("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(N(eM,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new eV(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new U(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new U(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new eV(e,n))},n.onupgradeneeded=e=>{N(eM,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{N(eM,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=eO.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),eR.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(N(eM,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eL(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eF{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return eq(this.U.delete())}}class eV extends U{constructor(e,t){super(V.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eU(e){return"IndexedDbTransactionError"===e.name}class eB{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(N(eM,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(N(eM,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),eq(r)}add(e){return N(eM,"ADD",this.store.name,e,e),eq(this.store.add(e))}get(e){return eq(this.store.get(e)).next(t=>(void 0===t&&(t=null),N(eM,"GET",this.store.name,e,t),t))}delete(e){return N(eM,"DELETE",this.store.name,e),eq(this.store.delete(e))}count(){return N(eM,"COUNT",this.store.name),eq(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new eR((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new eR((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){N(eM,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new eR((r,n)=>{t.onerror=e=>{n(ez(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new eR((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new eF(i),a=t(i.primaryKey,i.value,s);if(a instanceof eR){let e=a.catch(e=>(s.done(),eR.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>eR.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function eq(e){return new eR((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(ez(e.target.error))}})}let ej=!1;function ez(e){let t=eP.M((0,v.getUA)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new U("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ej||(ej=!0,setTimeout(()=>{throw e},0)),e}}return e}let eG="IndexBackfiller";class eK{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){N(eG,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();N(eG,`Documents written: ${e}`)}catch(e){eU(e)?N(eG,"Ignoring IndexedDB error during index backfill: ",e):await ek(e)}await this.re(6e4)})}}class e${constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return eR.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return N(eG,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(N(eG,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=ex(t);eC(n,r)>0&&(r=n)}),new eA(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eQ{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function eH(e){return null==e}function eW(e){return 0===e&&1/e==-1/0}function eJ(e){return"number"==typeof e&&Number.isInteger(e)&&!eW(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function eY(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}eQ.ce=-1;function eX(e){let t=e.length;if(L(t>=2,64408,{path:e}),2===t)return L("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),en.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&O(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:O(61167,{path:e})}s=t+2}return new en(n)}let eZ="remoteDocuments",e0="owner",e1="owner",e2="mutationQueues",e5="mutations",e6="batchId",e3="userMutationsIndex",e8=["userId","batchId"],e4={},e7="documentMutations",e9="remoteDocumentsV14",te=["prefixPath","collectionGroup","readTime","documentId"],tt="documentKeyIndex",tr=["prefixPath","collectionGroup","documentId"],tn="collectionGroupIndex",ti=["collectionGroup","readTime","prefixPath","documentId"],ts="remoteDocumentGlobal",ta="remoteDocumentGlobalKey",to="targets",tl="queryTargetsIndex",tu=["canonicalId","targetId"],th="targetDocuments",tc=["targetId","path"],td="documentTargetsIndex",tf=["path","targetId"],tg="targetGlobalKey",tm="targetGlobal",tp="collectionParents",ty=["collectionId","parent"],tw="clientMetadata",tv="bundles",tb="namedQueries",tI="indexConfiguration",tE="collectionGroupIndex",tT="indexState",t_=["indexId","uid"],tS="sequenceNumberIndex",tx=["uid","sequenceNumber"],tA="indexEntries",tC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tD="documentKeyIndex",tN=["indexId","uid","orderedDocumentKey"],tk="documentOverlays",tR=["userId","collectionPath","documentId"],tM="collectionPathOverlayIndex",tO=["userId","collectionPath","largestBatchId"],tP="collectionGroupOverlayIndex",tL=["userId","collectionGroup","largestBatchId"],tF="globals",tV=[e2,e5,e7,eZ,to,e0,tm,th,tw,ts,tp,tv,tb],tU=[...tV,tk],tB=[e2,e5,e7,e9,to,e0,tm,th,tw,ts,tp,tv,tb,tk],tq=[...tB,tI,tT,tA],tj=[...tq,tF];class tz extends eN{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function tG(e,t){return eP.O(e.le,t)}function tK(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function t$(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function tQ(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function tH(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tW{constructor(e,t){this.comparator=e,this.root=t||tY.EMPTY}insert(e,t){return new tW(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tY.BLACK,null,null))}remove(e){return new tW(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tY.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tJ(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tJ(this.root,e,this.comparator,!1)}getReverseIterator(){return new tJ(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tJ(this.root,e,this.comparator,!0)}}class tJ{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tY{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:tY.RED,this.left=null!=n?n:tY.EMPTY,this.right=null!=i?i:tY.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new tY(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return tY.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return tY.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tY.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tY.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw O(27949);return e+ +!this.isRed()}}tY.EMPTY=null,tY.RED=!0,tY.BLACK=!1,tY.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new tY(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tX{constructor(e){this.comparator=e,this.data=new tW(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tZ(this.data.getIterator())}getIteratorFrom(e){return new tZ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof tX)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new tX(this.comparator);return t.data=e,t}}class tZ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function t0(e){return e.hasNext()?e.getNext():void 0}class t1{constructor(e){this.fields=e,e.sort(es.comparator)}static empty(){return new t1([])}unionWith(e){let t=new tX(es.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new t1(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ee(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class t2 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function t5(){return"u">typeof atob}class t6{constructor(e){this.binaryString=e}static fromBase64String(e){return new t6(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new t2("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new t6(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Y(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}t6.EMPTY_BYTE_STRING=new t6("");let t3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function t8(e){if(L(!!e,39018),"string"==typeof e){let t=0,r=t3.exec(e);if(L(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:t4(e.seconds),nanos:t4(e.nanos)}}function t4(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function t7(e){return"string"==typeof e?t6.fromBase64String(e):t6.fromUint8Array(e)}let t9="server_timestamp",re="__type__",rt="__previous_value__",rr="__local_write_time__";function rn(e){return(e?.mapValue?.fields||{})[re]?.stringValue===t9}function ri(e){let t=e.mapValue.fields[rt];return rn(t)?ri(t):t}function rs(e){let t=t8(e.mapValue.fields[rr].timestampValue);return new ey(t.seconds,t.nanos)}class ra{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let ro="(default)";class rl{constructor(e,t){this.projectId=e,this.database=t||ro}static empty(){return new rl("","")}get isDefaultDatabase(){return this.database===ro}isEqual(e){return e instanceof rl&&e.projectId===this.projectId&&e.database===this.database}}let ru="__type__",rh="__max__",rc={mapValue:{fields:{__type__:{stringValue:rh}}}},rd="__vector__",rf="value",rg={nullValue:"NULL_VALUE"};function rm(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rn(e)?4:rN(e)?0x1fffffffffffff:rC(e)?10:11:O(28295,{value:e})}function rp(e,t){if(e===t)return!0;let r=rm(e);if(r!==rm(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rs(e).isEqual(rs(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=t8(e.timestampValue),i=t8(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return t7(e.bytesValue).isEqual(t7(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return t4(e.geoPointValue.latitude)===t4(t.geoPointValue.latitude)&&t4(e.geoPointValue.longitude)===t4(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return t4(e.integerValue)===t4(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=t4(e.doubleValue),n=t4(t.doubleValue);return r===n?eW(r)===eW(n):isNaN(r)&&isNaN(n)}return!1;case 9:return ee(e.arrayValue.values||[],t.arrayValue.values||[],rp);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(tK(s)!==tK(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!rp(s[e],a[e])))return!1;return!0;default:return O(52216,{left:e})}}function ry(e,t){return void 0!==(e.values||[]).find(e=>rp(e,t))}function rw(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=rm(e),u=rm(t);if(l!==u)return Y(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return Y(e.booleanValue,t.booleanValue);case 2:let h,c;return h=t4(e.integerValue||e.doubleValue),h<(c=t4(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return rv(e.timestampValue,t.timestampValue);case 4:return rv(rs(e),rs(t));case 5:return X(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=t7(r),f=t7(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=Y(r[e],n[e]);if(0!==t)return t}return Y(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let g;return i=e.geoPointValue,s=t.geoPointValue,0!==(g=Y(t4(i.latitude),t4(s.latitude)))?g:Y(t4(i.longitude),t4(s.longitude));case 9:return rb(e.arrayValue,t.arrayValue);case 10:let m,p,y,w,v;return a=e.mapValue,o=t.mapValue,m=a.fields||{},p=o.fields||{},y=m[rf]?.arrayValue,w=p[rf]?.arrayValue,0!==(v=Y(y?.values?.length||0,w?.values?.length||0))?v:rb(y,w);case 11:return function(e,t){if(e===rc.mapValue&&t===rc.mapValue)return 0;if(e===rc.mapValue)return 1;if(t===rc.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=X(n[e],s[e]);if(0!==t)return t;let a=rw(r[n[e]],i[s[e]]);if(0!==a)return a}return Y(n.length,s.length)}(e.mapValue,t.mapValue);default:throw O(23264,{he:l})}}function rv(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Y(e,t);let r=t8(e),n=t8(t),i=Y(r.seconds,n.seconds);return 0!==i?i:Y(r.nanos,n.nanos)}function rb(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=rw(r[e],n[e]);if(t)return t}return Y(r.length,n.length)}function rI(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=t8(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?t7(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ea.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=rI(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${rI(e.fields[i])}`;return r+"}"}(e.mapValue):O(61005,{value:e})}function rE(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rT(e){return!!e&&"integerValue"in e}function r_(e){return!!e&&"arrayValue"in e}function rS(e){return!!e&&"nullValue"in e}function rx(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function rA(e){return!!e&&"mapValue"in e}function rC(e){return(e?.mapValue?.fields||{})[ru]?.stringValue===rd}function rD(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return t$(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=rD(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=rD(e.arrayValue.values[r]);return t}return{...e}}function rN(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rh}let rk={mapValue:{fields:{[ru]:{stringValue:rd},[rf]:{arrayValue:{}}}}};function rR(e,t){let r=rw(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function rM(e,t){let r=rw(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class rO{constructor(e){this.value=e}static empty(){return new rO({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!rA(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rD(t)}setAll(e){let t=es.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=rD(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());rA(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rp(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];rA(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(t$(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new rO(rD(this.value))}}class rP{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new rP(e,0,ew.min(),ew.min(),ew.min(),rO.empty(),0)}static newFoundDocument(e,t,r,n){return new rP(e,1,t,ew.min(),r,n,0)}static newNoDocument(e,t){return new rP(e,2,t,ew.min(),ew.min(),rO.empty(),0)}static newUnknownDocument(e,t){return new rP(e,3,t,ew.min(),ew.min(),rO.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ew.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rO.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rO.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ew.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rP&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rP(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rL{constructor(e,t){this.position=e,this.inclusive=t}}function rF(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?ea.comparator(ea.fromName(a.referenceValue),r.key):rw(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function rV(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!rp(e.position[r],t.position[r]))return!1;return!0}class rU{constructor(e,t="asc"){this.field=e,this.dir=t}}class rB{}class rq extends rB{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new rH(e,t,r):"array-contains"===t?new rX(e,r):"in"===t?new rZ(e,r):"not-in"===t?new r0(e,r):"array-contains-any"===t?new r1(e,r):new rq(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new rW(e,r):new rJ(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(rw(t,this.value)):null!==t&&rm(this.value)===rm(t)&&this.matchesComparison(rw(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rj extends rB{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new rj(e,t)}matches(e){return rz(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function rz(e){return"and"===e.op}function rG(e){return"or"===e.op}function rK(e){return r$(e)&&rz(e)}function r$(e){for(let t of e.filters)if(t instanceof rj)return!1;return!0}function rQ(e,t){let r=e.filters.concat(t);return rj.create(r,e.op)}class rH extends rq{constructor(e,t,r){super(e,t,r),this.key=ea.fromName(r.referenceValue)}matches(e){let t=ea.comparator(e.key,this.key);return this.matchesComparison(t)}}class rW extends rq{constructor(e,t){super(e,"in",t),this.keys=rY("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rJ extends rq{constructor(e,t){super(e,"not-in",t),this.keys=rY("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rY(e,t){return(t.arrayValue?.values||[]).map(e=>ea.fromName(e.referenceValue))}class rX extends rq{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return r_(t)&&ry(t.arrayValue,this.value)}}class rZ extends rq{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&ry(this.value.arrayValue,t)}}class r0 extends rq{constructor(e,t){super(e,"not-in",t)}matches(e){if(ry(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!ry(this.value.arrayValue,t)}}class r1 extends rq{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!r_(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ry(this.value.arrayValue,e))}}class r2{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function r5(e,t=null,r=[],n=[],i=null,s=null,a=null){return new r2(e,t,r,n,i,s,a)}function r6(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof rq)return t.field.canonicalString()+t.op.toString()+rI(t.value);if(rK(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),eH(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rI(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rI(e)).join(",")),e.Te=t}return e.Te}function r3(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof rq?r instanceof rq&&t.op===r.op&&t.field.isEqual(r.field)&&rp(t.value,r.value):t instanceof rj?r instanceof rj&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void O(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rV(e.startAt,t.startAt)&&rV(e.endAt,t.endAt)}function r8(e){return ea.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function r4(e,t){return e.filters.filter(e=>e instanceof rq&&e.field.isEqual(t))}function r7(e,t,r){let n=rg,i=!0;for(let r of r4(e,t)){let e=rg,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?rg:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?rE(rl.empty(),ea.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?rC(s)?rk:{mapValue:{}}:O(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=rg}0>rR({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>rR({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function r9(e,t,r){let n=rc,i=!0;for(let r of r4(e,t)){let e=rc,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?rE(rl.empty(),ea.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?rk:"mapValue"in s?rC(s)?{mapValue:{}}:rc:O(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rc}rM({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];rM({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class ne{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function nt(e){return new ne(e)}function nr(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function nn(e){return null!==e.collectionGroup}function ni(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new tX(es.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new rU(t,n))}),r.has(es.keyField().canonicalString())||e.Ie.push(new rU(es.keyField(),n))}return e.Ie}function ns(e){return e.Ee||(e.Ee=no(e,ni(e))),e.Ee}function na(e){return e.Re||(e.Re=no(e,e.explicitOrderBy)),e.Re}function no(e,t){if("F"===e.limitType)return r5(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rU(e.field,t)});let r=e.endAt?new rL(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new rL(e.startAt.position,e.startAt.inclusive):null;return r5(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function nl(e,t){let r=e.filters.concat([t]);return new ne(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function nu(e,t,r){return new ne(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function nh(e,t){return r3(ns(e),ns(t))&&e.limitType===t.limitType}function nc(e){return`${r6(ns(e))}|lt:${e.limitType}`}function nd(e){var t;let r;return`Query(target=${r=(t=ns(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rq?`${t.field.canonicalString()} ${t.op} ${rI(t.value)}`:t instanceof rj?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),eH(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>rI(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>rI(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function nf(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):ea.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of ni(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=rF(i,ni(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=rF(s,ni(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function ng(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function nm(e){return(t,r)=>{let n=!1;for(let i of ni(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?ea.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?rw(i,s):O(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return O(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class np{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){t$(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return tH(this.inner)}size(){return this.innerSize}}let ny=new tW(ea.comparator),nw=new tW(ea.comparator);function nv(...e){let t=nw;for(let r of e)t=t.insert(r.key,r);return t}function nb(e){let t=nw;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function nI(){return new np(e=>e.toString(),(e,t)=>e.isEqual(t))}let nE=new tW(ea.comparator),nT=new tX(ea.comparator);function n_(...e){let t=nT;for(let r of e)t=t.add(r);return t}let nS=new tX(Y);function nx(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eW(t)?"-0":t}}function nA(e){return{integerValue:""+e}}function nC(e,t){return eJ(t)?nA(t):nx(e,t)}class nD{constructor(){this._=void 0}}function nN(e,t){return e instanceof nL?rT(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class nk extends nD{}class nR extends nD{constructor(e){super(),this.elements=e}}function nM(e,t){let r=nV(t);for(let t of e.elements)r.some(e=>rp(e,t))||r.push(t);return{arrayValue:{values:r}}}class nO extends nD{constructor(e){super(),this.elements=e}}function nP(e,t){let r=nV(t);for(let t of e.elements)r=r.filter(e=>!rp(e,t));return{arrayValue:{values:r}}}class nL extends nD{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function nF(e){return t4(e.integerValue||e.doubleValue)}function nV(e){return r_(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nU{constructor(e,t){this.field=e,this.transform=t}}class nB{constructor(e,t){this.version=e,this.transformResults=t}}class nq{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new nq}static exists(e){return new nq(void 0,e)}static updateTime(e){return new nq(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nj(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class nz{}function nG(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new nX(e.key,nq.none()):new nQ(e.key,e.data,nq.none());{let r=e.data,n=rO.empty(),i=new tX(es.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new nH(e.key,n,new t1(i.toArray()),nq.none())}}function nK(e,t,r,n){return e instanceof nQ?function(e,t,r,n){if(!nj(e.precondition,t))return r;let i=e.value.clone(),s=nY(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof nH?function(e,t,r,n){if(!nj(e.precondition,t))return r;let i=nY(e.fieldTransforms,n,t),s=t.data;return(s.setAll(nW(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):nj(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function n$(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&ee(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof nR&&n instanceof nR||r instanceof nO&&n instanceof nO?ee(r.elements,n.elements,rp):r instanceof nL&&n instanceof nL?rp(r.Ae,n.Ae):r instanceof nk&&n instanceof nk)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class nQ extends nz{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class nH extends nz{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function nW(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function nJ(e,t,r){let n=new Map;L(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof nR?nM(o,l):o instanceof nO?nP(o,l):i))}return n}function nY(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof nk?(n=t,i={fields:{[re]:{stringValue:t9},[rr]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&rn(n)&&(n=ri(n)),n&&(i.fields[rt]=n),{mapValue:i}):e instanceof nR?nM(e,t):e instanceof nO?nP(e,t):(a=nF(s=nN(e,t))+nF(e.Ae),rT(s)&&rT(e.Ae)?nA(a):nx(e.serializer,a))}(e,s,t))}return n}class nX extends nz{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nZ extends nz{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class n0{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof nQ?(n=e.value.clone(),i=nJ(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof nH?function(e,t,r){if(!nj(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=nJ(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(nW(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=nK(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=nK(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=nI();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=nG(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(ew.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),n_())}isEqual(e){return this.batchId===e.batchId&&ee(this.mutations,e.mutations,(e,t)=>n$(e,t))&&ee(this.baseMutations,e.baseMutations,(e,t)=>n$(e,t))}}class n1{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){L(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=nE,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new n1(e,t,r,n)}}class n2{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class n5{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class n6{constructor(e,t){this.count=e,this.unchangedNames=t}}function n3(e){switch(e){case V.OK:return O(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return O(15467,{code:e})}}function n8(e){if(void 0===e)return k("GRPC error has no .code"),V.UNKNOWN;switch(e){case c.OK:return V.OK;case c.CANCELLED:return V.CANCELLED;case c.UNKNOWN:return V.UNKNOWN;case c.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case c.INTERNAL:return V.INTERNAL;case c.UNAVAILABLE:return V.UNAVAILABLE;case c.UNAUTHENTICATED:return V.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case c.NOT_FOUND:return V.NOT_FOUND;case c.ALREADY_EXISTS:return V.ALREADY_EXISTS;case c.PERMISSION_DENIED:return V.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case c.ABORTED:return V.ABORTED;case c.OUT_OF_RANGE:return V.OUT_OF_RANGE;case c.UNIMPLEMENTED:return V.UNIMPLEMENTED;case c.DATA_LOSS:return V.DATA_LOSS;default:return O(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let n4=null;function n7(){return new TextEncoder}let n9=new t([0xffffffff,0xffffffff],0);function ie(e){let t=n7().encode(e),n=new r;return n.update(t),new Uint8Array(n.digest())}function it(e){let r=new DataView(e.buffer),n=r.getUint32(0,!0),i=r.getUint32(4,!0),s=r.getUint32(8,!0),a=r.getUint32(12,!0);return[new t([n,i],0),new t([s,a],0)]}class ir{constructor(e,r,n){if(this.bitmap=e,this.padding=r,this.hashCount=n,r<0||r>=8)throw new ii(`Invalid padding: ${r}`);if(n<0||e.length>0&&0===this.hashCount)throw new ii(`Invalid hash count: ${n}`);if(0===e.length&&0!==r)throw new ii(`Invalid padding when bitmap length is 0: ${r}`);this.ge=8*e.length-r,this.pe=t.fromNumber(this.ge)}ye(e,r,n){let i=e.add(r.multiply(t.fromNumber(n)));return 1===i.compare(n9)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=it(ie(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new ir(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=it(ie(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ii extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class is{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,ia.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new is(ew.min(),n,new tW(Y),ny,n_())}}class ia{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ia(r,t,n_(),n_(),n_())}}class io{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class il{constructor(e,t){this.targetId=e,this.Ce=t}}class iu{constructor(e,t,r=t6.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class ih{constructor(){this.ve=0,this.Fe=ig(),this.Me=t6.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=n_(),t=n_(),r=n_();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:O(38017,{changeType:i})}}),new ia(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=ig()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,L(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class ic{constructor(e){this.Ge=e,this.ze=new Map,this.je=ny,this.He=id(),this.Je=id(),this.Ze=new tW(Y)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:O(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(r8(a))if(0===r){let e=new ea(a.path);this.et(t,e,rP.newNoDocument(e,ew.min()))}else L(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),n4?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=t7(i).toUint8Array()}catch(e){if(e instanceof t2)return R("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new ir(t,s,a)}catch(e){return R(e instanceof ii?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&r8(i.target)){let t=new ea(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,rP.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=n_();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new is(e,t,this.Ze,this.je,r);return this.je=ny,this.He=id(),this.Je=id(),this.Ze=new tW(Y),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new ih,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new tX(Y),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new tX(Y),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ih),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function id(){return new tW(ea.comparator)}function ig(){return new tW(ea.comparator)}let im={asc:"ASCENDING",desc:"DESCENDING"},ip={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iy={and:"AND",or:"OR"};class iw{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iv(e,t){return e.useProto3Json||eH(t)?t:{value:t}}function ib(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iI(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function iE(e){let t;return L(!!e,49232),ew.fromTimestamp(new ey((t=t8(e)).seconds,t.nanos))}function iT(e,t){return i_(e,t).canonicalString()}function i_(e,t){let r=new en(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function iS(e){let t=en.fromString(e);return L(ij(t),10190,{key:t.toString()}),t}function ix(e,t){return iT(e.databaseId,t.path)}function iA(e,t){let r=iS(t);if(r.get(1)!==e.databaseId.projectId)throw new U(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new U(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new ea(ik(r))}function iC(e,t){return iT(e.databaseId,t)}function iD(e){let t=iS(e);return 4===t.length?en.emptyPath():ik(t)}function iN(e){return new en(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ik(e){return L(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iR(e,t,r){return{name:ix(e,t),fields:r.value.mapValue.fields}}function iM(e,t,r){let n=iA(e,t.name),i=iE(t.updateTime),s=t.createTime?iE(t.createTime):ew.min(),a=new rO({mapValue:{fields:t.fields}}),o=rP.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function iO(e,t){var r,n;let i;if(t instanceof nQ)i={update:iR(e,t.key,t.value)};else if(t instanceof nX)i={delete:ix(e,t.key)};else if(t instanceof nH){let r;i={update:iR(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof nZ))return O(16599,{dt:t.type});i={verify:ix(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof nk)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof nR)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof nO)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof nL)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw O(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:ib(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:O(27497)),i}function iP(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?nq.updateTime(iE(r.updateTime)):void 0!==r.exists?nq.exists(r.exists):nq.none():nq.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(L("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new nk):"appendMissingElements"in t?r=new nR(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new nO(t.removeAllFromArray.values||[]):"increment"in t?r=new nL(e,t.increment):O(16584,{proto:t}),new nU(es.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=iA(e,t.update.name),s=new rO({mapValue:{fields:t.update.fields}});return t.updateMask?new nH(r,s,new t1((t.updateMask.fieldPaths||[]).map(e=>es.fromServerFormat(e))),n,i):new nQ(r,s,n,i)}return t.delete?new nX(iA(e,t.delete),n):t.verify?new nZ(iA(e,t.verify),n):O(1463,{proto:t})}function iL(e,t){return{documents:[iC(e,t.path)]}}function iF(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=iC(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof rq?function(e){if("=="===e.op){if(rx(e.value))return{unaryFilter:{field:iB(e.field),op:"IS_NAN"}};if(rS(e.value))return{unaryFilter:{field:iB(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rx(e.value))return{unaryFilter:{field:iB(e.field),op:"IS_NOT_NAN"}};if(rS(e.value))return{unaryFilter:{field:iB(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iB(e.field),op:ip[e.op],value:e.value}}}(t):t instanceof rj?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:iy[r.op],filters:n}}:O(54877,{filter:t})}(rj.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:iB(e.field),direction:im[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iv(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function iV(e,t,r,n){let{ft:i,parent:s}=iF(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:iB(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:iB(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}function iU(e){var t,r,n;let i,s,a,o,l=iD(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){L(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iq(e.unaryFilter.field);return rq.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=iq(e.unaryFilter.field);return rq.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=iq(e.unaryFilter.field);return rq.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iq(e.unaryFilter.field);return rq.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}}(t):void 0!==t.fieldFilter?rq.create(iq(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rj.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return O(1026)}}(t.compositeFilter.op)):O(30097,{filter:t})}(u.where))instanceof rj&&rK(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new rU(iq(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=eH(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(r=u.startAt).before,m=new rL(r.values||[],a));let p=null;return u.endAt&&(o=!(n=u.endAt).before,p=new rL(n.values||[],o)),new ne(l,c,f,d,g,"F",m,p)}function iB(e){return{fieldPath:e.canonicalString()}}function iq(e){return es.fromServerFormat(e.fieldPath)}function ij(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function iz(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class iG{constructor(e,t,r,n,i=ew.min(),s=ew.min(),a=t6.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iG(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iG(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iG(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iK{constructor(e){this.yt=e}}function i$(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:iQ(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:ix(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:ib(i,t.version.toTimestamp()),createTime:ib(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:iH(t.version)};else{if(!t.isUnknownDocument())return O(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:iH(t.version)}}return n}function iQ(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iH(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iW(e){let t=new ey(e.seconds,e.nanoseconds);return ew.fromTimestamp(t)}function iJ(e,t){let r=(t.baseMutations||[]).map(t=>iP(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>iP(e.yt,t)),i=ey.fromMillis(t.localWriteTimeMs);return new n0(t.batchId,i,r,n)}function iY(e){var t;let r,n=iW(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?iW(e.lastLimboFreeSnapshotVersion):ew.min();return new iG(void 0!==e.query.documents?(L(1===(r=(t=e.query).documents.length),1966,{count:r}),ns(nt(iD(t.documents[0])))):ns(iU(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,t6.fromBase64String(e.resumeToken))}function iX(e,t){let r,n=iH(t.snapshotVersion),i=iH(t.lastLimboFreeSnapshotVersion);r=r8(t.target)?iL(e.yt,t.target):iF(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:r6(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function iZ(e){let t=iU({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?nu(t,t.limit,"L"):t}function i0(e,t){return new n2(t.largestBatchId,iP(e.yt,t.overlayMutation))}function i1(e,t){let r=t.path.lastSegment();return[e,eY(t.path.popLast()),r]}function i2(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:iH(n.readTime),documentKey:eY(n.documentKey.path),largestBatchId:n.largestBatchId}}class i5{getBundleMetadata(e,t){return tG(e,tv).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iW(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tG(e,tv).put({bundleId:t.id,createTime:iH(iE(t.createTime)),version:t.version})}getNamedQuery(e,t){return tG(e,tb).get(t).next(e=>{if(e)return{name:e.name,query:iZ(e.bundledQuery),readTime:iW(e.readTime)}})}saveNamedQuery(e,t){return tG(e,tb).put({name:t.name,readTime:iH(iE(t.readTime)),bundledQuery:t.bundledQuery})}}class i6{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new i6(e,t.uid||"")}getOverlay(e,t){return tG(e,tk).get(i1(this.userId,t)).next(e=>e?i0(this.serializer,e):null)}getOverlays(e,t){let r=nI();return eR.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new n2(t,i);n.push(this.bt(e,s))}),eR.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(eY(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(tG(e,tk).X(tM,n))}),eR.waitFor(i)}getOverlaysForCollection(e,t,r){let n=nI(),i=eY(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return tG(e,tk).H(tM,s).next(e=>{for(let t of e){let e=i0(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=nI(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return tG(e,tk).ee({index:tP,range:a},(e,t,r)=>{let a=i0(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return tG(e,tk).put(function(e,t,r){let[n,i,s]=i1(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:iO(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class i3{St(e){return tG(e,tF)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?t6.fromUint8Array(t):t6.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class i8{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(t4(e.integerValue));else if("doubleValue"in e){let r=t4(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),eW(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=t8(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(t7(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?rN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):rC(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):O(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[rf].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(t4(n)),this.Ot(rf,t),this.Ct(r[rf],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),ea.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function i4(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}i8.Wt=new i8;class i7{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=i4(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=i4(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class i9{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class se{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class st{constructor(){this.cn=new i7,this.ascending=new i9(this.cn),this.descending=new se(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class sr{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new sr(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:ss(this.Tn),directionalValue:ss(this.In),orderedDocumentKey:ss(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function sn(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=si(e.Tn,t.Tn))||0!==(r=si(e.In,t.In))?r:ea.comparator(e.Pn,t.Pn)}function si(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function ss(e){return(0,v.isSafariOrWebkit)()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function sa(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class so{constructor(e){for(const t of(this.Vn=new tX((e,t)=>es.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(L(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=eb(e);if(void 0!==t&&!this.pn(t))return!1;let r=eI(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new tX(es.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new eT(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new eT(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new eT(r.field,+("asc"!==r.dir))));return new ev(ev.UNKNOWN_ID,this.collectionId,t,e_.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function sl(e){return e instanceof rq}function su(e){return e instanceof rj&&rK(e)}function sh(e){return sl(e)||su(e)||function(e){if(e instanceof rj&&rG(e)){for(let t of e.getFilters())if(!sl(t)&&!su(t))return!1;return!0}return!1}(e)}function sc(e,t){return L(e instanceof rq||e instanceof rj,38388),L(t instanceof rq||t instanceof rj,25473),sf(e instanceof rq?t instanceof rq?rj.create([e,t],"and"):sd(e,t):t instanceof rq?sd(t,e):function(e,t){if(L(e.filters.length>0&&t.filters.length>0,48005),rz(e)&&rz(t))return rQ(e,t.getFilters());let r=rG(e)?e:t,n=rG(e)?t:e,i=r.filters.map(e=>sc(e,n));return rj.create(i,"or")}(e,t))}function sd(e,t){if(rz(t))return rQ(t,e.getFilters());{let r=t.filters.map(t=>sc(e,t));return rj.create(r,"or")}}function sf(e){if(L(e instanceof rq||e instanceof rj,11850),e instanceof rq)return e;let t=e.getFilters();if(1===t.length)return sf(t[0]);if(r$(e))return e;let r=t.map(e=>sf(e)),n=[];return r.forEach(t=>{t instanceof rq?n.push(t):t instanceof rj&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:rj.create(n,e.op)}class sg{constructor(){this.Sn=new sm}addToCollectionParentIndex(e,t){return this.Sn.add(t),eR.resolve()}getCollectionParents(e,t){return eR.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return eR.resolve()}deleteFieldIndex(e,t){return eR.resolve()}deleteAllFieldIndexes(e){return eR.resolve()}createTargetIndexes(e,t){return eR.resolve()}getDocumentsMatchingTarget(e,t){return eR.resolve(null)}getIndexType(e,t){return eR.resolve(0)}getFieldIndexes(e,t){return eR.resolve([])}getNextCollectionGroupToUpdate(e){return eR.resolve(null)}getMinOffset(e,t){return eR.resolve(eA.min())}getMinOffsetFromCollectionGroup(e,t){return eR.resolve(eA.min())}updateCollectionGroup(e,t,r){return eR.resolve()}updateIndexEntries(e,t){return eR.resolve()}}class sm{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new tX(en.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new tX(en.comparator)).toArray()}}let sp="IndexedDbIndexManager",sy=new Uint8Array(0);class sw{constructor(e,t){this.databaseId=t,this.Dn=new sm,this.Cn=new np(e=>r6(e),(e,t)=>r3(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:eY(n)};return tG(e,tp).put(i)}return eR.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tG(e,tp).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(eX(n.parent))}return r})}addFieldIndex(e,t){let r=tG(e,tI),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=tG(e,tT);return i.next(e=>{r.put(i2(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=tG(e,tI),n=tG(e,tT),i=tG(e,tA);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tG(e,tI),r=tG(e,tA),n=tG(e,tT);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return eR.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new so(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=tG(e,tA),n=!0,i=new Map;return eR.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=n_(),n=[];return eR.forEach(i,(i,s)=>{N(sp,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${r6(t)}`);let a=function(e,t){let r=eb(t);if(void 0===r)return null;for(let t of r4(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of eI(t))for(let t of r4(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of eI(t)){let t=0===i.kind?r7(e,i.fieldPath,e.startAt):r9(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new rL(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of eI(t)){let t=0===i.kind?r9(e,i.fieldPath,e.endAt):r7(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new rL(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return eR.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=ea.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return eR.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(L(t instanceof rq||t instanceof rj,34018),t instanceof rq)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=rj.create(r,t.op);return sh(n=sf(n))?n:(L(n instanceof rj,64498),L(rz(n),40251),L(n.filters.length>1,57927),n.filters.reduce((e,t)=>sc(e,t)))}(function e(t){if(L(t instanceof rq||t instanceof rj,20012),t instanceof rq){if(t instanceof rZ){let e=t.value.arrayValue?.values?.map(e=>rq.create(t.field,"==",e))||[];return rj.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return rj.create(r,t.op)}(e));return L(sh(t),7391),sl(t)||su(t)?[t]:t.getFilters()})(rj.create(e.filters,"and")).map(t=>r5(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):sy,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new sr(e,ea.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new sr(e,ea.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new so(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return eR.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new tX(es.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new st;for(let n of eI(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);i8.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new st;return i8.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new st;return i8.Wt.Dt(rE(this.databaseId,t),n.ln(0===(r=eI(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new st);let i=0;for(let s of eI(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&r_(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);i8.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new st;n.seed(r.un()),i8.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof rq&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=tG(e,tI),n=tG(e,tT);return(t?r.H(tE,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return eR.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new e_(r.sequenceNumber,new eA(iW(r.readTime),new ea(eX(r.documentKey)),r.largestBatchId)):e_.empty(),i=e.fields.map(([e,t])=>new eT(es.fromServerFormat(e),t)),new ev(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:Y(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=tG(e,tI),i=tG(e,tT);return this.Wn(e).next(e=>n.H(tE,IDBKeyRange.bound(t,t)).next(t=>eR.forEach(t,t=>i.put(i2(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return eR.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?eR.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),eR.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?eR.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return tG(e,tA).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return tG(e,tA).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=tG(e,tA),i=new tX(sn);return n.ee({index:tD,range:IDBKeyRange.only([r.indexId,this.uid,ss(this.Kn(r,t))])},(e,n)=>{i=i.add(new sr(r.indexId,t,sa(n.arrayValue),sa(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new tX(sn),n=this.kn(t,e);if(null==n)return r;let i=eb(t);if(null!=i){let s=e.data.field(i.fieldPath);if(r_(s))for(let i of s.arrayValue.values||[])r=r.add(new sr(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new sr(t.indexId,e.key,sy,n));return r}zn(e,t,r,n,i){N(sp,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=t0(s),l=t0(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=t0(a)):t?(i(o),o=t0(s)):(o=t0(s),l=t0(a))}}(n,i,sn,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),eR.waitFor(s)}Wn(e){let t=1;return tG(e,tT).ee({index:tS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>sn(e,t)).filter((e,t,r)=>!t||0!==sn(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=sn(i,e),s=sn(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,sy,ea.empty()),r=n[e+1].An(this.uid,sy,ea.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return sn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sv)}getMinOffset(e,t){return eR.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||O(44426))).next(sv)}}function sv(e){L(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>eC(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new eA(t.readTime,t.documentKey,r)}let sb={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sI{static withCacheSize(e){return new sI(e,sI.DEFAULT_COLLECTION_PERCENTILE,sI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function sE(e,t,r){let n=e.store(e5),i=e.store(e7),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{L(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,eY(h),c]);s.push(i.delete(n)),u.push(e.key)}return eR.waitFor(s).next(()=>u)}function sT(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw O(14731);t=e.noDocument}return JSON.stringify(t).length}sI.DEFAULT_COLLECTION_PERCENTILE=10,sI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sI.DEFAULT=new sI(0x2800000,sI.DEFAULT_COLLECTION_PERCENTILE,sI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sI.DISABLED=new sI(-1,0,0);class s_{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return L(""!==e.uid,64387),new s_(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sx(e).ee({index:e3,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=tG(e,e7),s=sx(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;L("number"==typeof a,49019);let f=new n0(a,t,r,n),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>iO(o.yt,e)),d=f.mutations.map(e=>iO(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],p=new tX((e,t)=>Y(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,eY(h),a]);p=p.add(e.key.path.popLast()),m.push(s.put(g)),m.push(i.put(t,e4))}return p.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),eR.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return sx(e).get(t).next(e=>e?(L(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),iJ(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?eR.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return sx(e).ee({index:e3,range:n},(e,t,n)=>{t.userId===this.userId&&(L(t.batchId>=r,47524,{Yn:r}),i=iJ(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return sx(e).ee({index:e3,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sx(e).H(e3,t).next(e=>e.map(e=>iJ(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,eY(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return tG(e,e7).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=eX(o);if(a===this.userId&&t.path.isEqual(u))return sx(e).get(l).next(e=>{if(!e)throw O(61480,{er:r,batchId:l});L(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(iJ(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tX(Y),n=[];return t.forEach(t=>{let i=[this.userId,eY(t.path)],s=IDBKeyRange.lowerBound(i),a=tG(e,e7).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=eX(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),eR.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,eY(r)],s=IDBKeyRange.lowerBound(i),a=new tX(Y);return tG(e,e7).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=eX(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(sx(e).get(t).next(e=>{if(null===e)throw O(35274,{batchId:t});L(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(iJ(this.serializer,e))}))}),eR.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return sE(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),eR.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eR.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return tG(e,e7).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=eX(e[1]);n.push(t)}else r.done()}).next(()=>{L(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return sS(e,this.userId,t)}ir(e){return tG(e,e2).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sS(e,t,r){let n=[t,eY(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return tG(e,e7).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function sx(e){return tG(e,e5)}class sA{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new sA(0)}static ar(){return new sA(-1)}}class sC{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new sA(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>ew.fromTimestamp(new ey(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tG(e,to).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(L(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return tG(e,to).ee((s,a)=>{let o=iY(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>eR.waitFor(i)).next(()=>n)}forEachTarget(e,t){return tG(e,to).ee((e,r)=>{t(iY(r))})}ur(e){return tG(e,tm).get(tg).next(e=>(L(null!==e,2888),e))}cr(e,t){return tG(e,tm).put(tg,t)}lr(e,t){return tG(e,to).put(iX(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=r6(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return tG(e,to).ee({range:n,index:tl},(e,r,n)=>{let s=iY(r);r3(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=sD(e);return t.forEach(t=>{let s=eY(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),eR.waitFor(n)}removeMatchingKeys(e,t,r){let n=sD(e);return eR.forEach(t,t=>{let i=eY(t.path);return eR.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=sD(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=sD(e),i=n_();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new ea(eX(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=eY(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return sD(e).ee({index:td,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return tG(e,to).get(t).next(e=>e?iY(e):null)}}function sD(e){return tG(e,th)}let sN="LruGarbageCollector";function sk([e,t],[r,n]){let i=Y(e,r);return 0===i?Y(t,n):i}class sR{constructor(e){this.Pr=e,this.buffer=new tX(sk),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sk(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sM{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){N(sN,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eU(e)?N(sN,"Ignoring IndexedDB error during garbage collection: ",e):await ek(e)}await this.Ar(3e5)})}}class sO{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eR.resolve(eQ.ce);let r=new sR(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),eR.resolve(sb)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sb):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),C()<=E.LogLevel.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),eR.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class sP{constructor(e,t){this.db=e,this.garbageCollector=new sO(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return sL(e,r)}removeReference(e,t,r){return sL(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return sL(e,t)}wr(e,t){let r;return r=!1,tG(e,e2).te(n=>sS(e,n,t).next(e=>(e&&(r=!0),eR.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,ew.min()),sD(e).delete([0,eY(s.path)])))});n.push(t)}}).next(()=>eR.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return sL(e,t)}yr(e,t){let r=sD(e),n,i=eQ.ce;return r.ee({index:td},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==eQ.ce&&t(new ea(eX(n)),i),i=a,n=s):i=eQ.ce}).next(()=>{i!==eQ.ce&&t(new ea(eX(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sL(e,t){var r;return sD(e).put((r=e.currentSequenceNumber,{targetId:0,path:eY(t.path),sequenceNumber:r}))}class sF{constructor(){this.changes=new np(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rP.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?eR.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return tG(e,e9).put(r)}removeEntry(e,t,r){let n;return tG(e,e9).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],iQ(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=rP.newInvalidDocument(t);return tG(e,e9).ee({index:tt,range:IDBKeyRange.only(sB(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:rP.newInvalidDocument(t)};return tG(e,e9).ee({index:tt,range:IDBKeyRange.only(sB(t))},(e,n)=>{r={document:this.Sr(t,n),size:sT(n)}}).next(()=>r)}getEntries(e,t){let r=ny;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=ny,n=new tW(ea.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,sT(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return eR.resolve();let n=new tX(sj);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(sB(n.first()),sB(n.last())),s=n.getIterator(),a=s.getNext();return tG(e,e9).ee({index:tt,range:i},(e,t,n)=>{let i=ea.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sj(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(sB(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),iQ(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tG(e,e9).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=ny;for(let i of e){let e=this.Sr(ea.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(nf(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=ny,s=sq(t,r),a=sq(t,eA.max());return tG(e,e9).ee({index:tn,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(ea.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new sU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tG(e,ts).get(ta).next(e=>(L(!!e,20021),e))}br(e,t){return tG(e,ts).put(ta,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=iM(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=ea.fromSegments(t.noDocument.path),r=iW(t.noDocument.readTime);n=rP.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return O(56709);{let e=ea.fromSegments(t.unknownDocument.path),r=iW(t.unknownDocument.version);n=rP.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new ey((r=t.readTime)[0],r[1]),ew.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ew.min())))return e}return rP.newInvalidDocument(e)}}class sU extends sF{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new np(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new tX((e,t)=>Y(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=i$(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=sT(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=i$(this.Mr.serializer,s.convertToNoDocument(ew.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),eR.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function sB(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sq(e,t){let r=t.documentKey.path.toArray();return[e,iQ(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function sj(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=Y(r[e],n[e]))return i;return(i=Y(r.length,n.length))||(i=Y(r[r.length-2],n[n.length-2]))||Y(r[r.length-1],n[n.length-1])}class sz{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sG{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&nK(r.mutation,e,t1.empty(),ey.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,n_()).next(()=>t))}getLocalViewOfDocuments(e,t,r=n_()){let n=nI();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=nv();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=nI();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n_()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=ny,s=nI(),a=nI();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof nH)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),nK(a.mutation,t,a.mutation.getFieldMask(),ey.now())):s.set(t.key,t1.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new sz(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=nI(),n=new tW((e,t)=>e-t),i=n_();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||t1.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||n_()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=nI();l.forEach(e=>{if(!i.has(e)){let n=nG(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eR.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return ea.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):nn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):eR.resolve(nI()),a=-1,o=i;return s.next(t=>eR.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?eR.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,n_())).next(e=>({batchId:a,changes:nb(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ea(t)).next(e=>{let t=nv();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=nv();return this.indexManager.getCollectionParents(e,i).next(a=>eR.forEach(a,a=>{let o=new ne(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,rP.newInvalidDocument(n)))});let r=nv();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&nK(s.mutation,n,t1.empty(),ey.now()),nf(t,n)&&(r=r.insert(e,n))}),r})}}class sK{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return eR.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:iE(t.createTime)}),eR.resolve()}getNamedQuery(e,t){return eR.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:iZ(t.bundledQuery),readTime:iE(t.readTime)}),eR.resolve()}}class s${constructor(){this.overlays=new tW(ea.comparator),this.Lr=new Map}getOverlay(e,t){return eR.resolve(this.overlays.get(t))}getOverlays(e,t){let r=nI();return eR.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),eR.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),eR.resolve()}getOverlaysForCollection(e,t,r){let n=nI(),i=t.length+1,s=new ea(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return eR.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new tW((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=nI(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=nI(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return eR.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new n2(t,r));let i=this.Lr.get(t);void 0===i&&(i=n_(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class sQ{constructor(){this.sessionToken=t6.EMPTY_BYTE_STRING}getSessionToken(e){return eR.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eR.resolve()}}class sH{constructor(){this.kr=new tX(sW.Kr),this.qr=new tX(sW.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new sW(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new sW(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new ea(new en([])),r=new sW(t,e),n=new sW(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new ea(new en([])),r=new sW(t,e),n=new sW(t,e+1),i=n_();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sW(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class sW{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return ea.comparator(e.key,t.key)||Y(e.Hr,t.Hr)}static Ur(e,t){return Y(e.Hr,t.Hr)||ea.comparator(e.key,t.key)}}class sJ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new tX(sW.Kr)}checkEmpty(e){return eR.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new n0(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new sW(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eR.resolve(s)}lookupMutationBatch(e,t){return eR.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return eR.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return eR.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return eR.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new sW(t,0),n=new sW(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),eR.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tX(Y);return t.forEach(e=>{let t=new sW(e,0),n=new sW(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),eR.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;ea.isDocumentKey(i)||(i=i.child(""));let s=new sW(new ea(i),0),a=new tX(Y);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),eR.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){L(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return eR.forEach(t.mutations,n=>{let i=new sW(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new sW(t,0),n=this.Jr.firstAfterOrEqual(r);return eR.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,eR.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sY{constructor(e){this.ti=e,this.docs=new tW(ea.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return eR.resolve(r?r.document.mutableCopy():rP.newInvalidDocument(t))}getEntries(e,t){let r=ny;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():rP.newInvalidDocument(e))}),eR.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=ny,s=t.path,a=new ea(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eC(ex(a),r)||(n.has(a.key)||nf(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eR.resolve(i)}getAllFromCollectionGroup(e,t,r,n){O(9500)}ni(e,t){return eR.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sX(this)}getSize(e){return eR.resolve(this.size)}}class sX extends sF{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),eR.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class sZ{constructor(e){this.persistence=e,this.ri=new np(e=>r6(e),r3),this.lastRemoteSnapshotVersion=ew.min(),this.highestTargetId=0,this.ii=0,this.si=new sH,this.targetCount=0,this.oi=sA._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),eR.resolve()}getLastRemoteSnapshotVersion(e){return eR.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eR.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),eR.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),eR.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new sA(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,eR.resolve()}updateTargetData(e,t){return this.lr(t),eR.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,eR.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),eR.waitFor(i).next(()=>n)}getTargetCount(e){return eR.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return eR.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),eR.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),eR.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),eR.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return eR.resolve(r)}containsKey(e,t){return eR.resolve(this.si.containsKey(t))}}class s0{constructor(e,t){this._i={},this.overlays={},this.ai=new eQ(0),this.ui=!1,this.ui=!0,this.ci=new sQ,this.referenceDelegate=e(this),this.li=new sZ(this),this.indexManager=new sg,this.remoteDocumentCache=new sY(e=>this.referenceDelegate.hi(e)),this.serializer=new iK(t),this.Pi=new sK(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new s$,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new sJ(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){N("MemoryPersistence","Starting transaction:",e);let n=new s1(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return eR.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class s1 extends eN{constructor(e){super(),this.currentSequenceNumber=e}}class s2{constructor(e){this.persistence=e,this.Ri=new sH,this.Ai=null}static Vi(e){return new s2(e)}get di(){if(this.Ai)return this.Ai;throw O(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),eR.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),eR.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),eR.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eR.forEach(this.di,r=>{let n=ea.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,ew.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return eR.or([()=>eR.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class s5{constructor(e,t){this.persistence=e,this.fi=new np(e=>eY(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sO(this,t)}static Vi(e,t){return new s5(e,t)}Ti(){}Ii(e){return eR.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return eR.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?eR.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,ew.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),eR.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),eR.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),eR.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),eR.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(rm(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=ri(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return t7(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,t$(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw O(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return eR.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return eR.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class s6{constructor(e){this.serializer=e}k(e,t,r,n){let i=new eO("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(e0),e.createObjectStore(e2,{keyPath:"userId"}),e.createObjectStore(e5,{keyPath:e6,autoIncrement:!0}).createIndex(e3,e8,{unique:!0}),e.createObjectStore(e7),s3(e),e.createObjectStore(eZ));let s=eR.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(th),e.deleteObjectStore(to),e.deleteObjectStore(tm),s3(e)),s=s.next(()=>{let e,t;return e=i.store(tm),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ew.min().toTimestamp(),targetCount:0},e.put(tg,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(e5).H().next(t=>{e.deleteObjectStore(e5),e.createObjectStore(e5,{keyPath:e6,autoIncrement:!0}).createIndex(e3,e8,{unique:!0});let r=i.store(e5),n=t.map(e=>r.put(e));return eR.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(tw,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(ts),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(tv,{keyPath:"bundleId"}),e.createObjectStore(tb,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(tk,{keyPath:tR})).createIndex(tM,tO,{unique:!1}),t.createIndex(tP,tL,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(e9,{keyPath:te})).createIndex(tt,tr),t.createIndex(tn,ti)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(eZ))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(tI,{keyPath:"indexId",autoIncrement:!0}).createIndex(tE,"collectionGroup",{unique:!1}),e.createObjectStore(tT,{keyPath:t_}).createIndex(tS,tx,{unique:!1}),e.createObjectStore(tA,{keyPath:tC}).createIndex(tD,tN,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(tT).clear()}).next(()=>{t.objectStore(tA).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(tF,{keyPath:"name"})})),r<18&&n>=18&&(0,v.isSafariOrWebkit)()&&(s=s.next(()=>{t.objectStore(tT).clear()}).next(()=>{t.objectStore(tA).clear()})),s}pi(e){let t=0;return e.store(eZ).ee((e,r)=>{t+=sT(r)}).next(()=>{let r={byteSize:t};return e.store(ts).put(ta,r)})}gi(e){let t=e.store(e2),r=e.store(e5);return t.H().next(t=>eR.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(e3,n).next(r=>eR.forEach(r,r=>{L(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=iJ(this.serializer,r);return sE(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(th),r=e.store(eZ);return e.store(tm).get(tg).next(e=>{let n=[];return r.ee((r,i)=>{let s=new en(r),a=[0,eY(s)];n.push(t.get(a).next(r=>r?eR.resolve():t.put({targetId:0,path:eY(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eR.waitFor(n))})}wi(e,t){e.createObjectStore(tp,{keyPath:ty});let r=t.store(tp),n=new sm,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:eY(n)})}};return t.store(eZ).ee({Y:!0},(e,t)=>i(new en(e).popLast())).next(()=>t.store(e7).ee({Y:!0},([e,t,r],n)=>i(eX(t).popLast())))}bi(e){let t=e.store(to);return t.ee((e,r)=>{let n=iY(r),i=iX(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(eZ),n=[];return r.ee((e,r)=>{let i=t.store(e9),s=(r.document?new ea(en.fromString(r.document.name).popFirst(5)):r.noDocument?ea.fromSegments(r.noDocument.path):r.unknownDocument?ea.fromSegments(r.unknownDocument.path):O(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>eR.waitFor(n))}Di(e,t){let r=t.store(e5),n=new sV(this.serializer),i=new s0(s2.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??n_();iJ(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),eR.forEach(r,(e,r)=>{let s=new S(r),a=i6.wt(this.serializer,s),o=i.getIndexManager(s);return new sG(n,s_.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new tz(t,eQ.ce),e).next()})})}}function s3(e){e.createObjectStore(th,{keyPath:tc}).createIndex(td,tf,{unique:!0}),e.createObjectStore(to,{keyPath:"targetId"}).createIndex(tl,tu,{unique:!0}),e.createObjectStore(tm)}let s8="IndexedDbPersistence",s4="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",s7="main";class s9{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!s9.v())throw new U(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sP(this,n),this.Ki=t+s7,this.serializer=new iK(o),this.qi=new eP(this.Ki,this.xi,new s6(this.serializer)),this.ci=new i3,this.li=new sC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sV(this.serializer),this.Pi=new i5,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&k(s8,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new U(V.FAILED_PRECONDITION,s4);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new eQ(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tG(e,tw).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(eU(e))return N(s8,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N(s8,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return tG(e,e0).get(e1).next(e=>eR.resolve(this.Xi(e)))}Yi(e){return tG(e,tw).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tG(e,tw);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return eR.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?eR.resolve(!0):tG(e,e0).get(e1).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new U(V.FAILED_PRECONDITION,s4);return!1}}return!(!this.networkEnabled||!this.inForeground)||tG(e,tw).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&N(s8,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[e0,tw],e=>{let t=new tz(e,eQ.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>tG(e,tw).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return s_.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new sw(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return i6.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;N(s8,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?tj:16===n||15===n?tq:14===n||13===n?tB:12===n?tU:11===n?tV:void O(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new tz(n,this.ai?this.ai.next():eQ.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw k(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new U(V.FAILED_PRECONDITION,eD);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return tG(e,e0).get(e1).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new U(V.FAILED_PRECONDITION,s4)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tG(e,e0).put(e1,t)}static v(){return eP.v()}Ji(e){let t=tG(e,e0);return t.get(e1).next(e=>this.Xi(e)?(N(s8,"Releasing primary lease."),t.delete(e1)):eR.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(k(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;(0,v.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return N(s8,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return k(s8,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){k("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ae(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class at{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=n_(),n=n_();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new at(e,t.fromCache,r,n)}}class ar{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class an{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(0,v.isSafari)()?8:eL((0,v.getUA)())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new ar;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(C()<=E.LogLevel.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",nd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),eR.resolve()):(C()<=E.LogLevel.DEBUG&&N("QueryEngine","Query:",nd(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(C()<=E.LogLevel.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",nd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ns(t))):eR.resolve())}gs(e,t){if(nr(t))return eR.resolve(null);let r=ns(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=ns(t=nu(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=n_(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,nu(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return nr(t)||n.isEqual(ew.min())?eR.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?eR.resolve(null):(C()<=E.LogLevel.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),nd(t)),this.Ds(e,s,t,eS(n,-1)).next(e=>e))})}bs(e,t){let r=new tX(nm(e));return t.forEach((t,n)=>{nf(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return C()<=E.LogLevel.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",nd(t)),this.fs.getDocumentsMatchingQuery(e,t,eA.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let ai="LocalStore";class as{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new tW(Y),this.Fs=new np(e=>r6(e),r3),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sG(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function aa(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=n_();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function ao(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function al(e,t,r){let n=n_(),i=n_();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=ny;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(ew.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):N(ai,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function au(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,eR.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new iG(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function ah(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!eU(e))throw e;N(ai,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function ac(e,t,r){let n=ew.min(),i=n_();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=ns(t),void 0!==(o=e.Fs.get(a))?eR.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:ew.min(),r?i:n_())).next(r=>(ag(e,ng(t),r),{documents:r,ks:i}))})}function ad(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function af(e,t){let r=e.Ms.get(t)||ew.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,eS(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(ag(e,t,r),r))}function ag(e,t,r){let n=e.Ms.get(t)||ew.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function am(e,t,r,n){let i=n_(),s=ny;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await au(e,ns(nt(en.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>al(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function ap(e,t,r=n_()){let n=await au(e,ns(iZ(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=iE(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(t6.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let ay="firestore_clients";function aw(e,t){return`${ay}_${e}_${t}`}let av="firestore_mutations";function ab(e,t,r){let n=`${av}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let aI="firestore_targets";function aE(e,t){return`${aI}_${e}_${t}`}let aT="SharedClientState";class a_{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new U(n.error.code,n.error.message)),s?new a_(e,t,n.state,i):(k(aT,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aS{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new U(r.error.code,r.error.message)),i?new aS(e,r.state,n):(k(aT,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ax{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=nS;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=eJ(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new ax(e,i):(k(aT,`Failed to parse client data for instance '${e}': ${t}`),null)}}class aA{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aA(t.clientId,t.onlineState):(k(aT,`Failed to parse online state: ${e}`),null)}}class aC{constructor(){this.activeTargetIds=nS}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class aD{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new tW(Y),this.started=!1,this.Zs=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=aw(this.persistenceKey,this.zs),this.Ys=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Js=this.Js.insert(this.zs,new aC),this.eo=RegExp(`^${ay}_${l}_([^_]*)$`),this.no=RegExp(`^${av}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${aI}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(aw(this.persistenceKey,e));if(t){let r=ax.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(aE(this.persistenceKey,e));if(t){let n=aS.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(aE(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return N(aT,"READ",e,t),t}setItem(e,t){N(aT,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){N(aT,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(N(aT,"EVENT",e.key,e.newValue),e.key===this.Xs)return void k("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=eQ.ce;if(null!=e)try{let r=JSON.parse(e);L("number"==typeof r,30636,{yo:e}),t=r}catch(e){k(aT,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eQ.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new a_(this.currentUser,e,t,r),i=ab(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=ab(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=aE(this.persistenceKey,e),i=new aS(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return ax.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return a_.$s(new S(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return aS.$s(r,t)}_o(e){return aA.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);N(aT,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=nS;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class aN{constructor(){this.vo=new aC,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new aC,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ak{Mo(e){}shutdown(){}}let aR="ConnectivityMonitor";class aM{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(N(aR,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(N(aR,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aO=null;function aP(){return null===aO?aO=0x10000000+Math.round(0x80000000*Math.random()):aO++,"0x"+aO.toString(16)}let aL="RestConnection",aF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class aV{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===ro?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=aP(),a=this.Qo(e,t.toUriEncodedString());N(aL,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=(0,v.isCloudWorkstation)(l);return this.zo(e,a,o,r,u).then(t=>(N(aL,`Received RPC '${e}' ${s}: `,t),t),t=>{throw R(aL,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+x,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=aF[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class aU{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let aB="WebChannelConnection",aq=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class aj extends aV{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){aj.c_||(aq(u(),l.STAT_EVENT,e=>{e.stat===o.PROXY?N(aB,"STAT_EVENT: detected buffering proxy"):e.stat===o.NOPROXY&&N(aB,"STAT_EVENT: detected no buffering proxy")}),aj.c_=!0)}zo(e,t,r,i,o){let l=aP();return new Promise((o,u)=>{let h=new n;h.setWithCredentials(!0),h.listenOnce(s.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case a.NO_ERROR:let t=h.getResponseJson();N(aB,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),o(t);break;case a.TIMEOUT:N(aB,`RPC '${e}' ${l} timed out`),u(new U(V.DEADLINE_EXCEEDED,"Request time out"));break;case a.HTTP_ERROR:let r=h.getStatus();if(N(aB,`RPC '${e}' ${l} failed with status:`,r,"response text:",h.getResponseText()),r>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(V).indexOf(e)>=0?e:V.UNKNOWN);u(new U(r,t.message))}else u(new U(V.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new U(V.UNAVAILABLE,"Connection failed."));break;default:O(9055,{l_:e,streamId:l,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{N(aB,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);N(aB,`RPC '${e}' ${l} sending request:`,i),h.send(t,"POST",c,r,15)})}T_(e,t,r){let n=aP(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let u=s.join("");N(aB,`Creating RPC '${e}' stream ${n}: ${u}`,o);let h=a.createWebChannel(u,o);this.I_(h);let d=!1,f=!1,g=new aU({Ho:t=>{f?N(aB,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(d||(N(aB,`Opening RPC '${e}' stream ${n} transport.`),h.open(),d=!0),N(aB,`RPC '${e}' stream ${n} sending:`,t),h.send(t))},Jo:()=>h.close()});return aq(h,i.EventType.OPEN,()=>{f||(N(aB,`RPC '${e}' stream ${n} transport opened.`),g.i_())}),aq(h,i.EventType.CLOSE,()=>{f||(f=!0,N(aB,`RPC '${e}' stream ${n} transport closed`),g.o_(),this.E_(h))}),aq(h,i.EventType.ERROR,t=>{f||(f=!0,R(aB,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),g.o_(new U(V.UNAVAILABLE,"The operation could not be completed")))}),aq(h,i.EventType.MESSAGE,t=>{if(!f){let r=t.data[0];L(!!r,16349);let i=r?.error||r[0]?.error;if(i){N(aB,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=c[e];if(void 0!==t)return n8(t)}(t),s=i.message;"NOT_FOUND"===t&&s.includes("database")&&s.includes("does not exist")&&s.includes(this.databaseId.database)&&R(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),void 0===r&&(r=V.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),f=!0,g.o_(new U(r,s)),h.close()}else N(aB,`RPC '${e}' stream ${n} received:`,r),g.__(r)}}),aj.u_(),setTimeout(()=>{g.s_()},0),g}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return h()}}function az(){return"u">typeof window?window:null}function aG(){return"u">typeof document?document:null}function aK(e){return new iw(e,!0)}aj.c_=!1;class a${constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&N("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let aQ="PersistentStream";class aH{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new a$(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(k(t.toString()),k("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new U(V.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return N(aQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(N(aQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aW extends aH{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:O(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(L(void 0===i||"string"==typeof i,58123),t6.fromBase64String(i||"")):(L(void 0===i||i instanceof w.Buffer||i instanceof Uint8Array,16193),t6.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new iu(s,a,o,l&&new U(void 0===l.code?V.UNKNOWN:n8(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=iA(e,n.document.name),s=iE(n.document.updateTime),a=n.document.createTime?iE(n.document.createTime):ew.min(),o=new rO({mapValue:{fields:n.document.fields}}),l=rP.newFoundDocument(i,s,a,o);r=new io(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=iA(e,n.document),s=n.readTime?iE(n.readTime):ew.min(),a=rP.newNoDocument(i,s);r=new io([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=iA(e,n.document);r=new io([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return O(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new n6(n,i);r=new il(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return ew.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?ew.min():t.readTime?iE(t.readTime):ew.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=iN(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=r8(n)?{documents:iL(e,n)}:{query:iF(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=iI(e,t.resumeToken);let n=iv(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(ew.min())>0){r.readTime=ib(e,t.snapshotVersion.toTimestamp());let n=iv(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=iN(this.serializer),t.removeTarget=e,this.K_(t)}}class aJ extends aH{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return L(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,L(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;L(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(L(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?iE(e.updateTime):iE(r)).isEqual(ew.min())&&(t=iE(r)),new nB(t,e.transformResults||[])})):[]),i=iE(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=iN(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>iO(this.serializer,e))};this.K_(t)}}class aY{}class aX extends aY{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new U(V.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,i_(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new U(V.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,i_(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new U(V.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class aZ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(k(t),this.aa=!1):N("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let a0="RemoteStore";class a1{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{oe(this)&&(N(a0,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await a5(e),e.Va.set("Unknown"),e.Ea.delete(4),await a2(e)}(this))})}),this.Va=new aZ(r,n)}}async function a2(e){if(oe(e))for(let t of e.Ra)await t(!0)}async function a5(e){for(let t of e.Ra)await t(!1)}function a6(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),a9(e)?a7(e):op(e).O_()&&a8(e,t))}function a3(e,t){let r=op(e);e.Ia.delete(t),r.O_()&&a4(e,t),0===e.Ia.size&&(r.O_()?r.L_():oe(e)&&e.Va.set("Unknown"))}function a8(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ew.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}op(e).Z_(t)}function a4(e,t){e.da.$e(t),op(e).X_(t)}function a7(e){e.da=new ic({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),op(e).start(),e.Va.ua()}function a9(e){return oe(e)&&!op(e).x_()&&e.Ia.size>0}function oe(e){return 0===e.Ea.size}async function ot(e){e.Va.set("Online")}async function or(e){e.Ia.forEach((t,r)=>{a8(e,t)})}async function on(e,t){e.da=void 0,a9(e)?(e.Va.ha(t),a7(e)):e.Va.set("Unknown")}async function oi(e,t,r){if(e.Va.set("Online"),t instanceof iu&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){N(a0,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await os(e,r)}else if(t instanceof io?e.da.Xe(t):t instanceof il?e.da.st(t):e.da.tt(t),!r.isEqual(ew.min()))try{let t,n=await ao(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(t6.EMPTY_BYTE_STRING,n.snapshotVersion)),a4(e,t);let i=new iG(n.target,t,r,n.sequenceNumber);a8(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){N(a0,"Failed to raise snapshot:",t),await os(e,t)}}async function os(e,t,r){if(!eU(t))throw t;e.Ea.add(1),await a5(e),e.Va.set("Offline"),r||(r=()=>ao(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{N(a0,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await a2(e)})}function oa(e,t){return t().catch(r=>os(e,r,t))}async function oo(e){var t;let r=oy(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;oe(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=oy(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await os(e,t)}ol(e)&&ou(e)}function ol(e){return oe(e)&&!oy(e).x_()&&e.Ta.length>0}function ou(e){oy(e).start()}async function oh(e){oy(e).ra()}async function oc(e){let t=oy(e);for(let r of e.Ta)t.ea(r.mutations)}async function od(e,t,r){let n=e.Ta.shift(),i=n1.from(n,t,r);await oa(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await oo(e)}async function of(e,t){t&&oy(e).Y_&&await async function(e,t){var r;if(n3(r=t.code)&&r!==V.ABORTED){let r=e.Ta.shift();oy(e).B_(),await oa(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await oo(e)}}(e,t),ol(e)&&ou(e)}async function og(e,t){e.asyncQueue.verifyOperationInProgress(),N(a0,"RemoteStore received new credentials");let r=oe(e);e.Ea.add(3),await a5(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await a2(e)}async function om(e,t){t?(e.Ea.delete(2),await a2(e)):t||(e.Ea.add(2),await a5(e),e.Va.set("Unknown"))}function op(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:ot.bind(null,e),Yo:or.bind(null,e),t_:on.bind(null,e),J_:oi.bind(null,e)},t.sa(),e.ma=new aW(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),a9(e)?a7(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function oy(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:oh.bind(null,e),t_:of.bind(null,e),ta:oc.bind(null,e),na:od.bind(null,e)},t.sa(),e.fa=new aJ(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await oo(e)):(await e.fa.stop(),e.Ta.length>0&&(N(a0,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ow{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new B,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new ow(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new U(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ov(e,t){if(k("AsyncQueue",`${t}: ${e}`),eU(e))return new U(V.UNAVAILABLE,`${t}: ${e}`);throw e}class ob{static emptySet(e){return new ob(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ea.comparator(t.key,r.key):(e,t)=>ea.comparator(e.key,t.key),this.keyedMap=nv(),this.sortedSet=new tW(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ob)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new ob;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class oI{constructor(){this.ga=new tW(ea.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):O(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class oE{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new oE(e,t,ob.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class oT{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class o_{constructor(){this.queries=oS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new U(V.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=oS(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function oS(){return new np(e=>nc(e),nh)}async function ox(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new oT,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=ov(r,`Initialization of query '${nd(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&oN(e)}async function oA(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function oC(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&oN(e)}function oD(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function oN(e){e.Ca.forEach(e=>{e.next()})}(g=f||(f={})).Ma="default",g.Cache="cache";class ok{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new oE(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=oE.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f.Cache}}class oR{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class oM{constructor(e){this.serializer=e}Ks(e){return iA(this.serializer,e)}qs(e){return e.metadata.exists?iM(this.serializer,e.document,!1):rP.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return iE(e)}}class oO{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=oP(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=en.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new oM(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||n_()).add(e);t.set(r,n)}}return t}async ja(e){let t=await am(e,new oM(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await ap(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function oP(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oL{constructor(e){this.key=e}}class oF{constructor(e){this.key=e}}class oV{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=n_(),this.mutatedKeys=n_(),this.eu=nm(e),this.tu=new ob(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new oI,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=nf(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new oE(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oI,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=n_(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new oF(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new oL(r))}),t}cu(e){this.Za=e.ks,this.Ya=n_();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return oE.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let oU="SyncEngine";class oB{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class oq{constructor(e){this.key=e,this.hu=!1}}class oj{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new np(e=>nc(e),nh),this.Iu=new Map,this.Eu=new Set,this.Ru=new tW(ea.comparator),this.Au=new Map,this.Vu=new sH,this.du={},this.mu=new Map,this.fu=sA.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function oz(e,t,r=!0){let n,i=lh(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await oK(i,t,r,!0),n}async function oG(e,t){let r=lh(e);await oK(r,t,!0,!1)}async function oK(e,t,r,n){let i,s=await au(e.localStore,ns(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await o$(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&a6(e.remoteStore,s),i}async function o$(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await ac(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return o8(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await ac(e.localStore,t,!0),a=new oV(t,s.ks),o=a.ru(s.documents),l=ia.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);o8(e,r,u.au);let h=new oB(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function oQ(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!nh(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await ah(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&a3(e.remoteStore,n.targetId),o6(e,n.targetId)}).catch(ek)):(o6(e,n.targetId),await ah(e.localStore,n.targetId,!0))}async function oH(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),a3(e.remoteStore,r.targetId))}async function oW(e,t,r){let n=lc(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=ey.now(),l=t.reduce((e,t)=>e.add(t.key),n_()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=ny,s=n_();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=nN(n.transform,e||null);null!=i&&(null===r&&(r=rO.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new nH(r.key,t,function e(t){let r=[];return t$(t.fields,(t,n)=>{let i=new es([t]);if(rA(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new t1(r)}(t.value.mapValue),nq.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:nb(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new tW(Y)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await o7(n,h.changes),await oo(n.remoteStore)}catch(t){let e=ov(t,"Failed to persist write");r.reject(e)}}async function oJ(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(t6.EMPTY_BYTE_STRING,ew.min()).withLastLimboFreeSnapshotVersion(ew.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=ny,l=n_();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(al(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(ew.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return eR.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(L(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?L(n.hu,14607):t.removedDocuments.size>0&&(L(n.hu,42227),n.hu=!1))}),await o7(e,s,t)}catch(e){await ek(e)}}function oY(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&oN(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function oX(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new tW(ea.comparator);r=r.insert(i,rP.newNoDocument(i,ew.min()));let n=n_().add(i),s=new is(ew.min(),new Map,new tW(Y),r,n);await oJ(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),o4(e)}else await ah(e.localStore,t,!1).then(()=>o6(e,t,r)).catch(ek)}async function oZ(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=eR.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);L(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=n_();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));o5(e,n,null),o2(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await o7(e,i)}catch(e){await ek(e)}}async function o0(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(L(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));o5(e,t,r),o2(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await o7(e,i)}catch(e){await ek(e)}}async function o1(e,t){var r;oe(e.remoteStore)||N(oU,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=await (r=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>r.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===n)return void t.resolve();let i=e.mu.get(n)||[];i.push(t),e.mu.set(n,i)}catch(r){let e=ov(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function o2(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function o5(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function o6(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||o3(e,t)})}function o3(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(a3(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),o4(e))}function o8(e,t,r){for(let n of r)n instanceof oL?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(N(oU,"New document in limbo: "+r),e.Eu.add(n),o4(e))}(e,n)):n instanceof oF?(N(oU,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||o3(e,n.key)):O(19791,{wu:n})}function o4(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new ea(en.fromString(t)),n=e.fu.next();e.Au.set(n,new oq(r)),e.Ru=e.Ru.insert(r,n),a6(e.remoteStore,new iG(ns(nt(r.path)),n,"TargetPurposeLimboResolution",eQ.ce))}}async function o7(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=at.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>eR.forEach(t,t=>eR.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>eR.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!eU(e))throw e;N(ai,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function o9(e,t){if(!e.currentUser.isEqual(t)){N(oU,"User change. New user:",t.toKey());let r=await aa(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new U(V.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await o7(e,r.Ns)}}function le(e,t){let r=e.Au.get(t);if(r&&r.hu)return n_().add(r.key);{let r=n_(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function lt(e,t){let r=await ac(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&o8(e,t.targetId,n.au),n}async function lr(e,t){return af(e.localStore,t).then(t=>o7(e,t))}async function ln(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):eR.resolve(null))));null!==o?("pending"===r?await oo(e.remoteStore):"acknowledged"===r||"rejected"===r?(o5(e,t,n||null),o2(e,t),s=e.localStore,s.mutationQueue.nr(t)):O(6720,"Unknown batchState",{bu:r}),await o7(e,o)):N(oU,"Cannot apply mutation batch with id: "+t)}async function li(e,t){if(lh(e),lc(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await ls(e,t.toArray());for(let t of(e.gu=!0,await om(e.remoteStore,!0),r))a6(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(o6(e,i),ah(e.localStore,i,!0))),a3(e.remoteStore,i)}),await r,await ls(e,t),e.Au.forEach((t,r)=>{a3(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new tW(ea.comparator),e.gu=!1,await om(e.remoteStore,!1)}}async function ls(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await au(e.localStore,ns(s[0])),s)){let t=e.Tu.get(r),n=await lt(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await ad(e.localStore,r);t=await au(e.localStore,n),await o$(e,la(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function la(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new ne(t,r,n,i,s,"F",e.startAt,e.endAt)}function lo(e){return e.localStore.persistence.hs()}async function ll(e,t,r,n){if(e.gu)return void N(oU,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await af(e.localStore,ng(i[0])),s=is.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,t6.EMPTY_BYTE_STRING);await o7(e,n,s);break}case"rejected":await ah(e.localStore,t,!0),o6(e,t,n);break;default:O(64155,r)}}async function lu(e,t,r){let n=lh(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){N(oU,"Adding an already active target "+e);continue}let t=await ad(n.localStore,e),r=await au(n.localStore,t);await o$(n,la(t),r.targetId,!1,r.resumeToken),a6(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await ah(n.localStore,e,!1).then(()=>{a3(n.remoteStore,e),o6(n,e)}).catch(ek)}}function lh(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=oJ.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=le.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oX.bind(null,e),e.Pu.J_=oC.bind(null,e.eventManager),e.Pu.yu=oD.bind(null,e.eventManager),e}function lc(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=oZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=o0.bind(null,e),e}class ld{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aK(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new an,new as(t,r,e.initialUser,this.serializer)}Cu(e){return new s0(s2.Vi,this.serializer)}Du(e){return new aN}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ld.provider={build:()=>new ld};class lf extends ld{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return L(this.persistence.referenceDelegate instanceof s5,46915),new sM(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?sI.withCacheSize(this.cacheSizeBytes):sI.DEFAULT;return new s0(e=>s5.Vi(e,t),this.serializer)}}class lg extends ld{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await lc(this.xu.syncEngine),await oo(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new an,new as(t,r,e.initialUser,this.serializer)}Fu(e,t){return new sM(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new e$(t,this.persistence);return new eK(e.asyncQueue,r)}Cu(e){let t=ae(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?sI.withCacheSize(this.cacheSizeBytes):sI.DEFAULT;return new s9(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,az(),aG(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new aN}}class lm extends lg{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof aD&&(this.sharedClientState.syncEngine={So:ln.bind(null,t),Do:ll.bind(null,t),Co:lu.bind(null,t),hs:lo.bind(null,t),bo:lr.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await li(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=az();if(!aD.v(t))throw new U(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=ae(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new aD(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class lp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oY(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=o9.bind(null,this.syncEngine),await om(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new o_}createDatastore(e){var t;let r=aK(e.databaseInfo.databaseId),n=new aj(e.databaseInfo);return t=e.authCredentials,new aX(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new a1(t,r,e.asyncQueue,e=>oY(this.syncEngine,e,0),aM.v()?new aM:new ak)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new oj(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){N(a0,"RemoteStore shutting down."),e.Ea.add(5),await a5(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function ly(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}lp.provider={build:()=>new lp};class lw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):k("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class lv{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new B,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new oR(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lb{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new oR(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new U(V.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class lI{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new U(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>ix(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,en.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(L(!!t.found,43571),t.found.name,t.found.updateTime,n=iA(r,t.found.name),s=iE(t.found.updateTime),a=t.found.createTime?iE(t.found.createTime):ew.min(),o=new rO({mapValue:{fields:t.found.fields}}),rP.newFoundDocument(n,s,a,o)):"missing"in t?(L(!!t.missing,3894),L(!!t.readTime,22933),l=iA(r,t.missing),u=iE(t.readTime),rP.newNoDocument(l,u)):O(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());L(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new nX(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=ea.fromPath(t);this.mutations.push(new nZ(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>iO(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,en.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw O(50498,{Gu:e.constructor.name});t=ew.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new U(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ew.min())?nq.exists(!1):nq.updateTime(t):nq.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ew.min()))throw new U(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return nq.updateTime(t)}return nq.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class lE{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new a$(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new lI(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!eH(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!n3(t)}return!1}}let lT="FirestoreClient";class l_{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=S.UNAUTHENTICATED,this.clientId=J.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{N(lT,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(N(lT,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new B;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=ov(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function lS(e,t){e.asyncQueue.verifyOperationInProgress(),N(lT,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await aa(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lx(e,t){e.asyncQueue.verifyOperationInProgress();let r=await lA(e);N(lT,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>og(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>og(t.remoteStore,r)),e._onlineComponents=t}async function lA(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){N(lT,"Using user provided OfflineComponentProvider");try{await lS(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===V.FAILED_PRECONDITION||t.code===V.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;R("Error using user provided cache. Falling back to memory cache: "+t),await lS(e,new ld)}}else N(lT,"Using default OfflineComponentProvider"),await lS(e,new lf(void 0));return e._offlineComponents}async function lC(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(N(lT,"Using user provided OnlineComponentProvider"),await lx(e,e._uninitializedComponentsProvider._online)):(N(lT,"Using default OnlineComponentProvider"),await lx(e,new lp))),e._onlineComponents}function lD(e){return lA(e).then(e=>e.persistence)}function lN(e){return lA(e).then(e=>e.localStore)}function lk(e){return lC(e).then(e=>e.remoteStore)}function lR(e){return lC(e).then(e=>e.syncEngine)}function lM(e){return lC(e).then(e=>e.datastore)}async function lO(e){let t=await lC(e),r=t.eventManager;return r.onListen=oz.bind(null,t.syncEngine),r.onUnlisten=oQ.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=oG.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=oH.bind(null,t.syncEngine),r}function lP(e,t,r={}){let n=new B;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lO(e),s=e.asyncQueue,a=new lw({next:e=>{a.Nu(),s.enqueueAndForget(()=>oA(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new U(V.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new U(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),ox(i,o=new ok(nt(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function lL(e,t,r={}){let n=new B;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lO(e),s=e.asyncQueue,o=new ok(t,a=new lw({next:e=>{a.Nu(),s.enqueueAndForget(()=>oA(i,o)),e.fromCache&&"server"===r.source?n.reject(new U(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),ox(i,o)}),n.promise}function lF(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let lV=new Map,lU="firestore.googleapis.com";class lB{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new U(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lU,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new U(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}el("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lF(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lq{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lB({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new U(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lB(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new j;switch(e.type){case"firstParty":return new $(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new U(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=lV.get(this))&&(N("ComponentProvider","Removing Datastore"),lV.delete(this),e.terminate()),Promise.resolve()}}function lj(e,t,r,n={}){e=ef(e,lq);let i=(0,v.isCloudWorkstation)(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&((0,v.pingServer)(`https://${o}`),(0,v.updateEmulatorBanner)("Firestore",!0)),s.host!==lU&&s.host!==o&&R("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!(0,v.deepEqual)(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=S.MOCK_USER;else{t=(0,v.createMockUserToken)(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new U(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new S(i)}e._authCredentials=new z(new q(t,r))}}class lz{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new lz(this.firestore,e,this._query)}}class lG{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lK(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lG(this.firestore,e,this._key)}toJSON(){return{type:lG._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ep(t,lG._jsonSchema))return new lG(e,r||null,new ea(en.fromString(t.referencePath)))}}lG._jsonSchemaVersion="firestore/documentReference/1.0",lG._jsonSchema={type:em("string",lG._jsonSchemaVersion),referencePath:em("string")};class lK extends lz{constructor(e,t,r){super(e,t,nt(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new lG(this.firestore,null,new ea(e))}withConverter(e){return new lK(this.firestore,e,this._path)}}function l$(e,t,...r){if(e=(0,v.getModularInstance)(e),eo("collection","path",t),e instanceof lq){let n=en.fromString(t,...r);return eh(n),new lK(e,null,n)}{if(!(e instanceof lG||e instanceof lK))throw new U(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(en.fromString(t,...r));return eh(n),new lK(e.firestore,null,n)}}function lQ(e,t){if(e=ef(e,lq),eo("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new U(V.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new lz(e,null,new ne(en.emptyPath(),t))}function lH(e,t,...r){if(e=(0,v.getModularInstance)(e),1==arguments.length&&(t=J.newId()),eo("doc","path",t),e instanceof lq){let n=en.fromString(t,...r);return eu(n),new lG(e,null,new ea(n))}{if(!(e instanceof lG||e instanceof lK))throw new U(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(en.fromString(t,...r));return eu(n),new lG(e.firestore,e instanceof lK?e.converter:null,new ea(n))}}function lW(e,t){return e=(0,v.getModularInstance)(e),t=(0,v.getModularInstance)(t),(e instanceof lG||e instanceof lK)&&(t instanceof lG||t instanceof lK)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function lJ(e,t){return e=(0,v.getModularInstance)(e),t=(0,v.getModularInstance)(t),e instanceof lz&&t instanceof lz&&e.firestore===t.firestore&&nh(e._query,t._query)&&e.converter===t.converter}let lY="AsyncQueue";class lX{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new a$(this,"async_queue_retry"),this._c=()=>{let e=aG();e&&N(lY,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=aG();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=aG();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new B;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!eU(e))throw e;N(lY,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,k("INTERNAL UNHANDLED ERROR: ",lZ(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=ow.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&O(47125,{Pc:lZ(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function lZ(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class l0{constructor(){this._progressObserver={},this._taskCompletionResolver=new B,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class l1 extends lq{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new lX,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lX(e),this._firestoreClient=void 0,await e}}}function l2(e,t,r){r||(r=ro);let n=(0,m._getProvider)(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r}),i=n.getOptions(r);if((0,v.deepEqual)(i,t))return e;throw new U(V.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new U(V.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new U(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&(0,v.isCloudWorkstation)(t.host)&&(0,v.pingServer)(t.host),n.initialize({options:t,instanceIdentifier:r})}function l5(e,t){let r="object"==typeof e?e:(0,m.getApp)(),n="string"==typeof e?e:t||ro,i=(0,m._getProvider)(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=(0,v.getDefaultEmulatorHostnameAndPort)("firestore");e&&lj(i,...e)}return i}function l6(e){if(e._terminated)throw new U(V.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||l3(e),e._firestoreClient}function l3(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new ra(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,lF(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new l_(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}function l8(e,t){R("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return l7(e,lp.provider,{build:e=>new lg(e,r.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function l4(e){R("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();l7(e,lp.provider,{build:e=>new lm(e,t.cacheSizeBytes)})}function l7(e,t,r){if((e=ef(e,l1))._firestoreClient||e._terminated)throw new U(V.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new U(V.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},l3(e)}function l9(e){if(e._initialized&&!e._terminated)throw new U(V.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new B;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!eP.v())return Promise.resolve();await eP.delete(e+s7)}(ae(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function ue(e){var t;let r;return t=l6(e=ef(e,l1)),r=new B,t.asyncQueue.enqueueAndForget(async()=>o1(await lR(t),r)),r.promise}function ut(e){var t;return(t=l6(e=ef(e,l1))).asyncQueue.enqueue(async()=>{let e=await lD(t),r=await lk(t);return e.setNetworkEnabled(!0),r.Ea.delete(0),a2(r)})}function ur(e){var t;return(t=l6(e=ef(e,l1))).asyncQueue.enqueue(async()=>{let e=await lD(t),r=await lk(t);return e.setNetworkEnabled(!1),async function(e){e.Ea.add(0),await a5(e),e.Va.set("Offline")}(r)})}function un(e){return(0,m._removeServiceInstance)(e.app,"firestore",e._databaseId.database),e._delete()}function ui(e,t){let r=l6(e=ef(e,l1)),n=new l0;return function(e,t,r,n){var i;let s=(i=aK(t),new lv(function(e,t){if(e instanceof Uint8Array)return ly(e,void 0);if(e instanceof ArrayBuffer)return ly(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?n7().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=iE(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(oP(a));let o=new oO(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await o7(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return R(oU,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await lR(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}function us(e,t){var r;return(r=l6(e=ef(e,l1)),r.asyncQueue.enqueue(async()=>{var e;return e=await lN(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new lz(e,null,t.query):null)}class ua{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ua(t6.fromBase64String(e))}catch(e){throw new U(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ua(t6.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ua._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ep(e,ua._jsonSchema))return ua.fromBase64String(e.bytes)}}ua._jsonSchemaVersion="firestore/bytes/1.0",ua._jsonSchema={type:em("string",ua._jsonSchemaVersion),bytes:em("string")};class uo{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new U(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new es(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function ul(){return new uo(et)}class uu{constructor(e){this._methodName=e}}class uh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Y(this._lat,e._lat)||Y(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:uh._jsonSchemaVersion}}static fromJSON(e){if(ep(e,uh._jsonSchema))return new uh(e.latitude,e.longitude)}}uh._jsonSchemaVersion="firestore/geoPoint/1.0",uh._jsonSchema={type:em("string",uh._jsonSchemaVersion),latitude:em("number"),longitude:em("number")};class uc{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:uc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ep(e,uc._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new uc(e.vectorValues);throw new U(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}uc._jsonSchemaVersion="firestore/vectorValue/1.0",uc._jsonSchema={type:em("string",uc._jsonSchemaVersion),vectorValues:em("object")};let ud=/^__.*__$/;class uf{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new nH(e,this.data,this.fieldMask,t,this.fieldTransforms):new nQ(e,this.data,t,this.fieldTransforms)}}class ug{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new nH(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function um(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{dataSource:e})}}class up{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new up({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return uL(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(um(this.dataSource)&&ud.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class uy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||aK(e)}createContext(e,t,r,n=!1){return new up({dataSource:e,methodName:t,targetDoc:r,path:es.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uw(e){let t=e._freezeSettings(),r=aK(e._databaseId);return new uy(e._databaseId,!!t.ignoreUndefinedProperties,r)}function uv(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);uR("Data must be an object, but it was:",l,n);let u=uN(n,l);if(s.merge)a=new t1(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=uM(t,n,r);if(!l.contains(i))throw new U(V.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);uF(e,i)||e.push(i)}a=new t1(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new uf(new rO(u),a,o)}class ub extends uu{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ub}}function uI(e,t,r){return new up({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class uE extends uu{_toFieldTransform(e){return new nU(e.path,new nk)}isEqual(e){return e instanceof uE}}class uT extends uu{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){let t=uI(this,e,!0),r=new nR(this.Ac.map(e=>uD(e,t)));return new nU(e.path,r)}isEqual(e){return e instanceof uT&&(0,v.deepEqual)(this.Ac,e.Ac)}}class u_ extends uu{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){let t=uI(this,e,!0),r=new nO(this.Ac.map(e=>uD(e,t)));return new nU(e.path,r)}isEqual(e){return e instanceof u_&&(0,v.deepEqual)(this.Ac,e.Ac)}}class uS extends uu{constructor(e,t){super(e),this.Vc=t}_toFieldTransform(e){let t=new nL(e.serializer,nC(e.serializer,this.Vc));return new nU(e.path,t)}isEqual(e){return e instanceof uS&&this.Vc===e.Vc}}function ux(e,t,r,n){let i=e.createContext(1,t,r);uR("Data must be an object, but it was:",i,n);let s=[],a=rO.empty();return t$(n,(e,n)=>{let o=uP(t,e,r);n=(0,v.getModularInstance)(n);let l=i.childContextForFieldPath(o);if(n instanceof ub)s.push(o);else{let e=uD(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new ug(a,new t1(s),i.fieldTransforms)}function uA(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[uM(t,n,r)],l=[i];if(s.length%2!=0)throw new U(V.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(uM(t,s[e])),l.push(s[e+1]);let u=[],h=rO.empty();for(let e=o.length-1;e>=0;--e)if(!uF(u,o[e])){let t=o[e],r=l[e];r=(0,v.getModularInstance)(r);let n=a.childContextForFieldPath(t);if(r instanceof ub)u.push(t);else{let e=uD(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new ug(h,new t1(u),a.fieldTransforms)}function uC(e,t,r,n=!1){return uD(r,e.createContext(n?4:3,t))}function uD(e,t){if(uk(e=(0,v.getModularInstance)(e)))return uR("Unsupported field value:",t,e),uN(e,t);if(e instanceof uu)return function(e,t){if(!um(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=uD(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){if(null===(e=(0,v.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return nC(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=ey.fromDate(e);return{timestampValue:ib(t.serializer,r)}}if(e instanceof ey){let r=new ey(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ib(t.serializer,r)}}if(e instanceof uh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ua)return{bytesValue:iI(t.serializer,e._byteString)};if(e instanceof lG){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:iT(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uc){var r;return{mapValue:{fields:{[ru]:{stringValue:rd},[rf]:{arrayValue:{values:((r=e)instanceof uc?r.toArray():r).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return nx(t.serializer,e)})}}}}}}if(iz(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${ed(e)}`)}(e,t)}function uN(e,t){let r={};return tH(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):t$(e,(e,n)=>{let i=uD(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function uk(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ey||e instanceof uh||e instanceof ua||e instanceof lG||e instanceof uu||e instanceof uc||iz(e))}function uR(e,t,r){if(!uk(r)||!ec(r)){let n=ed(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function uM(e,t,r){if((t=(0,v.getModularInstance)(t))instanceof uo)return t._internalPath;if("string"==typeof t)return uP(e,t);throw uL("Field path arguments must be of type string or ",e,!1,void 0,r)}let uO=RegExp("[~\\*/\\[\\]]");function uP(e,t,r){if(t.search(uO)>=0)throw uL(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new uo(...t.split("."))._internalPath}catch(n){throw uL(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function uL(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new U(V.INVALID_ARGUMENT,o+e+l)}function uF(e,t){return e.some(e=>e.isEqual(t))}class uV{convertValue(e,t="none"){switch(rm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return t4(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(t7(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw O(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return t$(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new uc(e.fields?.[rf].arrayValue?.values?.map(e=>t4(e.doubleValue)))}convertGeoPoint(e){return new uh(t4(e.latitude),t4(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=ri(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rs(e));default:return null}}convertTimestamp(e){let t=t8(e);return new ey(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=en.fromString(e);L(ij(r),9688,{name:e});let n=new rl(r.get(1),r.get(3)),i=new ea(r.popFirst(5));return n.isEqual(t)||k(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class uU extends uV{constructor(e){super(),this.firestore=e}convertBytes(e){return new ua(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lG(this.firestore,null,t)}}function uB(){return new ub("deleteField")}function uq(){return new uE("serverTimestamp")}function uj(...e){return new uT("arrayUnion",e)}function uz(...e){return new u_("arrayRemove",e)}function uG(e){return new uS("increment",e)}function uK(e){return new uc(e)}function u$(e){let t=l6(ef(e.firestore,l1)),r=t._onlineComponents?.datastore.serializer;return void 0===r?null:iF(r,ns(e._query)).ft}function uQ(e,t){let r=tQ(t,(e,t)=>new n5(t,e.aggregateType,e._internalFieldPath)),n=l6(ef(e.firestore,l1)),i=n._onlineComponents?.datastore.serializer;return void 0===i?null:iV(i,na(e._query),r,!0).request}let uH="@firebase/firestore",uW="4.11.0";function uJ(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uY{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class uX{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new rO({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class uZ{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lG(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new u0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(uM("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class u0 extends uZ{data(){return super.data()}}function u1(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new U(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class u2{}class u5 extends u2{}function u6(e,t,...r){let n=[];for(let i of(t instanceof u2&&n.push(t),function(e){let t=e.filter(e=>e instanceof u4).length,r=e.filter(e=>e instanceof u3).length;if(t>1||t>0&&r>0)throw new U(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class u3 extends u5{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new u3(e,t,r)}_apply(e){let t=this._parse(e);return hg(e._query,t),new lz(e.firestore,e.converter,nl(e._query,t))}_parse(e){let t=uw(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new U(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hf(a,s);let t=[];for(let r of a)t.push(hd(n,e,r));o={arrayValue:{values:t}}}else o=hd(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hf(a,s),o=uC(r,t,a,"in"===s||"not-in"===s);return rq.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function u8(e,t,r){let n=uM("where",e);return u3._create(n,t,r)}class u4 extends u2{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new u4(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rj.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())hg(r,e),r=nl(r,e)}(e._query,t),new lz(e.firestore,e.converter,nl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function u7(...e){return e.forEach(e=>hm("or",e)),u4._create("or",e)}function u9(...e){return e.forEach(e=>hm("and",e)),u4._create("and",e)}class he extends u5{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new he(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new U(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new U(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rU(t,r)}(e._query,this._field,this._direction);return new lz(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new ne(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function ht(e,t="asc"){let r=uM("orderBy",e);return he._create(r,t)}class hr extends u5{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new hr(e,t,r)}_apply(e){return new lz(e.firestore,e.converter,nu(e._query,this._limit,this._limitType))}}function hn(e){return eg("limit",e),hr._create("limit",e,"F")}function hi(e){return eg("limitToLast",e),hr._create("limitToLast",e,"L")}class hs extends u5{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new hs(e,t,r)}_apply(e){var t;let r=hc(e,this.type,this._docOrFields,this._inclusive);return new lz(e.firestore,e.converter,(t=e._query,new ne(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function ha(...e){return hs._create("startAt",e,!0)}function ho(...e){return hs._create("startAfter",e,!1)}class hl extends u5{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new hl(e,t,r)}_apply(e){var t;let r=hc(e,this.type,this._docOrFields,this._inclusive);return new lz(e.firestore,e.converter,(t=e._query,new ne(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function hu(...e){return hl._create("endBefore",e,!1)}function hh(...e){return hl._create("endAt",e,!0)}function hc(e,t,r,n){if(r[0]=(0,v.getModularInstance)(r[0]),r[0]instanceof uZ)return function(e,t,r,n,i){if(!n)throw new U(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of ni(e))if(r.field.isKeyField())s.push(rE(t,n.key));else{let e=n.data.field(r.field);if(rn(e))throw new U(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new U(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new rL(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=uw(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new U(V.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new U(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!nn(e)&&-1!==l.indexOf("/"))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(en.fromString(l));if(!ea.isDocumentKey(r))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new ea(r);o.push(rE(t,i))}else{let e=uC(r,n,l);o.push(e)}}return new rL(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function hd(e,t,r){if("string"==typeof(r=(0,v.getModularInstance)(r))){if(""===r)throw new U(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nn(t)&&-1!==r.indexOf("/"))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(en.fromString(r));if(!ea.isDocumentKey(n))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rE(e,new ea(n))}if(r instanceof lG)return rE(e,r._key);throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ed(r)}.`)}function hf(e,t){if(!Array.isArray(e)||0===e.length)throw new U(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hg(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new U(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new U(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function hm(e,t){if(!(t instanceof u3||t instanceof u4))throw new U(V.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function hp(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class hy extends uV{constructor(e){super(),this.firestore=e}convertBytes(e){return new ua(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lG(this.firestore,null,t)}}function hw(e){return new uY("sum",uM("sum",e))}function hv(e){return new uY("avg",uM("average",e))}function hb(){return new uY("count")}function hI(e,t){return e instanceof uY&&t instanceof uY&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function hE(e,t){return lJ(e.query,t.query)&&(0,v.deepEqual)(e.data(),t.data())}function hT(e){return h_(e,{count:hb()})}function h_(e,t){var r;let n,i=ef(e.firestore,l1),s=l6(i),a=tQ(t,(e,t)=>new n5(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new B,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await lM(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=iV(e.serializer,na(t),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);L(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new uX(e,new uU(i),t))}class hS{constructor(e){this.kind="memory",this._onlineComponentProvider=lp.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new lf(void 0)}}toJSON(){return{kind:this.kind}}}class hx{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=hP(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class hA{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ld.provider}toJSON(){return{kind:this.kind}}}class hC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new lf(e)}}toJSON(){return{kind:this.kind}}}function hD(){return new hA}function hN(e){return new hC(e?.cacheSizeBytes)}function hk(e){return new hS(e)}function hR(e){return new hx(e)}class hM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lp.provider,this._offlineComponentProvider={build:t=>new lg(t,e?.cacheSizeBytes,this.forceOwnership)}}}class hO{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lp.provider,this._offlineComponentProvider={build:t=>new lm(t,e?.cacheSizeBytes)}}}function hP(e){return new hM(e?.forceOwnership)}function hL(){return new hO}let hF="NOT SUPPORTED";class hV{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hU extends uZ{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hq(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(uM("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=hU._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function hB(e,t,r){if(ep(t,hU._jsonSchema)){var n;if(t.bundle===hF)throw new U(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aK(e._databaseId),s=(n=t.bundle,new lb(n,i)),a=s.t(),o=new oO(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new U(V.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=iM(i,l[0].document),h=new ea(en.fromString(t.bundleName));return new hU(e,new hy(e),h,u,new hV(!1,!1),r||null)}}hU._jsonSchemaVersion="firestore/documentSnapshot/1.0",hU._jsonSchema={type:em("string",hU._jsonSchemaVersion),bundleSource:em("string","DocumentSnapshot"),bundleName:em("string"),bundle:em("string")};class hq extends hU{data(e={}){return super.data(e)}}class hj{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new hV(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new hq(this._firestore,this._userDataWriter,r.key,r,new hV(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new hq(e._firestore,e._userDataWriter,r.doc.key,r.doc,new hV(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new hq(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hV(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=hj._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=J.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function hz(e,t,r){if(ep(t,hj._jsonSchema)){var n;if(t.bundle===hF)throw new U(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aK(e._databaseId),s=(n=t.bundle,new lb(n,i)),a=s.t(),o=new oO(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new U(V.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=iZ(o.queries[0].bundledQuery),u=o.documents,h=new ob;u.map(e=>{let t=iM(i,e.document);h=h.add(t)});let c=oE.fromInitialDocuments(l,h,n_(),!1,!1),d=new lz(e,r||null,l);return new hj(e,new hy(e),d,c)}}function hG(e,t){return e instanceof hU&&t instanceof hU?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hj&&t instanceof hj&&e._firestore===t._firestore&&lJ(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}hj._jsonSchemaVersion="firestore/querySnapshot/1.0",hj._jsonSchema={type:em("string",hj._jsonSchemaVersion),bundleSource:em("string","QuerySnapshot"),bundleName:em("string"),bundle:em("string")};let hK={maxAttempts:5};class h${constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=uw(e)}set(e,t,r){this._verifyNotCommitted();let n=hQ(e,this._firestore),i=hp(n.converter,t,r),s=uv(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,nq.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=hQ(e,this._firestore);return i="string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof uo?uA(this._dataReader,"WriteBatch.update",s._key,t,r,n):ux(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,nq.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=hQ(e,this._firestore);return this._mutations=this._mutations.concat(new nX(t._key,nq.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new U(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hQ(e,t){if((e=(0,v.getModularInstance)(e)).firestore!==t)throw new U(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class hH{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=uw(e)}get(e){let t=hQ(e,this._firestore),r=new hy(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return O(24041);let n=e[0];if(n.isFoundDocument())return new uZ(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new uZ(this._firestore,r,t._key,null,t.converter);throw O(18433,{doc:n})})}set(e,t,r){let n=hQ(e,this._firestore),i=hp(n.converter,t,r),s=uv(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=hQ(e,this._firestore);return i="string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof uo?uA(this._dataReader,"Transaction.update",s._key,t,r,n):ux(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=hQ(e,this._firestore);return this._transaction.delete(t._key),this}}class hW extends hH{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=hQ(e,this._firestore),r=new uU(this._firestore);return super.get(e).then(e=>new hU(this._firestore,r,t._key,e._document,new hV(!1,!1),t.converter))}}function hJ(e,t,r){var n,i;let s;e=ef(e,l1);let a={...hK,...r};if(a.maxAttempts<1)throw new U(V.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=l6(e),i=r=>t(new hW(e,r)),s=new B,n.asyncQueue.enqueueAndForget(async()=>{let e=await lM(n);new lE(n.asyncQueue,e,a,i,s).ju()}),s.promise}function hY(e){e=ef(e,lG);let t=ef(e.firestore,l1);return lP(l6(t),e._key).then(r=>ct(t,e,r))}function hX(e){var t;let r;e=ef(e,lG);let n=ef(e.firestore,l1),i=l6(n),s=new uU(n);return(t=e._key,r=new B,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new U(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=ov(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await lN(i),t,r)),r.promise).then(t=>new hU(n,s,e._key,t,new hV(null!==t&&t.hasLocalMutations,!0),e.converter))}function hZ(e){e=ef(e,lG);let t=ef(e.firestore,l1);return lP(l6(t),e._key,{source:"server"}).then(r=>ct(t,e,r))}function h0(e){e=ef(e,lz);let t=ef(e.firestore,l1),r=l6(t),n=new uU(t);return u1(e._query),lL(r,e._query).then(r=>new hj(t,n,e,r))}function h1(e){var t;let r;e=ef(e,lz);let n=ef(e.firestore,l1),i=l6(n),s=new uU(n);return(t=e._query,r=new B,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await ac(e,t,!0),i=new oV(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=ov(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await lN(i),t,r)),r.promise).then(t=>new hj(n,s,e,t))}function h2(e){e=ef(e,lz);let t=ef(e.firestore,l1),r=l6(t),n=new uU(t);return lL(r,e._query,{source:"server"}).then(r=>new hj(t,n,e,r))}function h5(e,t,r){e=ef(e,lG);let n=ef(e.firestore,l1),i=hp(e.converter,t,r),s=uw(n);return ce(n,[uv(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,nq.none())])}function h6(e,t,r,...n){e=ef(e,lG);let i=ef(e.firestore,l1),s=uw(i);return ce(i,[("string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof uo?uA(s,"updateDoc",e._key,t,r,n):ux(s,"updateDoc",e._key,t)).toMutation(e._key,nq.exists(!0))])}function h3(e){return ce(ef(e.firestore,l1),[new nX(e._key,nq.none())])}function h8(e,t){let r=ef(e.firestore,l1),n=lH(e),i=hp(e.converter,t);return ce(r,[uv(uw(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,nq.exists(!1))]).then(()=>n)}function h4(e,...t){var r;let n,i,s,a,o;e=(0,v.getModularInstance)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||uJ(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(uJ(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof lG)i=ef(e.firestore,l1),s=nt(e._key.path),n={next:r=>{t[u]&&t[u](ct(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=ef(e,lz);i=ef(r.firestore,l1),s=r._query;let a=new uU(i);n={next:e=>{t[u]&&t[u](new hj(i,a,r,e))},error:t[u+1],complete:t[u+2]},u1(e._query)}return r=l6(i),o=new ok(s,a=new lw(n),h),r.asyncQueue.enqueueAndForget(async()=>ox(await lO(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>oA(await lO(r),o))}}function h7(e,t,...r){var n,i,s,a,o,l;let u=(0,v.getModularInstance)(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new U(V.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||uJ(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&uJ(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,ui(u,h.bundle).then(()=>us(u,h.bundleName)).then(r=>{r&&!t&&(s&&r.withConverter(s),e=h4(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&uJ(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,ui(u,h.bundle).then(()=>{t||(e=h4(new lG(u,l||null,ea.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new U(V.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function h9(e,t){let r,n=l6(e=ef(e,l1));return r=new lw(uJ(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lO(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lO(n),void e.Ca.delete(r)})}}function ce(e,t){var r;let n;return r=l6(e),n=new B,r.asyncQueue.enqueueAndForget(async()=>oW(await lR(r),t,n)),n.promise}function ct(e,t,r){let n=r.docs.get(t._key),i=new uU(e);return new hU(e,i,t._key,n,new hV(r.hasPendingWrites,r.fromCache),t.converter)}function cr(e){return l6(e=ef(e,l1)),new h$(e,t=>ce(e,t))}function cn(e,t){let r=l6(e=ef(e,l1));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return R("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new U(V.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=ci(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=uP("setIndexConfiguration",ci(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new eT(e,2)):"ASCENDING"===t.order?n.push(new eT(e,0)):"DESCENDING"===t.order&&n.push(new eT(e,1))}r.push(new ev(ev.UNKNOWN_ID,t,n,e_.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,eE,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>eR.waitFor(n)))})(await lN(r),n))}function ci(e,t){if("string"!=typeof e[t])throw new U(V.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class cs{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function ca(e){e=ef(e,l1);let t=cc.get(e);if(t)return t;let r=l6(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new cs(e);return cc.set(e,n),n}function co(e){ch(e,!0)}function cl(e){ch(e,!1)}function cu(e){var t;(t=l6(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await lN(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>N("deleting all persistent cache indexes succeeded")).catch(e=>R("deleting all persistent cache indexes failed",e))}function ch(e,t){var r;(r=l6(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await lN(r),void(e.Cs.As=t)})).then(e=>N(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>R(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let cc=new WeakMap;class cd{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cf.instance.onExistenceFilterMismatch(e)}}class cf{constructor(){this.i=new Map}static get instance(){return cg||function(e){if(n4)throw Error("a TestingHooksSpi instance is already set");n4=e}(cg=new cf),cg}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let cg=null;!function(e=!0){x=m.SDK_VERSION,(0,m._registerComponent)(new p.Component("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new l1(new G(t.getProvider("auth-internal")),new H(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new U(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rl(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,m.registerVersion)(uH,uW,void 0),(0,m.registerVersion)(uH,uW,"esm2020")}(),e.s(["AggregateField",()=>uY,"AggregateQuerySnapshot",()=>uX,"DocumentSnapshot",()=>hU,"PersistentCacheIndexManager",()=>cs,"QueryCompositeFilterConstraint",()=>u4,"QueryConstraint",()=>u5,"QueryDocumentSnapshot",()=>hq,"QueryEndAtConstraint",()=>hl,"QueryFieldFilterConstraint",()=>u3,"QueryLimitConstraint",()=>hr,"QueryOrderByConstraint",()=>he,"QuerySnapshot",()=>hj,"QueryStartAtConstraint",()=>hs,"SnapshotMetadata",()=>hV,"Transaction",()=>hW,"WriteBatch",()=>h$,"_TestingHooks",()=>cd,"addDoc",()=>h8,"aggregateFieldEqual",()=>hI,"aggregateQuerySnapshotEqual",()=>hE,"and",()=>u9,"average",()=>hv,"count",()=>hb,"deleteAllPersistentCacheIndexes",()=>cu,"deleteDoc",()=>h3,"disablePersistentCacheIndexAutoCreation",()=>cl,"documentSnapshotFromJSON",()=>hB,"enablePersistentCacheIndexAutoCreation",()=>co,"endAt",()=>hh,"endBefore",()=>hu,"executeWrite",()=>ce,"getAggregateFromServer",()=>h_,"getCountFromServer",()=>hT,"getDoc",()=>hY,"getDocFromCache",()=>hX,"getDocFromServer",()=>hZ,"getDocs",()=>h0,"getDocsFromCache",()=>h1,"getDocsFromServer",()=>h2,"getPersistentCacheIndexManager",()=>ca,"limit",()=>hn,"limitToLast",()=>hi,"memoryEagerGarbageCollector",()=>hD,"memoryLocalCache",()=>hk,"memoryLruGarbageCollector",()=>hN,"onSnapshot",()=>h4,"onSnapshotResume",()=>h7,"onSnapshotsInSync",()=>h9,"or",()=>u7,"orderBy",()=>ht,"persistentLocalCache",()=>hR,"persistentMultipleTabManager",()=>hL,"persistentSingleTabManager",()=>hP,"query",()=>u6,"querySnapshotFromJSON",()=>hz,"runTransaction",()=>hJ,"setDoc",()=>h5,"setIndexConfiguration",()=>cn,"snapshotEqual",()=>hG,"startAfter",()=>ho,"startAt",()=>ha,"sum",()=>hw,"updateDoc",()=>h6,"where",()=>u8,"writeBatch",()=>cr],63802),e.s([],36180),e.i(63802),e.s(["AbstractUserDataWriter",()=>uV,"AggregateField",()=>uY,"AggregateQuerySnapshot",()=>uX,"Bytes",()=>ua,"CACHE_SIZE_UNLIMITED",()=>-1,"CollectionReference",()=>lK,"DocumentReference",()=>lG,"DocumentSnapshot",()=>hU,"FieldPath",()=>uo,"FieldValue",()=>uu,"Firestore",()=>l1,"FirestoreError",()=>U,"GeoPoint",()=>uh,"LoadBundleTask",()=>l0,"PersistentCacheIndexManager",()=>cs,"Query",()=>lz,"QueryCompositeFilterConstraint",()=>u4,"QueryConstraint",()=>u5,"QueryDocumentSnapshot",()=>hq,"QueryEndAtConstraint",()=>hl,"QueryFieldFilterConstraint",()=>u3,"QueryLimitConstraint",()=>hr,"QueryOrderByConstraint",()=>he,"QuerySnapshot",()=>hj,"QueryStartAtConstraint",()=>hs,"SnapshotMetadata",()=>hV,"Timestamp",()=>ey,"Transaction",()=>hW,"VectorValue",()=>uc,"WriteBatch",()=>h$,"_AutoId",()=>J,"_ByteString",()=>t6,"_DatabaseId",()=>rl,"_DocumentKey",()=>ea,"_EmptyAppCheckTokenProvider",()=>W,"_EmptyAuthCredentialsProvider",()=>j,"_FieldPath",()=>es,"_TestingHooks",()=>cd,"_cast",()=>ef,"_debugAssert",()=>F,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>uQ,"_internalQueryToProtoQueryTarget",()=>u$,"_isBase64Available",()=>t5,"_logWarn",()=>R,"_validateIsNotUsedTogether",()=>el,"addDoc",()=>h8,"aggregateFieldEqual",()=>hI,"aggregateQuerySnapshotEqual",()=>hE,"and",()=>u9,"arrayRemove",()=>uz,"arrayUnion",()=>uj,"average",()=>hv,"clearIndexedDbPersistence",()=>l9,"collection",()=>l$,"collectionGroup",()=>lQ,"connectFirestoreEmulator",()=>lj,"count",()=>hb,"deleteAllPersistentCacheIndexes",()=>cu,"deleteDoc",()=>h3,"deleteField",()=>uB,"disableNetwork",()=>ur,"disablePersistentCacheIndexAutoCreation",()=>cl,"doc",()=>lH,"documentId",()=>ul,"documentSnapshotFromJSON",()=>hB,"enableIndexedDbPersistence",()=>l8,"enableMultiTabIndexedDbPersistence",()=>l4,"enableNetwork",()=>ut,"enablePersistentCacheIndexAutoCreation",()=>co,"endAt",()=>hh,"endBefore",()=>hu,"ensureFirestoreConfigured",()=>l6,"executeWrite",()=>ce,"getAggregateFromServer",()=>h_,"getCountFromServer",()=>hT,"getDoc",()=>hY,"getDocFromCache",()=>hX,"getDocFromServer",()=>hZ,"getDocs",()=>h0,"getDocsFromCache",()=>h1,"getDocsFromServer",()=>h2,"getFirestore",()=>l5,"getPersistentCacheIndexManager",()=>ca,"increment",()=>uG,"initializeFirestore",()=>l2,"limit",()=>hn,"limitToLast",()=>hi,"loadBundle",()=>ui,"memoryEagerGarbageCollector",()=>hD,"memoryLocalCache",()=>hk,"memoryLruGarbageCollector",()=>hN,"namedQuery",()=>us,"onSnapshot",()=>h4,"onSnapshotResume",()=>h7,"onSnapshotsInSync",()=>h9,"or",()=>u7,"orderBy",()=>ht,"persistentLocalCache",()=>hR,"persistentMultipleTabManager",()=>hL,"persistentSingleTabManager",()=>hP,"query",()=>u6,"queryEqual",()=>lJ,"querySnapshotFromJSON",()=>hz,"refEqual",()=>lW,"runTransaction",()=>hJ,"serverTimestamp",()=>uq,"setDoc",()=>h5,"setIndexConfiguration",()=>cn,"setLogLevel",()=>D,"snapshotEqual",()=>hG,"startAfter",()=>ho,"startAt",()=>ha,"sum",()=>hw,"terminate",()=>un,"updateDoc",()=>h6,"vector",()=>uK,"waitForPendingWrites",()=>ue,"where",()=>u8,"writeBatch",()=>cr],98925)}]);