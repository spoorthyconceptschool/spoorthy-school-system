(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,24527,e=>{"use strict";e.i(36180);var t=e.i(98925);async function a(e){let[a,s,d,i,o]=await Promise.all([(0,t.getDocs)((0,t.query)((0,t.collection)(e,"students"),(0,t.where)("status","==","ACTIVE"))),(0,t.getDocs)((0,t.query)((0,t.collection)(e,"custom_fees"),(0,t.where)("status","==","ACTIVE"))),(0,t.getDoc)((0,t.doc)(e,"config","fees")),(0,t.getDocs)((0,t.query)((0,t.collection)(e,"master_classes"))),(0,t.getDocs)((0,t.collection)(e,"student_fee_ledgers"))]),l=a.docs.map(e=>({id:e.id,...e.data()})),n=s.docs.map(e=>({id:e.id,...e.data()})),u=d.exists()?d.data():{terms:[],transportFees:{}},c=(u?.terms||[]).filter(e=>e.isActive),r=new Map;o.docs.forEach(e=>r.set(e.id,e.data()));let m=new Map;i.docs.forEach(e=>{m.set(e.id,e.data().name)});let p=0,g="2025-2026",I=(0,t.writeBatch)(e),N=0;for(let a of l){let s=`${a.schoolId}_${g}`,d=(0,t.doc)(e,"student_fee_ledgers",s),i=r.get(s),o=i?.items||[],l=i?.totalPaid||0,f=a.classId,D=m.get(f)||a.className||"Class 1",h=[],T=new Set;c.forEach(e=>{let t=e.amounts?.[D]||0;if(t>0){let a=`TERM_${e.id}`;h.push({id:a,type:"TERM",name:e.name,dueDate:e.dueDate,amount:Number(t),paidAmount:0,status:"PENDING"}),T.add(a)}}),n.forEach(e=>{let t=!1;if("CLASS"===e.targetType&&e.targetIds?.includes(f)&&(t=!0),"VILLAGE"===e.targetType&&e.targetIds?.includes(a.villageId)&&(t=!0),"STUDENT"===e.targetType&&e.targetIds?.includes(a.schoolId)&&(t=!0),t){let t=`CUSTOM_${e.id}`;h.push({id:t,type:"CUSTOM",name:e.name,dueDate:e.dueDate,amount:Number(e.amount),paidAmount:0,status:"PENDING"}),T.add(t)}});let A=a.transportRequired&&a.villageId?u?.transportFees?.[a.villageId]:0;if(A>0){let e="TRANSPORT_FEE";h.push({id:e,type:"TRANSPORT",name:"Transport Fee",dueDate:`${g.split("-")[0]}-06-01`,amount:Number(A),paidAmount:0,status:"PENDING"}),T.add(e)}let E=o.filter(e=>e.paidAmount>0||T.has(e.id));h.forEach(e=>{let t=E.findIndex(t=>t.id===e.id);if(-1===t)E.push(e);else{let a=E[t];0===a.paidAmount?E[t]={...a,amount:e.amount,dueDate:e.dueDate,name:e.name}:E[t]={...a,dueDate:e.dueDate,name:e.name}}});let w=E.reduce((e,t)=>e+t.amount,0);I.set(d,{studentId:a.schoolId,studentName:a.studentName||"Unknown",parentName:a.parentName||"",parentMobile:a.parentMobile||a.mobile||"",villageName:a.villageName||"",academicYearId:g,classId:a.classId||"",className:a.className||"",totalFee:w,totalPaid:l,status:l>=w?"PAID":"PENDING",items:E,updatedAt:new Date().toISOString()},{merge:!0}),N++,p++,N>=400&&(await I.commit(),I=(0,t.writeBatch)(e),N=0)}return N>0&&await I.commit(),p}e.s(["syncAllStudentLedgers",()=>a])}]);