(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,13151,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(32341);e.i(36180);var r=e.i(98925),i=e.i(59141),n=e.i(31278),d=e.i(45423),l=e.i(69638),o=e.i(75157);function c(){let{user:e}=(0,a.useAuth)(),[c,u]=(0,s.useState)([]),[x,m]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(!e)return;let t=!0,s=[],a=(e,s)=>{t&&u(t=>{let s=new Set(e.map(e=>e.id));return[...t.filter(e=>!s.has(e.id)),...e].sort((e,t)=>{let s=e.createdAt?.seconds||0;return(t.createdAt?.seconds||0)-s}).slice(0,50)})};return(async()=>{if(!e?.uid)return;let n=(0,r.query)((0,r.collection)(i.db,"notifications"),(0,r.where)("userId","==",e.uid),(0,r.limit)(50)),d=(0,r.onSnapshot)(n,e=>{t&&a(e.docs.map(e=>({id:e.id,...e.data()})),"personal")});s.push(d);try{let n=(0,r.query)((0,r.collection)(i.db,"students"),(0,r.where)("uid","==",e.uid),(0,r.limit)(1)),d=await (0,r.getDocs)(n);if(!t)return;if(!d.empty){let e=d.docs[0].data().classId;if(e){let n=(0,r.query)((0,r.collection)(i.db,"notifications"),(0,r.where)("target","==",`class_${e}`),(0,r.limit)(50)),d=(0,r.onSnapshot)(n,e=>{if(!t)return;let s=e.docs.map(e=>({id:e.id,...e.data()}));a(s,"class")});s.push(d)}}}catch(e){console.error("Error setting up class listeners:",e)}m(!1)})(),()=>{t=!1,s.forEach(e=>e())}},[e]);let h=async(e,t)=>{if("READ"!==t)try{console.log("Marking as read:",e),await (0,r.updateDoc)((0,r.doc)(i.db,"notifications",e),{status:"READ"})}catch(e){console.error("Error marking read:",e)}};return x?(0,t.jsx)("div",{className:"flex justify-center p-10",children:(0,t.jsx)(n.Loader2,{className:"animate-spin text-[#64FFDA]"})}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6 animate-in fade-in pb-10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6 border-b border-[#64FFDA]/10 pb-4",children:[(0,t.jsx)("div",{className:"p-2 bg-[#64FFDA]/10 rounded-lg text-[#64FFDA]",children:(0,t.jsx)(d.Bell,{size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-display font-bold text-white",children:"Notifications"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Updates on attendance, assignments, and system alerts."})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===c.length?(0,t.jsxs)("div",{className:"text-center py-20 bg-white/5 rounded-xl border border-white/10",children:[(0,t.jsx)(d.Bell,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No notifications yet."})]}):c.map(e=>(0,t.jsx)("div",{onClick:()=>h(e.id,e.status),className:(0,o.cn)("bg-black/20 border border-white/10 rounded-lg transition-all hover:bg-white/5 cursor-pointer group relative overflow-hidden","UNREAD"===e.status?"border-l-4 border-l-[#3B82F6] bg-[#3B82F6]/5":"opacity-80"),children:(0,t.jsxs)("div",{className:"p-5 flex gap-4",children:[(0,t.jsx)("div",{className:(0,o.cn)("mt-1 w-2 h-2 rounded-full flex-shrink-0","UNREAD"===e.status?"bg-[#3B82F6]":"bg-transparent")}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsx)("h3",{className:(0,o.cn)("font-bold text-lg","UNREAD"===e.status?"text-white":"text-muted-foreground"),children:e.title}),(0,t.jsx)("span",{suppressHydrationWarning:!0,className:"text-xs text-muted-foreground whitespace-nowrap font-mono",children:(e=>{if(!e)return"";try{return(e.toDate?e.toDate():new Date(1e3*e.seconds)).toLocaleString()}catch(e){return""}})(e.createdAt)})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:e.message}),"READ"===e.status&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-green-500/50 mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,t.jsx)(l.CheckCircle,{size:10})," Read"]})]})]})},e.id))})]})}e.s(["default",()=>c])}]);