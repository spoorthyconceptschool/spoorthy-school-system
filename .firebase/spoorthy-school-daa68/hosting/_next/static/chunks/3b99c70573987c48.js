(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("rounded-2xl border border-[#64FFDA]/10 bg-[#112240]/40 backdrop-blur-lg text-white shadow-xl transition-all duration-300 hover:bg-[#112240]/60 hover:border-[#64FFDA]/30 hover:shadow-[0_0_20px_-5px_rgba(100,255,218,0.1)] group",e),...a}));r.displayName="Card";let l=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...a}));l.displayName="CardHeader";let d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("h3",{ref:r,className:(0,s.cn)("font-bold text-xl tracking-tight text-white group-hover:text-accent transition-colors",e),...a}));d.displayName="CardTitle";let i=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-white/60 font-medium",e),...a}));i.displayName="CardDescription";let n=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",e),...a}));n.displayName="CardContent",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter",e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>i,"CardHeader",()=>l,"CardTitle",()=>d])},19455,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(91918),r=e.i(75157);let l=a.forwardRef(({className:e,variant:a="default",size:l="default",asChild:d=!1,...i},n)=>{let c=d?s.Slot:"button";return(0,t.jsx)(c,{className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-full text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 tracking-wide",{"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:scale-105 active:scale-95 transition-transform":"default"===a,"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm":"destructive"===a,"border border-white/20 bg-transparent hover:bg-white/10 hover:text-accent-foreground":"outline"===a,"bg-secondary text-secondary-foreground hover:bg-secondary/80":"secondary"===a,"hover:bg-white/10 hover:text-accent font-normal":"ghost"===a,"text-primary underline-offset-4 hover:underline":"link"===a,"bg-gradient-to-r from-accent to-accent/80 text-black font-bold hover:brightness-110 border-0 shadow-lg hover:shadow-accent/20":"gradient"===a,"bg-accent text-black font-bold hover:bg-accent/90 hover:scale-105 active:scale-95 transition-transform shadow-lg":"spotify"===a,"h-10 px-6 py-2":"default"===l,"h-9 px-4 text-xs":"sm"===l,"h-12 px-8 text-base":"lg"===l,"h-14 px-10 text-lg":"xl"===l,"h-10 w-10":"icon"===l},e),ref:n,...i})});l.displayName="Button",e.s(["Button",()=>l])},93479,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let r=a.forwardRef(({className:e,type:a,...r},l)=>(0,t.jsx)("input",{type:a,className:(0,s.cn)("flex h-12 w-full rounded-full border border-white/10 bg-[#282828] px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all shadow-inner hover:bg-[#333]",e),ref:l,...r}));r.displayName="Input",e.s(["Input",()=>r])},3281,e=>{"use strict";let t=(0,e.i(75254).default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],3281)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},84774,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(75157);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:r,className:(0,s.cn)("w-full caption-bottom text-sm",e),...a})}));r.displayName="Table";let l=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("thead",{ref:r,className:(0,s.cn)("[&_tr]:border-b",e),...a}));l.displayName="TableHeader";let d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tbody",{ref:r,className:(0,s.cn)("[&_tr:last-child]:border-0",e),...a}));d.displayName="TableBody",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tfoot",{ref:r,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let i=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tr",{ref:r,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));i.displayName="TableRow";let n=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("th",{ref:r,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));n.displayName="TableHead";let c=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("td",{ref:r,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));c.displayName="TableCell",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("caption",{ref:r,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>r,"TableBody",()=>d,"TableCell",()=>c,"TableHead",()=>n,"TableHeader",()=>l,"TableRow",()=>i])},69049,41071,e=>{"use strict";var t=e.i(43476),a=e.i(84774),s=e.i(75157),r=e.i(19455);let l=(0,e.i(75254).default)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>l],41071);var d=e.i(55146);function i({data:e,columns:i,isLoading:n,onRowClick:c,actions:o}){return n?(0,t.jsx)("div",{className:"w-full h-48 flex items-center justify-center bg-white/5 rounded-xl animate-pulse",children:(0,t.jsx)("div",{className:"h-4 w-4 bg-accent/50 rounded-full animate-ping"})}):(0,t.jsxs)("div",{className:"w-full space-y-3",children:[(0,t.jsx)("div",{className:"overflow-x-auto rounded-xl md:rounded-2xl border border-white/10 bg-black/20 backdrop-blur-md custom-scrollbar",children:(0,t.jsxs)(a.Table,{className:"w-full",children:[(0,t.jsx)(a.TableHeader,{className:"bg-white/5",children:(0,t.jsxs)(a.TableRow,{className:"border-white/10 hover:bg-transparent",children:[i.map(e=>(0,t.jsx)(a.TableHead,{className:(0,s.cn)("text-muted-foreground font-black uppercase text-[7px] md:text-[10px] tracking-widest h-8 md:h-12 whitespace-nowrap px-2 md:px-6 italic",e.headerClassName),children:e.header},e.key)),o&&(0,t.jsx)(a.TableHead,{className:"w-[30px] md:w-[50px] whitespace-nowrap px-2 md:px-6"})]})}),(0,t.jsx)(a.TableBody,{children:0===e.length?(0,t.jsx)(a.TableRow,{children:(0,t.jsx)(a.TableCell,{colSpan:i.length+ +!!o,className:"h-24 md:h-32 text-center text-muted-foreground border-white/10 whitespace-nowrap text-[10px] md:text-sm italic",children:"No results found."})}):e.map((e,n)=>(0,t.jsxs)(a.TableRow,{className:(0,s.cn)("border-white/5 transition-all duration-300 hover:bg-[#64FFDA]/5 group cursor-default",c&&"cursor-pointer"),onClick:()=>c?.(e),children:[i.map(r=>(0,t.jsx)(a.TableCell,{className:(0,s.cn)("py-2 md:py-4 px-2 md:px-6 font-medium whitespace-nowrap text-[10px] md:text-sm",r.cellClassName),children:(0,t.jsx)("div",{className:"flex flex-col",children:r.render?r.render(e,n):(0,t.jsx)("span",{className:"text-white group-hover:text-accent transition-colors",children:e[r.key]})})},`${e.id}-${r.key}`)),o&&(0,t.jsx)(a.TableCell,{className:"px-2 md:px-6",children:(0,t.jsxs)(d.DropdownMenu,{children:[(0,t.jsx)(d.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{variant:"ghost",className:"h-7 w-7 md:h-8 md:w-8 p-0 hover:bg-white/10 text-muted-foreground hover:text-white",children:[(0,t.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,t.jsx)(l,{className:"h-3 w-3 md:h-4 md:w-4"})]})}),(0,t.jsxs)(d.DropdownMenuContent,{align:"end",className:"bg-[#0A192F] border-white/10 backdrop-blur-xl rounded-xl",children:[(0,t.jsx)(d.DropdownMenuLabel,{className:"text-[10px] uppercase font-black tracking-widest text-muted-foreground/60 p-3 italic",children:"Operations"}),(0,t.jsx)(d.DropdownMenuSeparator,{className:"bg-white/5"}),(0,t.jsx)("div",{className:"p-1",children:o(e)})]})]})})]},e.id||n))})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 md:py-4 px-3 md:px-6 bg-white/5 border border-white/10 rounded-xl md:rounded-2xl",children:[(0,t.jsxs)("div",{className:"text-[8px] md:text-xs font-black uppercase tracking-widest text-muted-foreground italic",children:["Scope: ",(0,t.jsxs)("span",{className:"text-white ml-1",children:[e.length," items"]})]}),(0,t.jsxs)("div",{className:"flex gap-1 md:gap-2",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Prev"}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",disabled:!0,className:"h-6 md:h-8 px-2 md:px-4 text-[8px] md:text-[10px] font-black uppercase tracking-widest border border-white/10 opacity-50",children:"Next"})]})]})]})}e.s(["DataTable",()=>i],69049)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},94919,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(32341),r=e.i(59141);e.i(36180);var l=e.i(98925),d=e.i(15288),i=e.i(19455),n=e.i(87486),c=e.i(69049),o=e.i(31278),x=e.i(43531),h=e.i(37727),m=e.i(56909),u=e.i(55436),p=e.i(3281),b=e.i(80691),f=e.i(72498),g=e.i(93479),w=e.i(67489),v=e.i(75157);function j({classId:e,sectionId:j,defaultDate:N}){let{user:y}=(0,s.useAuth)(),{classes:k,branding:S}=(0,f.useMasterData)(),[C,I]=(0,a.useState)([]),[T,$]=(0,a.useState)({}),[D,A]=(0,a.useState)(!0),[R,P]=(0,a.useState)(!1),[L,M]=(0,a.useState)(!1),[B,F]=(0,a.useState)(!1),[_,O]=(0,a.useState)(""),[z,H]=(0,a.useState)(!1),[E,V]=(0,a.useState)([]),[U,Y]=(0,a.useState)("ALL"),q=N||new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{e&&j&&(z?J():G())},[e,j,q,z,U]);let J=async()=>{A(!0);try{let t,a,s=(0,l.query)((0,l.collection)(r.db,"students"),(0,l.where)("classId","==",e),(0,l.where)("sectionId","==",j)),d=(await (0,l.getDocs)(s)).docs.map(e=>({id:e.id,studentName:e.data().studentName,rollNumber:e.data().rollNumber,schoolId:e.data().schoolId})).sort((e,t)=>(e.rollNumber||0)-(t.rollNumber||0)),i=new Date().getFullYear();"ALL"===U?(t=`${i}-01-01_${e}_${j}`,a=`${i}-12-31_${e}_${j}`):(t=`${i}-${U}-01_${e}_${j}`,a=`${i}-${U}-31_${e}_${j}`);let n=(0,l.query)((0,l.collection)(r.db,"attendance"),(0,l.where)((0,l.documentId)(),">=",t),(0,l.where)((0,l.documentId)(),"<=",a)),c=await (0,l.getDocs)(n),o={};c.docs.forEach(e=>{let t=e.data();t.records&&Object.entries(t.records).forEach(([e,t])=>{o[e]||(o[e]={total:0,present:0}),("P"===t||"A"===t)&&(o[e].total++,"P"===t&&o[e].present++)})});let x=d.map(e=>{let t=o[e.id]||{total:0,present:0};return{...e,totalDays:t.total,presentDays:t.present,percentage:t.total>0?(t.present/t.total*100).toFixed(1):"0.0"}});V(x),I(d)}catch(e){console.error("Stats error",e),(0,b.toast)({title:"Error",description:"Failed to load stats",type:"error"})}finally{A(!1)}},G=async()=>{A(!0);try{let t=(0,l.query)((0,l.collection)(r.db,"students"),(0,l.where)("classId","==",e),(0,l.where)("sectionId","==",j),(0,l.where)("status","==","ACTIVE")),a=(await (0,l.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>(e.rollNumber||0)-(t.rollNumber||0));I(a);let s=(0,l.query)((0,l.collection)(r.db,"student_leaves"),(0,l.where)("classId","==",e),(0,l.where)("status","==","APPROVED")),d=await (0,l.getDocs)(s),i=new Set;d.forEach(e=>{let t=e.data();t.fromDate<=q&&t.toDate>=q&&(!t.sectionId||t.sectionId===j)&&i.add(t.studentId)});let n=`${q}_${e}_${j}`,c=await (0,l.getDoc)((0,l.doc)(r.db,"attendance",n));if(c.exists())M(!0),$(c.data().records||{});else{M(!1);let e={};a.forEach(t=>{let a=i.has(t.id)||t.schoolId&&i.has(t.schoolId);e[t.id]=a?"A":"P"}),$(e)}}catch(e){console.error(e),(0,b.toast)({title:"Error",description:"Failed to fetch data.",type:"error"})}finally{A(!1)}},[K,X]=(0,a.useState)(new Set),Q=async()=>{P(!0);try{let t=await fetch("/api/attendance/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:e,sectionId:j,date:q,records:T,markedBy:y?.uid,markedByName:y?.displayName||"Admin",isModification:L,touchedIds:Array.from(K)})}),a=await t.json();if(!a.success)throw Error(a.error);(0,b.toast)({title:L?"Attendance Updated":"Attendance Submitted",description:`Updated ${a.changesCount||0}. Sent ${a.notifCount||0} notifications.${a.skippedCount?` (${a.skippedCount} users have no account)`:""}`,type:"success"}),M(!0),F(!1),X(new Set)}catch(e){console.error(e),(0,b.toast)({title:"Failed",description:e.message,type:"error"})}finally{P(!1)}},W=C.filter(e=>e.studentName.toLowerCase().includes(_.toLowerCase())||e.schoolId&&e.schoolId.toLowerCase().includes(_.toLowerCase())||e.rollNumber&&String(e.rollNumber).includes(_));if(D)return(0,t.jsx)("div",{className:"p-10 flex justify-center",children:(0,t.jsx)(o.Loader2,{className:"animate-spin"})});let Z={total:C.length,present:Object.values(T).filter(e=>"P"===e).length,absent:Object.values(T).filter(e=>"A"===e).length};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(d.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Total"}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:Z.total})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500",children:(0,t.jsx)(x.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(d.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-emerald-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Present"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-500",children:Z.present})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500",children:(0,t.jsx)(x.Check,{className:"w-5 h-5"})})]})}),(0,t.jsx)(d.Card,{className:"bg-black/20 border-white/10 overflow-hidden",children:(0,t.jsxs)("div",{className:"p-4 flex items-center justify-between border-l-4 border-red-500",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground uppercase",children:"Absent"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-500",children:Z.absent})]}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500",children:(0,t.jsx)(h.X,{className:"w-5 h-5"})})]})})]}),(0,t.jsxs)(d.Card,{className:"bg-black/20 border-white/10",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-white/10 flex flex-col md:flex-row justify-between gap-4 items-center",children:[(0,t.jsxs)("div",{className:"flex bg-black/40 p-1 rounded-lg border border-white/10 items-center gap-2",children:[(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>H(!1),className:z?"text-muted-foreground hover:text-white":"bg-emerald-500/20 text-emerald-500",children:"Daily View"}),(0,t.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>H(!0),className:z?"bg-blue-500/20 text-blue-500":"text-muted-foreground hover:text-white",children:"Overall Stats"}),z&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(w.Select,{value:U,onValueChange:Y,children:[(0,t.jsx)(w.SelectTrigger,{className:"w-[140px] h-8 bg-transparent border-white/10 text-xs",children:(0,t.jsx)(w.SelectValue,{placeholder:"Period"})}),(0,t.jsxs)(w.SelectContent,{className:"bg-slate-900 border-white/10",children:[(0,t.jsxs)(w.SelectItem,{value:"ALL",children:["Full Year ",new Date().getFullYear()]}),(0,t.jsx)(w.SelectItem,{value:"01",children:"January"}),(0,t.jsx)(w.SelectItem,{value:"02",children:"February"}),(0,t.jsx)(w.SelectItem,{value:"03",children:"March"}),(0,t.jsx)(w.SelectItem,{value:"04",children:"April"}),(0,t.jsx)(w.SelectItem,{value:"05",children:"May"}),(0,t.jsx)(w.SelectItem,{value:"06",children:"June"}),(0,t.jsx)(w.SelectItem,{value:"07",children:"July"}),(0,t.jsx)(w.SelectItem,{value:"08",children:"August"}),(0,t.jsx)(w.SelectItem,{value:"09",children:"September"}),(0,t.jsx)(w.SelectItem,{value:"10",children:"October"}),(0,t.jsx)(w.SelectItem,{value:"11",children:"November"}),(0,t.jsx)(w.SelectItem,{value:"12",children:"December"})]})]}),(0,t.jsxs)(i.Button,{size:"sm",variant:"outline",className:"h-8 border-white/10 hover:bg-white/5 gap-2 px-3",onClick:()=>{let t=k.find(t=>t.id===e),a="ALL"===U?`Annual Report ${new Date().getFullYear()}`:`Monthly Report - ${new Date(2e3,Number(U)-1).toLocaleString("default",{month:"long"})} ${new Date().getFullYear()}`,s=`
            <html>
            <head>
                <title>Student Attendance Report - ${t?.name} - ${a}</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; color: #333; }
                    .header { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                    .logo { height: 80px; width: auto; object-fit: contain; }
                    .header-text { text-align: left; }
                    h1 { margin: 0; font-size: 28px; }
                    .details { font-size: 14px; color: #666; margin-top: 2px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                    th { background-color: #f8f9fa; font-weight: bold; text-transform: uppercase; font-size: 12px; }
                    .text-center { text-align: center; }
                    .font-bold { font-weight: bold; }
                    .percentage { font-weight: bold; }
                    .low { color: #dc3545; }
                    .good { color: #28a745; }
                    .footer { margin-top: 50px; display: flex; justify-content: space-between; font-size: 12px; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    ${S?.schoolLogo?`<img src="${S.schoolLogo}" class="logo" />`:""}
                    <div class="header-text">
                        <h1 style="margin: 0;">${S?.schoolName||"Attendance Report"}</h1>
                        <div class="details" style="font-weight: bold; color: #333;">Student Attendance Report</div>
                        <div class="details">Class: ${t?.name} (${j}) - ${a}</div>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">Roll</th>
                            <th>Student Name</th>
                            <th class="text-center">ID</th>
                            <th class="text-center">Total Days</th>
                            <th class="text-center">Present</th>
                            <th class="text-center">Absents</th>
                            <th class="text-center">Attendance %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${E.map((e,t)=>`
                            <tr>
                                <td>${e.rollNumber||t+1}</td>
                                <td class="font-bold">${e.studentName}</td>
                                <td class="text-center">${e.schoolId}</td>
                                <td class="text-center">${e.totalDays}</td>
                                <td class="text-center" style="color: #28a745; font-weight: bold;">${e.presentDays}</td>
                                <td class="text-center">${e.totalDays-e.presentDays}</td>
                                <td class="text-center percentage ${75>Number(e.percentage)?"low":"good"}">${e.percentage}%</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                <div class="footer">
                    <div>Generated on: ${new Date().toLocaleString()}</div>
                    <div>School Management System</div>
                </div>
                <script>
                    window.onload = () => {
                        window.print();
                        window.onafterprint = () => window.close();
                    };
                </script>
            </body>
            </html>
        `,r=window.open("","_blank");r?.document.write(s),r?.document.close()},children:[(0,t.jsx)(p.Printer,{className:"w-3 h-3"})," Print Report"]})]})]}),!z&&(0,t.jsxs)("div",{className:"relative flex-1 w-full md:max-w-xs",children:[(0,t.jsx)(u.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(g.Input,{placeholder:"Search students...",value:_,onChange:e=>O(e.target.value),className:"pl-8 bg-black/40 border-white/10 w-full"})]})]}),(0,t.jsx)(d.CardContent,{className:"p-0",children:(0,t.jsx)(c.DataTable,{data:z?E:W,isLoading:D,columns:z?[{key:"rollNumber",header:"Roll",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:e.rollNumber||(a??0)+1})},{key:"studentName",header:"Student Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.studentName}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.schoolId})]})},{key:"totalDays",header:"Total",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-mono",children:e.totalDays})},{key:"presentDays",header:"Present",cellClassName:"text-center",render:e=>(0,t.jsx)("span",{className:"font-bold text-emerald-400",children:e.presentDays})},{key:"percentage",header:"Attendance %",cellClassName:"text-center",render:e=>(0,t.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,t.jsxs)("span",{className:`font-bold ${75>Number(e.percentage)?"text-red-400":"text-emerald-400"}`,children:[e.percentage,"%"]}),(0,t.jsx)("div",{className:"w-full h-1 bg-white/10 rounded-full mt-1 overflow-hidden max-w-[60px]",children:(0,t.jsx)("div",{className:`h-full ${75>Number(e.percentage)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${e.percentage}%`}})})]})},{key:"statsStatus",header:"Status",cellClassName:"text-right",render:e=>(0,t.jsx)(n.Badge,{variant:"outline",className:(0,v.cn)("text-[8px] uppercase font-black tracking-tighter",75>Number(e.percentage)?"text-red-400 border-red-500/30":"text-emerald-400 border-emerald-500/30"),children:75>Number(e.percentage)?"Low":"Good"})}]:[{key:"rollNumber",header:"Roll",render:(e,a)=>(0,t.jsx)("span",{className:"font-mono text-sm",children:e.rollNumber||(a??0)+1})},{key:"studentName",header:"Student Name",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.studentName}),(0,t.jsx)("div",{className:"text-[10px] text-white/40 uppercase",children:e.schoolId})]})},{key:"attendanceStatus",header:"Status",cellClassName:"text-center",render:e=>(0,t.jsx)(n.Badge,{className:(0,v.cn)("font-black uppercase tracking-tighter text-[9px]","P"===T[e.id]?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"),children:"P"===T[e.id]?"Present":"Absent"})},{key:"action",header:"Action",cellClassName:"text-right",render:e=>(0,t.jsx)(i.Button,{size:"sm",variant:"ghost",className:(0,v.cn)("h-8 text-[10px] font-black uppercase tracking-tighter px-3 rounded-lg","P"===T[e.id]?"bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white":"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white"),onClick:()=>{var t;return t=e.id,void($(e=>({...e,[t]:"P"===e[t]?"A":"P"})),X(e=>{let a=new Set(e);return a.add(t),a}),F(!0))},children:"P"===T[e.id]?"Mark Absent":"Mark Present"})}]})})]}),!z&&(0,t.jsxs)("div",{className:"flex justify-between items-center bg-white/5 p-4 rounded-lg border border-white/10",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:L?B?"You have unsaved changes.":`Attendance already marked by ${y?.uid==="admin"?"Admin":"Teacher"}`:"Ready to submit."}),(0,t.jsxs)(i.Button,{size:"lg",onClick:Q,disabled:R||L&&!B,className:"bg-emerald-600 hover:bg-emerald-700 text-white min-w-[200px]",children:[R?(0,t.jsx)(o.Loader2,{className:"w-5 h-5 animate-spin mr-2"}):(0,t.jsx)(m.Save,{className:"w-5 h-5 mr-2"}),L?"Update Attendance":"Submit Attendance"]})]})]})}e.s(["default",()=>j])},20485,e=>{"use strict";var t=e.i(43476),a=e.i(71645);e.i(36180);var s=e.i(98925),r=e.i(59141),l=e.i(72498),d=e.i(32341),i=e.i(67489),n=e.i(87486),c=e.i(31278),o=e.i(63209),x=e.i(94919);function h(){let{user:e}=(0,d.useAuth)(),{classes:h,sections:m,subjectTeachers:u}=(0,l.useMasterData)(),[p,b]=(0,a.useState)(null),[f,g]=(0,a.useState)(!0),[w,v]=(0,a.useState)(""),j=new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{e&&N()},[e]);let N=async()=>{g(!0);try{let t=(0,s.query)((0,s.collection)(r.db,"teachers"),(0,s.where)("uid","==",e.uid),(0,s.limit)(1)),a=await (0,s.getDocs)(t);if(!a.empty){let e={id:a.docs[0].id,...a.docs[0].data()};b(e);let t=y(e);t.length>0&&v(t[0].key)}}catch(e){console.error(e)}finally{g(!1)}},y=e=>{if(!e||!u)return[];let t=e.schoolId||e.id,a=new Map;if(e.classTeacherOf){let{classId:t,sectionId:s}=e.classTeacherOf,r=`${t}_${s}`;a.set(r,{classId:t,sectionId:s,key:r,isClassTeacher:!0})}return Object.keys(u).forEach(e=>{if(Object.values(u[e]).includes(t)){let[t,s]=e.split("_");a.has(e)||a.set(e,{classId:t,sectionId:s,key:e,isClassTeacher:!1})}}),Array.from(a.values())};if(f)return(0,t.jsx)("div",{className:"p-10 flex justify-center",children:(0,t.jsx)(c.Loader2,{className:"animate-spin text-accent"})});let k=y(p);if(0===k.length)return(0,t.jsxs)("div",{className:"p-10 text-center space-y-4 max-w-md mx-auto mt-20 bg-black/20 border border-white/10 rounded-3xl backdrop-blur-xl",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-500/20 shadow-lg shadow-red-500/20",children:(0,t.jsx)(o.AlertCircle,{className:"w-8 h-8 text-red-500"})}),(0,t.jsx)("h2",{className:"text-2xl font-display font-bold text-white",children:"No Classes Assigned"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"You are not currently assigned as a Class Teacher or Subject Teacher for any active classes."}),(0,t.jsx)("p",{className:"text-[10px] text-muted-foreground/30 uppercase tracking-widest pt-4 font-black",children:"Contact Admin for Access"})]});let S=k.find(e=>e.key===w)||k[0];return(0,t.jsxs)("div",{className:"p-4 md:p-8 space-y-8 max-w-6xl mx-auto animate-in fade-in pb-20",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-white/5 pb-8",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h1",{className:"text-3xl md:text-5xl font-display font-bold bg-gradient-to-r from-white to-white/40 bg-clip-text text-transparent italic leading-tight",children:"Daily Attendance"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),(0,t.jsxs)("p",{className:"text-[10px] md:text-xs text-muted-foreground font-black uppercase tracking-widest opacity-60",children:["Authorized for ",k.length," class",k.length>1?"es":""]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("label",{className:"text-[8px] font-black uppercase tracking-[0.2em] text-muted-foreground ml-1",children:"Select Active Class"}),(0,t.jsxs)(i.Select,{value:w,onValueChange:v,children:[(0,t.jsx)(i.SelectTrigger,{className:"w-full md:w-[220px] h-12 bg-white/5 border-white/10 rounded-xl font-bold hover:bg-white/10 transition-all",children:(0,t.jsx)(i.SelectValue,{placeholder:"Select Class"})}),(0,t.jsx)(i.SelectContent,{className:"bg-slate-900 border-white/10 text-white",children:k.map(e=>(0,t.jsx)(i.SelectItem,{value:e.key,className:"focus:bg-accent focus:text-black font-bold py-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full gap-4",children:[(0,t.jsxs)("span",{children:[h[e.classId]?.name||e.classId," - ",m[e.sectionId]?.name||e.sectionId]}),e.isClassTeacher&&(0,t.jsx)(n.Badge,{className:"text-[8px] bg-amber-500 text-black",children:"In-charge"})]})},e.key))})]})]}),(0,t.jsx)("div",{className:"px-5 h-12 flex items-center bg-black/40 border border-white/10 rounded-xl backdrop-blur-md",children:(0,t.jsx)("span",{className:"text-xs font-black uppercase tracking-widest text-white/40",children:new Date().toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})})})]})]}),(0,t.jsx)("div",{className:"bg-black/20 border border-white/10 rounded-3xl p-2 md:p-6 backdrop-blur-xl shadow-2xl",children:(0,t.jsx)(x.default,{classId:S.classId,sectionId:S.sectionId,defaultDate:j})})]})}e.s(["default",()=>h])}]);