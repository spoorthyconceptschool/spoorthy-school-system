(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(75157);let l=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("div",{ref:l,className:(0,t.cn)("rounded-2xl border border-[#64FFDA]/10 bg-[#112240]/40 backdrop-blur-lg text-white shadow-xl transition-all duration-300 hover:bg-[#112240]/60 hover:border-[#64FFDA]/30 hover:shadow-[0_0_20px_-5px_rgba(100,255,218,0.1)] group",e),...s}));l.displayName="Card";let r=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("div",{ref:l,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",e),...s}));r.displayName="CardHeader";let i=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("h3",{ref:l,className:(0,t.cn)("font-bold text-xl tracking-tight text-white group-hover:text-accent transition-colors",e),...s}));i.displayName="CardTitle";let n=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("p",{ref:l,className:(0,t.cn)("text-sm text-white/60 font-medium",e),...s}));n.displayName="CardDescription";let d=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("div",{ref:l,className:(0,t.cn)("p-6 pt-0",e),...s}));d.displayName="CardContent",s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("div",{ref:l,className:(0,t.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter",e.s(["Card",()=>l,"CardContent",()=>d,"CardDescription",()=>n,"CardHeader",()=>r,"CardTitle",()=>i])},71689,e=>{"use strict";let a=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>a],71689)},93479,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(75157);let l=s.forwardRef(({className:e,type:s,...l},r)=>(0,a.jsx)("input",{type:s,className:(0,t.cn)("flex h-12 w-full rounded-full border border-white/10 bg-[#282828] px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all shadow-inner hover:bg-[#333]",e),ref:r,...l}));l.displayName="Input",e.s(["Input",()=>l])},10204,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(75157);let l=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("label",{ref:l,className:(0,t.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...s}));l.displayName="Label",e.s(["Label",()=>l])},76639,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(26999),l=e.i(37727),r=e.i(75157);let i=t.Root,n=t.Trigger,d=t.Portal;t.Close;let c=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)(t.Overlay,{ref:l,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));c.displayName=t.Overlay.displayName;let o=s.forwardRef(({className:e,children:s,...i},n)=>(0,a.jsxs)(d,{children:[(0,a.jsx)(c,{}),(0,a.jsxs)(t.Content,{ref:n,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[s,(0,a.jsxs)(t.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.X,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));o.displayName=t.Content.displayName;let m=({className:e,...s})=>(0,a.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});m.displayName="DialogHeader";let h=({className:e,...s})=>(0,a.jsx)("div",{className:(0,r.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});h.displayName="DialogFooter";let u=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)(t.Title,{ref:l,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));u.displayName=t.Title.displayName;let x=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)(t.Description,{ref:l,className:(0,r.cn)("text-sm text-muted-foreground",e),...s}));x.displayName=t.Description.displayName,e.s(["Dialog",()=>i,"DialogContent",()=>o,"DialogDescription",()=>x,"DialogFooter",()=>h,"DialogHeader",()=>m,"DialogTitle",()=>u,"DialogTrigger",()=>n])},24687,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(75157);let l=s.forwardRef(({className:e,...s},l)=>(0,a.jsx)("textarea",{className:(0,t.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:l,...s}));l.displayName="Textarea",e.s(["Textarea",()=>l])},88511,e=>{"use strict";let a=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>a],88511)},90281,e=>{"use strict";e.i(36180);var a=e.i(98925),s=e.i(59141);let t=async e=>{try{await (0,a.addDoc)((0,a.collection)(s.db,"notifications"),{...e,status:"UNREAD",createdAt:a.Timestamp.now()})}catch(e){console.error("Failed to create notification:",e)}},l=async e=>{await t({...e,target:"ALL_ADMINS",title:`[Manager Action] ${e.title}`}),(e.userId||e.target&&"ALL_ADMINS"!==e.target)&&await t(e)};e.s(["notifyManagerAction",0,l])},70756,e=>{"use strict";let a=(0,e.i(75254).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>a],70756)},87828,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(76639),l=e.i(19455),r=e.i(93479),i=e.i(10204),n=e.i(31278),d=e.i(70756),c=e.i(78894),o=e.i(32341),m=e.i(80691);function h({isOpen:e,onClose:h,user:u,onSuccess:x}){let{user:p}=(0,o.useAuth)(),[g,b]=(0,s.useState)(""),[f,j]=(0,s.useState)(!1);if(!u)return null;let y=async e=>{if(e.preventDefault(),!u.uid)return void(0,m.toast)({title:"Error",description:"User has no linked account.",type:"error"});j(!0);try{let e=await fetch("/api/admin/users/reset-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await p?.getIdToken()}`},body:JSON.stringify({targetUid:u.uid,schoolId:u.schoolId,role:u.role,newPassword:g})}),a=await e.json();a.success?((0,m.toast)({title:"Password Changed",description:`Proactively updated password for ${u.name}.`,type:"success"}),b(""),x&&x(),h()):(0,m.toast)({title:"Reset Failed",description:a.error||"Could not change password.",type:"error"})}catch(e){(0,m.toast)({title:"Error",description:e.message||"An unexpected error occurred.",type:"error"})}finally{j(!1)}};return(0,a.jsx)(t.Dialog,{open:e,onOpenChange:h,children:(0,a.jsxs)(t.DialogContent,{className:"bg-zinc-950 border-white/10 text-white sm:max-w-[425px]",children:[(0,a.jsxs)(t.DialogHeader,{children:[(0,a.jsxs)(t.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Lock,{className:"w-5 h-5 text-amber-500"}),"Reset Password"]}),(0,a.jsxs)(t.DialogDescription,{children:["Set a new password for ",(0,a.jsx)("span",{className:"font-bold text-white",children:u.name})," (",u.schoolId,")."]})]}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg text-xs text-amber-500 flex gap-2",children:[(0,a.jsx)(c.AlertTriangle,{className:"w-4 h-4 shrink-0"}),(0,a.jsx)("p",{children:"This will immediately update the user's password and log them out of all devices."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.Label,{children:"New Password"}),(0,a.jsx)(r.Input,{value:g,onChange:e=>b(e.target.value),className:"bg-black/20",placeholder:"Enter new password",required:!0,minLength:6})]}),(0,a.jsxs)(t.DialogFooter,{children:[(0,a.jsx)(l.Button,{type:"button",variant:"ghost",onClick:h,disabled:f,children:"Cancel"}),(0,a.jsxs)(l.Button,{type:"submit",className:"bg-amber-600 hover:bg-amber-700 text-white",disabled:f,children:[f?(0,a.jsx)(n.Loader2,{className:"animate-spin w-4 h-4 mr-2"}):null,"Update Password"]})]})]})]})})}e.s(["AdminChangePasswordModal",()=>h])},25652,e=>{"use strict";let a=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>a],25652)},12426,e=>{"use strict";let a=(0,e.i(75254).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>a],12426)},43432,e=>{"use strict";let a=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);e.s(["Phone",()=>a],43432)},83211,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(80691),l=e.i(76639),r=e.i(19455),i=e.i(93479),n=e.i(10204),d=e.i(31278),c=e.i(12426),o=e.i(25652);let m=(0,e.i(75254).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var h=e.i(59141),u=e.i(32341);function x({isOpen:x,onClose:p,person:g,onSuccess:b}){let[f,j]=(0,s.useState)(""),[y,N]=(0,s.useState)(!1),[w,v]=(0,s.useState)(null),{user:S}=(0,u.useAuth)();(0,s.useEffect)(()=>{x&&g&&(j(g.currentSalary.toString()),"STAFF"===g.role&&g.roleCode?C(g.roleCode):v(null))},[x,g]);let C=async a=>{try{let{getDocs:s,query:t,collection:l,where:r}=await e.A(27510),i=t(l(h.db,"master_staff_roles"),r("code","==",a)),n=await s(i);if(!n.empty){let e=n.docs[0].data();v(e.basicSalary||0)}}catch(e){console.error(e),(0,t.toast)({title:"Error fetching role data",description:"Could not fetch role salary details.",type:"error"})}},k=async()=>{if(g&&f){N(!0);try{if(!S)throw Error("Not authenticated");let e=await S.getIdToken(),a=await fetch("/api/admin/payroll/adjust-salary",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({personId:g.id,role:g.role,amount:Number(f),roleCode:g.roleCode})}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to adjust salary");(0,t.toast)({title:"Salary Adjusted",description:`Successfully updated salary for ${g.name}`,type:"success"}),b(),p()}catch(e){(0,t.toast)({title:"Adjustment Failed",description:e.message||"An error occurred while updating salary.",type:"error"})}finally{N(!1)}}};if(!g)return null;let T=g.currentSalary,A=Number(f)||0,D=A-T;return(0,a.jsx)(l.Dialog,{open:x,onOpenChange:p,children:(0,a.jsxs)(l.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[400px] w-[95vw] rounded-2xl",children:[(0,a.jsx)(l.DialogHeader,{children:(0,a.jsx)(l.DialogTitle,{className:"text-xl font-display italic",children:"Adjust Salary"})}),(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6 py-2 md:py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 md:p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,a.jsx)("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent font-black text-sm md:text-base",children:g.name.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sm md:text-base",children:g.name}),(0,a.jsxs)("div",{className:"text-[10px] text-muted-foreground font-mono uppercase tracking-tighter opacity-70",children:[g.schoolId," • ",g.role]})]})]}),null!==w&&(0,a.jsxs)("div",{className:"px-3 py-1.5 rounded-lg bg-blue-500/5 border border-blue-500/10 flex justify-between items-center text-[10px]",children:[(0,a.jsx)("span",{className:"text-blue-400 font-black tracking-widest uppercase",children:"Role Baseline"}),(0,a.jsxs)("span",{className:"font-mono font-bold text-blue-300",children:["₹",w.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"space-y-1.5 md:space-y-2",children:[(0,a.jsx)(n.Label,{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground",children:"Monthly Base Salary (₹)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,a.jsx)(i.Input,{type:"number",value:f,onChange:e=>j(e.target.value),className:"pl-9 bg-white/5 border-white/10 h-10 md:h-12 text-sm md:text-lg font-mono focus:ring-accent/30 rounded-xl",placeholder:"Enter Amount"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{className:"p-2.5 md:p-3 rounded-xl bg-white/5 border border-white/10 text-center md:text-left",children:[(0,a.jsx)("div",{className:"text-[8px] md:text-[10px] uppercase font-black tracking-widest text-muted-foreground mb-0.5 md:mb-1",children:"Current"}),(0,a.jsxs)("div",{className:"text-sm md:text-lg font-mono font-bold",children:["₹",T?.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"p-2.5 md:p-3 rounded-xl bg-white/5 border border-white/10 text-center md:text-left",children:[(0,a.jsx)("div",{className:"text-[8px] md:text-[10px] uppercase font-black tracking-widest text-muted-foreground mb-0.5 md:mb-1",children:"Proposed"}),(0,a.jsxs)("div",{className:"text-sm md:text-lg font-mono font-bold",children:["₹",A?.toLocaleString()]})]})]}),0!==D&&(0,a.jsxs)("div",{className:`p-3 md:p-4 rounded-xl flex items-center justify-between ${D>0?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 font-black uppercase text-[10px] tracking-widest",children:[D>0?(0,a.jsx)(o.TrendingUp,{className:"w-4 h-4"}):(0,a.jsx)(m,{className:"w-4 h-4"}),D>0?"Increase":"Decrease"]}),(0,a.jsxs)("div",{className:"text-base md:text-xl font-mono font-bold",children:[D>0?"+":""," ₹",Math.abs(D).toLocaleString()]})]})]}),(0,a.jsx)(l.DialogFooter,{children:(0,a.jsx)(r.Button,{onClick:k,disabled:y||A===T||A<0,className:"w-full bg-white text-black hover:bg-zinc-200 h-10 md:h-12 rounded-xl font-black uppercase tracking-tighter text-xs md:text-sm shadow-lg shadow-white/5",children:y?(0,a.jsx)(d.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Adjustment"})})]})})}e.s(["AdjustSalaryModal",()=>x],83211)},65261,e=>{"use strict";let a=(0,e.i(75254).default)("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);e.s(["KeyRound",()=>a],65261)},50919,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(18566);e.i(36180);var l=e.i(98925),r=e.i(59141),i=e.i(19455),n=e.i(15288),d=e.i(87486),c=e.i(31278),o=e.i(71689),m=e.i(43432),h=e.i(46897),u=e.i(10980),x=e.i(51501),p=e.i(12426),g=e.i(52754),b=e.i(88511),f=e.i(69638),j=e.i(76639),y=e.i(10204),N=e.i(93479),w=e.i(67489),v=e.i(24687),S=e.i(32341),C=e.i(83211),k=e.i(72498),T=e.i(80691),A=e.i(90281);function D({isOpen:e,onClose:t,teacher:n,onSuccess:d}){let{subjects:o}=(0,k.useMasterData)(),[m,h]=(0,s.useState)([]),[u,x]=(0,s.useState)({name:"",mobile:"",age:"",address:"",qualifications:"",primarySubject:"",secondarySubject:"",classTeacherClass:"",classTeacherSection:""}),[p,g]=(0,s.useState)(!1),{user:b}=(0,S.useAuth)(),[f,v]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!b)return;let e=(0,l.onSnapshot)((0,l.doc)(r.db,"users",b.uid),e=>{e.exists()&&v(e.data().role)});return()=>e()},[b]),(0,s.useEffect)(()=>{e&&n&&(x({name:n.name||"",mobile:n.mobile||"",age:n.age?.toString()||"",address:n.address||"",qualifications:n.qualifications||"",primarySubject:n.subjects?.[0]||"",secondarySubject:n.subjects?.[1]||"NONE",classTeacherClass:n.classTeacherOf?.classId||"NONE",classTeacherSection:n.classTeacherOf?.sectionId||"A"}),h(Object.values(o||{}).filter(e=>!1!==e.isActive).sort((e,a)=>e.name.localeCompare(a.name))))},[e,n,o]);let C=async e=>{if(e.preventDefault(),n?.id){g(!0);try{let e=[];u.primarySubject&&"NONE"!==u.primarySubject&&e.push(u.primarySubject),u.secondarySubject&&"NONE"!==u.secondarySubject&&u.secondarySubject!==u.primarySubject&&e.push(u.secondarySubject);let a=(0,l.doc)(r.db,"teachers",n.id);await (0,l.updateDoc)(a,{name:u.name,mobile:u.mobile,age:Number(u.age),address:u.address,qualifications:u.qualifications,subjects:e,classTeacherOf:u.classTeacherClass&&"NONE"!==u.classTeacherClass?{classId:u.classTeacherClass,sectionId:u.classTeacherSection||"A"}:null,updatedAt:new Date().toISOString()}),"MANAGER"===f&&await (0,A.notifyManagerAction)({userId:n.uid||n.id,title:"Profile Updated",message:`Teacher profile ${u.name} has been updated by Manager ${b?.displayName||"System"}.`,type:"INFO",actionBy:b?.uid,actionByName:b?.displayName||"Manager"}),(0,T.toast)({title:"Teacher Updated",description:`Successfully updated details for ${u.name}`,type:"success"}),d(),t()}catch(e){(0,T.toast)({title:"Update Failed",description:e.message||"Could not update teacher details.",type:"error"})}finally{g(!1)}}};return(0,a.jsx)(j.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(j.DialogContent,{className:"bg-black/95 border-white/10 text-white sm:max-w-[600px]",children:[(0,a.jsx)(j.DialogHeader,{children:(0,a.jsx)(j.DialogTitle,{children:"Edit Teacher Details"})}),(0,a.jsxs)("form",{onSubmit:C,className:"grid grid-cols-2 gap-4 py-2",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Full Name"}),(0,a.jsx)(N.Input,{required:!0,value:u.name,onChange:e=>x({...u,name:e.target.value}),className:"bg-white/5 border-white/10"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Mobile Number"}),(0,a.jsx)(N.Input,{required:!0,type:"tel",maxLength:10,value:u.mobile,onChange:e=>x({...u,mobile:e.target.value}),className:"bg-white/5 border-white/10 font-mono"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Age"}),(0,a.jsx)(N.Input,{required:!0,type:"number",min:"18",value:u.age,onChange:e=>x({...u,age:e.target.value}),className:"bg-white/5 border-white/10"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Address"}),(0,a.jsx)(N.Input,{required:!0,value:u.address,onChange:e=>x({...u,address:e.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Primary Subject"}),(0,a.jsxs)(w.Select,{value:u.primarySubject,onValueChange:e=>x({...u,primarySubject:e}),children:[(0,a.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(w.SelectValue,{placeholder:"Select"})}),(0,a.jsx)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:m.map(e=>(0,a.jsx)(w.SelectItem,{value:e.name||"Unknown",children:e.name||"Unknown"},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Secondary Subject (Optional)"}),(0,a.jsxs)(w.Select,{value:u.secondarySubject,onValueChange:e=>x({...u,secondarySubject:e}),children:[(0,a.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(w.SelectValue,{placeholder:"None"})}),(0,a.jsxs)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:[(0,a.jsx)(w.SelectItem,{value:"NONE",children:"None"}),m.filter(e=>e.name!==u.primarySubject).map(e=>(0,a.jsx)(w.SelectItem,{value:e.name||"Unknown",children:e.name||"Unknown"},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Qualifications"}),(0,a.jsx)(N.Input,{required:!0,value:u.qualifications,onChange:e=>x({...u,qualifications:e.target.value}),className:"bg-white/5 border-white/10",placeholder:"e.g. B.Ed, M.Sc"})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-white/10",children:[(0,a.jsx)(y.Label,{className:"text-xs text-muted-foreground uppercase mb-2 block",children:"Class Teacher Assignment"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)(w.Select,{value:u.classTeacherClass,onValueChange:e=>x({...u,classTeacherClass:e}),children:[(0,a.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10 text-xs",children:(0,a.jsx)(w.SelectValue,{placeholder:"Class"})}),(0,a.jsxs)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:[(0,a.jsx)(w.SelectItem,{value:"NONE",children:"None"}),Object.values((0,k.useMasterData)().classes).sort((e,a)=>e.order-a.order).map(e=>(0,a.jsx)(w.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)(w.Select,{value:u.classTeacherSection,onValueChange:e=>x({...u,classTeacherSection:e}),children:[(0,a.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10 text-xs",children:(0,a.jsx)(w.SelectValue,{placeholder:"Section"})}),(0,a.jsx)(w.SelectContent,{className:"bg-black border-white/10 text-white",children:Object.values((0,k.useMasterData)().sections).map(e=>(0,a.jsx)(w.SelectItem,{value:e.id,children:e.name},e.id))})]})]})]})]}),(0,a.jsxs)(j.DialogFooter,{className:"col-span-2 mt-4",children:[(0,a.jsx)(i.Button,{type:"button",variant:"ghost",onClick:t,disabled:p,children:"Cancel"}),(0,a.jsxs)(i.Button,{type:"submit",disabled:p,className:"bg-white text-black hover:bg-zinc-200",children:[p?(0,a.jsx)(c.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Save Changes"]})]})]})]})})}var I=e.i(87828),L=e.i(65261),O=e.i(39616);function E(){let{user:e}=(0,S.useAuth)(),{id:k}=(0,t.useParams)(),T=(0,t.useRouter)(),[A,E]=(0,s.useState)(null),[M,P]=(0,s.useState)(!0),[R,B]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!e)return;let a=(0,l.onSnapshot)((0,l.doc)(r.db,"users",e.uid),e=>{e.exists()&&B(e.data().role)});return()=>a()},[e]);let[F,q]=(0,s.useState)([]),[H,U]=(0,s.useState)(!1),[z,V]=(0,s.useState)({month:new Date().toLocaleString("default",{month:"long"}),year:new Date().getFullYear().toString(),amount:"",method:"CASH",notes:""}),[$,_]=(0,s.useState)(!1),[J,G]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(!1),[Y,W]=(0,s.useState)(!1);(0,s.useEffect)(()=>{k&&(X(),Z())},[k]);let X=async()=>{try{let e=(0,l.doc)(r.db,"teachers",k),a=await (0,l.getDoc)(e);a.exists()?E(a.data()):(alert("Teacher not found"),T.back())}catch(e){console.error(e)}finally{P(!1)}},Z=async()=>{try{(0,l.query)((0,l.collection)(r.db,"salary_payments"),(0,l.where)("personId","==",k),(0,l.orderBy)("createdAt","desc"));let e=(0,l.query)((0,l.collection)(r.db,"salary_payments"),(0,l.where)("personId","==",k)),a=(await (0,l.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}));a.sort((e,a)=>a.createdAt?.seconds-e.createdAt?.seconds),q(a)}catch(e){console.error(e)}},ee=async()=>{_(!0);try{if(!z.amount)throw Error("Amount required");let a=await e?.getIdToken(),s=await fetch("/api/admin/payroll/process",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({personId:k,personType:"TEACHER",...z,amount:Number(z.amount)})}),t=await s.json();if(!s.ok)throw Error(t.error);alert("Salary Payment Recorded!"),U(!1),Z()}catch(e){alert(e.message)}finally{_(!1)}};return M?(0,a.jsx)("div",{className:"p-10 flex justify-center",children:(0,a.jsx)(c.Loader2,{className:"animate-spin"})}):A?(0,a.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500",children:[(0,a.jsxs)("div",{className:"flex flex-col xl:flex-row xl:items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 w-full xl:w-auto",children:[(0,a.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>T.back(),children:(0,a.jsx)(o.ArrowLeft,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-display font-bold",children:A.name}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-muted-foreground mt-1",children:[(0,a.jsx)(d.Badge,{variant:"outline",className:"border-blue-500/50 text-blue-400 font-mono",children:A.schoolId}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:A.status})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 w-full xl:w-auto xl:ml-auto",children:[(0,a.jsxs)(i.Button,{onClick:()=>W(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,a.jsx)(L.KeyRound,{className:"w-4 h-4 mr-2"})," Reset Password"]}),(0,a.jsxs)(i.Button,{onClick:()=>Q(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,a.jsx)(b.Edit,{className:"w-4 h-4 mr-2"})," Edit Profile"]}),"MANAGER"!==R&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Button,{onClick:()=>G(!0),variant:"outline",className:"border-white/10 hover:bg-white/5 flex-1 md:flex-none",children:[(0,a.jsx)(O.Settings,{className:"w-4 h-4 mr-2"})," Adjust Salary"]}),(0,a.jsxs)(i.Button,{onClick:()=>U(!0),className:"bg-green-600 hover:bg-green-700 text-white flex-1 md:flex-none",children:[(0,a.jsx)(g.Wallet,{className:"w-4 h-4 mr-2"})," Pay Salary"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)(n.Card,{className:"md:col-span-2 bg-black/40 border-white/10",children:[(0,a.jsx)(n.CardHeader,{children:(0,a.jsx)(n.CardTitle,{className:"text-lg",children:"Personal Details"})}),(0,a.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(y.Label,{className:"text-muted-foreground",children:"Mobile"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(m.Phone,{className:"w-4 h-4 text-blue-400"}),(0,a.jsx)("span",{className:"font-mono",children:A.mobile})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y.Label,{className:"text-muted-foreground",children:"Age"}),(0,a.jsxs)("div",{className:"mt-1",children:[A.age," years"]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(y.Label,{className:"text-muted-foreground",children:"Address"}),(0,a.jsxs)("div",{className:"flex items-start gap-2 mt-1",children:[(0,a.jsx)(h.MapPin,{className:"w-4 h-4 text-red-400 mt-1"}),(0,a.jsx)("span",{children:A.address})]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(y.Label,{className:"text-muted-foreground",children:"Qualifications"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(x.GraduationCap,{className:"w-4 h-4 text-yellow-400"}),(0,a.jsx)("span",{children:A.qualifications})]})]}),A.classTeacherOf&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(y.Label,{className:"text-muted-foreground",children:"Class In-charge"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-emerald-400 font-bold",children:[(0,a.jsx)(f.CheckCircle,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Class Teacher of ",A.classTeacherOf.classId.toUpperCase()," - ",A.classTeacherOf.sectionId]})]})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-white/10",children:[(0,a.jsx)(y.Label,{className:"text-muted-foreground block mb-2",children:"Teaching Subjects"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[A.subjects?.map(e=>(0,a.jsxs)(d.Badge,{className:"bg-purple-500/10 text-purple-400 border border-purple-500/20 px-3 py-1",children:[(0,a.jsx)(u.BookOpen,{className:"w-3 h-3 mr-2"})," ",e]},e)),(!A.subjects||0===A.subjects.length)&&(0,a.jsx)("span",{className:"text-muted-foreground italic",children:"No subjects assigned"})]})]})]})]}),"MANAGER"!==R&&(0,a.jsxs)(n.Card,{className:"bg-black/40 border-white/10",children:[(0,a.jsx)(n.CardHeader,{children:(0,a.jsx)(n.CardTitle,{className:"text-lg",children:"Compensations"})}),(0,a.jsxs)(n.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl border border-white/10 text-center",children:[(0,a.jsx)("div",{className:"text-muted-foreground text-sm uppercase tracking-wider mb-1",children:"Current Salary"}),(0,a.jsxs)("div",{className:"text-3xl font-display font-bold",children:["₹",A.salary?.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-semibold mb-3",children:"Recent Payments"}),(0,a.jsxs)("div",{className:"space-y-2",children:[F.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white/5 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-bold",children:[e.month," ",e.year]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.method})]}),(0,a.jsxs)("div",{className:"font-mono text-green-400 font-bold",children:["+₹",e.amount.toLocaleString()]})]},e.id)),0===F.length&&(0,a.jsx)("div",{className:"text-center text-muted-foreground text-sm",children:"No payment history"})]})]})]})]})]}),(0,a.jsx)(j.Dialog,{open:H,onOpenChange:U,children:(0,a.jsxs)(j.DialogContent,{className:"bg-black/95 border-white/10 text-white",children:[(0,a.jsx)(j.DialogHeader,{children:(0,a.jsxs)(j.DialogTitle,{children:["Pay Salary to ",A.name]})}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Month"}),(0,a.jsxs)(w.Select,{value:z.month,onValueChange:e=>V({...z,month:e}),children:[(0,a.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(w.SelectValue,{})}),(0,a.jsx)(w.SelectContent,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map(e=>(0,a.jsx)(w.SelectItem,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Year"}),(0,a.jsx)(N.Input,{value:z.year,onChange:e=>V({...z,year:e.target.value}),className:"bg-white/5 border-white/10"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Amount (₹)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.DollarSign,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,a.jsx)(N.Input,{type:"number",value:z.amount,onChange:e=>V({...z,amount:e.target.value}),className:"pl-9 bg-white/5 border-white/10",placeholder:A.salary?.toString()})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Base Salary: ₹",A.salary?.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Payment Mode"}),(0,a.jsxs)(w.Select,{value:z.method,onValueChange:e=>V({...z,method:e}),children:[(0,a.jsx)(w.SelectTrigger,{className:"bg-white/5 border-white/10",children:(0,a.jsx)(w.SelectValue,{})}),(0,a.jsxs)(w.SelectContent,{children:[(0,a.jsx)(w.SelectItem,{value:"CASH",children:"Cash"}),(0,a.jsx)(w.SelectItem,{value:"UPI",children:"UPI / Online"}),(0,a.jsx)(w.SelectItem,{value:"CHEQUE",children:"Cheque"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.Label,{children:"Notes (Optional)"}),(0,a.jsx)(v.Textarea,{value:z.notes,onChange:e=>V({...z,notes:e.target.value}),className:"bg-white/5 border-white/10",placeholder:"e.g. Bonus included"})]})]}),(0,a.jsx)(j.DialogFooter,{children:(0,a.jsx)(i.Button,{onClick:ee,disabled:$,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:$?(0,a.jsx)(c.Loader2,{className:"w-4 h-4 animate-spin"}):"Confirm Payment"})})]})}),(0,a.jsx)(C.AdjustSalaryModal,{isOpen:J,onClose:()=>G(!1),person:A?{id:k,name:A.name,schoolId:A.schoolId,role:"TEACHER",currentSalary:A.salary||0}:null,onSuccess:()=>X()}),(0,a.jsx)(D,{isOpen:K,onClose:()=>Q(!1),teacher:A?{id:k,...A}:null,onSuccess:()=>X()}),(0,a.jsx)(I.AdminChangePasswordModal,{isOpen:Y,onClose:()=>W(!1),user:A?{uid:A.uid,schoolId:A.schoolId,name:A.name,role:"TEACHER"}:null})]}):null}e.s(["default",()=>E],50919)},27510,e=>{e.v(a=>Promise.all(["static/chunks/54ab083194d7bfbe.js"].map(a=>e.l(a))).then(()=>a(48323)))}]);